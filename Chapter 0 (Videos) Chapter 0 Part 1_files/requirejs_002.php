/**
 * Factory to create a paged content widget.
 *
 * @module     core/paged_content_factory
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_factory",["jquery","core/templates","core/notification","core/paged_content","core/paged_content_events","core/pubsub","core/ajax"],(function($,Templates,Notification,PagedContent,PagedContentEvents,PubSub,Ajax){var TEMPLATES_PAGED_CONTENT="core/paged_content",DEFAULT_ITEMS_PER_PAGE_SINGLE=25,DEFAULT_ITEMS_PER_PAGE_ARRAY=[25,50,100,0],DEFAULT_MAX_PAGES=3,buildPagingBarTemplateContextUnknownLength=function(itemsPerPage){null===itemsPerPage&&(itemsPerPage=DEFAULT_ITEMS_PER_PAGE_ARRAY);var context={showitemsperpageselector:!1,itemsperpage:35,previous:!0,next:!0,activepagenumber:1,hidecontrolonsinglepage:!0,pages:[]};return context.itemsperpage=function(itemsPerPage){var context=[];return $.isArray(itemsPerPage)?(context=itemsPerPage.map((function(num){return"number"==typeof num?{value:num,active:!1}:num}))).filter((function(item){return item.active})).length||(context[0].active=!0):context=[{value:itemsPerPage,active:!0}],context}(itemsPerPage),context.showitemsperpageselector=$.isArray(itemsPerPage)&&itemsPerPage.length>1,context},buildPagingBarTemplateContext=function(numberOfItems,itemsPerPage){return numberOfItems?function(numberOfItems,itemsPerPage){null===itemsPerPage&&(itemsPerPage=DEFAULT_ITEMS_PER_PAGE_SINGLE),$.isArray(itemsPerPage)&&(itemsPerPage=itemsPerPage[0]);var context={showitemsperpageselector:!1,itemsperpage:35,previous:!0,next:!0,activepagenumber:1,hidecontrolonsinglepage:!0,pages:[]};context.itemsperpage=itemsPerPage;for(var numberOfPages=function(numberOfItems,itemsPerPage){var numberOfPages=1;if(numberOfItems>0){var partial=numberOfItems%itemsPerPage;numberOfPages=partial?(numberOfItems-=partial)/itemsPerPage+1:numberOfItems/itemsPerPage}return numberOfPages}(numberOfItems,itemsPerPage),i=1;i<=numberOfPages;i++){var page={number:i,page:""+i};1===i&&(page.active=!0),context.pages.push(page)}return context.barsize=10,context}(numberOfItems,itemsPerPage):buildPagingBarTemplateContextUnknownLength(itemsPerPage)},buildTemplateContext=function(numberOfItems,itemsPerPage,config){var context={pagingbar:!1,pagingdropdown:!1,skipjs:!0,ignorecontrolwhileloading:!0,controlplacementbottom:!1};return config.hasOwnProperty("ignoreControlWhileLoading")&&(context.ignorecontrolwhileloading=config.ignoreControlWhileLoading),config.hasOwnProperty("controlPlacementBottom")&&(context.controlplacementbottom=config.controlPlacementBottom),config.hasOwnProperty("hideControlOnSinglePage")&&(context.hidecontrolonsinglepage=config.hideControlOnSinglePage),config.hasOwnProperty("ariaLabels")&&(context.arialabels=config.ariaLabels),config.hasOwnProperty("dropdown")&&config.dropdown?context.pagingdropdown=function(itemsPerPage,config){if(null===itemsPerPage&&(itemsPerPage=DEFAULT_ITEMS_PER_PAGE_SINGLE),$.isArray(itemsPerPage))return{options:itemsPerPage};var context={options:[]},totalItems=0,lastIncrease=0,maxPages=DEFAULT_MAX_PAGES;config.hasOwnProperty("maxPages")&&(maxPages=config.maxPages);for(var i=1;i<=maxPages;i++){var itemCount=0;i<=2?(itemCount=itemsPerPage,lastIncrease=itemsPerPage):itemCount=lastIncrease*=2;var option={itemcount:itemCount,content:totalItems+=itemCount};1===i&&(option.active=!0),context.options.push(option)}return context}(itemsPerPage,config):context.pagingbar=buildPagingBarTemplateContext(numberOfItems,itemsPerPage),context},createWithTotalAndLimit=function(numberOfItems,itemsPerPage,renderPagesContentCallback,config){config=config||{};var deferred=$.Deferred(),templateContext=buildTemplateContext(numberOfItems,itemsPerPage,config);return Templates.render(TEMPLATES_PAGED_CONTENT,templateContext).then((function(html,js){var id=(html=$(html)).attr("id");config.hasOwnProperty("eventNamespace")&&(id=config.eventNamespace);var container=html;PagedContent.init(container,renderPagesContentCallback,id),registerEvents(id,config),deferred.resolve(html,js)})).fail((function(exception){deferred.reject(exception)})).fail(Notification.exception),deferred.promise()},registerEvents=function(namespace,config){var persistentLimitKey;config.hasOwnProperty("persistentLimitKey")&&PubSub.subscribe(namespace+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT,(persistentLimitKey=config.persistentLimitKey,function(limit){var request={methodname:"core_user_update_user_preferences",args:{preferences:[{type:persistentLimitKey,value:limit}]}};Ajax.call([request])}))};return{create:function(renderPagesContentCallback,config){return createWithTotalAndLimit(null,null,renderPagesContentCallback,config)},createWithLimit:function(itemsPerPage,renderPagesContentCallback,config){return createWithTotalAndLimit(null,itemsPerPage,renderPagesContentCallback,config)},createWithTotalAndLimit:createWithTotalAndLimit,createFromStaticList:function(contentItems,itemsPerPage,renderContentCallback,config){void 0===config&&(config={});var numberOfItems=contentItems.length;return createWithTotalAndLimit(numberOfItems,itemsPerPage,(function(pagesData){var contentToRender=[];return pagesData.forEach((function(pageData){var begin=pageData.offset,end=pageData.limit?begin+pageData.limit:numberOfItems,items=contentItems.slice(begin,end);contentToRender.push(items)})),renderContentCallback(contentToRender)}),config)},createFromAjax:createWithTotalAndLimit,resetLastPageNumber:function(id,lastPageNumber){PubSub.publish(id+PagedContentEvents.ALL_ITEMS_LOADED,lastPageNumber)}}}));
define("core/utils",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.throttle=_exports.debounce=void 0;_exports.throttle=function(func,wait){var onCooldown=!1,runAgain=null;return function run(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];runAgain=null!==runAgain,onCooldown||(func.apply(this,args),onCooldown=!0,setTimeout((function(){var recurse=runAgain;onCooldown=!1,runAgain=null,recurse&&run(args)}),wait))}};_exports.debounce=function(func,wait){var timeout=null;return function(){for(var _this=this,_len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];clearTimeout(timeout),timeout=setTimeout((function(){func.apply(_this,args)}),wait)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Chart series.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_series
 */}define("core/chart_series",[],(function(){function Series(label,values){if("string"!=typeof label)throw new Error("Invalid label for series.");if("object"!==_typeof(values))throw new Error("Values for a series must be an array.");if(values.length<1)throw new Error("Invalid values received for series.");this._colors=[],this._label=label,this._values=values}return Series.prototype.TYPE_DEFAULT=null,Series.prototype.TYPE_LINE="line",Series.prototype._colors=null,Series.prototype._fill=!1,Series.prototype._label=null,Series.prototype._labels=null,Series.prototype._smooth=!1,Series.prototype._type=Series.prototype.TYPE_DEFAULT,Series.prototype._values=null,Series.prototype._xaxis=null,Series.prototype._yaxis=null,Series.prototype.create=function(obj){var s=new Series(obj.label,obj.values);return s.setType(obj.type),s.setXAxis(obj.axes.x),s.setYAxis(obj.axes.y),s.setLabels(obj.labels),obj.colors&&obj.colors.length>1?s.setColors(obj.colors):s.setColor(obj.colors[0]),s.setFill(obj.fill),s.setSmooth(obj.smooth),s},Series.prototype.getColor=function(){return this._colors[0]||null},Series.prototype.getColors=function(){return this._colors},Series.prototype.getCount=function(){return this._values.length},Series.prototype.getFill=function(){return this._fill},Series.prototype.getLabel=function(){return this._label},Series.prototype.getLabels=function(){return this._labels},Series.prototype.getSmooth=function(){return this._smooth},Series.prototype.getType=function(){return this._type},Series.prototype.getValues=function(){return this._values},Series.prototype.getXAxis=function(){return this._xaxis},Series.prototype.getYAxis=function(){return this._yaxis},Series.prototype.hasColoredValues=function(){return this._colors.length==this.getCount()},Series.prototype.setColor=function(color){this._colors=[color]},Series.prototype.setColors=function(colors){if(colors&&colors.length!=this.getCount())throw new Error("When setting multiple colors there must be one per value.");this._colors=colors||[]},Series.prototype.setFill=function(fill){this._fill=void 0===fill?null:fill},Series.prototype.setLabels=function(labels){this._validateLabels(labels),labels=void 0===labels?null:labels,this._labels=labels},Series.prototype.setSmooth=function(smooth){smooth=void 0===smooth?null:smooth,this._smooth=smooth},Series.prototype.setType=function(type){if(type!=this.TYPE_DEFAULT&&type!=this.TYPE_LINE)throw new Error("Invalid serie type.");this._type=type||null},Series.prototype.setXAxis=function(index){this._xaxis=index||null},Series.prototype.setYAxis=function(index){this._yaxis=index||null},Series.prototype._validateLabels=function(labels){if(labels&&labels.length>0&&labels.length!=this.getCount())throw new Error("Series labels must match series values.")},Series}));
function _typeof2(obj){return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof2(obj)}define("core/adapter",[],(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){var n=t[o][1][e];return s(n||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var adapter=(0,require("./adapter_factory.js").adapterFactory)({window:window});module.exports=adapter},{"./adapter_factory.js":2}],2:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.adapterFactory=function(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},window=_ref.window,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},logging=utils.log,browserDetails=utils.detectBrowser(window),adapter={browserDetails:browserDetails,commonShim:commonShim,extractVersion:utils.extractVersion,disableLog:utils.disableLog,disableWarnings:utils.disableWarnings};switch(browserDetails.browser){case"chrome":if(!chromeShim||!chromeShim.shimPeerConnection||!options.shimChrome)return logging("Chrome shim is not included in this adapter release."),adapter;logging("adapter.js shimming chrome."),adapter.browserShim=chromeShim,chromeShim.shimGetUserMedia(window),chromeShim.shimMediaStream(window),chromeShim.shimPeerConnection(window),chromeShim.shimOnTrack(window),chromeShim.shimAddTrackRemoveTrack(window),chromeShim.shimGetSendersWithDtmf(window),chromeShim.shimGetStats(window),chromeShim.shimSenderReceiverGetStats(window),chromeShim.fixNegotiationNeeded(window),commonShim.shimRTCIceCandidate(window),commonShim.shimConnectionState(window),commonShim.shimMaxMessageSize(window),commonShim.shimSendThrowTypeError(window),commonShim.removeAllowExtmapMixed(window);break;case"firefox":if(!firefoxShim||!firefoxShim.shimPeerConnection||!options.shimFirefox)return logging("Firefox shim is not included in this adapter release."),adapter;logging("adapter.js shimming firefox."),adapter.browserShim=firefoxShim,firefoxShim.shimGetUserMedia(window),firefoxShim.shimPeerConnection(window),firefoxShim.shimOnTrack(window),firefoxShim.shimRemoveStream(window),firefoxShim.shimSenderGetStats(window),firefoxShim.shimReceiverGetStats(window),firefoxShim.shimRTCDataChannel(window),firefoxShim.shimAddTransceiver(window),firefoxShim.shimCreateOffer(window),firefoxShim.shimCreateAnswer(window),commonShim.shimRTCIceCandidate(window),commonShim.shimConnectionState(window),commonShim.shimMaxMessageSize(window),commonShim.shimSendThrowTypeError(window);break;case"edge":if(!edgeShim||!edgeShim.shimPeerConnection||!options.shimEdge)return logging("MS edge shim is not included in this adapter release."),adapter;logging("adapter.js shimming edge."),adapter.browserShim=edgeShim,edgeShim.shimGetUserMedia(window),edgeShim.shimGetDisplayMedia(window),edgeShim.shimPeerConnection(window),edgeShim.shimReplaceTrack(window),commonShim.shimMaxMessageSize(window),commonShim.shimSendThrowTypeError(window);break;case"safari":if(!safariShim||!options.shimSafari)return logging("Safari shim is not included in this adapter release."),adapter;logging("adapter.js shimming safari."),adapter.browserShim=safariShim,safariShim.shimRTCIceServerUrls(window),safariShim.shimCreateOfferLegacy(window),safariShim.shimCallbacksAPI(window),safariShim.shimLocalStreamsAPI(window),safariShim.shimRemoteStreamsAPI(window),safariShim.shimTrackEventTransceiver(window),safariShim.shimGetUserMedia(window),commonShim.shimRTCIceCandidate(window),commonShim.shimMaxMessageSize(window),commonShim.shimSendThrowTypeError(window),commonShim.removeAllowExtmapMixed(window);break;default:logging("Unsupported browser!")}return adapter};var utils=_interopRequireWildcard(require("./utils")),chromeShim=_interopRequireWildcard(require("./chrome/chrome_shim")),edgeShim=_interopRequireWildcard(require("./edge/edge_shim")),firefoxShim=_interopRequireWildcard(require("./firefox/firefox_shim")),safariShim=_interopRequireWildcard(require("./safari/safari_shim")),commonShim=_interopRequireWildcard(require("./common_shim"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=exports.shimGetUserMedia=void 0;var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_getusermedia=require("./getusermedia");Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return _getusermedia.shimGetUserMedia}});var _getdisplaymedia=require("./getdisplaymedia");Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return _getdisplaymedia.shimGetDisplayMedia}}),exports.shimMediaStream=function(window){window.MediaStream=window.MediaStream||window.webkitMediaStream},exports.shimOnTrack=function(window){if("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(f){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=f)},enumerable:!0,configurable:!0});var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){var _this=this;return this._ontrackpoly||(this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",(function(te){var receiver=void 0;receiver=window.RTCPeerConnection.prototype.getReceivers?_this.getReceivers().find((function(r){return r.track&&r.track.id===te.track.id})):{track:te.track};var event=new Event("track");event.track=te.track,event.receiver=receiver,event.transceiver={receiver:receiver},event.streams=[e.stream],_this.dispatchEvent(event)})),e.stream.getTracks().forEach((function(track){var receiver=void 0;receiver=window.RTCPeerConnection.prototype.getReceivers?_this.getReceivers().find((function(r){return r.track&&r.track.id===track.id})):{track:track};var event=new Event("track");event.track=track,event.receiver=receiver,event.transceiver={receiver:receiver},event.streams=[e.stream],_this.dispatchEvent(event)}))},this.addEventListener("addstream",this._ontrackpoly)),origSetRemoteDescription.apply(this,arguments)}}else utils.wrapPeerConnectionEvent(window,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))},exports.shimGetSendersWithDtmf=function(window){if("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&!("getSenders"in window.RTCPeerConnection.prototype)&&"createDTMFSender"in window.RTCPeerConnection.prototype){var shimSenderWithDtmf=function(pc,track){return{track:track,get dtmf(){return void 0===this._dtmf&&("audio"===track.kind?this._dtmf=pc.createDTMFSender(track):this._dtmf=null),this._dtmf},_pc:pc}};if(!window.RTCPeerConnection.prototype.getSenders){window.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function(track,stream){var sender=origAddTrack.apply(this,arguments);return sender||(sender=shimSenderWithDtmf(this,track),this._senders.push(sender)),sender};var origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function(sender){origRemoveTrack.apply(this,arguments);var idx=this._senders.indexOf(sender);-1!==idx&&this._senders.splice(idx,1)}}var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this2=this;this._senders=this._senders||[],origAddStream.apply(this,[stream]),stream.getTracks().forEach((function(track){_this2._senders.push(shimSenderWithDtmf(_this2,track))}))};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){var _this3=this;this._senders=this._senders||[],origRemoveStream.apply(this,[stream]),stream.getTracks().forEach((function(track){var sender=_this3._senders.find((function(s){return s.track===track}));sender&&_this3._senders.splice(_this3._senders.indexOf(sender),1)}))}}else if("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&"getSenders"in window.RTCPeerConnection.prototype&&"createDTMFSender"in window.RTCPeerConnection.prototype&&window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;window.RTCPeerConnection.prototype.getSenders=function(){var _this4=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this4})),senders},Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},exports.shimGetStats=function(window){if(!window.RTCPeerConnection)return;var origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){var _this5=this,_arguments=Array.prototype.slice.call(arguments),selector=_arguments[0],onSucc=_arguments[1],onErr=_arguments[2];if(arguments.length>0&&"function"==typeof selector)return origGetStats.apply(this,arguments);if(0===origGetStats.length&&(0===arguments.length||"function"!=typeof selector))return origGetStats.apply(this,[]);var fixChromeStats_=function(response){var standardReport={};return response.result().forEach((function(report){var standardStats={id:report.id,timestamp:report.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[report.type]||report.type};report.names().forEach((function(name){standardStats[name]=report.stat(name)})),standardReport[standardStats.id]=standardStats})),standardReport},makeMapStats=function(stats){return new Map(Object.keys(stats).map((function(key){return[key,stats[key]]})))};if(arguments.length>=2){var successCallbackWrapper_=function(response){onSucc(makeMapStats(fixChromeStats_(response)))};return origGetStats.apply(this,[successCallbackWrapper_,selector])}return new Promise((function(resolve,reject){origGetStats.apply(_this5,[function(response){resolve(makeMapStats(fixChromeStats_(response)))},reject])})).then(onSucc,onErr)}},exports.shimSenderReceiverGetStats=function(window){if(!("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&window.RTCRtpSender&&window.RTCRtpReceiver))return;if(!("getStats"in window.RTCRtpSender.prototype)){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;origGetSenders&&(window.RTCPeerConnection.prototype.getSenders=function(){var _this6=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this6})),senders});var origAddTrack=window.RTCPeerConnection.prototype.addTrack;origAddTrack&&(window.RTCPeerConnection.prototype.addTrack=function(){var sender=origAddTrack.apply(this,arguments);return sender._pc=this,sender}),window.RTCRtpSender.prototype.getStats=function(){var sender=this;return this._pc.getStats().then((function(result){return utils.filterStats(result,sender.track,!0)}))}}if(!("getStats"in window.RTCRtpReceiver.prototype)){var origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;origGetReceivers&&(window.RTCPeerConnection.prototype.getReceivers=function(){var _this7=this,receivers=origGetReceivers.apply(this,[]);return receivers.forEach((function(receiver){return receiver._pc=_this7})),receivers}),utils.wrapPeerConnectionEvent(window,"track",(function(e){return e.receiver._pc=e.srcElement,e})),window.RTCRtpReceiver.prototype.getStats=function(){var receiver=this;return this._pc.getStats().then((function(result){return utils.filterStats(result,receiver.track,!1)}))}}if(!("getStats"in window.RTCRtpSender.prototype)||!("getStats"in window.RTCRtpReceiver.prototype))return;var origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof window.MediaStreamTrack){var track=arguments[0],sender=void 0,receiver=void 0,err=void 0;return this.getSenders().forEach((function(s){s.track===track&&(sender?err=!0:sender=s)})),this.getReceivers().forEach((function(r){return r.track===track&&(receiver?err=!0:receiver=r),r.track===track})),err||sender&&receiver?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):sender?sender.getStats():receiver?receiver.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return origGetStats.apply(this,arguments)}},exports.shimAddTrackRemoveTrackWithNative=shimAddTrackRemoveTrackWithNative,exports.shimAddTrackRemoveTrack=function(window){if(!window.RTCPeerConnection)return;var browserDetails=utils.detectBrowser(window);if(window.RTCPeerConnection.prototype.addTrack&&browserDetails.version>=65)return shimAddTrackRemoveTrackWithNative(window);var origGetLocalStreams=window.RTCPeerConnection.prototype.getLocalStreams;window.RTCPeerConnection.prototype.getLocalStreams=function(){var _this11=this,nativeStreams=origGetLocalStreams.apply(this);return this._reverseStreams=this._reverseStreams||{},nativeStreams.map((function(stream){return _this11._reverseStreams[stream.id]}))};var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this12=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},stream.getTracks().forEach((function(track){if(_this12.getSenders().find((function(s){return s.track===track})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[stream.id]){var newStream=new window.MediaStream(stream.getTracks());this._streams[stream.id]=newStream,this._reverseStreams[newStream.id]=stream,stream=newStream}origAddStream.apply(this,[stream])};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;function replaceInternalStreamId(pc,description){var sdp=description.sdp;return Object.keys(pc._reverseStreams||[]).forEach((function(internalId){var externalStream=pc._reverseStreams[internalId],internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(internalStream.id,"g"),externalStream.id)})),new RTCSessionDescription({type:description.type,sdp:sdp})}function replaceExternalStreamId(pc,description){var sdp=description.sdp;return Object.keys(pc._reverseStreams||[]).forEach((function(internalId){var externalStream=pc._reverseStreams[internalId],internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(externalStream.id,"g"),internalStream.id)})),new RTCSessionDescription({type:description.type,sdp:sdp})}window.RTCPeerConnection.prototype.removeStream=function(stream){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},origRemoveStream.apply(this,[this._streams[stream.id]||stream]),delete this._reverseStreams[this._streams[stream.id]?this._streams[stream.id].id:stream.id],delete this._streams[stream.id]},window.RTCPeerConnection.prototype.addTrack=function(track,stream){var _this13=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var streams=[].slice.call(arguments,1);if(1!==streams.length||!streams[0].getTracks().find((function(t){return t===track})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var alreadyExists=this.getSenders().find((function(s){return s.track===track}));if(alreadyExists)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var oldStream=this._streams[stream.id];if(oldStream)oldStream.addTrack(track),Promise.resolve().then((function(){_this13.dispatchEvent(new Event("negotiationneeded"))}));else{var newStream=new window.MediaStream([track]);this._streams[stream.id]=newStream,this._reverseStreams[newStream.id]=stream,this.addStream(newStream)}return this.getSenders().find((function(s){return s.track===track}))},["createOffer","createAnswer"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=_defineProperty({},method,(function(){var _this14=this,args=arguments,isLegacyCall=arguments.length&&"function"==typeof arguments[0];return isLegacyCall?nativeMethod.apply(this,[function(description){var desc=replaceInternalStreamId(_this14,description);args[0].apply(null,[desc])},function(err){args[1]&&args[1].apply(null,err)},arguments[2]]):nativeMethod.apply(this,arguments).then((function(description){return replaceInternalStreamId(_this14,description)}))}));window.RTCPeerConnection.prototype[method]=methodObj[method]}));var origSetLocalDescription=window.RTCPeerConnection.prototype.setLocalDescription;window.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=replaceExternalStreamId(this,arguments[0]),origSetLocalDescription.apply(this,arguments)):origSetLocalDescription.apply(this,arguments)};var origLocalDescription=Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(window.RTCPeerConnection.prototype,"localDescription",{get:function(){var description=origLocalDescription.get.apply(this);return""===description.type?description:replaceInternalStreamId(this,description)}}),window.RTCPeerConnection.prototype.removeTrack=function(sender){var _this15=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!sender._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(sender._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var stream=void 0;Object.keys(this._streams).forEach((function(streamid){_this15._streams[streamid].getTracks().find((function(track){return sender.track===track}))&&(stream=_this15._streams[streamid])})),stream&&(1===stream.getTracks().length?this.removeStream(this._reverseStreams[stream.id]):stream.removeTrack(sender.track),this.dispatchEvent(new Event("negotiationneeded")))}},exports.shimPeerConnection=function(window){var browserDetails=utils.detectBrowser(window);!window.RTCPeerConnection&&window.webkitRTCPeerConnection&&(window.RTCPeerConnection=window.webkitRTCPeerConnection);if(!window.RTCPeerConnection)return;browserDetails.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=_defineProperty({},method,(function(){return arguments[0]=new("addIceCandidate"===method?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}));window.RTCPeerConnection.prototype[method]=methodObj[method]}));var nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;window.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?browserDetails.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():nativeAddIceCandidate.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},exports.fixNegotiationNeeded=function(window){utils.wrapPeerConnectionEvent(window,"negotiationneeded",(function(e){if("stable"===e.target.signalingState)return e}))};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils.js"));function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function shimAddTrackRemoveTrackWithNative(window){window.RTCPeerConnection.prototype.getLocalStreams=function(){var _this8=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(streamId){return _this8._shimmedLocalStreams[streamId][0]}))};var origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function(track,stream){if(!stream)return origAddTrack.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var sender=origAddTrack.apply(this,arguments);return this._shimmedLocalStreams[stream.id]?-1===this._shimmedLocalStreams[stream.id].indexOf(sender)&&this._shimmedLocalStreams[stream.id].push(sender):this._shimmedLocalStreams[stream.id]=[stream,sender],sender};var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this9=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},stream.getTracks().forEach((function(track){if(_this9.getSenders().find((function(s){return s.track===track})))throw new DOMException("Track already exists.","InvalidAccessError")}));var existingSenders=this.getSenders();origAddStream.apply(this,arguments);var newSenders=this.getSenders().filter((function(newSender){return-1===existingSenders.indexOf(newSender)}));this._shimmedLocalStreams[stream.id]=[stream].concat(newSenders)};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[stream.id],origRemoveStream.apply(this,arguments)};var origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function(sender){var _this10=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},sender&&Object.keys(this._shimmedLocalStreams).forEach((function(streamId){var idx=_this10._shimmedLocalStreams[streamId].indexOf(sender);-1!==idx&&_this10._shimmedLocalStreams[streamId].splice(idx,1),1===_this10._shimmedLocalStreams[streamId].length&&delete _this10._shimmedLocalStreams[streamId]})),origRemoveTrack.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=function(window,getSourceId){if(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices)return;if(!window.navigator.mediaDevices)return;if("function"!=typeof getSourceId)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");window.navigator.mediaDevices.getDisplayMedia=function(constraints){return getSourceId(constraints).then((function(sourceId){var widthSpecified=constraints.video&&constraints.video.width,heightSpecified=constraints.video&&constraints.video.height,frameRateSpecified=constraints.video&&constraints.video.frameRate;return constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:sourceId,maxFrameRate:frameRateSpecified||3}},widthSpecified&&(constraints.video.mandatory.maxWidth=widthSpecified),heightSpecified&&(constraints.video.mandatory.maxHeight=heightSpecified),window.navigator.mediaDevices.getUserMedia(constraints)}))}}},{}],5:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimGetUserMedia=function(window){var navigator=window&&window.navigator;if(!navigator.mediaDevices)return;var browserDetails=utils.detectBrowser(window),constraintsToChrome_=function(c){if("object"!==(void 0===c?"undefined":_typeof(c))||c.mandatory||c.optional)return c;var cc={};return Object.keys(c).forEach((function(key){if("require"!==key&&"advanced"!==key&&"mediaSource"!==key){var r="object"===_typeof(c[key])?c[key]:{ideal:c[key]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var oldname_=function(prefix,name){return prefix?prefix+name.charAt(0).toUpperCase()+name.slice(1):"deviceId"===name?"sourceId":name};if(void 0!==r.ideal){cc.optional=cc.optional||[];var oc={};"number"==typeof r.ideal?(oc[oldname_("min",key)]=r.ideal,cc.optional.push(oc),(oc={})[oldname_("max",key)]=r.ideal,cc.optional.push(oc)):(oc[oldname_("",key)]=r.ideal,cc.optional.push(oc))}void 0!==r.exact&&"number"!=typeof r.exact?(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_("",key)]=r.exact):["min","max"].forEach((function(mix){void 0!==r[mix]&&(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_(mix,key)]=r[mix])}))}})),c.advanced&&(cc.optional=(cc.optional||[]).concat(c.advanced)),cc},shimConstraints_=function(constraints,func){if(browserDetails.version>=61)return func(constraints);if((constraints=JSON.parse(JSON.stringify(constraints)))&&"object"===_typeof(constraints.audio)){var remap=function(obj,a,b){a in obj&&!(b in obj)&&(obj[b]=obj[a],delete obj[a])};remap((constraints=JSON.parse(JSON.stringify(constraints))).audio,"autoGainControl","googAutoGainControl"),remap(constraints.audio,"noiseSuppression","googNoiseSuppression"),constraints.audio=constraintsToChrome_(constraints.audio)}if(constraints&&"object"===_typeof(constraints.video)){var face=constraints.video.facingMode;face=face&&("object"===(void 0===face?"undefined":_typeof(face))?face:{ideal:face});var getSupportedFacingModeLies=browserDetails.version<66;if(face&&("user"===face.exact||"environment"===face.exact||"user"===face.ideal||"environment"===face.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||getSupportedFacingModeLies)){delete constraints.video.facingMode;var matches=void 0;if("environment"===face.exact||"environment"===face.ideal?matches=["back","rear"]:"user"!==face.exact&&"user"!==face.ideal||(matches=["front"]),matches)return navigator.mediaDevices.enumerateDevices().then((function(devices){var dev=(devices=devices.filter((function(d){return"videoinput"===d.kind}))).find((function(d){return matches.some((function(match){return d.label.toLowerCase().includes(match)}))}));return!dev&&devices.length&&matches.includes("back")&&(dev=devices[devices.length-1]),dev&&(constraints.video.deviceId=face.exact?{exact:dev.deviceId}:{ideal:dev.deviceId}),constraints.video=constraintsToChrome_(constraints.video),logging("chrome: "+JSON.stringify(constraints)),func(constraints)}))}constraints.video=constraintsToChrome_(constraints.video)}return logging("chrome: "+JSON.stringify(constraints)),func(constraints)},shimError_=function(e){return browserDetails.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(navigator.getUserMedia=function(constraints,onSuccess,onError){shimConstraints_(constraints,(function(c){navigator.webkitGetUserMedia(c,onSuccess,(function(e){onError&&onError(shimError_(e))}))}))}.bind(navigator),navigator.mediaDevices.getUserMedia){var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(cs){return shimConstraints_(cs,(function(c){return origGetUserMedia(c).then((function(stream){if(c.audio&&!stream.getAudioTracks().length||c.video&&!stream.getVideoTracks().length)throw stream.getTracks().forEach((function(track){track.stop()})),new DOMException("","NotFoundError");return stream}),(function(e){return Promise.reject(shimError_(e))}))}))}}};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils.js"));var logging=utils.log},{"../utils.js":15}],6:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimRTCIceCandidate=function(window){if(!window.RTCIceCandidate||window.RTCIceCandidate&&"foundation"in window.RTCIceCandidate.prototype)return;var NativeRTCIceCandidate=window.RTCIceCandidate;window.RTCIceCandidate=function(args){if("object"===(void 0===args?"undefined":_typeof(args))&&args.candidate&&0===args.candidate.indexOf("a=")&&((args=JSON.parse(JSON.stringify(args))).candidate=args.candidate.substr(2)),args.candidate&&args.candidate.length){var nativeCandidate=new NativeRTCIceCandidate(args),parsedCandidate=_sdp2.default.parseCandidate(args.candidate),augmentedCandidate=Object.assign(nativeCandidate,parsedCandidate);return augmentedCandidate.toJSON=function(){return{candidate:augmentedCandidate.candidate,sdpMid:augmentedCandidate.sdpMid,sdpMLineIndex:augmentedCandidate.sdpMLineIndex,usernameFragment:augmentedCandidate.usernameFragment}},augmentedCandidate}return new NativeRTCIceCandidate(args)},window.RTCIceCandidate.prototype=NativeRTCIceCandidate.prototype,utils.wrapPeerConnectionEvent(window,"icecandidate",(function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new window.RTCIceCandidate(e.candidate),writable:"false"}),e}))},exports.shimMaxMessageSize=function(window){if(!window.RTCPeerConnection)return;var browserDetails=utils.detectBrowser(window);"sctp"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var sctpInDescription=function(description){if(!description||!description.sdp)return!1;var sections=_sdp2.default.splitSections(description.sdp);return sections.shift(),sections.some((function(mediaSection){var mLine=_sdp2.default.parseMLine(mediaSection);return mLine&&"application"===mLine.kind&&-1!==mLine.protocol.indexOf("SCTP")}))},getRemoteFirefoxVersion=function(description){var match=description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===match||match.length<2)return-1;var version=parseInt(match[1],10);return version!=version?-1:version},getCanSendMaxMessageSize=function(remoteIsFirefox){var canSendMaxMessageSize=65536;return"firefox"===browserDetails.browser&&(canSendMaxMessageSize=browserDetails.version<57?-1===remoteIsFirefox?16384:2147483637:browserDetails.version<60?57===browserDetails.version?65535:65536:2147483637),canSendMaxMessageSize},getMaxMessageSize=function(description,remoteIsFirefox){var maxMessageSize=65536;"firefox"===browserDetails.browser&&57===browserDetails.version&&(maxMessageSize=65535);var match=_sdp2.default.matchPrefix(description.sdp,"a=max-message-size:");return match.length>0?maxMessageSize=parseInt(match[0].substr(19),10):"firefox"===browserDetails.browser&&-1!==remoteIsFirefox&&(maxMessageSize=2147483637),maxMessageSize},origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===browserDetails.browser&&browserDetails.version>=76){var _getConfiguration=this.getConfiguration(),sdpSemantics=_getConfiguration.sdpSemantics;"plan-b"===sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(sctpInDescription(arguments[0])){var isFirefox=getRemoteFirefoxVersion(arguments[0]),canSendMMS=getCanSendMaxMessageSize(isFirefox),remoteMMS=getMaxMessageSize(arguments[0],isFirefox),maxMessageSize=void 0;maxMessageSize=0===canSendMMS&&0===remoteMMS?Number.POSITIVE_INFINITY:0===canSendMMS||0===remoteMMS?Math.max(canSendMMS,remoteMMS):Math.min(canSendMMS,remoteMMS);var sctp={};Object.defineProperty(sctp,"maxMessageSize",{get:function(){return maxMessageSize}}),this._sctp=sctp}return origSetRemoteDescription.apply(this,arguments)}},exports.shimSendThrowTypeError=function(window){if(!window.RTCPeerConnection||!("createDataChannel"in window.RTCPeerConnection.prototype))return;function wrapDcSend(dc,pc){var origDataChannelSend=dc.send;dc.send=function(){var data=arguments[0],length=data.length||data.size||data.byteLength;if("open"===dc.readyState&&pc.sctp&&length>pc.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+pc.sctp.maxMessageSize+" bytes)");return origDataChannelSend.apply(dc,arguments)}}var origCreateDataChannel=window.RTCPeerConnection.prototype.createDataChannel;window.RTCPeerConnection.prototype.createDataChannel=function(){var dataChannel=origCreateDataChannel.apply(this,arguments);return wrapDcSend(dataChannel,this),dataChannel},utils.wrapPeerConnectionEvent(window,"datachannel",(function(e){return wrapDcSend(e.channel,e.target),e}))},exports.shimConnectionState=function(window){if(!window.RTCPeerConnection||"connectionState"in window.RTCPeerConnection.prototype)return;var proto=window.RTCPeerConnection.prototype;Object.defineProperty(proto,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(proto,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(cb){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),cb&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=cb)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(method){var origMethod=proto[method];proto[method]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var pc=e.target;if(pc._lastConnectionState!==pc.connectionState){pc._lastConnectionState=pc.connectionState;var newEvent=new Event("connectionstatechange",e);pc.dispatchEvent(newEvent)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),origMethod.apply(this,arguments)}}))},exports.removeAllowExtmapMixed=function(window){if(!window.RTCPeerConnection)return;var browserDetails=utils.detectBrowser(window);if("chrome"===browserDetails.browser&&browserDetails.version>=71)return;var nativeSRD=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(desc){return desc&&desc.sdp&&-1!==desc.sdp.indexOf("\na=extmap-allow-mixed")&&(desc.sdp=desc.sdp.split("\n").filter((function(line){return"a=extmap-allow-mixed"!==line.trim()})).join("\n")),nativeSRD.apply(this,arguments)}};var obj,_sdp=require("sdp"),_sdp2=(obj=_sdp)&&obj.__esModule?obj:{default:obj},utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("./utils"))},{"./utils":15,sdp:17}],7:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=exports.shimGetUserMedia=void 0;var _getusermedia=require("./getusermedia");Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return _getusermedia.shimGetUserMedia}});var _getdisplaymedia=require("./getdisplaymedia");Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return _getdisplaymedia.shimGetDisplayMedia}}),exports.shimPeerConnection=function(window){var browserDetails=utils.detectBrowser(window);if(window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(args){return args}),window.RTCSessionDescription||(window.RTCSessionDescription=function(args){return args}),browserDetails.version<15025)){var origMSTEnabled=Object.getOwnPropertyDescriptor(window.MediaStreamTrack.prototype,"enabled");Object.defineProperty(window.MediaStreamTrack.prototype,"enabled",{set:function(value){origMSTEnabled.set.call(this,value);var ev=new Event("enabled");ev.enabled=value,this.dispatchEvent(ev)}})}window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)&&Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new window.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}});window.RTCDtmfSender&&!window.RTCDTMFSender&&(window.RTCDTMFSender=window.RTCDtmfSender);var RTCPeerConnectionShim=(0,_rtcpeerconnectionShim2.default)(window,browserDetails.version);window.RTCPeerConnection=function(config){return config&&config.iceServers&&(config.iceServers=(0,_filtericeservers.filterIceServers)(config.iceServers,browserDetails.version),utils.log("ICE servers after filtering:",config.iceServers)),new RTCPeerConnectionShim(config)},window.RTCPeerConnection.prototype=RTCPeerConnectionShim.prototype},exports.shimReplaceTrack=function(window){window.RTCRtpSender&&!("replaceTrack"in window.RTCRtpSender.prototype)&&(window.RTCRtpSender.prototype.replaceTrack=window.RTCRtpSender.prototype.setTrack)};var obj,utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils")),_filtericeservers=require("./filtericeservers"),_rtcpeerconnectionShim=require("rtcpeerconnection-shim"),_rtcpeerconnectionShim2=(obj=_rtcpeerconnectionShim)&&obj.__esModule?obj:{default:obj}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.filterIceServers=function(iceServers,edgeVersion){var hasTurn=!1;return(iceServers=JSON.parse(JSON.stringify(iceServers))).filter((function(server){if(server&&(server.urls||server.url)){var urls=server.urls||server.url;server.url&&!server.urls&&utils.deprecated("RTCIceServer.url","RTCIceServer.urls");var isString="string"==typeof urls;return isString&&(urls=[urls]),urls=urls.filter((function(url){if(0===url.indexOf("stun:"))return!1;var validTurn=url.startsWith("turn")&&!url.startsWith("turn:[")&&url.includes("transport=udp");return validTurn&&!hasTurn?(hasTurn=!0,!0):validTurn&&!hasTurn})),delete server.url,server.urls=isString?urls[0]:urls,!!urls.length}}))};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils"))},{"../utils":15}],9:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=function(window){if(!("getDisplayMedia"in window.navigator))return;if(!window.navigator.mediaDevices)return;if(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices)return;window.navigator.mediaDevices.getDisplayMedia=window.navigator.getDisplayMedia.bind(window.navigator)}},{}],10:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetUserMedia=function(window){var navigator=window&&window.navigator,origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return origGetUserMedia(c).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],11:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=exports.shimGetUserMedia=void 0;var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_getusermedia=require("./getusermedia");Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return _getusermedia.shimGetUserMedia}});var _getdisplaymedia=require("./getdisplaymedia");Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return _getdisplaymedia.shimGetDisplayMedia}}),exports.shimOnTrack=function(window){"object"===(void 0===window?"undefined":_typeof(window))&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)&&Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},exports.shimPeerConnection=function(window){var browserDetails=utils.detectBrowser(window);if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection&&!window.mozRTCPeerConnection)return;!window.RTCPeerConnection&&window.mozRTCPeerConnection&&(window.RTCPeerConnection=window.mozRTCPeerConnection);browserDetails.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value;return obj}({},method,(function(){return arguments[0]=new("addIceCandidate"===method?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}));window.RTCPeerConnection.prototype[method]=methodObj[method]}));if(browserDetails.version<68){var nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;window.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():nativeAddIceCandidate.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var modernStatsTypes={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},nativeGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){var _arguments=Array.prototype.slice.call(arguments),selector=_arguments[0],onSucc=_arguments[1],onErr=_arguments[2];return nativeGetStats.apply(this,[selector||null]).then((function(stats){if(browserDetails.version<53&&!onSucc)try{stats.forEach((function(stat){stat.type=modernStatsTypes[stat.type]||stat.type}))}catch(e){if("TypeError"!==e.name)throw e;stats.forEach((function(stat,i){stats.set(i,Object.assign({},stat,{type:modernStatsTypes[stat.type]||stat.type}))}))}return stats})).then(onSucc,onErr)}},exports.shimSenderGetStats=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection||!window.RTCRtpSender)return;if(window.RTCRtpSender&&"getStats"in window.RTCRtpSender.prototype)return;var origGetSenders=window.RTCPeerConnection.prototype.getSenders;origGetSenders&&(window.RTCPeerConnection.prototype.getSenders=function(){var _this=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this})),senders});var origAddTrack=window.RTCPeerConnection.prototype.addTrack;origAddTrack&&(window.RTCPeerConnection.prototype.addTrack=function(){var sender=origAddTrack.apply(this,arguments);return sender._pc=this,sender});window.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}},exports.shimReceiverGetStats=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection||!window.RTCRtpSender)return;if(window.RTCRtpSender&&"getStats"in window.RTCRtpReceiver.prototype)return;var origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;origGetReceivers&&(window.RTCPeerConnection.prototype.getReceivers=function(){var _this2=this,receivers=origGetReceivers.apply(this,[]);return receivers.forEach((function(receiver){return receiver._pc=_this2})),receivers});utils.wrapPeerConnectionEvent(window,"track",(function(e){return e.receiver._pc=e.srcElement,e})),window.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}},exports.shimRemoveStream=function(window){if(!window.RTCPeerConnection||"removeStream"in window.RTCPeerConnection.prototype)return;window.RTCPeerConnection.prototype.removeStream=function(stream){var _this3=this;utils.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(sender){sender.track&&stream.getTracks().includes(sender.track)&&_this3.removeTrack(sender)}))}},exports.shimRTCDataChannel=function(window){window.DataChannel&&!window.RTCDataChannel&&(window.RTCDataChannel=window.DataChannel)},exports.shimAddTransceiver=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var origAddTransceiver=window.RTCPeerConnection.prototype.addTransceiver;origAddTransceiver&&(window.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var initParameters=arguments[1],shouldPerformCheck=initParameters&&"sendEncodings"in initParameters;shouldPerformCheck&&initParameters.sendEncodings.forEach((function(encodingParam){if("rid"in encodingParam){if(!/^[a-z0-9]{0,16}$/i.test(encodingParam.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in encodingParam&&!(parseFloat(encodingParam.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in encodingParam&&!(parseFloat(encodingParam.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var transceiver=origAddTransceiver.apply(this,arguments);if(shouldPerformCheck){var sender=transceiver.sender,params=sender.getParameters();"encodings"in params||(params.encodings=initParameters.sendEncodings,this.setParametersPromises.push(sender.setParameters(params).catch((function(){}))))}return transceiver})},exports.shimCreateOffer=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function(){var _this4=this,_arguments2=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return origCreateOffer.apply(_this4,_arguments2)})).finally((function(){_this4.setParametersPromises=[]})):origCreateOffer.apply(this,arguments)}},exports.shimCreateAnswer=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var origCreateAnswer=window.RTCPeerConnection.prototype.createAnswer;window.RTCPeerConnection.prototype.createAnswer=function(){var _this5=this,_arguments3=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return origCreateAnswer.apply(_this5,_arguments3)})).finally((function(){_this5.setParametersPromises=[]})):origCreateAnswer.apply(this,arguments)}};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=function(window,preferredMediaSource){if(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices)return;if(!window.navigator.mediaDevices)return;window.navigator.mediaDevices.getDisplayMedia=function(constraints){if(!constraints||!constraints.video){var err=new DOMException("getDisplayMedia without video constraints is undefined");return err.name="NotFoundError",err.code=8,Promise.reject(err)}return!0===constraints.video?constraints.video={mediaSource:preferredMediaSource}:constraints.video.mediaSource=preferredMediaSource,window.navigator.mediaDevices.getUserMedia(constraints)}}},{}],13:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimGetUserMedia=function(window){var browserDetails=utils.detectBrowser(window),navigator=window&&window.navigator,MediaStreamTrack=window&&window.MediaStreamTrack;if(navigator.getUserMedia=function(constraints,onSuccess,onError){utils.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(constraints).then(onSuccess,onError)},!(browserDetails.version>55&&"autoGainControl"in navigator.mediaDevices.getSupportedConstraints())){var remap=function(obj,a,b){a in obj&&!(b in obj)&&(obj[b]=obj[a],delete obj[a])},nativeGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);if(navigator.mediaDevices.getUserMedia=function(c){return"object"===(void 0===c?"undefined":_typeof(c))&&"object"===_typeof(c.audio)&&(c=JSON.parse(JSON.stringify(c)),remap(c.audio,"autoGainControl","mozAutoGainControl"),remap(c.audio,"noiseSuppression","mozNoiseSuppression")),nativeGetUserMedia(c)},MediaStreamTrack&&MediaStreamTrack.prototype.getSettings){var nativeGetSettings=MediaStreamTrack.prototype.getSettings;MediaStreamTrack.prototype.getSettings=function(){var obj=nativeGetSettings.apply(this,arguments);return remap(obj,"mozAutoGainControl","autoGainControl"),remap(obj,"mozNoiseSuppression","noiseSuppression"),obj}}if(MediaStreamTrack&&MediaStreamTrack.prototype.applyConstraints){var nativeApplyConstraints=MediaStreamTrack.prototype.applyConstraints;MediaStreamTrack.prototype.applyConstraints=function(c){return"audio"===this.kind&&"object"===(void 0===c?"undefined":_typeof(c))&&(c=JSON.parse(JSON.stringify(c)),remap(c,"autoGainControl","mozAutoGainControl"),remap(c,"noiseSuppression","mozNoiseSuppression")),nativeApplyConstraints.apply(this,[c])}}}};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils"))},{"../utils":15}],14:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimLocalStreamsAPI=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;"getLocalStreams"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams});if(!("addStream"in window.RTCPeerConnection.prototype)){var _addTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addStream=function(stream){var _this=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(stream)||this._localStreams.push(stream),stream.getAudioTracks().forEach((function(track){return _addTrack.call(_this,track,stream)})),stream.getVideoTracks().forEach((function(track){return _addTrack.call(_this,track,stream)}))},window.RTCPeerConnection.prototype.addTrack=function(track){var stream=arguments[1];return stream&&(this._localStreams?this._localStreams.includes(stream)||this._localStreams.push(stream):this._localStreams=[stream]),_addTrack.apply(this,arguments)}}"removeStream"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.removeStream=function(stream){var _this2=this;this._localStreams||(this._localStreams=[]);var index=this._localStreams.indexOf(stream);if(-1!==index){this._localStreams.splice(index,1);var tracks=stream.getTracks();this.getSenders().forEach((function(sender){tracks.includes(sender.track)&&_this2.removeTrack(sender)}))}})},exports.shimRemoteStreamsAPI=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;"getRemoteStreams"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]});if(!("onaddstream"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(f){var _this3=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=f),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(stream){if(_this3._remoteStreams||(_this3._remoteStreams=[]),!_this3._remoteStreams.includes(stream)){_this3._remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream,_this3.dispatchEvent(event)}}))})}});var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){var pc=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(stream){if(pc._remoteStreams||(pc._remoteStreams=[]),!(pc._remoteStreams.indexOf(stream)>=0)){pc._remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream,pc.dispatchEvent(event)}}))}),origSetRemoteDescription.apply(pc,arguments)}}},exports.shimCallbacksAPI=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var prototype=window.RTCPeerConnection.prototype,origCreateOffer=prototype.createOffer,origCreateAnswer=prototype.createAnswer,setLocalDescription=prototype.setLocalDescription,setRemoteDescription=prototype.setRemoteDescription,addIceCandidate=prototype.addIceCandidate;prototype.createOffer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0],promise=origCreateOffer.apply(this,[options]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.createAnswer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0],promise=origCreateAnswer.apply(this,[options]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise};var withCallback=function(description,successCallback,failureCallback){var promise=setLocalDescription.apply(this,[description]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise};prototype.setLocalDescription=withCallback,withCallback=function(description,successCallback,failureCallback){var promise=setRemoteDescription.apply(this,[description]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.setRemoteDescription=withCallback,withCallback=function(candidate,successCallback,failureCallback){var promise=addIceCandidate.apply(this,[candidate]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.addIceCandidate=withCallback},exports.shimGetUserMedia=function(window){var navigator=window&&window.navigator;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var mediaDevices=navigator.mediaDevices,_getUserMedia=mediaDevices.getUserMedia.bind(mediaDevices);navigator.mediaDevices.getUserMedia=function(constraints){return _getUserMedia(shimConstraints(constraints))}}!navigator.getUserMedia&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(constraints,cb,errcb){navigator.mediaDevices.getUserMedia(constraints).then(cb,errcb)}.bind(navigator))},exports.shimConstraints=shimConstraints,exports.shimRTCIceServerUrls=function(window){var OrigPeerConnection=window.RTCPeerConnection;window.RTCPeerConnection=function(pcConfig,pcConstraints){if(pcConfig&&pcConfig.iceServers){for(var newIceServers=[],i=0;i<pcConfig.iceServers.length;i++){var server=pcConfig.iceServers[i];!server.hasOwnProperty("urls")&&server.hasOwnProperty("url")?(utils.deprecated("RTCIceServer.url","RTCIceServer.urls"),(server=JSON.parse(JSON.stringify(server))).urls=server.url,delete server.url,newIceServers.push(server)):newIceServers.push(pcConfig.iceServers[i])}pcConfig.iceServers=newIceServers}return new OrigPeerConnection(pcConfig,pcConstraints)},window.RTCPeerConnection.prototype=OrigPeerConnection.prototype,"generateCertificate"in window.RTCPeerConnection&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return OrigPeerConnection.generateCertificate}})},exports.shimTrackEventTransceiver=function(window){"object"===(void 0===window?"undefined":_typeof(window))&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)&&Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},exports.shimCreateOfferLegacy=function(window){var origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function(offerOptions){if(offerOptions){void 0!==offerOptions.offerToReceiveAudio&&(offerOptions.offerToReceiveAudio=!!offerOptions.offerToReceiveAudio);var audioTransceiver=this.getTransceivers().find((function(transceiver){return"audio"===transceiver.receiver.track.kind}));!1===offerOptions.offerToReceiveAudio&&audioTransceiver?"sendrecv"===audioTransceiver.direction?audioTransceiver.setDirection?audioTransceiver.setDirection("sendonly"):audioTransceiver.direction="sendonly":"recvonly"===audioTransceiver.direction&&(audioTransceiver.setDirection?audioTransceiver.setDirection("inactive"):audioTransceiver.direction="inactive"):!0!==offerOptions.offerToReceiveAudio||audioTransceiver||this.addTransceiver("audio"),void 0!==offerOptions.offerToReceiveVideo&&(offerOptions.offerToReceiveVideo=!!offerOptions.offerToReceiveVideo);var videoTransceiver=this.getTransceivers().find((function(transceiver){return"video"===transceiver.receiver.track.kind}));!1===offerOptions.offerToReceiveVideo&&videoTransceiver?"sendrecv"===videoTransceiver.direction?videoTransceiver.setDirection?videoTransceiver.setDirection("sendonly"):videoTransceiver.direction="sendonly":"recvonly"===videoTransceiver.direction&&(videoTransceiver.setDirection?videoTransceiver.setDirection("inactive"):videoTransceiver.direction="inactive"):!0!==offerOptions.offerToReceiveVideo||videoTransceiver||this.addTransceiver("video")}return origCreateOffer.apply(this,arguments)}};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils"));function shimConstraints(constraints){return constraints&&void 0!==constraints.video?Object.assign({},constraints,{video:utils.compactObject(constraints.video)}):constraints}},{"../utils":15}],15:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.extractVersion=extractVersion,exports.wrapPeerConnectionEvent=function(window,eventNameToWrap,wrapper){if(!window.RTCPeerConnection)return;var proto=window.RTCPeerConnection.prototype,nativeAddEventListener=proto.addEventListener;proto.addEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap)return nativeAddEventListener.apply(this,arguments);var wrappedCallback=function(e){var modifiedEvent=wrapper(e);modifiedEvent&&cb(modifiedEvent)};return this._eventMap=this._eventMap||{},this._eventMap[cb]=wrappedCallback,nativeAddEventListener.apply(this,[nativeEventName,wrappedCallback])};var nativeRemoveEventListener=proto.removeEventListener;proto.removeEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap||!this._eventMap||!this._eventMap[cb])return nativeRemoveEventListener.apply(this,arguments);var unwrappedCb=this._eventMap[cb];return delete this._eventMap[cb],nativeRemoveEventListener.apply(this,[nativeEventName,unwrappedCb])},Object.defineProperty(proto,"on"+eventNameToWrap,{get:function(){return this["_on"+eventNameToWrap]},set:function(cb){this["_on"+eventNameToWrap]&&(this.removeEventListener(eventNameToWrap,this["_on"+eventNameToWrap]),delete this["_on"+eventNameToWrap]),cb&&this.addEventListener(eventNameToWrap,this["_on"+eventNameToWrap]=cb)},enumerable:!0,configurable:!0})},exports.disableLog=function(bool){if("boolean"!=typeof bool)return new Error("Argument type: "+(void 0===bool?"undefined":_typeof(bool))+". Please use a boolean.");return logDisabled_=bool,bool?"adapter.js logging disabled":"adapter.js logging enabled"},exports.disableWarnings=function(bool){if("boolean"!=typeof bool)return new Error("Argument type: "+(void 0===bool?"undefined":_typeof(bool))+". Please use a boolean.");return deprecationWarnings_=!bool,"adapter.js deprecation warnings "+(bool?"disabled":"enabled")},exports.log=function(){if("object"===("undefined"==typeof window?"undefined":_typeof(window))){if(logDisabled_)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},exports.deprecated=function(oldMethod,newMethod){if(!deprecationWarnings_)return;console.warn(oldMethod+" is deprecated, please use "+newMethod+" instead.")},exports.detectBrowser=function(window){var navigator=window.navigator,result={browser:null,version:null};if(void 0===window||!window.navigator)return result.browser="Not a browser.",result;if(navigator.mozGetUserMedia)result.browser="firefox",result.version=extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia||!1===window.isSecureContext&&window.webkitRTCPeerConnection&&!window.RTCIceGatherer)result.browser="chrome",result.version=extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))result.browser="edge",result.version=extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return result.browser="Not a supported browser.",result;result.browser="safari",result.version=extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1),result.supportsUnifiedPlan=window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype}return result},exports.compactObject=function compactObject(data){if(!isObject(data))return data;return Object.keys(data).reduce((function(accumulator,key){var isObj=isObject(data[key]),value=isObj?compactObject(data[key]):data[key],isEmptyObject=isObj&&!Object.keys(value).length;return void 0===value||isEmptyObject?accumulator:Object.assign(accumulator,function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value;return obj}({},key,value))}),{})},exports.walkStats=walkStats,exports.filterStats=function(result,track,outbound){var streamStatsType=outbound?"outbound-rtp":"inbound-rtp",filteredResult=new Map;if(null===track)return filteredResult;var trackStats=[];return result.forEach((function(value){"track"===value.type&&value.trackIdentifier===track.id&&trackStats.push(value)})),trackStats.forEach((function(trackStat){result.forEach((function(stats){stats.type===streamStatsType&&stats.trackId===trackStat.id&&walkStats(result,stats,filteredResult)}))})),filteredResult};var logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(uastring,expr,pos){var match=uastring.match(expr);return match&&match.length>=pos&&parseInt(match[pos],10)}function isObject(val){return"[object Object]"===Object.prototype.toString.call(val)}function walkStats(stats,base,resultSet){base&&!resultSet.has(base.id)&&(resultSet.set(base.id,base),Object.keys(base).forEach((function(name){name.endsWith("Id")?walkStats(stats,stats.get(base[name]),resultSet):name.endsWith("Ids")&&base[name].forEach((function(id){walkStats(stats,stats.get(id),resultSet)}))})))}},{}],16:[function(require,module,exports){var SDPUtils=require("sdp");function writeMediaSection(transceiver,caps,type,stream,dtlsRole){var sdp=SDPUtils.writeRtpDescription(transceiver.kind,caps);if(sdp+=SDPUtils.writeIceParameters(transceiver.iceGatherer.getLocalParameters()),sdp+=SDPUtils.writeDtlsParameters(transceiver.dtlsTransport.getLocalParameters(),"offer"===type?"actpass":dtlsRole||"active"),sdp+="a=mid:"+transceiver.mid+"\r\n",transceiver.rtpSender&&transceiver.rtpReceiver?sdp+="a=sendrecv\r\n":transceiver.rtpSender?sdp+="a=sendonly\r\n":transceiver.rtpReceiver?sdp+="a=recvonly\r\n":sdp+="a=inactive\r\n",transceiver.rtpSender){var trackId=transceiver.rtpSender._initialTrackId||transceiver.rtpSender.track.id;transceiver.rtpSender._initialTrackId=trackId;var msid="msid:"+(stream?stream.id:"-")+" "+trackId+"\r\n";sdp+="a="+msid,sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" "+msid,transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" "+msid,sdp+="a=ssrc-group:FID "+transceiver.sendEncodingParameters[0].ssrc+" "+transceiver.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" cname:"+SDPUtils.localCName+"\r\n",transceiver.rtpSender&&transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" cname:"+SDPUtils.localCName+"\r\n"),sdp}function getCommonCapabilities(localCapabilities,remoteCapabilities){var commonCapabilities={codecs:[],headerExtensions:[],fecMechanisms:[]},findCodecByPayloadType=function(pt,codecs){pt=parseInt(pt,10);for(var i=0;i<codecs.length;i++)if(codecs[i].payloadType===pt||codecs[i].preferredPayloadType===pt)return codecs[i]},rtxCapabilityMatches=function(lRtx,rRtx,lCodecs,rCodecs){var lCodec=findCodecByPayloadType(lRtx.parameters.apt,lCodecs),rCodec=findCodecByPayloadType(rRtx.parameters.apt,rCodecs);return lCodec&&rCodec&&lCodec.name.toLowerCase()===rCodec.name.toLowerCase()};return localCapabilities.codecs.forEach((function(lCodec){for(var i=0;i<remoteCapabilities.codecs.length;i++){var rCodec=remoteCapabilities.codecs[i];if(lCodec.name.toLowerCase()===rCodec.name.toLowerCase()&&lCodec.clockRate===rCodec.clockRate){if("rtx"===lCodec.name.toLowerCase()&&lCodec.parameters&&rCodec.parameters.apt&&!rtxCapabilityMatches(lCodec,rCodec,localCapabilities.codecs,remoteCapabilities.codecs))continue;(rCodec=JSON.parse(JSON.stringify(rCodec))).numChannels=Math.min(lCodec.numChannels,rCodec.numChannels),commonCapabilities.codecs.push(rCodec),rCodec.rtcpFeedback=rCodec.rtcpFeedback.filter((function(fb){for(var j=0;j<lCodec.rtcpFeedback.length;j++)if(lCodec.rtcpFeedback[j].type===fb.type&&lCodec.rtcpFeedback[j].parameter===fb.parameter)return!0;return!1}));break}}})),localCapabilities.headerExtensions.forEach((function(lHeaderExtension){for(var i=0;i<remoteCapabilities.headerExtensions.length;i++){var rHeaderExtension=remoteCapabilities.headerExtensions[i];if(lHeaderExtension.uri===rHeaderExtension.uri){commonCapabilities.headerExtensions.push(rHeaderExtension);break}}})),commonCapabilities}function isActionAllowedInSignalingState(action,type,signalingState){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[type][action].indexOf(signalingState)}function maybeAddCandidate(iceTransport,candidate){var alreadyAdded=iceTransport.getRemoteCandidates().find((function(remoteCandidate){return candidate.foundation===remoteCandidate.foundation&&candidate.ip===remoteCandidate.ip&&candidate.port===remoteCandidate.port&&candidate.priority===remoteCandidate.priority&&candidate.protocol===remoteCandidate.protocol&&candidate.type===remoteCandidate.type}));return alreadyAdded||iceTransport.addRemoteCandidate(candidate),!alreadyAdded}function makeError(name,description){var e=new Error(description);return e.name=name,e.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[name],e}module.exports=function(window,edgeVersion){function addTrackToStreamAndFireEvent(track,stream){stream.addTrack(track),stream.dispatchEvent(new window.MediaStreamTrackEvent("addtrack",{track:track}))}function fireAddTrack(pc,track,receiver,streams){var trackEvent=new Event("track");trackEvent.track=track,trackEvent.receiver=receiver,trackEvent.transceiver={receiver:receiver},trackEvent.streams=streams,window.setTimeout((function(){pc._dispatchEvent("track",trackEvent)}))}var RTCPeerConnection=function(config){var pc=this,_eventTarget=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(method){pc[method]=_eventTarget[method].bind(_eventTarget)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",config=JSON.parse(JSON.stringify(config||{})),this.usingBundle="max-bundle"===config.bundlePolicy,"negotiate"===config.rtcpMuxPolicy)throw makeError("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(config.rtcpMuxPolicy||(config.rtcpMuxPolicy="require"),config.iceTransportPolicy){case"all":case"relay":break;default:config.iceTransportPolicy="all"}switch(config.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:config.bundlePolicy="balanced"}if(config.iceServers=function(iceServers,edgeVersion){var hasTurn=!1;return(iceServers=JSON.parse(JSON.stringify(iceServers))).filter((function(server){if(server&&(server.urls||server.url)){var urls=server.urls||server.url;server.url&&!server.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var isString="string"==typeof urls;return isString&&(urls=[urls]),urls=urls.filter((function(url){return 0!==url.indexOf("turn:")||-1===url.indexOf("transport=udp")||-1!==url.indexOf("turn:[")||hasTurn?0===url.indexOf("stun:")&&edgeVersion>=14393&&-1===url.indexOf("?transport=udp"):(hasTurn=!0,!0)})),delete server.url,server.urls=isString?urls[0]:urls,!!urls.length}}))}(config.iceServers||[],edgeVersion),this._iceGatherers=[],config.iceCandidatePoolSize)for(var i=config.iceCandidatePoolSize;i>0;i--)this._iceGatherers.push(new window.RTCIceGatherer({iceServers:config.iceServers,gatherPolicy:config.iceTransportPolicy}));else config.iceCandidatePoolSize=0;this._config=config,this.transceivers=[],this._sdpSessionId=SDPUtils.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(RTCPeerConnection.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(RTCPeerConnection.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),RTCPeerConnection.prototype.onicecandidate=null,RTCPeerConnection.prototype.onaddstream=null,RTCPeerConnection.prototype.ontrack=null,RTCPeerConnection.prototype.onremovestream=null,RTCPeerConnection.prototype.onsignalingstatechange=null,RTCPeerConnection.prototype.oniceconnectionstatechange=null,RTCPeerConnection.prototype.onconnectionstatechange=null,RTCPeerConnection.prototype.onicegatheringstatechange=null,RTCPeerConnection.prototype.onnegotiationneeded=null,RTCPeerConnection.prototype.ondatachannel=null,RTCPeerConnection.prototype._dispatchEvent=function(name,event){this._isClosed||(this.dispatchEvent(event),"function"==typeof this["on"+name]&&this["on"+name](event))},RTCPeerConnection.prototype._emitGatheringStateChange=function(){var event=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",event)},RTCPeerConnection.prototype.getConfiguration=function(){return this._config},RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams},RTCPeerConnection.prototype._createTransceiver=function(kind,doNotAdd){var hasBundleTransport=this.transceivers.length>0,transceiver={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:kind,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&hasBundleTransport)transceiver.iceTransport=this.transceivers[0].iceTransport,transceiver.dtlsTransport=this.transceivers[0].dtlsTransport;else{var transports=this._createIceAndDtlsTransports();transceiver.iceTransport=transports.iceTransport,transceiver.dtlsTransport=transports.dtlsTransport}return doNotAdd||this.transceivers.push(transceiver),transceiver},RTCPeerConnection.prototype.addTrack=function(track,stream){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var transceiver;if(this.transceivers.find((function(s){return s.track===track})))throw makeError("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==track.kind||(transceiver=this.transceivers[i]);return transceiver||(transceiver=this._createTransceiver(track.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(stream)&&this.localStreams.push(stream),transceiver.track=track,transceiver.stream=stream,transceiver.rtpSender=new window.RTCRtpSender(track,transceiver.dtlsTransport),transceiver.rtpSender},RTCPeerConnection.prototype.addStream=function(stream){var pc=this;if(edgeVersion>=15025)stream.getTracks().forEach((function(track){pc.addTrack(track,stream)}));else{var clonedStream=stream.clone();stream.getTracks().forEach((function(track,idx){var clonedTrack=clonedStream.getTracks()[idx];track.addEventListener("enabled",(function(event){clonedTrack.enabled=event.enabled}))})),clonedStream.getTracks().forEach((function(track){pc.addTrack(track,clonedStream)}))}},RTCPeerConnection.prototype.removeTrack=function(sender){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(sender instanceof window.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var transceiver=this.transceivers.find((function(t){return t.rtpSender===sender}));if(!transceiver)throw makeError("InvalidAccessError","Sender was not created by this connection.");var stream=transceiver.stream;transceiver.rtpSender.stop(),transceiver.rtpSender=null,transceiver.track=null,transceiver.stream=null,-1===this.transceivers.map((function(t){return t.stream})).indexOf(stream)&&this.localStreams.indexOf(stream)>-1&&this.localStreams.splice(this.localStreams.indexOf(stream),1),this._maybeFireNegotiationNeeded()},RTCPeerConnection.prototype.removeStream=function(stream){var pc=this;stream.getTracks().forEach((function(track){var sender=pc.getSenders().find((function(s){return s.track===track}));sender&&pc.removeTrack(sender)}))},RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter((function(transceiver){return!!transceiver.rtpSender})).map((function(transceiver){return transceiver.rtpSender}))},RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter((function(transceiver){return!!transceiver.rtpReceiver})).map((function(transceiver){return transceiver.rtpReceiver}))},RTCPeerConnection.prototype._createIceGatherer=function(sdpMLineIndex,usingBundle){var pc=this;if(usingBundle&&sdpMLineIndex>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var iceGatherer=new window.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(iceGatherer,"state",{value:"new",writable:!0}),this.transceivers[sdpMLineIndex].bufferedCandidateEvents=[],this.transceivers[sdpMLineIndex].bufferCandidates=function(event){var end=!event.candidate||0===Object.keys(event.candidate).length;iceGatherer.state=end?"completed":"gathering",null!==pc.transceivers[sdpMLineIndex].bufferedCandidateEvents&&pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event)},iceGatherer.addEventListener("localcandidate",this.transceivers[sdpMLineIndex].bufferCandidates),iceGatherer},RTCPeerConnection.prototype._gather=function(mid,sdpMLineIndex){var pc=this,iceGatherer=this.transceivers[sdpMLineIndex].iceGatherer;if(!iceGatherer.onlocalcandidate){var bufferedCandidateEvents=this.transceivers[sdpMLineIndex].bufferedCandidateEvents;this.transceivers[sdpMLineIndex].bufferedCandidateEvents=null,iceGatherer.removeEventListener("localcandidate",this.transceivers[sdpMLineIndex].bufferCandidates),iceGatherer.onlocalcandidate=function(evt){if(!(pc.usingBundle&&sdpMLineIndex>0)){var event=new Event("icecandidate");event.candidate={sdpMid:mid,sdpMLineIndex:sdpMLineIndex};var cand=evt.candidate,end=!cand||0===Object.keys(cand).length;if(end)"new"!==iceGatherer.state&&"gathering"!==iceGatherer.state||(iceGatherer.state="completed");else{"new"===iceGatherer.state&&(iceGatherer.state="gathering"),cand.component=1,cand.ufrag=iceGatherer.getLocalParameters().usernameFragment;var serializedCandidate=SDPUtils.writeCandidate(cand);event.candidate=Object.assign(event.candidate,SDPUtils.parseCandidate(serializedCandidate)),event.candidate.candidate=serializedCandidate,event.candidate.toJSON=function(){return{candidate:event.candidate.candidate,sdpMid:event.candidate.sdpMid,sdpMLineIndex:event.candidate.sdpMLineIndex,usernameFragment:event.candidate.usernameFragment}}}var sections=SDPUtils.getMediaSections(pc._localDescription.sdp);sections[event.candidate.sdpMLineIndex]+=end?"a=end-of-candidates\r\n":"a="+event.candidate.candidate+"\r\n",pc._localDescription.sdp=SDPUtils.getDescription(pc._localDescription.sdp)+sections.join("");var complete=pc.transceivers.every((function(transceiver){return transceiver.iceGatherer&&"completed"===transceiver.iceGatherer.state}));"gathering"!==pc.iceGatheringState&&(pc.iceGatheringState="gathering",pc._emitGatheringStateChange()),end||pc._dispatchEvent("icecandidate",event),complete&&(pc._dispatchEvent("icecandidate",new Event("icecandidate")),pc.iceGatheringState="complete",pc._emitGatheringStateChange())}},window.setTimeout((function(){bufferedCandidateEvents.forEach((function(e){iceGatherer.onlocalcandidate(e)}))}),0)}},RTCPeerConnection.prototype._createIceAndDtlsTransports=function(){var pc=this,iceTransport=new window.RTCIceTransport(null);iceTransport.onicestatechange=function(){pc._updateIceConnectionState(),pc._updateConnectionState()};var dtlsTransport=new window.RTCDtlsTransport(iceTransport);return dtlsTransport.ondtlsstatechange=function(){pc._updateConnectionState()},dtlsTransport.onerror=function(){Object.defineProperty(dtlsTransport,"state",{value:"failed",writable:!0}),pc._updateConnectionState()},{iceTransport:iceTransport,dtlsTransport:dtlsTransport}},RTCPeerConnection.prototype._disposeIceAndDtlsTransports=function(sdpMLineIndex){var iceGatherer=this.transceivers[sdpMLineIndex].iceGatherer;iceGatherer&&(delete iceGatherer.onlocalcandidate,delete this.transceivers[sdpMLineIndex].iceGatherer);var iceTransport=this.transceivers[sdpMLineIndex].iceTransport;iceTransport&&(delete iceTransport.onicestatechange,delete this.transceivers[sdpMLineIndex].iceTransport);var dtlsTransport=this.transceivers[sdpMLineIndex].dtlsTransport;dtlsTransport&&(delete dtlsTransport.ondtlsstatechange,delete dtlsTransport.onerror,delete this.transceivers[sdpMLineIndex].dtlsTransport)},RTCPeerConnection.prototype._transceive=function(transceiver,send,recv){var params=getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);send&&transceiver.rtpSender&&(params.encodings=transceiver.sendEncodingParameters,params.rtcp={cname:SDPUtils.localCName,compound:transceiver.rtcpParameters.compound},transceiver.recvEncodingParameters.length&&(params.rtcp.ssrc=transceiver.recvEncodingParameters[0].ssrc),transceiver.rtpSender.send(params)),recv&&transceiver.rtpReceiver&&params.codecs.length>0&&("video"===transceiver.kind&&transceiver.recvEncodingParameters&&edgeVersion<15019&&transceiver.recvEncodingParameters.forEach((function(p){delete p.rtx})),transceiver.recvEncodingParameters.length?params.encodings=transceiver.recvEncodingParameters:params.encodings=[{}],params.rtcp={compound:transceiver.rtcpParameters.compound},transceiver.rtcpParameters.cname&&(params.rtcp.cname=transceiver.rtcpParameters.cname),transceiver.sendEncodingParameters.length&&(params.rtcp.ssrc=transceiver.sendEncodingParameters[0].ssrc),transceiver.rtpReceiver.receive(params))},RTCPeerConnection.prototype.setLocalDescription=function(description){var sections,sessionpart,pc=this;if(-1===["offer","answer"].indexOf(description.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+description.type+'"'));if(!isActionAllowedInSignalingState("setLocalDescription",description.type,pc.signalingState)||pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set local "+description.type+" in state "+pc.signalingState));if("offer"===description.type)sections=SDPUtils.splitSections(description.sdp),sessionpart=sections.shift(),sections.forEach((function(mediaSection,sdpMLineIndex){var caps=SDPUtils.parseRtpParameters(mediaSection);pc.transceivers[sdpMLineIndex].localCapabilities=caps})),pc.transceivers.forEach((function(transceiver,sdpMLineIndex){pc._gather(transceiver.mid,sdpMLineIndex)}));else if("answer"===description.type){sections=SDPUtils.splitSections(pc._remoteDescription.sdp),sessionpart=sections.shift();var isIceLite=SDPUtils.matchPrefix(sessionpart,"a=ice-lite").length>0;sections.forEach((function(mediaSection,sdpMLineIndex){var transceiver=pc.transceivers[sdpMLineIndex],iceGatherer=transceiver.iceGatherer,iceTransport=transceiver.iceTransport,dtlsTransport=transceiver.dtlsTransport,localCapabilities=transceiver.localCapabilities,remoteCapabilities=transceiver.remoteCapabilities;if(!(SDPUtils.isRejected(mediaSection)&&0===SDPUtils.matchPrefix(mediaSection,"a=bundle-only").length)&&!transceiver.rejected){var remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart),remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart);isIceLite&&(remoteDtlsParameters.role="server"),pc.usingBundle&&0!==sdpMLineIndex||(pc._gather(transceiver.mid,sdpMLineIndex),"new"===iceTransport.state&&iceTransport.start(iceGatherer,remoteIceParameters,isIceLite?"controlling":"controlled"),"new"===dtlsTransport.state&&dtlsTransport.start(remoteDtlsParameters));var params=getCommonCapabilities(localCapabilities,remoteCapabilities);pc._transceive(transceiver,params.codecs.length>0,!1)}}))}return pc._localDescription={type:description.type,sdp:description.sdp},"offer"===description.type?pc._updateSignalingState("have-local-offer"):pc._updateSignalingState("stable"),Promise.resolve()},RTCPeerConnection.prototype.setRemoteDescription=function(description){var pc=this;if(-1===["offer","answer"].indexOf(description.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+description.type+'"'));if(!isActionAllowedInSignalingState("setRemoteDescription",description.type,pc.signalingState)||pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set remote "+description.type+" in state "+pc.signalingState));var streams={};pc.remoteStreams.forEach((function(stream){streams[stream.id]=stream}));var receiverList=[],sections=SDPUtils.splitSections(description.sdp),sessionpart=sections.shift(),isIceLite=SDPUtils.matchPrefix(sessionpart,"a=ice-lite").length>0,usingBundle=SDPUtils.matchPrefix(sessionpart,"a=group:BUNDLE ").length>0;pc.usingBundle=usingBundle;var iceOptions=SDPUtils.matchPrefix(sessionpart,"a=ice-options:")[0];return pc.canTrickleIceCandidates=!!iceOptions&&iceOptions.substr(14).split(" ").indexOf("trickle")>=0,sections.forEach((function(mediaSection,sdpMLineIndex){var lines=SDPUtils.splitLines(mediaSection),kind=SDPUtils.getKind(mediaSection),rejected=SDPUtils.isRejected(mediaSection)&&0===SDPUtils.matchPrefix(mediaSection,"a=bundle-only").length,protocol=lines[0].substr(2).split(" ")[2],direction=SDPUtils.getDirection(mediaSection,sessionpart),remoteMsid=SDPUtils.parseMsid(mediaSection),mid=SDPUtils.getMid(mediaSection)||SDPUtils.generateIdentifier();if(rejected||"application"===kind&&("DTLS/SCTP"===protocol||"UDP/DTLS/SCTP"===protocol))pc.transceivers[sdpMLineIndex]={mid:mid,kind:kind,protocol:protocol,rejected:!0};else{var transceiver,iceGatherer,iceTransport,dtlsTransport,rtpReceiver,sendEncodingParameters,recvEncodingParameters,localCapabilities,track;!rejected&&pc.transceivers[sdpMLineIndex]&&pc.transceivers[sdpMLineIndex].rejected&&(pc.transceivers[sdpMLineIndex]=pc._createTransceiver(kind,!0));var remoteIceParameters,remoteDtlsParameters,remoteCapabilities=SDPUtils.parseRtpParameters(mediaSection);rejected||(remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart),(remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart)).role="client"),recvEncodingParameters=SDPUtils.parseRtpEncodingParameters(mediaSection);var rtcpParameters=SDPUtils.parseRtcpParameters(mediaSection),isComplete=SDPUtils.matchPrefix(mediaSection,"a=end-of-candidates",sessionpart).length>0,cands=SDPUtils.matchPrefix(mediaSection,"a=candidate:").map((function(cand){return SDPUtils.parseCandidate(cand)})).filter((function(cand){return 1===cand.component}));if(("offer"===description.type||"answer"===description.type)&&!rejected&&usingBundle&&sdpMLineIndex>0&&pc.transceivers[sdpMLineIndex]&&(pc._disposeIceAndDtlsTransports(sdpMLineIndex),pc.transceivers[sdpMLineIndex].iceGatherer=pc.transceivers[0].iceGatherer,pc.transceivers[sdpMLineIndex].iceTransport=pc.transceivers[0].iceTransport,pc.transceivers[sdpMLineIndex].dtlsTransport=pc.transceivers[0].dtlsTransport,pc.transceivers[sdpMLineIndex].rtpSender&&pc.transceivers[sdpMLineIndex].rtpSender.setTransport(pc.transceivers[0].dtlsTransport),pc.transceivers[sdpMLineIndex].rtpReceiver&&pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(pc.transceivers[0].dtlsTransport)),"offer"!==description.type||rejected){if("answer"===description.type&&!rejected){iceGatherer=(transceiver=pc.transceivers[sdpMLineIndex]).iceGatherer,iceTransport=transceiver.iceTransport,dtlsTransport=transceiver.dtlsTransport,rtpReceiver=transceiver.rtpReceiver,sendEncodingParameters=transceiver.sendEncodingParameters,localCapabilities=transceiver.localCapabilities,pc.transceivers[sdpMLineIndex].recvEncodingParameters=recvEncodingParameters,pc.transceivers[sdpMLineIndex].remoteCapabilities=remoteCapabilities,pc.transceivers[sdpMLineIndex].rtcpParameters=rtcpParameters,cands.length&&"new"===iceTransport.state&&(!isIceLite&&!isComplete||usingBundle&&0!==sdpMLineIndex?cands.forEach((function(candidate){maybeAddCandidate(transceiver.iceTransport,candidate)})):iceTransport.setRemoteCandidates(cands)),usingBundle&&0!==sdpMLineIndex||("new"===iceTransport.state&&iceTransport.start(iceGatherer,remoteIceParameters,"controlling"),"new"===dtlsTransport.state&&dtlsTransport.start(remoteDtlsParameters)),!getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities).codecs.filter((function(c){return"rtx"===c.name.toLowerCase()})).length&&transceiver.sendEncodingParameters[0].rtx&&delete transceiver.sendEncodingParameters[0].rtx,pc._transceive(transceiver,"sendrecv"===direction||"recvonly"===direction,"sendrecv"===direction||"sendonly"===direction),!rtpReceiver||"sendrecv"!==direction&&"sendonly"!==direction?delete transceiver.rtpReceiver:(track=rtpReceiver.track,remoteMsid?(streams[remoteMsid.stream]||(streams[remoteMsid.stream]=new window.MediaStream),addTrackToStreamAndFireEvent(track,streams[remoteMsid.stream]),receiverList.push([track,rtpReceiver,streams[remoteMsid.stream]])):(streams.default||(streams.default=new window.MediaStream),addTrackToStreamAndFireEvent(track,streams.default),receiverList.push([track,rtpReceiver,streams.default])))}}else{(transceiver=pc.transceivers[sdpMLineIndex]||pc._createTransceiver(kind)).mid=mid,transceiver.iceGatherer||(transceiver.iceGatherer=pc._createIceGatherer(sdpMLineIndex,usingBundle)),cands.length&&"new"===transceiver.iceTransport.state&&(!isComplete||usingBundle&&0!==sdpMLineIndex?cands.forEach((function(candidate){maybeAddCandidate(transceiver.iceTransport,candidate)})):transceiver.iceTransport.setRemoteCandidates(cands)),localCapabilities=window.RTCRtpReceiver.getCapabilities(kind),edgeVersion<15019&&(localCapabilities.codecs=localCapabilities.codecs.filter((function(codec){return"rtx"!==codec.name}))),sendEncodingParameters=transceiver.sendEncodingParameters||[{ssrc:1001*(2*sdpMLineIndex+2)}];var stream,isNewTrack=!1;if("sendrecv"===direction||"sendonly"===direction){if(isNewTrack=!transceiver.rtpReceiver,rtpReceiver=transceiver.rtpReceiver||new window.RTCRtpReceiver(transceiver.dtlsTransport,kind),isNewTrack)track=rtpReceiver.track,remoteMsid&&"-"===remoteMsid.stream||(remoteMsid?(streams[remoteMsid.stream]||(streams[remoteMsid.stream]=new window.MediaStream,Object.defineProperty(streams[remoteMsid.stream],"id",{get:function(){return remoteMsid.stream}})),Object.defineProperty(track,"id",{get:function(){return remoteMsid.track}}),stream=streams[remoteMsid.stream]):(streams.default||(streams.default=new window.MediaStream),stream=streams.default)),stream&&(addTrackToStreamAndFireEvent(track,stream),transceiver.associatedRemoteMediaStreams.push(stream)),receiverList.push([track,rtpReceiver,stream])}else transceiver.rtpReceiver&&transceiver.rtpReceiver.track&&(transceiver.associatedRemoteMediaStreams.forEach((function(s){var nativeTrack=s.getTracks().find((function(t){return t.id===transceiver.rtpReceiver.track.id}));nativeTrack&&function(track,stream){stream.removeTrack(track),stream.dispatchEvent(new window.MediaStreamTrackEvent("removetrack",{track:track}))}(nativeTrack,s)})),transceiver.associatedRemoteMediaStreams=[]);transceiver.localCapabilities=localCapabilities,transceiver.remoteCapabilities=remoteCapabilities,transceiver.rtpReceiver=rtpReceiver,transceiver.rtcpParameters=rtcpParameters,transceiver.sendEncodingParameters=sendEncodingParameters,transceiver.recvEncodingParameters=recvEncodingParameters,pc._transceive(pc.transceivers[sdpMLineIndex],!1,isNewTrack)}}})),void 0===pc._dtlsRole&&(pc._dtlsRole="offer"===description.type?"active":"passive"),pc._remoteDescription={type:description.type,sdp:description.sdp},"offer"===description.type?pc._updateSignalingState("have-remote-offer"):pc._updateSignalingState("stable"),Object.keys(streams).forEach((function(sid){var stream=streams[sid];if(stream.getTracks().length){if(-1===pc.remoteStreams.indexOf(stream)){pc.remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream,window.setTimeout((function(){pc._dispatchEvent("addstream",event)}))}receiverList.forEach((function(item){var track=item[0],receiver=item[1];stream.id===item[2].id&&fireAddTrack(pc,track,receiver,[stream])}))}})),receiverList.forEach((function(item){item[2]||fireAddTrack(pc,item[0],item[1],[])})),window.setTimeout((function(){pc&&pc.transceivers&&pc.transceivers.forEach((function(transceiver){transceiver.iceTransport&&"new"===transceiver.iceTransport.state&&transceiver.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),transceiver.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},RTCPeerConnection.prototype.close=function(){this.transceivers.forEach((function(transceiver){transceiver.iceTransport&&transceiver.iceTransport.stop(),transceiver.dtlsTransport&&transceiver.dtlsTransport.stop(),transceiver.rtpSender&&transceiver.rtpSender.stop(),transceiver.rtpReceiver&&transceiver.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},RTCPeerConnection.prototype._updateSignalingState=function(newState){this.signalingState=newState;var event=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",event)},RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var pc=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,window.setTimeout((function(){if(pc.needNegotiation){pc.needNegotiation=!1;var event=new Event("negotiationneeded");pc._dispatchEvent("negotiationneeded",event)}}),0))},RTCPeerConnection.prototype._updateIceConnectionState=function(){var newState,states={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(transceiver){transceiver.iceTransport&&!transceiver.rejected&&states[transceiver.iceTransport.state]++})),newState="new",states.failed>0?newState="failed":states.checking>0?newState="checking":states.disconnected>0?newState="disconnected":states.new>0?newState="new":states.connected>0?newState="connected":states.completed>0&&(newState="completed"),newState!==this.iceConnectionState){this.iceConnectionState=newState;var event=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",event)}},RTCPeerConnection.prototype._updateConnectionState=function(){var newState,states={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(transceiver){transceiver.iceTransport&&transceiver.dtlsTransport&&!transceiver.rejected&&(states[transceiver.iceTransport.state]++,states[transceiver.dtlsTransport.state]++)})),states.connected+=states.completed,newState="new",states.failed>0?newState="failed":states.connecting>0?newState="connecting":states.disconnected>0?newState="disconnected":states.new>0?newState="new":states.connected>0&&(newState="connected"),newState!==this.connectionState){this.connectionState=newState;var event=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",event)}},RTCPeerConnection.prototype.createOffer=function(){var pc=this;if(pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createOffer after close"));var numAudioTracks=pc.transceivers.filter((function(t){return"audio"===t.kind})).length,numVideoTracks=pc.transceivers.filter((function(t){return"video"===t.kind})).length,offerOptions=arguments[0];if(offerOptions){if(offerOptions.mandatory||offerOptions.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==offerOptions.offerToReceiveAudio&&(numAudioTracks=!0===offerOptions.offerToReceiveAudio?1:!1===offerOptions.offerToReceiveAudio?0:offerOptions.offerToReceiveAudio),void 0!==offerOptions.offerToReceiveVideo&&(numVideoTracks=!0===offerOptions.offerToReceiveVideo?1:!1===offerOptions.offerToReceiveVideo?0:offerOptions.offerToReceiveVideo)}for(pc.transceivers.forEach((function(transceiver){"audio"===transceiver.kind?--numAudioTracks<0&&(transceiver.wantReceive=!1):"video"===transceiver.kind&&--numVideoTracks<0&&(transceiver.wantReceive=!1)}));numAudioTracks>0||numVideoTracks>0;)numAudioTracks>0&&(pc._createTransceiver("audio"),numAudioTracks--),numVideoTracks>0&&(pc._createTransceiver("video"),numVideoTracks--);var sdp=SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,pc._sdpSessionVersion++);pc.transceivers.forEach((function(transceiver,sdpMLineIndex){var track=transceiver.track,kind=transceiver.kind,mid=transceiver.mid||SDPUtils.generateIdentifier();transceiver.mid=mid,transceiver.iceGatherer||(transceiver.iceGatherer=pc._createIceGatherer(sdpMLineIndex,pc.usingBundle));var localCapabilities=window.RTCRtpSender.getCapabilities(kind);edgeVersion<15019&&(localCapabilities.codecs=localCapabilities.codecs.filter((function(codec){return"rtx"!==codec.name}))),localCapabilities.codecs.forEach((function(codec){"H264"===codec.name&&void 0===codec.parameters["level-asymmetry-allowed"]&&(codec.parameters["level-asymmetry-allowed"]="1"),transceiver.remoteCapabilities&&transceiver.remoteCapabilities.codecs&&transceiver.remoteCapabilities.codecs.forEach((function(remoteCodec){codec.name.toLowerCase()===remoteCodec.name.toLowerCase()&&codec.clockRate===remoteCodec.clockRate&&(codec.preferredPayloadType=remoteCodec.payloadType)}))})),localCapabilities.headerExtensions.forEach((function(hdrExt){(transceiver.remoteCapabilities&&transceiver.remoteCapabilities.headerExtensions||[]).forEach((function(rHdrExt){hdrExt.uri===rHdrExt.uri&&(hdrExt.id=rHdrExt.id)}))}));var sendEncodingParameters=transceiver.sendEncodingParameters||[{ssrc:1001*(2*sdpMLineIndex+1)}];track&&edgeVersion>=15019&&"video"===kind&&!sendEncodingParameters[0].rtx&&(sendEncodingParameters[0].rtx={ssrc:sendEncodingParameters[0].ssrc+1}),transceiver.wantReceive&&(transceiver.rtpReceiver=new window.RTCRtpReceiver(transceiver.dtlsTransport,kind)),transceiver.localCapabilities=localCapabilities,transceiver.sendEncodingParameters=sendEncodingParameters})),"max-compat"!==pc._config.bundlePolicy&&(sdp+="a=group:BUNDLE "+pc.transceivers.map((function(t){return t.mid})).join(" ")+"\r\n"),sdp+="a=ice-options:trickle\r\n",pc.transceivers.forEach((function(transceiver,sdpMLineIndex){sdp+=writeMediaSection(transceiver,transceiver.localCapabilities,"offer",transceiver.stream,pc._dtlsRole),sdp+="a=rtcp-rsize\r\n",!transceiver.iceGatherer||"new"===pc.iceGatheringState||0!==sdpMLineIndex&&pc.usingBundle||(transceiver.iceGatherer.getLocalCandidates().forEach((function(cand){cand.component=1,sdp+="a="+SDPUtils.writeCandidate(cand)+"\r\n"})),"completed"===transceiver.iceGatherer.state&&(sdp+="a=end-of-candidates\r\n"))}));var desc=new window.RTCSessionDescription({type:"offer",sdp:sdp});return Promise.resolve(desc)},RTCPeerConnection.prototype.createAnswer=function(){var pc=this;if(pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==pc.signalingState&&"have-local-pranswer"!==pc.signalingState)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer in signalingState "+pc.signalingState));var sdp=SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,pc._sdpSessionVersion++);pc.usingBundle&&(sdp+="a=group:BUNDLE "+pc.transceivers.map((function(t){return t.mid})).join(" ")+"\r\n"),sdp+="a=ice-options:trickle\r\n";var mediaSectionsInOffer=SDPUtils.getMediaSections(pc._remoteDescription.sdp).length;pc.transceivers.forEach((function(transceiver,sdpMLineIndex){if(!(sdpMLineIndex+1>mediaSectionsInOffer)){if(transceiver.rejected)return"application"===transceiver.kind?"DTLS/SCTP"===transceiver.protocol?sdp+="m=application 0 DTLS/SCTP 5000\r\n":sdp+="m=application 0 "+transceiver.protocol+" webrtc-datachannel\r\n":"audio"===transceiver.kind?sdp+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===transceiver.kind&&(sdp+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(sdp+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+transceiver.mid+"\r\n");var localTrack;if(transceiver.stream)"audio"===transceiver.kind?localTrack=transceiver.stream.getAudioTracks()[0]:"video"===transceiver.kind&&(localTrack=transceiver.stream.getVideoTracks()[0]),localTrack&&edgeVersion>=15019&&"video"===transceiver.kind&&!transceiver.sendEncodingParameters[0].rtx&&(transceiver.sendEncodingParameters[0].rtx={ssrc:transceiver.sendEncodingParameters[0].ssrc+1});var commonCapabilities=getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);!commonCapabilities.codecs.filter((function(c){return"rtx"===c.name.toLowerCase()})).length&&transceiver.sendEncodingParameters[0].rtx&&delete transceiver.sendEncodingParameters[0].rtx,sdp+=writeMediaSection(transceiver,commonCapabilities,"answer",transceiver.stream,pc._dtlsRole),transceiver.rtcpParameters&&transceiver.rtcpParameters.reducedSize&&(sdp+="a=rtcp-rsize\r\n")}}));var desc=new window.RTCSessionDescription({type:"answer",sdp:sdp});return Promise.resolve(desc)},RTCPeerConnection.prototype.addIceCandidate=function(candidate){var sections,pc=this;return candidate&&void 0===candidate.sdpMLineIndex&&!candidate.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(resolve,reject){if(!pc._remoteDescription)return reject(makeError("InvalidStateError","Can not add ICE candidate without a remote description"));if(candidate&&""!==candidate.candidate){var sdpMLineIndex=candidate.sdpMLineIndex;if(candidate.sdpMid)for(var i=0;i<pc.transceivers.length;i++)if(pc.transceivers[i].mid===candidate.sdpMid){sdpMLineIndex=i;break}var transceiver=pc.transceivers[sdpMLineIndex];if(!transceiver)return reject(makeError("OperationError","Can not add ICE candidate"));if(transceiver.rejected)return resolve();var cand=Object.keys(candidate.candidate).length>0?SDPUtils.parseCandidate(candidate.candidate):{};if("tcp"===cand.protocol&&(0===cand.port||9===cand.port))return resolve();if(cand.component&&1!==cand.component)return resolve();if((0===sdpMLineIndex||sdpMLineIndex>0&&transceiver.iceTransport!==pc.transceivers[0].iceTransport)&&!maybeAddCandidate(transceiver.iceTransport,cand))return reject(makeError("OperationError","Can not add ICE candidate"));var candidateString=candidate.candidate.trim();0===candidateString.indexOf("a=")&&(candidateString=candidateString.substr(2)),(sections=SDPUtils.getMediaSections(pc._remoteDescription.sdp))[sdpMLineIndex]+="a="+(cand.type?candidateString:"end-of-candidates")+"\r\n",pc._remoteDescription.sdp=SDPUtils.getDescription(pc._remoteDescription.sdp)+sections.join("")}else for(var j=0;j<pc.transceivers.length&&(pc.transceivers[j].rejected||(pc.transceivers[j].iceTransport.addRemoteCandidate({}),(sections=SDPUtils.getMediaSections(pc._remoteDescription.sdp))[j]+="a=end-of-candidates\r\n",pc._remoteDescription.sdp=SDPUtils.getDescription(pc._remoteDescription.sdp)+sections.join(""),!pc.usingBundle));j++);resolve()}))},RTCPeerConnection.prototype.getStats=function(selector){if(selector&&selector instanceof window.MediaStreamTrack){var senderOrReceiver=null;if(this.transceivers.forEach((function(transceiver){transceiver.rtpSender&&transceiver.rtpSender.track===selector?senderOrReceiver=transceiver.rtpSender:transceiver.rtpReceiver&&transceiver.rtpReceiver.track===selector&&(senderOrReceiver=transceiver.rtpReceiver)})),!senderOrReceiver)throw makeError("InvalidAccessError","Invalid selector.");return senderOrReceiver.getStats()}var promises=[];return this.transceivers.forEach((function(transceiver){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(method){transceiver[method]&&promises.push(transceiver[method].getStats())}))})),Promise.all(promises).then((function(allStats){var results=new Map;return allStats.forEach((function(stats){stats.forEach((function(stat){results.set(stat.id,stat)}))})),results}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(ortcObjectName){var obj=window[ortcObjectName];if(obj&&obj.prototype&&obj.prototype.getStats){var nativeGetstats=obj.prototype.getStats;obj.prototype.getStats=function(){return nativeGetstats.apply(this).then((function(nativeStats){var mapStats=new Map;return Object.keys(nativeStats).forEach((function(id){var stat;nativeStats[id].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(stat=nativeStats[id]).type]||stat.type,mapStats.set(id,nativeStats[id])})),mapStats}))}}}));var methods=["createOffer","createAnswer"];return methods.forEach((function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;return"function"==typeof args[0]||"function"==typeof args[1]?nativeMethod.apply(this,[arguments[2]]).then((function(description){"function"==typeof args[0]&&args[0].apply(null,[description])}),(function(error){"function"==typeof args[1]&&args[1].apply(null,[error])})):nativeMethod.apply(this,arguments)}})),(methods=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;return"function"==typeof args[1]||"function"==typeof args[2]?nativeMethod.apply(this,arguments).then((function(){"function"==typeof args[1]&&args[1].apply(null)}),(function(error){"function"==typeof args[2]&&args[2].apply(null,[error])})):nativeMethod.apply(this,arguments)}})),["getStats"].forEach((function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;return"function"==typeof args[1]?nativeMethod.apply(this,arguments).then((function(){"function"==typeof args[1]&&args[1].apply(null)})):nativeMethod.apply(this,arguments)}})),RTCPeerConnection}},{sdp:17}],17:[function(require,module,exports){var SDPUtils={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};SDPUtils.localCName=SDPUtils.generateIdentifier(),SDPUtils.splitLines=function(blob){return blob.trim().split("\n").map((function(line){return line.trim()}))},SDPUtils.splitSections=function(blob){return blob.split("\nm=").map((function(part,index){return(index>0?"m="+part:part).trim()+"\r\n"}))},SDPUtils.getDescription=function(blob){var sections=SDPUtils.splitSections(blob);return sections&&sections[0]},SDPUtils.getMediaSections=function(blob){var sections=SDPUtils.splitSections(blob);return sections.shift(),sections},SDPUtils.matchPrefix=function(blob,prefix){return SDPUtils.splitLines(blob).filter((function(line){return 0===line.indexOf(prefix)}))},SDPUtils.parseCandidate=function(line){for(var parts,candidate={foundation:(parts=0===line.indexOf("a=candidate:")?line.substring(12).split(" "):line.substring(10).split(" "))[0],component:parseInt(parts[1],10),protocol:parts[2].toLowerCase(),priority:parseInt(parts[3],10),ip:parts[4],address:parts[4],port:parseInt(parts[5],10),type:parts[7]},i=8;i<parts.length;i+=2)switch(parts[i]){case"raddr":candidate.relatedAddress=parts[i+1];break;case"rport":candidate.relatedPort=parseInt(parts[i+1],10);break;case"tcptype":candidate.tcpType=parts[i+1];break;case"ufrag":candidate.ufrag=parts[i+1],candidate.usernameFragment=parts[i+1];break;default:candidate[parts[i]]=parts[i+1]}return candidate},SDPUtils.writeCandidate=function(candidate){var sdp=[];sdp.push(candidate.foundation),sdp.push(candidate.component),sdp.push(candidate.protocol.toUpperCase()),sdp.push(candidate.priority),sdp.push(candidate.address||candidate.ip),sdp.push(candidate.port);var type=candidate.type;return sdp.push("typ"),sdp.push(type),"host"!==type&&candidate.relatedAddress&&candidate.relatedPort&&(sdp.push("raddr"),sdp.push(candidate.relatedAddress),sdp.push("rport"),sdp.push(candidate.relatedPort)),candidate.tcpType&&"tcp"===candidate.protocol.toLowerCase()&&(sdp.push("tcptype"),sdp.push(candidate.tcpType)),(candidate.usernameFragment||candidate.ufrag)&&(sdp.push("ufrag"),sdp.push(candidate.usernameFragment||candidate.ufrag)),"candidate:"+sdp.join(" ")},SDPUtils.parseIceOptions=function(line){return line.substr(14).split(" ")},SDPUtils.parseRtpMap=function(line){var parts=line.substr(9).split(" "),parsed={payloadType:parseInt(parts.shift(),10)};return parts=parts[0].split("/"),parsed.name=parts[0],parsed.clockRate=parseInt(parts[1],10),parsed.channels=3===parts.length?parseInt(parts[2],10):1,parsed.numChannels=parsed.channels,parsed},SDPUtils.writeRtpMap=function(codec){var pt=codec.payloadType;void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType);var channels=codec.channels||codec.numChannels||1;return"a=rtpmap:"+pt+" "+codec.name+"/"+codec.clockRate+(1!==channels?"/"+channels:"")+"\r\n"},SDPUtils.parseExtmap=function(line){var parts=line.substr(9).split(" ");return{id:parseInt(parts[0],10),direction:parts[0].indexOf("/")>0?parts[0].split("/")[1]:"sendrecv",uri:parts[1]}},SDPUtils.writeExtmap=function(headerExtension){return"a=extmap:"+(headerExtension.id||headerExtension.preferredId)+(headerExtension.direction&&"sendrecv"!==headerExtension.direction?"/"+headerExtension.direction:"")+" "+headerExtension.uri+"\r\n"},SDPUtils.parseFmtp=function(line){for(var kv,parsed={},parts=line.substr(line.indexOf(" ")+1).split(";"),j=0;j<parts.length;j++)parsed[(kv=parts[j].trim().split("="))[0].trim()]=kv[1];return parsed},SDPUtils.writeFmtp=function(codec){var line="",pt=codec.payloadType;if(void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.parameters&&Object.keys(codec.parameters).length){var params=[];Object.keys(codec.parameters).forEach((function(param){codec.parameters[param]?params.push(param+"="+codec.parameters[param]):params.push(param)})),line+="a=fmtp:"+pt+" "+params.join(";")+"\r\n"}return line},SDPUtils.parseRtcpFb=function(line){var parts=line.substr(line.indexOf(" ")+1).split(" ");return{type:parts.shift(),parameter:parts.join(" ")}},SDPUtils.writeRtcpFb=function(codec){var lines="",pt=codec.payloadType;return void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.rtcpFeedback&&codec.rtcpFeedback.length&&codec.rtcpFeedback.forEach((function(fb){lines+="a=rtcp-fb:"+pt+" "+fb.type+(fb.parameter&&fb.parameter.length?" "+fb.parameter:"")+"\r\n"})),lines},SDPUtils.parseSsrcMedia=function(line){var sp=line.indexOf(" "),parts={ssrc:parseInt(line.substr(7,sp-7),10)},colon=line.indexOf(":",sp);return colon>-1?(parts.attribute=line.substr(sp+1,colon-sp-1),parts.value=line.substr(colon+1)):parts.attribute=line.substr(sp+1),parts},SDPUtils.parseSsrcGroup=function(line){var parts=line.substr(13).split(" ");return{semantics:parts.shift(),ssrcs:parts.map((function(ssrc){return parseInt(ssrc,10)}))}},SDPUtils.getMid=function(mediaSection){var mid=SDPUtils.matchPrefix(mediaSection,"a=mid:")[0];if(mid)return mid.substr(6)},SDPUtils.parseFingerprint=function(line){var parts=line.substr(14).split(" ");return{algorithm:parts[0].toLowerCase(),value:parts[1]}},SDPUtils.getDtlsParameters=function(mediaSection,sessionpart){return{role:"auto",fingerprints:SDPUtils.matchPrefix(mediaSection+sessionpart,"a=fingerprint:").map(SDPUtils.parseFingerprint)}},SDPUtils.writeDtlsParameters=function(params,setupType){var sdp="a=setup:"+setupType+"\r\n";return params.fingerprints.forEach((function(fp){sdp+="a=fingerprint:"+fp.algorithm+" "+fp.value+"\r\n"})),sdp},SDPUtils.getIceParameters=function(mediaSection,sessionpart){var lines=SDPUtils.splitLines(mediaSection);return{usernameFragment:(lines=lines.concat(SDPUtils.splitLines(sessionpart))).filter((function(line){return 0===line.indexOf("a=ice-ufrag:")}))[0].substr(12),password:lines.filter((function(line){return 0===line.indexOf("a=ice-pwd:")}))[0].substr(10)}},SDPUtils.writeIceParameters=function(params){return"a=ice-ufrag:"+params.usernameFragment+"\r\na=ice-pwd:"+params.password+"\r\n"},SDPUtils.parseRtpParameters=function(mediaSection){for(var description={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},mline=SDPUtils.splitLines(mediaSection)[0].split(" "),i=3;i<mline.length;i++){var pt=mline[i],rtpmapline=SDPUtils.matchPrefix(mediaSection,"a=rtpmap:"+pt+" ")[0];if(rtpmapline){var codec=SDPUtils.parseRtpMap(rtpmapline),fmtps=SDPUtils.matchPrefix(mediaSection,"a=fmtp:"+pt+" ");switch(codec.parameters=fmtps.length?SDPUtils.parseFmtp(fmtps[0]):{},codec.rtcpFeedback=SDPUtils.matchPrefix(mediaSection,"a=rtcp-fb:"+pt+" ").map(SDPUtils.parseRtcpFb),description.codecs.push(codec),codec.name.toUpperCase()){case"RED":case"ULPFEC":description.fecMechanisms.push(codec.name.toUpperCase())}}}return SDPUtils.matchPrefix(mediaSection,"a=extmap:").forEach((function(line){description.headerExtensions.push(SDPUtils.parseExtmap(line))})),description},SDPUtils.writeRtpDescription=function(kind,caps){var sdp="";sdp+="m="+kind+" ",sdp+=caps.codecs.length>0?"9":"0",sdp+=" UDP/TLS/RTP/SAVPF ",sdp+=caps.codecs.map((function(codec){return void 0!==codec.preferredPayloadType?codec.preferredPayloadType:codec.payloadType})).join(" ")+"\r\n",sdp+="c=IN IP4 0.0.0.0\r\n",sdp+="a=rtcp:9 IN IP4 0.0.0.0\r\n",caps.codecs.forEach((function(codec){sdp+=SDPUtils.writeRtpMap(codec),sdp+=SDPUtils.writeFmtp(codec),sdp+=SDPUtils.writeRtcpFb(codec)}));var maxptime=0;return caps.codecs.forEach((function(codec){codec.maxptime>maxptime&&(maxptime=codec.maxptime)})),maxptime>0&&(sdp+="a=maxptime:"+maxptime+"\r\n"),sdp+="a=rtcp-mux\r\n",caps.headerExtensions&&caps.headerExtensions.forEach((function(extension){sdp+=SDPUtils.writeExtmap(extension)})),sdp},SDPUtils.parseRtpEncodingParameters=function(mediaSection){var secondarySsrc,encodingParameters=[],description=SDPUtils.parseRtpParameters(mediaSection),hasRed=-1!==description.fecMechanisms.indexOf("RED"),hasUlpfec=-1!==description.fecMechanisms.indexOf("ULPFEC"),ssrcs=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(parts){return"cname"===parts.attribute})),primarySsrc=ssrcs.length>0&&ssrcs[0].ssrc,flows=SDPUtils.matchPrefix(mediaSection,"a=ssrc-group:FID").map((function(line){return line.substr(17).split(" ").map((function(part){return parseInt(part,10)}))}));flows.length>0&&flows[0].length>1&&flows[0][0]===primarySsrc&&(secondarySsrc=flows[0][1]),description.codecs.forEach((function(codec){if("RTX"===codec.name.toUpperCase()&&codec.parameters.apt){var encParam={ssrc:primarySsrc,codecPayloadType:parseInt(codec.parameters.apt,10)};primarySsrc&&secondarySsrc&&(encParam.rtx={ssrc:secondarySsrc}),encodingParameters.push(encParam),hasRed&&((encParam=JSON.parse(JSON.stringify(encParam))).fec={ssrc:primarySsrc,mechanism:hasUlpfec?"red+ulpfec":"red"},encodingParameters.push(encParam))}})),0===encodingParameters.length&&primarySsrc&&encodingParameters.push({ssrc:primarySsrc});var bandwidth=SDPUtils.matchPrefix(mediaSection,"b=");return bandwidth.length&&(bandwidth=0===bandwidth[0].indexOf("b=TIAS:")?parseInt(bandwidth[0].substr(7),10):0===bandwidth[0].indexOf("b=AS:")?1e3*parseInt(bandwidth[0].substr(5),10)*.95-16e3:void 0,encodingParameters.forEach((function(params){params.maxBitrate=bandwidth}))),encodingParameters},SDPUtils.parseRtcpParameters=function(mediaSection){var rtcpParameters={},remoteSsrc=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(obj){return"cname"===obj.attribute}))[0];remoteSsrc&&(rtcpParameters.cname=remoteSsrc.value,rtcpParameters.ssrc=remoteSsrc.ssrc);var rsize=SDPUtils.matchPrefix(mediaSection,"a=rtcp-rsize");rtcpParameters.reducedSize=rsize.length>0,rtcpParameters.compound=0===rsize.length;var mux=SDPUtils.matchPrefix(mediaSection,"a=rtcp-mux");return rtcpParameters.mux=mux.length>0,rtcpParameters},SDPUtils.parseMsid=function(mediaSection){var parts,spec=SDPUtils.matchPrefix(mediaSection,"a=msid:");if(1===spec.length)return{stream:(parts=spec[0].substr(7).split(" "))[0],track:parts[1]};var planB=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(msidParts){return"msid"===msidParts.attribute}));return planB.length>0?{stream:(parts=planB[0].value.split(" "))[0],track:parts[1]}:void 0},SDPUtils.parseSctpDescription=function(mediaSection){var maxMessageSize,mline=SDPUtils.parseMLine(mediaSection),maxSizeLine=SDPUtils.matchPrefix(mediaSection,"a=max-message-size:");maxSizeLine.length>0&&(maxMessageSize=parseInt(maxSizeLine[0].substr(19),10)),isNaN(maxMessageSize)&&(maxMessageSize=65536);var sctpPort=SDPUtils.matchPrefix(mediaSection,"a=sctp-port:");if(sctpPort.length>0)return{port:parseInt(sctpPort[0].substr(12),10),protocol:mline.fmt,maxMessageSize:maxMessageSize};if(SDPUtils.matchPrefix(mediaSection,"a=sctpmap:").length>0){var parts=SDPUtils.matchPrefix(mediaSection,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(parts[0],10),protocol:parts[1],maxMessageSize:maxMessageSize}}},SDPUtils.writeSctpDescription=function(media,sctp){var output=[];return output="DTLS/SCTP"!==media.protocol?["m="+media.kind+" 9 "+media.protocol+" "+sctp.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+sctp.port+"\r\n"]:["m="+media.kind+" 9 "+media.protocol+" "+sctp.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+sctp.port+" "+sctp.protocol+" 65535\r\n"],void 0!==sctp.maxMessageSize&&output.push("a=max-message-size:"+sctp.maxMessageSize+"\r\n"),output.join("")},SDPUtils.generateSessionId=function(){return Math.random().toString().substr(2,21)},SDPUtils.writeSessionBoilerplate=function(sessId,sessVer,sessUser){var version=void 0!==sessVer?sessVer:2;return"v=0\r\no="+(sessUser||"thisisadapterortc")+" "+(sessId||SDPUtils.generateSessionId())+" "+version+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},SDPUtils.writeMediaSection=function(transceiver,caps,type,stream){var sdp=SDPUtils.writeRtpDescription(transceiver.kind,caps);if(sdp+=SDPUtils.writeIceParameters(transceiver.iceGatherer.getLocalParameters()),sdp+=SDPUtils.writeDtlsParameters(transceiver.dtlsTransport.getLocalParameters(),"offer"===type?"actpass":"active"),sdp+="a=mid:"+transceiver.mid+"\r\n",transceiver.direction?sdp+="a="+transceiver.direction+"\r\n":transceiver.rtpSender&&transceiver.rtpReceiver?sdp+="a=sendrecv\r\n":transceiver.rtpSender?sdp+="a=sendonly\r\n":transceiver.rtpReceiver?sdp+="a=recvonly\r\n":sdp+="a=inactive\r\n",transceiver.rtpSender){var msid="msid:"+stream.id+" "+transceiver.rtpSender.track.id+"\r\n";sdp+="a="+msid,sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" "+msid,transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" "+msid,sdp+="a=ssrc-group:FID "+transceiver.sendEncodingParameters[0].ssrc+" "+transceiver.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" cname:"+SDPUtils.localCName+"\r\n",transceiver.rtpSender&&transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" cname:"+SDPUtils.localCName+"\r\n"),sdp},SDPUtils.getDirection=function(mediaSection,sessionpart){for(var lines=SDPUtils.splitLines(mediaSection),i=0;i<lines.length;i++)switch(lines[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return lines[i].substr(2)}return sessionpart?SDPUtils.getDirection(sessionpart):"sendrecv"},SDPUtils.getKind=function(mediaSection){return SDPUtils.splitLines(mediaSection)[0].split(" ")[0].substr(2)},SDPUtils.isRejected=function(mediaSection){return"0"===mediaSection.split(" ",2)[1]},SDPUtils.parseMLine=function(mediaSection){var parts=SDPUtils.splitLines(mediaSection)[0].substr(2).split(" ");return{kind:parts[0],port:parseInt(parts[1],10),protocol:parts[2],fmt:parts.slice(3).join(" ")}},SDPUtils.parseOLine=function(mediaSection){var parts=SDPUtils.matchPrefix(mediaSection,"o=")[0].substr(2).split(" ");return{username:parts[0],sessionId:parts[1],sessionVersion:parseInt(parts[2],10),netType:parts[3],addressType:parts[4],address:parts[5]}},SDPUtils.isValidSDP=function(blob){if("string"!=typeof blob||0===blob.length)return!1;for(var lines=SDPUtils.splitLines(blob),i=0;i<lines.length;i++)if(lines[i].length<2||"="!==lines[i].charAt(1))return!1;return!0},"object"===_typeof2(module)&&(module.exports=SDPUtils)},{}]},{},[1])(1)}));
/**
 * Enhance a textarea with auto growing rows to fit the content.
 *
 * @module     core/auto_rows
 * @class      auto_rows
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("core/auto_rows",["jquery"],(function($){var SELECTORS_ELEMENT="[data-auto-rows]",EVENTS={ROW_CHANGE:"autorows:rowchange"},changeListener=function(e){var element=$(e.target),minRows=element.data("min-rows"),currentRows=element.attr("rows");void 0===minRows&&element.data("min-rows",currentRows),element.attr("rows",1);var rows=function(element){var currentRows=element.attr("rows"),minRows=element.data("min-rows"),maxRows=element.attr("data-max-rows"),height=element.height(),padding=element.innerHeight()-height,rows=(element[0].scrollHeight-padding)/(height/currentRows);return element.css("height",""),rows<minRows?minRows:maxRows&&rows>=maxRows?maxRows:rows}(element);element.attr("rows",rows),rows!=currentRows&&element.trigger(EVENTS.ROW_CHANGE)};return{init:function(root){$(root).data("auto-rows")?$(root).on("input propertychange",changeListener.bind(this)):$(root).on("input propertychange",SELECTORS_ELEMENT,changeListener.bind(this))},events:EVENTS}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core/drawer",["exports","jquery","core/pubsub","core/drawer_events"],(function(_exports,_jquery,PubSub,_drawer_events){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Controls the drawer.
   *
   * @module     core/drawer
   * @copyright  2019 Jun Pataleta <jun@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),PubSub=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(PubSub),_drawer_events=_interopRequireDefault(_drawer_events);var show=function(root){root.removeClass("hidden"),root.attr("aria-expanded",!0),root.removeAttr("aria-hidden"),root.focus(),PubSub.publish(_drawer_events.default.DRAWER_SHOWN,root)},hide=function(root){root.addClass("hidden"),root.attr("aria-expanded",!1),root.attr("aria-hidden",!0),PubSub.publish(_drawer_events.default.DRAWER_HIDDEN,root)},isVisible=function(root){return!root.hasClass("hidden")},toggle=function(root){isVisible(root)?hide(root):show(root)},_default={hide:hide,show:show,isVisible:isVisible,toggle:toggle,registerToggles:function(root,toggleElements){var openTrigger=null;toggleElements.attr("aria-expanded",isVisible(root)),toggleElements.on("click",(function(e){e.preventDefault();var wasVisible=isVisible(root);toggle(root),toggleElements.attr("aria-expanded",!wasVisible),wasVisible?openTrigger&&(openTrigger.focus(),openTrigger=null):openTrigger=toggleElements.filter((function(index,element){return element==e.target||element.contains(e.target)}))}))},getDrawerRoot:function(contentRoot){return(contentRoot=(0,_jquery.default)(contentRoot)).closest('[data-region="right-hand-drawer"]')}};return _exports.default=_default,_exports.default}));
/**
 * Show an add block modal instead of doing it on a separate page.
 *
 * @module     core/addblockmodal
 * @class      addblockmodal
 * @package    core
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/addblockmodal",["jquery","core/modal_factory","core/templates","core/str","core/notification"],(function($,ModalFactory,Templates,Str,Notification){return{init:function(context){var addblocklink=$("[data-key=addblock]"),titlerequests=context.blocks.map((function(blockName){return{key:"pluginname",component:"block_"+blockName}})),bodyPromise=Str.get_strings(titlerequests).then((function(titles){return titles.map((function(title,index){return{name:context.blocks[index],title:title}}))})).then((function(blocks){return context.blocks=blocks,Templates.render("core/add_block_body",context)})).fail(Notification.exception),titlePromise=Str.get_string("addblock").fail(Notification.exception);ModalFactory.create({title:titlePromise,body:bodyPromise,type:"CANCEL"},addblocklink)}}}));
/**
 * Standard Ajax wrapper for Moodle. It calls the central Ajax script,
 * which can call any existing webservice using the current session.
 * In addition, it can batch multiple requests and return multiple responses.
 *
 * @module     core/ajax
 * @class      ajax
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/ajax",["jquery","core/config","core/log","core/url"],(function($,config,Log,URL){var unloading=!1,requestSuccess=function(responses){var request,response,nosessionupdate,exception=null,i=0;if(responses.error)for(;i<this.length;i++)(request=this[i]).deferred.reject(responses);else{for(i=0;i<this.length;i++){if(request=this[i],void 0===(response=responses[i])){exception=new Error("missing response");break}if(!1!==response.error){exception=response.exception,nosessionupdate=this[i].nosessionupdate;break}request.deferred.resolve(response.data)}null!==exception&&("servicerequireslogin"!==exception.errorcode||nosessionupdate?this.forEach((function(request){request.deferred.reject(exception)})):window.location=URL.relativeUrl("/login/index.php"))}},requestFail=function(jqXHR,textStatus,exception){var i=0;for(i=0;i<this.length;i++){var request=this[i];unloading?(Log.error("Page unloaded."),Log.error(exception)):request.deferred.reject(exception)}};return{call:function(requests,async,loginrequired,nosessionupdate,timeout,cachekey){$(window).bind("beforeunload",(function(){unloading=!0}));var i,ajaxRequestData=[],promises=[],methodInfo=[],requestInfo="";for(void 0===loginrequired&&(loginrequired=!0),void 0===async&&(async=!0),void 0===timeout&&(timeout=0),void 0===cachekey||(cachekey=parseInt(cachekey))<=0?cachekey=null:cachekey||(cachekey=null),void 0===nosessionupdate&&(nosessionupdate=!1),i=0;i<requests.length;i++){var request=requests[i];ajaxRequestData.push({index:i,methodname:request.methodname,args:request.args}),request.nosessionupdate=nosessionupdate,request.deferred=$.Deferred(),promises.push(request.deferred.promise()),void 0!==request.done&&request.deferred.done(request.done),void 0!==request.fail&&request.deferred.fail(request.fail),request.index=i,methodInfo.push(request.methodname)}requestInfo=methodInfo.length<=5?methodInfo.sort().join():methodInfo.length+"-method-calls",ajaxRequestData=JSON.stringify(ajaxRequestData);var settings={type:"POST",context:requests,dataType:"json",processData:!1,async:async,contentType:"application/json",timeout:timeout},script="service.php",url=config.wwwroot+"/lib/ajax/";if(loginrequired?url+=script+"?sesskey="+config.sesskey+"&info="+requestInfo:(url+=(script="service-nologin.php")+"?info="+requestInfo,cachekey&&(url+="&cachekey="+cachekey,settings.type="GET")),nosessionupdate&&(url+="&nosessionupdate=true"),"POST"===settings.type)settings.data=ajaxRequestData;else{var urlUseGet=url+"&args="+encodeURIComponent(ajaxRequestData);urlUseGet.length>2e3?(settings.type="POST",settings.data=ajaxRequestData):url=urlUseGet}return async?$.ajax(url,settings).done(requestSuccess).fail(requestFail):(settings.success=requestSuccess,settings.error=requestFail,$.ajax(url,settings)),promises}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core/modal_save_cancel",["exports","core/modal"],(function(_exports,_modal){var obj;function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=function(_Modal){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(_default,_Modal);var Constructor,protoProps,staticProps,_super=_createSuper(_default);function _default(root){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_default),(_this=_super.call(this,root)).getFooter().find(_this.getActionSelector("save")).length||Notification.exception({message:"No save button found"}),_this.getFooter().find(_this.getActionSelector("cancel")).length||Notification.exception({message:"No cancel button found"}),_this}return Constructor=_default,(protoProps=[{key:"registerEventListeners",value:function(){_get(_getPrototypeOf(_default.prototype),"registerEventListeners",this).call(this),this.registerCloseOnSave(),this.registerCloseOnCancel()}},{key:"setFooter",value:function(){Notification.exception({message:"Can not change the footer of a save cancel modal"})}},{key:"setSaveButtonText",value:function(value){return this.setButtonText("save",value)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}((_modal=(obj=_modal)&&obj.__esModule?obj:{default:obj}).default);return _exports.default=_default,_exports.default}));
/**
 * Fetch and render dates from timestamps.
 *
 * @module     core/user_date
 * @package    core
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/user_date",["jquery","core/ajax","core/sessionstorage","core/config"],(function($,Ajax,Storage,Config){var promisesCache={},getKey=function(request){return"core_user_date/"+$("html").attr("lang").replace(/-/g,"_")+"/"+Config.usertimezone+"/"+request.timestamp+"/"+request.format},loadDatesFromServer=function(dates){var args=dates.map((function(data){var fixDay=data.hasOwnProperty("fixday")?data.fixday:1,fixHour=data.hasOwnProperty("fixhour")?data.fixhour:1;return{timestamp:data.timestamp,format:data.format,type:data.type||null,fixday:fixDay,fixhour:fixHour}})),request={methodname:"core_get_user_dates",args:{contextid:Config.contextid,timestamps:args}};return Ajax.call([request],!0,!0)[0].then((function(results){results.dates.forEach((function(value,index){var date=dates[index];!function(key,value){Storage.set(key,value)}(getKey(date),value),date.deferred.resolve(value)}))})).catch((function(ex){dates.forEach((function(date){date.deferred.reject(ex)}))}))};return{get:function(requests){var ajaxRequests=[],promises=[];return requests.forEach((function(request){var key=getKey(request);if(function(key){return void 0!==promisesCache[key]}(key))promises.push(function(key){return promisesCache[key]}(key));else{var deferred=$.Deferred(),cached=function(key){return Storage.get(key)}(key);cached?deferred.resolve(cached):(request.deferred=deferred,ajaxRequests.push(request)),function(key,promise){promisesCache[key]=promise}(key,deferred.promise()),promises.push(deferred.promise())}})),ajaxRequests.length&&loadDatesFromServer(ajaxRequests),$.when.apply($,promises).then((function(){return 1===arguments.length?[arguments[0]]:Array.apply(null,arguments)}))},getUserMidnightForTimestamp:function(timestamp,todayMidnight){var future=timestamp>todayMidnight,diffSeconds=Math.abs(timestamp-todayMidnight),diffDaysInSeconds=86400*(future?Math.floor(diffSeconds/86400):Math.ceil(diffSeconds/86400));return future?todayMidnight+diffDaysInSeconds:todayMidnight-diffDaysInSeconds}}}));
/*
 * JavaScript to handle drag operations, including automatic scrolling.
 *
 * Note: this module is defined statically. It is a singleton. You
 * can only have one use of it active at any time. However, you
 * can only drag one thing at a time, this is not a problem in practice.
 *
 * @module     core/dragdrop
 * @class      dragdrop
 * @package    core
 * @copyright  2016 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.6
 */
define("core/dragdrop",["jquery","core/autoscroll"],(function($,autoScroll){var dragdrop={eventCaptureOptions:{passive:!1,capture:!0},dragProxy:null,onMove:null,onDrop:null,initialPosition:null,initialX:null,initialY:null,touching:null,prepare:function(event){if(event.preventDefault(),"touchstart"===event.type?null===dragdrop.touching&&event.changedTouches.length>0:1===event.which){var details=dragdrop.getEventXY(event);return details.start=!0,details}return{start:!1}},start:function(event,dragProxy,onMove,onDrop){var xy=dragdrop.getEventXY(event);switch(dragdrop.initialX=xy.x,dragdrop.initialY=xy.y,dragdrop.initialPosition=dragProxy.offset(),dragdrop.dragProxy=dragProxy,dragdrop.onMove=onMove,dragdrop.onDrop=onDrop,event.type){case"mousedown":dragdrop.addEventSpecial("mousemove",dragdrop.mouseMove),dragdrop.addEventSpecial("mouseup",dragdrop.mouseUp);break;case"touchstart":dragdrop.addEventSpecial("touchend",dragdrop.touchEnd),dragdrop.addEventSpecial("touchcancel",dragdrop.touchEnd),dragdrop.addEventSpecial("touchmove",dragdrop.touchMove),dragdrop.touching=event.changedTouches[0].identifier;break;default:throw new Error("Unexpected event type: "+event.type)}autoScroll.start(dragdrop.scroll)},addEventSpecial:function(event,handler){try{window.addEventListener(event,handler,dragdrop.eventCaptureOptions)}catch(ex){dragdrop.eventCaptureOptions=!0,window.addEventListener(event,handler,dragdrop.eventCaptureOptions)}},getEventXY:function(event){switch(event.type){case"touchstart":return{x:event.changedTouches[0].pageX,y:event.changedTouches[0].pageY};case"mousedown":return{x:event.pageX,y:event.pageY};default:throw new Error("Unexpected event type: "+event.type)}},touchMove:function(e){e.preventDefault();for(var i=0;i<e.changedTouches.length;i++)e.changedTouches[i].identifier===dragdrop.touching&&dragdrop.handleMove(e.changedTouches[i].pageX,e.changedTouches[i].pageY)},mouseMove:function(e){dragdrop.handleMove(e.pageX,e.pageY)},handleMove:function(pageX,pageY){var current=dragdrop.dragProxy.offset(),topOffset=current.top-parseInt(dragdrop.dragProxy.css("top")),leftOffset=current.left-parseInt(dragdrop.dragProxy.css("left")),maxY=$(document).height()-dragdrop.dragProxy.outerHeight()-topOffset,maxX=$(document).width()-dragdrop.dragProxy.outerWidth()-leftOffset,minY=-topOffset,minX=-leftOffset,initial=dragdrop.initialPosition,position={top:Math.max(minY,Math.min(maxY,initial.top+(pageY-dragdrop.initialY)-topOffset)),left:Math.max(minX,Math.min(maxX,initial.left+(pageX-dragdrop.initialX)-leftOffset))};dragdrop.dragProxy.css(position),dragdrop.onMove(pageX,pageY,dragdrop.dragProxy)},touchEnd:function(e){e.preventDefault();for(var i=0;i<e.changedTouches.length;i++)e.changedTouches[i].identifier===dragdrop.touching&&dragdrop.handleEnd(e.changedTouches[i].pageX,e.changedTouches[i].pageY)},mouseUp:function(e){dragdrop.handleEnd(e.pageX,e.pageY)},handleEnd:function(pageX,pageY){null!==dragdrop.touching?(window.removeEventListener("touchend",dragdrop.touchEnd,dragdrop.eventCaptureOptions),window.removeEventListener("touchcancel",dragdrop.touchEnd,dragdrop.eventCaptureOptions),window.removeEventListener("touchmove",dragdrop.touchMove,dragdrop.eventCaptureOptions),dragdrop.touching=null):(window.removeEventListener("mousemove",dragdrop.mouseMove,dragdrop.eventCaptureOptions),window.removeEventListener("mouseup",dragdrop.mouseUp,dragdrop.eventCaptureOptions)),autoScroll.stop(),dragdrop.onDrop(pageX,pageY,dragdrop.dragProxy)},scroll:function(offset){var maxY=$(document).height()-dragdrop.dragProxy.outerHeight(),currentPosition=dragdrop.dragProxy.offset();currentPosition.top=Math.min(maxY,currentPosition.top+offset),dragdrop.dragProxy.css(currentPosition)}};return{prepare:dragdrop.prepare,start:dragdrop.start}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * A javascript module to handle list items drag and drop
 *
 * Example of usage:
 *
 * Create a list (for example <ul> or <tbody>) where each draggable element has a drag handle.
 * The best practice is to use the template core/drag_handle:
 * $OUTPUT->render_from_template('core/drag_handle', ['movetitle' => get_string('movecontent', 'moodle', ELEMENTNAME)]);
 *
 * Attach this JS module to this list:
 *
 * Space between define and ( critical in comment but not allowed in code in order to function
 * correctly with Moodle's requirejs.php
 *
 * define (['jquery', 'core/sortable_list'], function($, SortableList) {
 *     var list = new SortableList('ul.my-awesome-list'); // source list (usually <ul> or <tbody>) - selector or element
 *
 *     // Listen to the events when element is dragged.
 *     $('ul.my-awesome-list > *').on(SortableList.EVENTS.DROP, function(evt, info) {
 *         console.log(info);
 *     });
 *
 *     // Advanced usage. Overwrite methods getElementName, getDestinationName, moveDialogueTitle, for example:
 *     list.getElementName = function(element) {
 *         return $.Deferred().resolve(element.attr('data-name'));
 *     }
 * }
 *
 * More details: https://docs.moodle.org/dev/Sortable_list
 *
 * For the full list of possible parameters see var defaultParameters below.
 *
 * The following jQuery events are fired:
 * - SortableList.EVENTS.DRAGSTART : when user started dragging a list element
 * - SortableList.EVENTS.DRAG : when user dragged a list element to a new position
 * - SortableList.EVENTS.DROP : when user dropped a list element
 * - SortableList.EVENTS.DROPEND : when user finished dragging - either fired right after dropping or
 *                          if "Esc" was pressed during dragging
 *
 * @module     core/sortable_list
 * @class      sortable_list
 * @package    core
 * @copyright  2018 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core/sortable_list",["jquery","core/log","core/autoscroll","core/str","core/modal_factory","core/modal_events","core/notification"],(function($,log,autoScroll,str,ModalFactory,ModalEvents,Notification){var defaultParameters={targetListSelector:null,moveHandlerSelector:"[data-drag-type=move]",isHorizontal:!1,autoScroll:!0},CSS_keyboardDragClass="dragdrop-keyboard-drag",CSS_isDraggedClass="sortable-list-is-dragged",CSS_currentPositionClass="sortable-list-current-position",CSS_targetListClass="sortable-list-target",CSS_overElementClass="sortable-list-over-element",registerNotPassiveListeners=function(eventname){return{setup:function(x,ns,handle){return!!ns.includes("notPassive")&&(this.addEventListener(eventname,handle,{passive:!1}),!0)}}};(function(){var options,passivesupported=!1;try{options=Object.defineProperty({},"passive",{get:function(){passivesupported=!0}}),document.addEventListener("testpassiveeventoptions",options,options),document.removeEventListener("testpassiveeventoptions",options,options)}catch(err){passivesupported=!1}return passivesupported})&&($.event.special.touchstart=registerNotPassiveListeners("touchstart"),$.event.special.touchmove=registerNotPassiveListeners("touchmove"),$.event.special.touchend=registerNotPassiveListeners("touchend"));var SortableList=function(root,config){this.info=null,this.proxy=null,this.proxyDelta=null,this.dragCounter=0,this.lastEvent=null,this.config=$.extend({},defaultParameters,config||{}),this.config.listSelector=root,this.config.targetListSelector||(this.config.targetListSelector=root),"object"===_typeof(this.config.listSelector)?$(this.config.listSelector).on("mousedown touchstart.notPassive",$.proxy(this.dragStartHandler,this)):$("body").on("mousedown touchstart.notPassive",this.config.listSelector,$.proxy(this.dragStartHandler,this)),null!==this.config.moveHandlerSelector&&$("body").on("click keypress",this.config.moveHandlerSelector,$.proxy(this.clickHandler,this))};return SortableList.EVENTS={DRAGSTART:"sortablelist-dragstart",DRAG:"sortablelist-drag",DROP:"sortablelist-drop",DRAGEND:"sortablelist-dragend"},SortableList.prototype.resetDraggedClasses=function(){var classes=[CSS_isDraggedClass,CSS_currentPositionClass,CSS_overElementClass,CSS_targetListClass];for(var i in classes)$("."+classes[i]).removeClass(classes[i]);this.proxy&&(this.proxy.remove(),this.proxy=$())},SortableList.prototype.calculatePositionOnPage=function(evt){if(evt.originalEvent&&evt.originalEvent.touches&&void 0!==evt.originalEvent.touches[0]){var touch=evt.originalEvent.touches[0];evt.pageX=touch.pageX,evt.pageY=touch.pageY}void 0===evt.pageX?(evt.pageX=this.lastEvent.pageX,evt.pageY=this.lastEvent.pageY):this.lastEvent=evt,void 0===evt.clientX&&(evt.clientX=Math.round(evt.pageX-$(window).scrollLeft()),evt.clientY=Math.round(evt.pageY-$(window).scrollTop()))},SortableList.prototype.dragStartHandler=function(evt){if(null!==this.info){if("click"===this.info.type||"touchend"===this.info.type)return;this.moveElement(this.info.sourceList,this.info.sourceNextElement),this.finishDragging()}if("mousedown"!==evt.type||1===evt.which){this.calculatePositionOnPage(evt);var movedElement=$(evt.target).closest($(evt.currentTarget).children());if(movedElement.length&&(null===this.config.moveHandlerSelector||$(evt.target).closest(this.config.moveHandlerSelector,movedElement).length)){evt.stopPropagation(),evt.preventDefault(),this.dragCounter++,this.info={element:movedElement,sourceNextElement:movedElement.next(),sourceList:movedElement.parent(),targetNextElement:movedElement.next(),targetList:movedElement.parent(),type:evt.type,dropped:!1,startX:evt.pageX,startY:evt.pageY,startTime:(new Date).getTime()},$(this.config.targetListSelector).addClass(CSS_targetListClass);var offset=movedElement.offset();movedElement.addClass(CSS_currentPositionClass),this.proxyDelta={x:offset.left-evt.pageX,y:offset.top-evt.pageY},this.proxy=$();var thisDragCounter=this.dragCounter;setTimeout($.proxy((function(){null!==this.info&&"click"!==this.info.type&&"keypress"!==this.info.type&&this.dragCounter===thisDragCounter&&this.createProxy()}),this),500),$(window).on("mousemove touchmove.notPassive mouseup touchend.notPassive",$.proxy(this.dragHandler,this)),$(window).on("keypress",$.proxy(this.dragcancelHandler,this)),this.config.autoScroll&&autoScroll.start((function(){$(window).trigger("mousemove")})),this.executeCallback(SortableList.EVENTS.DRAGSTART)}}},SortableList.prototype.createProxy=function(){this.proxy=this.info.element.clone(),this.info.sourceList.append(this.proxy),this.proxy.removeAttr("id").removeClass(CSS_currentPositionClass).addClass(CSS_isDraggedClass).css({position:"fixed"}),this.proxy.offset({top:this.proxyDelta.y+this.lastEvent.pageY,left:this.proxyDelta.x+this.lastEvent.pageX})},SortableList.prototype.clickHandler=function(evt){if(("keypress"!==evt.type||13===evt.originalEvent.keyCode||32===evt.originalEvent.keyCode)&&null===this.info){var clickedElement=$(evt.target).closest(this.config.moveHandlerSelector),sourceList=clickedElement.closest(this.config.listSelector),movedElement=clickedElement.closest(sourceList.children());movedElement.length&&(evt.preventDefault(),evt.stopPropagation(),this.dragCounter++,this.info={element:movedElement,sourceNextElement:movedElement.next(),sourceList:sourceList,targetNextElement:movedElement.next(),targetList:sourceList,dropped:!1,type:evt.type,startTime:(new Date).getTime()},this.executeCallback(SortableList.EVENTS.DRAGSTART),this.displayMoveDialogue(clickedElement))}},SortableList.prototype.getPositionInNode=function(pageX,pageY,element){if(!element.length)return null;var rect=element[0].getBoundingClientRect(),y=pageY-(rect.top+window.scrollY),x=pageX-(rect.left+window.scrollX);return x>=-0&&x<=rect.width+0&&y>=-0&&y<=rect.height+0?{x:x,y:y,xRatio:rect.width?x/rect.width:0,yRatio:rect.height?y/rect.height:0}:null},SortableList.prototype.isListHorizontal=function(element){var isHorizontal=this.config.isHorizontal;return!0===isHorizontal||!1===isHorizontal?isHorizontal:isHorizontal(element)},SortableList.prototype.dragHandler=function(evt){evt.preventDefault(),evt.stopPropagation(),this.calculatePositionOnPage(evt),this.proxy.offset({top:-1e3,left:-1e3});var element=$(document.elementFromPoint(evt.clientX,evt.clientY)),mainElement=this.info.element[0],isNotSelf=function(){return this!==mainElement},current=element.closest("."+CSS_targetListClass+" > :not(."+CSS_isDraggedClass+")").filter(isNotSelf),currentList=element.closest("."+CSS_targetListClass),proxy=this.proxy,isNotProxy=function(){return!proxy||!proxy.length||this!==proxy[0]};if($("."+CSS_overElementClass).removeClass(CSS_overElementClass),current.addClass(CSS_overElementClass),this.proxy.offset({top:this.proxyDelta.y+evt.pageY,left:this.proxyDelta.x+evt.pageX}),currentList.length&&!currentList.children().filter(isNotProxy).length)this.moveElement(currentList,$());else if(1===current.length&&!this.info.element.find(current[0]).length){var coordinates=this.getPositionInNode(evt.pageX,evt.pageY,current);if(coordinates){var parent=current.parent(),ratio=this.isListHorizontal(parent)?coordinates.xRatio:coordinates.yRatio,subList=current.find("."+CSS_targetListClass),subListEmpty=!subList.children().filter(isNotProxy).filter(isNotSelf).length;subList.length&&subListEmpty&&ratio>.2&&ratio<.8?this.moveElement(subList,$()):ratio>.5?this.moveElement(parent,current.next().filter(isNotProxy)):this.moveElement(parent,current)}}if("mouseup"===evt.type||"touchend"===evt.type){this.info.endX=evt.pageX,this.info.endY=evt.pageY,this.info.endTime=(new Date).getTime(),this.info.dropped=!0,this.info.positionChanged=this.hasPositionChanged(this.info);var oldinfo=this.info;this.executeCallback(SortableList.EVENTS.DROP),this.finishDragging(),"touchend"===evt.type&&null!==this.config.moveHandlerSelector&&oldinfo.endTime-oldinfo.startTime<500&&!oldinfo.positionChanged&&this.clickHandler(evt)}},SortableList.prototype.hasPositionChanged=function(info){return info.sourceList[0]!==info.targetList[0]||info.sourceNextElement.length!==info.targetNextElement.length||info.sourceNextElement.length&&info.sourceNextElement[0]!==info.targetNextElement[0]},SortableList.prototype.moveElement=function(parentElement,beforeElement){var dragEl=this.info.element;beforeElement.length&&beforeElement[0]===dragEl[0]||parentElement[0]===this.info.targetList[0]&&beforeElement.length===this.info.targetNextElement.length&&beforeElement[0]===this.info.targetNextElement[0]||(beforeElement.length?parentElement[0].insertBefore(dragEl[0],beforeElement[0]):this.proxy&&this.proxy.parent().length&&this.proxy.parent()[0]===parentElement[0]?parentElement[0].insertBefore(dragEl[0],this.proxy[0]):parentElement[0].appendChild(dragEl[0]),this.info.targetList=parentElement,this.info.targetNextElement=beforeElement,this.executeCallback(SortableList.EVENTS.DRAG))},SortableList.prototype.finishDragging=function(){this.resetDraggedClasses(),this.config.autoScroll&&autoScroll.stop(),$(window).off("mousemove touchmove.notPassive mouseup touchend.notPassive",$.proxy(this.dragHandler,this)),$(window).off("keypress",$.proxy(this.dragcancelHandler,this)),this.executeCallback(SortableList.EVENTS.DRAGEND),this.info=null},SortableList.prototype.executeCallback=function(eventName){this.info.element.trigger(eventName,this.info)},SortableList.prototype.dragcancelHandler=function(evt){"keypress"===evt.type&&27===evt.originalEvent.keyCode&&(this.moveElement(this.info.sourceList,this.info.sourceNextElement),this.finishDragging())},SortableList.prototype.getElementName=function(element){return $.Deferred().resolve(element.text())},SortableList.prototype.getDestinationName=function(parentElement,afterElement){return afterElement.length?this.getElementName(afterElement).then((function(name){return str.get_string("movecontentafter","moodle",name)})):str.get_string("movecontenttothetop","moodle")},SortableList.prototype.getMoveDialogueTitle=function(element,handler){return handler.attr("title")?$.Deferred().resolve(handler.attr("title")):this.getElementName(element).then((function(name){return str.get_string("movecontent","moodle",name)}))},SortableList.prototype.getDestinationsList=function(){var addedLists=[],targets=$(this.config.targetListSelector),destinations=$("<ul/>").addClass(CSS_keyboardDragClass),result=$.when().then((function(){return destinations})),createLink=$.proxy((function(parentElement,beforeElement,afterElement){beforeElement.is(this.info.element)||afterElement.is(this.info.element)||$.contains(this.info.element[0],parentElement[0])||(result=result.then($.proxy((function(){return this.getDestinationName(parentElement,afterElement)}),this)).then((function(txt){var li=$("<li/>").appendTo(destinations);return $('<a href="#"/>').attr("data-core_sortable_list-quickmove",1).appendTo(li).data("parent-element",parentElement).data("before-element",beforeElement).text(txt),destinations})))}),this);return targets.each((function addList(){if(-1===$.inArray(this,addedLists)){addedLists.push(this);var list=$(this),children=list.children();children.each((function(){var element=$(this);createLink(list,element,element.prev()),element.find(targets).each(addList)})),createLink(list,$(),children.last())}})),result},SortableList.prototype.displayMoveDialogue=function(clickedElement){ModalFactory.create({type:ModalFactory.types.CANCEL,title:this.getMoveDialogueTitle(this.info.element,clickedElement),body:this.getDestinationsList()}).then($.proxy((function(modal){var quickMoveHandler=$.proxy((function(e){e.preventDefault(),e.stopPropagation(),this.moveElement($(e.currentTarget).data("parent-element"),$(e.currentTarget).data("before-element")),this.info.endTime=(new Date).getTime(),this.info.positionChanged=this.hasPositionChanged(this.info),this.info.dropped=!0,clickedElement.focus(),this.executeCallback(SortableList.EVENTS.DROP),modal.hide()}),this);return modal.getRoot().on("click","[data-core_sortable_list-quickmove]",quickMoveHandler),modal.getRoot().on(ModalEvents.hidden,$.proxy((function(){modal.getRoot().off("click","[data-core_sortable_list-quickmove]",quickMoveHandler),modal.destroy(),this.finishDragging()}),this)),modal.setLarge(),modal.show(),modal}),this)).catch(Notification.exception)},SortableList}));
/**
 * Search box.
 *
 * @module     core/search-input
 * @class      search-input
 * @package    core
 * @copyright  2016 David Monllao {@link http://www.davidmonllao.com}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      Moodle 3.1
 */
define("core/search-input",["jquery"],(function($){var wrapper=null,toggleForm=function(ev){wrapper.hasClass("expanded")?hideForm():showForm(ev)},showForm=function(ev){var windowWidth=$(document).width();"keydown"===ev.type&&13!==ev.keyCode&&32!==ev.keyCode||(windowWidth<=767&&("click"===ev.type||"keydown"===ev.type)?submitForm():windowWidth<=767||("keydown"===ev.type&&ev.preventDefault(),wrapper.addClass("expanded"),wrapper.find("form").addClass("expanded"),wrapper.find("input").focus()))},hideForm=function(){wrapper.removeClass("expanded"),wrapper.find("form").removeClass("expanded")},submitForm=function(){wrapper.find("form").submit()};return{init:function(id){(wrapper=$("#"+id)).on("click mouseover keydown","div",toggleForm)}}}));
/**
 * Contain the events a modal can fire.
 *
 * @module     core/modal_events
 * @class      modal_events
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/modal_events",[],(function(){return{shown:"modal:shown",hidden:"modal:hidden",destroyed:"modal:destroyed",bodyRendered:"modal:bodyRendered",save:"modal-save-cancel:save",cancel:"modal-save-cancel:cancel"}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Chart base.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_base
 */}define("core/chart_base",["core/chart_series","core/chart_axis"],(function(Series,Axis){function Base(){this._series=[],this._labels=[],this._xaxes=[],this._yaxes=[],this._setDefaults()}return Base.prototype._series=null,Base.prototype._labels=null,Base.prototype._legendOptions=null,Base.prototype._title=null,Base.prototype._xaxes=null,Base.prototype._yaxes=null,Base.prototype.COLORSET=["#f3c300","#875692","#f38400","#a1caf1","#be0032","#c2b280","#7f180d","#008856","#e68fac","#0067a5"],Base.prototype._configColorSet=null,Base.prototype.TYPE=null,Base.prototype.addSeries=function(series){if(this._validateSeries(series),this._series.push(series),null===series.getColor()){var configColorSet=this.getConfigColorSet()||Base.prototype.COLORSET;series.setColor(configColorSet[this._series.length%configColorSet.length])}},Base.prototype.create=function(Klass,data){var Chart=new Klass;return Chart.setConfigColorSet(data.config_colorset),Chart.setLabels(data.labels),Chart.setTitle(data.title),data.legend_options&&Chart.setLegendOptions(data.legend_options),data.series.forEach((function(seriesData){Chart.addSeries(Series.prototype.create(seriesData))})),data.axes.x.forEach((function(axisData,i){Chart.setXAxis(Axis.prototype.create(axisData),i)})),data.axes.y.forEach((function(axisData,i){Chart.setYAxis(Axis.prototype.create(axisData),i)})),Chart},Base.prototype.__getAxis=function(xy,index,createIfNotExists){var axis,axes="x"===xy?this._xaxes:this._yaxes,setAxis=("x"===xy?this.setXAxis:this.setYAxis).bind(this);if(createIfNotExists=void 0!==createIfNotExists&&createIfNotExists,void 0===(axis=axes[index=void 0===index?0:index])){if(!createIfNotExists)throw new Error("Unknown axis.");setAxis(axis=new Axis,index)}return axis},Base.prototype.getConfigColorSet=function(){return this._configColorSet},Base.prototype.getLabels=function(){return this._labels},Base.prototype.getLegendOptions=function(){return this._legendOptions},Base.prototype.getSeries=function(){return this._series},Base.prototype.getTitle=function(){return this._title},Base.prototype.getType=function(){if(!this.TYPE)throw new Error("The TYPE property has not been set.");return this.TYPE},Base.prototype.getXAxes=function(){return this._xaxes},Base.prototype.getXAxis=function(index,createIfNotExists){return this.__getAxis("x",index,createIfNotExists)},Base.prototype.getYAxes=function(){return this._yaxes},Base.prototype.getYAxis=function(index,createIfNotExists){return this.__getAxis("y",index,createIfNotExists)},Base.prototype.setConfigColorSet=function(colorset){this._configColorSet=colorset},Base.prototype._setDefaults=function(){},Base.prototype.setLabels=function(labels){if(labels.length&&this._series.length&&this._series[0].length!=labels.length)throw new Error("Series must match label values.");this._labels=labels},Base.prototype.setLegendOptions=function(legendOptions){if("object"!==_typeof(legendOptions))throw new Error("Setting legend with non-object value:"+legendOptions);this._legendOptions=legendOptions},Base.prototype.setTitle=function(title){this._title=title},Base.prototype.setXAxis=function(axis,index){index=void 0===index?0:index,this._validateAxis("x",axis,index),this._xaxes[index]=axis},Base.prototype.setYAxis=function(axis,index){index=void 0===index?0:index,this._validateAxis("y",axis,index),this._yaxes[index]=axis},Base.prototype._validateAxis=function(xy,axis,index){if((index=void 0===index?0:index)>0&&void 0===("x"==xy?this._xaxes:this._yaxes)[index-1])throw new Error("Missing "+xy+" axis at index lower than "+index)},Base.prototype._validateSeries=function(series){if(this._series.length&&this._series[0].getCount()!=series.getCount())throw new Error("Series do not have an equal number of values.");if(this._labels.length&&this._labels.length!=series.getCount())throw new Error("Series must match label values.")},Base}));
/**
 * Global registry of core events that can be triggered/listened for.
 *
 * @module     core/event
 * @package    core
 * @class      event
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.0
 */
define("core/event",["jquery","core/yui"],(function($,Y){return{Events:{FORM_FIELD_VALIDATION:"core_form-field-validation"},getLegacyEvents:function(){var result=$.Deferred();return Y.use("event","moodle-core-event",(function(){result.resolve(window.M.core.event)})),result.promise()},notifyFilterContentUpdated:function(nodes){nodes=$(nodes),Y.use("event","moodle-core-event",(function(Y){$(document).trigger(M.core.event.FILTER_CONTENT_UPDATED,[nodes]);var yuiNodes=new Y.NodeList(nodes.get());Y.fire(M.core.event.FILTER_CONTENT_UPDATED,{nodes:yuiNodes})}))},notifyFormSubmitAjax:function(form,skipValidation){skipValidation=skipValidation||!1,Y.use("event","moodle-core-event",(function(Y){skipValidation&&(window.skipClientValidation=!0),$(form).trigger(M.core.event.FORM_SUBMIT_AJAX),Y.one(form).fire(M.core.event.FORM_SUBMIT_AJAX,{currentTarget:Y.one(form)}),skipValidation&&(window.skipClientValidation=!1)}))},notifyEditorContentRestored:function(){Y.use("event","moodle-core-event",(function(Y){$(document).trigger(M.core.event.EDITOR_CONTENT_RESTORED),Y.fire(M.core.event.EDITOR_CONTENT_RESTORED)}))}}}));
/**
 * A list of human readable names for the keycodes.
 *
 * @module     core/key_codes
 * @class      key_codes
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("core/key_codes",(function(){return{tab:9,enter:13,shift:16,ctrl:17,alt:18,escape:27,space:32,end:35,home:36,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,8:56,asterix:106,pageUp:33,pageDown:34}}));
/**
 * Icon System base module.
 *
 * @package    core
 * @copyright  2017 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/icon_system",["jquery"],(function($){var IconSystem=function(){};return IconSystem.prototype.init=function(){return $.when(this)},IconSystem.prototype.renderIcon=function(key,component,title,template){throw new Error("Abstract function not implemented.")},IconSystem.prototype.getTemplateName=function(){throw new Error("Abstract function not implemented.")},IconSystem}));
/**
 * Expose the global YUI variable. Note: This is only for scripts that are writing AMD
 * wrappers for YUI functionality. This is not for plugins.
 *
 * @module     core/yui
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/yui",(function(){return Y}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core/local/modal/alert",["exports","core/modal"],(function(_exports,_modal){var obj;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=function(_Modal){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(_default,_Modal);var Constructor,protoProps,staticProps,_super=_createSuper(_default);function _default(){return _classCallCheck(this,_default),_super.apply(this,arguments)}return Constructor=_default,(protoProps=[{key:"registerEventListeners",value:function(){_get(_getPrototypeOf(_default.prototype),"registerEventListeners",this).call(this),this.registerCloseOnCancel()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}((_modal=(obj=_modal)&&obj.__esModule?obj:{default:obj}).default);return _exports.default=_default,_exports.default}));
define("core/local/aria/focuslock",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.untrapFocus=_exports.trapFocus=void 0;
/**
   * Tab locking system.
   *
   * This is based on code and examples provided in the ARIA specification.
   * https://www.w3.org/TR/wai-aria-practices/examples/dialog-modal/dialog.html
   *
   * @module     core/tablock
   * @class      tablock
   * @package    core
   * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var selectors_focusable='input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',lockRegionStack=[],initialFocusElementStack=[],finalFocusElementStack=[],lastFocus=null,ignoreFocusChanges=!1,isLocked=!1,lockHandler=function(event){if(!ignoreFocusChanges){var lockRegion=getCurrentLockRegion();lockRegion.parentNode||untrapFocus(),lockRegion.contains(event.target)?lastFocus=event.target:(focusFirstDescendant(),lastFocus==document.activeElement&&focusLastDescendant(),lastFocus=document.activeElement)}},focusFirstDescendant=function(){var lockRegion=getCurrentLockRegion(),focusableElements=Array.from(lockRegion.querySelectorAll(selectors_focusable));return focusableElements.unshift(lockRegion),focusableElements.some((function(focusableElement){return attemptFocus(focusableElement)}))},focusLastDescendant=function(){var lockRegion=getCurrentLockRegion(),focusableElements=Array.from(lockRegion.querySelectorAll(selectors_focusable)).reverse();return focusableElements.push(lockRegion),focusableElements.some((function(focusableElement){return attemptFocus(focusableElement)}))},attemptFocus=function(focusTarget){if(!function(focusTarget){if(focusTarget.tabIndex>0||0===focusTarget.tabIndex&&null!==focusTarget.getAttribute("tabIndex"))return!0;if(focusTarget.disabled)return!1;switch(focusTarget.nodeName){case"A":return!!focusTarget.href&&"ignore"!=focusTarget.rel;case"INPUT":return"hidden"!=focusTarget.type&&"file"!=focusTarget.type;case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}}(focusTarget))return!1;ignoreFocusChanges=!0;try{focusTarget.focus()}catch(e){}return ignoreFocusChanges=!1,document.activeElement===focusTarget},getCurrentLockRegion=function(){return lockRegionStack[lockRegionStack.length-1]};_exports.trapFocus=function(newLockRegion){if(function(newLockRegion){if(newLockRegion!==getCurrentLockRegion()){lockRegionStack.push(newLockRegion);var currentLockRegion=getCurrentLockRegion(),element=document.createElement("div");element.tabIndex=0,element.style.position="fixed",element.style.top=0,element.style.left=0;var initialNode=element.cloneNode();currentLockRegion.parentNode.insertBefore(initialNode,currentLockRegion),initialFocusElementStack.push(initialNode);var finalNode=element.cloneNode();currentLockRegion.parentNode.insertBefore(finalNode,currentLockRegion.nextSibling),finalFocusElementStack.push(finalNode)}}(newLockRegion),isLocked||document.addEventListener("focus",lockHandler,!0),!focusFirstDescendant()){var currentLockRegion=getCurrentLockRegion(),originalRegionTabIndex=currentLockRegion.tabIndex;currentLockRegion.tabIndex=0,attemptFocus(currentLockRegion),currentLockRegion.tabIndex=originalRegionTabIndex}lastFocus=document.activeElement,isLocked=!0};var untrapFocus=function(){!function(){lockRegionStack.pop();var finalNode=finalFocusElementStack.pop();finalNode&&finalNode.remove();var initialNode=initialFocusElementStack.pop();initialNode&&initialNode.remove()}(),lockRegionStack.length||(document.removeEventListener("focus",lockHandler,!0),lastFocus=null,ignoreFocusChanges=!1,isLocked=!1)};_exports.untrapFocus=untrapFocus}));
/**
 * Wrap an instance of the browser's local or session storage to handle
 * cache expiry, key namespacing and other helpful things.
 *
 * @module     core/storagewrapper
 * @package    core
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/storagewrapper",["core/config"],(function(config){var Wrapper=function(storage){this.storage=storage,this.supported=this.detectSupport(),this.hashSource=config.wwwroot+"/"+config.jsrev,this.hash=this.hashString(this.hashSource),this.prefix=this.hash+"/",this.jsrevPrefix=this.hashString(config.wwwroot)+"/jsrev",this.validateCache()};return Wrapper.prototype.detectSupport=function(){if(-1==config.jsrev)return!1;if(void 0===this.storage)return!1;try{return null!==this.storage&&(this.storage.setItem("test","1"),this.storage.removeItem("test"),!0)}catch(ex){return!1}},Wrapper.prototype.prefixKey=function(key){return this.prefix+key},Wrapper.prototype.validateCache=function(){var cacheVersion=this.storage.getItem(this.jsrevPrefix);null!==cacheVersion?config.jsrev!=cacheVersion&&(this.storage.clear(),this.storage.setItem(this.jsrevPrefix,config.jsrev)):this.storage.setItem(this.jsrevPrefix,config.jsrev)},Wrapper.prototype.hashString=function(source){var i,len,hash=0;if(0===source.length)return hash;for(i=0,len=source.length;i<len;i++)hash=(hash<<5)-hash+source.charCodeAt(i),hash|=0;return hash},Wrapper.prototype.get=function(key){return!!this.supported&&(key=this.prefixKey(key),this.storage.getItem(key))},Wrapper.prototype.set=function(key,value){if(!this.supported)return!1;key=this.prefixKey(key);try{this.storage.setItem(key,value)}catch(e){return!1}return!0},Wrapper}));
define("core/toast",["exports","core/templates","core/notification","core/pending"],(function(_exports,_templates,_notification,_pending){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.addToastRegion=_exports.add=void 0,_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending);var _ref,addToastRegion=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(parent){var pendingPromise,_yield$Templates$rend,html,js;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return pendingPromise=new _pending.default("addToastRegion"),_context.prev=1,_context.next=4,_templates.default.renderForPromise("core/local/toast/wrapper",{});case 4:_yield$Templates$rend=_context.sent,html=_yield$Templates$rend.html,js=_yield$Templates$rend.js,_templates.default.prependNodeContents(parent,html,js),_context.next=13;break;case 10:_context.prev=10,_context.t0=_context.catch(1),_notification.default.exception(_context.t0);case 13:pendingPromise.resolve();case 14:case"end":return _context.stop()}}),_callee,null,[[1,10]])}))),function(_x){return _ref.apply(this,arguments)});_exports.addToastRegion=addToastRegion;var _ref2,add=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(message,configuration){var pendingPromise,templateName,targetNode,_yield$Templates$rend2,html,js;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return pendingPromise=new _pending.default("addToastRegion"),configuration=_objectSpread({closeButton:!1,autohide:!0,delay:4e3},configuration),templateName="core/local/toast/message",_context2.prev=3,_context2.next=6,getTargetNode();case 6:return targetNode=_context2.sent,_context2.next=9,_templates.default.renderForPromise(templateName,_objectSpread({message:message},configuration));case 9:_yield$Templates$rend2=_context2.sent,html=_yield$Templates$rend2.html,js=_yield$Templates$rend2.js,_templates.default.prependNodeContents(targetNode,html,js),_context2.next=18;break;case 15:_context2.prev=15,_context2.t0=_context2.catch(3),_notification.default.exception(_context2.t0);case 18:pendingPromise.resolve();case 19:case"end":return _context2.stop()}}),_callee2,null,[[3,15]])}))),function(_x2,_x3){return _ref2.apply(this,arguments)});_exports.add=add;var _ref3,getTargetNode=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var regions;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!(regions=document.querySelectorAll(".toast-wrapper")).length){_context3.next=3;break}return _context3.abrupt("return",regions[regions.length-1]);case 3:return _context3.next=5,addToastRegion(document.body,"fixed-bottom");case 5:return _context3.abrupt("return",getTargetNode());case 6:case"end":return _context3.stop()}}),_callee3)}))),function(){return _ref3.apply(this,arguments)})}));
/**
 * Javascript for showing/hiding pages of content.
 *
 * @module     core/paged_content_pages
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_pages",["jquery","core/templates","core/notification","core/pubsub","core/paged_content_events","core/pending"],(function($,Templates,Notification,PubSub,PagedContentEvents,Pending){var SELECTORS_PAGE_REGION='[data-region="paged-content-page"]',TEMPLATES_PAGING_CONTENT_ITEM="core/paged_content_page",TEMPLATES_LOADING="core/overlay_loading",findPage=function(root,pageNumber){return root.find('[data-page="'+pageNumber+'"]')},showPages=function(root,pagesData,id,renderPagesContentCallback){var pendingPromise=new Pending("core/paged_content_pages:showPages"),existingPages=[],newPageData=[],newPagesPromise=$.Deferred();if(pagesData.forEach((function(pageData){var pageNumber=pageData.pageNumber,existingPage=findPage(root,pageNumber);existingPage.length?existingPages.push(existingPage):newPageData.push(pageData)})),newPageData.length&&"function"==typeof renderPagesContentCallback){var renderPagePromises=renderPagesContentCallback(newPageData,{allItemsLoaded:function(lastPageNumber){PubSub.publish(id+PagedContentEvents.ALL_ITEMS_LOADED,lastPageNumber)}}).map((function(promise,index){return function(root,pagePromise,pageNumber){var deferred=$.Deferred();return pagePromise.then((function(html,pageJS){pageJS=pageJS||"",Templates.render(TEMPLATES_PAGING_CONTENT_ITEM,{page:pageNumber,content:html}).then((function(html){Templates.appendNodeContents(root,html,pageJS);var page=findPage(root,pageNumber);deferred.resolve(page)})).fail((function(exception){deferred.reject(exception)})).fail(Notification.exception)})).fail((function(exception){deferred.reject(exception)})).fail(Notification.exception),deferred.promise()}(root,promise,newPageData[index].pageNumber)}));$.when.apply($,renderPagePromises).then((function(){var newPages=Array.prototype.slice.call(arguments);newPagesPromise.resolve(newPages)})).fail((function(exception){newPagesPromise.reject(exception)})).fail(Notification.exception)}else newPagesPromise.resolve([]);var loadingPromise=function(root){var deferred=$.Deferred();root.attr("aria-busy",!0);var pendingPromise=new Pending("core/paged_content_pages:startLoading");return Templates.render(TEMPLATES_LOADING,{visible:!0}).then((function(html){var loadingSpinner=$(html),timerId=setTimeout((function(){root.css("position","relative"),loadingSpinner.appendTo(root)}),300);deferred.always((function(){clearTimeout(timerId),loadingSpinner.remove(),root.css("position",""),root.removeAttr("aria-busy"),pendingPromise.resolve()}))})).fail(Notification.exception),deferred}(root);newPagesPromise.then((function(newPages){var pagesToShow=existingPages.concat(newPages);root.find(SELECTORS_PAGE_REGION).addClass("hidden"),pagesToShow.forEach((function(page){page.removeClass("hidden")}))})).then((function(){PubSub.publish(id+PagedContentEvents.PAGES_SHOWN,pagesData)})).fail(Notification.exception).always((function(){loadingPromise.resolve(),pendingPromise.resolve()})).catch()};return{init:function(root,id,renderPagesContentCallback){root=$(root),PubSub.subscribe(id+PagedContentEvents.SHOW_PAGES,(function(pagesData){showPages(root,pagesData,id,renderPagesContentCallback)})),PubSub.subscribe(id+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT,(function(){root.empty()}))},rootSelector:'[data-region="page-container"]'}}));
/**
 * Implement an accessible aria tree widget, from a nested unordered list.
 * Based on http://oaa-accessibility.org/example/41/.
 *
 * @module     tool_lp/tree
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/tree",["jquery"],(function($){var SELECTORS_ITEM="[role=treeitem]",SELECTORS_GROUP="[role=treeitem]:has([role=group]), [role=treeitem][aria-owns], [role=treeitem][data-requires-ajax=true]",SELECTORS_CLOSED_GROUP="[role=treeitem]:has([role=group])[aria-expanded=false], [role=treeitem][aria-owns][aria-expanded=false], [role=treeitem][data-requires-ajax=true][aria-expanded=false]",SELECTORS_FIRST_ITEM="[role=treeitem]:first",SELECTORS_VISIBLE_ITEM="[role=treeitem]:visible",SELECTORS_UNLOADED_AJAX_ITEM="[role=treeitem][data-requires-ajax=true][data-loaded=false][aria-expanded=true]",Tree=function(selector,selectCallback){this.treeRoot=$(selector),this.treeRoot.data("activeItem",null),this.selectCallback=selectCallback,this.keys={tab:9,enter:13,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,asterisk:106},this.initialiseNodes(this.treeRoot),this.setActiveItem(this.treeRoot.find(SELECTORS_FIRST_ITEM)),this.refreshVisibleItemsCache(),this.bindEventHandlers()};return Tree.prototype.registerEnterCallback=function(callback){this.enterCallback=callback},Tree.prototype.refreshVisibleItemsCache=function(){this.treeRoot.data("visibleItems",this.treeRoot.find(SELECTORS_VISIBLE_ITEM))},Tree.prototype.getVisibleItems=function(){return this.treeRoot.data("visibleItems")},Tree.prototype.setActiveItem=function(item){var currentActive=this.treeRoot.data("activeItem");item!==currentActive&&(currentActive&&(currentActive.attr("tabindex","-1"),currentActive.attr("aria-selected","false")),item.attr("tabindex","0"),item.attr("aria-selected","true"),this.treeRoot.data("activeItem",item),"function"==typeof this.selectCallback&&this.selectCallback(item))},Tree.prototype.isGroupItem=function(item){return item.is(SELECTORS_GROUP)},Tree.prototype.getGroupFromItem=function(item){var ariaowns=this.treeRoot.find("#"+item.attr("aria-owns")),plain=item.children("[role=group]");return ariaowns.length>plain.length?ariaowns:plain},Tree.prototype.isGroupCollapsed=function(item){return"false"===item.attr("aria-expanded")},Tree.prototype.isGroupCollapsible=function(item){return"false"!==item.attr("data-collapsible")},Tree.prototype.initialiseNodes=function(node){this.removeAllFromTabOrder(node),this.setAriaSelectedFalseOnItems(node);var thisTree=this;node.find(SELECTORS_UNLOADED_AJAX_ITEM).each((function(){var unloadedNode=$(this);thisTree.collapseGroup(unloadedNode),thisTree.expandGroup(unloadedNode)}))},Tree.prototype.removeAllFromTabOrder=function(node){node.find("*").attr("tabindex","-1"),this.getGroupFromItem($(node)).find("*").attr("tabindex","-1")},Tree.prototype.setAriaSelectedFalseOnItems=function(node){node.find(SELECTORS_ITEM).attr("aria-selected","false")},Tree.prototype.expandAllGroups=function(){var thisTree=this;this.treeRoot.find(SELECTORS_CLOSED_GROUP).each((function(){var groupNode=$(this);thisTree.expandGroup($(this)).done((function(){thisTree.expandAllChildGroups(groupNode)}))}))},Tree.prototype.expandAllChildGroups=function(item){var thisTree=this;this.getGroupFromItem(item).find(SELECTORS_CLOSED_GROUP).each((function(){var groupNode=$(this);thisTree.expandGroup($(this)).done((function(){thisTree.expandAllChildGroups(groupNode)}))}))},Tree.prototype.expandGroup=function(item){var promise=$.Deferred();if("false"!==item.attr("data-expandable")&&this.isGroupCollapsed(item))if("true"===item.attr("data-requires-ajax")&&"true"!==item.attr("data-loaded")){item.attr("data-loaded",!1);var moduleName=item.closest("[data-ajax-loader]").attr("data-ajax-loader"),thisTree=this;item.addClass("loading"),require([moduleName],(function(loader){loader.load(item).done((function(){item.attr("data-loaded",!0),thisTree.initialiseNodes(item),thisTree.finishExpandingGroup(item),item.removeClass("loading"),promise.resolve()}))}))}else this.finishExpandingGroup(item),promise.resolve();else promise.resolve();return promise},Tree.prototype.finishExpandingGroup=function(item){this.getGroupFromItem(item).attr("aria-hidden","false"),item.attr("aria-expanded","true"),this.refreshVisibleItemsCache()},Tree.prototype.collapseGroup=function(item){this.isGroupCollapsible(item)&&!this.isGroupCollapsed(item)&&(this.getGroupFromItem(item).attr("aria-hidden","true"),item.attr("aria-expanded","false"),this.refreshVisibleItemsCache())},Tree.prototype.toggleGroup=function(item){"true"===item.attr("aria-expanded")?this.collapseGroup(item):this.expandGroup(item)},Tree.prototype.handleKeyDown=function(item,e){var currentIndex=this.getVisibleItems().index(item);if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey&&e.keyCode!=this.keys.tab)return!0;switch(e.keyCode){case this.keys.home:return this.getVisibleItems().first().focus(),e.stopPropagation(),!1;case this.keys.end:return this.getVisibleItems().last().focus(),e.stopPropagation(),!1;case this.keys.enter:var links=item.children("a").length?item.children("a"):item.children().not(SELECTORS_GROUP).find("a");return links.length?"function"==typeof this.enterCallback?this.enterCallback(item):window.location.href=links.first().attr("href"):this.isGroupItem(item)&&this.toggleGroup(item,!0),e.stopPropagation(),!1;case this.keys.space:return this.isGroupItem(item)&&this.toggleGroup(item,!0),e.stopPropagation(),!1;case this.keys.left:var focusParent=function(tree){tree.getVisibleItems().filter((function(){return tree.getGroupFromItem($(this)).has(item).length})).focus()};return this.isGroupItem(item)?this.isGroupCollapsed(item)?focusParent(this):this.collapseGroup(item):focusParent(this),e.stopPropagation(),!1;case this.keys.right:return this.isGroupItem(item)&&(this.isGroupCollapsed(item)?this.expandGroup(item):this.getGroupFromItem(item).find(SELECTORS_ITEM).first().focus()),e.stopPropagation(),!1;case this.keys.up:if(currentIndex>0)this.getVisibleItems().eq(currentIndex-1).focus();return e.stopPropagation(),!1;case this.keys.down:if(currentIndex<this.getVisibleItems().length-1)this.getVisibleItems().eq(currentIndex+1).focus();return e.stopPropagation(),!1;case this.keys.asterisk:return this.expandAllGroups(),e.stopPropagation(),!1}return!0},Tree.prototype.handleClick=function(item,e){return e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||(item.focus(),this.isGroupItem(item)&&this.toggleGroup(item),e.stopPropagation()),!0},Tree.prototype.handleFocus=function(item,e){return this.setActiveItem(item),e.stopPropagation(),!0},Tree.prototype.bindEventHandlers=function(){var thisObj=this;this.treeRoot.on({click:function(e){return thisObj.handleClick($(this),e)},keydown:function(e){return thisObj.handleKeyDown($(this),e)},focus:function(e){return thisObj.handleFocus($(this),e)}},SELECTORS_ITEM)},Tree}));
/**
 * A timer that will execute a callback with decreasing frequency. Useful for
 * doing polling on the server without overwhelming it with requests.
 *
 * @module     core/backoff_timer
 * @class      backoff_timer
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/backoff_timer",(function(){var BackoffTimer=function(callback,backoffFunction){this.callback=callback,this.backOffFunction=backoffFunction};return BackoffTimer.prototype.callback=null,BackoffTimer.prototype.backOffFunction=null,BackoffTimer.prototype.time=null,BackoffTimer.prototype.timeout=null,BackoffTimer.prototype.generateNextTime=function(){var newTime=this.backOffFunction(this.time);return this.time=newTime,newTime},BackoffTimer.prototype.reset=function(){return this.time=null,this.stop(),this},BackoffTimer.prototype.stop=function(){return this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null),this},BackoffTimer.prototype.start=function(){if(!this.timeout){var time=this.generateNextTime();this.timeout=window.setTimeout(function(){this.callback(),this.stop(),this.start()}.bind(this),time)}return this},BackoffTimer.prototype.restart=function(){return this.reset().start()},BackoffTimer.getIncrementalCallback=function(minamount,incrementamount,maxamount,timeoutamount){return function(time){return time?time+incrementamount>maxamount?timeoutamount:time+incrementamount:minamount}},BackoffTimer}));
/**
 * Javascript to manage the paging dropdown control.
 *
 * @module     core/paged_content_paging_dropdown
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_paging_dropdown",["jquery","core/custom_interaction_events","core/paged_content_events","core/pubsub"],(function($,CustomEvents,PagedContentEvents,PubSub){var SELECTORS_DROPDOWN_ITEM='[data-region="dropdown-item"]',SELECTORS_DROPDOWN_TOGGLE='[data-region="dropdown-toggle"]',SELECTORS_ACTIVE_DROPDOWN_ITEM='[data-region="dropdown-item"].active',SELECTORS_CARET='[data-region="caret"]',getPageNumber=function(item){return parseInt(item.attr("data-page-number"),10)},getAllItems=function(root){return root.find(SELECTORS_DROPDOWN_ITEM)},getPreviousItems=function(root,item){var pageNumber=getPageNumber(item);return getAllItems(root).filter((function(index,element){return getPageNumber($(element))<pageNumber}))},getLimit=function(item){return parseInt(item.attr("data-item-count"),10)},getOffset=function(root,item){if(null!=item.attr("data-offset"))return parseInt(item.attr("data-offset"),10);var offset=0;return getPreviousItems(root,item).each((function(index,prevItem){prevItem=$(prevItem),offset+=getLimit(prevItem)})),item.attr("data-offset",offset),offset},getActiveItem=function(root){return root.find(SELECTORS_ACTIVE_DROPDOWN_ITEM)},setActiveItem=function(root,item,id){var eventPayload=function(root,items){return items.map((function(index,item){return item=$(item),{pageNumber:getPageNumber(item),limit:getLimit(item),offset:getOffset(root,item)}})).get()}(root,getPreviousItems(root,item).add(item)),toggle=root.find(SELECTORS_DROPDOWN_TOGGLE),caret=toggle.find(SELECTORS_CARET);getActiveItem(root).removeClass("active"),item.addClass("active"),toggle.html(item.text()),toggle.append(caret),PubSub.publish(id+PagedContentEvents.SHOW_PAGES,eventPayload)};return{init:function(root,id){root=$(root),function(items){items.each((function(index,item){(item=$(item)).attr("data-page-number",index+1)}))}(getAllItems(root));var activeItem=getActiveItem(root);activeItem.length&&setActiveItem(root,activeItem,id),CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_DROPDOWN_ITEM,(function(e,data){var item=$(e.target).closest(SELECTORS_DROPDOWN_ITEM);setActiveItem(root,item,id),data.originalEvent.preventDefault()}))},rootSelector:'[data-region="paging-dropdown-container"]'}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core/modal_cancel",["exports","core/modal"],(function(_exports,_modal){var obj;function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=function(_Modal){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(_default,_Modal);var Constructor,protoProps,staticProps,_super=_createSuper(_default);function _default(root){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_default),(_this=_super.call(this,root)).getFooter().find(_this.getActionSelector("cancel")).length||Notification.exception({message:"No cancel button found"}),_this}return Constructor=_default,(protoProps=[{key:"registerEventListeners",value:function(){_get(_getPrototypeOf(_default.prototype),"registerEventListeners",this).call(this),this.registerCloseOnCancel()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}((_modal=(obj=_modal)&&obj.__esModule?obj:{default:obj}).default);return _exports.default=_default,_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Contain the logic for modals.
 *
 * @module     core/modal
 * @class      modal
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core/modal",["jquery","core/templates","core/notification","core/key_codes","core/custom_interaction_events","core/modal_backdrop","core/event","core/modal_events","core/local/aria/focuslock","core/pending","core/fullscreen"],(function($,Templates,Notification,KeyCodes,CustomEvents,ModalBackdrop,Event,ModalEvents,FocusLock,Pending,Fullscreen){var backdropPromise,SELECTORS_CONTAINER='[data-region="modal-container"]',SELECTORS_MODAL='[data-region="modal"]',SELECTORS_HEADER='[data-region="header"]',SELECTORS_TITLE='[data-region="title"]',SELECTORS_BODY='[data-region="body"]',SELECTORS_FOOTER='[data-region="footer"]',SELECTORS_HIDE='[data-action="hide"]',SELECTORS_DIALOG="[role=dialog]",SELECTORS_FORM="form",SELECTORS_MENU_BAR="[role=menubar]",SELECTORS_HAS_Z_INDEX=".moodle-has-zindex",TEMPLATES_LOADING="core/loading",TEMPLATES_BACKDROP="core/modal_backdrop",modalCounter=0,Modal=function(root){this.root=$(root),this.modal=this.root.find(SELECTORS_MODAL),this.header=this.modal.find(SELECTORS_HEADER),this.headerPromise=$.Deferred(),this.title=this.header.find(SELECTORS_TITLE),this.titlePromise=$.Deferred(),this.body=this.modal.find(SELECTORS_BODY),this.bodyPromise=$.Deferred(),this.footer=this.modal.find(SELECTORS_FOOTER),this.footerPromise=$.Deferred(),this.hiddenSiblings=[],this.isAttached=!1,this.bodyJS=null,this.footerJS=null,this.modalCount=modalCounter++,this.attachmentPoint=document.createElement("div"),document.body.append(this.attachmentPoint),this.root.is(SELECTORS_CONTAINER)||Notification.exception({message:"Element is not a modal container"}),this.modal.length||Notification.exception({message:"Container does not contain a modal"}),this.header.length||Notification.exception({message:"Modal is missing a header region"}),this.title.length||Notification.exception({message:"Modal header is missing a title region"}),this.body.length||Notification.exception({message:"Modal is missing a body region"}),this.footer.length||Notification.exception({message:"Modal is missing a footer region"}),this.registerEventListeners()};return Modal.prototype.attachToDOM=function(){this.getAttachmentPoint().append(this.root),this.isAttached||(FocusLock.trapFocus(this.root[0]),this.bodyJS&&(Templates.runTemplateJS(this.bodyJS),this.bodyJS=null),this.footerJS&&(Templates.runTemplateJS(this.footerJS),this.footerJS=null),this.isAttached=!0)},Modal.prototype.countOtherVisibleModals=function(){var count=0;return $("body").find(SELECTORS_CONTAINER).each(function(index,element){element=$(element),!this.root.is(element)&&element.hasClass("show")&&count++}.bind(this)),count},Modal.prototype.getBackdrop=function(){return backdropPromise||(backdropPromise=Templates.render(TEMPLATES_BACKDROP,{}).then((function(html){var element=$(html);return new ModalBackdrop(element)})).fail(Notification.exception)),backdropPromise},Modal.prototype.getRoot=function(){return this.root},Modal.prototype.getModal=function(){return this.modal},Modal.prototype.getTitle=function(){return this.title},Modal.prototype.getBody=function(){return this.body},Modal.prototype.getFooter=function(){return this.footer},Modal.prototype.getTitlePromise=function(){return this.titlePromise},Modal.prototype.getBodyPromise=function(){return this.bodyPromise},Modal.prototype.getFooterPromise=function(){return this.footerPromise},Modal.prototype.getModalCount=function(){return this.modalCount},Modal.prototype.setTitle=function(value){var title=this.getTitle();this.titlePromise=$.Deferred(),this.asyncSet(value,title.html.bind(title)).then(function(){this.titlePromise.resolve(title)}.bind(this)).catch(Notification.exception)},Modal.prototype.setBody=function(value){this.bodyPromise=$.Deferred();var body=this.getBody();if("string"==typeof value)body.html(value),Event.notifyFilterContentUpdated(body),this.getRoot().trigger(ModalEvents.bodyRendered,this),this.bodyPromise.resolve(body);else{var jsPendingId="amd-modal-js-pending-id-"+this.getModalCount();M.util.js_pending(jsPendingId);var contentPromise=null;if(body.css("overflow","hidden"),"pending"==(value=$.when(value)).state()){var height=body.innerHeight();height<100&&(height=100),body.animate({height:height+"px"},150),body.html(""),contentPromise=Templates.render(TEMPLATES_LOADING,{}).then((function(html){var loadingIcon=$(html).hide();return body.html(loadingIcon),loadingIcon.fadeIn(150),$.when(loadingIcon.promise(),value)})).then((function(loadingIcon){return loadingIcon.fadeOut(100).promise()})).then((function(){return value}))}else contentPromise=value;contentPromise.then(function(html,js){var result=null;if(this.isVisible()){body.css("opacity",0);var currentHeight=body.innerHeight();body.html(html),body.css("height","");var newHeight=body.innerHeight();body.css("height",currentHeight+"px"),result=body.animate({height:newHeight+"px",opacity:1},{duration:150,queue:!1}).promise()}else body.html(html);return js&&(this.isAttached?Templates.runTemplateJS(js):this.bodyJS=js),result}.bind(this)).then(function(result){return Event.notifyFilterContentUpdated(body),this.getRoot().trigger(ModalEvents.bodyRendered,this),result}.bind(this)).then(function(){this.bodyPromise.resolve(body)}.bind(this)).fail(Notification.exception).always((function(){body.css("height",""),body.css("overflow",""),body.css("opacity",""),M.util.js_complete(jsPendingId)})).fail(Notification.exception)}},Modal.prototype.setFooter=function(value){this.showFooter(),this.footerPromise=$.Deferred();var footer=this.getFooter();"string"==typeof value?(footer.html(value),this.footerPromise.resolve(footer)):Templates.render(TEMPLATES_LOADING,{}).then((function(html){return footer.html(html),value})).then(function(html,js){return footer.html(html),js&&(this.isAttached?Templates.runTemplateJS(js):this.footerJS=js),footer}.bind(this)).then(function(footer){this.footerPromise.resolve(footer)}.bind(this)).catch(Notification.exception)},Modal.prototype.hasFooterContent=function(){return!!this.getFooter().children().length},Modal.prototype.hideFooter=function(){this.getFooter().addClass("hidden")},Modal.prototype.showFooter=function(){this.getFooter().removeClass("hidden")},Modal.prototype.setLarge=function(){this.isLarge()||this.getModal().addClass("modal-lg")},Modal.prototype.isLarge=function(){return this.getModal().hasClass("modal-lg")},Modal.prototype.setSmall=function(){this.isSmall()||this.getModal().removeClass("modal-lg")},Modal.prototype.isSmall=function(){return!this.getModal().hasClass("modal-lg")},Modal.prototype.calculateZIndex=function(){var items=$(SELECTORS_DIALOG+", "+SELECTORS_MENU_BAR+", "+SELECTORS_HAS_Z_INDEX),zIndex=parseInt(this.root.css("z-index"));return items.each((function(index,item){var itemZIndex=(item=$(item)).css("z-index")?parseInt(item.css("z-index")):0;itemZIndex>zIndex&&(zIndex=itemZIndex)})),zIndex},Modal.prototype.isVisible=function(){return this.root.hasClass("show")},Modal.prototype.hasFocus=function(){var target=$(document.activeElement);return this.root.is(target)||this.root.has(target).length},Modal.prototype.hasTransitions=function(){return this.getRoot().hasClass("fade")},Modal.prototype.getAttachmentPoint=function(){return $(Fullscreen.getElement()||this.attachmentPoint)},Modal.prototype.show=function(){if(this.isVisible())return $.Deferred().resolve();var pendingPromise=new Pending("core/modal:show");return this.hasFooterContent()?this.showFooter():this.hideFooter(),this.attachToDOM(),this.getBackdrop().then(function(backdrop){var newIndex=this.calculateZIndex()+2,newBackdropIndex=newIndex-1;this.root.css("z-index",newIndex),backdrop.setZIndex(newBackdropIndex),backdrop.show(),this.root.removeClass("hide").addClass("show"),this.accessibilityShow(),this.getModal().focus(),$("body").addClass("modal-open"),this.root.trigger(ModalEvents.shown,this)}.bind(this)).then(pendingPromise.resolve)},Modal.prototype.hideIfNotForm=function(){0==this.modal.find(SELECTORS_FORM).length&&this.hide()},Modal.prototype.hide=function(){this.getBackdrop().done(function(backdrop){FocusLock.untrapFocus(),this.countOtherVisibleModals()||(backdrop.hide(),$("body").removeClass("modal-open"));var currentIndex=parseInt(this.root.css("z-index"));this.root.css("z-index",""),backdrop.setZIndex(currentIndex-3),this.accessibilityHide(),this.hasTransitions()?this.getRoot().one("transitionend webkitTransitionEnd oTransitionEnd",function(){this.getRoot().removeClass("show").addClass("hide")}.bind(this)):this.getRoot().removeClass("show").addClass("hide"),$(document.body).find(this.getRoot()).length&&$(document.body).append(this.getRoot()),this.root.trigger(ModalEvents.hidden,this)}.bind(this))},Modal.prototype.destroy=function(){this.hide(),this.root.remove(),this.root.trigger(ModalEvents.destroyed,this),this.attachmentPoint.remove()},Modal.prototype.accessibilityShow=function(){$("body").children().each(function(index,child){if(!this.root.is(child)){var hidden=(child=$(child)).attr("aria-hidden");"true"!==hidden&&(child.data("previous-aria-hidden",hidden),this.hiddenSiblings.push(child),child.attr("aria-hidden","true"))}}.bind(this)),this.root.attr("aria-hidden","false")},Modal.prototype.accessibilityHide=function(){this.root.attr("aria-hidden","true"),$.each(this.hiddenSiblings,(function(index,sibling){var previousValue=(sibling=$(sibling)).data("previous-aria-hidden");void 0===previousValue?sibling.removeAttr("aria-hidden"):sibling.attr("aria-hidden",previousValue)})),this.hiddenSiblings=[]},Modal.prototype.registerEventListeners=function(){this.getRoot().on("keydown",function(e){this.isVisible()&&e.keyCode==KeyCodes.escape&&(this.removeOnClose?this.destroy():this.hide())}.bind(this)),this.getRoot().click(function(e){$(e.target).closest(SELECTORS_MODAL).length||$(e.target).closest(SELECTORS_CONTAINER).length&&this.hideIfNotForm()}.bind(this)),CustomEvents.define(this.getModal(),[CustomEvents.events.activate]),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE,function(e,data){this.hide(),data.originalEvent.preventDefault()}.bind(this))},Modal.prototype.registerCloseOnCancel=function(){this.getModal().on(CustomEvents.events.activate,this.getActionSelector("cancel"),function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(data.originalEvent.preventDefault(),this.removeOnClose?this.destroy():this.hide())}.bind(this))},Modal.prototype.registerCloseOnSave=function(){this.getModal().on(CustomEvents.events.activate,this.getActionSelector("save"),function(e,data){var saveEvent=$.Event(ModalEvents.save);this.getRoot().trigger(saveEvent,this),saveEvent.isDefaultPrevented()||(data.originalEvent.preventDefault(),this.removeOnClose?this.destroy():this.hide())}.bind(this))},Modal.prototype.asyncSet=function(value,setFunction){var p=value;return"object"===_typeof(value)&&value.hasOwnProperty("then")||(p=$.Deferred()).resolve(value),p.then((function(content){setFunction(content)})).fail(Notification.exception),p},Modal.prototype.setButtonText=function(action,value){var button=this.getFooter().find(this.getActionSelector(action));if(!button)throw new Error("Unable to find the '"+action+"' button");return this.asyncSet(value,button.text.bind(button))},Modal.prototype.getActionSelector=function(action){return"[data-action='"+action+"']"},Modal.prototype.setRemoveOnClose=function(remove){this.removeOnClose=remove},Modal}));
/**
 * Template renderer for Moodle. Load and render Moodle templates with Mustache.
 *
 * @module     core/templates
 * @package    core
 * @class      templates
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/templates",["core/mustache","jquery","core/ajax","core/str","core/notification","core/url","core/config","core/localstorage","core/icon_system","core/event","core/yui","core/log","core/truncate","core/user_date","core/pending"],(function(mustache,$,ajax,str,notification,coreurl,config,storage,IconSystem,event,Y,Log,Truncate,UserDate,Pending){var uniqInstances=0,templateCache={},templatePromises={},cachePartialPromises={},iconSystem={},loadTemplateBuffer=[],isLoadingTemplates=!1,blacklistedNestedHelpers=["js"],getNormalisedComponent=function(component){return component&&"moodle"!==component&&"core"!==component?component:"core"},getTemplatePromiseFromCache=function(searchKey){if(searchKey in templatePromises)return templatePromises[searchKey];if(searchKey in templateCache)return templatePromises[searchKey]=$.Deferred().resolve(templateCache[searchKey]).promise(),templatePromises[searchKey];if(M.cfg.templaterev<=0)return null;var cached=storage.get("core_template/"+M.cfg.templaterev+":"+searchKey);return cached?(templateCache[searchKey]=cached,templatePromises[searchKey]=$.Deferred().resolve(cached).promise(),templatePromises[searchKey]):null},processLoadTemplateBuffer=function processLoadTemplateBuffer(){if(loadTemplateBuffer.length&&!isLoadingTemplates){isLoadingTemplates=!0;var templatesToLoad=loadTemplateBuffer.slice(),serverRequestsDeferred=$.Deferred(),requests=[],templatePromises=templatesToLoad.map((function(templateData){var component=getNormalisedComponent(templateData.component),name=templateData.name,searchKey=templateData.searchKey,theme=templateData.theme,templateDeferred=templateData.deferred,promise=null,cachedPromise=getTemplatePromiseFromCache(searchKey);if(cachedPromise)promise=cachedPromise;else{requests.push({methodname:"core_output_load_template_with_dependencies",args:{component:component,template:name,themename:theme,lang:$("html").attr("lang").replace(/-/g,"_")}});var index=requests.length-1;promise=serverRequestsDeferred.promise().then((function(promises){return templatePromises[searchKey]=promises[index].then((function(response){var templateSource=null;return response.templates.forEach((function(data){data.component=getNormalisedComponent(data.component);var tempSearchKey=[theme,data.component,data.name].join("/");templateCache[tempSearchKey]=data.value,M.cfg.templaterev>0&&storage.set("core_template/"+M.cfg.templaterev+":"+tempSearchKey,data.value),data.component==component&&data.name==name&&(templateSource=data.value)})),response.strings.length&&str.cache_strings(response.strings.map((function(data){return{component:getNormalisedComponent(data.component),key:data.name,value:data.value}}))),templateSource})),templatePromises[searchKey]}))}return promise.then((function(source){return templateDeferred.resolve(source)})).catch((function(error){throw templateDeferred.reject(error),error}))}));requests.length?serverRequestsDeferred.resolve(ajax.call(requests,!0,!1,!1,0,M.cfg.templaterev)):serverRequestsDeferred.resolve(),$.when.apply(null,templatePromises).then((function(){loadTemplateBuffer.splice(0,templatesToLoad.length),isLoadingTemplates=!1,processLoadTemplateBuffer()})).catch((function(){loadTemplateBuffer.splice(0,templatesToLoad.length),isLoadingTemplates=!1,processLoadTemplateBuffer()}))}},Renderer=function(){this.requiredStrings=[],this.requiredJS=[],this.requiredDates=[],this.currentThemeName=""};Renderer.prototype.requiredStrings=null,Renderer.prototype.requiredDates=[],Renderer.prototype.requiredJS=null,Renderer.prototype.currentThemeName="",Renderer.prototype.getTemplate=function(templateName){var currentTheme=this.currentThemeName,searchKey=currentTheme+"/"+templateName,cachedPromise=getTemplatePromiseFromCache(searchKey);if(cachedPromise)return cachedPromise;var existingBufferRecords=loadTemplateBuffer.filter((function(record){return record.searchKey==searchKey}));if(existingBufferRecords.length)return existingBufferRecords[0].deferred.promise();var parts=templateName.split("/"),component=getNormalisedComponent(parts.shift()),name=parts.join("/"),deferred=$.Deferred();return loadTemplateBuffer.push({component:component,name:name,theme:currentTheme,searchKey:searchKey,deferred:deferred}),processLoadTemplateBuffer(),deferred.promise()},Renderer.prototype.prefetchTemplates=function(templateNames,currentTheme){templateNames.forEach((function(templateName){var searchKey=currentTheme+"/"+templateName;if(!getTemplatePromiseFromCache(searchKey)&&!loadTemplateBuffer.filter((function(record){return record.searchKey==searchKey})).length){var parts=templateName.split("/"),component=getNormalisedComponent(parts.shift()),name=parts.join("/");loadTemplateBuffer.push({component:component,name:name,theme:currentTheme,searchKey:searchKey,deferred:$.Deferred()})}})),processLoadTemplateBuffer()},Renderer.prototype.partialHelper=function(name){var searchKey=this.currentThemeName+"/"+name;return searchKey in templateCache||notification.exception(new Error("Failed to pre-fetch the template: "+name)),templateCache[searchKey]},Renderer.prototype.renderIcon=function(key,component,title){var modulename=config.iconsystemmodule;component=getNormalisedComponent(component);var ready=$.Deferred();return require([modulename],(function(System){var system=new System;system instanceof IconSystem?(iconSystem=system,system.init().then(ready.resolve).catch(notification.exception)):ready.reject("Invalid icon system specified"+config.iconsystemmodule)})),ready.then(function(iconSystem){return this.getTemplate(iconSystem.getTemplateName())}.bind(this)).then((function(template){return iconSystem.renderIcon(key,component,title,template)}))},Renderer.prototype.pixHelper=function(context,sectionText,helper){var parts=sectionText.split(","),key="",component="",text="";parts.length>0&&(key=helper(parts.shift().trim(),context)),parts.length>0&&(component=helper(parts.shift().trim(),context)),parts.length>0&&(text=helper(parts.join(",").trim(),context));var templateName=iconSystem.getTemplateName(),searchKey=this.currentThemeName+"/"+templateName,template=templateCache[searchKey];return component=getNormalisedComponent(component),key=key.replace(/&#x2F;/gi,"/"),iconSystem.renderIcon(key,component,text,template)},Renderer.prototype.jsHelper=function(context,sectionText,helper){return this.requiredJS.push(helper(sectionText,context)),""},Renderer.prototype.stringHelper=function(context,sectionText,helper){var parts=sectionText.split(","),key="",component="",param="";parts.length>0&&(key=parts.shift().trim()),parts.length>0&&(component=parts.shift().trim()),parts.length>0&&(param=parts.join(",").trim()),component=getNormalisedComponent(component),""!==param&&(param=helper(param,context)),0===param.indexOf("{")&&0!==param.indexOf("{{")&&(param=JSON.parse(param));var index=this.requiredStrings.length;return this.requiredStrings.push({key:key,component:component,param:param}),"[[_s"+index+"]]"},Renderer.prototype.quoteHelper=function(context,sectionText,helper){var content=helper(sectionText.trim(),context);return'"'+(content=content.replace(/"/g,'\\"').replace(/([{}]{2,3})/g,"{{=<% %>=}}$1<%={{ }}=%>").replace(/(\r\n|\r|\n)/g,"&#x0a;"))+'"'},Renderer.prototype.shortenTextHelper=function(context,sectionText,helper){var parts=sectionText.match(/(.*?),(.*)/),length=parts[1].trim(),content=helper(parts[2].trim(),context);return Truncate.truncate(content,{length:length,words:!0,ellipsis:"..."})},Renderer.prototype.userDateHelper=function(context,sectionText,helper){var parts=sectionText.match(/(.*?),(.*)/),timestamp=helper(parts[1].trim(),context),format=helper(parts[2].trim(),context),index=this.requiredDates.length;return this.requiredDates.push({timestamp:timestamp,format:format}),"[[_t_"+index+"]]"},Renderer.prototype.addHelperFunction=function(helperFunction,context){return function(){return function(sectionText,helper){var originalHelpers=blacklistedNestedHelpers.reduce((function(carry,name){return context.hasOwnProperty(name)&&(carry[name]=context[name]),carry}),{});blacklistedNestedHelpers.forEach((function(helperName){context[helperName]=function(){return""}}));var result=helperFunction.apply(this,[context,sectionText,helper]);for(var name in originalHelpers)context[name]=originalHelpers[name];return result}.bind(this)}.bind(this)},Renderer.prototype.addHelpers=function(context,themeName){this.currentThemeName=themeName,this.requiredStrings=[],this.requiredJS=[],context.uniqid=uniqInstances++,context.str=this.addHelperFunction(this.stringHelper,context),context.pix=this.addHelperFunction(this.pixHelper,context),context.js=this.addHelperFunction(this.jsHelper,context),context.quote=this.addHelperFunction(this.quoteHelper,context),context.shortentext=this.addHelperFunction(this.shortenTextHelper,context),context.userdate=this.addHelperFunction(this.userDateHelper,context),context.globals={config:config},context.currentTheme=themeName},Renderer.prototype.getJS=function(){var js="";return this.requiredJS.length>0&&(js=this.requiredJS.join(";\n")),js},Renderer.prototype.treatStringsInContent=function(content,strings){var treated,index,strIndex,walker,char,strFinal,pattern=/\[\[_s\d+\]\]/;do{for(treated="",index=content.search(pattern);index>-1;){treated+=content.substring(0,index),strIndex="",walker=4,char=(content=content.substr(index)).substr(walker,1);do{strIndex+=char,walker++,char=content.substr(walker,1)}while("]"!=char);void 0===(strFinal=strings[parseInt(strIndex,10)])&&(Log.debug("Could not find string for pattern [[_s"+strIndex+"]]."),strFinal=""),treated+=strFinal,index=(content=content.substr(6+strIndex.length)).search(pattern)}index=(content=treated+content).search(pattern)}while(index>-1);return content},Renderer.prototype.treatDatesInContent=function(content,dates){return dates.forEach((function(date,index){var re=new RegExp("\\[\\[_t_"+index+"\\]\\]","g");content=content.replace(re,date)})),content},Renderer.prototype.doRender=function(templateSource,context,themeName){this.currentThemeName=themeName;var iconTemplate=iconSystem.getTemplateName(),pendingPromise=new Pending("core/templates:doRender");return this.getTemplate(iconTemplate).then(function(){this.addHelpers(context,themeName);var result=mustache.render(templateSource,context,this.partialHelper.bind(this));return $.Deferred().resolve(result.trim(),this.getJS()).promise()}.bind(this)).then(function(html,js){return this.requiredStrings.length>0?str.get_strings(this.requiredStrings).then(function(strings){return this.requiredDates=this.requiredDates.map(function(date){return{timestamp:this.treatStringsInContent(date.timestamp,strings),format:this.treatStringsInContent(date.format,strings)}}.bind(this)),html=this.treatStringsInContent(html,strings),js=this.treatStringsInContent(js,strings),$.Deferred().resolve(html,js).promise()}.bind(this)):$.Deferred().resolve(html,js).promise()}.bind(this)).then(function(html,js){return this.requiredDates.length>0?UserDate.get(this.requiredDates).then(function(dates){return html=this.treatDatesInContent(html,dates),js=this.treatDatesInContent(js,dates),$.Deferred().resolve(html,js).promise()}.bind(this)):$.Deferred().resolve(html,js).promise()}.bind(this)).then((function(html,js){return pendingPromise.resolve(),$.Deferred().resolve(html,js).promise()}))};var runTemplateJS=function(source){if(""!==source.trim()){var newscript=$("<script>").attr("type","text/javascript").html(source);$("head").append(newscript)}},domReplace=function(element,newHTML,newJS,replaceChildNodes){var replaceNode=$(element);if(replaceNode.length){var newNodes=$(newHTML);return replaceChildNodes?(new Y.NodeList(replaceNode.children().get()).destroy(!0),replaceNode.empty(),replaceNode.append(newNodes)):(new Y.NodeList(replaceNode.get()).destroy(!0),replaceNode.replaceWith(newNodes)),runTemplateJS(newJS),event.notifyFilterContentUpdated(newNodes),newNodes.get()}return[]};Renderer.prototype.scanForPartials=function(templateSource){var partials=[];return function findPartial(tokens,partials){var i,token;for(i=0;i<tokens.length;i++)">"!=(token=tokens[i])[0]&&"<"!=token[0]||partials.push(token[1]),token.length>4&&findPartial(token[4],partials)}(mustache.parse(templateSource),partials),partials},Renderer.prototype.cachePartials=function(templateName,parentage){var searchKey=this.currentThemeName+"/"+templateName;return searchKey in cachePartialPromises||(parentage=parentage||[searchKey],cachePartialPromises[searchKey]=$.Deferred(),this.getTemplate(templateName).then(function(templateSource){var fetchThemAll=this.scanForPartials(templateSource).filter(function(partialName){return!(parentage.indexOf(this.currentThemeName+"/"+partialName)>=0)&&partialName!=templateName}.bind(this)).map(function(partialName){return parentage.push(this.currentThemeName+"/"+partialName),this.cachePartials(partialName,parentage)}.bind(this));return $.when.apply($,fetchThemAll).then((function(){return cachePartialPromises[searchKey].resolve(templateSource)}))}.bind(this)).catch(cachePartialPromises[searchKey].reject)),cachePartialPromises[searchKey]},Renderer.prototype.render=function(templateName,context,themeName){void 0===themeName&&(themeName=config.theme),this.currentThemeName=themeName;var modulename=config.iconsystemmodule,ready=$.Deferred();return require([modulename],(function(System){var system=new System;system instanceof IconSystem?(iconSystem=system,system.init().then(ready.resolve).catch(notification.exception)):ready.reject("Invalid icon system specified"+config.iconsystem)})),ready.then(function(){return this.cachePartials(templateName)}.bind(this)).then(function(templateSource){return this.doRender(templateSource,context,themeName)}.bind(this))};return{render:function(templateName,context,themeName){return(new Renderer).render(templateName,context,themeName)},prefetchTemplates:function(templateNames,themeName){var renderer=new Renderer;return void 0===themeName&&(themeName=config.theme),renderer.prefetchTemplates(templateNames,themeName)},renderForPromise:function(templateName,context,themeName){return(new Renderer).render(templateName,context,themeName).then((function(html,js){return{html:html,js:js}}))},renderPix:function(key,component,title){return(new Renderer).renderIcon(key,getNormalisedComponent(component),title)},runTemplateJS:runTemplateJS,replaceNodeContents:function(element,newHTML,newJS){return domReplace(element,newHTML,newJS,!0)},replaceNode:function(element,newHTML,newJS){return domReplace(element,newHTML,newJS,!1)},prependNodeContents:function(element,html,js){return function(element,html,js){var node=$(element);if(node.length){var newContent=$(html);return node.prepend(newContent),runTemplateJS(js),event.notifyFilterContentUpdated(node),newContent.get()}return[]}(element,html,js)},appendNodeContents:function(element,html,js){return function(element,html,js){var node=$(element);if(node.length){var newContent=$(html);return node.append(newContent),runTemplateJS(js),event.notifyFilterContentUpdated(node),newContent.get()}return[]}(element,html,js)}}}));
define("core/emoji/data",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.byShortName=_exports.byCategory=void 0;_exports.byCategory=[{name:"Smileys & People",emojis:[{unified:"1F600",shortnames:["grinning"]},{unified:"1F601",shortnames:["grin"]},{unified:"1F602",shortnames:["joy"]},{unified:"1F923",shortnames:["rolling_on_the_floor_laughing"]},{unified:"1F603",shortnames:["smiley"]},{unified:"1F604",shortnames:["smile"]},{unified:"1F605",shortnames:["sweat_smile"]},{unified:"1F606",shortnames:["laughing"]},{unified:"1F609",shortnames:["wink"]},{unified:"1F60A",shortnames:["blush"]},{unified:"1F60B",shortnames:["yum"]},{unified:"1F60E",shortnames:["sunglasses"]},{unified:"1F60D",shortnames:["heart_eyes"]},{unified:"1F618",shortnames:["kissing_heart"]},{unified:"1F617",shortnames:["kissing"]},{unified:"1F619",shortnames:["kissing_smiling_eyes"]},{unified:"1F61A",shortnames:["kissing_closed_eyes"]},{unified:"263A-FE0F",shortnames:["relaxed"]},{unified:"1F642",shortnames:["slightly_smiling_face"]},{unified:"1F917",shortnames:["hugging_face"]},{unified:"1F929",shortnames:["star-struck"]},{unified:"1F914",shortnames:["thinking_face"]},{unified:"1F928",shortnames:["face_with_raised_eyebrow"]},{unified:"1F610",shortnames:["neutral_face"]},{unified:"1F611",shortnames:["expressionless"]},{unified:"1F636",shortnames:["no_mouth"]},{unified:"1F644",shortnames:["face_with_rolling_eyes"]},{unified:"1F60F",shortnames:["smirk"]},{unified:"1F623",shortnames:["persevere"]},{unified:"1F625",shortnames:["disappointed_relieved"]},{unified:"1F62E",shortnames:["open_mouth"]},{unified:"1F910",shortnames:["zipper_mouth_face"]},{unified:"1F62F",shortnames:["hushed"]},{unified:"1F62A",shortnames:["sleepy"]},{unified:"1F62B",shortnames:["tired_face"]},{unified:"1F634",shortnames:["sleeping"]},{unified:"1F60C",shortnames:["relieved"]},{unified:"1F61B",shortnames:["stuck_out_tongue"]},{unified:"1F61C",shortnames:["stuck_out_tongue_winking_eye"]},{unified:"1F61D",shortnames:["stuck_out_tongue_closed_eyes"]},{unified:"1F924",shortnames:["drooling_face"]},{unified:"1F612",shortnames:["unamused"]},{unified:"1F613",shortnames:["sweat"]},{unified:"1F614",shortnames:["pensive"]},{unified:"1F615",shortnames:["confused"]},{unified:"1F643",shortnames:["upside_down_face"]},{unified:"1F911",shortnames:["money_mouth_face"]},{unified:"1F632",shortnames:["astonished"]},{unified:"2639-FE0F",shortnames:["white_frowning_face"]},{unified:"1F641",shortnames:["slightly_frowning_face"]},{unified:"1F616",shortnames:["confounded"]},{unified:"1F61E",shortnames:["disappointed"]},{unified:"1F61F",shortnames:["worried"]},{unified:"1F624",shortnames:["triumph"]},{unified:"1F622",shortnames:["cry"]},{unified:"1F62D",shortnames:["sob"]},{unified:"1F626",shortnames:["frowning"]},{unified:"1F627",shortnames:["anguished"]},{unified:"1F628",shortnames:["fearful"]},{unified:"1F629",shortnames:["weary"]},{unified:"1F92F",shortnames:["exploding_head"]},{unified:"1F62C",shortnames:["grimacing"]},{unified:"1F630",shortnames:["cold_sweat"]},{unified:"1F631",shortnames:["scream"]},{unified:"1F633",shortnames:["flushed"]},{unified:"1F92A",shortnames:["zany_face"]},{unified:"1F635",shortnames:["dizzy_face"]},{unified:"1F621",shortnames:["rage"]},{unified:"1F620",shortnames:["angry"]},{unified:"1F92C",shortnames:["face_with_symbols_on_mouth"]},{unified:"1F637",shortnames:["mask"]},{unified:"1F912",shortnames:["face_with_thermometer"]},{unified:"1F915",shortnames:["face_with_head_bandage"]},{unified:"1F922",shortnames:["nauseated_face"]},{unified:"1F92E",shortnames:["face_vomiting"]},{unified:"1F927",shortnames:["sneezing_face"]},{unified:"1F607",shortnames:["innocent"]},{unified:"1F920",shortnames:["face_with_cowboy_hat"]},{unified:"1F921",shortnames:["clown_face"]},{unified:"1F925",shortnames:["lying_face"]},{unified:"1F92B",shortnames:["shushing_face"]},{unified:"1F92D",shortnames:["face_with_hand_over_mouth"]},{unified:"1F9D0",shortnames:["face_with_monocle"]},{unified:"1F913",shortnames:["nerd_face"]},{unified:"1F608",shortnames:["smiling_imp"]},{unified:"1F47F",shortnames:["imp"]},{unified:"1F479",shortnames:["japanese_ogre"]},{unified:"1F47A",shortnames:["japanese_goblin"]},{unified:"1F480",shortnames:["skull"]},{unified:"2620-FE0F",shortnames:["skull_and_crossbones"]},{unified:"1F47B",shortnames:["ghost"]},{unified:"1F47D",shortnames:["alien"]},{unified:"1F47E",shortnames:["space_invader"]},{unified:"1F916",shortnames:["robot_face"]},{unified:"1F4A9",shortnames:["hankey"]},{unified:"1F63A",shortnames:["smiley_cat"]},{unified:"1F638",shortnames:["smile_cat"]},{unified:"1F639",shortnames:["joy_cat"]},{unified:"1F63B",shortnames:["heart_eyes_cat"]},{unified:"1F63C",shortnames:["smirk_cat"]},{unified:"1F63D",shortnames:["kissing_cat"]},{unified:"1F640",shortnames:["scream_cat"]},{unified:"1F63F",shortnames:["crying_cat_face"]},{unified:"1F63E",shortnames:["pouting_cat"]},{unified:"1F648",shortnames:["see_no_evil"]},{unified:"1F649",shortnames:["hear_no_evil"]},{unified:"1F64A",shortnames:["speak_no_evil"]},{unified:"1F476",shortnames:["baby"]},{unified:"1F9D2",shortnames:["child"]},{unified:"1F466",shortnames:["boy"]},{unified:"1F467",shortnames:["girl"]},{unified:"1F9D1",shortnames:["adult"]},{unified:"1F468",shortnames:["man"]},{unified:"1F469",shortnames:["woman"]},{unified:"1F9D3",shortnames:["older_adult"]},{unified:"1F474",shortnames:["older_man"]},{unified:"1F475",shortnames:["older_woman"]},{unified:"1F468-200D-2695-FE0F",shortnames:["male-doctor"]},{unified:"1F469-200D-2695-FE0F",shortnames:["female-doctor"]},{unified:"1F468-200D-1F393",shortnames:["male-student"]},{unified:"1F469-200D-1F393",shortnames:["female-student"]},{unified:"1F468-200D-1F3EB",shortnames:["male-teacher"]},{unified:"1F469-200D-1F3EB",shortnames:["female-teacher"]},{unified:"1F468-200D-2696-FE0F",shortnames:["male-judge"]},{unified:"1F469-200D-2696-FE0F",shortnames:["female-judge"]},{unified:"1F468-200D-1F33E",shortnames:["male-farmer"]},{unified:"1F469-200D-1F33E",shortnames:["female-farmer"]},{unified:"1F468-200D-1F373",shortnames:["male-cook"]},{unified:"1F469-200D-1F373",shortnames:["female-cook"]},{unified:"1F468-200D-1F527",shortnames:["male-mechanic"]},{unified:"1F469-200D-1F527",shortnames:["female-mechanic"]},{unified:"1F468-200D-1F3ED",shortnames:["male-factory-worker"]},{unified:"1F469-200D-1F3ED",shortnames:["female-factory-worker"]},{unified:"1F468-200D-1F4BC",shortnames:["male-office-worker"]},{unified:"1F469-200D-1F4BC",shortnames:["female-office-worker"]},{unified:"1F468-200D-1F52C",shortnames:["male-scientist"]},{unified:"1F469-200D-1F52C",shortnames:["female-scientist"]},{unified:"1F468-200D-1F4BB",shortnames:["male-technologist"]},{unified:"1F469-200D-1F4BB",shortnames:["female-technologist"]},{unified:"1F468-200D-1F3A4",shortnames:["male-singer"]},{unified:"1F469-200D-1F3A4",shortnames:["female-singer"]},{unified:"1F468-200D-1F3A8",shortnames:["male-artist"]},{unified:"1F469-200D-1F3A8",shortnames:["female-artist"]},{unified:"1F468-200D-2708-FE0F",shortnames:["male-pilot"]},{unified:"1F469-200D-2708-FE0F",shortnames:["female-pilot"]},{unified:"1F468-200D-1F680",shortnames:["male-astronaut"]},{unified:"1F469-200D-1F680",shortnames:["female-astronaut"]},{unified:"1F468-200D-1F692",shortnames:["male-firefighter"]},{unified:"1F469-200D-1F692",shortnames:["female-firefighter"]},{unified:"1F46E-200D-2642-FE0F",shortnames:["male-police-officer","cop"]},{unified:"1F46E-200D-2640-FE0F",shortnames:["female-police-officer"]},{unified:"1F575-FE0F-200D-2642-FE0F",shortnames:["male-detective","sleuth_or_spy"]},{unified:"1F575-FE0F-200D-2640-FE0F",shortnames:["female-detective"]},{unified:"1F482-200D-2642-FE0F",shortnames:["male-guard","guardsman"]},{unified:"1F482-200D-2640-FE0F",shortnames:["female-guard"]},{unified:"1F477-200D-2642-FE0F",shortnames:["male-construction-worker","construction_worker"]},{unified:"1F477-200D-2640-FE0F",shortnames:["female-construction-worker"]},{unified:"1F934",shortnames:["prince"]},{unified:"1F478",shortnames:["princess"]},{unified:"1F473-200D-2642-FE0F",shortnames:["man-wearing-turban","man_with_turban"]},{unified:"1F473-200D-2640-FE0F",shortnames:["woman-wearing-turban"]},{unified:"1F472",shortnames:["man_with_gua_pi_mao"]},{unified:"1F9D5",shortnames:["person_with_headscarf"]},{unified:"1F9D4",shortnames:["bearded_person"]},{unified:"1F471-200D-2642-FE0F",shortnames:["blond-haired-man","person_with_blond_hair"]},{unified:"1F471-200D-2640-FE0F",shortnames:["blond-haired-woman"]},{unified:"1F935",shortnames:["man_in_tuxedo"]},{unified:"1F470",shortnames:["bride_with_veil"]},{unified:"1F930",shortnames:["pregnant_woman"]},{unified:"1F931",shortnames:["breast-feeding"]},{unified:"1F47C",shortnames:["angel"]},{unified:"1F385",shortnames:["santa"]},{unified:"1F936",shortnames:["mrs_claus"]},{unified:"1F9D9-200D-2640-FE0F",shortnames:["female_mage","mage"]},{unified:"1F9D9-200D-2642-FE0F",shortnames:["male_mage"]},{unified:"1F9DA-200D-2640-FE0F",shortnames:["female_fairy","fairy"]},{unified:"1F9DA-200D-2642-FE0F",shortnames:["male_fairy"]},{unified:"1F9DB-200D-2640-FE0F",shortnames:["female_vampire","vampire"]},{unified:"1F9DB-200D-2642-FE0F",shortnames:["male_vampire"]},{unified:"1F9DC-200D-2640-FE0F",shortnames:["mermaid"]},{unified:"1F9DC-200D-2642-FE0F",shortnames:["merman","merperson"]},{unified:"1F9DD-200D-2640-FE0F",shortnames:["female_elf"]},{unified:"1F9DD-200D-2642-FE0F",shortnames:["male_elf","elf"]},{unified:"1F9DE-200D-2640-FE0F",shortnames:["female_genie"]},{unified:"1F9DE-200D-2642-FE0F",shortnames:["male_genie","genie"]},{unified:"1F9DF-200D-2640-FE0F",shortnames:["female_zombie"]},{unified:"1F9DF-200D-2642-FE0F",shortnames:["male_zombie","zombie"]},{unified:"1F64D-200D-2642-FE0F",shortnames:["man-frowning"]},{unified:"1F64D-200D-2640-FE0F",shortnames:["woman-frowning","person_frowning"]},{unified:"1F64E-200D-2642-FE0F",shortnames:["man-pouting"]},{unified:"1F64E-200D-2640-FE0F",shortnames:["woman-pouting","person_with_pouting_face"]},{unified:"1F645-200D-2642-FE0F",shortnames:["man-gesturing-no"]},{unified:"1F645-200D-2640-FE0F",shortnames:["woman-gesturing-no","no_good"]},{unified:"1F646-200D-2642-FE0F",shortnames:["man-gesturing-ok"]},{unified:"1F646-200D-2640-FE0F",shortnames:["woman-gesturing-ok","ok_woman"]},{unified:"1F481-200D-2642-FE0F",shortnames:["man-tipping-hand"]},{unified:"1F481-200D-2640-FE0F",shortnames:["woman-tipping-hand","information_desk_person"]},{unified:"1F64B-200D-2642-FE0F",shortnames:["man-raising-hand"]},{unified:"1F64B-200D-2640-FE0F",shortnames:["woman-raising-hand","raising_hand"]},{unified:"1F647-200D-2642-FE0F",shortnames:["man-bowing","bow"]},{unified:"1F647-200D-2640-FE0F",shortnames:["woman-bowing"]},{unified:"1F926",shortnames:["face_palm"]},{unified:"1F926-200D-2642-FE0F",shortnames:["man-facepalming"]},{unified:"1F926-200D-2640-FE0F",shortnames:["woman-facepalming"]},{unified:"1F937",shortnames:["shrug"]},{unified:"1F937-200D-2642-FE0F",shortnames:["man-shrugging"]},{unified:"1F937-200D-2640-FE0F",shortnames:["woman-shrugging"]},{unified:"1F486-200D-2642-FE0F",shortnames:["man-getting-massage"]},{unified:"1F486-200D-2640-FE0F",shortnames:["woman-getting-massage","massage"]},{unified:"1F487-200D-2642-FE0F",shortnames:["man-getting-haircut"]},{unified:"1F487-200D-2640-FE0F",shortnames:["woman-getting-haircut","haircut"]},{unified:"1F6B6-200D-2642-FE0F",shortnames:["man-walking","walking"]},{unified:"1F6B6-200D-2640-FE0F",shortnames:["woman-walking"]},{unified:"1F3C3-200D-2642-FE0F",shortnames:["man-running","runner"]},{unified:"1F3C3-200D-2640-FE0F",shortnames:["woman-running"]},{unified:"1F483",shortnames:["dancer"]},{unified:"1F57A",shortnames:["man_dancing"]},{unified:"1F46F-200D-2642-FE0F",shortnames:["man-with-bunny-ears-partying"]},{unified:"1F46F-200D-2640-FE0F",shortnames:["woman-with-bunny-ears-partying","dancers"]},{unified:"1F9D6-200D-2640-FE0F",shortnames:["woman_in_steamy_room"]},{unified:"1F9D6-200D-2642-FE0F",shortnames:["man_in_steamy_room","person_in_steamy_room"]},{unified:"1F9D7-200D-2640-FE0F",shortnames:["woman_climbing","person_climbing"]},{unified:"1F9D7-200D-2642-FE0F",shortnames:["man_climbing"]},{unified:"1F9D8-200D-2640-FE0F",shortnames:["woman_in_lotus_position","person_in_lotus_position"]},{unified:"1F9D8-200D-2642-FE0F",shortnames:["man_in_lotus_position"]},{unified:"1F6C0",shortnames:["bath"]},{unified:"1F6CC",shortnames:["sleeping_accommodation"]},{unified:"1F574-FE0F",shortnames:["man_in_business_suit_levitating"]},{unified:"1F5E3-FE0F",shortnames:["speaking_head_in_silhouette"]},{unified:"1F464",shortnames:["bust_in_silhouette"]},{unified:"1F465",shortnames:["busts_in_silhouette"]},{unified:"1F93A",shortnames:["fencer"]},{unified:"1F3C7",shortnames:["horse_racing"]},{unified:"26F7-FE0F",shortnames:["skier"]},{unified:"1F3C2",shortnames:["snowboarder"]},{unified:"1F3CC-FE0F-200D-2642-FE0F",shortnames:["man-golfing","golfer"]},{unified:"1F3CC-FE0F-200D-2640-FE0F",shortnames:["woman-golfing"]},{unified:"1F3C4-200D-2642-FE0F",shortnames:["man-surfing","surfer"]},{unified:"1F3C4-200D-2640-FE0F",shortnames:["woman-surfing"]},{unified:"1F6A3-200D-2642-FE0F",shortnames:["man-rowing-boat","rowboat"]},{unified:"1F6A3-200D-2640-FE0F",shortnames:["woman-rowing-boat"]},{unified:"1F3CA-200D-2642-FE0F",shortnames:["man-swimming","swimmer"]},{unified:"1F3CA-200D-2640-FE0F",shortnames:["woman-swimming"]},{unified:"26F9-FE0F-200D-2642-FE0F",shortnames:["man-bouncing-ball","person_with_ball"]},{unified:"26F9-FE0F-200D-2640-FE0F",shortnames:["woman-bouncing-ball"]},{unified:"1F3CB-FE0F-200D-2642-FE0F",shortnames:["man-lifting-weights","weight_lifter"]},{unified:"1F3CB-FE0F-200D-2640-FE0F",shortnames:["woman-lifting-weights"]},{unified:"1F6B4-200D-2642-FE0F",shortnames:["man-biking","bicyclist"]},{unified:"1F6B4-200D-2640-FE0F",shortnames:["woman-biking"]},{unified:"1F6B5-200D-2642-FE0F",shortnames:["man-mountain-biking","mountain_bicyclist"]},{unified:"1F6B5-200D-2640-FE0F",shortnames:["woman-mountain-biking"]},{unified:"1F3CE-FE0F",shortnames:["racing_car"]},{unified:"1F3CD-FE0F",shortnames:["racing_motorcycle"]},{unified:"1F938",shortnames:["person_doing_cartwheel"]},{unified:"1F938-200D-2642-FE0F",shortnames:["man-cartwheeling"]},{unified:"1F938-200D-2640-FE0F",shortnames:["woman-cartwheeling"]},{unified:"1F93C",shortnames:["wrestlers"]},{unified:"1F93C-200D-2642-FE0F",shortnames:["man-wrestling"]},{unified:"1F93C-200D-2640-FE0F",shortnames:["woman-wrestling"]},{unified:"1F93D",shortnames:["water_polo"]},{unified:"1F93D-200D-2642-FE0F",shortnames:["man-playing-water-polo"]},{unified:"1F93D-200D-2640-FE0F",shortnames:["woman-playing-water-polo"]},{unified:"1F93E",shortnames:["handball"]},{unified:"1F93E-200D-2642-FE0F",shortnames:["man-playing-handball"]},{unified:"1F93E-200D-2640-FE0F",shortnames:["woman-playing-handball"]},{unified:"1F939",shortnames:["juggling"]},{unified:"1F939-200D-2642-FE0F",shortnames:["man-juggling"]},{unified:"1F939-200D-2640-FE0F",shortnames:["woman-juggling"]},{unified:"1F46B",shortnames:["couple"]},{unified:"1F46C",shortnames:["two_men_holding_hands"]},{unified:"1F46D",shortnames:["two_women_holding_hands"]},{unified:"1F469-200D-2764-FE0F-200D-1F48B-200D-1F468",shortnames:["woman-kiss-man","couplekiss"]},{unified:"1F468-200D-2764-FE0F-200D-1F48B-200D-1F468",shortnames:["man-kiss-man"]},{unified:"1F469-200D-2764-FE0F-200D-1F48B-200D-1F469",shortnames:["woman-kiss-woman"]},{unified:"1F469-200D-2764-FE0F-200D-1F468",shortnames:["woman-heart-man","couple_with_heart"]},{unified:"1F468-200D-2764-FE0F-200D-1F468",shortnames:["man-heart-man"]},{unified:"1F469-200D-2764-FE0F-200D-1F469",shortnames:["woman-heart-woman"]},{unified:"1F468-200D-1F469-200D-1F466",shortnames:["man-woman-boy","family"]},{unified:"1F468-200D-1F469-200D-1F467",shortnames:["man-woman-girl"]},{unified:"1F468-200D-1F469-200D-1F467-200D-1F466",shortnames:["man-woman-girl-boy"]},{unified:"1F468-200D-1F469-200D-1F466-200D-1F466",shortnames:["man-woman-boy-boy"]},{unified:"1F468-200D-1F469-200D-1F467-200D-1F467",shortnames:["man-woman-girl-girl"]},{unified:"1F468-200D-1F468-200D-1F466",shortnames:["man-man-boy"]},{unified:"1F468-200D-1F468-200D-1F467",shortnames:["man-man-girl"]},{unified:"1F468-200D-1F468-200D-1F467-200D-1F466",shortnames:["man-man-girl-boy"]},{unified:"1F468-200D-1F468-200D-1F466-200D-1F466",shortnames:["man-man-boy-boy"]},{unified:"1F468-200D-1F468-200D-1F467-200D-1F467",shortnames:["man-man-girl-girl"]},{unified:"1F469-200D-1F469-200D-1F466",shortnames:["woman-woman-boy"]},{unified:"1F469-200D-1F469-200D-1F467",shortnames:["woman-woman-girl"]},{unified:"1F469-200D-1F469-200D-1F467-200D-1F466",shortnames:["woman-woman-girl-boy"]},{unified:"1F469-200D-1F469-200D-1F466-200D-1F466",shortnames:["woman-woman-boy-boy"]},{unified:"1F469-200D-1F469-200D-1F467-200D-1F467",shortnames:["woman-woman-girl-girl"]},{unified:"1F468-200D-1F466",shortnames:["man-boy"]},{unified:"1F468-200D-1F466-200D-1F466",shortnames:["man-boy-boy"]},{unified:"1F468-200D-1F467",shortnames:["man-girl"]},{unified:"1F468-200D-1F467-200D-1F466",shortnames:["man-girl-boy"]},{unified:"1F468-200D-1F467-200D-1F467",shortnames:["man-girl-girl"]},{unified:"1F469-200D-1F466",shortnames:["woman-boy"]},{unified:"1F469-200D-1F466-200D-1F466",shortnames:["woman-boy-boy"]},{unified:"1F469-200D-1F467",shortnames:["woman-girl"]},{unified:"1F469-200D-1F467-200D-1F466",shortnames:["woman-girl-boy"]},{unified:"1F469-200D-1F467-200D-1F467",shortnames:["woman-girl-girl"]},{unified:"1F933",shortnames:["selfie"]},{unified:"1F4AA",shortnames:["muscle"]},{unified:"1F448",shortnames:["point_left"]},{unified:"1F449",shortnames:["point_right"]},{unified:"261D-FE0F",shortnames:["point_up"]},{unified:"1F446",shortnames:["point_up_2"]},{unified:"1F595",shortnames:["middle_finger"]},{unified:"1F447",shortnames:["point_down"]},{unified:"270C-FE0F",shortnames:["v"]},{unified:"1F91E",shortnames:["crossed_fingers"]},{unified:"1F596",shortnames:["spock-hand"]},{unified:"1F918",shortnames:["the_horns"]},{unified:"1F919",shortnames:["call_me_hand"]},{unified:"1F590-FE0F",shortnames:["raised_hand_with_fingers_splayed"]},{unified:"270B",shortnames:["hand"]},{unified:"1F44C",shortnames:["ok_hand"]},{unified:"1F44D",shortnames:["+1"]},{unified:"1F44E",shortnames:["-1"]},{unified:"270A",shortnames:["fist"]},{unified:"1F44A",shortnames:["facepunch"]},{unified:"1F91B",shortnames:["left-facing_fist"]},{unified:"1F91C",shortnames:["right-facing_fist"]},{unified:"1F91A",shortnames:["raised_back_of_hand"]},{unified:"1F44B",shortnames:["wave"]},{unified:"1F91F",shortnames:["i_love_you_hand_sign"]},{unified:"270D-FE0F",shortnames:["writing_hand"]},{unified:"1F44F",shortnames:["clap"]},{unified:"1F450",shortnames:["open_hands"]},{unified:"1F64C",shortnames:["raised_hands"]},{unified:"1F932",shortnames:["palms_up_together"]},{unified:"1F64F",shortnames:["pray"]},{unified:"1F91D",shortnames:["handshake"]},{unified:"1F485",shortnames:["nail_care"]},{unified:"1F442",shortnames:["ear"]},{unified:"1F443",shortnames:["nose"]},{unified:"1F463",shortnames:["footprints"]},{unified:"1F440",shortnames:["eyes"]},{unified:"1F441-FE0F",shortnames:["eye"]},{unified:"1F441-FE0F-200D-1F5E8-FE0F",shortnames:["eye-in-speech-bubble"]},{unified:"1F9E0",shortnames:["brain"]},{unified:"1F445",shortnames:["tongue"]},{unified:"1F444",shortnames:["lips"]},{unified:"1F48B",shortnames:["kiss"]},{unified:"1F498",shortnames:["cupid"]},{unified:"2764-FE0F",shortnames:["heart"]},{unified:"1F493",shortnames:["heartbeat"]},{unified:"1F494",shortnames:["broken_heart"]},{unified:"1F495",shortnames:["two_hearts"]},{unified:"1F496",shortnames:["sparkling_heart"]},{unified:"1F497",shortnames:["heartpulse"]},{unified:"1F499",shortnames:["blue_heart"]},{unified:"1F49A",shortnames:["green_heart"]},{unified:"1F49B",shortnames:["yellow_heart"]},{unified:"1F9E1",shortnames:["orange_heart"]},{unified:"1F49C",shortnames:["purple_heart"]},{unified:"1F5A4",shortnames:["black_heart"]},{unified:"1F49D",shortnames:["gift_heart"]},{unified:"1F49E",shortnames:["revolving_hearts"]},{unified:"1F49F",shortnames:["heart_decoration"]},{unified:"2763-FE0F",shortnames:["heavy_heart_exclamation_mark_ornament"]},{unified:"1F48C",shortnames:["love_letter"]},{unified:"1F4A4",shortnames:["zzz"]},{unified:"1F4A2",shortnames:["anger"]},{unified:"1F4A3",shortnames:["bomb"]},{unified:"1F4A5",shortnames:["boom"]},{unified:"1F4A6",shortnames:["sweat_drops"]},{unified:"1F4A8",shortnames:["dash"]},{unified:"1F4AB",shortnames:["dizzy"]},{unified:"1F4AC",shortnames:["speech_balloon"]},{unified:"1F5E8-FE0F",shortnames:["left_speech_bubble"]},{unified:"1F5EF-FE0F",shortnames:["right_anger_bubble"]},{unified:"1F4AD",shortnames:["thought_balloon"]},{unified:"1F573-FE0F",shortnames:["hole"]},{unified:"1F453",shortnames:["eyeglasses"]},{unified:"1F576-FE0F",shortnames:["dark_sunglasses"]},{unified:"1F454",shortnames:["necktie"]},{unified:"1F455",shortnames:["shirt"]},{unified:"1F456",shortnames:["jeans"]},{unified:"1F9E3",shortnames:["scarf"]},{unified:"1F9E4",shortnames:["gloves"]},{unified:"1F9E5",shortnames:["coat"]},{unified:"1F9E6",shortnames:["socks"]},{unified:"1F457",shortnames:["dress"]},{unified:"1F458",shortnames:["kimono"]},{unified:"1F459",shortnames:["bikini"]},{unified:"1F45A",shortnames:["womans_clothes"]},{unified:"1F45B",shortnames:["purse"]},{unified:"1F45C",shortnames:["handbag"]},{unified:"1F45D",shortnames:["pouch"]},{unified:"1F6CD-FE0F",shortnames:["shopping_bags"]},{unified:"1F392",shortnames:["school_satchel"]},{unified:"1F45E",shortnames:["mans_shoe"]},{unified:"1F45F",shortnames:["athletic_shoe"]},{unified:"1F460",shortnames:["high_heel"]},{unified:"1F461",shortnames:["sandal"]},{unified:"1F462",shortnames:["boot"]},{unified:"1F451",shortnames:["crown"]},{unified:"1F452",shortnames:["womans_hat"]},{unified:"1F3A9",shortnames:["tophat"]},{unified:"1F393",shortnames:["mortar_board"]},{unified:"1F9E2",shortnames:["billed_cap"]},{unified:"26D1-FE0F",shortnames:["helmet_with_white_cross"]},{unified:"1F4FF",shortnames:["prayer_beads"]},{unified:"1F484",shortnames:["lipstick"]},{unified:"1F48D",shortnames:["ring"]},{unified:"1F48E",shortnames:["gem"]}]},{name:"Animals & Nature",emojis:[{unified:"1F435",shortnames:["monkey_face"]},{unified:"1F412",shortnames:["monkey"]},{unified:"1F98D",shortnames:["gorilla"]},{unified:"1F436",shortnames:["dog"]},{unified:"1F415",shortnames:["dog2"]},{unified:"1F429",shortnames:["poodle"]},{unified:"1F43A",shortnames:["wolf"]},{unified:"1F98A",shortnames:["fox_face"]},{unified:"1F431",shortnames:["cat"]},{unified:"1F408",shortnames:["cat2"]},{unified:"1F981",shortnames:["lion_face"]},{unified:"1F42F",shortnames:["tiger"]},{unified:"1F405",shortnames:["tiger2"]},{unified:"1F406",shortnames:["leopard"]},{unified:"1F434",shortnames:["horse"]},{unified:"1F40E",shortnames:["racehorse"]},{unified:"1F984",shortnames:["unicorn_face"]},{unified:"1F993",shortnames:["zebra_face"]},{unified:"1F98C",shortnames:["deer"]},{unified:"1F42E",shortnames:["cow"]},{unified:"1F402",shortnames:["ox"]},{unified:"1F403",shortnames:["water_buffalo"]},{unified:"1F404",shortnames:["cow2"]},{unified:"1F437",shortnames:["pig"]},{unified:"1F416",shortnames:["pig2"]},{unified:"1F417",shortnames:["boar"]},{unified:"1F43D",shortnames:["pig_nose"]},{unified:"1F40F",shortnames:["ram"]},{unified:"1F411",shortnames:["sheep"]},{unified:"1F410",shortnames:["goat"]},{unified:"1F42A",shortnames:["dromedary_camel"]},{unified:"1F42B",shortnames:["camel"]},{unified:"1F992",shortnames:["giraffe_face"]},{unified:"1F418",shortnames:["elephant"]},{unified:"1F98F",shortnames:["rhinoceros"]},{unified:"1F42D",shortnames:["mouse"]},{unified:"1F401",shortnames:["mouse2"]},{unified:"1F400",shortnames:["rat"]},{unified:"1F439",shortnames:["hamster"]},{unified:"1F430",shortnames:["rabbit"]},{unified:"1F407",shortnames:["rabbit2"]},{unified:"1F43F-FE0F",shortnames:["chipmunk"]},{unified:"1F994",shortnames:["hedgehog"]},{unified:"1F987",shortnames:["bat"]},{unified:"1F43B",shortnames:["bear"]},{unified:"1F428",shortnames:["koala"]},{unified:"1F43C",shortnames:["panda_face"]},{unified:"1F43E",shortnames:["feet"]},{unified:"1F983",shortnames:["turkey"]},{unified:"1F414",shortnames:["chicken"]},{unified:"1F413",shortnames:["rooster"]},{unified:"1F423",shortnames:["hatching_chick"]},{unified:"1F424",shortnames:["baby_chick"]},{unified:"1F425",shortnames:["hatched_chick"]},{unified:"1F426",shortnames:["bird"]},{unified:"1F427",shortnames:["penguin"]},{unified:"1F54A-FE0F",shortnames:["dove_of_peace"]},{unified:"1F985",shortnames:["eagle"]},{unified:"1F986",shortnames:["duck"]},{unified:"1F989",shortnames:["owl"]},{unified:"1F438",shortnames:["frog"]},{unified:"1F40A",shortnames:["crocodile"]},{unified:"1F422",shortnames:["turtle"]},{unified:"1F98E",shortnames:["lizard"]},{unified:"1F40D",shortnames:["snake"]},{unified:"1F432",shortnames:["dragon_face"]},{unified:"1F409",shortnames:["dragon"]},{unified:"1F995",shortnames:["sauropod"]},{unified:"1F996",shortnames:["t-rex"]},{unified:"1F433",shortnames:["whale"]},{unified:"1F40B",shortnames:["whale2"]},{unified:"1F42C",shortnames:["dolphin"]},{unified:"1F41F",shortnames:["fish"]},{unified:"1F420",shortnames:["tropical_fish"]},{unified:"1F421",shortnames:["blowfish"]},{unified:"1F988",shortnames:["shark"]},{unified:"1F419",shortnames:["octopus"]},{unified:"1F41A",shortnames:["shell"]},{unified:"1F980",shortnames:["crab"]},{unified:"1F990",shortnames:["shrimp"]},{unified:"1F991",shortnames:["squid"]},{unified:"1F40C",shortnames:["snail"]},{unified:"1F98B",shortnames:["butterfly"]},{unified:"1F41B",shortnames:["bug"]},{unified:"1F41C",shortnames:["ant"]},{unified:"1F41D",shortnames:["bee"]},{unified:"1F41E",shortnames:["beetle"]},{unified:"1F997",shortnames:["cricket"]},{unified:"1F577-FE0F",shortnames:["spider"]},{unified:"1F578-FE0F",shortnames:["spider_web"]},{unified:"1F982",shortnames:["scorpion"]},{unified:"1F490",shortnames:["bouquet"]},{unified:"1F338",shortnames:["cherry_blossom"]},{unified:"1F4AE",shortnames:["white_flower"]},{unified:"1F3F5-FE0F",shortnames:["rosette"]},{unified:"1F339",shortnames:["rose"]},{unified:"1F940",shortnames:["wilted_flower"]},{unified:"1F33A",shortnames:["hibiscus"]},{unified:"1F33B",shortnames:["sunflower"]},{unified:"1F33C",shortnames:["blossom"]},{unified:"1F337",shortnames:["tulip"]},{unified:"1F331",shortnames:["seedling"]},{unified:"1F332",shortnames:["evergreen_tree"]},{unified:"1F333",shortnames:["deciduous_tree"]},{unified:"1F334",shortnames:["palm_tree"]},{unified:"1F335",shortnames:["cactus"]},{unified:"1F33E",shortnames:["ear_of_rice"]},{unified:"1F33F",shortnames:["herb"]},{unified:"2618-FE0F",shortnames:["shamrock"]},{unified:"1F340",shortnames:["four_leaf_clover"]},{unified:"1F341",shortnames:["maple_leaf"]},{unified:"1F342",shortnames:["fallen_leaf"]},{unified:"1F343",shortnames:["leaves"]}]},{name:"Food & Drink",emojis:[{unified:"1F347",shortnames:["grapes"]},{unified:"1F348",shortnames:["melon"]},{unified:"1F349",shortnames:["watermelon"]},{unified:"1F34A",shortnames:["tangerine"]},{unified:"1F34B",shortnames:["lemon"]},{unified:"1F34C",shortnames:["banana"]},{unified:"1F34D",shortnames:["pineapple"]},{unified:"1F34E",shortnames:["apple"]},{unified:"1F34F",shortnames:["green_apple"]},{unified:"1F350",shortnames:["pear"]},{unified:"1F351",shortnames:["peach"]},{unified:"1F352",shortnames:["cherries"]},{unified:"1F353",shortnames:["strawberry"]},{unified:"1F95D",shortnames:["kiwifruit"]},{unified:"1F345",shortnames:["tomato"]},{unified:"1F965",shortnames:["coconut"]},{unified:"1F951",shortnames:["avocado"]},{unified:"1F346",shortnames:["eggplant"]},{unified:"1F954",shortnames:["potato"]},{unified:"1F955",shortnames:["carrot"]},{unified:"1F33D",shortnames:["corn"]},{unified:"1F336-FE0F",shortnames:["hot_pepper"]},{unified:"1F952",shortnames:["cucumber"]},{unified:"1F966",shortnames:["broccoli"]},{unified:"1F344",shortnames:["mushroom"]},{unified:"1F95C",shortnames:["peanuts"]},{unified:"1F330",shortnames:["chestnut"]},{unified:"1F35E",shortnames:["bread"]},{unified:"1F950",shortnames:["croissant"]},{unified:"1F956",shortnames:["baguette_bread"]},{unified:"1F968",shortnames:["pretzel"]},{unified:"1F95E",shortnames:["pancakes"]},{unified:"1F9C0",shortnames:["cheese_wedge"]},{unified:"1F356",shortnames:["meat_on_bone"]},{unified:"1F357",shortnames:["poultry_leg"]},{unified:"1F969",shortnames:["cut_of_meat"]},{unified:"1F953",shortnames:["bacon"]},{unified:"1F354",shortnames:["hamburger"]},{unified:"1F35F",shortnames:["fries"]},{unified:"1F355",shortnames:["pizza"]},{unified:"1F32D",shortnames:["hotdog"]},{unified:"1F96A",shortnames:["sandwich"]},{unified:"1F32E",shortnames:["taco"]},{unified:"1F32F",shortnames:["burrito"]},{unified:"1F959",shortnames:["stuffed_flatbread"]},{unified:"1F95A",shortnames:["egg"]},{unified:"1F373",shortnames:["fried_egg"]},{unified:"1F958",shortnames:["shallow_pan_of_food"]},{unified:"1F372",shortnames:["stew"]},{unified:"1F963",shortnames:["bowl_with_spoon"]},{unified:"1F957",shortnames:["green_salad"]},{unified:"1F37F",shortnames:["popcorn"]},{unified:"1F96B",shortnames:["canned_food"]},{unified:"1F371",shortnames:["bento"]},{unified:"1F358",shortnames:["rice_cracker"]},{unified:"1F359",shortnames:["rice_ball"]},{unified:"1F35A",shortnames:["rice"]},{unified:"1F35B",shortnames:["curry"]},{unified:"1F35C",shortnames:["ramen"]},{unified:"1F35D",shortnames:["spaghetti"]},{unified:"1F360",shortnames:["sweet_potato"]},{unified:"1F362",shortnames:["oden"]},{unified:"1F363",shortnames:["sushi"]},{unified:"1F364",shortnames:["fried_shrimp"]},{unified:"1F365",shortnames:["fish_cake"]},{unified:"1F361",shortnames:["dango"]},{unified:"1F95F",shortnames:["dumpling"]},{unified:"1F960",shortnames:["fortune_cookie"]},{unified:"1F961",shortnames:["takeout_box"]},{unified:"1F366",shortnames:["icecream"]},{unified:"1F367",shortnames:["shaved_ice"]},{unified:"1F368",shortnames:["ice_cream"]},{unified:"1F369",shortnames:["doughnut"]},{unified:"1F36A",shortnames:["cookie"]},{unified:"1F382",shortnames:["birthday"]},{unified:"1F370",shortnames:["cake"]},{unified:"1F967",shortnames:["pie"]},{unified:"1F36B",shortnames:["chocolate_bar"]},{unified:"1F36C",shortnames:["candy"]},{unified:"1F36D",shortnames:["lollipop"]},{unified:"1F36E",shortnames:["custard"]},{unified:"1F36F",shortnames:["honey_pot"]},{unified:"1F37C",shortnames:["baby_bottle"]},{unified:"1F95B",shortnames:["glass_of_milk"]},{unified:"2615",shortnames:["coffee"]},{unified:"1F375",shortnames:["tea"]},{unified:"1F376",shortnames:["sake"]},{unified:"1F37E",shortnames:["champagne"]},{unified:"1F377",shortnames:["wine_glass"]},{unified:"1F378",shortnames:["cocktail"]},{unified:"1F379",shortnames:["tropical_drink"]},{unified:"1F37A",shortnames:["beer"]},{unified:"1F37B",shortnames:["beers"]},{unified:"1F942",shortnames:["clinking_glasses"]},{unified:"1F943",shortnames:["tumbler_glass"]},{unified:"1F964",shortnames:["cup_with_straw"]},{unified:"1F962",shortnames:["chopsticks"]},{unified:"1F37D-FE0F",shortnames:["knife_fork_plate"]},{unified:"1F374",shortnames:["fork_and_knife"]},{unified:"1F944",shortnames:["spoon"]},{unified:"1F52A",shortnames:["hocho"]},{unified:"1F3FA",shortnames:["amphora"]}]},{name:"Travel & Places",emojis:[{unified:"1F30D",shortnames:["earth_africa"]},{unified:"1F30E",shortnames:["earth_americas"]},{unified:"1F30F",shortnames:["earth_asia"]},{unified:"1F310",shortnames:["globe_with_meridians"]},{unified:"1F5FA-FE0F",shortnames:["world_map"]},{unified:"1F5FE",shortnames:["japan"]},{unified:"1F3D4-FE0F",shortnames:["snow_capped_mountain"]},{unified:"26F0-FE0F",shortnames:["mountain"]},{unified:"1F30B",shortnames:["volcano"]},{unified:"1F5FB",shortnames:["mount_fuji"]},{unified:"1F3D5-FE0F",shortnames:["camping"]},{unified:"1F3D6-FE0F",shortnames:["beach_with_umbrella"]},{unified:"1F3DC-FE0F",shortnames:["desert"]},{unified:"1F3DD-FE0F",shortnames:["desert_island"]},{unified:"1F3DE-FE0F",shortnames:["national_park"]},{unified:"1F3DF-FE0F",shortnames:["stadium"]},{unified:"1F3DB-FE0F",shortnames:["classical_building"]},{unified:"1F3D7-FE0F",shortnames:["building_construction"]},{unified:"1F3D8-FE0F",shortnames:["house_buildings"]},{unified:"1F3D9-FE0F",shortnames:["cityscape"]},{unified:"1F3DA-FE0F",shortnames:["derelict_house_building"]},{unified:"1F3E0",shortnames:["house"]},{unified:"1F3E1",shortnames:["house_with_garden"]},{unified:"1F3E2",shortnames:["office"]},{unified:"1F3E3",shortnames:["post_office"]},{unified:"1F3E4",shortnames:["european_post_office"]},{unified:"1F3E5",shortnames:["hospital"]},{unified:"1F3E6",shortnames:["bank"]},{unified:"1F3E8",shortnames:["hotel"]},{unified:"1F3E9",shortnames:["love_hotel"]},{unified:"1F3EA",shortnames:["convenience_store"]},{unified:"1F3EB",shortnames:["school"]},{unified:"1F3EC",shortnames:["department_store"]},{unified:"1F3ED",shortnames:["factory"]},{unified:"1F3EF",shortnames:["japanese_castle"]},{unified:"1F3F0",shortnames:["european_castle"]},{unified:"1F492",shortnames:["wedding"]},{unified:"1F5FC",shortnames:["tokyo_tower"]},{unified:"1F5FD",shortnames:["statue_of_liberty"]},{unified:"26EA",shortnames:["church"]},{unified:"1F54C",shortnames:["mosque"]},{unified:"1F54D",shortnames:["synagogue"]},{unified:"26E9-FE0F",shortnames:["shinto_shrine"]},{unified:"1F54B",shortnames:["kaaba"]},{unified:"26F2",shortnames:["fountain"]},{unified:"26FA",shortnames:["tent"]},{unified:"1F301",shortnames:["foggy"]},{unified:"1F303",shortnames:["night_with_stars"]},{unified:"1F304",shortnames:["sunrise_over_mountains"]},{unified:"1F305",shortnames:["sunrise"]},{unified:"1F306",shortnames:["city_sunset"]},{unified:"1F307",shortnames:["city_sunrise"]},{unified:"1F309",shortnames:["bridge_at_night"]},{unified:"2668-FE0F",shortnames:["hotsprings"]},{unified:"1F30C",shortnames:["milky_way"]},{unified:"1F3A0",shortnames:["carousel_horse"]},{unified:"1F3A1",shortnames:["ferris_wheel"]},{unified:"1F3A2",shortnames:["roller_coaster"]},{unified:"1F488",shortnames:["barber"]},{unified:"1F3AA",shortnames:["circus_tent"]},{unified:"1F3AD",shortnames:["performing_arts"]},{unified:"1F5BC-FE0F",shortnames:["frame_with_picture"]},{unified:"1F3A8",shortnames:["art"]},{unified:"1F3B0",shortnames:["slot_machine"]},{unified:"1F682",shortnames:["steam_locomotive"]},{unified:"1F683",shortnames:["railway_car"]},{unified:"1F684",shortnames:["bullettrain_side"]},{unified:"1F685",shortnames:["bullettrain_front"]},{unified:"1F686",shortnames:["train2"]},{unified:"1F687",shortnames:["metro"]},{unified:"1F688",shortnames:["light_rail"]},{unified:"1F689",shortnames:["station"]},{unified:"1F68A",shortnames:["tram"]},{unified:"1F69D",shortnames:["monorail"]},{unified:"1F69E",shortnames:["mountain_railway"]},{unified:"1F68B",shortnames:["train"]},{unified:"1F68C",shortnames:["bus"]},{unified:"1F68D",shortnames:["oncoming_bus"]},{unified:"1F68E",shortnames:["trolleybus"]},{unified:"1F690",shortnames:["minibus"]},{unified:"1F691",shortnames:["ambulance"]},{unified:"1F692",shortnames:["fire_engine"]},{unified:"1F693",shortnames:["police_car"]},{unified:"1F694",shortnames:["oncoming_police_car"]},{unified:"1F695",shortnames:["taxi"]},{unified:"1F696",shortnames:["oncoming_taxi"]},{unified:"1F697",shortnames:["car"]},{unified:"1F698",shortnames:["oncoming_automobile"]},{unified:"1F699",shortnames:["blue_car"]},{unified:"1F69A",shortnames:["truck"]},{unified:"1F69B",shortnames:["articulated_lorry"]},{unified:"1F69C",shortnames:["tractor"]},{unified:"1F6B2",shortnames:["bike"]},{unified:"1F6F4",shortnames:["scooter"]},{unified:"1F6F5",shortnames:["motor_scooter"]},{unified:"1F68F",shortnames:["busstop"]},{unified:"1F6E3-FE0F",shortnames:["motorway"]},{unified:"1F6E4-FE0F",shortnames:["railway_track"]},{unified:"26FD",shortnames:["fuelpump"]},{unified:"1F6A8",shortnames:["rotating_light"]},{unified:"1F6A5",shortnames:["traffic_light"]},{unified:"1F6A6",shortnames:["vertical_traffic_light"]},{unified:"1F6A7",shortnames:["construction"]},{unified:"1F6D1",shortnames:["octagonal_sign"]},{unified:"2693",shortnames:["anchor"]},{unified:"26F5",shortnames:["boat"]},{unified:"1F6F6",shortnames:["canoe"]},{unified:"1F6A4",shortnames:["speedboat"]},{unified:"1F6F3-FE0F",shortnames:["passenger_ship"]},{unified:"26F4-FE0F",shortnames:["ferry"]},{unified:"1F6E5-FE0F",shortnames:["motor_boat"]},{unified:"1F6A2",shortnames:["ship"]},{unified:"2708-FE0F",shortnames:["airplane"]},{unified:"1F6E9-FE0F",shortnames:["small_airplane"]},{unified:"1F6EB",shortnames:["airplane_departure"]},{unified:"1F6EC",shortnames:["airplane_arriving"]},{unified:"1F4BA",shortnames:["seat"]},{unified:"1F681",shortnames:["helicopter"]},{unified:"1F69F",shortnames:["suspension_railway"]},{unified:"1F6A0",shortnames:["mountain_cableway"]},{unified:"1F6A1",shortnames:["aerial_tramway"]},{unified:"1F6F0-FE0F",shortnames:["satellite"]},{unified:"1F680",shortnames:["rocket"]},{unified:"1F6F8",shortnames:["flying_saucer"]},{unified:"1F6CE-FE0F",shortnames:["bellhop_bell"]},{unified:"1F6AA",shortnames:["door"]},{unified:"1F6CF-FE0F",shortnames:["bed"]},{unified:"1F6CB-FE0F",shortnames:["couch_and_lamp"]},{unified:"1F6BD",shortnames:["toilet"]},{unified:"1F6BF",shortnames:["shower"]},{unified:"1F6C1",shortnames:["bathtub"]},{unified:"231B",shortnames:["hourglass"]},{unified:"23F3",shortnames:["hourglass_flowing_sand"]},{unified:"231A",shortnames:["watch"]},{unified:"23F0",shortnames:["alarm_clock"]},{unified:"23F1-FE0F",shortnames:["stopwatch"]},{unified:"23F2-FE0F",shortnames:["timer_clock"]},{unified:"1F570-FE0F",shortnames:["mantelpiece_clock"]},{unified:"1F55B",shortnames:["clock12"]},{unified:"1F567",shortnames:["clock1230"]},{unified:"1F550",shortnames:["clock1"]},{unified:"1F55C",shortnames:["clock130"]},{unified:"1F551",shortnames:["clock2"]},{unified:"1F55D",shortnames:["clock230"]},{unified:"1F552",shortnames:["clock3"]},{unified:"1F55E",shortnames:["clock330"]},{unified:"1F553",shortnames:["clock4"]},{unified:"1F55F",shortnames:["clock430"]},{unified:"1F554",shortnames:["clock5"]},{unified:"1F560",shortnames:["clock530"]},{unified:"1F555",shortnames:["clock6"]},{unified:"1F561",shortnames:["clock630"]},{unified:"1F556",shortnames:["clock7"]},{unified:"1F562",shortnames:["clock730"]},{unified:"1F557",shortnames:["clock8"]},{unified:"1F563",shortnames:["clock830"]},{unified:"1F558",shortnames:["clock9"]},{unified:"1F564",shortnames:["clock930"]},{unified:"1F559",shortnames:["clock10"]},{unified:"1F565",shortnames:["clock1030"]},{unified:"1F55A",shortnames:["clock11"]},{unified:"1F566",shortnames:["clock1130"]},{unified:"1F311",shortnames:["new_moon"]},{unified:"1F312",shortnames:["waxing_crescent_moon"]},{unified:"1F313",shortnames:["first_quarter_moon"]},{unified:"1F314",shortnames:["moon"]},{unified:"1F315",shortnames:["full_moon"]},{unified:"1F316",shortnames:["waning_gibbous_moon"]},{unified:"1F317",shortnames:["last_quarter_moon"]},{unified:"1F318",shortnames:["waning_crescent_moon"]},{unified:"1F319",shortnames:["crescent_moon"]},{unified:"1F31A",shortnames:["new_moon_with_face"]},{unified:"1F31B",shortnames:["first_quarter_moon_with_face"]},{unified:"1F31C",shortnames:["last_quarter_moon_with_face"]},{unified:"1F321-FE0F",shortnames:["thermometer"]},{unified:"2600-FE0F",shortnames:["sunny"]},{unified:"1F31D",shortnames:["full_moon_with_face"]},{unified:"1F31E",shortnames:["sun_with_face"]},{unified:"2B50",shortnames:["star"]},{unified:"1F31F",shortnames:["star2"]},{unified:"1F320",shortnames:["stars"]},{unified:"2601-FE0F",shortnames:["cloud"]},{unified:"26C5",shortnames:["partly_sunny"]},{unified:"26C8-FE0F",shortnames:["thunder_cloud_and_rain"]},{unified:"1F324-FE0F",shortnames:["mostly_sunny"]},{unified:"1F325-FE0F",shortnames:["barely_sunny"]},{unified:"1F326-FE0F",shortnames:["partly_sunny_rain"]},{unified:"1F327-FE0F",shortnames:["rain_cloud"]},{unified:"1F328-FE0F",shortnames:["snow_cloud"]},{unified:"1F329-FE0F",shortnames:["lightning"]},{unified:"1F32A-FE0F",shortnames:["tornado"]},{unified:"1F32B-FE0F",shortnames:["fog"]},{unified:"1F32C-FE0F",shortnames:["wind_blowing_face"]},{unified:"1F300",shortnames:["cyclone"]},{unified:"1F308",shortnames:["rainbow"]},{unified:"1F302",shortnames:["closed_umbrella"]},{unified:"2602-FE0F",shortnames:["umbrella"]},{unified:"2614",shortnames:["umbrella_with_rain_drops"]},{unified:"26F1-FE0F",shortnames:["umbrella_on_ground"]},{unified:"26A1",shortnames:["zap"]},{unified:"2744-FE0F",shortnames:["snowflake"]},{unified:"2603-FE0F",shortnames:["snowman"]},{unified:"26C4",shortnames:["snowman_without_snow"]},{unified:"2604-FE0F",shortnames:["comet"]},{unified:"1F525",shortnames:["fire"]},{unified:"1F4A7",shortnames:["droplet"]},{unified:"1F30A",shortnames:["ocean"]}]},{name:"Activities",emojis:[{unified:"1F383",shortnames:["jack_o_lantern"]},{unified:"1F384",shortnames:["christmas_tree"]},{unified:"1F386",shortnames:["fireworks"]},{unified:"1F387",shortnames:["sparkler"]},{unified:"2728",shortnames:["sparkles"]},{unified:"1F388",shortnames:["balloon"]},{unified:"1F389",shortnames:["tada"]},{unified:"1F38A",shortnames:["confetti_ball"]},{unified:"1F38B",shortnames:["tanabata_tree"]},{unified:"1F38D",shortnames:["bamboo"]},{unified:"1F38E",shortnames:["dolls"]},{unified:"1F38F",shortnames:["flags"]},{unified:"1F390",shortnames:["wind_chime"]},{unified:"1F391",shortnames:["rice_scene"]},{unified:"1F380",shortnames:["ribbon"]},{unified:"1F381",shortnames:["gift"]},{unified:"1F397-FE0F",shortnames:["reminder_ribbon"]},{unified:"1F39F-FE0F",shortnames:["admission_tickets"]},{unified:"1F3AB",shortnames:["ticket"]},{unified:"1F396-FE0F",shortnames:["medal"]},{unified:"1F3C6",shortnames:["trophy"]},{unified:"1F3C5",shortnames:["sports_medal"]},{unified:"1F947",shortnames:["first_place_medal"]},{unified:"1F948",shortnames:["second_place_medal"]},{unified:"1F949",shortnames:["third_place_medal"]},{unified:"26BD",shortnames:["soccer"]},{unified:"26BE",shortnames:["baseball"]},{unified:"1F3C0",shortnames:["basketball"]},{unified:"1F3D0",shortnames:["volleyball"]},{unified:"1F3C8",shortnames:["football"]},{unified:"1F3C9",shortnames:["rugby_football"]},{unified:"1F3BE",shortnames:["tennis"]},{unified:"1F3B1",shortnames:["8ball"]},{unified:"1F3B3",shortnames:["bowling"]},{unified:"1F3CF",shortnames:["cricket_bat_and_ball"]},{unified:"1F3D1",shortnames:["field_hockey_stick_and_ball"]},{unified:"1F3D2",shortnames:["ice_hockey_stick_and_puck"]},{unified:"1F3D3",shortnames:["table_tennis_paddle_and_ball"]},{unified:"1F3F8",shortnames:["badminton_racquet_and_shuttlecock"]},{unified:"1F94A",shortnames:["boxing_glove"]},{unified:"1F94B",shortnames:["martial_arts_uniform"]},{unified:"1F945",shortnames:["goal_net"]},{unified:"1F3AF",shortnames:["dart"]},{unified:"26F3",shortnames:["golf"]},{unified:"26F8-FE0F",shortnames:["ice_skate"]},{unified:"1F3A3",shortnames:["fishing_pole_and_fish"]},{unified:"1F3BD",shortnames:["running_shirt_with_sash"]},{unified:"1F3BF",shortnames:["ski"]},{unified:"1F6F7",shortnames:["sled"]},{unified:"1F94C",shortnames:["curling_stone"]},{unified:"1F3AE",shortnames:["video_game"]},{unified:"1F579-FE0F",shortnames:["joystick"]},{unified:"1F3B2",shortnames:["game_die"]},{unified:"2660-FE0F",shortnames:["spades"]},{unified:"2665-FE0F",shortnames:["hearts"]},{unified:"2666-FE0F",shortnames:["diamonds"]},{unified:"2663-FE0F",shortnames:["clubs"]},{unified:"1F0CF",shortnames:["black_joker"]},{unified:"1F004",shortnames:["mahjong"]},{unified:"1F3B4",shortnames:["flower_playing_cards"]}]},{name:"Objects",emojis:[{unified:"1F507",shortnames:["mute"]},{unified:"1F508",shortnames:["speaker"]},{unified:"1F509",shortnames:["sound"]},{unified:"1F50A",shortnames:["loud_sound"]},{unified:"1F4E2",shortnames:["loudspeaker"]},{unified:"1F4E3",shortnames:["mega"]},{unified:"1F4EF",shortnames:["postal_horn"]},{unified:"1F514",shortnames:["bell"]},{unified:"1F515",shortnames:["no_bell"]},{unified:"1F3BC",shortnames:["musical_score"]},{unified:"1F3B5",shortnames:["musical_note"]},{unified:"1F3B6",shortnames:["notes"]},{unified:"1F399-FE0F",shortnames:["studio_microphone"]},{unified:"1F39A-FE0F",shortnames:["level_slider"]},{unified:"1F39B-FE0F",shortnames:["control_knobs"]},{unified:"1F3A4",shortnames:["microphone"]},{unified:"1F3A7",shortnames:["headphones"]},{unified:"1F4FB",shortnames:["radio"]},{unified:"1F3B7",shortnames:["saxophone"]},{unified:"1F3B8",shortnames:["guitar"]},{unified:"1F3B9",shortnames:["musical_keyboard"]},{unified:"1F3BA",shortnames:["trumpet"]},{unified:"1F3BB",shortnames:["violin"]},{unified:"1F941",shortnames:["drum_with_drumsticks"]},{unified:"1F4F1",shortnames:["iphone"]},{unified:"1F4F2",shortnames:["calling"]},{unified:"260E-FE0F",shortnames:["phone"]},{unified:"1F4DE",shortnames:["telephone_receiver"]},{unified:"1F4DF",shortnames:["pager"]},{unified:"1F4E0",shortnames:["fax"]},{unified:"1F50B",shortnames:["battery"]},{unified:"1F50C",shortnames:["electric_plug"]},{unified:"1F4BB",shortnames:["computer"]},{unified:"1F5A5-FE0F",shortnames:["desktop_computer"]},{unified:"1F5A8-FE0F",shortnames:["printer"]},{unified:"2328-FE0F",shortnames:["keyboard"]},{unified:"1F5B1-FE0F",shortnames:["three_button_mouse"]},{unified:"1F5B2-FE0F",shortnames:["trackball"]},{unified:"1F4BD",shortnames:["minidisc"]},{unified:"1F4BE",shortnames:["floppy_disk"]},{unified:"1F4BF",shortnames:["cd"]},{unified:"1F4C0",shortnames:["dvd"]},{unified:"1F3A5",shortnames:["movie_camera"]},{unified:"1F39E-FE0F",shortnames:["film_frames"]},{unified:"1F4FD-FE0F",shortnames:["film_projector"]},{unified:"1F3AC",shortnames:["clapper"]},{unified:"1F4FA",shortnames:["tv"]},{unified:"1F4F7",shortnames:["camera"]},{unified:"1F4F8",shortnames:["camera_with_flash"]},{unified:"1F4F9",shortnames:["video_camera"]},{unified:"1F4FC",shortnames:["vhs"]},{unified:"1F50D",shortnames:["mag"]},{unified:"1F50E",shortnames:["mag_right"]},{unified:"1F52C",shortnames:["microscope"]},{unified:"1F52D",shortnames:["telescope"]},{unified:"1F4E1",shortnames:["satellite_antenna"]},{unified:"1F56F-FE0F",shortnames:["candle"]},{unified:"1F4A1",shortnames:["bulb"]},{unified:"1F526",shortnames:["flashlight"]},{unified:"1F3EE",shortnames:["izakaya_lantern"]},{unified:"1F4D4",shortnames:["notebook_with_decorative_cover"]},{unified:"1F4D5",shortnames:["closed_book"]},{unified:"1F4D6",shortnames:["book"]},{unified:"1F4D7",shortnames:["green_book"]},{unified:"1F4D8",shortnames:["blue_book"]},{unified:"1F4D9",shortnames:["orange_book"]},{unified:"1F4DA",shortnames:["books"]},{unified:"1F4D3",shortnames:["notebook"]},{unified:"1F4D2",shortnames:["ledger"]},{unified:"1F4C3",shortnames:["page_with_curl"]},{unified:"1F4DC",shortnames:["scroll"]},{unified:"1F4C4",shortnames:["page_facing_up"]},{unified:"1F4F0",shortnames:["newspaper"]},{unified:"1F5DE-FE0F",shortnames:["rolled_up_newspaper"]},{unified:"1F4D1",shortnames:["bookmark_tabs"]},{unified:"1F516",shortnames:["bookmark"]},{unified:"1F3F7-FE0F",shortnames:["label"]},{unified:"1F4B0",shortnames:["moneybag"]},{unified:"1F4B4",shortnames:["yen"]},{unified:"1F4B5",shortnames:["dollar"]},{unified:"1F4B6",shortnames:["euro"]},{unified:"1F4B7",shortnames:["pound"]},{unified:"1F4B8",shortnames:["money_with_wings"]},{unified:"1F4B3",shortnames:["credit_card"]},{unified:"1F4B9",shortnames:["chart"]},{unified:"1F4B1",shortnames:["currency_exchange"]},{unified:"1F4B2",shortnames:["heavy_dollar_sign"]},{unified:"2709-FE0F",shortnames:["email"]},{unified:"1F4E7",shortnames:["e-mail"]},{unified:"1F4E8",shortnames:["incoming_envelope"]},{unified:"1F4E9",shortnames:["envelope_with_arrow"]},{unified:"1F4E4",shortnames:["outbox_tray"]},{unified:"1F4E5",shortnames:["inbox_tray"]},{unified:"1F4E6",shortnames:["package"]},{unified:"1F4EB",shortnames:["mailbox"]},{unified:"1F4EA",shortnames:["mailbox_closed"]},{unified:"1F4EC",shortnames:["mailbox_with_mail"]},{unified:"1F4ED",shortnames:["mailbox_with_no_mail"]},{unified:"1F4EE",shortnames:["postbox"]},{unified:"1F5F3-FE0F",shortnames:["ballot_box_with_ballot"]},{unified:"270F-FE0F",shortnames:["pencil2"]},{unified:"2712-FE0F",shortnames:["black_nib"]},{unified:"1F58B-FE0F",shortnames:["lower_left_fountain_pen"]},{unified:"1F58A-FE0F",shortnames:["lower_left_ballpoint_pen"]},{unified:"1F58C-FE0F",shortnames:["lower_left_paintbrush"]},{unified:"1F58D-FE0F",shortnames:["lower_left_crayon"]},{unified:"1F4DD",shortnames:["memo"]},{unified:"1F4BC",shortnames:["briefcase"]},{unified:"1F4C1",shortnames:["file_folder"]},{unified:"1F4C2",shortnames:["open_file_folder"]},{unified:"1F5C2-FE0F",shortnames:["card_index_dividers"]},{unified:"1F4C5",shortnames:["date"]},{unified:"1F4C6",shortnames:["calendar"]},{unified:"1F5D2-FE0F",shortnames:["spiral_note_pad"]},{unified:"1F5D3-FE0F",shortnames:["spiral_calendar_pad"]},{unified:"1F4C7",shortnames:["card_index"]},{unified:"1F4C8",shortnames:["chart_with_upwards_trend"]},{unified:"1F4C9",shortnames:["chart_with_downwards_trend"]},{unified:"1F4CA",shortnames:["bar_chart"]},{unified:"1F4CB",shortnames:["clipboard"]},{unified:"1F4CC",shortnames:["pushpin"]},{unified:"1F4CD",shortnames:["round_pushpin"]},{unified:"1F4CE",shortnames:["paperclip"]},{unified:"1F587-FE0F",shortnames:["linked_paperclips"]},{unified:"1F4CF",shortnames:["straight_ruler"]},{unified:"1F4D0",shortnames:["triangular_ruler"]},{unified:"2702-FE0F",shortnames:["scissors"]},{unified:"1F5C3-FE0F",shortnames:["card_file_box"]},{unified:"1F5C4-FE0F",shortnames:["file_cabinet"]},{unified:"1F5D1-FE0F",shortnames:["wastebasket"]},{unified:"1F512",shortnames:["lock"]},{unified:"1F513",shortnames:["unlock"]},{unified:"1F50F",shortnames:["lock_with_ink_pen"]},{unified:"1F510",shortnames:["closed_lock_with_key"]},{unified:"1F511",shortnames:["key"]},{unified:"1F5DD-FE0F",shortnames:["old_key"]},{unified:"1F528",shortnames:["hammer"]},{unified:"26CF-FE0F",shortnames:["pick"]},{unified:"2692-FE0F",shortnames:["hammer_and_pick"]},{unified:"1F6E0-FE0F",shortnames:["hammer_and_wrench"]},{unified:"1F5E1-FE0F",shortnames:["dagger_knife"]},{unified:"2694-FE0F",shortnames:["crossed_swords"]},{unified:"1F52B",shortnames:["gun"]},{unified:"1F3F9",shortnames:["bow_and_arrow"]},{unified:"1F6E1-FE0F",shortnames:["shield"]},{unified:"1F527",shortnames:["wrench"]},{unified:"1F529",shortnames:["nut_and_bolt"]},{unified:"2699-FE0F",shortnames:["gear"]},{unified:"1F5DC-FE0F",shortnames:["compression"]},{unified:"2697-FE0F",shortnames:["alembic"]},{unified:"2696-FE0F",shortnames:["scales"]},{unified:"1F517",shortnames:["link"]},{unified:"26D3-FE0F",shortnames:["chains"]},{unified:"1F489",shortnames:["syringe"]},{unified:"1F48A",shortnames:["pill"]},{unified:"1F6AC",shortnames:["smoking"]},{unified:"26B0-FE0F",shortnames:["coffin"]},{unified:"26B1-FE0F",shortnames:["funeral_urn"]},{unified:"1F5FF",shortnames:["moyai"]},{unified:"1F6E2-FE0F",shortnames:["oil_drum"]},{unified:"1F52E",shortnames:["crystal_ball"]},{unified:"1F6D2",shortnames:["shopping_trolley"]}]},{name:"Symbols",emojis:[{unified:"1F3E7",shortnames:["atm"]},{unified:"1F6AE",shortnames:["put_litter_in_its_place"]},{unified:"1F6B0",shortnames:["potable_water"]},{unified:"267F",shortnames:["wheelchair"]},{unified:"1F6B9",shortnames:["mens"]},{unified:"1F6BA",shortnames:["womens"]},{unified:"1F6BB",shortnames:["restroom"]},{unified:"1F6BC",shortnames:["baby_symbol"]},{unified:"1F6BE",shortnames:["wc"]},{unified:"1F6C2",shortnames:["passport_control"]},{unified:"1F6C3",shortnames:["customs"]},{unified:"1F6C4",shortnames:["baggage_claim"]},{unified:"1F6C5",shortnames:["left_luggage"]},{unified:"26A0-FE0F",shortnames:["warning"]},{unified:"1F6B8",shortnames:["children_crossing"]},{unified:"26D4",shortnames:["no_entry"]},{unified:"1F6AB",shortnames:["no_entry_sign"]},{unified:"1F6B3",shortnames:["no_bicycles"]},{unified:"1F6AD",shortnames:["no_smoking"]},{unified:"1F6AF",shortnames:["do_not_litter"]},{unified:"1F6B1",shortnames:["non-potable_water"]},{unified:"1F6B7",shortnames:["no_pedestrians"]},{unified:"1F4F5",shortnames:["no_mobile_phones"]},{unified:"1F51E",shortnames:["underage"]},{unified:"2622-FE0F",shortnames:["radioactive_sign"]},{unified:"2623-FE0F",shortnames:["biohazard_sign"]},{unified:"2B06-FE0F",shortnames:["arrow_up"]},{unified:"2197-FE0F",shortnames:["arrow_upper_right"]},{unified:"27A1-FE0F",shortnames:["arrow_right"]},{unified:"2198-FE0F",shortnames:["arrow_lower_right"]},{unified:"2B07-FE0F",shortnames:["arrow_down"]},{unified:"2199-FE0F",shortnames:["arrow_lower_left"]},{unified:"2B05-FE0F",shortnames:["arrow_left"]},{unified:"2196-FE0F",shortnames:["arrow_upper_left"]},{unified:"2195-FE0F",shortnames:["arrow_up_down"]},{unified:"2194-FE0F",shortnames:["left_right_arrow"]},{unified:"21A9-FE0F",shortnames:["leftwards_arrow_with_hook"]},{unified:"21AA-FE0F",shortnames:["arrow_right_hook"]},{unified:"2934-FE0F",shortnames:["arrow_heading_up"]},{unified:"2935-FE0F",shortnames:["arrow_heading_down"]},{unified:"1F503",shortnames:["arrows_clockwise"]},{unified:"1F504",shortnames:["arrows_counterclockwise"]},{unified:"1F519",shortnames:["back"]},{unified:"1F51A",shortnames:["end"]},{unified:"1F51B",shortnames:["on"]},{unified:"1F51C",shortnames:["soon"]},{unified:"1F51D",shortnames:["top"]},{unified:"1F6D0",shortnames:["place_of_worship"]},{unified:"269B-FE0F",shortnames:["atom_symbol"]},{unified:"1F549-FE0F",shortnames:["om_symbol"]},{unified:"2721-FE0F",shortnames:["star_of_david"]},{unified:"2638-FE0F",shortnames:["wheel_of_dharma"]},{unified:"262F-FE0F",shortnames:["yin_yang"]},{unified:"271D-FE0F",shortnames:["latin_cross"]},{unified:"2626-FE0F",shortnames:["orthodox_cross"]},{unified:"262A-FE0F",shortnames:["star_and_crescent"]},{unified:"262E-FE0F",shortnames:["peace_symbol"]},{unified:"1F54E",shortnames:["menorah_with_nine_branches"]},{unified:"1F52F",shortnames:["six_pointed_star"]},{unified:"2648",shortnames:["aries"]},{unified:"2649",shortnames:["taurus"]},{unified:"264A",shortnames:["gemini"]},{unified:"264B",shortnames:["cancer"]},{unified:"264C",shortnames:["leo"]},{unified:"264D",shortnames:["virgo"]},{unified:"264E",shortnames:["libra"]},{unified:"264F",shortnames:["scorpius"]},{unified:"2650",shortnames:["sagittarius"]},{unified:"2651",shortnames:["capricorn"]},{unified:"2652",shortnames:["aquarius"]},{unified:"2653",shortnames:["pisces"]},{unified:"26CE",shortnames:["ophiuchus"]},{unified:"1F500",shortnames:["twisted_rightwards_arrows"]},{unified:"1F501",shortnames:["repeat"]},{unified:"1F502",shortnames:["repeat_one"]},{unified:"25B6-FE0F",shortnames:["arrow_forward"]},{unified:"23E9",shortnames:["fast_forward"]},{unified:"23ED-FE0F",shortnames:["black_right_pointing_double_triangle_with_vertical_bar"]},{unified:"23EF-FE0F",shortnames:["black_right_pointing_triangle_with_double_vertical_bar"]},{unified:"25C0-FE0F",shortnames:["arrow_backward"]},{unified:"23EA",shortnames:["rewind"]},{unified:"23EE-FE0F",shortnames:["black_left_pointing_double_triangle_with_vertical_bar"]},{unified:"1F53C",shortnames:["arrow_up_small"]},{unified:"23EB",shortnames:["arrow_double_up"]},{unified:"1F53D",shortnames:["arrow_down_small"]},{unified:"23EC",shortnames:["arrow_double_down"]},{unified:"23F8-FE0F",shortnames:["double_vertical_bar"]},{unified:"23F9-FE0F",shortnames:["black_square_for_stop"]},{unified:"23FA-FE0F",shortnames:["black_circle_for_record"]},{unified:"23CF-FE0F",shortnames:["eject"]},{unified:"1F3A6",shortnames:["cinema"]},{unified:"1F505",shortnames:["low_brightness"]},{unified:"1F506",shortnames:["high_brightness"]},{unified:"1F4F6",shortnames:["signal_strength"]},{unified:"1F4F3",shortnames:["vibration_mode"]},{unified:"1F4F4",shortnames:["mobile_phone_off"]},{unified:"2640-FE0F",shortnames:["female_sign"]},{unified:"2642-FE0F",shortnames:["male_sign"]},{unified:"2695-FE0F",shortnames:["medical_symbol"]},{unified:"267B-FE0F",shortnames:["recycle"]},{unified:"269C-FE0F",shortnames:["fleur_de_lis"]},{unified:"1F531",shortnames:["trident"]},{unified:"1F4DB",shortnames:["name_badge"]},{unified:"1F530",shortnames:["beginner"]},{unified:"2B55",shortnames:["o"]},{unified:"2705",shortnames:["white_check_mark"]},{unified:"2611-FE0F",shortnames:["ballot_box_with_check"]},{unified:"2714-FE0F",shortnames:["heavy_check_mark"]},{unified:"2716-FE0F",shortnames:["heavy_multiplication_x"]},{unified:"274C",shortnames:["x"]},{unified:"274E",shortnames:["negative_squared_cross_mark"]},{unified:"2795",shortnames:["heavy_plus_sign"]},{unified:"2796",shortnames:["heavy_minus_sign"]},{unified:"2797",shortnames:["heavy_division_sign"]},{unified:"27B0",shortnames:["curly_loop"]},{unified:"27BF",shortnames:["loop"]},{unified:"303D-FE0F",shortnames:["part_alternation_mark"]},{unified:"2733-FE0F",shortnames:["eight_spoked_asterisk"]},{unified:"2734-FE0F",shortnames:["eight_pointed_black_star"]},{unified:"2747-FE0F",shortnames:["sparkle"]},{unified:"203C-FE0F",shortnames:["bangbang"]},{unified:"2049-FE0F",shortnames:["interrobang"]},{unified:"2753",shortnames:["question"]},{unified:"2754",shortnames:["grey_question"]},{unified:"2755",shortnames:["grey_exclamation"]},{unified:"2757",shortnames:["exclamation"]},{unified:"3030-FE0F",shortnames:["wavy_dash"]},{unified:"00A9-FE0F",shortnames:["copyright"]},{unified:"00AE-FE0F",shortnames:["registered"]},{unified:"2122-FE0F",shortnames:["tm"]},{unified:"0023-FE0F-20E3",shortnames:["hash"]},{unified:"002A-FE0F-20E3",shortnames:["keycap_star"]},{unified:"0030-FE0F-20E3",shortnames:["zero"]},{unified:"0031-FE0F-20E3",shortnames:["one"]},{unified:"0032-FE0F-20E3",shortnames:["two"]},{unified:"0033-FE0F-20E3",shortnames:["three"]},{unified:"0034-FE0F-20E3",shortnames:["four"]},{unified:"0035-FE0F-20E3",shortnames:["five"]},{unified:"0036-FE0F-20E3",shortnames:["six"]},{unified:"0037-FE0F-20E3",shortnames:["seven"]},{unified:"0038-FE0F-20E3",shortnames:["eight"]},{unified:"0039-FE0F-20E3",shortnames:["nine"]},{unified:"1F51F",shortnames:["keycap_ten"]},{unified:"1F4AF",shortnames:["100"]},{unified:"1F520",shortnames:["capital_abcd"]},{unified:"1F521",shortnames:["abcd"]},{unified:"1F522",shortnames:["1234"]},{unified:"1F523",shortnames:["symbols"]},{unified:"1F524",shortnames:["abc"]},{unified:"1F170-FE0F",shortnames:["a"]},{unified:"1F18E",shortnames:["ab"]},{unified:"1F171-FE0F",shortnames:["b"]},{unified:"1F191",shortnames:["cl"]},{unified:"1F192",shortnames:["cool"]},{unified:"1F193",shortnames:["free"]},{unified:"2139-FE0F",shortnames:["information_source"]},{unified:"1F194",shortnames:["id"]},{unified:"24C2-FE0F",shortnames:["m"]},{unified:"1F195",shortnames:["new"]},{unified:"1F196",shortnames:["ng"]},{unified:"1F17E-FE0F",shortnames:["o2"]},{unified:"1F197",shortnames:["ok"]},{unified:"1F17F-FE0F",shortnames:["parking"]},{unified:"1F198",shortnames:["sos"]},{unified:"1F199",shortnames:["up"]},{unified:"1F19A",shortnames:["vs"]},{unified:"1F201",shortnames:["koko"]},{unified:"1F202-FE0F",shortnames:["sa"]},{unified:"1F237-FE0F",shortnames:["u6708"]},{unified:"1F236",shortnames:["u6709"]},{unified:"1F22F",shortnames:["u6307"]},{unified:"1F250",shortnames:["ideograph_advantage"]},{unified:"1F239",shortnames:["u5272"]},{unified:"1F21A",shortnames:["u7121"]},{unified:"1F232",shortnames:["u7981"]},{unified:"1F251",shortnames:["accept"]},{unified:"1F238",shortnames:["u7533"]},{unified:"1F234",shortnames:["u5408"]},{unified:"1F233",shortnames:["u7a7a"]},{unified:"3297-FE0F",shortnames:["congratulations"]},{unified:"3299-FE0F",shortnames:["secret"]},{unified:"1F23A",shortnames:["u55b6"]},{unified:"1F235",shortnames:["u6e80"]},{unified:"25AA-FE0F",shortnames:["black_small_square"]},{unified:"25AB-FE0F",shortnames:["white_small_square"]},{unified:"25FB-FE0F",shortnames:["white_medium_square"]},{unified:"25FC-FE0F",shortnames:["black_medium_square"]},{unified:"25FD",shortnames:["white_medium_small_square"]},{unified:"25FE",shortnames:["black_medium_small_square"]},{unified:"2B1B",shortnames:["black_large_square"]},{unified:"2B1C",shortnames:["white_large_square"]},{unified:"1F536",shortnames:["large_orange_diamond"]},{unified:"1F537",shortnames:["large_blue_diamond"]},{unified:"1F538",shortnames:["small_orange_diamond"]},{unified:"1F539",shortnames:["small_blue_diamond"]},{unified:"1F53A",shortnames:["small_red_triangle"]},{unified:"1F53B",shortnames:["small_red_triangle_down"]},{unified:"1F4A0",shortnames:["diamond_shape_with_a_dot_inside"]},{unified:"1F518",shortnames:["radio_button"]},{unified:"1F532",shortnames:["black_square_button"]},{unified:"1F533",shortnames:["white_square_button"]},{unified:"26AA",shortnames:["white_circle"]},{unified:"26AB",shortnames:["black_circle"]},{unified:"1F534",shortnames:["red_circle"]},{unified:"1F535",shortnames:["large_blue_circle"]}]},{name:"Flags",emojis:[{unified:"1F3C1",shortnames:["checkered_flag"]},{unified:"1F6A9",shortnames:["triangular_flag_on_post"]},{unified:"1F38C",shortnames:["crossed_flags"]},{unified:"1F3F4",shortnames:["waving_black_flag"]},{unified:"1F3F3-FE0F",shortnames:["waving_white_flag"]},{unified:"1F3F3-FE0F-200D-1F308",shortnames:["rainbow-flag"]},{unified:"1F1E6-1F1E8",shortnames:["flag-ac"]},{unified:"1F1E6-1F1E9",shortnames:["flag-ad"]},{unified:"1F1E6-1F1EA",shortnames:["flag-ae"]},{unified:"1F1E6-1F1EB",shortnames:["flag-af"]},{unified:"1F1E6-1F1EC",shortnames:["flag-ag"]},{unified:"1F1E6-1F1EE",shortnames:["flag-ai"]},{unified:"1F1E6-1F1F1",shortnames:["flag-al"]},{unified:"1F1E6-1F1F2",shortnames:["flag-am"]},{unified:"1F1E6-1F1F4",shortnames:["flag-ao"]},{unified:"1F1E6-1F1F6",shortnames:["flag-aq"]},{unified:"1F1E6-1F1F7",shortnames:["flag-ar"]},{unified:"1F1E6-1F1F8",shortnames:["flag-as"]},{unified:"1F1E6-1F1F9",shortnames:["flag-at"]},{unified:"1F1E6-1F1FA",shortnames:["flag-au"]},{unified:"1F1E6-1F1FC",shortnames:["flag-aw"]},{unified:"1F1E6-1F1FD",shortnames:["flag-ax"]},{unified:"1F1E6-1F1FF",shortnames:["flag-az"]},{unified:"1F1E7-1F1E6",shortnames:["flag-ba"]},{unified:"1F1E7-1F1E7",shortnames:["flag-bb"]},{unified:"1F1E7-1F1E9",shortnames:["flag-bd"]},{unified:"1F1E7-1F1EA",shortnames:["flag-be"]},{unified:"1F1E7-1F1EB",shortnames:["flag-bf"]},{unified:"1F1E7-1F1EC",shortnames:["flag-bg"]},{unified:"1F1E7-1F1ED",shortnames:["flag-bh"]},{unified:"1F1E7-1F1EE",shortnames:["flag-bi"]},{unified:"1F1E7-1F1EF",shortnames:["flag-bj"]},{unified:"1F1E7-1F1F1",shortnames:["flag-bl"]},{unified:"1F1E7-1F1F2",shortnames:["flag-bm"]},{unified:"1F1E7-1F1F3",shortnames:["flag-bn"]},{unified:"1F1E7-1F1F4",shortnames:["flag-bo"]},{unified:"1F1E7-1F1F6",shortnames:["flag-bq"]},{unified:"1F1E7-1F1F7",shortnames:["flag-br"]},{unified:"1F1E7-1F1F8",shortnames:["flag-bs"]},{unified:"1F1E7-1F1F9",shortnames:["flag-bt"]},{unified:"1F1E7-1F1FB",shortnames:["flag-bv"]},{unified:"1F1E7-1F1FC",shortnames:["flag-bw"]},{unified:"1F1E7-1F1FE",shortnames:["flag-by"]},{unified:"1F1E7-1F1FF",shortnames:["flag-bz"]},{unified:"1F1E8-1F1E6",shortnames:["flag-ca"]},{unified:"1F1E8-1F1E8",shortnames:["flag-cc"]},{unified:"1F1E8-1F1E9",shortnames:["flag-cd"]},{unified:"1F1E8-1F1EB",shortnames:["flag-cf"]},{unified:"1F1E8-1F1EC",shortnames:["flag-cg"]},{unified:"1F1E8-1F1ED",shortnames:["flag-ch"]},{unified:"1F1E8-1F1EE",shortnames:["flag-ci"]},{unified:"1F1E8-1F1F0",shortnames:["flag-ck"]},{unified:"1F1E8-1F1F1",shortnames:["flag-cl"]},{unified:"1F1E8-1F1F2",shortnames:["flag-cm"]},{unified:"1F1E8-1F1F3",shortnames:["cn"]},{unified:"1F1E8-1F1F4",shortnames:["flag-co"]},{unified:"1F1E8-1F1F5",shortnames:["flag-cp"]},{unified:"1F1E8-1F1F7",shortnames:["flag-cr"]},{unified:"1F1E8-1F1FA",shortnames:["flag-cu"]},{unified:"1F1E8-1F1FB",shortnames:["flag-cv"]},{unified:"1F1E8-1F1FC",shortnames:["flag-cw"]},{unified:"1F1E8-1F1FD",shortnames:["flag-cx"]},{unified:"1F1E8-1F1FE",shortnames:["flag-cy"]},{unified:"1F1E8-1F1FF",shortnames:["flag-cz"]},{unified:"1F1E9-1F1EA",shortnames:["de"]},{unified:"1F1E9-1F1EC",shortnames:["flag-dg"]},{unified:"1F1E9-1F1EF",shortnames:["flag-dj"]},{unified:"1F1E9-1F1F0",shortnames:["flag-dk"]},{unified:"1F1E9-1F1F2",shortnames:["flag-dm"]},{unified:"1F1E9-1F1F4",shortnames:["flag-do"]},{unified:"1F1E9-1F1FF",shortnames:["flag-dz"]},{unified:"1F1EA-1F1E6",shortnames:["flag-ea"]},{unified:"1F1EA-1F1E8",shortnames:["flag-ec"]},{unified:"1F1EA-1F1EA",shortnames:["flag-ee"]},{unified:"1F1EA-1F1EC",shortnames:["flag-eg"]},{unified:"1F1EA-1F1ED",shortnames:["flag-eh"]},{unified:"1F1EA-1F1F7",shortnames:["flag-er"]},{unified:"1F1EA-1F1F8",shortnames:["es"]},{unified:"1F1EA-1F1F9",shortnames:["flag-et"]},{unified:"1F1EA-1F1FA",shortnames:["flag-eu"]},{unified:"1F1EB-1F1EE",shortnames:["flag-fi"]},{unified:"1F1EB-1F1EF",shortnames:["flag-fj"]},{unified:"1F1EB-1F1F0",shortnames:["flag-fk"]},{unified:"1F1EB-1F1F2",shortnames:["flag-fm"]},{unified:"1F1EB-1F1F4",shortnames:["flag-fo"]},{unified:"1F1EB-1F1F7",shortnames:["fr"]},{unified:"1F1EC-1F1E6",shortnames:["flag-ga"]},{unified:"1F1EC-1F1E7",shortnames:["gb"]},{unified:"1F1EC-1F1E9",shortnames:["flag-gd"]},{unified:"1F1EC-1F1EA",shortnames:["flag-ge"]},{unified:"1F1EC-1F1EB",shortnames:["flag-gf"]},{unified:"1F1EC-1F1EC",shortnames:["flag-gg"]},{unified:"1F1EC-1F1ED",shortnames:["flag-gh"]},{unified:"1F1EC-1F1EE",shortnames:["flag-gi"]},{unified:"1F1EC-1F1F1",shortnames:["flag-gl"]},{unified:"1F1EC-1F1F2",shortnames:["flag-gm"]},{unified:"1F1EC-1F1F3",shortnames:["flag-gn"]},{unified:"1F1EC-1F1F5",shortnames:["flag-gp"]},{unified:"1F1EC-1F1F6",shortnames:["flag-gq"]},{unified:"1F1EC-1F1F7",shortnames:["flag-gr"]},{unified:"1F1EC-1F1F8",shortnames:["flag-gs"]},{unified:"1F1EC-1F1F9",shortnames:["flag-gt"]},{unified:"1F1EC-1F1FA",shortnames:["flag-gu"]},{unified:"1F1EC-1F1FC",shortnames:["flag-gw"]},{unified:"1F1EC-1F1FE",shortnames:["flag-gy"]},{unified:"1F1ED-1F1F0",shortnames:["flag-hk"]},{unified:"1F1ED-1F1F2",shortnames:["flag-hm"]},{unified:"1F1ED-1F1F3",shortnames:["flag-hn"]},{unified:"1F1ED-1F1F7",shortnames:["flag-hr"]},{unified:"1F1ED-1F1F9",shortnames:["flag-ht"]},{unified:"1F1ED-1F1FA",shortnames:["flag-hu"]},{unified:"1F1EE-1F1E8",shortnames:["flag-ic"]},{unified:"1F1EE-1F1E9",shortnames:["flag-id"]},{unified:"1F1EE-1F1EA",shortnames:["flag-ie"]},{unified:"1F1EE-1F1F1",shortnames:["flag-il"]},{unified:"1F1EE-1F1F2",shortnames:["flag-im"]},{unified:"1F1EE-1F1F3",shortnames:["flag-in"]},{unified:"1F1EE-1F1F4",shortnames:["flag-io"]},{unified:"1F1EE-1F1F6",shortnames:["flag-iq"]},{unified:"1F1EE-1F1F7",shortnames:["flag-ir"]},{unified:"1F1EE-1F1F8",shortnames:["flag-is"]},{unified:"1F1EE-1F1F9",shortnames:["it"]},{unified:"1F1EF-1F1EA",shortnames:["flag-je"]},{unified:"1F1EF-1F1F2",shortnames:["flag-jm"]},{unified:"1F1EF-1F1F4",shortnames:["flag-jo"]},{unified:"1F1EF-1F1F5",shortnames:["jp"]},{unified:"1F1F0-1F1EA",shortnames:["flag-ke"]},{unified:"1F1F0-1F1EC",shortnames:["flag-kg"]},{unified:"1F1F0-1F1ED",shortnames:["flag-kh"]},{unified:"1F1F0-1F1EE",shortnames:["flag-ki"]},{unified:"1F1F0-1F1F2",shortnames:["flag-km"]},{unified:"1F1F0-1F1F3",shortnames:["flag-kn"]},{unified:"1F1F0-1F1F5",shortnames:["flag-kp"]},{unified:"1F1F0-1F1F7",shortnames:["kr"]},{unified:"1F1F0-1F1FC",shortnames:["flag-kw"]},{unified:"1F1F0-1F1FE",shortnames:["flag-ky"]},{unified:"1F1F0-1F1FF",shortnames:["flag-kz"]},{unified:"1F1F1-1F1E6",shortnames:["flag-la"]},{unified:"1F1F1-1F1E7",shortnames:["flag-lb"]},{unified:"1F1F1-1F1E8",shortnames:["flag-lc"]},{unified:"1F1F1-1F1EE",shortnames:["flag-li"]},{unified:"1F1F1-1F1F0",shortnames:["flag-lk"]},{unified:"1F1F1-1F1F7",shortnames:["flag-lr"]},{unified:"1F1F1-1F1F8",shortnames:["flag-ls"]},{unified:"1F1F1-1F1F9",shortnames:["flag-lt"]},{unified:"1F1F1-1F1FA",shortnames:["flag-lu"]},{unified:"1F1F1-1F1FB",shortnames:["flag-lv"]},{unified:"1F1F1-1F1FE",shortnames:["flag-ly"]},{unified:"1F1F2-1F1E6",shortnames:["flag-ma"]},{unified:"1F1F2-1F1E8",shortnames:["flag-mc"]},{unified:"1F1F2-1F1E9",shortnames:["flag-md"]},{unified:"1F1F2-1F1EA",shortnames:["flag-me"]},{unified:"1F1F2-1F1EB",shortnames:["flag-mf"]},{unified:"1F1F2-1F1EC",shortnames:["flag-mg"]},{unified:"1F1F2-1F1ED",shortnames:["flag-mh"]},{unified:"1F1F2-1F1F0",shortnames:["flag-mk"]},{unified:"1F1F2-1F1F1",shortnames:["flag-ml"]},{unified:"1F1F2-1F1F2",shortnames:["flag-mm"]},{unified:"1F1F2-1F1F3",shortnames:["flag-mn"]},{unified:"1F1F2-1F1F4",shortnames:["flag-mo"]},{unified:"1F1F2-1F1F5",shortnames:["flag-mp"]},{unified:"1F1F2-1F1F6",shortnames:["flag-mq"]},{unified:"1F1F2-1F1F7",shortnames:["flag-mr"]},{unified:"1F1F2-1F1F8",shortnames:["flag-ms"]},{unified:"1F1F2-1F1F9",shortnames:["flag-mt"]},{unified:"1F1F2-1F1FA",shortnames:["flag-mu"]},{unified:"1F1F2-1F1FB",shortnames:["flag-mv"]},{unified:"1F1F2-1F1FC",shortnames:["flag-mw"]},{unified:"1F1F2-1F1FD",shortnames:["flag-mx"]},{unified:"1F1F2-1F1FE",shortnames:["flag-my"]},{unified:"1F1F2-1F1FF",shortnames:["flag-mz"]},{unified:"1F1F3-1F1E6",shortnames:["flag-na"]},{unified:"1F1F3-1F1E8",shortnames:["flag-nc"]},{unified:"1F1F3-1F1EA",shortnames:["flag-ne"]},{unified:"1F1F3-1F1EB",shortnames:["flag-nf"]},{unified:"1F1F3-1F1EC",shortnames:["flag-ng"]},{unified:"1F1F3-1F1EE",shortnames:["flag-ni"]},{unified:"1F1F3-1F1F1",shortnames:["flag-nl"]},{unified:"1F1F3-1F1F4",shortnames:["flag-no"]},{unified:"1F1F3-1F1F5",shortnames:["flag-np"]},{unified:"1F1F3-1F1F7",shortnames:["flag-nr"]},{unified:"1F1F3-1F1FA",shortnames:["flag-nu"]},{unified:"1F1F3-1F1FF",shortnames:["flag-nz"]},{unified:"1F1F4-1F1F2",shortnames:["flag-om"]},{unified:"1F1F5-1F1E6",shortnames:["flag-pa"]},{unified:"1F1F5-1F1EA",shortnames:["flag-pe"]},{unified:"1F1F5-1F1EB",shortnames:["flag-pf"]},{unified:"1F1F5-1F1EC",shortnames:["flag-pg"]},{unified:"1F1F5-1F1ED",shortnames:["flag-ph"]},{unified:"1F1F5-1F1F0",shortnames:["flag-pk"]},{unified:"1F1F5-1F1F1",shortnames:["flag-pl"]},{unified:"1F1F5-1F1F2",shortnames:["flag-pm"]},{unified:"1F1F5-1F1F3",shortnames:["flag-pn"]},{unified:"1F1F5-1F1F7",shortnames:["flag-pr"]},{unified:"1F1F5-1F1F8",shortnames:["flag-ps"]},{unified:"1F1F5-1F1F9",shortnames:["flag-pt"]},{unified:"1F1F5-1F1FC",shortnames:["flag-pw"]},{unified:"1F1F5-1F1FE",shortnames:["flag-py"]},{unified:"1F1F6-1F1E6",shortnames:["flag-qa"]},{unified:"1F1F7-1F1EA",shortnames:["flag-re"]},{unified:"1F1F7-1F1F4",shortnames:["flag-ro"]},{unified:"1F1F7-1F1F8",shortnames:["flag-rs"]},{unified:"1F1F7-1F1FA",shortnames:["ru"]},{unified:"1F1F7-1F1FC",shortnames:["flag-rw"]},{unified:"1F1F8-1F1E6",shortnames:["flag-sa"]},{unified:"1F1F8-1F1E7",shortnames:["flag-sb"]},{unified:"1F1F8-1F1E8",shortnames:["flag-sc"]},{unified:"1F1F8-1F1E9",shortnames:["flag-sd"]},{unified:"1F1F8-1F1EA",shortnames:["flag-se"]},{unified:"1F1F8-1F1EC",shortnames:["flag-sg"]},{unified:"1F1F8-1F1ED",shortnames:["flag-sh"]},{unified:"1F1F8-1F1EE",shortnames:["flag-si"]},{unified:"1F1F8-1F1EF",shortnames:["flag-sj"]},{unified:"1F1F8-1F1F0",shortnames:["flag-sk"]},{unified:"1F1F8-1F1F1",shortnames:["flag-sl"]},{unified:"1F1F8-1F1F2",shortnames:["flag-sm"]},{unified:"1F1F8-1F1F3",shortnames:["flag-sn"]},{unified:"1F1F8-1F1F4",shortnames:["flag-so"]},{unified:"1F1F8-1F1F7",shortnames:["flag-sr"]},{unified:"1F1F8-1F1F8",shortnames:["flag-ss"]},{unified:"1F1F8-1F1F9",shortnames:["flag-st"]},{unified:"1F1F8-1F1FB",shortnames:["flag-sv"]},{unified:"1F1F8-1F1FD",shortnames:["flag-sx"]},{unified:"1F1F8-1F1FE",shortnames:["flag-sy"]},{unified:"1F1F8-1F1FF",shortnames:["flag-sz"]},{unified:"1F1F9-1F1E6",shortnames:["flag-ta"]},{unified:"1F1F9-1F1E8",shortnames:["flag-tc"]},{unified:"1F1F9-1F1E9",shortnames:["flag-td"]},{unified:"1F1F9-1F1EB",shortnames:["flag-tf"]},{unified:"1F1F9-1F1EC",shortnames:["flag-tg"]},{unified:"1F1F9-1F1ED",shortnames:["flag-th"]},{unified:"1F1F9-1F1EF",shortnames:["flag-tj"]},{unified:"1F1F9-1F1F0",shortnames:["flag-tk"]},{unified:"1F1F9-1F1F1",shortnames:["flag-tl"]},{unified:"1F1F9-1F1F2",shortnames:["flag-tm"]},{unified:"1F1F9-1F1F3",shortnames:["flag-tn"]},{unified:"1F1F9-1F1F4",shortnames:["flag-to"]},{unified:"1F1F9-1F1F7",shortnames:["flag-tr"]},{unified:"1F1F9-1F1F9",shortnames:["flag-tt"]},{unified:"1F1F9-1F1FB",shortnames:["flag-tv"]},{unified:"1F1F9-1F1FC",shortnames:["flag-tw"]},{unified:"1F1F9-1F1FF",shortnames:["flag-tz"]},{unified:"1F1FA-1F1E6",shortnames:["flag-ua"]},{unified:"1F1FA-1F1EC",shortnames:["flag-ug"]},{unified:"1F1FA-1F1F2",shortnames:["flag-um"]},{unified:"1F1FA-1F1F3",shortnames:["flag-un"]},{unified:"1F1FA-1F1F8",shortnames:["us"]},{unified:"1F1FA-1F1FE",shortnames:["flag-uy"]},{unified:"1F1FA-1F1FF",shortnames:["flag-uz"]},{unified:"1F1FB-1F1E6",shortnames:["flag-va"]},{unified:"1F1FB-1F1E8",shortnames:["flag-vc"]},{unified:"1F1FB-1F1EA",shortnames:["flag-ve"]},{unified:"1F1FB-1F1EC",shortnames:["flag-vg"]},{unified:"1F1FB-1F1EE",shortnames:["flag-vi"]},{unified:"1F1FB-1F1F3",shortnames:["flag-vn"]},{unified:"1F1FB-1F1FA",shortnames:["flag-vu"]},{unified:"1F1FC-1F1EB",shortnames:["flag-wf"]},{unified:"1F1FC-1F1F8",shortnames:["flag-ws"]},{unified:"1F1FD-1F1F0",shortnames:["flag-xk"]},{unified:"1F1FE-1F1EA",shortnames:["flag-ye"]},{unified:"1F1FE-1F1F9",shortnames:["flag-yt"]},{unified:"1F1FF-1F1E6",shortnames:["flag-za"]},{unified:"1F1FF-1F1F2",shortnames:["flag-zm"]},{unified:"1F1FF-1F1FC",shortnames:["flag-zw"]},{unified:"1F3F4-E0067-E0062-E0065-E006E-E0067-E007F",shortnames:["flag-england"]},{unified:"1F3F4-E0067-E0062-E0073-E0063-E0074-E007F",shortnames:["flag-scotland"]},{unified:"1F3F4-E0067-E0062-E0077-E006C-E0073-E007F",shortnames:["flag-wales"]}]}];_exports.byShortName={hash:"0023-FE0F-20E3",keycap_star:"002A-FE0F-20E3",zero:"0030-FE0F-20E3",one:"0031-FE0F-20E3",two:"0032-FE0F-20E3",three:"0033-FE0F-20E3",four:"0034-FE0F-20E3",five:"0035-FE0F-20E3",six:"0036-FE0F-20E3",seven:"0037-FE0F-20E3",eight:"0038-FE0F-20E3",nine:"0039-FE0F-20E3",copyright:"00A9-FE0F",registered:"00AE-FE0F",mahjong:"1F004",black_joker:"1F0CF",a:"1F170-FE0F",b:"1F171-FE0F",o2:"1F17E-FE0F",parking:"1F17F-FE0F",ab:"1F18E",cl:"1F191",cool:"1F192",free:"1F193",id:"1F194",new:"1F195",ng:"1F196",ok:"1F197",sos:"1F198",up:"1F199",vs:"1F19A","flag-ac":"1F1E6-1F1E8","flag-ad":"1F1E6-1F1E9","flag-ae":"1F1E6-1F1EA","flag-af":"1F1E6-1F1EB","flag-ag":"1F1E6-1F1EC","flag-ai":"1F1E6-1F1EE","flag-al":"1F1E6-1F1F1","flag-am":"1F1E6-1F1F2","flag-ao":"1F1E6-1F1F4","flag-aq":"1F1E6-1F1F6","flag-ar":"1F1E6-1F1F7","flag-as":"1F1E6-1F1F8","flag-at":"1F1E6-1F1F9","flag-au":"1F1E6-1F1FA","flag-aw":"1F1E6-1F1FC","flag-ax":"1F1E6-1F1FD","flag-az":"1F1E6-1F1FF","flag-ba":"1F1E7-1F1E6","flag-bb":"1F1E7-1F1E7","flag-bd":"1F1E7-1F1E9","flag-be":"1F1E7-1F1EA","flag-bf":"1F1E7-1F1EB","flag-bg":"1F1E7-1F1EC","flag-bh":"1F1E7-1F1ED","flag-bi":"1F1E7-1F1EE","flag-bj":"1F1E7-1F1EF","flag-bl":"1F1E7-1F1F1","flag-bm":"1F1E7-1F1F2","flag-bn":"1F1E7-1F1F3","flag-bo":"1F1E7-1F1F4","flag-bq":"1F1E7-1F1F6","flag-br":"1F1E7-1F1F7","flag-bs":"1F1E7-1F1F8","flag-bt":"1F1E7-1F1F9","flag-bv":"1F1E7-1F1FB","flag-bw":"1F1E7-1F1FC","flag-by":"1F1E7-1F1FE","flag-bz":"1F1E7-1F1FF","flag-ca":"1F1E8-1F1E6","flag-cc":"1F1E8-1F1E8","flag-cd":"1F1E8-1F1E9","flag-cf":"1F1E8-1F1EB","flag-cg":"1F1E8-1F1EC","flag-ch":"1F1E8-1F1ED","flag-ci":"1F1E8-1F1EE","flag-ck":"1F1E8-1F1F0","flag-cl":"1F1E8-1F1F1","flag-cm":"1F1E8-1F1F2",cn:"1F1E8-1F1F3","flag-co":"1F1E8-1F1F4","flag-cp":"1F1E8-1F1F5","flag-cr":"1F1E8-1F1F7","flag-cu":"1F1E8-1F1FA","flag-cv":"1F1E8-1F1FB","flag-cw":"1F1E8-1F1FC","flag-cx":"1F1E8-1F1FD","flag-cy":"1F1E8-1F1FE","flag-cz":"1F1E8-1F1FF",de:"1F1E9-1F1EA","flag-dg":"1F1E9-1F1EC","flag-dj":"1F1E9-1F1EF","flag-dk":"1F1E9-1F1F0","flag-dm":"1F1E9-1F1F2","flag-do":"1F1E9-1F1F4","flag-dz":"1F1E9-1F1FF","flag-ea":"1F1EA-1F1E6","flag-ec":"1F1EA-1F1E8","flag-ee":"1F1EA-1F1EA","flag-eg":"1F1EA-1F1EC","flag-eh":"1F1EA-1F1ED","flag-er":"1F1EA-1F1F7",es:"1F1EA-1F1F8","flag-et":"1F1EA-1F1F9","flag-eu":"1F1EA-1F1FA","flag-fi":"1F1EB-1F1EE","flag-fj":"1F1EB-1F1EF","flag-fk":"1F1EB-1F1F0","flag-fm":"1F1EB-1F1F2","flag-fo":"1F1EB-1F1F4",fr:"1F1EB-1F1F7","flag-ga":"1F1EC-1F1E6",gb:"1F1EC-1F1E7","flag-gd":"1F1EC-1F1E9","flag-ge":"1F1EC-1F1EA","flag-gf":"1F1EC-1F1EB","flag-gg":"1F1EC-1F1EC","flag-gh":"1F1EC-1F1ED","flag-gi":"1F1EC-1F1EE","flag-gl":"1F1EC-1F1F1","flag-gm":"1F1EC-1F1F2","flag-gn":"1F1EC-1F1F3","flag-gp":"1F1EC-1F1F5","flag-gq":"1F1EC-1F1F6","flag-gr":"1F1EC-1F1F7","flag-gs":"1F1EC-1F1F8","flag-gt":"1F1EC-1F1F9","flag-gu":"1F1EC-1F1FA","flag-gw":"1F1EC-1F1FC","flag-gy":"1F1EC-1F1FE","flag-hk":"1F1ED-1F1F0","flag-hm":"1F1ED-1F1F2","flag-hn":"1F1ED-1F1F3","flag-hr":"1F1ED-1F1F7","flag-ht":"1F1ED-1F1F9","flag-hu":"1F1ED-1F1FA","flag-ic":"1F1EE-1F1E8","flag-id":"1F1EE-1F1E9","flag-ie":"1F1EE-1F1EA","flag-il":"1F1EE-1F1F1","flag-im":"1F1EE-1F1F2","flag-in":"1F1EE-1F1F3","flag-io":"1F1EE-1F1F4","flag-iq":"1F1EE-1F1F6","flag-ir":"1F1EE-1F1F7","flag-is":"1F1EE-1F1F8",it:"1F1EE-1F1F9","flag-je":"1F1EF-1F1EA","flag-jm":"1F1EF-1F1F2","flag-jo":"1F1EF-1F1F4",jp:"1F1EF-1F1F5","flag-ke":"1F1F0-1F1EA","flag-kg":"1F1F0-1F1EC","flag-kh":"1F1F0-1F1ED","flag-ki":"1F1F0-1F1EE","flag-km":"1F1F0-1F1F2","flag-kn":"1F1F0-1F1F3","flag-kp":"1F1F0-1F1F5",kr:"1F1F0-1F1F7","flag-kw":"1F1F0-1F1FC","flag-ky":"1F1F0-1F1FE","flag-kz":"1F1F0-1F1FF","flag-la":"1F1F1-1F1E6","flag-lb":"1F1F1-1F1E7","flag-lc":"1F1F1-1F1E8","flag-li":"1F1F1-1F1EE","flag-lk":"1F1F1-1F1F0","flag-lr":"1F1F1-1F1F7","flag-ls":"1F1F1-1F1F8","flag-lt":"1F1F1-1F1F9","flag-lu":"1F1F1-1F1FA","flag-lv":"1F1F1-1F1FB","flag-ly":"1F1F1-1F1FE","flag-ma":"1F1F2-1F1E6","flag-mc":"1F1F2-1F1E8","flag-md":"1F1F2-1F1E9","flag-me":"1F1F2-1F1EA","flag-mf":"1F1F2-1F1EB","flag-mg":"1F1F2-1F1EC","flag-mh":"1F1F2-1F1ED","flag-mk":"1F1F2-1F1F0","flag-ml":"1F1F2-1F1F1","flag-mm":"1F1F2-1F1F2","flag-mn":"1F1F2-1F1F3","flag-mo":"1F1F2-1F1F4","flag-mp":"1F1F2-1F1F5","flag-mq":"1F1F2-1F1F6","flag-mr":"1F1F2-1F1F7","flag-ms":"1F1F2-1F1F8","flag-mt":"1F1F2-1F1F9","flag-mu":"1F1F2-1F1FA","flag-mv":"1F1F2-1F1FB","flag-mw":"1F1F2-1F1FC","flag-mx":"1F1F2-1F1FD","flag-my":"1F1F2-1F1FE","flag-mz":"1F1F2-1F1FF","flag-na":"1F1F3-1F1E6","flag-nc":"1F1F3-1F1E8","flag-ne":"1F1F3-1F1EA","flag-nf":"1F1F3-1F1EB","flag-ng":"1F1F3-1F1EC","flag-ni":"1F1F3-1F1EE","flag-nl":"1F1F3-1F1F1","flag-no":"1F1F3-1F1F4","flag-np":"1F1F3-1F1F5","flag-nr":"1F1F3-1F1F7","flag-nu":"1F1F3-1F1FA","flag-nz":"1F1F3-1F1FF","flag-om":"1F1F4-1F1F2","flag-pa":"1F1F5-1F1E6","flag-pe":"1F1F5-1F1EA","flag-pf":"1F1F5-1F1EB","flag-pg":"1F1F5-1F1EC","flag-ph":"1F1F5-1F1ED","flag-pk":"1F1F5-1F1F0","flag-pl":"1F1F5-1F1F1","flag-pm":"1F1F5-1F1F2","flag-pn":"1F1F5-1F1F3","flag-pr":"1F1F5-1F1F7","flag-ps":"1F1F5-1F1F8","flag-pt":"1F1F5-1F1F9","flag-pw":"1F1F5-1F1FC","flag-py":"1F1F5-1F1FE","flag-qa":"1F1F6-1F1E6","flag-re":"1F1F7-1F1EA","flag-ro":"1F1F7-1F1F4","flag-rs":"1F1F7-1F1F8",ru:"1F1F7-1F1FA","flag-rw":"1F1F7-1F1FC","flag-sa":"1F1F8-1F1E6","flag-sb":"1F1F8-1F1E7","flag-sc":"1F1F8-1F1E8","flag-sd":"1F1F8-1F1E9","flag-se":"1F1F8-1F1EA","flag-sg":"1F1F8-1F1EC","flag-sh":"1F1F8-1F1ED","flag-si":"1F1F8-1F1EE","flag-sj":"1F1F8-1F1EF","flag-sk":"1F1F8-1F1F0","flag-sl":"1F1F8-1F1F1","flag-sm":"1F1F8-1F1F2","flag-sn":"1F1F8-1F1F3","flag-so":"1F1F8-1F1F4","flag-sr":"1F1F8-1F1F7","flag-ss":"1F1F8-1F1F8","flag-st":"1F1F8-1F1F9","flag-sv":"1F1F8-1F1FB","flag-sx":"1F1F8-1F1FD","flag-sy":"1F1F8-1F1FE","flag-sz":"1F1F8-1F1FF","flag-ta":"1F1F9-1F1E6","flag-tc":"1F1F9-1F1E8","flag-td":"1F1F9-1F1E9","flag-tf":"1F1F9-1F1EB","flag-tg":"1F1F9-1F1EC","flag-th":"1F1F9-1F1ED","flag-tj":"1F1F9-1F1EF","flag-tk":"1F1F9-1F1F0","flag-tl":"1F1F9-1F1F1","flag-tm":"1F1F9-1F1F2","flag-tn":"1F1F9-1F1F3","flag-to":"1F1F9-1F1F4","flag-tr":"1F1F9-1F1F7","flag-tt":"1F1F9-1F1F9","flag-tv":"1F1F9-1F1FB","flag-tw":"1F1F9-1F1FC","flag-tz":"1F1F9-1F1FF","flag-ua":"1F1FA-1F1E6","flag-ug":"1F1FA-1F1EC","flag-um":"1F1FA-1F1F2","flag-un":"1F1FA-1F1F3",us:"1F1FA-1F1F8","flag-uy":"1F1FA-1F1FE","flag-uz":"1F1FA-1F1FF","flag-va":"1F1FB-1F1E6","flag-vc":"1F1FB-1F1E8","flag-ve":"1F1FB-1F1EA","flag-vg":"1F1FB-1F1EC","flag-vi":"1F1FB-1F1EE","flag-vn":"1F1FB-1F1F3","flag-vu":"1F1FB-1F1FA","flag-wf":"1F1FC-1F1EB","flag-ws":"1F1FC-1F1F8","flag-xk":"1F1FD-1F1F0","flag-ye":"1F1FE-1F1EA","flag-yt":"1F1FE-1F1F9","flag-za":"1F1FF-1F1E6","flag-zm":"1F1FF-1F1F2","flag-zw":"1F1FF-1F1FC",koko:"1F201",sa:"1F202-FE0F",u7121:"1F21A",u6307:"1F22F",u7981:"1F232",u7a7a:"1F233",u5408:"1F234",u6e80:"1F235",u6709:"1F236",u6708:"1F237-FE0F",u7533:"1F238",u5272:"1F239",u55b6:"1F23A",ideograph_advantage:"1F250",accept:"1F251",cyclone:"1F300",foggy:"1F301",closed_umbrella:"1F302",night_with_stars:"1F303",sunrise_over_mountains:"1F304",sunrise:"1F305",city_sunset:"1F306",city_sunrise:"1F307",rainbow:"1F308",bridge_at_night:"1F309",ocean:"1F30A",volcano:"1F30B",milky_way:"1F30C",earth_africa:"1F30D",earth_americas:"1F30E",earth_asia:"1F30F",globe_with_meridians:"1F310",new_moon:"1F311",waxing_crescent_moon:"1F312",first_quarter_moon:"1F313",moon:"1F314",full_moon:"1F315",waning_gibbous_moon:"1F316",last_quarter_moon:"1F317",waning_crescent_moon:"1F318",crescent_moon:"1F319",new_moon_with_face:"1F31A",first_quarter_moon_with_face:"1F31B",last_quarter_moon_with_face:"1F31C",full_moon_with_face:"1F31D",sun_with_face:"1F31E",star2:"1F31F",stars:"1F320",thermometer:"1F321-FE0F",mostly_sunny:"1F324-FE0F",barely_sunny:"1F325-FE0F",partly_sunny_rain:"1F326-FE0F",rain_cloud:"1F327-FE0F",snow_cloud:"1F328-FE0F",lightning:"1F329-FE0F",tornado:"1F32A-FE0F",fog:"1F32B-FE0F",wind_blowing_face:"1F32C-FE0F",hotdog:"1F32D",taco:"1F32E",burrito:"1F32F",chestnut:"1F330",seedling:"1F331",evergreen_tree:"1F332",deciduous_tree:"1F333",palm_tree:"1F334",cactus:"1F335",hot_pepper:"1F336-FE0F",tulip:"1F337",cherry_blossom:"1F338",rose:"1F339",hibiscus:"1F33A",sunflower:"1F33B",blossom:"1F33C",corn:"1F33D",ear_of_rice:"1F33E",herb:"1F33F",four_leaf_clover:"1F340",maple_leaf:"1F341",fallen_leaf:"1F342",leaves:"1F343",mushroom:"1F344",tomato:"1F345",eggplant:"1F346",grapes:"1F347",melon:"1F348",watermelon:"1F349",tangerine:"1F34A",lemon:"1F34B",banana:"1F34C",pineapple:"1F34D",apple:"1F34E",green_apple:"1F34F",pear:"1F350",peach:"1F351",cherries:"1F352",strawberry:"1F353",hamburger:"1F354",pizza:"1F355",meat_on_bone:"1F356",poultry_leg:"1F357",rice_cracker:"1F358",rice_ball:"1F359",rice:"1F35A",curry:"1F35B",ramen:"1F35C",spaghetti:"1F35D",bread:"1F35E",fries:"1F35F",sweet_potato:"1F360",dango:"1F361",oden:"1F362",sushi:"1F363",fried_shrimp:"1F364",fish_cake:"1F365",icecream:"1F366",shaved_ice:"1F367",ice_cream:"1F368",doughnut:"1F369",cookie:"1F36A",chocolate_bar:"1F36B",candy:"1F36C",lollipop:"1F36D",custard:"1F36E",honey_pot:"1F36F",cake:"1F370",bento:"1F371",stew:"1F372",fried_egg:"1F373",fork_and_knife:"1F374",tea:"1F375",sake:"1F376",wine_glass:"1F377",cocktail:"1F378",tropical_drink:"1F379",beer:"1F37A",beers:"1F37B",baby_bottle:"1F37C",knife_fork_plate:"1F37D-FE0F",champagne:"1F37E",popcorn:"1F37F",ribbon:"1F380",gift:"1F381",birthday:"1F382",jack_o_lantern:"1F383",christmas_tree:"1F384",santa:"1F385",fireworks:"1F386",sparkler:"1F387",balloon:"1F388",tada:"1F389",confetti_ball:"1F38A",tanabata_tree:"1F38B",crossed_flags:"1F38C",bamboo:"1F38D",dolls:"1F38E",flags:"1F38F",wind_chime:"1F390",rice_scene:"1F391",school_satchel:"1F392",mortar_board:"1F393",medal:"1F396-FE0F",reminder_ribbon:"1F397-FE0F",studio_microphone:"1F399-FE0F",level_slider:"1F39A-FE0F",control_knobs:"1F39B-FE0F",film_frames:"1F39E-FE0F",admission_tickets:"1F39F-FE0F",carousel_horse:"1F3A0",ferris_wheel:"1F3A1",roller_coaster:"1F3A2",fishing_pole_and_fish:"1F3A3",microphone:"1F3A4",movie_camera:"1F3A5",cinema:"1F3A6",headphones:"1F3A7",art:"1F3A8",tophat:"1F3A9",circus_tent:"1F3AA",ticket:"1F3AB",clapper:"1F3AC",performing_arts:"1F3AD",video_game:"1F3AE",dart:"1F3AF",slot_machine:"1F3B0","8ball":"1F3B1",game_die:"1F3B2",bowling:"1F3B3",flower_playing_cards:"1F3B4",musical_note:"1F3B5",notes:"1F3B6",saxophone:"1F3B7",guitar:"1F3B8",musical_keyboard:"1F3B9",trumpet:"1F3BA",violin:"1F3BB",musical_score:"1F3BC",running_shirt_with_sash:"1F3BD",tennis:"1F3BE",ski:"1F3BF",basketball:"1F3C0",checkered_flag:"1F3C1",snowboarder:"1F3C2","woman-running":"1F3C3-200D-2640-FE0F","man-running":"1F3C3-200D-2642-FE0F",runner:"1F3C3-200D-2642-FE0F","woman-surfing":"1F3C4-200D-2640-FE0F","man-surfing":"1F3C4-200D-2642-FE0F",surfer:"1F3C4-200D-2642-FE0F",sports_medal:"1F3C5",trophy:"1F3C6",horse_racing:"1F3C7",football:"1F3C8",rugby_football:"1F3C9","woman-swimming":"1F3CA-200D-2640-FE0F","man-swimming":"1F3CA-200D-2642-FE0F",swimmer:"1F3CA-200D-2642-FE0F","woman-lifting-weights":"1F3CB-FE0F-200D-2640-FE0F","man-lifting-weights":"1F3CB-FE0F-200D-2642-FE0F",weight_lifter:"1F3CB-FE0F-200D-2642-FE0F","woman-golfing":"1F3CC-FE0F-200D-2640-FE0F","man-golfing":"1F3CC-FE0F-200D-2642-FE0F",golfer:"1F3CC-FE0F-200D-2642-FE0F",racing_motorcycle:"1F3CD-FE0F",racing_car:"1F3CE-FE0F",cricket_bat_and_ball:"1F3CF",volleyball:"1F3D0",field_hockey_stick_and_ball:"1F3D1",ice_hockey_stick_and_puck:"1F3D2",table_tennis_paddle_and_ball:"1F3D3",snow_capped_mountain:"1F3D4-FE0F",camping:"1F3D5-FE0F",beach_with_umbrella:"1F3D6-FE0F",building_construction:"1F3D7-FE0F",house_buildings:"1F3D8-FE0F",cityscape:"1F3D9-FE0F",derelict_house_building:"1F3DA-FE0F",classical_building:"1F3DB-FE0F",desert:"1F3DC-FE0F",desert_island:"1F3DD-FE0F",national_park:"1F3DE-FE0F",stadium:"1F3DF-FE0F",house:"1F3E0",house_with_garden:"1F3E1",office:"1F3E2",post_office:"1F3E3",european_post_office:"1F3E4",hospital:"1F3E5",bank:"1F3E6",atm:"1F3E7",hotel:"1F3E8",love_hotel:"1F3E9",convenience_store:"1F3EA",school:"1F3EB",department_store:"1F3EC",factory:"1F3ED",izakaya_lantern:"1F3EE",japanese_castle:"1F3EF",european_castle:"1F3F0","rainbow-flag":"1F3F3-FE0F-200D-1F308",waving_white_flag:"1F3F3-FE0F","flag-england":"1F3F4-E0067-E0062-E0065-E006E-E0067-E007F","flag-scotland":"1F3F4-E0067-E0062-E0073-E0063-E0074-E007F","flag-wales":"1F3F4-E0067-E0062-E0077-E006C-E0073-E007F",waving_black_flag:"1F3F4",rosette:"1F3F5-FE0F",label:"1F3F7-FE0F",badminton_racquet_and_shuttlecock:"1F3F8",bow_and_arrow:"1F3F9",amphora:"1F3FA","skin-tone-2":"1F3FB","skin-tone-3":"1F3FC","skin-tone-4":"1F3FD","skin-tone-5":"1F3FE","skin-tone-6":"1F3FF",rat:"1F400",mouse2:"1F401",ox:"1F402",water_buffalo:"1F403",cow2:"1F404",tiger2:"1F405",leopard:"1F406",rabbit2:"1F407",cat2:"1F408",dragon:"1F409",crocodile:"1F40A",whale2:"1F40B",snail:"1F40C",snake:"1F40D",racehorse:"1F40E",ram:"1F40F",goat:"1F410",sheep:"1F411",monkey:"1F412",rooster:"1F413",chicken:"1F414",dog2:"1F415",pig2:"1F416",boar:"1F417",elephant:"1F418",octopus:"1F419",shell:"1F41A",bug:"1F41B",ant:"1F41C",bee:"1F41D",beetle:"1F41E",fish:"1F41F",tropical_fish:"1F420",blowfish:"1F421",turtle:"1F422",hatching_chick:"1F423",baby_chick:"1F424",hatched_chick:"1F425",bird:"1F426",penguin:"1F427",koala:"1F428",poodle:"1F429",dromedary_camel:"1F42A",camel:"1F42B",dolphin:"1F42C",mouse:"1F42D",cow:"1F42E",tiger:"1F42F",rabbit:"1F430",cat:"1F431",dragon_face:"1F432",whale:"1F433",horse:"1F434",monkey_face:"1F435",dog:"1F436",pig:"1F437",frog:"1F438",hamster:"1F439",wolf:"1F43A",bear:"1F43B",panda_face:"1F43C",pig_nose:"1F43D",feet:"1F43E",chipmunk:"1F43F-FE0F",eyes:"1F440","eye-in-speech-bubble":"1F441-FE0F-200D-1F5E8-FE0F",eye:"1F441-FE0F",ear:"1F442",nose:"1F443",lips:"1F444",tongue:"1F445",point_up_2:"1F446",point_down:"1F447",point_left:"1F448",point_right:"1F449",facepunch:"1F44A",wave:"1F44B",ok_hand:"1F44C","+1":"1F44D","-1":"1F44E",clap:"1F44F",open_hands:"1F450",crown:"1F451",womans_hat:"1F452",eyeglasses:"1F453",necktie:"1F454",shirt:"1F455",jeans:"1F456",dress:"1F457",kimono:"1F458",bikini:"1F459",womans_clothes:"1F45A",purse:"1F45B",handbag:"1F45C",pouch:"1F45D",mans_shoe:"1F45E",athletic_shoe:"1F45F",high_heel:"1F460",sandal:"1F461",boot:"1F462",footprints:"1F463",bust_in_silhouette:"1F464",busts_in_silhouette:"1F465",boy:"1F466",girl:"1F467","male-farmer":"1F468-200D-1F33E","male-cook":"1F468-200D-1F373","male-student":"1F468-200D-1F393","male-singer":"1F468-200D-1F3A4","male-artist":"1F468-200D-1F3A8","male-teacher":"1F468-200D-1F3EB","male-factory-worker":"1F468-200D-1F3ED","man-boy-boy":"1F468-200D-1F466-200D-1F466","man-boy":"1F468-200D-1F466","man-girl-boy":"1F468-200D-1F467-200D-1F466","man-girl-girl":"1F468-200D-1F467-200D-1F467","man-girl":"1F468-200D-1F467","man-man-boy":"1F468-200D-1F468-200D-1F466","man-man-boy-boy":"1F468-200D-1F468-200D-1F466-200D-1F466","man-man-girl":"1F468-200D-1F468-200D-1F467","man-man-girl-boy":"1F468-200D-1F468-200D-1F467-200D-1F466","man-man-girl-girl":"1F468-200D-1F468-200D-1F467-200D-1F467","man-woman-boy":"1F468-200D-1F469-200D-1F466","man-woman-boy-boy":"1F468-200D-1F469-200D-1F466-200D-1F466","man-woman-girl":"1F468-200D-1F469-200D-1F467","man-woman-girl-boy":"1F468-200D-1F469-200D-1F467-200D-1F466","man-woman-girl-girl":"1F468-200D-1F469-200D-1F467-200D-1F467","male-technologist":"1F468-200D-1F4BB","male-office-worker":"1F468-200D-1F4BC","male-mechanic":"1F468-200D-1F527","male-scientist":"1F468-200D-1F52C","male-astronaut":"1F468-200D-1F680","male-firefighter":"1F468-200D-1F692","male-doctor":"1F468-200D-2695-FE0F","male-judge":"1F468-200D-2696-FE0F","male-pilot":"1F468-200D-2708-FE0F","man-heart-man":"1F468-200D-2764-FE0F-200D-1F468","man-kiss-man":"1F468-200D-2764-FE0F-200D-1F48B-200D-1F468",man:"1F468","female-farmer":"1F469-200D-1F33E","female-cook":"1F469-200D-1F373","female-student":"1F469-200D-1F393","female-singer":"1F469-200D-1F3A4","female-artist":"1F469-200D-1F3A8","female-teacher":"1F469-200D-1F3EB","female-factory-worker":"1F469-200D-1F3ED","woman-boy-boy":"1F469-200D-1F466-200D-1F466","woman-boy":"1F469-200D-1F466","woman-girl-boy":"1F469-200D-1F467-200D-1F466","woman-girl-girl":"1F469-200D-1F467-200D-1F467","woman-girl":"1F469-200D-1F467","woman-woman-boy":"1F469-200D-1F469-200D-1F466","woman-woman-boy-boy":"1F469-200D-1F469-200D-1F466-200D-1F466","woman-woman-girl":"1F469-200D-1F469-200D-1F467","woman-woman-girl-boy":"1F469-200D-1F469-200D-1F467-200D-1F466","woman-woman-girl-girl":"1F469-200D-1F469-200D-1F467-200D-1F467","female-technologist":"1F469-200D-1F4BB","female-office-worker":"1F469-200D-1F4BC","female-mechanic":"1F469-200D-1F527","female-scientist":"1F469-200D-1F52C","female-astronaut":"1F469-200D-1F680","female-firefighter":"1F469-200D-1F692","female-doctor":"1F469-200D-2695-FE0F","female-judge":"1F469-200D-2696-FE0F","female-pilot":"1F469-200D-2708-FE0F","woman-heart-man":"1F469-200D-2764-FE0F-200D-1F468","woman-heart-woman":"1F469-200D-2764-FE0F-200D-1F469","woman-kiss-man":"1F469-200D-2764-FE0F-200D-1F48B-200D-1F468","woman-kiss-woman":"1F469-200D-2764-FE0F-200D-1F48B-200D-1F469",woman:"1F469",family:"1F468-200D-1F469-200D-1F466",couple:"1F46B",two_men_holding_hands:"1F46C",two_women_holding_hands:"1F46D","female-police-officer":"1F46E-200D-2640-FE0F","male-police-officer":"1F46E-200D-2642-FE0F",cop:"1F46E-200D-2642-FE0F","woman-with-bunny-ears-partying":"1F46F-200D-2640-FE0F","man-with-bunny-ears-partying":"1F46F-200D-2642-FE0F",dancers:"1F46F-200D-2640-FE0F",bride_with_veil:"1F470","blond-haired-woman":"1F471-200D-2640-FE0F","blond-haired-man":"1F471-200D-2642-FE0F",person_with_blond_hair:"1F471-200D-2642-FE0F",man_with_gua_pi_mao:"1F472","woman-wearing-turban":"1F473-200D-2640-FE0F","man-wearing-turban":"1F473-200D-2642-FE0F",man_with_turban:"1F473-200D-2642-FE0F",older_man:"1F474",older_woman:"1F475",baby:"1F476","female-construction-worker":"1F477-200D-2640-FE0F","male-construction-worker":"1F477-200D-2642-FE0F",construction_worker:"1F477-200D-2642-FE0F",princess:"1F478",japanese_ogre:"1F479",japanese_goblin:"1F47A",ghost:"1F47B",angel:"1F47C",alien:"1F47D",space_invader:"1F47E",imp:"1F47F",skull:"1F480","woman-tipping-hand":"1F481-200D-2640-FE0F","man-tipping-hand":"1F481-200D-2642-FE0F",information_desk_person:"1F481-200D-2640-FE0F","female-guard":"1F482-200D-2640-FE0F","male-guard":"1F482-200D-2642-FE0F",guardsman:"1F482-200D-2642-FE0F",dancer:"1F483",lipstick:"1F484",nail_care:"1F485","woman-getting-massage":"1F486-200D-2640-FE0F","man-getting-massage":"1F486-200D-2642-FE0F",massage:"1F486-200D-2640-FE0F","woman-getting-haircut":"1F487-200D-2640-FE0F","man-getting-haircut":"1F487-200D-2642-FE0F",haircut:"1F487-200D-2640-FE0F",barber:"1F488",syringe:"1F489",pill:"1F48A",kiss:"1F48B",love_letter:"1F48C",ring:"1F48D",gem:"1F48E",couplekiss:"1F469-200D-2764-FE0F-200D-1F48B-200D-1F468",bouquet:"1F490",couple_with_heart:"1F469-200D-2764-FE0F-200D-1F468",wedding:"1F492",heartbeat:"1F493",broken_heart:"1F494",two_hearts:"1F495",sparkling_heart:"1F496",heartpulse:"1F497",cupid:"1F498",blue_heart:"1F499",green_heart:"1F49A",yellow_heart:"1F49B",purple_heart:"1F49C",gift_heart:"1F49D",revolving_hearts:"1F49E",heart_decoration:"1F49F",diamond_shape_with_a_dot_inside:"1F4A0",bulb:"1F4A1",anger:"1F4A2",bomb:"1F4A3",zzz:"1F4A4",boom:"1F4A5",sweat_drops:"1F4A6",droplet:"1F4A7",dash:"1F4A8",hankey:"1F4A9",muscle:"1F4AA",dizzy:"1F4AB",speech_balloon:"1F4AC",thought_balloon:"1F4AD",white_flower:"1F4AE",100:"1F4AF",moneybag:"1F4B0",currency_exchange:"1F4B1",heavy_dollar_sign:"1F4B2",credit_card:"1F4B3",yen:"1F4B4",dollar:"1F4B5",euro:"1F4B6",pound:"1F4B7",money_with_wings:"1F4B8",chart:"1F4B9",seat:"1F4BA",computer:"1F4BB",briefcase:"1F4BC",minidisc:"1F4BD",floppy_disk:"1F4BE",cd:"1F4BF",dvd:"1F4C0",file_folder:"1F4C1",open_file_folder:"1F4C2",page_with_curl:"1F4C3",page_facing_up:"1F4C4",date:"1F4C5",calendar:"1F4C6",card_index:"1F4C7",chart_with_upwards_trend:"1F4C8",chart_with_downwards_trend:"1F4C9",bar_chart:"1F4CA",clipboard:"1F4CB",pushpin:"1F4CC",round_pushpin:"1F4CD",paperclip:"1F4CE",straight_ruler:"1F4CF",triangular_ruler:"1F4D0",bookmark_tabs:"1F4D1",ledger:"1F4D2",notebook:"1F4D3",notebook_with_decorative_cover:"1F4D4",closed_book:"1F4D5",book:"1F4D6",green_book:"1F4D7",blue_book:"1F4D8",orange_book:"1F4D9",books:"1F4DA",name_badge:"1F4DB",scroll:"1F4DC",memo:"1F4DD",telephone_receiver:"1F4DE",pager:"1F4DF",fax:"1F4E0",satellite_antenna:"1F4E1",loudspeaker:"1F4E2",mega:"1F4E3",outbox_tray:"1F4E4",inbox_tray:"1F4E5",package:"1F4E6","e-mail":"1F4E7",incoming_envelope:"1F4E8",envelope_with_arrow:"1F4E9",mailbox_closed:"1F4EA",mailbox:"1F4EB",mailbox_with_mail:"1F4EC",mailbox_with_no_mail:"1F4ED",postbox:"1F4EE",postal_horn:"1F4EF",newspaper:"1F4F0",iphone:"1F4F1",calling:"1F4F2",vibration_mode:"1F4F3",mobile_phone_off:"1F4F4",no_mobile_phones:"1F4F5",signal_strength:"1F4F6",camera:"1F4F7",camera_with_flash:"1F4F8",video_camera:"1F4F9",tv:"1F4FA",radio:"1F4FB",vhs:"1F4FC",film_projector:"1F4FD-FE0F",prayer_beads:"1F4FF",twisted_rightwards_arrows:"1F500",repeat:"1F501",repeat_one:"1F502",arrows_clockwise:"1F503",arrows_counterclockwise:"1F504",low_brightness:"1F505",high_brightness:"1F506",mute:"1F507",speaker:"1F508",sound:"1F509",loud_sound:"1F50A",battery:"1F50B",electric_plug:"1F50C",mag:"1F50D",mag_right:"1F50E",lock_with_ink_pen:"1F50F",closed_lock_with_key:"1F510",key:"1F511",lock:"1F512",unlock:"1F513",bell:"1F514",no_bell:"1F515",bookmark:"1F516",link:"1F517",radio_button:"1F518",back:"1F519",end:"1F51A",on:"1F51B",soon:"1F51C",top:"1F51D",underage:"1F51E",keycap_ten:"1F51F",capital_abcd:"1F520",abcd:"1F521",1234:"1F522",symbols:"1F523",abc:"1F524",fire:"1F525",flashlight:"1F526",wrench:"1F527",hammer:"1F528",nut_and_bolt:"1F529",hocho:"1F52A",gun:"1F52B",microscope:"1F52C",telescope:"1F52D",crystal_ball:"1F52E",six_pointed_star:"1F52F",beginner:"1F530",trident:"1F531",black_square_button:"1F532",white_square_button:"1F533",red_circle:"1F534",large_blue_circle:"1F535",large_orange_diamond:"1F536",large_blue_diamond:"1F537",small_orange_diamond:"1F538",small_blue_diamond:"1F539",small_red_triangle:"1F53A",small_red_triangle_down:"1F53B",arrow_up_small:"1F53C",arrow_down_small:"1F53D",om_symbol:"1F549-FE0F",dove_of_peace:"1F54A-FE0F",kaaba:"1F54B",mosque:"1F54C",synagogue:"1F54D",menorah_with_nine_branches:"1F54E",clock1:"1F550",clock2:"1F551",clock3:"1F552",clock4:"1F553",clock5:"1F554",clock6:"1F555",clock7:"1F556",clock8:"1F557",clock9:"1F558",clock10:"1F559",clock11:"1F55A",clock12:"1F55B",clock130:"1F55C",clock230:"1F55D",clock330:"1F55E",clock430:"1F55F",clock530:"1F560",clock630:"1F561",clock730:"1F562",clock830:"1F563",clock930:"1F564",clock1030:"1F565",clock1130:"1F566",clock1230:"1F567",candle:"1F56F-FE0F",mantelpiece_clock:"1F570-FE0F",hole:"1F573-FE0F",man_in_business_suit_levitating:"1F574-FE0F","female-detective":"1F575-FE0F-200D-2640-FE0F","male-detective":"1F575-FE0F-200D-2642-FE0F",sleuth_or_spy:"1F575-FE0F-200D-2642-FE0F",dark_sunglasses:"1F576-FE0F",spider:"1F577-FE0F",spider_web:"1F578-FE0F",joystick:"1F579-FE0F",man_dancing:"1F57A",linked_paperclips:"1F587-FE0F",lower_left_ballpoint_pen:"1F58A-FE0F",lower_left_fountain_pen:"1F58B-FE0F",lower_left_paintbrush:"1F58C-FE0F",lower_left_crayon:"1F58D-FE0F",raised_hand_with_fingers_splayed:"1F590-FE0F",middle_finger:"1F595","spock-hand":"1F596",black_heart:"1F5A4",desktop_computer:"1F5A5-FE0F",printer:"1F5A8-FE0F",three_button_mouse:"1F5B1-FE0F",trackball:"1F5B2-FE0F",frame_with_picture:"1F5BC-FE0F",card_index_dividers:"1F5C2-FE0F",card_file_box:"1F5C3-FE0F",file_cabinet:"1F5C4-FE0F",wastebasket:"1F5D1-FE0F",spiral_note_pad:"1F5D2-FE0F",spiral_calendar_pad:"1F5D3-FE0F",compression:"1F5DC-FE0F",old_key:"1F5DD-FE0F",rolled_up_newspaper:"1F5DE-FE0F",dagger_knife:"1F5E1-FE0F",speaking_head_in_silhouette:"1F5E3-FE0F",left_speech_bubble:"1F5E8-FE0F",right_anger_bubble:"1F5EF-FE0F",ballot_box_with_ballot:"1F5F3-FE0F",world_map:"1F5FA-FE0F",mount_fuji:"1F5FB",tokyo_tower:"1F5FC",statue_of_liberty:"1F5FD",japan:"1F5FE",moyai:"1F5FF",grinning:"1F600",grin:"1F601",joy:"1F602",smiley:"1F603",smile:"1F604",sweat_smile:"1F605",laughing:"1F606",innocent:"1F607",smiling_imp:"1F608",wink:"1F609",blush:"1F60A",yum:"1F60B",relieved:"1F60C",heart_eyes:"1F60D",sunglasses:"1F60E",smirk:"1F60F",neutral_face:"1F610",expressionless:"1F611",unamused:"1F612",sweat:"1F613",pensive:"1F614",confused:"1F615",confounded:"1F616",kissing:"1F617",kissing_heart:"1F618",kissing_smiling_eyes:"1F619",kissing_closed_eyes:"1F61A",stuck_out_tongue:"1F61B",stuck_out_tongue_winking_eye:"1F61C",stuck_out_tongue_closed_eyes:"1F61D",disappointed:"1F61E",worried:"1F61F",angry:"1F620",rage:"1F621",cry:"1F622",persevere:"1F623",triumph:"1F624",disappointed_relieved:"1F625",frowning:"1F626",anguished:"1F627",fearful:"1F628",weary:"1F629",sleepy:"1F62A",tired_face:"1F62B",grimacing:"1F62C",sob:"1F62D",open_mouth:"1F62E",hushed:"1F62F",cold_sweat:"1F630",scream:"1F631",astonished:"1F632",flushed:"1F633",sleeping:"1F634",dizzy_face:"1F635",no_mouth:"1F636",mask:"1F637",smile_cat:"1F638",joy_cat:"1F639",smiley_cat:"1F63A",heart_eyes_cat:"1F63B",smirk_cat:"1F63C",kissing_cat:"1F63D",pouting_cat:"1F63E",crying_cat_face:"1F63F",scream_cat:"1F640",slightly_frowning_face:"1F641",slightly_smiling_face:"1F642",upside_down_face:"1F643",face_with_rolling_eyes:"1F644","woman-gesturing-no":"1F645-200D-2640-FE0F","man-gesturing-no":"1F645-200D-2642-FE0F",no_good:"1F645-200D-2640-FE0F","woman-gesturing-ok":"1F646-200D-2640-FE0F","man-gesturing-ok":"1F646-200D-2642-FE0F",ok_woman:"1F646-200D-2640-FE0F","woman-bowing":"1F647-200D-2640-FE0F","man-bowing":"1F647-200D-2642-FE0F",bow:"1F647-200D-2642-FE0F",see_no_evil:"1F648",hear_no_evil:"1F649",speak_no_evil:"1F64A","woman-raising-hand":"1F64B-200D-2640-FE0F","man-raising-hand":"1F64B-200D-2642-FE0F",raising_hand:"1F64B-200D-2640-FE0F",raised_hands:"1F64C","woman-frowning":"1F64D-200D-2640-FE0F","man-frowning":"1F64D-200D-2642-FE0F",person_frowning:"1F64D-200D-2640-FE0F","woman-pouting":"1F64E-200D-2640-FE0F","man-pouting":"1F64E-200D-2642-FE0F",person_with_pouting_face:"1F64E-200D-2640-FE0F",pray:"1F64F",rocket:"1F680",helicopter:"1F681",steam_locomotive:"1F682",railway_car:"1F683",bullettrain_side:"1F684",bullettrain_front:"1F685",train2:"1F686",metro:"1F687",light_rail:"1F688",station:"1F689",tram:"1F68A",train:"1F68B",bus:"1F68C",oncoming_bus:"1F68D",trolleybus:"1F68E",busstop:"1F68F",minibus:"1F690",ambulance:"1F691",fire_engine:"1F692",police_car:"1F693",oncoming_police_car:"1F694",taxi:"1F695",oncoming_taxi:"1F696",car:"1F697",oncoming_automobile:"1F698",blue_car:"1F699",truck:"1F69A",articulated_lorry:"1F69B",tractor:"1F69C",monorail:"1F69D",mountain_railway:"1F69E",suspension_railway:"1F69F",mountain_cableway:"1F6A0",aerial_tramway:"1F6A1",ship:"1F6A2","woman-rowing-boat":"1F6A3-200D-2640-FE0F","man-rowing-boat":"1F6A3-200D-2642-FE0F",rowboat:"1F6A3-200D-2642-FE0F",speedboat:"1F6A4",traffic_light:"1F6A5",vertical_traffic_light:"1F6A6",construction:"1F6A7",rotating_light:"1F6A8",triangular_flag_on_post:"1F6A9",door:"1F6AA",no_entry_sign:"1F6AB",smoking:"1F6AC",no_smoking:"1F6AD",put_litter_in_its_place:"1F6AE",do_not_litter:"1F6AF",potable_water:"1F6B0","non-potable_water":"1F6B1",bike:"1F6B2",no_bicycles:"1F6B3","woman-biking":"1F6B4-200D-2640-FE0F","man-biking":"1F6B4-200D-2642-FE0F",bicyclist:"1F6B4-200D-2642-FE0F","woman-mountain-biking":"1F6B5-200D-2640-FE0F","man-mountain-biking":"1F6B5-200D-2642-FE0F",mountain_bicyclist:"1F6B5-200D-2642-FE0F","woman-walking":"1F6B6-200D-2640-FE0F","man-walking":"1F6B6-200D-2642-FE0F",walking:"1F6B6-200D-2642-FE0F",no_pedestrians:"1F6B7",children_crossing:"1F6B8",mens:"1F6B9",womens:"1F6BA",restroom:"1F6BB",baby_symbol:"1F6BC",toilet:"1F6BD",wc:"1F6BE",shower:"1F6BF",bath:"1F6C0",bathtub:"1F6C1",passport_control:"1F6C2",customs:"1F6C3",baggage_claim:"1F6C4",left_luggage:"1F6C5",couch_and_lamp:"1F6CB-FE0F",sleeping_accommodation:"1F6CC",shopping_bags:"1F6CD-FE0F",bellhop_bell:"1F6CE-FE0F",bed:"1F6CF-FE0F",place_of_worship:"1F6D0",octagonal_sign:"1F6D1",shopping_trolley:"1F6D2",hammer_and_wrench:"1F6E0-FE0F",shield:"1F6E1-FE0F",oil_drum:"1F6E2-FE0F",motorway:"1F6E3-FE0F",railway_track:"1F6E4-FE0F",motor_boat:"1F6E5-FE0F",small_airplane:"1F6E9-FE0F",airplane_departure:"1F6EB",airplane_arriving:"1F6EC",satellite:"1F6F0-FE0F",passenger_ship:"1F6F3-FE0F",scooter:"1F6F4",motor_scooter:"1F6F5",canoe:"1F6F6",sled:"1F6F7",flying_saucer:"1F6F8",zipper_mouth_face:"1F910",money_mouth_face:"1F911",face_with_thermometer:"1F912",nerd_face:"1F913",thinking_face:"1F914",face_with_head_bandage:"1F915",robot_face:"1F916",hugging_face:"1F917",the_horns:"1F918",call_me_hand:"1F919",raised_back_of_hand:"1F91A","left-facing_fist":"1F91B","right-facing_fist":"1F91C",handshake:"1F91D",crossed_fingers:"1F91E",i_love_you_hand_sign:"1F91F",face_with_cowboy_hat:"1F920",clown_face:"1F921",nauseated_face:"1F922",rolling_on_the_floor_laughing:"1F923",drooling_face:"1F924",lying_face:"1F925","woman-facepalming":"1F926-200D-2640-FE0F","man-facepalming":"1F926-200D-2642-FE0F",face_palm:"1F926",sneezing_face:"1F927",face_with_raised_eyebrow:"1F928","star-struck":"1F929",zany_face:"1F92A",shushing_face:"1F92B",face_with_symbols_on_mouth:"1F92C",face_with_hand_over_mouth:"1F92D",face_vomiting:"1F92E",exploding_head:"1F92F",pregnant_woman:"1F930","breast-feeding":"1F931",palms_up_together:"1F932",selfie:"1F933",prince:"1F934",man_in_tuxedo:"1F935",mrs_claus:"1F936","woman-shrugging":"1F937-200D-2640-FE0F","man-shrugging":"1F937-200D-2642-FE0F",shrug:"1F937","woman-cartwheeling":"1F938-200D-2640-FE0F","man-cartwheeling":"1F938-200D-2642-FE0F",person_doing_cartwheel:"1F938","woman-juggling":"1F939-200D-2640-FE0F","man-juggling":"1F939-200D-2642-FE0F",juggling:"1F939",fencer:"1F93A","woman-wrestling":"1F93C-200D-2640-FE0F","man-wrestling":"1F93C-200D-2642-FE0F",wrestlers:"1F93C","woman-playing-water-polo":"1F93D-200D-2640-FE0F","man-playing-water-polo":"1F93D-200D-2642-FE0F",water_polo:"1F93D","woman-playing-handball":"1F93E-200D-2640-FE0F","man-playing-handball":"1F93E-200D-2642-FE0F",handball:"1F93E",wilted_flower:"1F940",drum_with_drumsticks:"1F941",clinking_glasses:"1F942",tumbler_glass:"1F943",spoon:"1F944",goal_net:"1F945",first_place_medal:"1F947",second_place_medal:"1F948",third_place_medal:"1F949",boxing_glove:"1F94A",martial_arts_uniform:"1F94B",curling_stone:"1F94C",croissant:"1F950",avocado:"1F951",cucumber:"1F952",bacon:"1F953",potato:"1F954",carrot:"1F955",baguette_bread:"1F956",green_salad:"1F957",shallow_pan_of_food:"1F958",stuffed_flatbread:"1F959",egg:"1F95A",glass_of_milk:"1F95B",peanuts:"1F95C",kiwifruit:"1F95D",pancakes:"1F95E",dumpling:"1F95F",fortune_cookie:"1F960",takeout_box:"1F961",chopsticks:"1F962",bowl_with_spoon:"1F963",cup_with_straw:"1F964",coconut:"1F965",broccoli:"1F966",pie:"1F967",pretzel:"1F968",cut_of_meat:"1F969",sandwich:"1F96A",canned_food:"1F96B",crab:"1F980",lion_face:"1F981",scorpion:"1F982",turkey:"1F983",unicorn_face:"1F984",eagle:"1F985",duck:"1F986",bat:"1F987",shark:"1F988",owl:"1F989",fox_face:"1F98A",butterfly:"1F98B",deer:"1F98C",gorilla:"1F98D",lizard:"1F98E",rhinoceros:"1F98F",shrimp:"1F990",squid:"1F991",giraffe_face:"1F992",zebra_face:"1F993",hedgehog:"1F994",sauropod:"1F995","t-rex":"1F996",cricket:"1F997",cheese_wedge:"1F9C0",face_with_monocle:"1F9D0",adult:"1F9D1",child:"1F9D2",older_adult:"1F9D3",bearded_person:"1F9D4",person_with_headscarf:"1F9D5",woman_in_steamy_room:"1F9D6-200D-2640-FE0F",man_in_steamy_room:"1F9D6-200D-2642-FE0F",person_in_steamy_room:"1F9D6-200D-2642-FE0F",woman_climbing:"1F9D7-200D-2640-FE0F",man_climbing:"1F9D7-200D-2642-FE0F",person_climbing:"1F9D7-200D-2640-FE0F",woman_in_lotus_position:"1F9D8-200D-2640-FE0F",man_in_lotus_position:"1F9D8-200D-2642-FE0F",person_in_lotus_position:"1F9D8-200D-2640-FE0F",female_mage:"1F9D9-200D-2640-FE0F",male_mage:"1F9D9-200D-2642-FE0F",mage:"1F9D9-200D-2640-FE0F",female_fairy:"1F9DA-200D-2640-FE0F",male_fairy:"1F9DA-200D-2642-FE0F",fairy:"1F9DA-200D-2640-FE0F",female_vampire:"1F9DB-200D-2640-FE0F",male_vampire:"1F9DB-200D-2642-FE0F",vampire:"1F9DB-200D-2640-FE0F",mermaid:"1F9DC-200D-2640-FE0F",merman:"1F9DC-200D-2642-FE0F",merperson:"1F9DC-200D-2642-FE0F",female_elf:"1F9DD-200D-2640-FE0F",male_elf:"1F9DD-200D-2642-FE0F",elf:"1F9DD-200D-2642-FE0F",female_genie:"1F9DE-200D-2640-FE0F",male_genie:"1F9DE-200D-2642-FE0F",genie:"1F9DE-200D-2642-FE0F",female_zombie:"1F9DF-200D-2640-FE0F",male_zombie:"1F9DF-200D-2642-FE0F",zombie:"1F9DF-200D-2642-FE0F",brain:"1F9E0",orange_heart:"1F9E1",billed_cap:"1F9E2",scarf:"1F9E3",gloves:"1F9E4",coat:"1F9E5",socks:"1F9E6",bangbang:"203C-FE0F",interrobang:"2049-FE0F",tm:"2122-FE0F",information_source:"2139-FE0F",left_right_arrow:"2194-FE0F",arrow_up_down:"2195-FE0F",arrow_upper_left:"2196-FE0F",arrow_upper_right:"2197-FE0F",arrow_lower_right:"2198-FE0F",arrow_lower_left:"2199-FE0F",leftwards_arrow_with_hook:"21A9-FE0F",arrow_right_hook:"21AA-FE0F",watch:"231A",hourglass:"231B",keyboard:"2328-FE0F",eject:"23CF-FE0F",fast_forward:"23E9",rewind:"23EA",arrow_double_up:"23EB",arrow_double_down:"23EC",black_right_pointing_double_triangle_with_vertical_bar:"23ED-FE0F",black_left_pointing_double_triangle_with_vertical_bar:"23EE-FE0F",black_right_pointing_triangle_with_double_vertical_bar:"23EF-FE0F",alarm_clock:"23F0",stopwatch:"23F1-FE0F",timer_clock:"23F2-FE0F",hourglass_flowing_sand:"23F3",double_vertical_bar:"23F8-FE0F",black_square_for_stop:"23F9-FE0F",black_circle_for_record:"23FA-FE0F",m:"24C2-FE0F",black_small_square:"25AA-FE0F",white_small_square:"25AB-FE0F",arrow_forward:"25B6-FE0F",arrow_backward:"25C0-FE0F",white_medium_square:"25FB-FE0F",black_medium_square:"25FC-FE0F",white_medium_small_square:"25FD",black_medium_small_square:"25FE",sunny:"2600-FE0F",cloud:"2601-FE0F",umbrella:"2602-FE0F",snowman:"2603-FE0F",comet:"2604-FE0F",phone:"260E-FE0F",ballot_box_with_check:"2611-FE0F",umbrella_with_rain_drops:"2614",coffee:"2615",shamrock:"2618-FE0F",point_up:"261D-FE0F",skull_and_crossbones:"2620-FE0F",radioactive_sign:"2622-FE0F",biohazard_sign:"2623-FE0F",orthodox_cross:"2626-FE0F",star_and_crescent:"262A-FE0F",peace_symbol:"262E-FE0F",yin_yang:"262F-FE0F",wheel_of_dharma:"2638-FE0F",white_frowning_face:"2639-FE0F",relaxed:"263A-FE0F",female_sign:"2640-FE0F",male_sign:"2642-FE0F",aries:"2648",taurus:"2649",gemini:"264A",cancer:"264B",leo:"264C",virgo:"264D",libra:"264E",scorpius:"264F",sagittarius:"2650",capricorn:"2651",aquarius:"2652",pisces:"2653",spades:"2660-FE0F",clubs:"2663-FE0F",hearts:"2665-FE0F",diamonds:"2666-FE0F",hotsprings:"2668-FE0F",recycle:"267B-FE0F",wheelchair:"267F",hammer_and_pick:"2692-FE0F",anchor:"2693",crossed_swords:"2694-FE0F",medical_symbol:"2695-FE0F",scales:"2696-FE0F",alembic:"2697-FE0F",gear:"2699-FE0F",atom_symbol:"269B-FE0F",fleur_de_lis:"269C-FE0F",warning:"26A0-FE0F",zap:"26A1",white_circle:"26AA",black_circle:"26AB",coffin:"26B0-FE0F",funeral_urn:"26B1-FE0F",soccer:"26BD",baseball:"26BE",snowman_without_snow:"26C4",partly_sunny:"26C5",thunder_cloud_and_rain:"26C8-FE0F",ophiuchus:"26CE",pick:"26CF-FE0F",helmet_with_white_cross:"26D1-FE0F",chains:"26D3-FE0F",no_entry:"26D4",shinto_shrine:"26E9-FE0F",church:"26EA",mountain:"26F0-FE0F",umbrella_on_ground:"26F1-FE0F",fountain:"26F2",golf:"26F3",ferry:"26F4-FE0F",boat:"26F5",skier:"26F7-FE0F",ice_skate:"26F8-FE0F","woman-bouncing-ball":"26F9-FE0F-200D-2640-FE0F","man-bouncing-ball":"26F9-FE0F-200D-2642-FE0F",person_with_ball:"26F9-FE0F-200D-2642-FE0F",tent:"26FA",fuelpump:"26FD",scissors:"2702-FE0F",white_check_mark:"2705",airplane:"2708-FE0F",email:"2709-FE0F",fist:"270A",hand:"270B",v:"270C-FE0F",writing_hand:"270D-FE0F",pencil2:"270F-FE0F",black_nib:"2712-FE0F",heavy_check_mark:"2714-FE0F",heavy_multiplication_x:"2716-FE0F",latin_cross:"271D-FE0F",star_of_david:"2721-FE0F",sparkles:"2728",eight_spoked_asterisk:"2733-FE0F",eight_pointed_black_star:"2734-FE0F",snowflake:"2744-FE0F",sparkle:"2747-FE0F",x:"274C",negative_squared_cross_mark:"274E",question:"2753",grey_question:"2754",grey_exclamation:"2755",exclamation:"2757",heavy_heart_exclamation_mark_ornament:"2763-FE0F",heart:"2764-FE0F",heavy_plus_sign:"2795",heavy_minus_sign:"2796",heavy_division_sign:"2797",arrow_right:"27A1-FE0F",curly_loop:"27B0",loop:"27BF",arrow_heading_up:"2934-FE0F",arrow_heading_down:"2935-FE0F",arrow_left:"2B05-FE0F",arrow_up:"2B06-FE0F",arrow_down:"2B07-FE0F",black_large_square:"2B1B",white_large_square:"2B1C",star:"2B50",o:"2B55",wavy_dash:"3030-FE0F",part_alternation_mark:"303D-FE0F",congratulations:"3297-FE0F",secret:"3299-FE0F"}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core/emoji/auto_complete",["exports","core/emoji/data","core/templates","core/utils","core/localstorage","core/key_codes"],(function(_exports,EmojiData,_templates,_utils,_localstorage,_key_codes){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,EmojiData=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(EmojiData),_localstorage=_interopRequireDefault(_localstorage),_key_codes=_interopRequireDefault(_key_codes);var fn,_ref,SELECTORS_EMOJI_BUTTON='[data-region="emoji-button"]',SELECTORS_ACTIVE_EMOJI_BUTTON='[data-region="emoji-button"].active',getRecentEmojis=function(){var storedData=_localstorage.default.get("moodle-recent-emojis");return storedData?JSON.parse(storedData):[]},addRecentEmoji=function(unified,shortName){var newEmoji={unified:unified,shortnames:[shortName]},recentEmojis=getRecentEmojis(),newRecentEmojis=[newEmoji].concat(_toConsumableArray(recentEmojis.filter((function(emoji){return emoji.unified!=newEmoji.unified}))));newRecentEmojis=newRecentEmojis.slice(0,27),_localstorage.default.set("moodle-recent-emojis",JSON.stringify(newRecentEmojis))},getEmojiTextFromShortName=function(shortName){var unified=EmojiData.byShortName[shortName];if(unified){var charCodes=unified.split("-").map((function(code){return"0x".concat(code)}));return String.fromCodePoint.apply(null,charCodes)}return null},render=(fn=regeneratorRuntime.mark((function _callee(root,shortNames){var renderContext,html;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return renderContext={emojis:shortNames.map((function(shortName,index){return{active:0===index,emojitext:getEmojiTextFromShortName(shortName),displayshortname:":".concat(shortName,":"),shortname:shortName,unified:EmojiData.byShortName[shortName]}}))},_context.next=3,(0,_templates.render)("core/emoji/auto_complete",renderContext);case 3:html=_context.sent,root.innerHTML=html;case 5:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2){return _ref.apply(this,arguments)}),getShortNameFromText=function(text){return text.replace(/:/g,"")},getActiveEmojiSuggestion=function(root){return root.querySelector(SELECTORS_ACTIVE_EMOJI_BUTTON)},selectEmojiElement=function(element,selectCallback){var shortName=element.getAttribute("data-short-name"),unified=element.getAttribute("data-unified");addRecentEmoji(unified,shortName),selectCallback(element.innerHTML.trim())};return _exports.default=function(root,textArea,hasSuggestionCallback,selectCallback){var hasSuggestions=!1,previousSearchText="";textArea.addEventListener("keyup",(0,_utils.debounce)((function(){var searchText=function(text,position){var startMatches=text.slice(0,position).match(/(\S*)$/),endMatches=text.slice(position).match(/^(\S*)/),startText="",endText="";return startMatches&&(startText=startMatches[startMatches.length-1]),endMatches&&(endText=endMatches[endMatches.length-1]),"".concat(startText).concat(endText)}(textArea.value,textArea.selectionStart);if(searchText!==previousSearchText){if(previousSearchText=searchText,function(text){return/^:[^:\s]+:$/.test(text)}(searchText)){var shortName=getShortNameFromText(searchText),emojiText=getEmojiTextFromShortName(shortName);hasSuggestions=!1,emojiText&&(addRecentEmoji(EmojiData.byShortName[shortName],shortName),selectCallback(emojiText))}else if(function(text){return/^:[^:\s]*$/.test(text)}(searchText)){var suggestions=(searchTerm=getShortNameFromText(searchText),limit=50,""===searchTerm?getRecentEmojis().map((function(data){return data.shortnames[0]})).slice(0,limit):(searchTerm=searchTerm.toLowerCase(),Object.keys(EmojiData.byShortName).filter((function(shortName){return shortName.includes(searchTerm)})).slice(0,limit)));suggestions.length?(render(root,suggestions),hasSuggestions=!0):hasSuggestions=!1}else hasSuggestions=!1;var searchTerm,limit;hasSuggestionCallback(hasSuggestions)}}),200)),textArea.addEventListener("keydown",(function(e){if(hasSuggestions&&!(e.shiftKey||e.metaKey||e.altKey||e.ctrlKey))switch(e.which){case _key_codes.default.escape:hasSuggestions=!1,hasSuggestionCallback(!1);break;case _key_codes.default.arrowLeft:!function(root){var activeEmojiSuggestion=getActiveEmojiSuggestion(root),previousSuggestion=activeEmojiSuggestion.previousElementSibling;previousSuggestion&&(activeEmojiSuggestion.classList.remove("active"),previousSuggestion.classList.add("active"),previousSuggestion.scrollIntoView({behaviour:"smooth",inline:"center"}))}(root),e.preventDefault();break;case _key_codes.default.arrowRight:!function(root){var activeEmojiSuggestion=getActiveEmojiSuggestion(root),nextSuggestion=activeEmojiSuggestion.nextElementSibling;nextSuggestion&&(activeEmojiSuggestion.classList.remove("active"),nextSuggestion.classList.add("active"),nextSuggestion.scrollIntoView({behaviour:"smooth",inline:"center"}))}(root),e.preventDefault();break;case _key_codes.default.enter:selectEmojiElement(getActiveEmojiSuggestion(root),selectCallback),e.preventDefault(),e.stopPropagation()}})),root.addEventListener("click",(function(e){var target=e.target;target.matches(SELECTORS_EMOJI_BUTTON)&&selectEmojiElement(target,selectCallback)}))},_exports.default}));
define("core/emoji/picker",["exports","core/localstorage","core/emoji/data","core/utils","core/str","core/templates"],(function(_exports,_localstorage,EmojiData,_utils,_str,_templates){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_localstorage=(obj=_localstorage)&&obj.__esModule?obj:{default:obj},EmojiData=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(EmojiData);var _ref,_ref2,_ref7,_ref8,ROW_TYPE_EMOJI=0,ROW_TYPE_HEADER=1,SELECTORS_CATEGORY_SELECTOR='[data-action="show-category"]',SELECTORS_EMOJIS_CONTAINER='[data-region="emojis-container"]',SELECTORS_EMOJI_PREVIEW='[data-region="emoji-preview"]',SELECTORS_EMOJI_SHORT_NAME='[data-region="emoji-short-name"]',SELECTORS_ROW_CONTAINER='[data-region="row-container"]',SELECTORS_SEARCH_INPUT='[data-region="search-input"]',SELECTORS_SEARCH_RESULTS_CONTAINER='[data-region="search-results-container"]',createRowDataForCategory=function(categoryName,categoryDisplayName,emojis,totalRowCount){var rowData=[];rowData.push({index:totalRowCount+rowData.length,type:ROW_TYPE_HEADER,data:{name:categoryName,displayName:categoryDisplayName}});for(var i=0;i<emojis.length;i+=7){var rowEmojis=emojis.slice(i,i+7);rowData.push({index:totalRowCount+rowData.length,type:ROW_TYPE_EMOJI,data:rowEmojis})}return rowData},addIndexesToRowData=function(rowData){return rowData.map((function(data,index){return _objectSpread(_objectSpread({},data),{},{index:index})}))},getCategoryScrollPositionsFromRowData=function(rowData){return rowData.reduce((function(carry,row,index){return row.type===ROW_TYPE_HEADER&&(carry[row.data.name]=40*index),carry}),{})},createHeaderRow=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(rowIndex,name){var context,html,temp;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return context={index:rowIndex,text:name},_context.next=3,(0,_templates.render)("core/emoji/header_row",context);case 3:return html=_context.sent,(temp=document.createElement("div")).innerHTML=html,_context.abrupt("return",temp.firstChild);case 7:case"end":return _context.stop()}}),_callee)}))),function(_x,_x2){return _ref.apply(this,arguments)}),createEmojiRow=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(rowIndex,emojis){var context,html,temp;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return context={index:rowIndex,emojis:emojis.map((function(emojiData){var charCodes=emojiData.unified.split("-").map((function(code){return"0x".concat(code)})),emojiText=String.fromCodePoint.apply(null,charCodes);return{shortnames:":".concat(emojiData.shortnames.join(": :"),":"),unified:emojiData.unified,text:emojiText,spacer:!1}})),spacers:Array(7-emojis.length).fill(!0)},_context2.next=3,(0,_templates.render)("core/emoji/emoji_row",context);case 3:return html=_context2.sent,(temp=document.createElement("div")).innerHTML=html,_context2.abrupt("return",temp.firstChild);case 7:case"end":return _context2.stop()}}),_callee2)}))),function(_x3,_x4){return _ref2.apply(this,arguments)}),isEmojiElement=function(element){return null!==element.getAttribute("data-short-names")},findCategorySelectorFromElement=function findCategorySelectorFromElement(element){return element?"show-category"===element.getAttribute("data-action")?element:findCategorySelectorFromElement(element.parentElement):null},getCategorySelectorByCategoryName=function(root,name){return root.querySelector('[data-category="'.concat(name,'"]'))},getCategoryByScrollPosition=function(root,position,categoryScrollPositions){var positions=[];for(var _categoryName in position<0&&(position=0),categoryScrollPositions){var categoryPosition=categoryScrollPositions[_categoryName];positions.push([categoryPosition,_categoryName])}positions.sort((function(_ref3,_ref4){var a=_slicedToArray(_ref3,1)[0],b=_slicedToArray(_ref4,1)[0];return a<b?-1:a>b?1:0}));var _positions$reduce=positions.reduce((function(carry,candidate){var _candidate=_slicedToArray(candidate,2),categoryPosition=_candidate[0],categoryName=_candidate[1];return categoryPosition<=position?(carry.categoryName=categoryName,carry.previousPosition=carry.currentPosition,carry.currentPosition=position):null===carry.nextPosition&&(carry.nextPosition=categoryPosition),carry}),{categoryName:null,currentPosition:null,previousPosition:null,nextPosition:null}),categoryName=_positions$reduce.categoryName,previousPosition=_positions$reduce.previousPosition,nextPosition=_positions$reduce.nextPosition;return[getCategorySelectorByCategoryName(root,categoryName),previousPosition,nextPosition]},getRecentEmojis=function(){var storedData=_localstorage.default.get("moodle-recent-emojis");return storedData?JSON.parse(storedData):[]},addRecentEmoji=function(rowData,recentEmojiRowCount,newEmoji){var categoryName=rowData[0].data.name,categoryDisplayName=rowData[0].data.displayName,recentEmojis=getRecentEmojis(),newRecentEmojis=[newEmoji].concat(_toConsumableArray(recentEmojis.filter((function(emoji){return emoji.unified!=newEmoji.unified}))));newRecentEmojis=newRecentEmojis.slice(0,21);var newRecentEmojiRowData=createRowDataForCategory(categoryName,categoryDisplayName,newRecentEmojis);return function(recentEmojis){_localstorage.default.set("moodle-recent-emojis",JSON.stringify(recentEmojis))}(newRecentEmojis),[addIndexesToRowData(newRecentEmojiRowData.concat(rowData.slice(recentEmojiRowCount))),newRecentEmojiRowData.length]},getRowsToRender=function(scrollPosition,visibleRowCount,rowData){var minVisibleRow=scrollPosition>40?Math.floor(scrollPosition/40):0,start=minVisibleRow>=5?minVisibleRow-5:minVisibleRow,end=minVisibleRow+visibleRowCount+5;return rowData.slice(start,end)},createRowElement=(_ref7=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(rowData){var row;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(row=null,rowData.type!==ROW_TYPE_HEADER){_context3.next=7;break}return _context3.next=4,createHeaderRow(rowData.index,rowData.data.displayName);case 4:row=_context3.sent,_context3.next=10;break;case 7:return _context3.next=9,createEmojiRow(rowData.index,rowData.data);case 9:row=_context3.sent;case 10:return row.style.position="absolute",row.style.left=0,row.style.right=0,row.style.top="".concat(40*rowData.index,"px"),_context3.abrupt("return",row);case 15:case"end":return _context3.stop()}}),_callee3)}))),function(_x5){return _ref7.apply(this,arguments)}),doRowsMatch=function(a,b){if(a.index!==b.index)return!1;if(a.type!==b.type)return!1;if(_typeof(a.data)!=_typeof(b.data))return!1;if(a.type===ROW_TYPE_HEADER)return a.data.name===b.data.name;if(a.data.length!==b.data.length)return!1;for(var i=0;i<a.data.length;i++)if(a.data[i].unified!=b.data[i].unified)return!1;return!0},renderRows=(_ref8=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(rowContainer,currentRows,nextRows){var toAdd,toKeep,toRemove,toRemoveElements;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return toAdd=nextRows.filter((function(nextRow){return!currentRows.some((function(currentRow){return doRowsMatch(currentRow,nextRow)}))})),toKeep=currentRows.filter((function(currentRow){return nextRows.some((function(nextRow){return doRowsMatch(currentRow,nextRow)}))})),toRemove=currentRows.filter((function(currentRow){return!nextRows.some((function(nextRow){return doRowsMatch(currentRow,nextRow)}))})),toRemoveElements=toRemove.map((function(rowData){return rowContainer.querySelectorAll('[data-row="'.concat(rowData.index,'"]'))})),_context4.next=6,Promise.all(toAdd.map((function(rowData){return createRowElement(rowData)})));case 6:_context4.sent.forEach((function(row,index){for(var rowData=toAdd[index],nextRowIndex=null,i=0;i<toKeep.length;i++)if(toKeep[i].index>rowData.index){nextRowIndex=i;break}if(null!==nextRowIndex){var nextRowData=toKeep[nextRowIndex],nextRowNode=rowContainer.querySelector('[data-row="'.concat(nextRowData.index,'"]'));rowContainer.insertBefore(row,nextRowNode),toKeep.splice(nextRowIndex,0,toKeep)}else toKeep.push(rowData),rowContainer.appendChild(row)})),toRemoveElements.forEach((function(rows){for(var i=0;i<rows.length;i++){var row=rows[i];rowContainer.removeChild(row)}}));case 9:case"end":return _context4.stop()}}),_callee4)}))),function(_x6,_x7,_x8){return _ref8.apply(this,arguments)}),generateRenderRowsAtPositionFunction=function(rowContainer){var _ref9,currentRows=[],nextRows=[],rowCount=0,isRendering=!1,renderNextRows=(_ref9=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(){var nextRowsToRender;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(nextRows.length){_context5.next=2;break}return _context5.abrupt("return");case 2:if(!isRendering){_context5.next=4;break}return _context5.abrupt("return");case 4:return isRendering=!0,nextRowsToRender=nextRows.slice(),nextRows=[],_context5.next=9,renderRows(rowContainer,currentRows,nextRowsToRender);case 9:currentRows=nextRowsToRender,isRendering=!1,renderNextRows();case 12:case"end":return _context5.stop()}}),_callee5)}))),function(){return _ref9.apply(this,arguments)});return function(scrollPosition,rowData){var rowLimit=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;nextRows=getRowsToRender(scrollPosition,rowLimit,rowData),renderNextRows(),rowCount!==rowData.length&&(rowContainer.style.height="".concat(40*rowData.length,"px")),rowCount=rowData.length}},showSearchResults=function(emojiContainer,searchResultsContainer){searchResultsContainer.classList.remove("hidden"),emojiContainer.classList.add("hidden")},clearSearch=function(emojiContainer,searchResultsContainer,searchInput){searchResultsContainer.classList.add("hidden"),emojiContainer.classList.remove("hidden"),searchInput.value=""},getHandleMouseEnter=function(emojiPreview,emojiShortName){return function(e){var target=e.target;isEmojiElement(target)&&(emojiShortName.textContent=target.getAttribute("data-short-names"),emojiPreview.textContent=target.textContent)}},getHandleMouseLeave=function(emojiPreview,emojiShortName){return function(e){var target=e.target;isEmojiElement(target)&&(emojiShortName.textContent="",emojiPreview.textContent="")}},getHandleScroll=function(root,currentVisibleRowScrollPosition,emojiContainer,initialCategoryScrollPositions,renderAtPosition){var _getCategoryByScrollP2=_slicedToArray(getCategoryByScrollPosition(root,emojiContainer.scrollTop,initialCategoryScrollPositions),3),currentCategoryElement=_getCategoryByScrollP2[0],previousCategoryPosition=_getCategoryByScrollP2[1],nextCategoryPosition=_getCategoryByScrollP2[2];return function(categoryScrollPositions,rowData){var newScrollPosition=emojiContainer.scrollTop,updateRenderRows=newScrollPosition<currentVisibleRowScrollPosition-40||newScrollPosition>currentVisibleRowScrollPosition+40;if(newScrollPosition>=nextCategoryPosition||newScrollPosition<previousCategoryPosition){var _getCategoryByScrollP4=_slicedToArray(getCategoryByScrollPosition(root,newScrollPosition,categoryScrollPositions),3);currentCategoryElement=_getCategoryByScrollP4[0],previousCategoryPosition=_getCategoryByScrollP4[1],nextCategoryPosition=_getCategoryByScrollP4[2],function(root,element){for(var allCategorySelectors=root.querySelectorAll(SELECTORS_CATEGORY_SELECTOR),i=0;i<allCategorySelectors.length;i++)allCategorySelectors[i].classList.remove("selected");element.classList.add("selected")}(root,currentCategoryElement)}updateRenderRows&&requestAnimationFrame((function(){renderAtPosition(newScrollPosition,rowData),currentVisibleRowScrollPosition=newScrollPosition}))}},registerEventListeners=function(root,emojiContainer,renderAtPosition,currentVisibleRowScrollPosition,selectCallback,categoryScrollPositions,rowData,recentEmojiRowCount){var searchInput=root.querySelector(SELECTORS_SEARCH_INPUT),searchResultsContainer=root.querySelector(SELECTORS_SEARCH_RESULTS_CONTAINER),emojiPreview=root.querySelector(SELECTORS_EMOJI_PREVIEW),emojiShortName=root.querySelector(SELECTORS_EMOJI_SHORT_NAME),clickHandler=function(recentEmojiRowCount,emojiContainer,searchResultsContainer,searchInput,selectCallback,renderAtPosition){return function(e,rowData,categoryScrollPositions){var target=e.target,newRowData=rowData,newCategoryScrollPositions=categoryScrollPositions;if(clearSearch(emojiContainer,searchResultsContainer,searchInput),isEmojiElement(target)){var emojiData={unified:target.getAttribute("data-unified"),shortnames:target.getAttribute("data-short-names").replace(/:/g,"").split(" ")},currentScrollTop=emojiContainer.scrollTop,isRecentEmojiRowVisible=null!==emojiContainer.querySelector('[data-row="'.concat(recentEmojiRowCount-1,'"]')),_addRecentEmoji2=_slicedToArray(addRecentEmoji(rowData,recentEmojiRowCount,emojiData),2);return newRowData=_addRecentEmoji2[0],recentEmojiRowCount=_addRecentEmoji2[1],newCategoryScrollPositions=getCategoryScrollPositionsFromRowData(newRowData),isRecentEmojiRowVisible&&renderAtPosition(currentScrollTop,newRowData),selectCallback(target.textContent),[newRowData,newCategoryScrollPositions]}var categorySelector=findCategorySelectorFromElement(target);if(categorySelector){var position=categoryScrollPositions[categorySelector.getAttribute("data-category")];emojiContainer.scrollTop=position}return[newRowData,newCategoryScrollPositions]}}(recentEmojiRowCount,emojiContainer,searchResultsContainer,searchInput,selectCallback,renderAtPosition),scrollHandler=getHandleScroll(root,currentVisibleRowScrollPosition,emojiContainer,categoryScrollPositions,renderAtPosition),searchHandler=function(searchInput,searchResultsContainer,emojiContainer){var rowContainer=searchResultsContainer.querySelector(SELECTORS_ROW_CONTAINER),renderSearchResultsAtPosition=generateRenderRowsAtPositionFunction(rowContainer);return searchResultsContainer.appendChild(rowContainer),_asyncToGenerator(regeneratorRuntime.mark((function _callee6(){var searchTerm,matchingEmojis,searchResultsString,rowData;return regeneratorRuntime.wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(!(searchTerm=searchInput.value.toLowerCase())){_context6.next=11;break}return showSearchResults(emojiContainer,searchResultsContainer),matchingEmojis=Object.keys(EmojiData.byShortName).reduce((function(carry,shortName){return shortName.includes(searchTerm)&&carry.push({shortnames:[shortName],unified:EmojiData.byShortName[shortName]}),carry}),[]),_context6.next=6,(0,_str.get_string)("searchresults","core");case 6:searchResultsString=_context6.sent,rowData=createRowDataForCategory(searchResultsString,searchResultsString,matchingEmojis,0),renderSearchResultsAtPosition(0,rowData,rowData.length),_context6.next=12;break;case 11:clearSearch(emojiContainer,searchResultsContainer,searchInput);case 12:case"end":return _context6.stop()}}),_callee6)})))}(searchInput,searchResultsContainer,emojiContainer);root.addEventListener("focus",getHandleMouseEnter(emojiPreview,emojiShortName),!0),root.addEventListener("blur",getHandleMouseLeave(emojiPreview,emojiShortName),!0),root.addEventListener("mouseenter",getHandleMouseEnter(emojiPreview,emojiShortName),!0),root.addEventListener("mouseleave",getHandleMouseLeave(emojiPreview,emojiShortName),!0),root.addEventListener("click",(function(e){var _clickHandler2=_slicedToArray(clickHandler(e,rowData,categoryScrollPositions),2);rowData=_clickHandler2[0],categoryScrollPositions=_clickHandler2[1]})),emojiContainer.addEventListener("scroll",(0,_utils.throttle)((function(){return scrollHandler(categoryScrollPositions,rowData)}),50)),searchInput.addEventListener("input",(0,_utils.debounce)(searchHandler,200))};return _exports.default=function(root,selectCallback){var emojiContainer=root.querySelector(SELECTORS_EMOJIS_CONTAINER),rowContainer=emojiContainer.querySelector(SELECTORS_ROW_CONTAINER),allData=[{name:"Recent",emojis:getRecentEmojis()}].concat(_toConsumableArray(EmojiData.byCategory)),rowData=[],recentEmojiRowCount=0;allData.forEach((function(category){var categoryDisplayName=getCategorySelectorByCategoryName(root,category.name).title,categoryRowData=createRowDataForCategory(category.name,categoryDisplayName,category.emojis,rowData.length);"Recent"===category.name&&(recentEmojiRowCount=categoryRowData.length),rowData=rowData.concat(categoryRowData)})),rowData=addIndexesToRowData(rowData);var categoryScrollPositions=getCategoryScrollPositionsFromRowData(rowData),renderAtPosition=generateRenderRowsAtPositionFunction(rowContainer);renderAtPosition(0,rowData),registerEventListeners(root,emojiContainer,renderAtPosition,0,selectCallback,categoryScrollPositions,rowData,recentEmojiRowCount)},_exports.default}));
/**
 * Autocomplete wrapper for select2 library.
 *
 * @module     core/form-autocomplete
 * @class      autocomplete
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.0
 */
define("core/form-autocomplete",["jquery","core/log","core/str","core/templates","core/notification","core/loadingicon"],(function($,log,str,templates,notification,LoadingIcon){var KEYS_DOWN=40,KEYS_ENTER=13,KEYS_SPACE=32,KEYS_ESCAPE=27,KEYS_COMMA=44,KEYS_UP=38,KEYS_LEFT=37,KEYS_RIGHT=39,uniqueId=Date.now(),activateSelection=function(index,state){var selectionElement=$(document.getElementById(state.selectionId)),length=selectionElement.children("[aria-selected=true]").length;for(index%=length;index<0;)index+=length;var element=$(selectionElement.children("[aria-selected=true]").get(index)),itemId=state.selectionId+"-"+index;return selectionElement.children().attr("data-active-selection",null).attr("id",""),element.attr("data-active-selection",!0).attr("id",itemId),selectionElement.attr("aria-activedescendant",itemId),selectionElement.attr("data-active-value",element.attr("data-value")),$.Deferred().resolve()},updateActiveSelectionFromState=function(state){var activeElement=function(state){var selectionRegion=$(document.getElementById(state.selectionId)),activeId=selectionRegion.attr("aria-activedescendant");if(activeId){var activeElement=$(document.getElementById(activeId));if(activeElement.length)return activeElement}var activeValue=selectionRegion.attr("data-active-value");return selectionRegion.find('[data-value="'+activeValue+'"]')}(state),activeValue=activeElement.attr("data-value"),selectionRegion=$(document.getElementById(state.selectionId));if(activeValue){var activeIndex=selectionRegion.find("[aria-selected=true]").index(activeElement);if(-1!==activeIndex)return void activateSelection(activeIndex,state)}activateSelection(0,state)},updateSelectionList=function(options,state,originalSelect){var pendingKey="form-autocomplete-updateSelectionList-"+state.inputId;M.util.js_pending(pendingKey);var items=[],newSelection=$(document.getElementById(state.selectionId));if(originalSelect.children("option").each((function(index,ele){var label;$(ele).prop("selected")&&(""!==(label=$(ele).data("html")?$(ele).data("html"):$(ele).html())&&items.push({label:label,value:$(ele).attr("value")}))})),!hasItemListChanged(state,items))return M.util.js_complete(pendingKey),Promise.resolve();state.items=items;var context=$.extend(options,state);return templates.render(options.templates.items,context).then((function(html,js){templates.replaceNodeContents(newSelection,html,js),updateActiveSelectionFromState(state)})).then((function(){return M.util.js_complete(pendingKey)})).catch(notification.exception)},hasItemListChanged=function(state,items){return state.items.length!==items.length||state.items.filter((function(item){return-1===items.indexOf(item)})).length>0},notifyChange=function(originalSelect){var event;void 0!==M.core_formchangechecker&&M.core_formchangechecker.set_form_changed(),"function"==typeof Event?event=new Event("change"):(event=document.createEvent("Event")).initEvent("change",!0,!0),originalSelect[0].dispatchEvent(event)},deselectItem=function(options,state,item,originalSelect){var selectedItemValue=$(item).attr("data-value");return originalSelect.children("option").each((function(index,ele){$(ele).attr("value")==selectedItemValue&&($(ele).prop("selected",!1),$(ele).attr("data-iscustom")&&$(ele).remove())})),updateSelectionList(options,state,originalSelect).then((function(){notifyChange(originalSelect)}))},activateItem=function(index,state){var inputElement=$(document.getElementById(state.inputId)),suggestionsElement=$(document.getElementById(state.suggestionsId)),length=suggestionsElement.children("[aria-hidden=false]").length;for(index%=length;index<0;)index+=length;var element=$(suggestionsElement.children("[aria-hidden=false]").get(index)),globalIndex=$(suggestionsElement.children("[role=option]")).index(element),itemId=state.suggestionsId+"-"+globalIndex;suggestionsElement.children().attr("aria-selected",!1).attr("id",""),element.attr("aria-selected",!0).attr("id",itemId),inputElement.attr("aria-activedescendant",itemId);var scrollPos=element.offset().top-suggestionsElement.offset().top+suggestionsElement.scrollTop()-suggestionsElement.height()/2;return suggestionsElement.animate({scrollTop:scrollPos},100).promise()},closeSuggestions=function(state){var inputElement=$(document.getElementById(state.inputId)),suggestionsElement=$(document.getElementById(state.suggestionsId));return"true"===inputElement.attr("aria-expanded")&&inputElement.attr("aria-expanded",!1),inputElement.attr("aria-activedescendant",state.selectionId),suggestionsElement.hide().attr("aria-hidden",!0),$.Deferred().resolve()},updateSuggestions=function(options,state,query,originalSelect){var pendingKey="form-autocomplete-updateSuggestions-"+state.inputId;M.util.js_pending(pendingKey);var inputElement=$(document.getElementById(state.inputId)),suggestionsElement=$(document.getElementById(state.suggestionsId)),matchingElements=!1,suggestions=[];originalSelect.children("option").each((function(index,option){!0!==$(option).prop("selected")&&(suggestions[suggestions.length]={label:option.innerHTML,value:$(option).attr("value")})}));var searchquery=state.caseSensitive?query:query.toLocaleLowerCase(),context=$.extend({options:suggestions},options,state);return templates.render("core/form_autocomplete_suggestions",context).then((function(html,js){return templates.replaceNode(suggestionsElement,html,js),(suggestionsElement=$(document.getElementById(state.suggestionsId))).show().attr("aria-hidden",!1),suggestionsElement.children().each((function(index,node){node=$(node),options.caseSensitive&&node.text().indexOf(searchquery)>-1||!options.caseSensitive&&node.text().toLocaleLowerCase().indexOf(searchquery)>-1?(node.show().attr("aria-hidden",!1),matchingElements=!0):node.hide().attr("aria-hidden",!0)})),inputElement.attr("aria-expanded",!0),originalSelect.attr("data-notice")?suggestionsElement.html(originalSelect.attr("data-notice")):matchingElements?options.tags||activateItem(0,state):str.get_string("nosuggestions","form").done((function(nosuggestionsstr){suggestionsElement.html(nosuggestionsstr)})),suggestionsElement})).then((function(){return M.util.js_complete(pendingKey)})).catch(notification.exception)},createItem=function(options,state,originalSelect){var inputElement=$(document.getElementById(state.inputId)),tags=inputElement.val().split(","),found=!1;return $.each(tags,(function(tagindex,tag){if(""!==(tag=tag.trim())&&(options.multiple||originalSelect.children("option").prop("selected",!1),originalSelect.children("option").each((function(index,ele){$(ele).attr("value")==tag&&(found=!0,$(ele).prop("selected",!0))})),!found)){var option=$("<option>");option.append(document.createTextNode(tag)),option.attr("value",tag),originalSelect.append(option),option.prop("selected",!0),option.attr("data-iscustom",!0)}})),updateSelectionList(options,state,originalSelect).then((function(){notifyChange(originalSelect)})).then((function(){inputElement.val("")})).then((function(){return closeSuggestions(state)}))},selectCurrentItem=function(options,state,originalSelect){var inputElement=$(document.getElementById(state.inputId)),selectedItemValue=$(document.getElementById(state.suggestionsId)).children("[aria-selected=true]").attr("data-value");return options.multiple||originalSelect.children("option").prop("selected",!1),originalSelect.children("option").each((function(index,ele){$(ele).attr("value")==selectedItemValue&&$(ele).prop("selected",!0)})),updateSelectionList(options,state,originalSelect).then((function(){notifyChange(originalSelect)})).then((function(){return options.closeSuggestionsOnSelect?(inputElement.val(""),closeSuggestions(state)):(inputElement.focus(),updateSuggestions(options,state,inputElement.val(),originalSelect))}))},updateAjax=function(e,options,state,originalSelect,ajaxHandler){var pendingPromise=addPendingJSPromise("updateAjax"),parentElement=$(document.getElementById(state.selectId)).parent();LoadingIcon.addIconToContainerRemoveOnCompletion(parentElement,pendingPromise);var query=$(e.currentTarget).val();return ajaxHandler.transport(options.selector,query,(function(results){var processedResults=ajaxHandler.processResults(options.selector,results),existingValues=[];if(options.multiple||originalSelect.children("option").remove(),originalSelect.children("option").each((function(optionIndex,option){(option=$(option)).prop("selected")?existingValues.push(String(option.attr("value"))):option.remove()})),!options.multiple&&0===originalSelect.children("option").length){var option=$("<option>");originalSelect.append(option)}$.isArray(processedResults)?($.each(processedResults,(function(resultIndex,result){if(-1===existingValues.indexOf(String(result.value))){var option=$("<option>");option.append(result.label),option.attr("value",result.value),originalSelect.append(option)}})),originalSelect.attr("data-notice","")):originalSelect.attr("data-notice",processedResults),pendingPromise.resolve(updateSuggestions(options,state,"",originalSelect))}),(function(error){pendingPromise.reject(error)})),pendingPromise},addNavigation=function(options,state,originalSelect){var inputElement=$(document.getElementById(state.inputId));(inputElement.on("keydown",(function(e){var pendingJsPromise=addPendingJSPromise("addNavigation-"+state.inputId+"-"+e.keyCode);switch(e.keyCode){case KEYS_DOWN:return options.showSuggestions?("true"===inputElement.attr("aria-expanded")?pendingJsPromise.resolve(function(state){var suggestionsElement=$(document.getElementById(state.suggestionsId)),element=suggestionsElement.children("[aria-selected=true]"),current=suggestionsElement.children("[aria-hidden=false]").index(element);return activateItem(current+1,state)}(state)):!inputElement.val()&&options.ajax?require([options.ajax],(function(ajaxHandler){pendingJsPromise.resolve(updateAjax(e,options,state,originalSelect,ajaxHandler))})):pendingJsPromise.resolve(updateSuggestions(options,state,inputElement.val(),originalSelect)),e.preventDefault(),!1):(pendingJsPromise.resolve(),!0);case KEYS_UP:return pendingJsPromise.resolve(function(state){var suggestionsElement=$(document.getElementById(state.suggestionsId)),element=suggestionsElement.children("[aria-selected=true]"),current=suggestionsElement.children("[aria-hidden=false]").index(element);return activateItem(current-1,state)}(state)),e.preventDefault(),!1;case KEYS_ENTER:var suggestionsElement=$(document.getElementById(state.suggestionsId));return"true"===inputElement.attr("aria-expanded")&&suggestionsElement.children("[aria-selected=true]").length>0?pendingJsPromise.resolve(selectCurrentItem(options,state,originalSelect)):options.tags?pendingJsPromise.resolve(createItem(options,state,originalSelect)):pendingJsPromise.resolve(),e.preventDefault(),!1;case KEYS_ESCAPE:return"true"===inputElement.attr("aria-expanded")?pendingJsPromise.resolve(closeSuggestions(state)):pendingJsPromise.resolve(),e.preventDefault(),!1}return pendingJsPromise.resolve(),!0})),inputElement.on("keypress",(function(e){return e.keyCode!==KEYS_COMMA||(options.tags&&addPendingJSPromise("keypress-"+e.keyCode).resolve(createItem(options,state,originalSelect)),e.preventDefault(),!1)})),inputElement.closest("form").on("submit",(function(){return options.tags&&addPendingJSPromise("form-autocomplete-submit").resolve(createItem(options,state,originalSelect)),!0})),inputElement.on("blur",(function(){var pendingPromise=addPendingJSPromise("form-autocomplete-blur");window.setTimeout((function(){var focusElement=$(document.activeElement),timeoutPromise=$.Deferred();focusElement.is(document.getElementById(state.suggestionsId))?inputElement.focus():!focusElement.is(inputElement)&&$(document.getElementById(state.inputId)).length&&(options.tags&&timeoutPromise.then((function(){return createItem(options,state,originalSelect)})).catch(),timeoutPromise.then((function(){return closeSuggestions(state)})).catch()),timeoutPromise.then((function(){return pendingPromise.resolve()})).catch(),timeoutPromise.resolve()}),500)})),options.showSuggestions)&&$(document.getElementById(state.downArrowId)).on("click",(function(e){var pendingPromise=addPendingJSPromise("form-autocomplete-show-suggestions");inputElement.focus(),!inputElement.val()&&options.ajax?require([options.ajax],(function(ajaxHandler){pendingPromise.resolve(updateAjax(e,options,state,originalSelect,ajaxHandler))})):pendingPromise.resolve(updateSuggestions(options,state,inputElement.val(),originalSelect))}));var suggestionsElement=$(document.getElementById(state.suggestionsId));suggestionsElement.parent().prop("onclick",null).off("click"),suggestionsElement.parent().on("click","#".concat(state.suggestionsId," [role=option]"),(function(e){var pendingPromise=addPendingJSPromise("form-autocomplete-parent"),element=$(e.currentTarget).closest("[role=option]"),current=$(document.getElementById(state.suggestionsId)).children("[aria-hidden=false]").index(element);activateItem(current,state).then((function(){return selectCurrentItem(options,state,originalSelect)})).then((function(){return pendingPromise.resolve()})).catch()}));var selectionElement=$(document.getElementById(state.selectionId));selectionElement.on("click","[role=option]",(function(e){addPendingJSPromise("form-autocomplete-clicks").resolve(deselectItem(options,state,$(e.currentTarget),originalSelect))})),selectionElement.on("focus",(function(){updateActiveSelectionFromState(state)})),selectionElement.on("keydown",(function(e){var pendingPromise=addPendingJSPromise("form-autocomplete-keydown-"+e.keyCode);switch(e.keyCode){case KEYS_RIGHT:case KEYS_DOWN:return e.preventDefault(),void pendingPromise.resolve(function(state){var selectionsElement=$(document.getElementById(state.selectionId)),element=selectionsElement.children("[data-active-selection]"),current=0;return element?(current=selectionsElement.children("[aria-selected=true]").index(element),current+=1):current=0,activateSelection(current,state)}(state));case KEYS_LEFT:case KEYS_UP:return e.preventDefault(),void pendingPromise.resolve(function(state){var selectionsElement=$(document.getElementById(state.selectionId)),element=selectionsElement.children("[data-active-selection]");if(!element)return activateSelection(0,state);var current=selectionsElement.children("[aria-selected=true]").index(element);return activateSelection(current-1,state)}(state));case KEYS_SPACE:case KEYS_ENTER:var selectedItem=$(document.getElementById(state.selectionId)).children("[data-active-selection]");return void(selectedItem&&(e.preventDefault(),pendingPromise.resolve(deselectItem(options,state,selectedItem,originalSelect))))}pendingPromise.resolve()})),options.showSuggestions&&(inputElement.on("focus",(function(e){var query=$(e.currentTarget).val();$(e.currentTarget).data("last-value",query)})),options.ajax?require([options.ajax],(function(ajaxHandler){var throttleTimeout=null,inProgress=!1,pendingKey="autocomplete-throttledhandler",handler=function(e){throttleTimeout=null,inProgress=!0,updateAjax(e,options,state,originalSelect,ajaxHandler).then((function(){return null===throttleTimeout&&M.util.js_complete(pendingKey),inProgress=!1,arguments[0]})).catch(notification.exception)},throttledHandler=function throttledHandler(e){window.clearTimeout(throttleTimeout),inProgress?throttleTimeout=window.setTimeout(throttledHandler.bind(this,e),100):(null===throttleTimeout&&M.util.js_pending(pendingKey),throttleTimeout=window.setTimeout(handler.bind(this,e),300))};inputElement.on("input",(function(e){var query=$(e.currentTarget).val();$(e.currentTarget).data("last-value")!==query&&throttledHandler(e),$(e.currentTarget).data("last-value",query)}))})):inputElement.on("input",(function(e){var query=$(e.currentTarget).val();$(e.currentTarget).data("last-value")!==query&&updateSuggestions(options,state,query,originalSelect),$(e.currentTarget).data("last-value",query)})))},addPendingJSPromise=function(key){var pendingKey="form-autocomplete:"+key;M.util.js_pending(pendingKey);var pendingPromise=$.Deferred();return pendingPromise.then((function(){return M.util.js_complete(pendingKey),arguments[0]})).catch(notification.exception),pendingPromise};return{enhance:function(selector,tags,ajax,placeholder,caseSensitive,showSuggestions,noSelectionString,closeSuggestionsOnSelect,templateOverrides){var options={selector:selector,tags:!1,ajax:!1,placeholder:placeholder,caseSensitive:!1,showSuggestions:!0,noSelectionString:noSelectionString,templates:$.extend({input:"core/form_autocomplete_input",items:"core/form_autocomplete_selection_items",layout:"core/form_autocomplete_layout",selection:"core/form_autocomplete_selection",suggestions:"core/form_autocomplete_suggestions"},templateOverrides)},pendingKey="autocomplete-setup-"+selector;M.util.js_pending(pendingKey),void 0!==tags&&(options.tags=tags),void 0!==ajax&&(options.ajax=ajax),void 0!==caseSensitive&&(options.caseSensitive=caseSensitive),void 0!==showSuggestions&&(options.showSuggestions=showSuggestions),void 0===noSelectionString&&str.get_string("noselection","form").done((function(result){options.noSelectionString=result})).fail(notification.exception);var originalSelect=$(selector);if(!originalSelect)return log.debug("Selector not found: "+selector),M.util.js_complete(pendingKey),!1;originalSelect.css("visibility","hidden").attr("aria-hidden",!0);var state={selectId:originalSelect.attr("id"),inputId:"form_autocomplete_input-"+uniqueId,suggestionsId:"form_autocomplete_suggestions-"+uniqueId,selectionId:"form_autocomplete_selection-"+uniqueId,downArrowId:"form_autocomplete_downarrow-"+uniqueId,items:[]};uniqueId++,options.multiple=originalSelect.attr("multiple"),options.multiple||originalSelect.prepend("<option>"),options.closeSuggestionsOnSelect=void 0!==closeSuggestionsOnSelect?closeSuggestionsOnSelect:!options.multiple;var originalLabel=$("[for="+state.selectId+"]"),suggestions=[];originalSelect.children("option").each((function(index,option){suggestions[index]={label:option.innerHTML,value:$(option).attr("value")}}));var context=$.extend({},options,state);context.options=suggestions,context.items=[];var collectedjs="",renderLayout=templates.render(options.templates.layout,{}).then((function(html){return $(html)})),renderInput=templates.render(options.templates.input,context).then((function(html,js){return collectedjs+=js,$(html)})),renderDatalist=templates.render(options.templates.suggestions,context).then((function(html,js){return collectedjs+=js,$(html)})),renderSelection=templates.render(options.templates.selection,context).then((function(html,js){return collectedjs+=js,$(html)}));return $.when(renderLayout,renderInput,renderDatalist,renderSelection).then((function(layout,input,suggestions,selection){originalSelect.hide();var container=originalSelect.parent();$(input).find("input").attr("data-fieldtype","autocomplete"),container.append(layout),container.find('[data-region="form_autocomplete-input"]').replaceWith(input),container.find('[data-region="form_autocomplete-suggestions"]').replaceWith(suggestions),container.find('[data-region="form_autocomplete-selection"]').replaceWith(selection),templates.runTemplateJS(collectedjs),originalLabel.attr("for",state.inputId),addNavigation(options,state,originalSelect),$(document.getElementById(state.suggestionsId)).hide().attr("aria-hidden",!0)})).then((function(){return updateSelectionList(options,state,originalSelect)})).then((function(){return M.util.js_complete(pendingKey)})).catch((function(error){M.util.js_complete(pendingKey),notification.exception(error)}))}}}));
/**
 * Javascript for dynamically changing the page limits.
 *
 * @module     core/paged_content_paging_bar_limit_selector
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_paging_bar_limit_selector",["jquery","core/custom_interaction_events","core/paged_content_events","core/pubsub"],(function($,CustomEvents,PagedContentEvents,PubSub){var SELECTORS_LIMIT_OPTION="[data-limit]";return{init:function(root,id){root=$(root),CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_LIMIT_OPTION,(function(e,data){var optionElement=$(e.target).closest(SELECTORS_LIMIT_OPTION);if(!optionElement.hasClass("active")){var limit=parseInt(optionElement.attr("data-limit"),10);PubSub.publish(id+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT,limit),data.originalEvent.preventDefault()}}))},rootSelector:'[data-region="paging-control-limit-container"]'}}));
/**
 * This module provides a wrapper to encapsulate a lot of the common combinations of
 * user interaction we use in Moodle.
 *
 * @module     core/custom_interaction_events
 * @class      custom_interaction_events
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("core/custom_interaction_events",["jquery","core/key_codes"],(function($,keyCodes){var events={activate:"cie:activate",keyboardActivate:"cie:keyboardactivate",escape:"cie:escape",down:"cie:down",up:"cie:up",home:"cie:home",end:"cie:end",next:"cie:next",previous:"cie:previous",asterix:"cie:asterix",scrollLock:"cie:scrollLock",scrollTop:"cie:scrollTop",scrollBottom:"cie:scrollBottom",ctrlPageUp:"cie:ctrlPageUp",ctrlPageDown:"cie:ctrlPageDown",enter:"cie:enter",accessibleChange:"cie:accessibleChange"},triggeredEvents={},isModifierPressed=function(e){return e.shiftKey||e.metaKey||e.altKey||e.ctrlKey},triggerEvent=function(eventName,e){var eventTypeKey="";return e.hasOwnProperty("originalEvent")?(eventTypeKey="triggeredCustom_"+eventName,e.originalEvent.hasOwnProperty(eventTypeKey)?void 0:(e.originalEvent[eventTypeKey]=!0,void $(e.target).trigger(eventName,[{originalEvent:e}]))):(eventTypeKey=""+eventName+e.type+e.timeStamp,void(triggeredEvents.hasOwnProperty(eventTypeKey)||(triggeredEvents[eventTypeKey]=!0,$(e.target).trigger(eventName,[{originalEvent:e}]))))},addKeyboardEvent=function(element,event,keyCode){element.off("keydown."+event).on("keydown."+event,(function(e){isModifierPressed(e)||e.keyCode==keyCode&&triggerEvent(event,e)}))},addActivateListener=function(element){element.off("click.cie.activate").on("click.cie.activate",(function(e){triggerEvent(events.activate,e)})),element.off("keydown.cie.activate").on("keydown.cie.activate",(function(e){isModifierPressed(e)||e.keyCode!=keyCodes.enter&&e.keyCode!=keyCodes.space||triggerEvent(events.activate,e)}))},addKeyboardActivateListener=function(element){element.off("keydown.cie.keyboardactivate").on("keydown.cie.keyboardactivate",(function(e){isModifierPressed(e)||e.keyCode!=keyCodes.enter&&e.keyCode!=keyCodes.space||triggerEvent(events.keyboardActivate,e)}))},addEscapeListener=function(element){addKeyboardEvent(element,events.escape,keyCodes.escape)},addDownListener=function(element){addKeyboardEvent(element,events.down,keyCodes.arrowDown)},addUpListener=function(element){addKeyboardEvent(element,events.up,keyCodes.arrowUp)},addHomeListener=function(element){addKeyboardEvent(element,events.home,keyCodes.home)},addEndListener=function(element){addKeyboardEvent(element,events.end,keyCodes.end)},addNextListener=function(element){var keyCode="rtl"==$("html").attr("dir")?keyCodes.arrowLeft:keyCodes.arrowRight;addKeyboardEvent(element,events.next,keyCode)},addPreviousListener=function(element){var keyCode="rtl"==$("html").attr("dir")?keyCodes.arrowRight:keyCodes.arrowLeft;addKeyboardEvent(element,events.previous,keyCode)},addAsterixListener=function(element){addKeyboardEvent(element,events.asterix,keyCodes.asterix)},addScrollTopListener=function(element){element.off("scroll.cie.scrollTop").on("scroll.cie.scrollTop",(function(e){0===element.scrollTop()&&triggerEvent(events.scrollTop,e)}))},addScrollBottomListener=function(element){element.off("scroll.cie.scrollBottom").on("scroll.cie.scrollBottom",(function(e){element.scrollTop()+element.innerHeight()>=element[0].scrollHeight&&triggerEvent(events.scrollBottom,e)}))},addScrollLockListener=function(element){element.off("DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock").on("DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock",(function(e){var scrollTop=element.scrollTop(),scrollHeight=element[0].scrollHeight,height=element.height(),delta="DOMMouseScroll"==e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,up=delta>0;return!up&&-delta>scrollHeight-height-scrollTop?(element.scrollTop(scrollHeight),e.stopPropagation(),e.preventDefault(),e.returnValue=!1,triggerEvent(events.scrollLock,e),!1):!(up&&delta>scrollTop)||(element.scrollTop(0),e.stopPropagation(),e.preventDefault(),e.returnValue=!1,triggerEvent(events.scrollLock,e),!1)}))},addCtrlPageUpListener=function(element){element.off("keydown.cie.ctrlpageup").on("keydown.cie.ctrlpageup",(function(e){e.ctrlKey&&e.keyCode==keyCodes.pageUp&&triggerEvent(events.ctrlPageUp,e)}))},addCtrlPageDownListener=function(element){element.off("keydown.cie.ctrlpagedown").on("keydown.cie.ctrlpagedown",(function(e){e.ctrlKey&&e.keyCode==keyCodes.pageDown&&triggerEvent(events.ctrlPageDown,e)}))},addEnterListener=function(element){addKeyboardEvent(element,events.enter,keyCodes.enter)},addAccessibleChangeListener=function(element){var onMac=-1!==navigator.userAgent.indexOf("Macintosh"),touchEnabled="ontouchstart"in window||"msMaxTouchPoints"in navigator&&navigator.msMaxTouchPoints>0;if(onMac||touchEnabled)element.on("change",(function(e){triggerEvent(events.accessibleChange,e)}));else{var checkAndTriggerAccessibleChange=function(e){"initValue"in e.target.dataset&&e.target.value!==e.target.dataset.initValue&&(e.target.dataset.initValue=e.target.value,triggerEvent(events.accessibleChange,e))},nativeElement=element.get()[0];nativeElement.addEventListener("focus",(function(e){var target;(target=e.target).dataset.initValue=target.value}),!0),nativeElement.addEventListener("blur",(function(e){checkAndTriggerAccessibleChange(e)}),!0),element.on("keydown",(function(e){var target;e.which===keyCodes.enter?checkAndTriggerAccessibleChange(e):e.which===keyCodes.escape?("initValue"in(target=e.target).dataset&&(target.value=target.dataset.initValue),e.target.dataset.ignoreChange=!0):e.target.dataset.ignoreChange=!0})),element.on("change",(function(e){e.target.dataset.ignoreChange||checkAndTriggerAccessibleChange(e)})),element.on("keyup",(function(e){delete e.target.dataset.ignoreChange})),element.on("click",(function(e){checkAndTriggerAccessibleChange(e)}))}};return{define:function(element,include){var handlers;(element=$(element),include=include||[],element.length&&include.length)&&$.each(((handlers={})[events.activate]=addActivateListener,handlers[events.keyboardActivate]=addKeyboardActivateListener,handlers[events.escape]=addEscapeListener,handlers[events.down]=addDownListener,handlers[events.up]=addUpListener,handlers[events.home]=addHomeListener,handlers[events.end]=addEndListener,handlers[events.next]=addNextListener,handlers[events.previous]=addPreviousListener,handlers[events.asterix]=addAsterixListener,handlers[events.scrollLock]=addScrollLockListener,handlers[events.scrollTop]=addScrollTopListener,handlers[events.scrollBottom]=addScrollBottomListener,handlers[events.ctrlPageUp]=addCtrlPageUpListener,handlers[events.ctrlPageDown]=addCtrlPageDownListener,handlers[events.enter]=addEnterListener,handlers[events.accessibleChange]=addAccessibleChangeListener,handlers),(function(eventType,handler){(function(eventType,include){return!(!(include=include||[]).length||-1===include.indexOf(eventType))})(eventType,include)&&handler(element)}))},events:events}}));
/**
 * Show/hide admin settings based on other settings selected
 *
 * @package core
 * @copyright 2018 Davo Smith, Synergy Learning
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/showhidesettings",["jquery"],(function($){var dependencies;function isCheckboxHiddenElement($el){return $el.is("input[type=hidden]")&&$el.siblings('input[type=checkbox][name="'+$el.attr("name")+'"]').length}function isCheckedRelevant($el,value){return!isCheckboxHiddenElement($el)&&!function($el,value){return $el.is("input[type=radio]")&&$el.attr("value")!==value}($el,value)}function isUncheckedRadioButton($el){return $el.is("input[type=radio]")&&!$el.prop("checked")}function isUncheckedCheckbox($el){return $el.is("input[type=checkbox]")&&!$el.prop("checked")}function isMultiSelect($el){return $el.is("select")&&$el.prop("multiple")}function multiSelectMatches($el,values){var selected=$el.val()||[];if(!values.length)return!1;if(selected.length!==values.length)return!1;for(var i in selected)if(selected.hasOwnProperty(i)&&-1===values.indexOf(selected[i]))return!1;return!0}var depFns={notchecked:function($dependon,value){var hide=!1;return value=String(value),$dependon.each((function(idx,el){var $el=$(el);isCheckedRelevant($el,value)&&(hide=hide||!$el.prop("checked"))})),hide},checked:function($dependon,value){var hide=!1;return value=String(value),$dependon.each((function(idx,el){var $el=$(el);isCheckedRelevant($el,value)&&(hide=hide||$el.prop("checked"))})),hide},noitemselected:function($dependon){var hide=!1;return $dependon.each((function(idx,el){var $el=$(el);hide=hide||-1===$el.prop("selectedIndex")})),hide},eq:function($dependon,value){var hide=!1,hiddenVal=!1;return value=String(value),$dependon.each((function(idx,el){var $el=$(el);if(!isUncheckedRadioButton($el))if(isCheckboxHiddenElement($el))hiddenVal=$el.val()===value;else if(isUncheckedCheckbox($el))hide=hide||hiddenVal;else if(isMultiSelect($el)){var values=value.split("|");hide=multiSelectMatches($el,values)}else hide=hide||$el.val()===value})),hide},in:function($dependon,value){var hide=!1,hiddenVal=!1,values=value.split("|");return $dependon.each((function(idx,el){var $el=$(el);isUncheckedRadioButton($el)||(isCheckboxHiddenElement($el)?hiddenVal=values.indexOf($el.val())>-1:hide=isUncheckedCheckbox($el)?hide||hiddenVal:isMultiSelect($el)?multiSelectMatches($el,values):hide||values.indexOf($el.val())>-1)})),hide},defaultCondition:function($dependon,value){var hide=!1,hiddenVal=!1;return value=String(value),$dependon.each((function(idx,el){var $el=$(el);if(!isUncheckedRadioButton($el))if(isCheckboxHiddenElement($el))hiddenVal=$el.val()!==value;else if(isUncheckedCheckbox($el))hide=hide||hiddenVal;else if(isMultiSelect($el)){var values=value.split("|");hide=!multiSelectMatches($el,values)}else hide=hide||$el.val()!==value})),hide}};function getElementsByName(name){return $('[name="'+name+'"],[name^="'+name+'["]')}function updateDependencies(){var toHide={};$.each(dependencies,(function(dependonname){var dependon=getElementsByName(dependonname);$.each(dependencies[dependonname],(function(condition,values){$.each(values,(function(value,elements){var hide=function($dependon,condition,value){return"function"==typeof depFns[condition]?depFns[condition]($dependon,value):depFns.defaultCondition($dependon,value)}(dependon,condition,value);$.each(elements,(function(idx,elToHide){toHide.hasOwnProperty(elToHide)?toHide[elToHide]=toHide[elToHide]||hide:toHide[elToHide]=hide}))}))}))})),$.each(toHide,(function(elToHide,hide){getElementsByName(elToHide).each((function(idx,el){var $parent=$(el).closest(".form-item");$parent.length&&(hide?$parent.hide():$parent.show())}))}))}return{init:function(opts){dependencies=opts.dependencies,$.each(dependencies,(function(depname){var $el=getElementsByName(depname);$el.length&&$el.on("change",updateDependencies)})),updateDependencies(),$(".form-dependenton").hide()}}}));
/**
 * Events for the paged content element.
 *
 * @module     core/paged_content_events
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_events",[],(function(){return{SHOW_PAGES:"core-paged-content-show-pages",PAGES_SHOWN:"core-paged-content-pages-shown",ALL_ITEMS_LOADED:"core-paged-content-all-items-loaded",SET_ITEMS_PER_PAGE_LIMIT:"core-paged-content-set-items-per-page-limit"}}));
/**
 * AJAX helper for the inline editing a value.
 *
 * This script is automatically included from template core/inplace_editable
 * It registers a click-listener on [data-inplaceeditablelink] link (the "inplace edit" icon),
 * then replaces the displayed value with an input field. On "Enter" it sends a request
 * to web service core_update_inplace_editable, which invokes the specified callback.
 * Any exception thrown by the web service (or callback) is displayed as an error popup.
 *
 * @module     core/inplace_editable
 * @package    core
 * @copyright  2016 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("core/inplace_editable",["jquery","core/ajax","core/templates","core/notification","core/str","core/config","core/url","core/form-autocomplete","core/pending"],(function($,ajax,templates,notification,str,cfg,url,autocomplete,Pending){return $("body").on("click keypress","[data-inplaceeditable] [data-inplaceeditablelink]",(function(e){if("keypress"!==e.type||13===e.keyCode){var editingEnabledPromise=new Pending("autocomplete-start-editing");e.stopImmediatePropagation(),e.preventDefault();var mainelement=$(this).closest("[data-inplaceeditable]"),updateValue=function(mainelement,value){var pendingId=[mainelement.attr("data-itemid"),mainelement.attr("data-component"),mainelement.attr("data-itemtype")].join("-"),pendingPromise=new Pending(pendingId);!function(element){element.addClass("updating");var spinner=element.find("img.spinner");spinner.length?spinner.show():(spinner=$("<img/>").attr("src",url.imageUrl("i/loading_small")).addClass("spinner").addClass("smallicon"),element.append(spinner))}(mainelement),ajax.call([{methodname:"core_update_inplace_editable",args:{itemid:mainelement.attr("data-itemid"),component:mainelement.attr("data-component"),itemtype:mainelement.attr("data-itemtype"),value:value}}])[0].then((function(data){return templates.render("core/inplace_editable",data).then((function(html,js){var oldvalue=mainelement.attr("data-value"),newelement=$(html);templates.replaceNode(mainelement,newelement,js),newelement.find("[data-inplaceeditablelink]").focus(),newelement.trigger({type:"updated",ajaxreturn:data,oldvalue:oldvalue})}))})).then((function(){return pendingPromise.resolve()})).fail((function(ex){var element,e=$.Event("updatefailed",{exception:ex,newvalue:value});(element=mainelement).removeClass("updating"),element.find("img.spinner").hide(),M.util.js_complete(pendingId),mainelement.trigger(e),e.isDefaultPrevented()||notification.exception(ex)}))},turnEditingOff=function(el){el.find("input").off(),el.find("select").off(),el.html(el.attr("data-oldcontent")),el.removeAttr("data-oldcontent"),el.removeClass("inplaceeditingon"),el.find("[data-inplaceeditablelink]").focus()},uniqueId=function uniqueId(prefix,idlength){var i,uniqid=prefix;for(i=0;i<idlength;i++)uniqid+=String(Math.floor(10*Math.random()));return 0===$("#"+uniqid).length?uniqid:uniqueId(prefix,idlength)};$("span.inplaceeditable.inplaceeditingon").each((function(){turnEditingOff($(this))})),function(el){el.addClass("inplaceeditingon"),el.attr("data-oldcontent",el.html());var type=el.attr("data-type"),options=el.attr("data-options");"toggle"===type?function(el,newvalue){turnEditingOff(el),updateValue(el,newvalue)}(el,options):"select"===type?function(el,options){var i,inputelement=$("<select></select>").attr("id",uniqueId("id_inplacevalue_",20)).addClass("custom-select"),lbl=$('<label class="accesshide">'+mainelement.attr("data-editlabel")+"</label>").attr("for",inputelement.attr("id"));for(i in options)inputelement.append($("<option>").attr("value",options[i].key).html(options[i].value));inputelement.val(el.attr("data-value")),el.html("").append(lbl).append(inputelement),inputelement.focus(),inputelement.select(),inputelement.on("keyup change focusout",(function(e){if(!cfg.behatsiterunning||"focusout"!==e.type){if("change"===e.type){var val=inputelement.val();turnEditingOff(el),updateValue(el,val)}("keyup"===e.type&&27===e.keyCode||"focusout"===e.type)&&turnEditingOff(el)}}))}(el,$.parseJSON(options)):"autocomplete"===type?function(el,args){var i,inputelement=$("<select></select>").attr("id",uniqueId("id_inplacevalue_",20)).addClass("form-autocomplete-original-select").addClass("custom-select"),lbl=$('<label class="accesshide">'+mainelement.attr("data-editlabel")+"</label>").attr("for",inputelement.attr("id")),options=args.options,attributes=args.attributes,saveelement=$('<a href="#"></a>'),cancelelement=$('<a href="#"></a>');for(i in options)inputelement.append($("<option>").attr("value",options[i].key).html(options[i].value));attributes.multiple&&inputelement.attr("multiple","true"),inputelement.val(JSON.parse(el.attr("data-value"))),str.get_string("savechanges","core").then((function(s){return templates.renderPix("e/save","core",s)})).then((function(html){saveelement.append(html)})).fail(notification.exception),str.get_string("cancel","core").then((function(s){return templates.renderPix("e/cancel","core",s)})).then((function(html){cancelelement.append(html)})).fail(notification.exception),el.html("").append(lbl).append(inputelement).append(saveelement).append(cancelelement),inputelement.focus(),inputelement.select(),autocomplete.enhance(inputelement,attributes.tags,attributes.ajax,attributes.placeholder,attributes.caseSensitive,attributes.showSuggestions,attributes.noSelectionString).then((function(){el.find("[role=combobox]").focus()})).fail(notification.exception),inputelement.on("keyup",(function(e){("keyup"===e.type&&27===e.keyCode||"focusout"===e.type)&&turnEditingOff(el)})),saveelement.on("click",(function(e){var val=JSON.stringify(inputelement.val());inputelement.empty(),turnEditingOff(el),updateValue(el,val),e.preventDefault()})),cancelelement.on("click",(function(e){inputelement.empty(),turnEditingOff(el),e.preventDefault()}))}(el,$.parseJSON(options)):function(el){str.get_string("edittitleinstructions").done((function(s){var instr=$('<span class="editinstructions">'+s+"</span>").attr("id",uniqueId("id_editinstructions_",20)),inputelement=$('<input type="text"/>').attr("id",uniqueId("id_inplacevalue_",20)).attr("value",el.attr("data-value")).attr("aria-describedby",instr.attr("id")).addClass("ignoredirty").addClass("form-control"),lbl=$('<label class="accesshide">'+mainelement.attr("data-editlabel")+"</label>").attr("for",inputelement.attr("id"));el.html("").append(instr).append(lbl).append(inputelement),inputelement.focus(),inputelement.select(),inputelement.on("keyup keypress focusout",(function(e){if(!cfg.behatsiterunning||"focusout"!==e.type){if("keypress"===e.type&&13===e.keyCode){var val=inputelement.val();turnEditingOff(el),updateValue(el,val)}("keyup"===e.type&&27===e.keyCode||"focusout"===e.type)&&turnEditingOff(el)}}))}))}(el)}(mainelement),editingEnabledPromise.resolve()}})),{}}));
/**
 * Controls the popover region element.
 *
 * See template: core/popover_region
 *
 * @module     core/popover_region_controller
 * @class      popover_region_controller
 * @package    core
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("core/popover_region_controller",["jquery","core/str","core/custom_interaction_events"],(function($,str,customEvents){var SELECTORS_CONTENT=".popover-region-content",SELECTORS_CONTENT_CONTAINER=".popover-region-content-container",SELECTORS_MENU_CONTAINER=".popover-region-container",SELECTORS_MENU_TOGGLE=".popover-region-toggle",SELECTORS_CAN_RECEIVE_FOCUS='input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',PopoverRegionController=function(element){this.root=$(element),this.content=this.root.find(SELECTORS_CONTENT),this.contentContainer=this.root.find(SELECTORS_CONTENT_CONTAINER),this.menuContainer=this.root.find(SELECTORS_MENU_CONTAINER),this.menuToggle=this.root.find(SELECTORS_MENU_TOGGLE),this.isLoading=!1,this.promises={closeHandlers:$.Deferred(),navigationHandlers:$.Deferred()},this.registerBaseEventListeners()};return PopoverRegionController.prototype.events=function(){return{menuOpened:"popoverregion:menuopened",menuClosed:"popoverregion:menuclosed",startLoading:"popoverregion:startLoading",stopLoading:"popoverregion:stopLoading"}},PopoverRegionController.prototype.getContentContainer=function(){return this.contentContainer},PopoverRegionController.prototype.getContent=function(){return this.content},PopoverRegionController.prototype.isMenuOpen=function(){return!this.root.hasClass("collapsed")},PopoverRegionController.prototype.toggleMenu=function(){this.isMenuOpen()?this.closeMenu():this.openMenu()},PopoverRegionController.prototype.closeMenu=function(){this.isMenuOpen()&&(this.root.addClass("collapsed"),this.menuContainer.attr("aria-expanded","false"),this.menuContainer.attr("aria-hidden","true"),this.updateButtonAriaLabel(),this.root.trigger(this.events().menuClosed))},PopoverRegionController.prototype.openMenu=function(){this.isMenuOpen()||(this.root.removeClass("collapsed"),this.menuContainer.attr("aria-expanded","true"),this.menuContainer.attr("aria-hidden","false"),this.updateButtonAriaLabel(),this.promises.closeHandlers.resolve(),this.promises.navigationHandlers.resolve(),this.root.trigger(this.events().menuOpened))},PopoverRegionController.prototype.updateButtonAriaLabel=function(){this.isMenuOpen()?str.get_string("hidepopoverwindow").done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this)):str.get_string("showpopoverwindow").done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this))},PopoverRegionController.prototype.startLoading=function(){this.isLoading=!0,this.getContentContainer().addClass("loading"),this.getContentContainer().attr("aria-busy","true"),this.root.trigger(this.events().startLoading)},PopoverRegionController.prototype.stopLoading=function(){this.isLoading=!1,this.getContentContainer().removeClass("loading"),this.getContentContainer().attr("aria-busy","false"),this.root.trigger(this.events().stopLoading)},PopoverRegionController.prototype.focusMenuToggle=function(){this.menuToggle.focus()},PopoverRegionController.prototype.contentItemHasFocus=function(){return this.getContentItemWithFocus().length>0},PopoverRegionController.prototype.getContentItemWithFocus=function(){var currentFocus=$(document.activeElement),items=this.getContent().children(),currentItem=items.filter(currentFocus);return currentItem.length||(currentItem=items.has(currentFocus)),currentItem},PopoverRegionController.prototype.focusContentItem=function(item){item.is(SELECTORS_CAN_RECEIVE_FOCUS)?item.focus():item.find(SELECTORS_CAN_RECEIVE_FOCUS).first().focus()},PopoverRegionController.prototype.focusFirstContentItem=function(){this.focusContentItem(this.getContent().children().first())},PopoverRegionController.prototype.focusLastContentItem=function(){this.focusContentItem(this.getContent().children().last())},PopoverRegionController.prototype.focusNextContentItem=function(){var currentItem=this.getContentItemWithFocus();currentItem.length&&currentItem.next()&&this.focusContentItem(currentItem.next())},PopoverRegionController.prototype.focusPreviousContentItem=function(){var currentItem=this.getContentItemWithFocus();currentItem.length&&currentItem.prev()&&this.focusContentItem(currentItem.prev())},PopoverRegionController.prototype.registerBaseEventListeners=function(){customEvents.define(this.root,[customEvents.events.activate,customEvents.events.escape]),this.root.on(customEvents.events.activate,SELECTORS_MENU_TOGGLE,function(){this.toggleMenu()}.bind(this)),this.promises.closeHandlers.done(function(){this.root.on(customEvents.events.escape,function(){this.closeMenu(),this.focusMenuToggle()}.bind(this)),$("html").click(function(e){var target=$(e.target);this.root.is(target)||this.root.has(target).length||this.closeMenu()}.bind(this)),customEvents.define(this.getContentContainer(),[customEvents.events.scrollBottom])}.bind(this))},PopoverRegionController.prototype.registerListNavigationEventListeners=function(){customEvents.define(this.root,[customEvents.events.down]),this.root.on(customEvents.events.down,function(e,data){this.isMenuOpen()?this.contentItemHasFocus()?this.focusNextContentItem():this.focusFirstContentItem():(this.openMenu(),this.focusFirstContentItem()),data.originalEvent.preventDefault()}.bind(this)),this.promises.navigationHandlers.done(function(){customEvents.define(this.root,[customEvents.events.up,customEvents.events.home,customEvents.events.end]),this.root.on(customEvents.events.up,function(e,data){this.focusPreviousContentItem(),data.originalEvent.preventDefault()}.bind(this)),this.root.on(customEvents.events.home,function(e,data){this.focusFirstContentItem(),data.originalEvent.preventDefault()}.bind(this)),this.root.on(customEvents.events.end,function(e,data){this.focusLastContentItem(),data.originalEvent.preventDefault()}.bind(this))}.bind(this))},PopoverRegionController}));
/**
 * Simple API for set/get to localstorage, with cacherev expiration.
 *
 * @module     core/localstorage
 * @package    core
 * @class      localstorage
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/localstorage",["core/config","core/storagewrapper"],(function(config,StorageWrapper){var storage=new StorageWrapper(window.localStorage);return{get:function(key){return storage.get(key)},set:function(key,value){return storage.set(key,value)}}}));
/**
 * Simple API for set/get to sessionstorage, with cacherev expiration.
 *
 * Session storage will only persist for as long as the browser window
 * stays open.
 *
 * See:
 * https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage
 *
 * @module     core/sessionstorage
 * @package    core
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/sessionstorage",["core/config","core/storagewrapper"],(function(config,StorageWrapper){var storage=new StorageWrapper(window.sessionStorage);return{get:function(key){return storage.get(key)},set:function(key,value){return storage.set(key,value)}}}));
/**
 * Chart axis.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_axis
 */
define("core/chart_axis",[],(function(){function Axis(){}return Axis.prototype.POS_DEFAULT=null,Axis.prototype.POS_BOTTOM="bottom",Axis.prototype.POS_LEFT="left",Axis.prototype.POS_RIGHT="right",Axis.prototype.POS_TOP="top",Axis.prototype._label=null,Axis.prototype._labels=null,Axis.prototype._max=null,Axis.prototype._min=null,Axis.prototype._position=null,Axis.prototype._stepSize=null,Axis.prototype.create=function(obj){var s=new Axis;return s.setPosition(obj.position),s.setLabel(obj.label),s.setStepSize(obj.stepSize),s.setMax(obj.max),s.setMin(obj.min),s.setLabels(obj.labels),s},Axis.prototype.getLabel=function(){return this._label},Axis.prototype.getLabels=function(){return this._labels},Axis.prototype.getMax=function(){return this._max},Axis.prototype.getMin=function(){return this._min},Axis.prototype.getPosition=function(){return this._position},Axis.prototype.getStepSize=function(){return this._stepSize},Axis.prototype.setLabel=function(label){this._label=label||null},Axis.prototype.setLabels=function(labels){this._labels=labels||null,null===this._labels||null!==this._stepSize||null!==this._min&&0!==this._min||null!==this._max||(this.setStepSize(1),this.setMin(0),this.setMax(labels.length-1))},Axis.prototype.setMax=function(max){this._max=void 0!==max?max:null},Axis.prototype.setMin=function(min){this._min=void 0!==min?min:null},Axis.prototype.setPosition=function(position){if(position!=this.POS_DEFAULT&&position!=this.POS_BOTTOM&&position!=this.POS_LEFT&&position!=this.POS_RIGHT&&position!=this.POS_TOP)throw new Error("Invalid axis position.");this._position=position},Axis.prototype.setStepSize=function(stepSize){if(null==stepSize)stepSize=null;else{if(isNaN(Number(stepSize)))throw new Error("Value for stepSize is not a number.");stepSize=Number(stepSize)}this._stepSize=stepSize},Axis}));
/**
 * Contain the logic for modal backdrops.
 *
 * @module     core/modal_backdrop
 * @class      modal_backdrop
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/modal_backdrop",["jquery","core/templates","core/notification","core/fullscreen"],(function($,Templates,Notification,Fullscreen){var SELECTORS_ROOT='[data-region="modal-backdrop"]',ModalBackdrop=function(root){this.root=$(root),this.isAttached=!1,this.attachmentPoint=document.createElement("div"),document.body.append(this.attachmentPoint),this.root.is(SELECTORS_ROOT)||Notification.exception({message:"Element is not a modal backdrop"})};return ModalBackdrop.prototype.getRoot=function(){return this.root},ModalBackdrop.prototype.getAttachmentPoint=function(){return $(Fullscreen.getElement()||this.attachmentPoint)},ModalBackdrop.prototype.attachToDOM=function(){this.getAttachmentPoint().append(this.root),this.isAttached||(this.isAttached=!0)},ModalBackdrop.prototype.setZIndex=function(value){this.root.css("z-index",value)},ModalBackdrop.prototype.isVisible=function(){return this.root.hasClass("show")},ModalBackdrop.prototype.hasTransitions=function(){return this.getRoot().hasClass("fade")},ModalBackdrop.prototype.show=function(){this.isVisible()||(this.attachToDOM(),this.root.removeClass("hide").addClass("show"))},ModalBackdrop.prototype.hide=function(){this.isVisible()&&(this.hasTransitions()?this.getRoot().one("transitionend webkitTransitionEnd oTransitionEnd",function(){this.getRoot().removeClass("show").addClass("hide")}.bind(this)):this.getRoot().removeClass("show").addClass("hide"),$(document.body).find(this.getRoot()).length&&$(document.body).append(this.getRoot()))},ModalBackdrop.prototype.destroy=function(){this.root.remove(),this.attachmentPoint.remove()},ModalBackdrop}));
/*
 * JavaScript to provide automatic scrolling, e.g. during a drag operation.
 *
 * Note: this module is defined statically. It is a singleton. You
 * can only have one use of it active at any time. However, since this
 * is usually used in relation to drag-drop, and since you only ever
 * drag one thing at a time, this is not a problem in practice.
 *
 * @module     core/autoscroll
 * @class      autoscroll
 * @package    core
 * @copyright  2016 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.6
 */
define("core/autoscroll",["jquery"],(function($){var autoscroll={SCROLL_THRESHOLD:30,SCROLL_FREQUENCY:1e3/60,SCROLL_SPEED:.5,scrollingId:null,scrollAmount:0,callback:null,start:function(callback){$(window).on("mousemove",autoscroll.mouseMove),$(window).on("touchmove",autoscroll.touchMove),autoscroll.callback=callback},stop:function(){$(window).off("mousemove",autoscroll.mouseMove),$(window).off("touchmove",autoscroll.touchMove),null!==autoscroll.scrollingId&&autoscroll.stopScrolling()},touchMove:function(e){for(var i=0;i<e.changedTouches.length;i++)autoscroll.handleMove(e.changedTouches[i].clientX,e.changedTouches[i].clientY)},mouseMove:function(e){autoscroll.handleMove(e.clientX,e.clientY)},handleMove:function(clientX,clientY){clientY<autoscroll.SCROLL_THRESHOLD?autoscroll.scrollAmount=-Math.min(autoscroll.SCROLL_THRESHOLD-clientY,autoscroll.SCROLL_THRESHOLD):clientY>$(window).height()-autoscroll.SCROLL_THRESHOLD?autoscroll.scrollAmount=Math.min(clientY-($(window).height()-autoscroll.SCROLL_THRESHOLD),autoscroll.SCROLL_THRESHOLD):autoscroll.scrollAmount=0,autoscroll.scrollAmount&&null===autoscroll.scrollingId?autoscroll.startScrolling():autoscroll.scrollAmount||null===autoscroll.scrollingId||autoscroll.stopScrolling()},startScrolling:function(){var maxScroll=$(document).height()-$(window).height();autoscroll.scrollingId=window.setInterval((function(){var y=$(window).scrollTop(),offset=Math.round(autoscroll.scrollAmount*autoscroll.SCROLL_SPEED);if(y+offset<0&&(offset=-y),y+offset>maxScroll&&(offset=maxScroll-y),0!==offset){$(window).scrollTop(y+offset);var realOffset=$(window).scrollTop()-y;0!==realOffset&&autoscroll.callback&&autoscroll.callback(realOffset)}}),autoscroll.SCROLL_FREQUENCY)},stopScrolling:function(){window.clearInterval(autoscroll.scrollingId),autoscroll.scrollingId=null}};return{start:autoscroll.start,stop:autoscroll.stop}}));
/**
 * A registry for the different types of modal.
 *
 * @module     core/modal_registry
 * @class      modal_registry
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/modal_registry",["core/notification","core/prefetch"],(function(Notification,Prefetch){var registry={},get=function(type){return registry[type]};return{register:function(type,module,template){get(type)&&Notification.exception({message:"Modal of  type '"+type+"' is already registered"}),module&&"function"==typeof module||Notification.exception({message:"You must provide a modal module"}),template||Notification.exception({message:"You must provide a modal template"}),registry[type]={module:module,template:template},Prefetch.prefetchTemplate(template)},get:get}}));
function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}
/**
 * Create a modal.
 *
 * @module     core/modal_factory
 * @class      modal_factory
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}define("core/modal_factory",["jquery","core/modal_events","core/modal_registry","core/modal","core/modal_save_cancel","core/modal_cancel","core/local/modal/alert","core/templates","core/notification","core/custom_interaction_events","core/pending"],(function($,ModalEvents,ModalRegistry,Modal,ModalSaveCancel,ModalCancel,ModalAlert,Templates,Notification,CustomEvents,Pending){var TEMPLATES_DEFAULT="core/modal",TEMPLATES_SAVE_CANCEL="core/modal_save_cancel",TEMPLATES_CANCEL="core/modal_cancel",TEMPLATES_ALERT="core/local/modal/alert",TYPES={DEFAULT:"DEFAULT",SAVE_CANCEL:"SAVE_CANCEL",CANCEL:"CANCEL",ALERT:"ALERT"};ModalRegistry.register(TYPES.DEFAULT,Modal,TEMPLATES_DEFAULT),ModalRegistry.register(TYPES.SAVE_CANCEL,ModalSaveCancel,TEMPLATES_SAVE_CANCEL),ModalRegistry.register(TYPES.CANCEL,ModalCancel,TEMPLATES_CANCEL),ModalRegistry.register(TYPES.ALERT,ModalAlert,TEMPLATES_ALERT);var createFromType=function(registryConf,templateContext){var templateName=registryConf.template,modalPromise=Templates.render(templateName,templateContext).then((function(html){var modalElement=$(html);return function(registryConf,modalElement){return modalElement=$(modalElement),new(0,registryConf.module)(modalElement)}(registryConf,modalElement)})).fail(Notification.exception);return modalPromise};return{create:function(modalConfig,triggerElement){var registryConf,type=modalConfig.type||TYPES.DEFAULT,isLarge=!!modalConfig.large,templateContext={};(registryConf=ModalRegistry.get(type))||Notification.exception({message:"Unable to find modal of type: "+type}),void 0!==modalConfig.templateContext&&(templateContext=modalConfig.templateContext);var modalPromise=createFromType(registryConf,templateContext).then((function(modal){return void 0!==modalConfig.title&&modal.setTitle(modalConfig.title),void 0!==modalConfig.body&&modal.setBody(modalConfig.body),void 0!==modalConfig.footer&&modal.setFooter(modalConfig.footer),modalConfig.buttons&&Object.entries(modalConfig.buttons).forEach((function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];modal.setButtonText(key,value)})),isLarge&&modal.setLarge(),void 0!==modalConfig.removeOnClose&&modal.setRemoveOnClose(modalConfig.removeOnClose),modal}));return void 0!==triggerElement&&function(modalPromise,triggerElement,modalConfig){var actualTriggerElement=null,hasPreShowCallback="function"==typeof modalConfig.preShowCallback,triggeredCallback=function(e,data){var pendingPromise=new Pending("core/modal_factory:setUpTrigger:triggeredCallback");actualTriggerElement=$(e.currentTarget),modalPromise.then((function(modal){return hasPreShowCallback&&modalConfig.preShowCallback(actualTriggerElement,modal),modal.show(),modal})).then(pendingPromise.resolve),data.originalEvent.preventDefault()};if(Array.isArray(triggerElement)){var selector=triggerElement[1];triggerElement=triggerElement[0],CustomEvents.define(triggerElement,[CustomEvents.events.activate]),triggerElement.on(CustomEvents.events.activate,selector,triggeredCallback)}else CustomEvents.define(triggerElement,[CustomEvents.events.activate]),triggerElement.on(CustomEvents.events.activate,triggeredCallback);modalPromise.then((function(modal){return modal.getRoot().on(ModalEvents.hidden,(function(){null!==actualTriggerElement&&actualTriggerElement.focus()})),modal}))}(modalPromise,triggerElement,modalConfig),modalPromise},types:TYPES}}));
define("core/fullscreen",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getElement=void 0;_exports.getElement=function(){var element=null;return document.fullscreenElement?element=document.fullscreenElement:document.mozFullscreenElement?element=document.mozFullscreenElement:document.msFullscreenElement?element=document.msFullscreenElement:document.webkitFullscreenElement&&(element=document.webkitFullscreenElement),element}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**!
 * @fileOverview Kickass library to create and place poppers near their reference elements.
 * @version 1.12.6
 * @license
 * Copyright (c) 2016 Federico Zivolo and contributors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */}!function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("core/popper",factory):global.Popper=factory()}(window,(function(){for(var isBrowser="undefined"!=typeof window&&void 0!==window.document,longerTimeoutBrowsers=["Edge","Trident","Firefox"],timeoutDuration=0,i=0;i<longerTimeoutBrowsers.length;i+=1)if(isBrowser&&navigator.userAgent.indexOf(longerTimeoutBrowsers[i])>=0){timeoutDuration=1;break}var debounce=isBrowser&&window.Promise?function(fn){var called=!1;return function(){called||(called=!0,Promise.resolve().then((function(){called=!1,fn()})))}}:function(fn){var scheduled=!1;return function(){scheduled||(scheduled=!0,setTimeout((function(){scheduled=!1,fn()}),timeoutDuration))}};function isFunction(functionToCheck){return functionToCheck&&"[object Function]"==={}.toString.call(functionToCheck)}function getStyleComputedProperty(element,property){if(1!==element.nodeType)return[];var css=window.getComputedStyle(element,null);return property?css[property]:css}function getParentNode(element){return"HTML"===element.nodeName?element:element.parentNode||element.host}function getScrollParent(element){if(!element)return window.document.body;switch(element.nodeName){case"HTML":case"BODY":return element.ownerDocument.body;case"#document":return element.body}var _getStyleComputedProp=getStyleComputedProperty(element),overflow=_getStyleComputedProp.overflow,overflowX=_getStyleComputedProp.overflowX,overflowY=_getStyleComputedProp.overflowY;return/(auto|scroll)/.test(overflow+overflowY+overflowX)?element:getScrollParent(getParentNode(element))}function getOffsetParent(element){var offsetParent=element&&element.offsetParent,nodeName=offsetParent&&offsetParent.nodeName;return nodeName&&"BODY"!==nodeName&&"HTML"!==nodeName?-1!==["TD","TABLE"].indexOf(offsetParent.nodeName)&&"static"===getStyleComputedProperty(offsetParent,"position")?getOffsetParent(offsetParent):offsetParent:element?element.ownerDocument.documentElement:window.document.documentElement}function getRoot(node){return null!==node.parentNode?getRoot(node.parentNode):node}function findCommonOffsetParent(element1,element2){if(!(element1&&element1.nodeType&&element2&&element2.nodeType))return window.document.documentElement;var order=element1.compareDocumentPosition(element2)&Node.DOCUMENT_POSITION_FOLLOWING,start=order?element1:element2,end=order?element2:element1,range=document.createRange();range.setStart(start,0),range.setEnd(end,0);var element,nodeName,commonAncestorContainer=range.commonAncestorContainer;if(element1!==commonAncestorContainer&&element2!==commonAncestorContainer||start.contains(end))return"BODY"===(nodeName=(element=commonAncestorContainer).nodeName)||"HTML"!==nodeName&&getOffsetParent(element.firstElementChild)!==element?getOffsetParent(commonAncestorContainer):commonAncestorContainer;var element1root=getRoot(element1);return element1root.host?findCommonOffsetParent(element1root.host,element2):findCommonOffsetParent(element1,getRoot(element2).host)}function getScroll(element){var side=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top",upperSide="top"===side?"scrollTop":"scrollLeft",nodeName=element.nodeName;if("BODY"===nodeName||"HTML"===nodeName){var html=element.ownerDocument.documentElement,scrollingElement=element.ownerDocument.scrollingElement||html;return scrollingElement[upperSide]}return element[upperSide]}function getBordersSize(styles,axis){var sideA="x"===axis?"Left":"Top",sideB="Left"===sideA?"Right":"Bottom";return+styles["border"+sideA+"Width"].split("px")[0]+ +styles["border"+sideB+"Width"].split("px")[0]}var isIE10=void 0,isIE10$1=function(){return void 0===isIE10&&(isIE10=-1!==navigator.appVersion.indexOf("MSIE 10")),isIE10};function getSize(axis,body,html,computedStyle){return Math.max(body["offset"+axis],body["scroll"+axis],html["client"+axis],html["offset"+axis],html["scroll"+axis],isIE10$1()?html["offset"+axis]+computedStyle["margin"+("Height"===axis?"Top":"Left")]+computedStyle["margin"+("Height"===axis?"Bottom":"Right")]:0)}function getWindowSizes(){var body=window.document.body,html=window.document.documentElement,computedStyle=isIE10$1()&&window.getComputedStyle(html);return{height:getSize("Height",body,html,computedStyle),width:getSize("Width",body,html,computedStyle)}}var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),defineProperty=function(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj},_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};function getClientRect(offsets){return _extends({},offsets,{right:offsets.left+offsets.width,bottom:offsets.top+offsets.height})}function getBoundingClientRect(element){var rect={};if(isIE10$1())try{rect=element.getBoundingClientRect();var scrollTop=getScroll(element,"top"),scrollLeft=getScroll(element,"left");rect.top+=scrollTop,rect.left+=scrollLeft,rect.bottom+=scrollTop,rect.right+=scrollLeft}catch(err){}else rect=element.getBoundingClientRect();var result={left:rect.left,top:rect.top,width:rect.right-rect.left,height:rect.bottom-rect.top},sizes="HTML"===element.nodeName?getWindowSizes():{},width=sizes.width||element.clientWidth||result.right-result.left,height=sizes.height||element.clientHeight||result.bottom-result.top,horizScrollbar=element.offsetWidth-width,vertScrollbar=element.offsetHeight-height;if(horizScrollbar||vertScrollbar){var styles=getStyleComputedProperty(element);horizScrollbar-=getBordersSize(styles,"x"),vertScrollbar-=getBordersSize(styles,"y"),result.width-=horizScrollbar,result.height-=vertScrollbar}return getClientRect(result)}function getOffsetRectRelativeToArbitraryNode(children,parent){var isIE10=isIE10$1(),isHTML="HTML"===parent.nodeName,childrenRect=getBoundingClientRect(children),parentRect=getBoundingClientRect(parent),scrollParent=getScrollParent(children),styles=getStyleComputedProperty(parent),borderTopWidth=+styles.borderTopWidth.split("px")[0],borderLeftWidth=+styles.borderLeftWidth.split("px")[0],offsets=getClientRect({top:childrenRect.top-parentRect.top-borderTopWidth,left:childrenRect.left-parentRect.left-borderLeftWidth,width:childrenRect.width,height:childrenRect.height});if(offsets.marginTop=0,offsets.marginLeft=0,!isIE10&&isHTML){var marginTop=+styles.marginTop.split("px")[0],marginLeft=+styles.marginLeft.split("px")[0];offsets.top-=borderTopWidth-marginTop,offsets.bottom-=borderTopWidth-marginTop,offsets.left-=borderLeftWidth-marginLeft,offsets.right-=borderLeftWidth-marginLeft,offsets.marginTop=marginTop,offsets.marginLeft=marginLeft}return(isIE10?parent.contains(scrollParent):parent===scrollParent&&"BODY"!==scrollParent.nodeName)&&(offsets=function(rect,element){var subtract=arguments.length>2&&void 0!==arguments[2]&&arguments[2],scrollTop=getScroll(element,"top"),scrollLeft=getScroll(element,"left"),modifier=subtract?-1:1;return rect.top+=scrollTop*modifier,rect.bottom+=scrollTop*modifier,rect.left+=scrollLeft*modifier,rect.right+=scrollLeft*modifier,rect}(offsets,parent)),offsets}function isFixed(element){var nodeName=element.nodeName;return"BODY"!==nodeName&&"HTML"!==nodeName&&("fixed"===getStyleComputedProperty(element,"position")||isFixed(getParentNode(element)))}function getBoundaries(popper,reference,padding,boundariesElement){var boundaries={top:0,left:0},offsetParent=findCommonOffsetParent(popper,reference);if("viewport"===boundariesElement)boundaries=function(element){var html=element.ownerDocument.documentElement,relativeOffset=getOffsetRectRelativeToArbitraryNode(element,html),width=Math.max(html.clientWidth,window.innerWidth||0),height=Math.max(html.clientHeight,window.innerHeight||0),scrollTop=getScroll(html),scrollLeft=getScroll(html,"left");return getClientRect({top:scrollTop-relativeOffset.top+relativeOffset.marginTop,left:scrollLeft-relativeOffset.left+relativeOffset.marginLeft,width:width,height:height})}(offsetParent);else{var boundariesNode=void 0;"scrollParent"===boundariesElement?"BODY"===(boundariesNode=getScrollParent(getParentNode(popper))).nodeName&&(boundariesNode=popper.ownerDocument.documentElement):boundariesNode="window"===boundariesElement?popper.ownerDocument.documentElement:boundariesElement;var offsets=getOffsetRectRelativeToArbitraryNode(boundariesNode,offsetParent);if("HTML"!==boundariesNode.nodeName||isFixed(offsetParent))boundaries=offsets;else{var _getWindowSizes=getWindowSizes(),height=_getWindowSizes.height,width=_getWindowSizes.width;boundaries.top+=offsets.top-offsets.marginTop,boundaries.bottom=height+offsets.top,boundaries.left+=offsets.left-offsets.marginLeft,boundaries.right=width+offsets.left}}return boundaries.left+=padding,boundaries.top+=padding,boundaries.right-=padding,boundaries.bottom-=padding,boundaries}function getArea(_ref){return _ref.width*_ref.height}function computeAutoPlacement(placement,refRect,popper,reference,boundariesElement){var padding=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(-1===placement.indexOf("auto"))return placement;var boundaries=getBoundaries(popper,reference,padding,boundariesElement),rects={top:{width:boundaries.width,height:refRect.top-boundaries.top},right:{width:boundaries.right-refRect.right,height:boundaries.height},bottom:{width:boundaries.width,height:boundaries.bottom-refRect.bottom},left:{width:refRect.left-boundaries.left,height:boundaries.height}},sortedAreas=Object.keys(rects).map((function(key){return _extends({key:key},rects[key],{area:getArea(rects[key])})})).sort((function(a,b){return b.area-a.area})),filteredAreas=sortedAreas.filter((function(_ref2){var width=_ref2.width,height=_ref2.height;return width>=popper.clientWidth&&height>=popper.clientHeight})),computedPlacement=filteredAreas.length>0?filteredAreas[0].key:sortedAreas[0].key,variation=placement.split("-")[1];return computedPlacement+(variation?"-"+variation:"")}function getReferenceOffsets(state,popper,reference){return getOffsetRectRelativeToArbitraryNode(reference,findCommonOffsetParent(popper,reference))}function getOuterSizes(element){var styles=window.getComputedStyle(element),x=parseFloat(styles.marginTop)+parseFloat(styles.marginBottom),y=parseFloat(styles.marginLeft)+parseFloat(styles.marginRight);return{width:element.offsetWidth+y,height:element.offsetHeight+x}}function getOppositePlacement(placement){var hash={left:"right",right:"left",bottom:"top",top:"bottom"};return placement.replace(/left|right|bottom|top/g,(function(matched){return hash[matched]}))}function getPopperOffsets(popper,referenceOffsets,placement){placement=placement.split("-")[0];var popperRect=getOuterSizes(popper),popperOffsets={width:popperRect.width,height:popperRect.height},isHoriz=-1!==["right","left"].indexOf(placement),mainSide=isHoriz?"top":"left",secondarySide=isHoriz?"left":"top",measurement=isHoriz?"height":"width",secondaryMeasurement=isHoriz?"width":"height";return popperOffsets[mainSide]=referenceOffsets[mainSide]+referenceOffsets[measurement]/2-popperRect[measurement]/2,popperOffsets[secondarySide]=placement===secondarySide?referenceOffsets[secondarySide]-popperRect[secondaryMeasurement]:referenceOffsets[getOppositePlacement(secondarySide)],popperOffsets}function find(arr,check){return Array.prototype.find?arr.find(check):arr.filter(check)[0]}function runModifiers(modifiers,data,ends){return(void 0===ends?modifiers:modifiers.slice(0,function(arr,prop,value){if(Array.prototype.findIndex)return arr.findIndex((function(cur){return cur[prop]===value}));var match=find(arr,(function(obj){return obj[prop]===value}));return arr.indexOf(match)}(modifiers,"name",ends))).forEach((function(modifier){modifier.function&&console.warn("`modifier.function` is deprecated, use `modifier.fn`!");var fn=modifier.function||modifier.fn;modifier.enabled&&isFunction(fn)&&(data.offsets.popper=getClientRect(data.offsets.popper),data.offsets.reference=getClientRect(data.offsets.reference),data=fn(data,modifier))})),data}function update(){if(!this.state.isDestroyed){var data={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};data.offsets.reference=getReferenceOffsets(this.state,this.popper,this.reference),data.placement=computeAutoPlacement(this.options.placement,data.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),data.originalPlacement=data.placement,data.offsets.popper=getPopperOffsets(this.popper,data.offsets.reference,data.placement),data.offsets.popper.position="absolute",data=runModifiers(this.modifiers,data),this.state.isCreated?this.options.onUpdate(data):(this.state.isCreated=!0,this.options.onCreate(data))}}function isModifierEnabled(modifiers,modifierName){return modifiers.some((function(_ref){var name=_ref.name;return _ref.enabled&&name===modifierName}))}function getSupportedPropertyName(property){for(var prefixes=[!1,"ms","Webkit","Moz","O"],upperProp=property.charAt(0).toUpperCase()+property.slice(1),i=0;i<prefixes.length-1;i++){var prefix=prefixes[i],toCheck=prefix?""+prefix+upperProp:property;if(void 0!==window.document.body.style[toCheck])return toCheck}return null}function destroy(){return this.state.isDestroyed=!0,isModifierEnabled(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.left="",this.popper.style.position="",this.popper.style.top="",this.popper.style[getSupportedPropertyName("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}function getWindow(element){var ownerDocument=element.ownerDocument;return ownerDocument?ownerDocument.defaultView:window}function attachToScrollParents(scrollParent,event,callback,scrollParents){var isBody="BODY"===scrollParent.nodeName,target=isBody?scrollParent.ownerDocument.defaultView:scrollParent;target.addEventListener(event,callback,{passive:!0}),isBody||attachToScrollParents(getScrollParent(target.parentNode),event,callback,scrollParents),scrollParents.push(target)}function setupEventListeners(reference,options,state,updateBound){state.updateBound=updateBound,getWindow(reference).addEventListener("resize",state.updateBound,{passive:!0});var scrollElement=getScrollParent(reference);return attachToScrollParents(scrollElement,"scroll",state.updateBound,state.scrollParents),state.scrollElement=scrollElement,state.eventsEnabled=!0,state}function enableEventListeners(){this.state.eventsEnabled||(this.state=setupEventListeners(this.reference,this.options,this.state,this.scheduleUpdate))}function disableEventListeners(){var reference,state;this.state.eventsEnabled&&(window.cancelAnimationFrame(this.scheduleUpdate),this.state=(reference=this.reference,state=this.state,getWindow(reference).removeEventListener("resize",state.updateBound),state.scrollParents.forEach((function(target){target.removeEventListener("scroll",state.updateBound)})),state.updateBound=null,state.scrollParents=[],state.scrollElement=null,state.eventsEnabled=!1,state))}function isNumeric(n){return""!==n&&!isNaN(parseFloat(n))&&isFinite(n)}function setStyles(element,styles){Object.keys(styles).forEach((function(prop){var unit="";-1!==["width","height","top","right","bottom","left"].indexOf(prop)&&isNumeric(styles[prop])&&(unit="px"),element.style[prop]=styles[prop]+unit}))}function isModifierRequired(modifiers,requestingName,requestedName){var requesting=find(modifiers,(function(_ref){return _ref.name===requestingName})),isRequired=!!requesting&&modifiers.some((function(modifier){return modifier.name===requestedName&&modifier.enabled&&modifier.order<requesting.order}));if(!isRequired){var _requesting="`"+requestingName+"`",requested="`"+requestedName+"`";console.warn(requested+" modifier is required by "+_requesting+" modifier in order to work, be sure to include it before "+_requesting+"!")}return isRequired}var placements=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],validPlacements=placements.slice(3);function clockwise(placement){var counter=arguments.length>1&&void 0!==arguments[1]&&arguments[1],index=validPlacements.indexOf(placement),arr=validPlacements.slice(index+1).concat(validPlacements.slice(0,index));return counter?arr.reverse():arr}var BEHAVIORS_FLIP="flip",BEHAVIORS_CLOCKWISE="clockwise",BEHAVIORS_COUNTERCLOCKWISE="counterclockwise";function parseOffset(offset,popperOffsets,referenceOffsets,basePlacement){var offsets=[0,0],useHeight=-1!==["right","left"].indexOf(basePlacement),fragments=offset.split(/(\+|\-)/).map((function(frag){return frag.trim()})),divider=fragments.indexOf(find(fragments,(function(frag){return-1!==frag.search(/,|\s/)})));fragments[divider]&&-1===fragments[divider].indexOf(",")&&console.warn("Offsets separated by white space(s) are deprecated, use a comma (,) instead.");var splitRegex=/\s*,\s*|\s+/,ops=-1!==divider?[fragments.slice(0,divider).concat([fragments[divider].split(splitRegex)[0]]),[fragments[divider].split(splitRegex)[1]].concat(fragments.slice(divider+1))]:[fragments];return ops=ops.map((function(op,index){var measurement=(1===index?!useHeight:useHeight)?"height":"width",mergeWithPrevious=!1;return op.reduce((function(a,b){return""===a[a.length-1]&&-1!==["+","-"].indexOf(b)?(a[a.length-1]=b,mergeWithPrevious=!0,a):mergeWithPrevious?(a[a.length-1]+=b,mergeWithPrevious=!1,a):a.concat(b)}),[]).map((function(str){return function(str,measurement,popperOffsets,referenceOffsets){var split=str.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),value=+split[1],unit=split[2];if(!value)return str;if(0===unit.indexOf("%")){return getClientRect("%p"===unit?popperOffsets:referenceOffsets)[measurement]/100*value}if("vh"===unit||"vw"===unit)return("vh"===unit?Math.max(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0))/100*value;return value}(str,measurement,popperOffsets,referenceOffsets)}))})),ops.forEach((function(op,index){op.forEach((function(frag,index2){isNumeric(frag)&&(offsets[index]+=frag*("-"===op[index2-1]?-1:1))}))})),offsets}var modifiers={shift:{order:100,enabled:!0,fn:function(data){var placement=data.placement,basePlacement=placement.split("-")[0],shiftvariation=placement.split("-")[1];if(shiftvariation){var _data$offsets=data.offsets,reference=_data$offsets.reference,popper=_data$offsets.popper,isVertical=-1!==["bottom","top"].indexOf(basePlacement),side=isVertical?"left":"top",measurement=isVertical?"width":"height",shiftOffsets={start:defineProperty({},side,reference[side]),end:defineProperty({},side,reference[side]+reference[measurement]-popper[measurement])};data.offsets.popper=_extends({},popper,shiftOffsets[shiftvariation])}return data}},offset:{order:200,enabled:!0,fn:function(data,_ref){var offset=_ref.offset,placement=data.placement,_data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference,basePlacement=placement.split("-")[0],offsets=void 0;return offsets=isNumeric(+offset)?[+offset,0]:parseOffset(offset,popper,reference,basePlacement),"left"===basePlacement?(popper.top+=offsets[0],popper.left-=offsets[1]):"right"===basePlacement?(popper.top+=offsets[0],popper.left+=offsets[1]):"top"===basePlacement?(popper.left+=offsets[0],popper.top-=offsets[1]):"bottom"===basePlacement&&(popper.left+=offsets[0],popper.top+=offsets[1]),data.popper=popper,data},offset:0},preventOverflow:{order:300,enabled:!0,fn:function(data,options){var boundariesElement=options.boundariesElement||getOffsetParent(data.instance.popper);data.instance.reference===boundariesElement&&(boundariesElement=getOffsetParent(boundariesElement));var boundaries=getBoundaries(data.instance.popper,data.instance.reference,options.padding,boundariesElement);options.boundaries=boundaries;var order=options.priority,popper=data.offsets.popper,check={primary:function(placement){var value=popper[placement];return popper[placement]<boundaries[placement]&&!options.escapeWithReference&&(value=Math.max(popper[placement],boundaries[placement])),defineProperty({},placement,value)},secondary:function(placement){var mainSide="right"===placement?"left":"top",value=popper[mainSide];return popper[placement]>boundaries[placement]&&!options.escapeWithReference&&(value=Math.min(popper[mainSide],boundaries[placement]-("right"===placement?popper.width:popper.height))),defineProperty({},mainSide,value)}};return order.forEach((function(placement){var side=-1!==["left","top"].indexOf(placement)?"primary":"secondary";popper=_extends({},popper,check[side](placement))})),data.offsets.popper=popper,data},priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:function(data){var _data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference,placement=data.placement.split("-")[0],floor=Math.floor,isVertical=-1!==["top","bottom"].indexOf(placement),side=isVertical?"right":"bottom",opSide=isVertical?"left":"top",measurement=isVertical?"width":"height";return popper[side]<floor(reference[opSide])&&(data.offsets.popper[opSide]=floor(reference[opSide])-popper[measurement]),popper[opSide]>floor(reference[side])&&(data.offsets.popper[opSide]=floor(reference[side])),data}},arrow:{order:500,enabled:!0,fn:function(data,options){if(!isModifierRequired(data.instance.modifiers,"arrow","keepTogether"))return data;var arrowElement=options.element;if("string"==typeof arrowElement){if(!(arrowElement=data.instance.popper.querySelector(arrowElement)))return data}else if(!data.instance.popper.contains(arrowElement))return console.warn("WARNING: `arrow.element` must be child of its popper element!"),data;var placement=data.placement.split("-")[0],_data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference,isVertical=-1!==["left","right"].indexOf(placement),len=isVertical?"height":"width",sideCapitalized=isVertical?"Top":"Left",side=sideCapitalized.toLowerCase(),altSide=isVertical?"left":"top",opSide=isVertical?"bottom":"right",arrowElementSize=getOuterSizes(arrowElement)[len];reference[opSide]-arrowElementSize<popper[side]&&(data.offsets.popper[side]-=popper[side]-(reference[opSide]-arrowElementSize)),reference[side]+arrowElementSize>popper[opSide]&&(data.offsets.popper[side]+=reference[side]+arrowElementSize-popper[opSide]);var center=reference[side]+reference[len]/2-arrowElementSize/2,popperMarginSide=getStyleComputedProperty(data.instance.popper,"margin"+sideCapitalized).replace("px",""),sideValue=center-getClientRect(data.offsets.popper)[side]-popperMarginSide;return sideValue=Math.max(Math.min(popper[len]-arrowElementSize,sideValue),0),data.arrowElement=arrowElement,data.offsets.arrow={},data.offsets.arrow[side]=Math.round(sideValue),data.offsets.arrow[altSide]="",data},element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:function(data,options){if(isModifierEnabled(data.instance.modifiers,"inner"))return data;if(data.flipped&&data.placement===data.originalPlacement)return data;var boundaries=getBoundaries(data.instance.popper,data.instance.reference,options.padding,options.boundariesElement),placement=data.placement.split("-")[0],placementOpposite=getOppositePlacement(placement),variation=data.placement.split("-")[1]||"",flipOrder=[];switch(options.behavior){case BEHAVIORS_FLIP:flipOrder=[placement,placementOpposite];break;case BEHAVIORS_CLOCKWISE:flipOrder=clockwise(placement);break;case BEHAVIORS_COUNTERCLOCKWISE:flipOrder=clockwise(placement,!0);break;default:flipOrder=options.behavior}return flipOrder.forEach((function(step,index){if(placement!==step||flipOrder.length===index+1)return data;placement=data.placement.split("-")[0],placementOpposite=getOppositePlacement(placement);var popperOffsets=data.offsets.popper,refOffsets=data.offsets.reference,floor=Math.floor,overlapsRef="left"===placement&&floor(popperOffsets.right)>floor(refOffsets.left)||"right"===placement&&floor(popperOffsets.left)<floor(refOffsets.right)||"top"===placement&&floor(popperOffsets.bottom)>floor(refOffsets.top)||"bottom"===placement&&floor(popperOffsets.top)<floor(refOffsets.bottom),overflowsLeft=floor(popperOffsets.left)<floor(boundaries.left),overflowsRight=floor(popperOffsets.right)>floor(boundaries.right),overflowsTop=floor(popperOffsets.top)<floor(boundaries.top),overflowsBottom=floor(popperOffsets.bottom)>floor(boundaries.bottom),overflowsBoundaries="left"===placement&&overflowsLeft||"right"===placement&&overflowsRight||"top"===placement&&overflowsTop||"bottom"===placement&&overflowsBottom,isVertical=-1!==["top","bottom"].indexOf(placement),flippedVariation=!!options.flipVariations&&(isVertical&&"start"===variation&&overflowsLeft||isVertical&&"end"===variation&&overflowsRight||!isVertical&&"start"===variation&&overflowsTop||!isVertical&&"end"===variation&&overflowsBottom);(overlapsRef||overflowsBoundaries||flippedVariation)&&(data.flipped=!0,(overlapsRef||overflowsBoundaries)&&(placement=flipOrder[index+1]),flippedVariation&&(variation=function(variation){return"end"===variation?"start":"start"===variation?"end":variation}(variation)),data.placement=placement+(variation?"-"+variation:""),data.offsets.popper=_extends({},data.offsets.popper,getPopperOffsets(data.instance.popper,data.offsets.reference,data.placement)),data=runModifiers(data.instance.modifiers,data,"flip"))})),data},behavior:"flip",padding:5,boundariesElement:"viewport"},inner:{order:700,enabled:!1,fn:function(data){var placement=data.placement,basePlacement=placement.split("-")[0],_data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference,isHoriz=-1!==["left","right"].indexOf(basePlacement),subtractLength=-1===["top","left"].indexOf(basePlacement);return popper[isHoriz?"left":"top"]=reference[basePlacement]-(subtractLength?popper[isHoriz?"width":"height"]:0),data.placement=getOppositePlacement(placement),data.offsets.popper=getClientRect(popper),data}},hide:{order:800,enabled:!0,fn:function(data){if(!isModifierRequired(data.instance.modifiers,"hide","preventOverflow"))return data;var refRect=data.offsets.reference,bound=find(data.instance.modifiers,(function(modifier){return"preventOverflow"===modifier.name})).boundaries;if(refRect.bottom<bound.top||refRect.left>bound.right||refRect.top>bound.bottom||refRect.right<bound.left){if(!0===data.hide)return data;data.hide=!0,data.attributes["x-out-of-boundaries"]=""}else{if(!1===data.hide)return data;data.hide=!1,data.attributes["x-out-of-boundaries"]=!1}return data}},computeStyle:{order:850,enabled:!0,fn:function(data,options){var x=options.x,y=options.y,popper=data.offsets.popper,legacyGpuAccelerationOption=find(data.instance.modifiers,(function(modifier){return"applyStyle"===modifier.name})).gpuAcceleration;void 0!==legacyGpuAccelerationOption&&console.warn("WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!");var gpuAcceleration=void 0!==legacyGpuAccelerationOption?legacyGpuAccelerationOption:options.gpuAcceleration,offsetParentRect=getBoundingClientRect(getOffsetParent(data.instance.popper)),styles={position:popper.position},offsets={left:Math.floor(popper.left),top:Math.floor(popper.top),bottom:Math.floor(popper.bottom),right:Math.floor(popper.right)},sideA="bottom"===x?"top":"bottom",sideB="right"===y?"left":"right",prefixedProperty=getSupportedPropertyName("transform"),left=void 0,top=void 0;if(top="bottom"===sideA?-offsetParentRect.height+offsets.bottom:offsets.top,left="right"===sideB?-offsetParentRect.width+offsets.right:offsets.left,gpuAcceleration&&prefixedProperty)styles[prefixedProperty]="translate3d("+left+"px, "+top+"px, 0)",styles[sideA]=0,styles[sideB]=0,styles.willChange="transform";else{var invertTop="bottom"===sideA?-1:1,invertLeft="right"===sideB?-1:1;styles[sideA]=top*invertTop,styles[sideB]=left*invertLeft,styles.willChange=sideA+", "+sideB}var attributes={"x-placement":data.placement};return data.attributes=_extends({},attributes,data.attributes),data.styles=_extends({},styles,data.styles),data.arrowStyles=_extends({},data.offsets.arrow,data.arrowStyles),data},gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:function(data){var element,attributes;return setStyles(data.instance.popper,data.styles),element=data.instance.popper,attributes=data.attributes,Object.keys(attributes).forEach((function(prop){!1!==attributes[prop]?element.setAttribute(prop,attributes[prop]):element.removeAttribute(prop)})),data.arrowElement&&Object.keys(data.arrowStyles).length&&setStyles(data.arrowElement,data.arrowStyles),data},onLoad:function(reference,popper,options,modifierOptions,state){var referenceOffsets=getReferenceOffsets(0,popper,reference),placement=computeAutoPlacement(options.placement,referenceOffsets,popper,reference,options.modifiers.flip.boundariesElement,options.modifiers.flip.padding);return popper.setAttribute("x-placement",placement),setStyles(popper,{position:"absolute"}),options},gpuAcceleration:void 0}},Defaults={placement:"bottom",eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:modifiers},Popper=function(){function Popper(reference,popper){var _this=this,options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};classCallCheck(this,Popper),this.scheduleUpdate=function(){return requestAnimationFrame(_this.update)},this.update=debounce(this.update.bind(this)),this.options=_extends({},Popper.Defaults,options),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=reference&&reference.jquery?reference[0]:reference,this.popper=popper&&popper.jquery?popper[0]:popper,this.options.modifiers={},Object.keys(_extends({},Popper.Defaults.modifiers,options.modifiers)).forEach((function(name){_this.options.modifiers[name]=_extends({},Popper.Defaults.modifiers[name]||{},options.modifiers?options.modifiers[name]:{})})),this.modifiers=Object.keys(this.options.modifiers).map((function(name){return _extends({name:name},_this.options.modifiers[name])})).sort((function(a,b){return a.order-b.order})),this.modifiers.forEach((function(modifierOptions){modifierOptions.enabled&&isFunction(modifierOptions.onLoad)&&modifierOptions.onLoad(_this.reference,_this.popper,_this.options,modifierOptions,_this.state)})),this.update();var eventsEnabled=this.options.eventsEnabled;eventsEnabled&&this.enableEventListeners(),this.state.eventsEnabled=eventsEnabled}return createClass(Popper,[{key:"update",value:function(){return update.call(this)}},{key:"destroy",value:function(){return destroy.call(this)}},{key:"enableEventListeners",value:function(){return enableEventListeners.call(this)}},{key:"disableEventListeners",value:function(){return disableEventListeners.call(this)}}]),Popper}();return Popper.Utils=("undefined"!=typeof window?window:global).PopperUtils,Popper.placements=placements,Popper.Defaults=Defaults,Popper}));
/**
 * This is an empty module, that is required before all other modules.
 * Because every module is returned from a request for any other module, this
 * forces the loading of all modules with a single request.
 *
 * This function also sets up the listeners for ajax requests so we can tell
 * if any requests are still in progress.
 *
 * @module     core/first
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/first",["jquery"],(function($){$(document).bind("ajaxStart",(function(){M.util.js_pending("jq")})).bind("ajaxStop",(function(){M.util.js_complete("jq")}))}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var global,factory;global=window,factory=function(mustache){var objectToString=Object.prototype.toString,isArray=Array.isArray||function(object){return"[object Array]"===objectToString.call(object)};function isFunction(object){return"function"==typeof object}function escapeRegExp(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function hasProperty(obj,propName){return null!=obj&&"object"===_typeof(obj)&&propName in obj}var regExpTest=RegExp.prototype.test,nonSpaceRe=/\S/;function isWhitespace(string){return!function(re,string){return regExpTest.call(re,string)}(nonSpaceRe,string)}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},whiteRe=/\s*/,spaceRe=/\s+/,equalsRe=/\s*=/,curlyRe=/\s*\}/,tagRe=/#|\^|\/|>|\{|&|=|!|\$|</;function Scanner(string){this.string=string,this.tail=string,this.pos=0}function Context(view,parentContext){this.view=view,this.blocks={},this.cache={".":this.view},this.parent=parentContext}function Writer(){this.cache={}}Scanner.prototype.eos=function(){return""===this.tail},Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(!match||0!==match.index)return"";var string=match[0];return this.tail=this.tail.substring(string.length),this.pos+=string.length,string},Scanner.prototype.scanUntil=function(re){var match,index=this.tail.search(re);switch(index){case-1:match=this.tail,this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,index),this.tail=this.tail.substring(index)}return this.pos+=match.length,match},Context.prototype.push=function(view){return new Context(view,this)},Context.prototype.setBlockVar=function(name,value){return this.blocks[name]=value,value},Context.prototype.clearBlockVars=function(){this.blocks={}},Context.prototype.getBlockVar=function(name){var value,blocks=this.blocks;return blocks.hasOwnProperty(name)?value=blocks[name]:this.parent&&(value=this.parent.getBlockVar(name)),value},Context.prototype.lookup=function(name){var value,primitive,propName,cache=this.cache;if(cache.hasOwnProperty(name))value=cache[name];else{for(var intermediateValue,names,index,context=this,lookupHit=!1;context;){if(name.indexOf(".")>0)for(intermediateValue=context.view,names=name.split("."),index=0;null!=intermediateValue&&index<names.length;)index===names.length-1&&(lookupHit=hasProperty(intermediateValue,names[index])||(primitive=intermediateValue,propName=names[index],null!=primitive&&"object"!==_typeof(primitive)&&primitive.hasOwnProperty&&primitive.hasOwnProperty(propName))),intermediateValue=intermediateValue[names[index++]];else intermediateValue=context.view[name],lookupHit=hasProperty(context.view,name);if(lookupHit){value=intermediateValue;break}context=context.parent}cache[name]=value}return isFunction(value)&&(value=value.call(this.view)),value},Writer.prototype.clearCache=function(){this.cache={}},Writer.prototype.parse=function(template,tags){var cache=this.cache,cacheKey=template+":"+(tags||mustache.tags).join(":"),tokens=cache[cacheKey];return null==tokens&&(tokens=cache[cacheKey]=function(template,tags){if(!template)return[];var openingTagRe,closingTagRe,closingCurlyRe,lineHasNonSpace=!1,sections=[],tokens=[],spaces=[],hasTag=!1,nonSpace=!1,indentation="",tagIndex=0;function stripSpace(){if(hasTag&&!nonSpace)for(;spaces.length;)delete tokens[spaces.pop()];else spaces=[];hasTag=!1,nonSpace=!1}function compileTags(tagsToCompile){if("string"==typeof tagsToCompile&&(tagsToCompile=tagsToCompile.split(spaceRe,2)),!isArray(tagsToCompile)||2!==tagsToCompile.length)throw new Error("Invalid tags: "+tagsToCompile);openingTagRe=new RegExp(escapeRegExp(tagsToCompile[0])+"\\s*"),closingTagRe=new RegExp("\\s*"+escapeRegExp(tagsToCompile[1])),closingCurlyRe=new RegExp("\\s*"+escapeRegExp("}"+tagsToCompile[1]))}compileTags(tags||mustache.tags);for(var start,type,value,chr,token,openSection,scanner=new Scanner(template);!scanner.eos();){if(start=scanner.pos,value=scanner.scanUntil(openingTagRe))for(var i=0,valueLength=value.length;i<valueLength;++i)isWhitespace(chr=value.charAt(i))?(spaces.push(tokens.length),indentation+=chr):(nonSpace=!0,lineHasNonSpace=!0,indentation+=" "),tokens.push(["text",chr,start,start+1]),start+=1,"\n"===chr&&(stripSpace(),indentation="",tagIndex=0,lineHasNonSpace=!1);if(!scanner.scan(openingTagRe))break;if(hasTag=!0,type=scanner.scan(tagRe)||"name",scanner.scan(whiteRe),"="===type?(value=scanner.scanUntil(equalsRe),scanner.scan(equalsRe),scanner.scanUntil(closingTagRe)):"{"===type?(value=scanner.scanUntil(closingCurlyRe),scanner.scan(curlyRe),scanner.scanUntil(closingTagRe),type="&"):value=scanner.scanUntil(closingTagRe),!scanner.scan(closingTagRe))throw new Error("Unclosed tag at "+scanner.pos);if(token=">"==type?[type,value,start,scanner.pos,indentation,tagIndex,lineHasNonSpace]:[type,value,start,scanner.pos],tagIndex++,tokens.push(token),"#"===type||"^"===type||"$"===type||"<"===type)sections.push(token);else if("/"===type){if(!(openSection=sections.pop()))throw new Error('Unopened section "'+value+'" at '+start);if(openSection[1]!==value)throw new Error('Unclosed section "'+openSection[1]+'" at '+start)}else"name"===type||"{"===type||"&"===type?nonSpace=!0:"="===type&&compileTags(value)}if(stripSpace(),openSection=sections.pop())throw new Error('Unclosed section "'+openSection[1]+'" at '+scanner.pos);return function(tokens){for(var token,nestedTokens=[],collector=nestedTokens,sections=[],i=0,numTokens=tokens.length;i<numTokens;++i)switch((token=tokens[i])[0]){case"$":case"<":case"#":case"^":collector.push(token),sections.push(token),collector=token[4]=[];break;case"/":sections.pop()[5]=token[2],collector=sections.length>0?sections[sections.length-1][4]:nestedTokens;break;default:collector.push(token)}return nestedTokens}(function(tokens){for(var token,lastToken,squashedTokens=[],i=0,numTokens=tokens.length;i<numTokens;++i)(token=tokens[i])&&("text"===token[0]&&lastToken&&"text"===lastToken[0]?(lastToken[1]+=token[1],lastToken[3]=token[3]):(squashedTokens.push(token),lastToken=token));return squashedTokens}(tokens))}(template,tags)),tokens},Writer.prototype.render=function(template,view,partials,tags){var tokens=this.parse(template,tags),context=view instanceof Context?view:new Context(view);return this.renderTokens(tokens,context,partials,template,tags)},Writer.prototype.renderTokens=function(tokens,context,partials,originalTemplate,tags){for(var token,symbol,value,buffer="",i=0,numTokens=tokens.length;i<numTokens;++i)value=void 0,"#"===(symbol=(token=tokens[i])[0])?value=this.renderSection(token,context,partials,originalTemplate):"^"===symbol?value=this.renderInverted(token,context,partials,originalTemplate):">"===symbol?value=this.renderPartial(token,context,partials,tags):"<"===symbol?value=this.renderBlock(token,context,partials,originalTemplate):"$"===symbol?value=this.renderBlockVariable(token,context,partials,originalTemplate):"&"===symbol?value=this.unescapedValue(token,context):"name"===symbol?value=this.escapedValue(token,context):"text"===symbol&&(value=this.rawValue(token)),void 0!==value&&(buffer+=value);return buffer},Writer.prototype.renderSection=function(token,context,partials,originalTemplate){var self=this,buffer="",value=context.lookup(token[1]);if(value){if(isArray(value))for(var j=0,valueLength=value.length;j<valueLength;++j)buffer+=this.renderTokens(token[4],context.push(value[j]),partials,originalTemplate);else if("object"===_typeof(value)||"string"==typeof value||"number"==typeof value)buffer+=this.renderTokens(token[4],context.push(value),partials,originalTemplate);else if(isFunction(value)){if("string"!=typeof originalTemplate)throw new Error("Cannot use higher-order sections without the original template");null!=(value=value.call(context.view,originalTemplate.slice(token[3],token[5]),(function(template){return self.render(template,context,partials)})))&&(buffer+=value)}else buffer+=this.renderTokens(token[4],context,partials,originalTemplate);return buffer}},Writer.prototype.renderInverted=function(token,context,partials,originalTemplate){var value=context.lookup(token[1]);if(!value||isArray(value)&&0===value.length)return this.renderTokens(token[4],context,partials,originalTemplate)},Writer.prototype.indentPartial=function(partial,indentation,lineHasNonSpace){for(var filteredIndentation=indentation.replace(/[^ \t]/g,""),partialByNl=partial.split("\n"),i=0;i<partialByNl.length;i++)partialByNl[i].length&&(i>0||!lineHasNonSpace)&&(partialByNl[i]=filteredIndentation+partialByNl[i]);return partialByNl.join("\n")},Writer.prototype.renderPartial=function(token,context,partials,tags){if(partials){var value=isFunction(partials)?partials(token[1]):partials[token[1]];if(null!=value){var lineHasNonSpace=token[6],tagIndex=token[5],indentation=token[4],indentedValue=value;return 0==tagIndex&&indentation&&(indentedValue=this.indentPartial(value,indentation,lineHasNonSpace)),this.renderTokens(this.parse(indentedValue,tags),context,partials,indentedValue)}}},Writer.prototype.renderBlock=function(token,context,partials,originalTemplate){if(partials){var value=isFunction(partials)?partials(token[1]):partials[token[1]];null!=value&&context.clearBlockVars(),this.renderTokens(token[4],context,partials,originalTemplate);var result=this.renderTokens(this.parse(value),context,partials,value);return context.clearBlockVars(),result}},Writer.prototype.renderBlockVariable=function(token,context,partials,originalTemplate){var value=token[1],exists=context.getBlockVar(value);return exists?this.renderTokens(this.parse(exists),context,partials,exists):(context.setBlockVar(value,originalTemplate.slice(token[3],token[5])),this.renderTokens(token[4],context,partials,originalTemplate))},Writer.prototype.unescapedValue=function(token,context){var value=context.lookup(token[1]);if(null!=value)return value},Writer.prototype.escapedValue=function(token,context){var value=context.lookup(token[1]);if(null!=value)return mustache.escape(value)},Writer.prototype.rawValue=function(token){return token[1]},mustache.name="mustache.js",mustache.version="3.1.0",mustache.tags=["{{","}}"];var defaultWriter=new Writer;return mustache.clearCache=function(){return defaultWriter.clearCache()},mustache.parse=function(template,tags){return defaultWriter.parse(template,tags)},mustache.render=function(template,view,partials,tags){if("string"!=typeof template)throw new TypeError('Invalid template! Template should be a "string" but "'+(isArray(obj=template)?"array":_typeof(obj))+'" was given as the first argument for mustache#render(template, view, partials)');var obj;return defaultWriter.render(template,view,partials,tags)},mustache.to_html=function(template,view,partials,send){var result=mustache.render(template,view,partials);if(!isFunction(send))return result;send(result)},mustache.escape=function(string){return String(string).replace(/[&<>"'`=\/]/g,(function(s){return entityMap[s]}))},mustache.Scanner=Scanner,mustache.Context=Context,mustache.Writer=Writer,mustache},"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&exports&&"string"!=typeof exports.nodeName?factory(exports):"function"==typeof define&&define.amd?define("core/mustache",["exports"],factory):(global.Mustache={},factory(global.Mustache));
/**
 * Chart pie.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_pie
 */
define("core/chart_pie",["core/chart_base"],(function(Base){function Pie(){Base.prototype.constructor.apply(this,arguments)}return Pie.prototype=Object.create(Base.prototype),Pie.prototype.TYPE="pie",Pie.prototype._doughnut=null,Pie.prototype.create=function(Klass,data){var chart=Base.prototype.create.apply(this,arguments);return chart.setDoughnut(data.doughnut),chart},Pie.prototype.addSeries=function(series){if(null===series.getColor()){for(var colors=[],configColorSet=this.getConfigColorSet()||Base.prototype.COLORSET,i=0;i<series.getCount();i++)colors.push(configColorSet[i%configColorSet.length]);series.setColors(colors)}return Base.prototype.addSeries.apply(this,arguments)},Pie.prototype.getDoughnut=function(){return this._doughnut},Pie.prototype.setDoughnut=function(doughnut){this._doughnut=Boolean(doughnut)},Pie.prototype._validateSeries=function(){if(this._series.length>=1)throw new Error("Pie charts only support one serie.");return Base.prototype._validateSeries.apply(this,arguments)},Pie}));
/**
 * Course selector adaptor for auto-complete form element.
 *
 * @module     core/form-course-selector
 * @class      form-course-selector
 * @package    core
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("core/form-course-selector",["core/ajax","jquery"],(function(ajax,$){return{processResults:function(selector,data){var results=[],i=0,excludelist=String($(selector).data("exclude")).split(",");for(i=0;i<data.courses.length;i++)-1===excludelist.indexOf(String(data.courses[i].id))&&results.push({value:data.courses[i].id,label:data.courses[i].displayname});return results},transport:function(selector,query,success,failure){var el=$(selector),requiredcapabilities=el.data("requiredcapabilities");requiredcapabilities=""!==requiredcapabilities.trim()?requiredcapabilities.split(","):[];var promises,limittoenrolled=el.data("limittoenrolled"),includefrontpage=el.data("includefrontpage"),onlywithcompletion=el.data("onlywithcompletion");void 0===query&&(query="");var calls=[{methodname:"core_course_search_courses",args:{criterianame:"search",criteriavalue:query,page:0,perpage:100,requiredcapabilities:requiredcapabilities,limittoenrolled:limittoenrolled,onlywithcompletion:onlywithcompletion}}];includefrontpage&&calls.push({methodname:"core_course_get_courses",args:{options:{ids:[includefrontpage]}}}),promises=ajax.call(calls),$.when.apply($.when,promises).done((function(data,site){if(site&&1==site.length){var frontpage=site.pop();(""===query||frontpage.fullname.toUpperCase().indexOf(query.toUpperCase())>-1||frontpage.shortname.toUpperCase().indexOf(query.toUpperCase())>-1)&&data.courses.splice(0,0,frontpage)}success(data)})).fail(failure)}}}));
define("core/drawer_events",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={DRAWER_SHOWN:"drawer-shown",DRAWER_HIDDEN:"drawer-hidden"},_exports.default}));
/**
 * A module to help with toggle select/deselect all.
 *
 * @module     core/checkbox-toggleall
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/checkbox-toggleall",["jquery","core/pubsub"],(function($,PubSub){var registered=!1,events={checkboxToggled:"core/checkbox-toggleall:checkboxToggled"},getToggleGroupElements=function(root,toggleGroup,exactMatch){return exactMatch?root.find('[data-action="toggle"][data-togglegroup="'+toggleGroup+'"]'):root.find('[data-action="toggle"][data-togglegroup^="'+toggleGroup+'"]')},getAllSlaveCheckboxes=function(root,toggleGroup){return getToggleGroupElements(root,toggleGroup,!1).filter('[data-toggle="slave"]')},getControlCheckboxes=function(root,toggleGroup,exactMatch){return getToggleGroupElements(root,toggleGroup,exactMatch).filter('[data-toggle="master"]')},toggleSlavesFromMasters=function(e){var targetState,root=e.data.root,target=$(e.target),toggleGroupName=target.data("togglegroup");targetState=target.is(":checkbox")?target.is(":checked"):1===target.data("checkall"),toggleSlavesToState(root,toggleGroupName,targetState)},toggleMastersAndActionElements=function(root,toggleGroupName){var toggleGroupSlaves=getAllSlaveCheckboxes(root,toggleGroupName);if(toggleGroupSlaves.length>0){var toggleGroupCheckedSlaves=toggleGroupSlaves.filter(":checked"),targetState=toggleGroupSlaves.length===toggleGroupCheckedSlaves.length;setMasterStates(root,toggleGroupName,targetState,!0),setActionElementStates(root,toggleGroupName,!toggleGroupCheckedSlaves.length)}},getToggleGroupLevels=function(toggleGroupName){var toggleGroups=toggleGroupName.split(" "),toggleGroupLevels=[],toggleGroupLevel="";return toggleGroups.forEach((function(toggleGroupName){toggleGroupLevel+=" "+toggleGroupName,toggleGroupLevels.push(toggleGroupLevel.trim())})),toggleGroupLevels},toggleSlavesToState=function(root,toggleGroupName,targetState){var slaves=getAllSlaveCheckboxes(root,toggleGroupName);slaves.prop("checked",targetState).trigger("change");var checkedSlaves=slaves.filter(":checked");setMasterStates(root,toggleGroupName,targetState,!1),setActionElementStates(root,toggleGroupName,!checkedSlaves.length),getToggleGroupLevels(toggleGroupName).filter((function(toggleGroupLevel){return toggleGroupLevel!==toggleGroupName})).forEach((function(toggleGroupLevel){toggleMastersAndActionElements(root,toggleGroupLevel)})),PubSub.publish(events.checkboxToggled,{root:root,toggleGroupName:toggleGroupName,slaves:slaves,checkedSlaves:checkedSlaves,anyChecked:targetState})},toggleMastersFromSlaves=function(e){var root=e.data.root,toggleGroupName=$(e.target).data("togglegroup"),slaves=getAllSlaveCheckboxes(root,toggleGroupName),checkedSlaves=slaves.filter(":checked");getToggleGroupLevels(toggleGroupName).forEach((function(toggleGroupLevel){toggleMastersAndActionElements(root,toggleGroupLevel)})),PubSub.publish(events.checkboxToggled,{root:root,toggleGroupName:toggleGroupName,slaves:slaves,checkedSlaves:checkedSlaves,anyChecked:!!checkedSlaves.length})},setActionElementStates=function(root,toggleGroupName,disableActionElements){(function(root,toggleGroup){return getToggleGroupElements(root,toggleGroup,!0).filter('[data-toggle="action"]')})(root,toggleGroupName).prop("disabled",disableActionElements)},setMasterStates=function(root,toggleGroupName,targetState,exactMatch){var masters=getControlCheckboxes(root,toggleGroupName,exactMatch);masters.prop("checked",targetState),masters.each((function(i,masterElement){var targetString;if(masterElement=$(masterElement),targetString=targetState?masterElement.data("toggle-deselectall"):masterElement.data("toggle-selectall"),masterElement.is(":checkbox")){var masterLabel=root.find('[for="'+masterElement.attr("id")+'"]');masterLabel.length&&masterLabel.html()!==targetString&&masterLabel.html(targetString)}else masterElement.text(targetString),masterElement.data("checkall",targetState?0:1)}))};return{init:function(){!function(){if(!registered){registered=!0;var root=$(document.body);root.on("click",'[data-action="toggle"][data-toggle="master"]',{root:root},toggleSlavesFromMasters),root.on("click",'[data-action="toggle"][data-toggle="slave"]',{root:root},toggleMastersFromSlaves)}}()},events:events,setGroupState:function(root,toggleGroupName,targetState){root=$(root),setMasterStates(root,toggleGroupName,targetState,!0),toggleSlavesToState(root,toggleGroupName,targetState)},updateSlavesFromMasterState:function(root,toggleGroupName){root=$(root);var targetState,target=getControlCheckboxes(root,toggleGroupName,!1);targetState=target.is(":checkbox")?target.is(":checked"):1===target.data("checkall"),toggleSlavesToState(root,toggleGroupName,targetState)}}}));
/*
 * @package    core
 * @class      permissionmanager
 * @copyright  2015 Martin Mastny <mastnym@vscht.cz>
 * @since      3.0
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/permissionmanager",["jquery","core/config","core/notification","core/templates","core/yui"],(function($,config,notification,templates,Y){var contextid,contextname,adminurl,overideableroles,SELECTORS_ADDROLE="a.allowlink, a.prohibitlink",SELECTORS_REMOVEROLE="a.preventlink, a.unprohibitlink",SELECTORS_UNPROHIBIT="a.unprohibitlink",rolesloadedevent=$.Event("rolesloaded"),panel=null,_loadOverideableRoles=function(){var params={contextid:contextid,getroles:1,sesskey:config.sesskey};$.post(adminurl+"roles/ajax.php",params,null,"json").done((function(data){try{overideableroles=data,(_loadOverideableRoles=function(){$("body").trigger(rolesloadedevent)})()}catch(err){notification.exception(err)}})).fail((function(jqXHR,status,error){notification.exception(error)}))},changePermissions=function(row,roleid,action){var params={contextid:contextid,roleid:roleid,sesskey:M.cfg.sesskey,action:action,capability:row.data("name")};$.post(adminurl+"roles/ajax.php",params,null,"json").done((function(data){var action=data;try{var templatedata={rolename:overideableroles[roleid],roleid:roleid,adminurl:adminurl,imageurl:M.util.image_url("t/delete","moodle")};switch(action){case"allow":templatedata.spanclass="allowed",templatedata.linkclass="preventlink",templatedata.action="prevent",templatedata.icon="t/delete",templatedata.iconalt=M.util.get_string("deletexrole","core_role",overideableroles[roleid]);break;case"prohibit":templatedata.spanclass="forbidden",templatedata.linkclass="unprohibitlink",templatedata.action="unprohibit",templatedata.icon="t/delete",templatedata.iconalt=M.util.get_string("deletexrole","core_role",overideableroles[roleid]);break;case"prevent":return void row.find('a[data-role-id="'+roleid+'"]').first().closest(".allowed").remove();case"unprohibit":return void row.find('a[data-role-id="'+roleid+'"]').first().closest(".forbidden").remove();default:return}templates.render("core/permissionmanager_role",templatedata).done((function(content){if("allow"==action)$(content).insertBefore(row.find(".allowmore").first());else if("prohibit"==action){$(content).insertBefore(row.find(".prohibitmore").first());var allowedLink=row.find(".allowedroles").first().find('a[data-role-id="'+roleid+'"]');allowedLink&&allowedLink.first().closest(".allowed").remove()}panel.hide()})).fail(notification.exception)}catch(err){notification.exception(err)}})).fail((function(jqXHR,status,error){notification.exception(error)}))},handleAddRole=function(e){e.preventDefault();var link=$(e.currentTarget);$("body").one("rolesloaded",(function(){Y.use("moodle-core-notification-dialogue",(function(){var i,existingrolelinks,action=link.data("action"),row=link.closest("tr.rolecap"),confirmationDetails={cap:row.data("humanname"),context:contextname},message=M.util.get_string("role"+action+"info","core_role",confirmationDetails);null===panel&&(panel=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,width:"450px"})),panel.set("headerContent",M.util.get_string("role"+action+"header","core_role"));var roles=[];switch(action){case"allow":existingrolelinks=row.find(SELECTORS_REMOVEROLE);break;case"prohibit":existingrolelinks=row.find(SELECTORS_UNPROHIBIT)}for(i in overideableroles){var disabled="";existingrolelinks.filter("[data-role-id='"+i+"']").length&&(disabled="disabled");var roledetails={roleid:i,rolename:overideableroles[i],disabled:disabled};roles.push(roledetails)}templates.render("core/permissionmanager_panelcontent",{message:message,roles:roles}).done((function(content){panel.set("bodyContent",content),panel.show(),$("div.role_buttons").on("click","button",(function(e){var roleid=$(e.currentTarget).data("role-id");changePermissions(row,roleid,action)}))})).fail(notification.exception)}))})),_loadOverideableRoles()},handleRemoveRole=function(e){e.preventDefault();var link=$(e.currentTarget);$("body").one("rolesloaded",(function(){var action=link.data("action"),roleid=link.data("role-id"),row=link.closest("tr.rolecap"),questionDetails={role:overideableroles[roleid],cap:row.data("humanname"),context:contextname};notification.confirm(M.util.get_string("confirmunassigntitle","core_role"),M.util.get_string("confirmrole"+action,"core_role",questionDetails),M.util.get_string("confirmunassignyes","core_role"),M.util.get_string("confirmunassignno","core_role"),(function(){changePermissions(row,roleid,action)}))})),_loadOverideableRoles()};return{initialize:function(args){contextid=args.contextid,contextname=args.contextname,adminurl=args.adminurl;var body=$("body");body.on("click",SELECTORS_ADDROLE,handleAddRole),body.on("click",SELECTORS_REMOVEROLE,handleRemoveRole)}}}));
/**
 * A helper to manage pendingJS checks.
 *
 * @module     core/pending
 * @package    core
 * @copyright  2018 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.6
 */
define("core/pending",["jquery"],(function($){var request=function(pendingKey){var pendingPromise=$.Deferred();return pendingKey=pendingKey||{},M.util.js_pending(pendingKey),pendingPromise.then((function(){return M.util.js_complete(pendingKey)})).catch(),pendingPromise};return request.prototype.constructor=request,request}));
/**
 * Chart output.
 *
 * Proxy to the default output module.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/chart_output",["core/chart_output_chartjs"],(function(Output){return Output}));
/**
 * Competency rule points module.
 *
 * @package    core
 * @copyright  2017 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/icon_system_standard",["core/icon_system","core/url","core/mustache"],(function(IconSystem,CoreUrl,Mustache){var IconSystemStandard=function(){IconSystem.apply(this,arguments)};return(IconSystemStandard.prototype=Object.create(IconSystem.prototype)).renderIcon=function(key,component,title,template){var templatecontext={attributes:[{name:"src",value:CoreUrl.imageUrl(key,component)},{name:"alt",value:title},{name:"title",value:title}]};return void 0!==title&&""!=title||templatecontext.attributes.push({name:"aria-hidden",value:"true"}),Mustache.render(template,templatecontext).trim()},IconSystemStandard.prototype.getTemplateName=function(){return"core/pix_icon"},IconSystemStandard}));
/**
 * Expose the M.cfg global variable.
 *
 * @module     core/config
 * @class      config
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/config",(function(){return M.cfg}));
define("core/pubsub",["exports","core/pending"],(function(_exports,_pending){var obj;
/**
   * A simple Javascript PubSub implementation.
   *
   * @module     core/pubsub
   * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.unsubscribe=_exports.subscribe=_exports.publish=void 0,_pending=(obj=_pending)&&obj.__esModule?obj:{default:obj};var events={};_exports.subscribe=function(eventName,callback){events[eventName]=events[eventName]||[],events[eventName].push(callback)};_exports.unsubscribe=function(eventName,callback){if(events[eventName])for(var i=0;i<events[eventName].length;i++)if(events[eventName][i]===callback){events[eventName].splice(i,1);break}};_exports.publish=function(eventName,data){var pendingPromise=new _pending.default("Publishing "+eventName);events[eventName]&&events[eventName].forEach((function(callback){callback(data)})),pendingPromise.resolve()}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var root,definition;root=window,definition=function(){var noop=function(){},isIE="undefined"!==("undefined"==typeof window?"undefined":_typeof(window))&&/Trident\/|MSIE /.test(window.navigator.userAgent),logMethods=["trace","debug","info","warn","error"];function bindMethod(obj,methodName){var method=obj[methodName];if("function"==typeof method.bind)return method.bind(obj);try{return Function.prototype.bind.call(method,obj)}catch(e){return function(){return Function.prototype.apply.apply(method,[obj,arguments])}}}function traceForIE(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function realMethod(methodName){return"debug"===methodName&&(methodName="log"),"undefined"!==("undefined"==typeof console?"undefined":_typeof(console))&&("trace"===methodName&&isIE?traceForIE:void 0!==console[methodName]?bindMethod(console,methodName):void 0!==console.log?bindMethod(console,"log"):noop)}function replaceLoggingMethods(level,loggerName){for(var i=0;i<logMethods.length;i++){var methodName=logMethods[i];this[methodName]=i<level?noop:this.methodFactory(methodName,level,loggerName)}this.log=this.debug}function enableLoggingWhenConsoleArrives(methodName,level,loggerName){return function(){"undefined"!==("undefined"==typeof console?"undefined":_typeof(console))&&(replaceLoggingMethods.call(this,level,loggerName),this[methodName].apply(this,arguments))}}function defaultMethodFactory(methodName,level,loggerName){return realMethod(methodName)||enableLoggingWhenConsoleArrives.apply(this,arguments)}function Logger(name,defaultLevel,factory){var currentLevel,self=this,storageKey="loglevel";function getPersistedLevel(){var storedLevel;if("undefined"!==("undefined"==typeof window?"undefined":_typeof(window))){try{storedLevel=window.localStorage[storageKey]}catch(ignore){}if("undefined"===_typeof(storedLevel))try{var cookie=window.document.cookie,location=cookie.indexOf(encodeURIComponent(storageKey)+"=");-1!==location&&(storedLevel=/^([^;]+)/.exec(cookie.slice(location))[1])}catch(ignore){}return void 0===self.levels[storedLevel]&&(storedLevel=void 0),storedLevel}}name&&(storageKey+=":"+name),self.name=name,self.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},self.methodFactory=factory||defaultMethodFactory,self.getLevel=function(){return currentLevel},self.setLevel=function(level,persist){if("string"==typeof level&&void 0!==self.levels[level.toUpperCase()]&&(level=self.levels[level.toUpperCase()]),!("number"==typeof level&&level>=0&&level<=self.levels.SILENT))throw"log.setLevel() called with invalid level: "+level;if(currentLevel=level,!1!==persist&&function(levelNum){var levelName=(logMethods[levelNum]||"silent").toUpperCase();if("undefined"!==("undefined"==typeof window?"undefined":_typeof(window))){try{return void(window.localStorage[storageKey]=levelName)}catch(ignore){}try{window.document.cookie=encodeURIComponent(storageKey)+"="+levelName+";"}catch(ignore){}}}(level),replaceLoggingMethods.call(self,level,name),"undefined"===("undefined"==typeof console?"undefined":_typeof(console))&&level<self.levels.SILENT)return"No console available for logging"},self.setDefaultLevel=function(level){getPersistedLevel()||self.setLevel(level,!1)},self.enableAll=function(persist){self.setLevel(self.levels.TRACE,persist)},self.disableAll=function(persist){self.setLevel(self.levels.SILENT,persist)};var initialLevel=getPersistedLevel();null==initialLevel&&(initialLevel=null==defaultLevel?"WARN":defaultLevel),self.setLevel(initialLevel,!1)}var defaultLogger=new Logger,_loggersByName={};defaultLogger.getLogger=function(name){if("string"!=typeof name||""===name)throw new TypeError("You must supply a name when creating a logger.");var logger=_loggersByName[name];return logger||(logger=_loggersByName[name]=new Logger(name,defaultLogger.getLevel(),defaultLogger.methodFactory)),logger};var _log="undefined"!==("undefined"==typeof window?"undefined":_typeof(window))?window.log:void 0;return defaultLogger.noConflict=function(){return"undefined"!==("undefined"==typeof window?"undefined":_typeof(window))&&window.log===defaultLogger&&(window.log=_log),defaultLogger},defaultLogger.getLoggers=function(){return _loggersByName},defaultLogger},"function"==typeof define&&define.amd?define("core/loglevel",definition):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=definition():root.log=definition();
define("core/userfeedback",["exports","core/ajax","core/notification"],(function(_exports,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Handle clicking on action links of the feedback alert.
   *
   * @module     core/cta_feedback
   * @copyright  2020 Shamim Rezaie <shamim@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.registerEventListeners=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);var Selectors={regions:{root:'[data-region="core/userfeedback"]'},actions:{}};Selectors.actions.give="".concat(Selectors.regions.root,' [data-action="give"]'),Selectors.actions.remind="".concat(Selectors.regions.root,' [data-action="remind"]');_exports.registerEventListeners=function(){document.addEventListener("click",(function(e){var giveAction=e.target.closest(Selectors.actions.give);if(giveAction){if(e.preventDefault(),!window.open(giveAction.href))throw new Error("Unable to open popup");Promise.resolve(giveAction).then(hideRoot).then(recordAction).catch(_notification.default.exception)}var remindAction=e.target.closest(Selectors.actions.remind);remindAction&&(e.preventDefault(),Promise.resolve(remindAction).then(hideRoot).then(recordAction).catch(_notification.default.exception))}))};var recordAction=function(clickedItem){return clickedItem.dataset.record?_ajax.default.call([{methodname:"core_create_userfeedback_action_record",args:{action:clickedItem.dataset.action,contextid:M.cfg.contextid}}])[0]:Promise.resolve()},hideRoot=function(clickedItem){return clickedItem.dataset.hide&&clickedItem.closest(Selectors.regions.root).remove(),clickedItem}}));
/**
 * URL utility functions.
 *
 * @module     core/url
 * @package    core
 * @class      url
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/url",["jquery","core/config"],(function($,config){return{fileUrl:function(relativeScript,slashArg){var url=config.wwwroot+relativeScript;return"/"!=slashArg.charAt(0)&&(slashArg="/"+slashArg),config.slasharguments?url+=slashArg:url+="?file="+encodeURIComponent(slashArg),url},relativeUrl:function(relativePath,params,includeSessKey){if(0===relativePath.indexOf("http:")||0===relativePath.indexOf("https:")||relativePath.indexOf("://")>=0)throw new Error("relativeUrl function does not accept absolute urls");"/"!=relativePath.charAt(0)&&(relativePath="/"+relativePath),"admin"!==config.admin&&(relativePath=relativePath.replace(/^\/admin\//,"/"+config.admin+"/")),params=params||{},includeSessKey&&(params.sesskey=config.sesskey);var queryString="";return Object.keys(params).length&&(queryString=$.map(params,(function(value,param){return param+"="+value})).join("&")),""!==queryString?config.wwwroot+relativePath+"?"+queryString:config.wwwroot+relativePath},imageUrl:function(imagename,component){return M.util.image_url(imagename,component)}}}));
/**
 * Chart output for HTML table.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_output_htmltable
 */
define("core/chart_output_htmltable",["jquery","core/chart_output_base"],(function($,Base){function Output(){Base.prototype.constructor.apply(this,arguments),this._build()}return Output.prototype=Object.create(Base.prototype),Output.prototype._build=function(){this._node.empty(),this._node.append(this._makeTable())},Output.prototype._makeTable=function(){var node,value,tbl=$("<table>"),c=this._chart,labels=c.getLabels(),hasLabel=labels.length>0,series=c.getSeries(),rowCount=series[0].getCount();tbl.addClass("chart-output-htmltable generaltable"),null!==c.getTitle()&&tbl.append($("<caption>").text(c.getTitle())),node=$("<tr>"),hasLabel&&node.append($("<td>")),series.forEach((function(serie){node.append($("<th>").text(serie.getLabel()).attr("scope","col"))})),tbl.append(node);for(var rowId=0;rowId<rowCount;rowId++){node=$("<tr>"),labels.length>0&&node.append($("<th>").text(labels[rowId]).attr("scope","row"));for(var serieId=0;serieId<series.length;serieId++)value=series[serieId].getValues()[rowId],null!==series[serieId].getLabels()&&(value=series[serieId].getLabels()[rowId]),node.append($("<td>").text(value));tbl.append(node)}return tbl},Output.prototype.update=function(){this._build()},Output}));
/**
 * Chart output for chart.js.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_output_chartjs
 */
define("core/chart_output_chartjs",["jquery","core/chartjs","core/chart_axis","core/chart_bar","core/chart_output_base","core/chart_line","core/chart_pie","core/chart_series"],(function($,Chartjs,Axis,Bar,Base,Line,Pie,Series){var makeAxisId=function(xy,index){return"axis-"+xy+"-"+index};function Output(){Base.prototype.constructor.apply(this,arguments),this._canvas=this._node,"CANVAS"!=this._canvas.prop("tagName")&&(this._canvas=$("<canvas>"),this._node.append(this._canvas)),this._build()}return Output.prototype=Object.create(Base.prototype),Output.prototype._config=null,Output.prototype._chartjs=null,Output.prototype._canvas=null,Output.prototype._build=function(){this._config=this._makeConfig(),this._chartjs=new Chartjs(this._canvas[0],this._config)},Output.prototype._cleanData=function(data){return data instanceof Array?data.map((function(value){return $("<span>").html(value).text()})):$("<span>").html(data).text()},Output.prototype._getChartType=function(){var type=this._chart.getType();return this._chart.getType()===Bar.prototype.TYPE&&!0===this._chart.getHorizontal()?type="horizontalBar":this._chart.getType()===Pie.prototype.TYPE&&!0===this._chart.getDoughnut()&&(type="doughnut"),type},Output.prototype._makeAxisConfig=function(axis,xy,index){var scaleData={id:makeAxisId(xy,index)};return axis.getPosition()!==Axis.prototype.POS_DEFAULT&&(scaleData.position=axis.getPosition()),null!==axis.getLabel()&&(scaleData.scaleLabel={display:!0,labelString:this._cleanData(axis.getLabel())}),null!==axis.getStepSize()&&(scaleData.ticks=scaleData.ticks||{},scaleData.ticks.stepSize=axis.getStepSize()),null!==axis.getMax()&&(scaleData.ticks=scaleData.ticks||{},scaleData.ticks.max=axis.getMax()),null!==axis.getMin()&&(scaleData.ticks=scaleData.ticks||{},scaleData.ticks.min=axis.getMin()),scaleData},Output.prototype._makeConfig=function(){var config={type:this._getChartType(),data:{labels:this._cleanData(this._chart.getLabels()),datasets:this._makeDatasetsConfig()},options:{title:{display:null!==this._chart.getTitle(),text:this._cleanData(this._chart.getTitle())}}},legendOptions=this._chart.getLegendOptions();return legendOptions&&(config.options.legend=legendOptions),this._chart.getXAxes().forEach(function(axis,i){var axisLabels=axis.getLabels();config.options.scales=config.options.scales||{},config.options.scales.xAxes=config.options.scales.xAxes||[],config.options.scales.xAxes[i]=this._makeAxisConfig(axis,"x",i),null!==axisLabels&&(config.options.scales.xAxes[i].ticks.callback=function(value,index){return axisLabels[index]||""}),config.options.scales.xAxes[i].stacked=this._isStacked()}.bind(this)),this._chart.getYAxes().forEach(function(axis,i){var axisLabels=axis.getLabels();config.options.scales=config.options.scales||{},config.options.scales.yAxes=config.options.scales.yAxes||[],config.options.scales.yAxes[i]=this._makeAxisConfig(axis,"y",i),null!==axisLabels&&(config.options.scales.yAxes[i].ticks.callback=function(value){return axisLabels[parseInt(value,10)]||""}),config.options.scales.yAxes[i].stacked=this._isStacked()}.bind(this)),config.options.tooltips={callbacks:{label:this._makeTooltip.bind(this)}},config},Output.prototype._makeDatasetsConfig=function(){return this._chart.getSeries().map(function(series){var colors=series.hasColoredValues()?series.getColors():series.getColor(),dataset={label:this._cleanData(series.getLabel()),data:series.getValues(),type:series.getType(),fill:series.getFill(),backgroundColor:colors,borderColor:this._chart.getType()==Pie.prototype.TYPE?"#fff":colors,lineTension:this._isSmooth(series)?.3:0};return null!==series.getXAxis()&&(dataset.xAxisID=makeAxisId("x",series.getXAxis())),null!==series.getYAxis()&&(dataset.yAxisID=makeAxisId("y",series.getYAxis())),dataset}.bind(this))},Output.prototype._makeTooltip=function(tooltipItem,data){var series=this._chart.getSeries()[tooltipItem.datasetIndex],serieLabel=series.getLabel(),serieLabels=series.getLabels(),tooltipData=data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index],tooltip=[];if(""==tooltipItem.xLabel&&""==tooltipItem.yLabel){var chartLabels=this._cleanData(this._chart.getLabels());tooltip.push(chartLabels[tooltipItem.index])}return null!==serieLabels?tooltip.push(this._cleanData(serieLabels[tooltipItem.index])):tooltip.push(this._cleanData(serieLabel)+": "+tooltipData),tooltip},Output.prototype._isSmooth=function(series){var smooth=!1;return this._chart.getType()===Line.prototype.TYPE?null===(smooth=series.getSmooth())&&(smooth=this._chart.getSmooth()):series.getType()===Series.prototype.TYPE_LINE&&(smooth=series.getSmooth()),smooth},Output.prototype._isStacked=function(){var stacked=!1;return this._chart.getType()===Bar.prototype.TYPE&&(stacked=this._chart.getStacked()),stacked},Output.prototype.update=function(){$.extend(!0,this._config,this._makeConfig()),this._chartjs.update()},Output}));
define("core/notification",["exports","core/pending","core/log"],(function(_exports,_pending,_log){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.saveCancel=_exports.init=_exports.fetchNotifications=_exports.exception=_exports.default=_exports.confirm=_exports.alert=_exports.addNotification=void 0,_pending=_interopRequireDefault(_pending),_log=_interopRequireDefault(_log);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}var _ref,currentContextId=M.cfg.contextid,notificationTypes={success:"core/notification_success",info:"core/notification_info",warning:"core/notification_warning",error:"core/notification_error"},Selectors={notificationRegion:"#".concat("user-notifications"),fallbackRegionParents:["#region-main",'[role="main"]',"body"]},fetchNotifications=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var Ajax;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/ajax"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/ajax")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/ajax"]);case 2:return Ajax=_context.sent,_context.abrupt("return",Ajax.call([{methodname:"core_fetch_notifications",args:{contextid:currentContextId}}])[0].then(addNotifications));case 4:case"end":return _context.stop()}}),_callee)}))),function(){return _ref.apply(this,arguments)});_exports.fetchNotifications=fetchNotifications;var addNotifications=function(notifications){if(!notifications.length)return Promise.resolve();var pendingPromise=new _pending.default("core/notification:addNotifications");return notifications.forEach((function(notification){return renderNotification(notification.template,notification.variables)})),pendingPromise.resolve()},addNotification=function(notification){var pendingPromise=new _pending.default("core/notification:addNotifications"),template=notificationTypes.error;return notification=function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({closebutton:!0,announce:!0,type:"error"},notification),notification.template?(template=notification.template,delete notification.template):notification.type&&(void 0!==notificationTypes[notification.type]&&(template=notificationTypes[notification.type]),delete notification.type),renderNotification(template,notification).then(pendingPromise.resolve)};_exports.addNotification=addNotification;var _ref2,_ref4,renderNotification=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(template,variables){var pendingPromise,Templates;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(void 0!==variables.message&&variables.message){_context2.next=3;break}return _log.default.debug("Notification received without content. Skipping."),_context2.abrupt("return");case 3:return pendingPromise=new _pending.default("core/notification:renderNotification"),_context2.next=6,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/templates"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/templates")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/templates"]);case 6:(Templates=_context2.sent).renderForPromise(template,variables).then((function(_ref3){var html=_ref3.html,_ref3$js=_ref3.js,js=void 0===_ref3$js?"":_ref3$js;Templates.prependNodeContents(getNotificationRegion(),html,js)})).then(pendingPromise.resolve).catch(exception);case 8:case"end":return _context2.stop()}}),_callee2)}))),function(_x,_x2){return _ref2.apply(this,arguments)}),getNotificationRegion=function(){return document.querySelector(Selectors.notificationRegion)},alert=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(title,message,cancelText){var pendingPromise,ModalFactory;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return pendingPromise=new _pending.default("core/notification:alert"),_context3.next=3,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/modal_factory"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/modal_factory")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/modal_factory"]);case 3:return ModalFactory=_context3.sent,_context3.abrupt("return",ModalFactory.create({type:ModalFactory.types.ALERT,body:message,title:title,buttons:{cancel:cancelText},removeOnClose:!0}).then((function(modal){return modal.show(),pendingPromise.resolve(),modal})));case 5:case"end":return _context3.stop()}}),_callee3)}))),function(_x3,_x4,_x5){return _ref4.apply(this,arguments)});_exports.alert=alert;var confirm=function(title,question,saveLabel,noLabel,saveCallback,cancelCallback){return saveCancel(title,question,saveLabel,saveCallback,cancelCallback)};_exports.confirm=confirm;var _ref5,saveCancel=(_ref5=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(title,question,saveLabel,saveCallback,cancelCallback){var pendingPromise,_yield$Promise$all,_yield$Promise$all2,ModalFactory,ModalEvents;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return pendingPromise=new _pending.default("core/notification:confirm"),_context4.next=3,Promise.all(["function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/modal_factory"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/modal_factory")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/modal_factory"]),"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/modal_events"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/modal_events")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/modal_events"])]);case 3:return _yield$Promise$all=_context4.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2),ModalFactory=_yield$Promise$all2[0],ModalEvents=_yield$Promise$all2[1],_context4.abrupt("return",ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:title,body:question,buttons:{save:saveLabel},removeOnClose:!0}).then((function(modal){return modal.show(),modal.getRoot().on(ModalEvents.save,saveCallback),modal.getRoot().on(ModalEvents.cancel,cancelCallback),pendingPromise.resolve(),modal})));case 8:case"end":return _context4.stop()}}),_callee4)}))),function(_x6,_x7,_x8,_x9,_x10){return _ref5.apply(this,arguments)});_exports.saveCancel=saveCancel;var _ref6,exception=(_ref6=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(ex){var pendingPromise,ln,fn;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return pendingPromise=new _pending.default("core/notification:displayException"),ex.stack||(ex.stack=""),ex.debuginfo&&(ex.stack+=ex.debuginfo+"\n"),!ex.backtrace&&ex.stacktrace&&(ex.backtrace=ex.stacktrace),ex.backtrace&&(ex.stack+=ex.backtrace,ln=ex.backtrace.match(/line ([^ ]*) of/),fn=ex.backtrace.match(/ of ([^:]*): /),ln&&ln[1]&&(ex.lineNumber=ln[1]),fn&&fn[1]&&(ex.fileName=fn[1],ex.fileName.length>30&&(ex.fileName="..."+ex.fileName.substr(ex.fileName.length-27)))),void 0===ex.name&&ex.errorcode&&(ex.name=ex.errorcode),_context5.next=8,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/yui"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/yui")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/yui"]);case 8:_context5.sent.use("moodle-core-notification-exception",(function(){new M.core.exception(ex).show(),pendingPromise.resolve()}));case 10:case"end":return _context5.stop()}}),_callee5)}))),function(_x11){return _ref6.apply(this,arguments)});_exports.exception=exception;var init=function(contextId,notificationList,userLoggedIn){currentContextId=contextId,function(){if(getNotificationRegion())return!1;var newRegion=document.createElement("span");newRegion.id="user-notifications",Selectors.fallbackRegionParents.some((function(selector){var targetRegion=document.querySelector(selector);return!!targetRegion&&(targetRegion.prepend(newRegion),!0)}))}(),addNotifications(notificationList),userLoggedIn&&fetchNotifications()};_exports.init=init;var _default={init:init,fetchNotifications:fetchNotifications,addNotification:addNotification,alert:alert,confirm:confirm,saveCancel:saveCancel,exception:exception};return _exports.default=_default,_exports.default}));
define("core/prefetch",["exports","core/config"],(function(_exports,_config){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_config=(obj=_config)&&obj.__esModule?obj:{default:obj};var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var prefetchTimer,initialPrefetchComplete=!1,templateList=[],stringList={},fetchQueue=function(){if(templateList){var templatesToLoad=templateList.slice();templateList=[],("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/templates"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/templates")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/templates"])).then((function(Templates){return Templates.prefetchTemplates(templatesToLoad)})).catch()}var mappedStringsToFetch=stringList;stringList={};var stringsToFetch=[];Object.keys(mappedStringsToFetch).forEach((function(component){stringsToFetch.push.apply(stringsToFetch,_toConsumableArray(mappedStringsToFetch[component].map((function(key){return{component:component,key:key}}))))})),stringsToFetch&&("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/str"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/str")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/str"])).then((function(Str){return Str.get_strings(stringsToFetch)})).catch()},processQueue=function(){prefetchTimer||(initialPrefetchComplete?fetchQueue():prefetchTimer=setTimeout((function(){initialPrefetchComplete=!0,prefetchTimer=null,("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require([_config.default.iconsystemmodule],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require(_config.default.iconsystemmodule)):Promise.resolve(_systemImportTransformerGlobalIdentifier[_config.default.iconsystemmodule])).then((function(IconSystem){var iconSystem=new IconSystem;return prefetchTemplate(iconSystem.getTemplateName()),iconSystem})).then((function(iconSystem){fetchQueue(),iconSystem.init()})).catch()}),500))},prefetchTemplates=function(templatesNames){templateList=templateList.concat(templatesNames),processQueue()},prefetchTemplate=function(templateName){return prefetchTemplates([templateName])},prefetchStrings=function(component,keys){stringList[component]||(stringList[component]=[]),stringList[component]=stringList[component].concat(keys),processQueue()};prefetchTemplates([].concat(["core/loading"],["core/modal"],["core/modal_backdrop"])),prefetchStrings("core",["cancel","closebuttontitle","loading","savechanges"]),prefetchStrings("core_form",["showless","showmore"]);var _default={prefetchTemplate:prefetchTemplate,prefetchTemplates:prefetchTemplates,prefetchString:function(component,key){stringList[component]||(stringList[component]=[]),stringList[component].push(key),processQueue()},prefetchStrings:prefetchStrings};return _exports.default=_default,_exports.default}));
/**
 * This is an empty module, that is required before all other modules.
 * Because every module is returned from a request for any other module, this
 * forces the loading of all modules with a single request.
 *
 * @module     core/log
 * @package    core
 * @copyright  2015 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/log",["core/loglevel"],(function(log){var originalFactory=log.methodFactory;return log.methodFactory=function(methodName,logLevel){var rawMethod=originalFactory(methodName,logLevel);return function(message,source){rawMethod(source?source+": "+message:message)}},log.setConfig=function(config){void 0!==config.level&&log.setLevel(config.level)},log}));
/**
 * Javascript to enhance the paged content paging bar.
 *
 * @module     core/paging_bar
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_paging_bar",["jquery","core/custom_interaction_events","core/paged_content_events","core/str","core/pubsub","core/pending"],(function($,CustomEvents,PagedContentEvents,Str,PubSub,Pending){var SELECTORS_PAGE="[data-page]",SELECTORS_PAGE_ITEM='[data-region="page-item"]',SELECTORS_PAGE_LINK='[data-region="page-link"]',SELECTORS_FIRST_BUTTON='[data-control="first"]',SELECTORS_LAST_BUTTON='[data-control="last"]',SELECTORS_NEXT_BUTTON='[data-control="next"]',SELECTORS_PREVIOUS_BUTTON='[data-control="previous"]',SELECTORS_DOTS_BUTTONS="[data-dots]",SELECTORS_BEGINNING_DOTS_BUTTON='[data-dots="beginning"]',SELECTORS_ENDING_DOTS_BUTTON='[data-dots="ending"]',getPageByNumber=function(root,pageNumber){return root.find(SELECTORS_PAGE_ITEM+'[data-page-number="'+pageNumber+'"]')},setLastPageNumber=function(root,number){root.attr("data-last-page-number",number)},getLastPageNumber=function(root){return parseInt(root.attr("data-last-page-number"),10)},getActivePageNumber=function(root){return parseInt(root.attr("data-active-page-number"),10)},setActivePageNumber=function(root,number){root.attr("data-active-page-number",number)},getPageNumber=function(root,page){if(null!=page.attr("data-page"))return parseInt(page.attr("data-page-number"),10);var pageNumber=1,activePageNumber=null;switch(page.attr("data-control")){case"first":default:pageNumber=1;break;case"last":pageNumber=getLastPageNumber(root);break;case"next":activePageNumber=getActivePageNumber(root);var lastPage=getLastPageNumber(root);pageNumber=lastPage?activePageNumber&&activePageNumber<lastPage?activePageNumber+1:lastPage:activePageNumber+1;break;case"previous":pageNumber=(activePageNumber=getActivePageNumber(root))&&activePageNumber>1?activePageNumber-1:1}return parseInt(pageNumber,10)},show=function(root){root.removeClass("hidden")},hide=function(root){root.addClass("hidden")},disableNextControlButtons=function(root){var nextButton=root.find(SELECTORS_NEXT_BUTTON),lastButton=root.find(SELECTORS_LAST_BUTTON);nextButton.addClass("disabled"),nextButton.attr("aria-disabled",!0),lastButton.addClass("disabled"),lastButton.attr("aria-disabled",!0)},enableNextControlButtons=function(root){var nextButton=root.find(SELECTORS_NEXT_BUTTON),lastButton=root.find(SELECTORS_LAST_BUTTON);nextButton.removeClass("disabled"),nextButton.removeAttr("aria-disabled"),lastButton.removeClass("disabled"),lastButton.removeAttr("aria-disabled")},disablePreviousControlButtons=function(root){var previousButton=root.find(SELECTORS_PREVIOUS_BUTTON),firstButton=root.find(SELECTORS_FIRST_BUTTON);previousButton.addClass("disabled"),previousButton.attr("aria-disabled",!0),firstButton.addClass("disabled"),firstButton.attr("aria-disabled",!0)},adjustPagingBarSize=function(root){var activePageNumber=getActivePageNumber(root),lastPageNumber=getLastPageNumber(root),dotsButtons=root.find(SELECTORS_DOTS_BUTTONS),beginningDotsButton=root.find(SELECTORS_BEGINNING_DOTS_BUTTON),endingDotsButton=root.find(SELECTORS_ENDING_DOTS_BUTTON),pages=root.find(SELECTORS_PAGE),barSize=parseInt(root.attr("data-bar-size"),10);if(barSize&&lastPageNumber>barSize){var minpage=Math.max(activePageNumber-Math.round(barSize/2),1),maxpage=minpage+barSize-1;maxpage>=lastPageNumber&&(minpage=(maxpage=lastPageNumber)-barSize+1),minpage>1?(show(beginningDotsButton),minpage++):hide(beginningDotsButton),maxpage<lastPageNumber?(show(endingDotsButton),maxpage--):hide(endingDotsButton),dotsButtons.addClass("disabled"),dotsButtons.attr("aria-disabled",!0),hide(pages),pages.each((function(index,page){page=$(page),index+1>=minpage&&index+1<=maxpage&&show(page)}))}else hide(dotsButtons)},enablePreviousControlButtons=function(root){var previousButton=root.find(SELECTORS_PREVIOUS_BUTTON),firstButton=root.find(SELECTORS_FIRST_BUTTON);previousButton.removeClass("disabled"),previousButton.removeAttr("aria-disabled"),firstButton.removeClass("disabled"),firstButton.removeAttr("aria-disabled")},showPage=function(root,pageNumber,id){var pendingPromise=new Pending("core/paged_content_paging_bar:showPage"),lastPageNumber=getLastPageNumber(root),isSamePage=pageNumber==getActivePageNumber(root),limit=function(root){return parseInt(root.attr("data-items-per-page"),10)}(root),offset=(pageNumber-1)*limit;if(!isSamePage){root.find(SELECTORS_PAGE_ITEM).removeClass("active").removeAttr("aria-current");var page=getPageByNumber(root,pageNumber);page.addClass("active"),page.attr("aria-current",!0),setActivePageNumber(root,pageNumber),adjustPagingBarSize(root)}lastPageNumber&&pageNumber>=lastPageNumber?disableNextControlButtons(root):enableNextControlButtons(root),pageNumber>1?enablePreviousControlButtons(root):disablePreviousControlButtons(root),function(root){var pageAriaLabelComponents=function(root){return root.attr("data-aria-label-components-pagination-item").split(",").map((function(component){return component.trim()}))}(root),activePageAriaLabelComponents=function(root){return root.attr("data-aria-label-components-pagination-active-item").split(",").map((function(component){return component.trim()}))}(root),activePageNumber=getActivePageNumber(root),pageItems=root.find(SELECTORS_PAGE_ITEM),stringRequests=pageItems.map((function(index,page){page=$(page);var pageNumber=getPageNumber(root,page);return pageNumber===activePageNumber?{key:activePageAriaLabelComponents[0],component:activePageAriaLabelComponents[1],param:pageNumber}:{key:pageAriaLabelComponents[0],component:pageAriaLabelComponents[1],param:pageNumber}}));Str.get_strings(stringRequests).then((function(strings){return pageItems.each((function(index,page){page=$(page);var string=strings[index];page.attr("aria-label",string),page.find(SELECTORS_PAGE_LINK).attr("aria-label",string)})),strings})).catch((function(){}))}(root),PubSub.publish(id+PagedContentEvents.SHOW_PAGES,[{pageNumber:pageNumber,limit:limit,offset:offset}]),pendingPromise.resolve()};return{init:function(root,id){var pages=(root=$(root)).find(SELECTORS_PAGE);if(function(root,items){var lastPageNumber=0;setActivePageNumber(root,0),items.each((function(index,item){var pageNumber=index+1;(item=$(item)).attr("data-page-number",pageNumber),lastPageNumber++,item.hasClass("active")&&setActivePageNumber(root,pageNumber)})),setLastPageNumber(root,lastPageNumber)}(root,pages),function(root,id){var ignoreControlWhileLoading=root.attr("data-ignore-control-while-loading"),loading=!1;""==ignoreControlWhileLoading&&(ignoreControlWhileLoading=!0),CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_PAGE_ITEM,(function(e,data){if(data.originalEvent.preventDefault(),data.originalEvent.stopPropagation(),!ignoreControlWhileLoading||!loading){var page=$(e.target).closest(SELECTORS_PAGE_ITEM);if(!page.hasClass("disabled")){var pageNumber=getPageNumber(root,page);showPage(root,pageNumber,id),loading=!0}}})),PubSub.subscribe(id+PagedContentEvents.ALL_ITEMS_LOADED,(function(pageNumber){loading=!1;var currentLastPage=getLastPageNumber(root);(!currentLastPage||pageNumber<currentLastPage)&&setLastPageNumber(root,pageNumber),1===pageNumber&&root.attr("data-hide-control-on-single-page")?(hide(root),disableNextControlButtons(root),disablePreviousControlButtons(root)):(show(root),disableNextControlButtons(root))})),PubSub.subscribe(id+PagedContentEvents.PAGES_SHOWN,(function(){loading=!1})),PubSub.subscribe(id+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT,(function(limit){!function(root,limit){root.attr("data-items-per-page",limit)}(root,limit),setLastPageNumber(root,0),setActivePageNumber(root,0),show(root),showPage(root,1,id)}))}(root,id),function(root){var number=getActivePageNumber(root);return!isNaN(number)&&0!=number}(root)){var activePageNumber=getActivePageNumber(root);getPageByNumber(root,activePageNumber).click(),1==activePageNumber&&disablePreviousControlButtons(root)}else(function(root){return root.find(SELECTORS_NEXT_BUTTON)})(root).click();adjustPagingBarSize(root)},disableNextControlButtons:disableNextControlButtons,enableNextControlButtons:enableNextControlButtons,disablePreviousControlButtons:disablePreviousControlButtons,enablePreviousControlButtons:enablePreviousControlButtons,showPage:showPage,rootSelector:'[data-region="paging-bar"]'}}));
/**
 * Competency rule points module.
 *
 * @package    core
 * @copyright  2017 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/icon_system_fontawesome",["core/icon_system","jquery","core/ajax","core/mustache","core/localstorage","core/url"],(function(IconSystem,$,Ajax,Mustache,LocalStorage,Url){var staticMap=null,fetchMap=null,IconSystemFontawesome=function(){IconSystem.apply(this,arguments)};return(IconSystemFontawesome.prototype=Object.create(IconSystem.prototype)).init=function(){var currTheme=M.cfg.theme;if(staticMap)return $.when(this);var map=LocalStorage.get("core_iconsystem/theme/"+currTheme+"/core/iconmap-fontawesome");return map&&(map=JSON.parse(map)),map?(staticMap=map,$.when(this)):(null===fetchMap&&(fetchMap=Ajax.call([{methodname:"core_output_load_fontawesome_icon_system_map",args:{themename:M.cfg.theme}}],!0,!1,!1,0,M.cfg.themerev)[0]),fetchMap.then(function(map){return staticMap={},$.each(map,(function(index,value){staticMap[value.component+"/"+value.pix]=value.to})),LocalStorage.set("core_iconsystem/theme/"+currTheme+"/core/iconmap-fontawesome",JSON.stringify(staticMap)),this}.bind(this)))},IconSystemFontawesome.prototype.renderIcon=function(key,component,title,template){var mappedIcon=staticMap[component+"/"+key],unmappedIcon=!1;void 0===mappedIcon&&(unmappedIcon={attributes:[{name:"src",value:Url.imageUrl(key,component)},{name:"alt",value:title},{name:"title",value:title}]});var context={key:mappedIcon,title:title,alt:title,unmappedIcon:unmappedIcon};return void 0!==title&&""!==title||(context["aria-hidden"]=!0),Mustache.render(template,context).trim()},IconSystemFontawesome.prototype.getTemplateName=function(){return"core/pix_icon_fontawesome"},IconSystemFontawesome}));
/**
 * Chart builder.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/chart_builder",["jquery"],(function($){return{make:function(data){var deferred=$.Deferred();return require(["core/chart_"+data.type],(function(Klass){var instance=Klass.prototype.create(Klass,data);deferred.resolve(instance)})),deferred.promise()}}}));
/**
 * Course selector adaptor for auto-complete form element.
 *
 * @module     core/form-cohort-selector
 * @class      form-cohort-selector
 * @package    core
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("core/form-cohort-selector",["core/ajax","jquery"],(function(ajax,$){return{processResults:function(selector,data){var results=[],i=0,excludelist=String($(selector).data("exclude")).split(",");for(i=0;i<data.cohorts.length;i++)-1===excludelist.indexOf(String(data.cohorts[i].id))&&results.push({value:data.cohorts[i].id,label:data.cohorts[i].name});return results},transport:function(selector,query,success,failure){var promises;void 0===query&&(query="");var calls=[{methodname:"core_cohort_search_cohorts",args:{query:query,includes:"parents",limitfrom:0,limitnum:100,context:{contextid:$(selector).data("contextid")}}}];promises=ajax.call(calls),$.when.apply($.when,promises).done((function(data){success(data)})).fail(failure)}}}));
define("core/tooltip",["jquery"],(function($){var Tooltip=function(selector){this._regionSelector=selector,$(this._regionSelector).each(function(index,element){var tooltipId=$(element).attr("aria-describedby");if(tooltipId){var tooltipele=document.getElementById(tooltipId);if(tooltipele)"tooltip"==$(tooltipele).attr("role")&&($(tooltipele).hide(),$(element).attr("tabindex","0")),$(element).on("focus",this._handleFocus.bind(this)),$(element).on("mouseover",this._handleMouseOver.bind(this)),$(element).on("mouseout",this._handleMouseOut.bind(this)),$(element).on("blur",this._handleBlur.bind(this)),$(element).on("keydown",this._handleKeyDown.bind(this))}}.bind(this))};return Tooltip.prototype._regionSelector=null,Tooltip.prototype._showTooltip=function(e){var triggerElement=$(e.target),tooltipId=triggerElement.attr("aria-describedby");if(tooltipId){var tooltipele=$(document.getElementById(tooltipId));if(tooltipele.show(),tooltipele.attr("aria-hidden","false"),!tooltipele.is(".tooltip")){var inner=$('<div class="tooltip-inner"></div>');inner.append(tooltipele.contents()),tooltipele.append(inner),tooltipele.addClass("tooltip"),tooltipele.addClass("bottom"),tooltipele.append('<div class="tooltip-arrow"></div>')}var pos=triggerElement.offset();pos.top+=triggerElement.height()+10,$(tooltipele).offset(pos)}},Tooltip.prototype._hideTooltip=function(e){var tooltipId=$(e.target).attr("aria-describedby");if(tooltipId){var tooltipele=document.getElementById(tooltipId);$(tooltipele).hide(),$(tooltipele).attr("aria-hidden","true")}},Tooltip.prototype._handleFocus=function(e){this._showTooltip(e)},Tooltip.prototype._handleKeyDown=function(e){27==e.which&&this._hideTooltip(e)},Tooltip.prototype._handleMouseOver=function(e){this._showTooltip(e)},Tooltip.prototype._handleMouseOut=function(e){$(e.target).is(":focus")||this._hideTooltip(e)},Tooltip.prototype._handleBlur=function(e){this._hideTooltip(e)},Tooltip}));
/**
 * Module for text truncation.
 *
 * Implementation provided by Pathable (thanks!).
 * See: https://github.com/pathable/truncate
 *
 * @module     core/truncate
 * @package    core
 * @class      truncate
 * @copyright  2017 Pathable
 *             2017 Mathias Bynens
 *             2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/truncate",["jquery"],(function($){var chop=/(\s*\S+|\s)$/,start=/^(\S*)/,space=/\s/,charLengthAt=function(text,position){var string=String(text),size=string.length,index=position?Number(position):0;if(index!=index&&(index=0),index<=-1||index>=size)return"";index|=0;var cuSecond,cuFirst=string.charCodeAt(index),nextIndex=index+1,len=1;return cuFirst>=55296&&cuFirst<=56319&&size>nextIndex&&(cuSecond=string.charCodeAt(nextIndex))>=56320&&cuSecond<=57343&&(len=2),len},lengthMultiByte=function(text){for(var count=0,i=0;i<text.length;i+=charLengthAt(text,i))count++;return count},getSliceLength=function(text,amount){if(!text.length)return 0;var length=0,count=0;do{length+=charLengthAt(text,length),count++}while(length<text.length&&count<amount);return length};return $.truncate=function(html,options){return $("<div></div>").append(html).truncate(options).html()},$.fn.truncate=function(options){isNaN(parseFloat(options))||(options={length:options});var o=$.extend({},$.truncate.defaults,options);return this.each((function(){var self=$(this);o.noBreaks&&self.find("br").replaceWith(" ");var ellipsisLength=o.ellipsis.length,text=self.text(),textLength=lengthMultiByte(text),excess=textLength-o.length+ellipsisLength;if(!(textLength<o.length)){if(o.stripTags&&self.text(text),o.words&&excess>0){var sliced=text.slice(0,getSliceLength(text,o.length-ellipsisLength)+1),replaced=sliced.replace(chop,""),truncated=lengthMultiByte(replaced),oneWord=!sliced.match(space);excess=o.keepFirstWord&&0===truncated?textLength-lengthMultiByte(start.exec(text)[0])-ellipsisLength:oneWord&&0===truncated?textLength-o.length+ellipsisLength:textLength-truncated-1}excess>textLength&&(excess=textLength-o.length),excess<0||!excess&&!o.truncated||$.each(self.contents().get().reverse(),(function(i,el){var $el=$(el),text=$el.text(),length=lengthMultiByte(text);if(length<=excess)return o.truncated=!0,excess-=length,void $el.remove();if(3===el.nodeType){var splitAmount=length-excess;return splitAmount=splitAmount>=0?getSliceLength(text,splitAmount):0,$(el.splitText(splitAmount)).replaceWith(o.ellipsis),!1}return $el.truncate($.extend(o,{length:length-excess+ellipsisLength})),!1}))}}))},$.truncate.defaults={stripTags:!1,words:!1,keepFirstWord:!1,noBreaks:!1,length:1/0,ellipsis:"…"},{truncate:$.truncate}}));
/**
 * Chart.js loader.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/chartjs",["core/chartjs-lazy"],(function(ChartJS){return ChartJS}));
/**
 * Poll the server to keep the session alive.
 *
 * @module     core/network
 * @package    core
 * @copyright  2019 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/network",["jquery","core/ajax","core/config","core/notification","core/str"],(function($,Ajax,Config,Notification,Str){var started=!1,warningDisplayed=!1,keepAliveFrequency=0,requestTimeout=0,keepAliveMessage=!1,sessionTimeout=!1,checkFrequency=1e3*Math.min(Config.sessiontimeout/10,600),warningLimit=2*checkFrequency,timeoutSessionExpired=function(){sessionTimeout=!0},touchSession=function touchSession(){return sessionTimeout?Str.get_strings([{key:"sessionexpired",component:"error"},{key:"sessionerroruser",component:"error"}]).then((function(strings){return Notification.alert(strings[0],strings[1]),!0})).fail(Notification.exception):Ajax.call([{methodname:"core_session_touch",args:{}}],!0,!0,!1,requestTimeout)[0].then((function(){return keepAliveFrequency>0&&setTimeout(touchSession,keepAliveFrequency),!0})).fail((function(){Notification.alert("",keepAliveMessage)}))},checkSession=function checkSession(){return sessionTimeout=!1,Ajax.call([{methodname:"core_session_time_remaining",args:{}}],!0,!0,!0)[0].then((function(args){return!(args.userid<=0)&&(args.timeremaining<0?Str.get_strings([{key:"sessionexpired",component:"error"},{key:"sessionerroruser",component:"error"}]).then((function(strings){return Notification.alert(strings[0],strings[1]),!0})).fail(Notification.exception):1e3*args.timeremaining<warningLimit&&!warningDisplayed?(setTimeout(timeoutSessionExpired,1e3*args.timeremaining),warningDisplayed=!0,Str.get_strings([{key:"norecentactivity",component:"moodle"},{key:"sessiontimeoutsoon",component:"moodle"},{key:"extendsession",component:"moodle"},{key:"cancel",component:"moodle"}]).then((function(strings){return Notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){return touchSession(),warningDisplayed=!1,setTimeout(checkSession,5*checkFrequency),!0}),(function(){warningDisplayed=!1,setTimeout(checkSession,checkFrequency)})),!0})).fail(Notification.exception)):setTimeout(checkSession,checkFrequency),!0)}))},start=function(){keepAliveFrequency>0?setTimeout(touchSession,keepAliveFrequency):setTimeout(checkSession,5*checkFrequency)};return{keepalive:function(freq,timeout,message){started||(started=!0,keepAliveFrequency=1e3*freq,keepAliveMessage=message,requestTimeout=1e3*timeout,start())},init:function(){started||(started=!0,start())}}}));
/**
 * Chart bar.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_bar
 */
define("core/chart_bar",["core/chart_base"],(function(Base){function Bar(){Base.prototype.constructor.apply(this,arguments)}return Bar.prototype=Object.create(Base.prototype),Bar.prototype._horizontal=!1,Bar.prototype._stacked=!1,Bar.prototype.TYPE="bar",Bar.prototype.create=function(Klass,data){var chart=Base.prototype.create.apply(this,arguments);return chart.setHorizontal(data.horizontal),chart.setStacked(data.stacked),chart},Bar.prototype._setDefaults=function(){Base.prototype._setDefaults.apply(this,arguments);var axis=this.getYAxis(0,!0);axis.setMin(0)},Bar.prototype.getHorizontal=function(){return this._horizontal},Bar.prototype.getStacked=function(){return this._stacked},Bar.prototype.setHorizontal=function(horizontal){var axis=this.getXAxis(0,!0);null===axis.getMin()&&axis.setMin(0),this._horizontal=Boolean(horizontal)},Bar.prototype.setStacked=function(stacked){this._stacked=Boolean(stacked)},Bar}));
/**
 * AJAX helper for the tag management page.
 *
 * @module     core/tag
 * @package    core_tag
 * @copyright  2015 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.0
 */
define("core/tag",["jquery","core/ajax","core/templates","core/notification","core/str","core/modal_factory","core/modal_events","core/pending"],(function($,ajax,templates,notification,str,ModalFactory,ModalEvents,Pending){return{initTagindexPage:function(){$("body").delegate(".tagarea[data-ta] a[data-quickload=1]","click",(function(e){var pendingPromise=new Pending("core/tag:initTagindexPage");e.preventDefault();var target=$(this),query=target[0].search.replace(/^\?/,""),tagarea=target.closest(".tagarea[data-ta]"),args=query.split("&").reduce((function(s,c){var t=c.split("=");return s[t[0]]=decodeURIComponent(t[1]),s}),{});ajax.call([{methodname:"core_tag_get_tagindex",args:{tagindex:args}}])[0].then((function(data){return templates.render("core_tag/index",data)})).then((function(html,js){templates.replaceNode(tagarea,html,js)})).always(pendingPromise.resolve).catch(notification.exception)}))},initManagePage:function(){$("body").on("updated","[data-inplaceeditable]",(function(e){var pendingPromise=new Pending("core/tag:initManagePage");if(str.get_strings([{key:"selecttag",component:"core_tag"},{key:"now",component:"core"}]).then((function(result){$('label[for="tagselect'+e.ajaxreturn.itemid+'"]').html(result[0]),$(e.target).closest("tr").find("td.col-timemodified").html(result[1])})).always(pendingPromise.resolve).catch(notification.exception),"tagflag"===e.ajaxreturn.itemtype){var row=$(e.target).closest("tr");"0"===e.ajaxreturn.value?row.removeClass("flagged-tag"):row.addClass("flagged-tag")}})),$(".tag-management-table").delegate("a.tagdelete","click",(function(e){var pendingPromise=new Pending("core/tag:tagdelete");e.preventDefault();var href=$(this).attr("href");str.get_strings([{key:"delete",component:"core"},{key:"confirmdeletetag",component:"tag"},{key:"yes",component:"core"},{key:"no",component:"core"}]).then((function(s){return notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location.href=href}))})).always(pendingPromise.resolve).catch(notification.exception)})),$("#tag-management-delete").click((function(e){var form=$(this).closest("form").get(0);if($(form).find("input[type=checkbox]:checked").length){var pendingPromise=new Pending("core/tag:tag-management-delete"),tempElement=$("<input type='hidden'/>").attr("name",this.name);e.preventDefault(),str.get_strings([{key:"delete",component:"core"},{key:"confirmdeletetags",component:"tag"},{key:"yes",component:"core"},{key:"no",component:"core"}]).then((function(s){return notification.confirm(s[0],s[1],s[2],s[3],(function(){tempElement.appendTo(form),form.submit()}))})).always(pendingPromise.resolve).catch(notification.exception)}})),$("#tag-management-combine").click((function(e){var pendingPromise=new Pending("core/tag:tag-management-combine");e.preventDefault();var form=$(this).closest("form").get(0),tags=$(form).find("input[type=checkbox]:checked");if(tags.length<=1)str.get_strings([{key:"combineselected",component:"tag"},{key:"selectmultipletags",component:"tag"},{key:"ok"}]).then((function(s){return notification.alert(s[0],s[1],s[2])})).always(pendingPromise.resolve).catch(notification.exception);else{var tempElement=$("<input type='hidden'/>").attr("name",this.name),saveButtonText="",tagOptions=[];tags.each((function(){var tagid=$(this).val(),tagname=$(".inplaceeditable[data-itemtype=tagname][data-itemid="+tagid+"]").attr("data-value");tagOptions.push({id:tagid,name:tagname})})),str.get_strings([{key:"combineselected",component:"tag"},{key:"continue",component:"core"}]).then((function(langStrings){var modalTitle=langStrings[0];saveButtonText=langStrings[1];var templateContext={tags:tagOptions};return ModalFactory.create({title:modalTitle,body:templates.render("core_tag/combine_tags",templateContext),type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){return modal.setSaveButtonText(saveButtonText),modal})).then((function(modal){modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),tempElement.appendTo(form);var maintag=$("input[name=maintag]:checked","#combinetags_form").val();$("<input type='hidden'/>").attr("name","maintag").attr("value",maintag).appendTo(form),form.submit()})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),$("#combinetags_form input[type=radio]").first().focus().prop("checked",!0)})).always(pendingPromise.resolve).catch(notification.exception)}})),$("body").on("updatefailed","[data-inplaceeditable][data-itemtype=tagname]",(function(e){var exception=e.exception,newvalue=e.newvalue,tagid=$(e.target).attr("data-itemid");if("namesalreadybeeingused"===exception.errorcode){var pendingPromise=new Pending("core/tag:updatefailed");e.preventDefault(),str.get_strings([{key:"confirm",component:"core"},{key:"nameuseddocombine",component:"tag"},{key:"yes",component:"core"},{key:"cancel",component:"core"}]).then((function(s){return notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location.href=window.location.href+"&newname="+encodeURIComponent(newvalue)+"&tagid="+encodeURIComponent(tagid)+"&action=renamecombine&sesskey="+M.cfg.sesskey}))})).always(pendingPromise.resolve).catch(notification.exception)}})),$("body").on("click","a[data-action=addstandardtag]",(function(e){var pendingPromise=new Pending("core/tag:addstandardtag");return e.preventDefault(),ModalFactory.create({title:str.get_string("addotags","tag"),body:templates.render("core_tag/add_tags",{actionurl:window.location.href,sesskey:M.cfg.sesskey}),type:ModalFactory.types.SAVE_CANCEL}).then((function(modal){modal.setSaveButtonText(str.get_string("continue","core")),modal.getRoot().on(ModalEvents.save,(function(e){var tagsInput=$(e.currentTarget).find("#id_tagslist"),name=tagsInput.val().trim();tagsInput.val(name);var tagsForm=$("#addtags_form");return tagsForm.on("submit",(function(e){var form=$("#addtags_form");!1===form[0].checkValidity()&&(e.preventDefault(),e.stopPropagation()),form.addClass("was-validated"),$('[data-region="tagslistinput"]').addClass("error");var errorMessage=$("#id_tagslist_error_message");errorMessage.removeAttr("hidden"),errorMessage.addClass("help-block")})),tagsForm.submit(),!1})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()})).always(pendingPromise.resolve).catch(notification.exception)}))},initManageCollectionsPage:function(){$("body").on("updated","[data-inplaceeditable]",(function(e){var areaid,collid,pendingPromise=new Pending("core/tag:initManageCollectionsPage-updated"),ajaxreturn=e.ajaxreturn;"core_tag"===ajaxreturn.component&&"tagareaenable"===ajaxreturn.itemtype&&(areaid=$(this).attr("data-itemid"),$(".tag-collections-table ul[data-collectionid] li[data-areaid="+areaid+"]").hide(),"1"===ajaxreturn.value?($(this).closest("tr").removeClass("dimmed_text"),collid=$(this).closest("tr").find('[data-itemtype="tagareacollection"]').attr("data-value"),$(".tag-collections-table ul[data-collectionid="+collid+"] li[data-areaid="+areaid+"]").show()):$(this).closest("tr").addClass("dimmed_text")),"core_tag"===ajaxreturn.component&&"tagareacollection"===ajaxreturn.itemtype&&(areaid=$(this).attr("data-itemid"),$(".tag-collections-table ul[data-collectionid] li[data-areaid="+areaid+"]").hide(),collid=$(this).attr("data-value"),"1"===$(this).closest("tr").find('[data-itemtype="tagareaenable"]').attr("data-value")&&$(".tag-collections-table ul[data-collectionid="+collid+"] li[data-areaid="+areaid+"]").show()),pendingPromise.resolve()})),$("body").on("click",".addtagcoll > a",(function(e){var pendingPromise=new Pending("core/tag:initManageCollectionsPage-addtagcoll");e.preventDefault();var href=$(this).attr("data-url"),saveButtonText="";str.get_strings([{key:"addtagcoll",component:"tag"},{key:"create",component:"core"}]).then((function(langStrings){var modalTitle=langStrings[0];saveButtonText=langStrings[1];var templateContext={actionurl:href,sesskey:M.cfg.sesskey};return ModalFactory.create({title:modalTitle,body:templates.render("core_tag/add_tag_collection",templateContext),type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){return modal.setSaveButtonText(saveButtonText),modal.getRoot().on(ModalEvents.save,(function(e){var collectionInput=$(e.currentTarget).find("#addtagcoll_name"),name=collectionInput.val().trim();collectionInput.val(name);var form=$("#addtagcoll_form");return form.on("submit",(function(e){!1===form[0].checkValidity()&&(e.preventDefault(),e.stopPropagation()),form.addClass("was-validated"),$('[data-region="addtagcoll_nameinput"]').addClass("error");var errorMessage=$("#id_addtagcoll_name_error_message");errorMessage.removeAttr("hidden"),errorMessage.addClass("help-block")})),form.submit(),!1})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),modal})).always(pendingPromise.resolve).catch(notification.exception)})),$("body").on("click",".tag-collections-table .action_delete",(function(e){var pendingPromise=new Pending("core/tag:initManageCollectionsPage-action_delete");e.preventDefault();var href=$(this).attr("data-url")+"&sesskey="+M.cfg.sesskey;str.get_strings([{key:"delete"},{key:"suredeletecoll",component:"tag",param:$(this).attr("data-collname")},{key:"yes"},{key:"no"}]).then((function(s){return notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location.href=href}))})).always(pendingPromise.resolve).catch(notification.exception)}))}}}));
define("core/str",["exports","jquery","core/ajax","core/localstorage"],(function(_exports,_jquery,_ajax,_localstorage){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.get_strings=_exports.get_string=_exports.cache_strings=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_localstorage=_interopRequireDefault(_localstorage);var promiseCache=[];_exports.get_string=function(key,component,param,lang){return get_strings([{key:key,component:component,param:param,lang:lang}]).then((function(results){return results[0]}))};var get_strings=function(requests){var requestData=[],pageLang=(0,_jquery.default)("html").attr("lang").replace(/-/g,"_"),stringPromises=requests.map((function(request){var cacheKey=function(_ref){var key=_ref.key,component=_ref.component,_ref$lang=_ref.lang,lang=void 0===_ref$lang?pageLang:_ref$lang;return component||(component="core"),"core_str/".concat(key,"/").concat(component,"/").concat(lang)}(request),component=request.component,key=request.key,param=request.param,_request$lang=request.lang,lang=void 0===_request$lang?pageLang:_request$lang,buildReturn=function(promise){return promiseCache[cacheKey]=promise,promise};if(component in M.str&&key in M.str[component])return buildReturn(new Promise((function(resolve){resolve(M.util.get_string(key,component,param,lang))})));var cached=_localstorage.default.get(cacheKey);return cached?(M.str[component]=_objectSpread(_objectSpread({},M.str[component]),{},_defineProperty({},key,cached)),buildReturn(new Promise((function(resolve){resolve(M.util.get_string(key,component,param,lang))})))):cacheKey in promiseCache?buildReturn(promiseCache[cacheKey]).then((function(){return M.util.get_string(key,component,param,lang)})):buildReturn(new Promise((function(resolve,reject){requestData.push({methodname:"core_get_string",args:{stringid:key,stringparams:[],component:component,lang:lang},done:function(str){M.str[component]=_objectSpread(_objectSpread({},M.str[component]),{},_defineProperty({},key,str)),_localstorage.default.set(cacheKey,str),resolve(M.util.get_string(key,component,param,lang))},fail:reject})})))}));return requestData.length&&_ajax.default.call(requestData,!0,!1,!1,0,M.cfg.langrev),_jquery.default.when.apply(_jquery.default,stringPromises).then((function(){for(var _len=arguments.length,strings=new Array(_len),_key=0;_key<_len;_key++)strings[_key]=arguments[_key];return strings}))};_exports.get_strings=get_strings;_exports.cache_strings=function(strings){var defaultLang=(0,_jquery.default)("html").attr("lang").replace(/-/g,"_");strings.forEach((function(_ref2){var key=_ref2.key,component=_ref2.component,value=_ref2.value,_ref2$lang=_ref2.lang,cacheKey=["core_str",key,component,void 0===_ref2$lang?defaultLang:_ref2$lang].join("/");component in M.str&&key in M.str[component]||(component in M.str||(M.str[component]={}),M.str[component][key]=value),_localstorage.default.get(cacheKey)||_localstorage.default.set(cacheKey,value),cacheKey in promiseCache||(promiseCache[cacheKey]=_jquery.default.Deferred().resolve(value).promise())}))}}));
/**
 * Chart line.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_line
 */
define("core/chart_line",["core/chart_base"],(function(Base){function Line(){Base.prototype.constructor.apply(this,arguments)}return Line.prototype=Object.create(Base.prototype),Line.prototype.TYPE="line",Line.prototype._smooth=!1,Line.prototype.create=function(Klass,data){var chart=Base.prototype.create.apply(this,arguments);return chart.setSmooth(data.smooth),chart},Line.prototype.getSmooth=function(){return this._smooth},Line.prototype.setSmooth=function(smooth){this._smooth=Boolean(smooth)},Line}));
/**
 * Provide global helper code to enhance page elements.
 *
 * @module     core/page_global
 * @package    core
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/page_global",["jquery","core/custom_interaction_events","core/str","core/network"],(function($,CustomEvents,Str,Network){return{init:function(){var body;body=$("body"),CustomEvents.define(body,[CustomEvents.events.activate]),body.on(CustomEvents.events.activate,"[data-show-active-item]",(function(e){var option=$(e.target).closest(".dropdown-item"),menuContainer=option.closest("[data-show-active-item]");if(option.hasClass("dropdown-item")&&!option.hasClass("active")){var dropdownItems=menuContainer.find(".dropdown-item");dropdownItems.removeClass("active"),dropdownItems.removeAttr("aria-current"),menuContainer.attr("data-skip-active-class")||option.addClass("active"),option.attr("aria-current",!0);var activeOptionText=option.text(),dropdownToggle=menuContainer.parent().find('[data-toggle="dropdown"]'),dropdownToggleText=dropdownToggle.find("[data-active-item-text]");dropdownToggleText.length?dropdownToggleText.html(activeOptionText):dropdownToggle.html(activeOptionText);var activeItemAriaLabelComponent=menuContainer.attr("data-active-item-button-aria-label-components");if(activeItemAriaLabelComponent){var strParams=activeItemAriaLabelComponent.split(",");strParams.push(activeOptionText),Str.get_string(strParams[0].trim(),strParams[1].trim(),strParams[2].trim()).then((function(string){return dropdownToggle.attr("aria-label",string),string})).catch((function(){return!1}))}}})),Network.init()}}}));
/**
 * Chart output base.
 *
 * This takes a chart object and draws it.
 *
 * @package    core
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_output_base
 */
define("core/chart_output_base",["jquery"],(function($){function Base(node,chart){this._node=$(node),this._chart=chart}return Base.prototype.update=function(){throw new Error("Not supported.")},Base}));
/**
 * Javascript to load and render a paged content section.
 *
 * @module     core/paged_content
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content",["jquery","core/paged_content_pages","core/paged_content_paging_bar","core/paged_content_paging_bar_limit_selector","core/paged_content_paging_dropdown"],(function($,Pages,PagingBar,PagingBarLimitSelector,Dropdown){return{init:function(root,renderPagesContentCallback,namespaceOverride){var pagesContainer=(root=$(root)).find(Pages.rootSelector),pagingBarContainer=root.find(PagingBar.rootSelector),dropdownContainer=root.find(Dropdown.rootSelector),pagingBarLimitSelectorContainer=root.find(PagingBarLimitSelector.rootSelector),id=root.attr("id");namespaceOverride&&(id=namespaceOverride),Pages.init(pagesContainer,id,renderPagesContentCallback),pagingBarContainer.length&&PagingBar.init(pagingBarContainer,id),pagingBarLimitSelectorContainer.length&&PagingBarLimitSelector.init(pagingBarLimitSelectorContainer,id),dropdownContainer.length&&Dropdown.init(dropdownContainer,id)},rootSelector:'[data-region="paged-content-container"]'}}));
/**
 * A way to call HTML fragments to be inserted as required via JavaScript.
 *
 * @module     core/fragment
 * @class      fragment
 * @package    core
 * @copyright  2016 Adrian Greeve <adrian@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("core/fragment",["jquery","core/ajax"],(function($,ajax){return{loadFragment:function(component,callback,contextid,params){var promise=$.Deferred();return function(component,callback,contextid,params){var formattedparams=[];for(var index in params)formattedparams.push({name:index,value:params[index]});return ajax.call([{methodname:"core_get_fragment",args:{component:component,callback:callback,contextid:contextid,args:formattedparams}}])[0]}(component,callback,contextid,params).then((function(data){var jsNodes=$(data.javascript),allScript="";jsNodes.each((function(index,scriptNode){var tagName=(scriptNode=$(scriptNode)).prop("tagName");if(tagName&&"script"==tagName.toLowerCase())if(scriptNode.attr("src")){var exists=!1;$("script").each((function(index,s){return $(s).attr("src")==scriptNode.attr("src")&&(exists=!0),!exists})),exists||(allScript+=" { ",allScript+=' node = document.createElement("script"); ',allScript+=' node.type = "text/javascript"; ',allScript+=' node.src = decodeURI("'+encodeURI(scriptNode.attr("src"))+'"); ',allScript+=' document.getElementsByTagName("head")[0].appendChild(node); ',allScript+=" } ")}else allScript+=" "+scriptNode.text()})),promise.resolve(data.html,allScript)})).fail((function(ex){promise.reject(ex)})),promise.promise()}}}));
/**
 * Contain the logic for the loading icon.
 *
 * @module     core/loading_icon
 * @class      loading_icon
 * @package    core
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/loadingicon",["jquery","core/templates"],(function($,Templates){var TEMPLATES_LOADING="core/loading",getIcon=function(){return Templates.render(TEMPLATES_LOADING,{})},addIconToContainerRemoveOnCompletion=function(container,loadingIconPromise){return getIcon().then((function(html){var loadingIcon=$(html).hide();return $(container).append(loadingIcon),loadingIcon.fadeIn(150),$.when(loadingIcon.promise(),loadingIconPromise)})).then((function(loadingIcon){return loadingIcon.fadeOut(100).promise()})).then((function(loadingIcon){loadingIcon.remove()}))};return{getIcon:getIcon,addIconToContainer:function(container){return getIcon().then((function(html){var loadingIcon=$(html).hide();return $(container).append(loadingIcon),loadingIcon.fadeIn(150),loadingIcon}))},addIconToContainerWithPromise:function(container){var loadingIconPromise=$.Deferred();return addIconToContainerRemoveOnCompletion(container,loadingIconPromise),loadingIconPromise},addIconToContainerRemoveOnCompletion:addIconToContainerRemoveOnCompletion}}));
/**
 * This module updates the UI during an asynchronous
 * backup or restore process.
 *
 * @module     backup/util/async_backup
 * @package    core
 * @copyright  2018 Matt Porritt <mattp@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.7
 */
define("core_backup/async_backup",["jquery","core/ajax","core/str","core/notification","core/templates"],(function($,ajax,Str,notification,Templates){var backupid,contextid,restoreurl,typeid,backupintervalid,allbackupintervalid,allcopyintervalid,Asyncbackup={},checkdelay=15e3;function updateElement(backupid,type,percentage){var percentagewidth=Math.round(percentage)+"%",elementbar=document.querySelectorAll("[data-"+type+"id="+CSS.escape(backupid)+"]")[0],percentagetext=percentage.toFixed(2)+"%";elementbar.setAttribute("aria-valuenow",percentagewidth),elementbar.style.width=percentagewidth,elementbar.innerHTML=percentagetext}function updateInterval(intervalid,callback,value){return clearInterval(intervalid),setInterval(callback,value)}function updateProgressAll(progress){progress.forEach((function(element){var percentage=100*element.progress,backupid=element.backupid,type=element.operation,elementbar=document.querySelectorAll("[data-"+type+"id="+CSS.escape(backupid)+"]")[0];800==element.status?(elementbar.classList.add("bg-success"),updateElement(backupid,type,percentage)):900==element.status?(elementbar.classList.add("bg-danger"),elementbar.classList.add("complete"),elementbar.classList.remove("bg-success"),updateElement(backupid,type,100)):1e3==element.status&&(elementbar.classList.add("bg-success"),elementbar.classList.add("complete"),updateElement(backupid,type,100),"backup"==type?function(backupid){var statuscell=$("#"+backupid+"_bar").parent().parent(),tablerow=statuscell.parent(),cellsiblings=statuscell.siblings(),timecell=cellsiblings[1],timevalue=$(timecell).text(),filenamecell=cellsiblings[0],filename=$(filenamecell).text();ajax.call([{methodname:"core_backup_get_async_backup_links_backup",args:{filename:filename,contextid:contextid}}])[0].done((function(response){var context={filename:filename,time:timevalue,size:response.filesize,fileurl:response.fileurl,restoreurl:response.restoreurl};Templates.render("core/async_backup_progress_row",context).then((function(html,js){Templates.replaceNodeContents(tablerow,html,js)})).fail((function(){notification.exception(new Error("Failed to load table row"))}))}))}(backupid):function(backupid){var statuscell=$("#"+backupid+"_bar").parent().parent(),tablerow=statuscell.parent(),cellsiblings=statuscell.siblings(),coursecell=cellsiblings[0],timecell=cellsiblings[1],timevalue=$(timecell).text();ajax.call([{methodname:"core_backup_get_async_backup_links_restore",args:{backupid:backupid,contextid:contextid}}])[0].done((function(response){var context={resourcename:$(coursecell).text(),restoreurl:response.restoreurl,time:timevalue};Templates.render("core/async_restore_progress_row",context).then((function(html,js){Templates.replaceNodeContents(tablerow,html,js)})).fail((function(){notification.exception(new Error("Failed to load table row"))}))}))}(backupid))}))}function updateProgressCopy(progress){progress.forEach((function(element){var percentage=100*element.progress,backupid=element.backupid,type=element.operation,elementbar=document.querySelectorAll("[data-"+type+"id="+CSS.escape(backupid)+"]")[0];if("restore"==type){var restorecell=elementbar.closest("tr").children[3];Str.get_string("restore").then((function(content){restorecell.innerHTML=content})).catch((function(){notification.exception(new Error("Failed to load string: restore"))}))}800==element.status?(elementbar.classList.add("bg-success"),updateElement(backupid,type,percentage)):900==element.status?(elementbar.classList.add("bg-danger"),elementbar.classList.add("complete"),elementbar.classList.remove("bg-success"),updateElement(backupid,type,100)):1e3==element.status&&"restore"==type&&(elementbar.classList.add("bg-success"),elementbar.classList.add("complete"),updateElement(backupid,type,100),function(backupid){var elementbar=document.querySelectorAll("[data-restoreid="+CSS.escape(backupid)+"]")[0],restorecourse=elementbar.closest("tr").children[1],coursename=restorecourse.innerHTML,courselink=document.createElement("a"),elementbarparent=elementbar.closest("td"),operation=elementbarparent.previousElementSibling;Str.get_string("complete").then((function(content){operation.innerHTML=content})).catch((function(){notification.exception(new Error("Failed to load string: complete"))})),Templates.render("core/async_copy_complete_cell",{}).then((function(html,js){Templates.replaceNodeContents(elementbarparent,html,js)})).fail((function(){notification.exception(new Error("Failed to load table cell"))})),ajax.call([{methodname:"core_backup_get_async_backup_links_restore",args:{backupid:backupid,contextid:0}}])[0].done((function(response){courselink.setAttribute("href",response.restoreurl),courselink.innerHTML=coursename,restorecourse.innerHTML=null,restorecourse.appendChild(courselink)})).fail((function(){notification.exception(new Error("Failed to update table row"))}))}(backupid))}))}function getBackupProgress(){ajax.call([{methodname:"core_backup_get_async_backup_progress",args:{backupids:[backupid],contextid:contextid}}],!0,!0,!1,2e3)[0].done((function(response){!function(progress){var stringRequests,percentage=100*progress.progress,type="backup",elementbar=document.querySelectorAll("[data-backupid="+CSS.escape(backupid)+"]")[0],elementstatus=$("#"+backupid+"_status"),elementdetail=$("#"+backupid+"_detail"),elementbutton=$("#"+backupid+"_button");if(800==progress.status){elementbar.classList.add("bg-success"),updateElement(backupid,type,percentage);var strProcessing="async"+typeid+"processing";Str.get_string(strProcessing,"backup").then((function(title){elementstatus.text(title)})).catch((function(){notification.exception(new Error("Failed to load string: backup "+strProcessing))}))}else if(900==progress.status)elementbar.classList.add("bg-danger"),elementbar.classList.remove("bg-success"),updateElement(backupid,type,100),stringRequests=[{key:"async"+typeid+"error",component:"backup"},{key:"async"+typeid+"errordetail",component:"backup"}],Str.get_strings(stringRequests).then((function(strings){elementstatus.text(strings[0]),elementdetail.text(strings[1])})).catch((function(){notification.exception(new Error("Failed to load string"))})),$(".backup_progress").children("span").removeClass("backup_stage_current"),$(".backup_progress").children("span").last().addClass("backup_stage_current"),clearInterval(backupintervalid);else if(1e3==progress.status){elementbar.classList.add("bg-success"),updateElement(backupid,type,100);var strComplete="async"+typeid+"complete";Str.get_string(strComplete,"backup").then((function(title){elementstatus.text(title)})).catch((function(){notification.exception(new Error("Failed to load string: backup "+strComplete))})),"restore"==typeid?ajax.call([{methodname:"core_backup_get_async_backup_links_restore",args:{backupid:backupid,contextid:contextid}}])[0].done((function(response){var strButton="async"+typeid+"completebutton",stringRequests=[{key:"async"+typeid+"completedetail",component:"backup",param:response.restoreurl},{key:strButton,component:"backup"}];Str.get_strings(stringRequests).then((function(strings){elementdetail.html(strings[0]),elementbutton.text(strings[1]),elementbutton.attr("href",response.restoreurl)})).catch((function(){notification.exception(new Error("Failed to load string"))}))})):(stringRequests=[{key:"async"+typeid+"completedetail",component:"backup",param:restoreurl},{key:"async"+typeid+"completebutton",component:"backup"}],Str.get_strings(stringRequests).then((function(strings){elementdetail.html(strings[0]),elementbutton.text(strings[1]),elementbutton.attr("href",restoreurl)})).catch((function(){notification.exception(new Error("Failed to load string"))}))),$(".backup_progress").children("span").removeClass("backup_stage_current"),$(".backup_progress").children("span").last().addClass("backup_stage_current"),clearInterval(backupintervalid)}}(response[0]),checkdelay=15e3,backupintervalid=updateInterval(backupintervalid,getBackupProgress,15e3)})).fail((function(){backupintervalid=updateInterval(backupintervalid,getBackupProgress,checkdelay*=1.5)}))}function getAllBackupProgress(){var backupids=[];$(".progress").find(".progress-bar").not(".complete").each((function(){backupids.push(this.id.substring(0,32))})),backupids.length>0?ajax.call([{methodname:"core_backup_get_async_backup_progress",args:{backupids:backupids,contextid:contextid}}],!0,!0,!1,2e3)[0].done((function(response){updateProgressAll(response),checkdelay=15e3,allbackupintervalid=updateInterval(allbackupintervalid,getAllBackupProgress,15e3)})).fail((function(){allbackupintervalid=updateInterval(allbackupintervalid,getAllBackupProgress,checkdelay*=1.5)})):clearInterval(allbackupintervalid)}function getAllCopyProgress(){var copyids=[];$(".progress").find(".progress-bar[data-operation][data-backupid][data-restoreid]").not(".complete").each((function(){var progressvars={backupid:this.dataset.backupid,restoreid:this.dataset.restoreid,operation:this.dataset.operation};copyids.push(progressvars)})),copyids.length>0?ajax.call([{methodname:"core_backup_get_copy_progress",args:{copies:copyids}}],!0,!0,!1,2e3)[0].done((function(response){updateProgressCopy(response),checkdelay=15e3,allcopyintervalid=updateInterval(allcopyintervalid,getAllCopyProgress,15e3)})).fail((function(){allcopyintervalid=updateInterval(allcopyintervalid,getAllCopyProgress,checkdelay*=1.5)})):clearInterval(allcopyintervalid)}return Asyncbackup.asyncBackupAllStatus=function(context){contextid=context,allbackupintervalid=setInterval(getAllBackupProgress,checkdelay)},Asyncbackup.asyncCopyAllStatus=function(){allcopyintervalid=setInterval(getAllCopyProgress,checkdelay)},Asyncbackup.asyncBackupStatus=function(backup,context,restore,type){backupid=backup,contextid=context,restoreurl=restore,typeid="backup"==type?"backup":"restore",$(".backup_progress").children("a").removeAttr("href"),backupintervalid=setInterval(getBackupProgress,checkdelay)},Asyncbackup}));
define("core_badges/backpackactions",["exports","jquery","core_badges/selectors","core/str","core/pending","core/modal_factory","core/modal_events","core/config"],(function(_exports,_jquery,_selectors,_str,_pending,_modal_factory,_modal_events,_config){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_selectors=_interopRequireDefault(_selectors),_pending=_interopRequireDefault(_pending),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_config=_interopRequireDefault(_config);_exports.init=function(){var pendingPromise=new _pending.default,root=(0,_jquery.default)(_selectors.default.elements.main);registerListenerEvents(root),pendingPromise.resolve()};var _ref2,_ref3,registerListenerEvents=function(root){var _ref;root.on("click",_selectors.default.actions.deletebackpack,(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(e){var link,modal;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return e.preventDefault(),link=(0,_jquery.default)(e.currentTarget),_context.next=4,buildModal(link);case 4:modal=_context.sent,displayModal(modal,link);case 6:case"end":return _context.stop()}}),_callee)}))),function(_x){return _ref.apply(this,arguments)}))},buildModal=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(link){var backpackurl;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return backpackurl=link.closest(_selectors.default.elements.backpackurl).attr("data-backpackurl"),_context2.t0=_modal_factory.default,_context2.next=4,(0,_str.get_string)("delexternalbackpack","core_badges");case 4:return _context2.t1=_context2.sent,_context2.next=7,(0,_str.get_string)("delexternalbackpackconfirm","core_badges",backpackurl);case 7:return _context2.t2=_context2.sent,_context2.t3=_modal_factory.default.types.SAVE_CANCEL,_context2.t4={title:_context2.t1,body:_context2.t2,type:_context2.t3},_context2.abrupt("return",_context2.t0.create.call(_context2.t0,_context2.t4));case 11:case"end":return _context2.stop()}}),_callee2)}))),function(_x2){return _ref2.apply(this,arguments)}),displayModal=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(modal,link){return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.t0=modal,_context3.next=3,(0,_str.get_string)("delete","core");case 3:_context3.t1=_context3.sent,_context3.t0.setSaveButtonText.call(_context3.t0,_context3.t1),modal.getRoot().on(_modal_events.default.save,(function(){window.location.href=link.attr("href")+"&sesskey="+_config.default.sesskey+"&confirm=1"})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show();case 8:case"end":return _context3.stop()}}),_callee3)}))),function(_x3,_x4){return _ref3.apply(this,arguments)})}));
define("core_badges/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Define all of the selectors we will be using on the backpack interface.
   *
   * @module     core_badges/selectors
   * @package    core_badges
   * @copyright  2020 Sara Arjona <sara@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var name,value,_default={actions:{deletebackpack:(name="action",value="deletebackpack","[data-".concat(name,'="').concat(value,'"]'))},elements:{clearsearch:".input-group-append .clear-icon",main:"#backpacklist",backpackurl:"[data-backpackurl]"}};return _exports.default=_default,_exports.default}));
/**
 * A javascript module to handle calendar drag and drop in the calendar
 * month view.
 *
 * @module     core_calendar/month_view_drag_drop
 * @class      month_view_drag_drop
 * @package    core_calendar
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/month_view_drag_drop",["jquery","core/notification","core/str","core_calendar/events","core_calendar/drag_drop_data_store"],(function($,Notification,Str,CalendarEvents,DataStore){var SELECTORS_ROOT="[data-region='calendar']",SELECTORS_DRAGGABLE='[draggable="true"][data-region="event-item"]',SELECTORS_DROP_ZONE='[data-drop-zone="month-view-day"]',SELECTORS_WEEK='[data-region="month-view-week"]',ALL_CLASSES="bg-faded bg-danger text-white bg-primary text-white",registered=!1,getDropZoneFromEvent=function(e){var dropZone=$(e.target).closest(SELECTORS_DROP_ZONE);return dropZone.length?dropZone:null},isValidDropZone=function(dropZone){var dropTimestamp=dropZone.attr("data-day-timestamp"),minTimestart=DataStore.getMinTimestart(),maxTimestart=DataStore.getMaxTimestart();return!(minTimestart&&minTimestart>dropTimestamp)&&!(maxTimestart&&maxTimestart<dropTimestamp)},clearAllDropZonesState=function(){$(SELECTORS_ROOT).find(SELECTORS_DROP_ZONE).each((function(index,dropZone){(dropZone=$(dropZone)).removeClass(ALL_CLASSES)}))},updateHoverState=function updateHoverState(dropZone,hovered,count){void 0===count&&(count=DataStore.getDurationDays());var valid=isValidDropZone(dropZone);if(dropZone.removeClass(ALL_CLASSES),hovered?valid?dropZone.addClass("bg-primary text-white"):dropZone.addClass("bg-danger text-white"):(dropZone.removeClass("bg-primary text-white bg-danger text-white"),valid||dropZone.addClass("bg-faded")),--count>0){var nextDropZone=dropZone.next();if(!nextDropZone.length){var nextWeek=dropZone.closest(SELECTORS_WEEK).next();nextWeek.length&&(nextDropZone=nextWeek.children(SELECTORS_DROP_ZONE).first())}nextDropZone.length&&updateHoverState(nextDropZone,hovered,count)}},updateAllDropZonesState=function(){$(SELECTORS_ROOT).find(SELECTORS_DROP_ZONE).each((function(index,dropZone){dropZone=$(dropZone),isValidDropZone(dropZone)||updateHoverState(dropZone,!1)}))},dragstartHandler=function(e){var draggableElement=$(e.target).closest(SELECTORS_DRAGGABLE);if(draggableElement.length){var eventId=draggableElement.find("[data-event-id]").attr("data-event-id"),minTimestart=draggableElement.attr("data-min-day-timestamp"),maxTimestart=draggableElement.attr("data-max-day-timestamp"),minError=draggableElement.attr("data-min-day-error"),maxError=draggableElement.attr("data-max-day-error"),duration=$(SELECTORS_ROOT+' [data-event-id="'+eventId+'"]').length;DataStore.setEventId(eventId),DataStore.setDurationDays(duration),minTimestart&&DataStore.setMinTimestart(minTimestart),maxTimestart&&DataStore.setMaxTimestart(maxTimestart),minError&&DataStore.setMinError(minError),maxError&&DataStore.setMaxError(maxError),e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move",e.dataTransfer.setData("text/plain",eventId),e.dropEffect="move",updateAllDropZonesState()}},dragoverHandler=function(e){if(DataStore.hasEventId()){e.preventDefault();var dropZone=getDropZoneFromEvent(e);dropZone&&updateHoverState(dropZone,!0)}},dragleaveHandler=function(e){if(DataStore.hasEventId()){var dropZone=getDropZoneFromEvent(e);dropZone&&(updateHoverState(dropZone,!1),e.preventDefault())}},dropHandler=function(e){if(DataStore.hasEventId()){var dropZone=getDropZoneFromEvent(e);if(!dropZone)return DataStore.clearAll(),void clearAllDropZonesState();if(isValidDropZone(dropZone)){var eventId=DataStore.getEventId(),eventElement=$(SELECTORS_ROOT+' [data-event-id="'+eventId+'"]'),origin=null;eventElement.length&&(origin=eventElement.closest(SELECTORS_DROP_ZONE)),$("body").trigger(CalendarEvents.moveEvent,[eventId,origin,dropZone])}else{var message=function(dropZone){var dropTimestamp=dropZone.attr("data-day-timestamp"),minTimestart=DataStore.getMinTimestart(),maxTimestart=DataStore.getMaxTimestart();return minTimestart&&minTimestart>dropTimestamp?DataStore.getMinError():maxTimestart&&maxTimestart<dropTimestamp?DataStore.getMaxError():null}(dropZone);Str.get_string("errorinvaliddate","calendar").then((function(string){Notification.exception({name:string,message:message||string})}))}DataStore.clearAll(),clearAllDropZonesState(),e.preventDefault()}},dragendHandler=function(){DataStore.clearAll(),clearAllDropZonesState()},calendarMonthChangedHandler=function(){updateAllDropZonesState()};return{init:function(){registered||(document.addEventListener("dragstart",dragstartHandler,!1),document.addEventListener("dragover",dragoverHandler,!1),document.addEventListener("dragleave",dragleaveHandler,!1),document.addEventListener("drop",dropHandler,!1),document.addEventListener("dragend",dragendHandler,!1),$("body").on(CalendarEvents.monthChanged,calendarMonthChangedHandler),registered=!0)}}}));
define("core_calendar/repository",["exports","core/ajax"],(function(_exports,_ajax){var obj;
/**
   * A javascript module to handle calendar ajax actions.
   *
   * @module     core_calendar/repository
   * @class      repository
   * @package    core_calendar
   * @copyright  2017 Simey Lameze <lameze@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.updateEventStartDay=_exports.submitCreateUpdateForm=_exports.getEventById=_exports.getCourseGroupsData=_exports.getCalendarUpcomingData=_exports.getCalendarMonthData=_exports.getCalendarDayData=_exports.deleteEvent=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};_exports.deleteEvent=function(eventId){var deleteSeries=arguments.length>1&&void 0!==arguments[1]&&arguments[1],request={methodname:"core_calendar_delete_calendar_events",args:{events:[{eventid:eventId,repeat:deleteSeries}]}};return _ajax.default.call([request])[0]};_exports.getEventById=function(eventId){var request={methodname:"core_calendar_get_calendar_event_by_id",args:{eventid:eventId}};return _ajax.default.call([request])[0]};_exports.submitCreateUpdateForm=function(formData){var request={methodname:"core_calendar_submit_create_update_form",args:{formdata:formData}};return _ajax.default.call([request])[0]};_exports.getCalendarMonthData=function(year,month,courseId,categoryId,includeNavigation,mini){var day=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,request={methodname:"core_calendar_get_calendar_monthly_view",args:{year:year,month:month,courseid:courseId,categoryid:categoryId,includenavigation:includeNavigation,mini:mini,day:day}};return _ajax.default.call([request])[0]};_exports.getCalendarDayData=function(year,month,day,courseId,categoryId){var request={methodname:"core_calendar_get_calendar_day_view",args:{year:year,month:month,day:day,courseid:courseId,categoryid:categoryId}};return _ajax.default.call([request])[0]};_exports.updateEventStartDay=function(eventId,dayTimestamp){var request={methodname:"core_calendar_update_event_start_day",args:{eventid:eventId,daytimestamp:dayTimestamp}};return _ajax.default.call([request])[0]};_exports.getCalendarUpcomingData=function(courseId,categoryId){var request={methodname:"core_calendar_get_calendar_upcoming_view",args:{courseid:courseId,categoryid:categoryId}};return _ajax.default.call([request])[0]};_exports.getCourseGroupsData=function(courseId){var request={methodname:"core_group_get_course_groups",args:{courseid:courseId}};return _ajax.default.call([request])[0]}}));
/**
 * This module handles display of multiple mini calendars in a view, and
 * movement through them.
 *
 * @module     core_calendar/calendar_threemonth
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/calendar_threemonth",["jquery","core/notification","core_calendar/selectors","core_calendar/events","core/templates","core_calendar/view_manager"],(function($,Notification,CalendarSelectors,CalendarEvents,Templates,CalendarViewManager){return{init:function(root){!function(root){$("body").on([CalendarEvents.monthChanged,CalendarEvents.dayChanged].join(" "),(function(e,year,month,courseId,categoryId){root.queue((function(next){return processRequest(e,year,month,courseId,categoryId).then((function(){return next()})).fail(Notification.exception)}))}));var processRequest=function(e,year,month,courseId,categoryId){var newParent=root.find('[data-year="'+year+'"][data-month="'+month+'"]').closest(CalendarSelectors.calendarPeriods.month),allMonths=root.find(CalendarSelectors.calendarPeriods.month),previousMonth=$(allMonths[0]),nextMonth=$(allMonths[2]),placeHolder=$("<span>");placeHolder.attr("data-template","core_calendar/threemonth_month"),placeHolder.attr("data-includenavigation",!1),placeHolder.attr("data-mini",!0);var requestYear,requestMonth,oldMonth,placeHolderContainer=$("<div>");if(placeHolderContainer.hide(),placeHolderContainer.append(placeHolder),newParent.is(previousMonth))placeHolderContainer.insertBefore(previousMonth),requestYear=previousMonth.data("previousYear"),requestMonth=previousMonth.data("previousMonth"),oldMonth=nextMonth;else{if(!newParent.is(nextMonth))return $.Deferred().resolve();placeHolderContainer.insertAfter(nextMonth),requestYear=nextMonth.data("nextYear"),requestMonth=nextMonth.data("nextMonth"),oldMonth=previousMonth}return CalendarViewManager.refreshMonthContent(placeHolder,requestYear,requestMonth,courseId,categoryId,placeHolder).then((function(){var slideUpPromise=$.Deferred(),slideDownPromise=$.Deferred();return oldMonth.slideUp("fast",(function(){$(this).remove(),slideUpPromise.resolve()})),placeHolderContainer.slideDown("fast",(function(){slideDownPromise.resolve()})),$.when(slideUpPromise,slideDownPromise)}))};root.on("click",CalendarSelectors.links.miniDayLink,(function(e){var miniDayLink=$(e.target),year=miniDayLink.data("year"),month=miniDayLink.data("month"),day=miniDayLink.text(),courseId=miniDayLink.data("courseid"),categoryId=miniDayLink.data("categoryid"),calendarRoot=$("body").find(CalendarSelectors.calendarMain);CalendarViewManager.refreshDayContent(calendarRoot,year,month,day,courseId,categoryId,calendarRoot,"core_calendar/calendar_day"),e.preventDefault(),window.history.pushState({},"","?view=day")}))}(root=$(root))}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_calendar/view_manager",["exports","jquery","core/templates","core/notification","core_calendar/repository","core_calendar/events","core_calendar/selectors","core/modal_factory","core/modal_events","core_calendar/summary_modal","core/custom_interaction_events","core/pending"],(function(_exports,_jquery,_templates,_notification,CalendarRepository,_events,CalendarSelectors,_modal_factory,_modal_events,_summary_modal,_custom_interaction_events,_pending){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * A javascript module to handler calendar view changes.
   *
   * @module     core_calendar/view_manager
   * @package    core_calendar
   * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.reloadCurrentUpcoming=_exports.reloadCurrentMonth=_exports.reloadCurrentDay=_exports.refreshMonthContent=_exports.refreshDayContent=_exports.init=_exports.changeMonth=_exports.changeDay=void 0,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),CalendarRepository=_interopRequireWildcard(CalendarRepository),_events=_interopRequireDefault(_events),CalendarSelectors=_interopRequireWildcard(CalendarSelectors),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_summary_modal=_interopRequireDefault(_summary_modal),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_pending=_interopRequireDefault(_pending);var refreshMonthContent=function(root,year,month,courseId,categoryId){var target=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,template=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",day=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1;startLoading(root),target=target||root.find(CalendarSelectors.wrapper),template=template||root.attr("data-template"),M.util.js_pending([root.get("id"),year,month,courseId].join("-"));var includenavigation=root.data("includenavigation"),mini=root.data("mini");return CalendarRepository.getCalendarMonthData(year,month,courseId,categoryId,includenavigation,mini,day).then((function(context){return context.viewingmonth=!0,_templates.default.render(template,context)})).then((function(html,js){return _templates.default.replaceNode(target,html,js)})).then((function(){document.querySelector("body").dispatchEvent(new CustomEvent(_events.default.viewUpdated))})).always((function(){return M.util.js_complete([root.get("id"),year,month,courseId].join("-")),stopLoading(root)})).fail(_notification.default.exception)};_exports.refreshMonthContent=refreshMonthContent;var changeMonth=function(root,url,year,month,courseId,categoryId){var day=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return refreshMonthContent(root,year,month,courseId,categoryId,null,"",day).then((function(){url.length&&"#"!==url&&window.history.pushState({},"",url);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return args})).then((function(){(0,_jquery.default)("body").trigger(_events.default.monthChanged,[year,month,courseId,categoryId]);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return args}))};_exports.changeMonth=changeMonth;_exports.reloadCurrentMonth=function(root){var courseId=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,categoryId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,year=root.find(CalendarSelectors.wrapper).data("year"),month=root.find(CalendarSelectors.wrapper).data("month"),day=root.find(CalendarSelectors.wrapper).data("day");return courseId=courseId||root.find(CalendarSelectors.wrapper).data("courseid"),categoryId=categoryId||root.find(CalendarSelectors.wrapper).data("categoryid"),refreshMonthContent(root,year,month,courseId,categoryId,null,"",day)};var refreshDayContent=function(root,year,month,day,courseId,categoryId){var target=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,template=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"";startLoading(root),target=target||root.find(CalendarSelectors.wrapper),template=template||root.attr("data-template"),M.util.js_pending([root.get("id"),year,month,day,courseId,categoryId].join("-"));var includenavigation=root.data("includenavigation");return CalendarRepository.getCalendarDayData(year,month,day,courseId,categoryId,includenavigation).then((function(context){return context.viewingday=!0,_templates.default.render(template,context)})).then((function(html,js){return _templates.default.replaceNode(target,html,js)})).then((function(){document.querySelector("body").dispatchEvent(new CustomEvent(_events.default.viewUpdated))})).always((function(){return M.util.js_complete([root.get("id"),year,month,day,courseId,categoryId].join("-")),stopLoading(root)})).fail(_notification.default.exception)};_exports.refreshDayContent=refreshDayContent;_exports.reloadCurrentDay=function(root){var courseId=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,categoryId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,wrapper=root.find(CalendarSelectors.wrapper),year=wrapper.data("year"),month=wrapper.data("month"),day=wrapper.data("day");return courseId=courseId||root.find(CalendarSelectors.wrapper).data("courseid"),categoryId=categoryId||root.find(CalendarSelectors.wrapper).data("categoryid"),refreshDayContent(root,year,month,day,courseId,categoryId)};var changeDay=function(root,url,year,month,day,courseId,categoryId){return refreshDayContent(root,year,month,day,courseId,categoryId).then((function(){url.length&&"#"!==url&&window.history.pushState({},"",url);for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];return args})).then((function(){(0,_jquery.default)("body").trigger(_events.default.dayChanged,[year,month,courseId,categoryId]);for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];return args}))};_exports.changeDay=changeDay;var startLoading=function(root){root.find(CalendarSelectors.containers.loadingIcon).removeClass("hidden")},stopLoading=function(root){root.find(CalendarSelectors.containers.loadingIcon).addClass("hidden")},reloadCurrentUpcoming=function(root){var courseId=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,categoryId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,target=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,template=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return startLoading(root),target=target||root.find(CalendarSelectors.wrapper),template=template||root.attr("data-template"),courseId=courseId||root.find(CalendarSelectors.wrapper).data("courseid"),categoryId=categoryId||root.find(CalendarSelectors.wrapper).data("categoryid"),CalendarRepository.getCalendarUpcomingData(courseId,categoryId).then((function(context){return context.viewingupcoming=!0,_templates.default.render(template,context)})).then((function(html,js){return _templates.default.replaceNode(target,html,js)})).then((function(){document.querySelector("body").dispatchEvent(new CustomEvent(_events.default.viewUpdated))})).always((function(){return stopLoading(root)})).fail(_notification.default.exception)};_exports.reloadCurrentUpcoming=reloadCurrentUpcoming;var renderEventSummaryModal=function(eventId){var pendingPromise=new _pending.default("core_calendar/view_manager:renderEventSummaryModal");return CalendarRepository.getEventById(eventId).then((function(getEventResponse){if(!getEventResponse.event)throw new Error("Error encountered while trying to fetch calendar event with ID: "+eventId);return getEventResponse.event})).then((function(eventData){var eventType,modalParams={title:eventData.name,type:_summary_modal.default.TYPE,body:_templates.default.render("core_calendar/event_summary_body",eventData),templateContext:{canedit:eventData.canedit,candelete:eventData.candelete,headerclasses:(eventType=eventData.normalisedeventtype,"calendar_event_"+eventType),isactionevent:eventData.isactionevent,url:eventData.url,action:eventData.action}};return _modal_factory.default.create(modalParams)})).then((function(modal){return modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show(),modal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(_notification.default.exception)};_exports.init=function(root,view){!function(root){(root=(0,_jquery.default)(root)).on("click",CalendarSelectors.links.eventLink,(function(e){var target=e.target,eventLink=null,eventId=null,pendingPromise=new _pending.default("core_calendar/view_manager:eventLink:click");(eventId=(eventLink=target.matches(CalendarSelectors.actions.viewEvent)?target:target.closest(CalendarSelectors.actions.viewEvent))?eventLink.dataset.eventId:target.querySelector(CalendarSelectors.actions.viewEvent).dataset.eventId)?(e.preventDefault(),e.stopPropagation(),renderEventSummaryModal(eventId).then(pendingPromise.resolve).catch()):pendingPromise.resolve()})),root.on("click",CalendarSelectors.links.navLink,(function(e){var wrapper=root.find(CalendarSelectors.wrapper),view=wrapper.data("view"),courseId=wrapper.data("courseid"),categoryId=wrapper.data("categoryid"),link=e.currentTarget;"month"===view?(changeMonth(root,link.href,link.dataset.year,link.dataset.month,courseId,categoryId,link.dataset.day),e.preventDefault()):"day"===view&&(changeDay(root,link.href,link.dataset.year,link.dataset.month,link.dataset.day,courseId,categoryId),e.preventDefault())}));var viewSelector=root.find(CalendarSelectors.viewSelector);_custom_interaction_events.default.define(viewSelector,[_custom_interaction_events.default.events.activate]),viewSelector.on(_custom_interaction_events.default.events.activate,(function(e){e.preventDefault();var option=e.target;if(!option.classList.contains("active")){var view=option.dataset.view,year=option.dataset.year,month=option.dataset.month,day=option.dataset.day,courseId=option.dataset.courseid,categoryId=option.dataset.categoryid;"month"==view?refreshMonthContent(root,year,month,courseId,categoryId,root,"core_calendar/calendar_month",day).then((function(){return window.history.pushState({},"","?view=month")})).fail(_notification.default.exception):"day"==view?refreshDayContent(root,year,month,day,courseId,categoryId,root,"core_calendar/calendar_day").then((function(){return window.history.pushState({},"","?view=day")})).fail(_notification.default.exception):"upcoming"==view&&reloadCurrentUpcoming(root,courseId,categoryId,root,"core_calendar/calendar_upcoming").then((function(){return window.history.pushState({},"","?view=upcoming")})).fail(_notification.default.exception)}}))}(root)}}));
/**
 * This module is the highest level module for the calendar. It is
 * responsible for initialising all of the components required for
 * the calendar to run. It also coordinates the interaction between
 * components by listening for and responding to different events
 * triggered within the calendar UI.
 *
 * @module     core_calendar/calendar
 * @package    core_calendar
 * @copyright  2017 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/calendar",["jquery","core/ajax","core/str","core/templates","core/notification","core/custom_interaction_events","core/modal_events","core/modal_factory","core_calendar/modal_event_form","core_calendar/summary_modal","core_calendar/repository","core_calendar/events","core_calendar/view_manager","core_calendar/crud","core_calendar/selectors"],(function($,Ajax,Str,Templates,Notification,CustomEvents,ModalEvents,ModalFactory,ModalEventForm,SummaryModal,CalendarRepository,CalendarEvents,CalendarViewManager,CalendarCrud,CalendarSelectors){var SELECTORS_DAY="[data-region='day']",SELECTORS_DAY_CONTENT="[data-region='day-content']",SELECTORS_LOADING_ICON=".loading-icon",SELECTORS_VIEW_DAY_LINK="[data-action='view-day-link']",SELECTORS_CALENDAR_MONTH_WRAPPER=".calendarwrapper",handleMoveEvent=function(e,eventId,originElement,destinationElement){var originTimestamp=null,destinationTimestamp=destinationElement.attr("data-day-timestamp");originElement&&(originTimestamp=originElement.attr("data-day-timestamp")),originElement&&originTimestamp==destinationTimestamp||Templates.render("core/loading",{}).then((function(html,js){destinationElement.find(SELECTORS_DAY_CONTENT).addClass("hidden"),Templates.appendNodeContents(destinationElement,html,js),originElement&&(originElement.find(SELECTORS_DAY_CONTENT).addClass("hidden"),Templates.appendNodeContents(originElement,html,js))})).then((function(){return CalendarRepository.updateEventStartDay(eventId,destinationTimestamp)})).then((function(){$("body").trigger(CalendarEvents.eventMoved,[eventId,originElement,destinationElement])})).always((function(){var destinationLoadingElement=destinationElement.find(SELECTORS_LOADING_ICON);if(destinationElement.find(SELECTORS_DAY_CONTENT).removeClass("hidden"),Templates.replaceNode(destinationLoadingElement,"",""),originElement){var originLoadingElement=originElement.find(SELECTORS_LOADING_ICON);originElement.find(SELECTORS_DAY_CONTENT).removeClass("hidden"),Templates.replaceNode(originLoadingElement,"","")}})).fail(Notification.exception)},registerEventListeners=function(root){root.on("click",SELECTORS_VIEW_DAY_LINK,(function(e){var dayLink=$(e.target),year=dayLink.data("year"),month=dayLink.data("month"),day=dayLink.data("day"),courseId=dayLink.data("courseid"),categoryId=dayLink.data("categoryid");CalendarViewManager.refreshDayContent(root,year,month,day,courseId,categoryId,root,"core_calendar/calendar_day").then((function(){e.preventDefault();var url="?view=day&time="+dayLink.data("timestamp");return window.history.pushState({},"",url)})).fail(Notification.exception)})),root.on("change",CalendarSelectors.elements.courseSelector,(function(){var courseId=$(this).val();CalendarViewManager.reloadCurrentMonth(root,courseId,null).then((function(){return root.find(CalendarSelectors.elements.courseSelector).val(courseId)})).fail(Notification.exception)}));var eventFormPromise=CalendarCrud.registerEventFormModal(root),contextId=$(SELECTORS_CALENDAR_MONTH_WRAPPER).data("context-id");!function(root,eventFormModalPromise){var body=$("body");body.on(CalendarEvents.created,(function(){CalendarViewManager.reloadCurrentMonth(root)})),body.on(CalendarEvents.deleted,(function(){CalendarViewManager.reloadCurrentMonth(root)})),body.on(CalendarEvents.updated,(function(){CalendarViewManager.reloadCurrentMonth(root)})),body.on(CalendarEvents.editActionEvent,(function(e,url){window.location.assign(url)})),body.on(CalendarEvents.moveEvent,handleMoveEvent),body.on(CalendarEvents.eventMoved,(function(){CalendarViewManager.reloadCurrentMonth(root)})),CalendarCrud.registerEditListeners(root,eventFormModalPromise)}(root,eventFormPromise),contextId&&root.on("click",SELECTORS_DAY,(function(e){var target=$(e.target);if(!target.is(SELECTORS_VIEW_DAY_LINK)){var startTime=$(this).attr("data-new-event-timestamp");eventFormPromise.then((function(modal){var wrapper=target.closest(CalendarSelectors.wrapper);modal.setCourseId(wrapper.data("courseid"));var categoryId=wrapper.data("categoryid");void 0!==categoryId&&modal.setCategoryId(categoryId),modal.setContextId(wrapper.data("contextId")),modal.setStartTime(startTime),modal.show()})).fail(Notification.exception),e.preventDefault()}}))};return{init:function(root){root=$(root),CalendarViewManager.init(root),registerEventListeners(root)}}}));
/**
 * This module is responsible for handle calendar day and upcoming view.
 *
 * @module     core_calendar/calendar
 * @package    core_calendar
 * @copyright  2017 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/calendar_view",["jquery","core/str","core/notification","core_calendar/selectors","core_calendar/events","core_calendar/view_manager","core_calendar/repository","core/modal_factory","core_calendar/modal_event_form","core/modal_events","core_calendar/crud"],(function($,Str,Notification,CalendarSelectors,CalendarEvents,CalendarViewManager,CalendarRepository,ModalFactory,ModalEventForm,ModalEvents,CalendarCrud){return{init:function(root,type){root=$(root),CalendarViewManager.init(root,type),function(root,type){var body=$("body");CalendarCrud.registerRemove(root);var reloadFunction="reloadCurrent"+type.charAt(0).toUpperCase()+type.slice(1);body.on(CalendarEvents.created,(function(){CalendarViewManager[reloadFunction](root)})),body.on(CalendarEvents.deleted,(function(){CalendarViewManager[reloadFunction](root)})),body.on(CalendarEvents.updated,(function(){CalendarViewManager[reloadFunction](root)})),root.on("change",CalendarSelectors.courseSelector,(function(){var courseId=$(this).val();CalendarViewManager[reloadFunction](root,courseId,null).then((function(){return root.find(CalendarSelectors.courseSelector).val(courseId)})).then((function(){window.history.pushState({},"","?view=upcoming&course="+courseId)})).fail(Notification.exception)})),body.on(CalendarEvents.filterChanged,(function(e,data){var daysWithEvent=root.find(CalendarSelectors.eventType[data.type]);1==data.hidden?daysWithEvent.addClass("hidden"):daysWithEvent.removeClass("hidden")}));var eventFormPromise=CalendarCrud.registerEventFormModal(root);CalendarCrud.registerEditListeners(root,eventFormPromise)}(root,type)}}}));
/**
 * A module to handle CRUD operations within the UI.
 *
 * @module     core_calendar/crud
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/crud",["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core_calendar/modal_event_form","core_calendar/repository","core_calendar/events","core_calendar/modal_delete","core_calendar/selectors","core/pending"],(function($,Str,Notification,CustomEvents,Modal,ModalRegistry,ModalFactory,ModalEvents,ModalEventForm,CalendarRepository,CalendarEvents,ModalDelete,CalendarSelectors,Pending){return{registerRemove:function(root){root.on("click",CalendarSelectors.actions.remove,(function(e){var eventSource=$(this).closest(CalendarSelectors.eventItem);!function(eventId,eventTitle,eventCount){var deletePromise,pendingPromise=new Pending("core_calendar/crud:confirmDeletion"),deleteStrings=[{key:"deleteevent",component:"calendar"}],isRepeatedEvent=(eventCount=parseInt(eventCount,10))>1;isRepeatedEvent?(deleteStrings.push({key:"confirmeventseriesdelete",component:"calendar",param:{name:eventTitle,count:eventCount}}),deletePromise=ModalFactory.create({type:ModalDelete.TYPE})):(deleteStrings.push({key:"confirmeventdelete",component:"calendar",param:eventTitle}),deletePromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL}));var stringsPromise=Str.get_strings(deleteStrings);$.when(stringsPromise,deletePromise).then((function(strings,deleteModal){return deleteModal.setRemoveOnClose(!0),deleteModal.setTitle(strings[0]),deleteModal.setBody(strings[1]),isRepeatedEvent||deleteModal.setSaveButtonText(strings[0]),deleteModal.show(),deleteModal.getRoot().on(ModalEvents.save,(function(){var pendingPromise=new Pending("calendar/crud:initModal:deletedevent");CalendarRepository.deleteEvent(eventId,!1).then((function(){$("body").trigger(CalendarEvents.deleted,[eventId,!1])})).then(pendingPromise.resolve).catch(Notification.exception)})),deleteModal.getRoot().on(CalendarEvents.deleteAll,(function(){var pendingPromise=new Pending("calendar/crud:initModal:deletedallevent");CalendarRepository.deleteEvent(eventId,!0).then((function(){$("body").trigger(CalendarEvents.deleted,[eventId,!0])})).then(pendingPromise.resolve).catch(Notification.exception)})),deleteModal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(Notification.exception)}(eventSource.data("eventId"),eventSource.data("eventTitle"),eventSource.data("eventCount")),e.preventDefault()}))},registerEditListeners:function(root,eventFormModalPromise){var pendingPromise=new Pending("core_calendar/crud:registerEditListeners");return eventFormModalPromise.then((function(modal){return $("body").on(CalendarEvents.editEvent,(function(e,eventId){var calendarWrapper=root.find(CalendarSelectors.wrapper);modal.setEventId(eventId),modal.setContextId(calendarWrapper.data("contextId")),modal.show(),e.stopImmediatePropagation()})),modal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(Notification.exception)},registerEventFormModal:function(root){var eventFormPromise=ModalFactory.create({type:ModalEventForm.TYPE,large:!0});return root.on("click",CalendarSelectors.actions.create,(function(e){eventFormPromise.then((function(modal){var wrapper=root.find(CalendarSelectors.wrapper),categoryId=wrapper.data("categoryid");void 0!==categoryId&&modal.setCategoryId(categoryId);var today=root.find(CalendarSelectors.today),firstDay=root.find(CalendarSelectors.day);!today.length&&firstDay.length&&modal.setStartTime(firstDay.data("newEventTimestamp")),modal.setContextId(wrapper.data("contextId")),modal.setCourseId(wrapper.data("courseid")),modal.show()})).fail(Notification.exception),e.preventDefault()})),root.on("click",CalendarSelectors.actions.edit,(function(e){e.preventDefault();var target=$(e.currentTarget),calendarWrapper=target.closest(CalendarSelectors.wrapper),eventWrapper=target.closest(CalendarSelectors.eventItem);eventFormPromise.then((function(modal){modal.setEventId(eventWrapper.data("eventId")),modal.setContextId(calendarWrapper.data("contextId")),modal.show(),e.stopImmediatePropagation()})).fail(Notification.exception)})),eventFormPromise}}}));
/**
 * Contain the events the calendar component can fire.
 *
 * @module     core_calendar/events
 * @class      calendar_events
 * @package    core_calendar
 * @copyright  2017 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/events",[],(function(){return{created:"calendar-events:created",deleted:"calendar-events:deleted",deleteAll:"calendar-events:delete_all",updated:"calendar-events:updated",editEvent:"calendar-events:edit_event",editActionEvent:"calendar-events:edit_action_event",eventMoved:"calendar-events:event_moved",dayChanged:"calendar-events:day_changed",monthChanged:"calendar-events:month_changed",moveEvent:"calendar-events:move_event",filterChanged:"calendar-events:filter_changed",viewUpdated:"calendar-events:view_updated"}}));
/**
 * This module is responsible for the calendar filter.
 *
 * @module     core_calendar/calendar_filter
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/calendar_filter",["jquery","core_calendar/selectors","core_calendar/events","core/str","core/templates"],(function($,CalendarSelectors,CalendarEvents,Str,Templates){var toggleFilter=function(target){var data=getFilterData(target);return data.hidden=!data.hidden,M.util.js_pending("core_calendar/calendar_filter:toggleFilter"),Str.get_string("eventtype"+data.eventtype,"calendar").then((function(nameStr){return data.name=nameStr,data.icon=!0,data.key="i/"+data.eventtype+"event",data.component="core",data})).then((function(context){return Templates.render("core_calendar/event_filter_key",context)})).then((function(html,js){return Templates.replaceNode(target,html,js)})).then((function(){fireFilterChangedEvent(data),M.util.js_complete("core_calendar/calendar_filter:toggleFilter")}))},fireFilterChangedEvent=function(data){M.util.js_pending("month-mini-filterChanged"),$("body").trigger(CalendarEvents.filterChanged,{type:data.eventtype,hidden:data.hidden}),M.util.js_complete("month-mini-filterChanged")},getFilterData=function(target){return{eventtype:target.data("eventtype"),hidden:target.data("eventtype-hidden")}};return{init:function(root){!function(root){root.on("click",CalendarSelectors.eventFilterItem,(function(e){var target=$(e.currentTarget);toggleFilter(target),e.preventDefault()})),$("body").on(CalendarEvents.viewUpdated,(function(){root.find(CalendarSelectors.eventFilterItem).each((function(i,filter){if((filter=$(filter)).data("eventtype-hidden")){var data=getFilterData(filter);fireFilterChangedEvent(data)}}))}))}(root=$(root))}}}));
/**
 * Contain the logic for the save/cancel modal.
 *
 * @module     core_calendar/modal_delete
 * @class      modal_delete
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/modal_delete",["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_events","core/modal_registry","core_calendar/events"],(function($,Notification,CustomEvents,Modal,ModalEvents,ModalRegistry,CalendarEvents){var registered=!1,SELECTORS_DELETE_ONE_BUTTON='[data-action="deleteone"]',SELECTORS_DELETE_ALL_BUTTON='[data-action="deleteall"]',SELECTORS_CANCEL_BUTTON='[data-action="cancel"]',ModalDelete=function(root){Modal.call(this,root),this.setRemoveOnClose(!0)};return ModalDelete.TYPE="core_calendar-modal_delete",(ModalDelete.prototype=Object.create(Modal.prototype)).constructor=ModalDelete,ModalDelete.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_DELETE_ONE_BUTTON,function(e,data){var saveEvent=$.Event(ModalEvents.save);this.getRoot().trigger(saveEvent,this),saveEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this)),this.getModal().on(CustomEvents.events.activate,SELECTORS_DELETE_ALL_BUTTON,function(e,data){var saveEvent=$.Event(CalendarEvents.deleteAll);this.getRoot().trigger(saveEvent,this),saveEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this)),this.getModal().on(CustomEvents.events.activate,SELECTORS_CANCEL_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalDelete.TYPE,ModalDelete,"calendar/event_delete_modal"),registered=!0),ModalDelete}));
/**
 * This module is the highest level module for the calendar. It is
 * responsible for initialising all of the components required for
 * the calendar to run. It also coordinates the interaction between
 * components by listening for and responding to different events
 * triggered within the calendar UI.
 *
 * @module     core_calendar/calendar_mini
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/calendar_mini",["jquery","core_calendar/selectors","core_calendar/events","core_calendar/view_manager"],(function($,CalendarSelectors,CalendarEvents,CalendarViewManager){var reloadMonth=function(e){var root=e.data,body=$("body"),namespace="."+root.attr("id");root.is(":visible")?CalendarViewManager.reloadCurrentMonth(root):(body.off(CalendarEvents.created+namespace),body.off(CalendarEvents.deleted+namespace),body.off(CalendarEvents.updated+namespace),body.off(CalendarEvents.eventMoved+namespace))};return{init:function(root,loadOnInit){root=$(root),CalendarViewManager.init(root),function(root){$("body").on(CalendarEvents.filterChanged,(function(e,data){root.find(CalendarSelectors.eventType[data.type]).toggleClass("calendar_event_"+data.type,!data.hidden)}));var namespace="."+root.attr("id");$("body").on("change"+namespace,CalendarSelectors.elements.courseSelector,(function(){if(root.is(":visible")){var courseId=$(this).val();CalendarViewManager.reloadCurrentMonth(root,courseId,null)}else $("body").off("change"+namespace)}))}(root),function(root){var body=$("body"),namespace="."+root.attr("id");body.on(CalendarEvents.created+namespace,root,reloadMonth),body.on(CalendarEvents.deleted+namespace,root,reloadMonth),body.on(CalendarEvents.updated+namespace,root,reloadMonth),body.on(CalendarEvents.eventMoved+namespace,root,reloadMonth)}(root),loadOnInit&&CalendarViewManager.reloadCurrentMonth(root)}}}));
/**
 * Contain the logic for the quick add or update event modal.
 *
 * @module     calendar/modal_quick_add_event
 * @class      modal_quick_add_event
 * @package    core
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/modal_event_form",["jquery","core/event","core/str","core/notification","core/templates","core/custom_interaction_events","core/modal","core/modal_registry","core/fragment","core_calendar/events","core_calendar/repository"],(function($,Event,Str,Notification,Templates,CustomEvents,Modal,ModalRegistry,Fragment,CalendarEvents,Repository){var registered=!1,SELECTORS_SAVE_BUTTON='[data-action="save"]',SELECTORS_LOADING_ICON_CONTAINER='[data-region="loading-icon-container"]',ModalEventForm=function(root){Modal.call(this,root),this.eventId=null,this.startTime=null,this.courseId=null,this.categoryId=null,this.contextId=null,this.reloadingBody=!1,this.reloadingTitle=!1,this.saveButton=this.getFooter().find(SELECTORS_SAVE_BUTTON)};return ModalEventForm.TYPE="core_calendar-modal_event_form",(ModalEventForm.prototype=Object.create(Modal.prototype)).constructor=ModalEventForm,ModalEventForm.prototype.setContextId=function(id){this.contextId=id},ModalEventForm.prototype.getContextId=function(){return this.contextId},ModalEventForm.prototype.setCourseId=function(id){this.courseId=id},ModalEventForm.prototype.getCourseId=function(){return this.courseId},ModalEventForm.prototype.setCategoryId=function(id){this.categoryId=id},ModalEventForm.prototype.getCategoryId=function(){return this.categoryId},ModalEventForm.prototype.hasCourseId=function(){return null!==this.courseId},ModalEventForm.prototype.hasCategoryId=function(){return null!==this.categoryId},ModalEventForm.prototype.setEventId=function(id){this.eventId=id},ModalEventForm.prototype.getEventId=function(){return this.eventId},ModalEventForm.prototype.hasEventId=function(){return null!==this.eventId},ModalEventForm.prototype.setStartTime=function(time){this.startTime=time},ModalEventForm.prototype.getStartTime=function(){return this.startTime},ModalEventForm.prototype.hasStartTime=function(){return null!==this.startTime},ModalEventForm.prototype.getForm=function(){return this.getBody().find("form")},ModalEventForm.prototype.disableButtons=function(){this.saveButton.prop("disabled",!0)},ModalEventForm.prototype.enableButtons=function(){this.saveButton.prop("disabled",!1)},ModalEventForm.prototype.reloadTitleContent=function(){return this.reloadingTitle||(this.reloadingTitle=!0,this.hasEventId()?this.titlePromise=Str.get_string("editevent","calendar"):this.titlePromise=Str.get_string("newevent","calendar"),this.titlePromise.then(function(string){return this.setTitle(string),string}.bind(this)).always(function(){this.reloadingTitle=!1}.bind(this)).fail(Notification.exception)),this.titlePromise},ModalEventForm.prototype.reloadBodyContent=function(formData){if(this.reloadingBody)return this.bodyPromise;this.reloadingBody=!0,this.disableButtons();var args={};return this.hasEventId()&&(args.eventid=this.getEventId()),this.hasStartTime()&&(args.starttime=this.getStartTime()),this.hasCourseId()&&(args.courseid=this.getCourseId()),this.hasCategoryId()&&(args.categoryid=this.getCategoryId()),void 0!==formData&&(args.formdata=formData),this.bodyPromise=Fragment.loadFragment("calendar","event_form",this.getContextId(),args),this.setBody(this.bodyPromise),this.bodyPromise.then(function(){this.enableButtons()}.bind(this)).fail(Notification.exception).always(function(){this.reloadingBody=!1}.bind(this)).fail(Notification.exception),this.bodyPromise},ModalEventForm.prototype.reloadAllContent=function(){return $.when(this.reloadTitleContent(),this.reloadBodyContent())},ModalEventForm.prototype.show=function(){this.reloadAllContent(),Modal.prototype.show.call(this)},ModalEventForm.prototype.hide=function(){Modal.prototype.hide.call(this),this.setEventId(null),this.setStartTime(null),this.setCourseId(null),this.setCategoryId(null)},ModalEventForm.prototype.getFormData=function(){return this.getForm().serialize()},ModalEventForm.prototype.save=function(){var invalid,loadingContainer=this.saveButton.find(SELECTORS_LOADING_ICON_CONTAINER);if(!(invalid=this.getForm().find('[aria-invalid="true"]')).length){loadingContainer.removeClass("hidden"),this.disableButtons();var formData=this.getFormData();return Repository.submitCreateUpdateForm(formData).then(function(response){if(response.validationerror)this.reloadBodyContent(formData);else{var isExisting=this.hasEventId();this.hide(),isExisting?$("body").trigger(CalendarEvents.updated,[response.event]):$("body").trigger(CalendarEvents.created,[response.event])}}.bind(this)).always(function(){loadingContainer.addClass("hidden"),this.enableButtons()}.bind(this)).fail(Notification.exception)}invalid.first().focus()},ModalEventForm.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_SAVE_BUTTON,function(e,data){this.getForm().submit(),data.originalEvent.preventDefault(),e.stopPropagation()}.bind(this)),this.getModal().on("submit",function(e){Event.notifyFormSubmitAjax(this.getForm()[0]),this.save(),e.preventDefault(),e.stopPropagation()}.bind(this))},registered||(ModalRegistry.register(ModalEventForm.TYPE,ModalEventForm,"calendar/modal_event_form"),registered=!0),ModalEventForm}));
/**
 * A javascript module to handle calendar drag and drop in the calendar
 * month view navigation.
 *
 * This code is run each time the calendar month view is re-rendered. We
 * only register the event handlers once per page load so that the in place
 * DOM updates that happen on month change don't continue to register handlers.
 *
 * @module     core_calendar/month_navigation_drag_drop
 * @class      month_navigation_drag_drop
 * @package    core_calendar
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/month_navigation_drag_drop",["jquery","core_calendar/drag_drop_data_store"],(function($,DataStore){var SELECTORS_DRAGGABLE='[draggable="true"][data-region="event-item"]',SELECTORS_DROP_ZONE='[data-drop-zone="nav-link"]',registered=!1,hoverTimer=null,root=null,updateHoverState=function(target,hovered){hovered?target.addClass("bg-primary text-white"):target.removeClass("bg-primary text-white")},addDropZoneIndicator=function(){root.find(SELECTORS_DROP_ZONE).addClass("drop-target")},removeDropZoneIndicator=function(){root.find(SELECTORS_DROP_ZONE).removeClass("drop-target")},getTargetFromEvent=function(e){var target=$(e.target).closest(SELECTORS_DROP_ZONE);return target.length?target:null},dragstartHandler=function(e){$(e.target).closest(SELECTORS_DRAGGABLE).length&&addDropZoneIndicator()},dragoverHandler=function(e){if(DataStore.hasEventId()){e.preventDefault();var target=getTargetFromEvent(e);target&&DataStore.hasEventId()&&(hoverTimer||(hoverTimer=setTimeout((function(){target.click(),hoverTimer=null}),1e3)),updateHoverState(target,!0),removeDropZoneIndicator())}},dragleaveHandler=function(e){if(DataStore.hasEventId()){var target=getTargetFromEvent(e);target&&(hoverTimer&&(clearTimeout(hoverTimer),hoverTimer=null),updateHoverState(target,!1),addDropZoneIndicator(),e.preventDefault())}},dropHandler=function(e){if(DataStore.hasEventId()){removeDropZoneIndicator();var target=getTargetFromEvent(e);target&&(updateHoverState(target,!1),e.preventDefault())}};return{init:function(rootElement){registered||(document.addEventListener("dragstart",dragstartHandler,!1),document.addEventListener("dragover",dragoverHandler,!1),document.addEventListener("dragleave",dragleaveHandler,!1),document.addEventListener("drop",dropHandler,!1),document.addEventListener("dragend",removeDropZoneIndicator,!1),registered=!0),root=$(rootElement),DataStore.hasEventId()&&addDropZoneIndicator()}}}));
/**
 * This module is responsible for the calendar filter.
 *
 * @module     core_calendar/calendar_selectors
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/selectors",[],(function(){return{eventFilterItem:"[data-action='filter-event-type']",eventType:{site:"[data-eventtype-site]",category:"[data-eventtype-category]",course:"[data-eventtype-course]",group:"[data-eventtype-group]",user:"[data-eventtype-user]",other:"[data-eventtype-other]"},popoverType:{site:"[data-popover-eventtype-site]",category:"[data-popover-eventtype-category]",course:"[data-popover-eventtype-course]",group:"[data-popover-eventtype-group]",user:"[data-popover-eventtype-user]",other:"[data-popover-eventtype-other]"},calendarPeriods:{month:"[data-period='month']"},courseSelector:'select[name="course"]',viewSelector:'div[data-region="view-selector"]',actions:{create:'[data-action="new-event-button"]',edit:'[data-action="edit"]',remove:'[data-action="delete"]',viewEvent:'[data-action="view-event"]'},elements:{courseSelector:'select[name="course"]'},today:".today",day:'[data-region="day"]',calendarMain:'[data-region="calendar"]',wrapper:".calendarwrapper",eventItem:'[data-type="event"]',links:{navLink:".calendarwrapper .arrow_link",eventLink:"[data-region='event-item']",miniDayLink:"[data-region='mini-day-link']"},containers:{loadingIcon:'[data-region="overlay-icon-container"]'}}}));
/**
 * A javascript module to handle summary modal.
 *
 * @module     core_calendar/summary_modal
 * @package    core_calendar
 * @copyright  2017 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/summary_modal",["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core_calendar/repository","core_calendar/events","core_calendar/crud"],(function($,Str,Notification,CustomEvents,Modal,ModalRegistry,ModalFactory,ModalEvents,CalendarRepository,CalendarEvents,CalendarCrud){var registered=!1,SELECTORS_ROOT="[data-region='summary-modal-container']",SELECTORS_EDIT_BUTTON='[data-action="edit"]',SELECTORS_DELETE_BUTTON='[data-action="delete"]',ModalEventSummary=function(root){Modal.call(this,root)};return ModalEventSummary.TYPE="core_calendar-event_summary",(ModalEventSummary.prototype=Object.create(Modal.prototype)).constructor=ModalEventSummary,ModalEventSummary.prototype.getEditButton=function(){return void 0===this.editButton&&(this.editButton=this.getFooter().find(SELECTORS_EDIT_BUTTON)),this.editButton},ModalEventSummary.prototype.getDeleteButton=function(){return void 0===this.deleteButton&&(this.deleteButton=this.getFooter().find(SELECTORS_DELETE_BUTTON)),this.deleteButton},ModalEventSummary.prototype.getEventId=function(){return this.getBody().find(SELECTORS_ROOT).attr("data-event-id")},ModalEventSummary.prototype.getEventTitle=function(){return this.getBody().find(SELECTORS_ROOT).attr("data-event-title")},ModalEventSummary.prototype.getEventCount=function(){return this.getBody().find(SELECTORS_ROOT).attr("data-event-count")},ModalEventSummary.prototype.getEditUrl=function(){return this.getBody().find(SELECTORS_ROOT).attr("data-edit-url")},ModalEventSummary.prototype.isActionEvent=function(){return"true"==this.getBody().find(SELECTORS_ROOT).attr("data-action-event")},ModalEventSummary.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),M.util.js_pending("core_calendar/summary_modal:registerEventListeners:bodyRendered"),this.getRoot().on(ModalEvents.bodyRendered,function(){this.getModal().data({eventTitle:this.getEventTitle(),eventId:this.getEventId(),eventCount:this.getEventCount()}).attr("data-type","event"),CalendarCrud.registerRemove(this.getModal()),M.util.js_complete("core_calendar/summary_modal:registerEventListeners:bodyRendered")}.bind(this)),$("body").on(CalendarEvents.deleted,function(){this.hide()}.bind(this)),CustomEvents.define(this.getEditButton(),[CustomEvents.events.activate]),this.getEditButton().on(CustomEvents.events.activate,function(e,data){this.isActionEvent()?$("body").trigger(CalendarEvents.editActionEvent,[this.getEditUrl()]):$("body").trigger(CalendarEvents.editEvent,[this.getEventId()]),this.hide(),e.preventDefault(),e.stopPropagation(),data.originalEvent.preventDefault(),data.originalEvent.stopPropagation()}.bind(this))},registered||(ModalRegistry.register(ModalEventSummary.TYPE,ModalEventSummary,"core_calendar/event_summary_modal"),registered=!0),ModalEventSummary}));
/**
 * A javascript module to store calendar drag and drop data.
 *
 * This module is unfortunately required because of the limitations
 * of the HTML5 drag and drop API and it's ability to provide data
 * between the different stages of the drag/drop lifecycle.
 *
 * @module     core_calendar/drag_drop_data_store
 * @package    core_calendar
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/drag_drop_data_store",[],(function(){var eventId=null,durationDays=null,minTimestart=null,maxTimestart=null,minError=null,maxError=null,setEventId=function(id){eventId=id},setDurationDays=function(days){durationDays=days},setMinTimestart=function(timestamp){minTimestart=timestamp},setMaxTimestart=function(timestamp){maxTimestart=timestamp},setMinError=function(message){minError=message},setMaxError=function(message){maxError=message};return{setEventId:setEventId,getEventId:function(){return eventId},hasEventId:function(){return null!==eventId},setDurationDays:setDurationDays,getDurationDays:function(){return durationDays},setMinTimestart:setMinTimestart,getMinTimestart:function(){return minTimestart},hasMinTimestart:function(){return null!==minTimestart},setMaxTimestart:setMaxTimestart,getMaxTimestart:function(){return maxTimestart},hasMaxTimestart:function(){return null!==maxTimestart},setMinError:setMinError,getMinError:function(){return minError},setMaxError:setMaxError,getMaxError:function(){return maxError},clearAll:function(){setEventId(null),setDurationDays(null),setMinTimestart(null),setMaxTimestart(null),setMinError(null),setMaxError(null)}}}));
/**
 * A javascript module to enhance the event form.
 *
 * @module     core_calendar/event_form
 * @package    core_calendar
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/event_form",["jquery","core_calendar/repository"],(function($,CalendarRepository){var SELECTORS_EVENT_GROUP_COURSE_ID='[name="groupcourseid"]',SELECTORS_EVENT_GROUP_ID='[name="groupid"]',SELECTORS_SELECT_OPTION="option",addCourseGroupSelectListeners=function(formElement){var courseGroupSelect=formElement.find(SELECTORS_EVENT_GROUP_COURSE_ID);courseGroupSelect.on("change",(function(){var courseId=formElement.find(SELECTORS_EVENT_GROUP_COURSE_ID).val();CalendarRepository.getCourseGroupsData(courseId).then((function(groups){return function(groups){var groupSelect=formElement.find(SELECTORS_EVENT_GROUP_ID),groupSelectOptions=groupSelect.find(SELECTORS_SELECT_OPTION),courseGroups=$(groups);groupSelectOptions.remove(),groupSelect.prop("disabled",!1),courseGroups.each((function(id,group){$(groupSelect).append($("<option></option>").attr("value",group.id).text(group.name))}))}(groups)})).catch(Notification.exception)}))};return{init:function(formId){var formElement=$("#"+formId);addCourseGroupSelectListeners(formElement)}}}));
define("core_contentbank/search",["exports","jquery","core_contentbank/selectors","core/str","core/pending","core/utils"],(function(_exports,_jquery,_selectors,_str,_pending,_utils){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_selectors=_interopRequireDefault(_selectors),_pending=_interopRequireDefault(_pending);_exports.init=function(){var pendingPromise=new _pending.default,root=(0,_jquery.default)(_selectors.default.regions.contentbank);registerListenerEvents(root),pendingPromise.resolve()};var fn,_ref,registerListenerEvents=function(root){var searchInput=root.find(_selectors.default.elements.searchinput)[0];root.on("click",_selectors.default.actions.search,(function(e){e.preventDefault(),toggleSearchResultsView(root,searchInput.value)})),root.on("click",_selectors.default.actions.clearSearch,(function(e){e.preventDefault(),searchInput.value="",searchInput.focus(),toggleSearchResultsView(root,searchInput.value)})),searchInput.addEventListener("input",(0,_utils.debounce)((function(){toggleSearchResultsView(root,searchInput.value)}),300))},toggleSearchResultsView=(fn=regeneratorRuntime.mark((function _callee(body,searchQuery){var clearSearchButton,searchIcon,navbarBreadcrumb,navbarTotal,filteredContents;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(clearSearchButton=body.find(_selectors.default.elements.clearsearch)[0],searchIcon=body.find(_selectors.default.elements.searchicon)[0],navbarBreadcrumb=body.find(_selectors.default.elements.cbnavbarbreadcrumb)[0],navbarTotal=body.find(_selectors.default.elements.cbnavbartotalsearch)[0],filteredContents=filterContents(body,searchQuery),!(searchQuery.length>0)){_context.next=15;break}return searchIcon.classList.add("d-none"),clearSearchButton.classList.remove("d-none"),navbarBreadcrumb.classList.add("d-none"),_context.next=11,(0,_str.get_string)("itemsfound","core_contentbank",filteredContents.length);case 11:navbarTotal.innerHTML=_context.sent,navbarTotal.classList.remove("d-none"),_context.next=19;break;case 15:clearSearchButton.classList.add("d-none"),searchIcon.classList.remove("d-none"),navbarBreadcrumb.classList.remove("d-none"),navbarTotal.classList.add("d-none");case 19:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2){return _ref.apply(this,arguments)}),filterContents=function(body,searchTerm){var contents=Array.from(body.find(_selectors.default.elements.listitem)),searchResults=[];return contents.forEach((function(content){var contentName=content.getAttribute("data-name");""===searchTerm||contentName.toLowerCase().includes(searchTerm.toLowerCase())?(searchResults.push(content),content.querySelector(_selectors.default.regions.cbcontentname).innerHTML=highlight(contentName,searchTerm),content.classList.remove("d-none")):content.classList.add("d-none")})),searchResults},highlight=function(text,highlightText){var result=text;if(""!==highlightText){var pos=text.toLowerCase().indexOf(highlightText.toLowerCase());pos>-1&&(result=text.substr(0,pos)+'<span class="matchtext">'+text.substr(pos,highlightText.length)+"</span>"+text.substr(pos+highlightText.length))}return result}}));
define("core_contentbank/sort",["exports","./selectors","core/str","core/prefetch","core/ajax","core/notification"],(function(_exports,_selectors,_str,_prefetch,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Content bank UI actions.
   *
   * @module     core_contentbank/sort
   * @package    core_contentbank
   * @copyright  2020 Bas Brands <bas@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_selectors=_interopRequireDefault(_selectors),_prefetch=_interopRequireDefault(_prefetch),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);_exports.init=function(){var contentBank=document.querySelector(_selectors.default.regions.contentbank);_prefetch.default.prefetchStrings("contentbank",["contentname","lastmodified","size","type"]),_prefetch.default.prefetchStrings("moodle",["sortbyx","sortbyxreverse"]),registerListenerEvents(contentBank)};var registerListenerEvents=function(contentBank){var fileArea=document.querySelector(_selectors.default.regions.filearea),shownItems=fileArea.querySelectorAll(_selectors.default.elements.listitem),viewGrid=contentBank.querySelector(_selectors.default.actions.viewgrid),viewList=contentBank.querySelector(_selectors.default.actions.viewlist);viewGrid.addEventListener("click",(function(){contentBank.classList.remove("view-list"),contentBank.classList.add("view-grid"),viewGrid.classList.add("active"),viewList.classList.remove("active"),setViewListPreference(!1)})),viewList.addEventListener("click",(function(){contentBank.classList.remove("view-grid"),contentBank.classList.add("view-list"),viewList.classList.add("active"),viewGrid.classList.remove("active"),setViewListPreference(!0)}));var sortByName=contentBank.querySelector(_selectors.default.actions.sortname);sortByName.addEventListener("click",(function(){var ascending=updateSortButtons(contentBank,sortByName);updateSortOrder(fileArea,shownItems,"data-file",ascending)}));var sortByDate=contentBank.querySelector(_selectors.default.actions.sortdate);sortByDate.addEventListener("click",(function(){var ascending=updateSortButtons(contentBank,sortByDate);updateSortOrder(fileArea,shownItems,"data-timemodified",ascending)}));var sortBySize=contentBank.querySelector(_selectors.default.actions.sortsize);sortBySize.addEventListener("click",(function(){var ascending=updateSortButtons(contentBank,sortBySize);updateSortOrder(fileArea,shownItems,"data-bytes",ascending)}));var sortByType=contentBank.querySelector(_selectors.default.actions.sorttype);sortByType.addEventListener("click",(function(){var ascending=updateSortButtons(contentBank,sortByType);updateSortOrder(fileArea,shownItems,"data-type",ascending)}))},setViewListPreference=function(viewList){!1===viewList&&(viewList=null);var request={methodname:"core_user_update_user_preferences",args:{preferences:[{type:"core_contentbank_view_list",value:viewList}]}};return _ajax.default.call([request])[0].catch(_notification.default.exception)},updateSortButtons=function(contentBank,sortButton){contentBank.querySelectorAll(_selectors.default.elements.sortbutton).forEach((function(button){button!==sortButton&&(button.classList.remove("dir-asc"),button.classList.remove("dir-desc"),button.classList.add("dir-none"),updateButtonTitle(button,!1))}));var ascending=!0;return sortButton.classList.contains("dir-none")?(sortButton.classList.remove("dir-none"),sortButton.classList.add("dir-asc")):sortButton.classList.contains("dir-asc")?(sortButton.classList.remove("dir-asc"),sortButton.classList.add("dir-desc"),ascending=!1):sortButton.classList.contains("dir-desc")&&(sortButton.classList.remove("dir-desc"),sortButton.classList.add("dir-asc")),updateButtonTitle(sortButton,ascending),ascending},updateButtonTitle=function(button,ascending){var sortString=ascending?"sortbyxreverse":"sortbyx";return(0,_str.get_string)(button.dataset.string,"contentbank").then((function(columnName){return(0,_str.get_string)(sortString,"core",columnName)})).then((function(sortByString){return button.setAttribute("title",sortByString),sortByString})).catch()},updateSortOrder=function(fileArea,itemList,attribute,ascending){[].slice.call(itemList).sort((function(a,b){var aa=a.getAttribute(attribute),bb=b.getAttribute(attribute);return isNaN(aa)||(aa=parseInt(aa),bb=parseInt(bb)),ascending?aa>bb?1:-1:aa<bb?1:-1})).forEach((function(listItem){return fileArea.appendChild(listItem)}))}}));
/**
 * Module to manage content bank actions, such as delete or rename.
 *
 * @module     core_contentbank/actions
 * @package    core_contentbank
 * @copyright  2020 Sara Arjona <sara@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_contentbank/actions",["jquery","core/ajax","core/notification","core/str","core/templates","core/url","core/modal_factory","core/modal_events"],(function($,Ajax,Notification,Str,Templates,Url,ModalFactory,ModalEvents){var ACTIONS_DELETE_CONTENT='[data-action="deletecontent"]',ACTIONS_RENAME_CONTENT='[data-action="renamecontent"]',Actions=function(){this.registerEvents()};return Actions.prototype.registerEvents=function(){$(ACTIONS_DELETE_CONTENT).click((function(e){e.preventDefault();var contentname=$(this).data("contentname"),contentid=$(this).data("contentid"),contextid=$(this).data("contextid"),strings=[{key:"deletecontent",component:"core_contentbank"},{key:"deletecontentconfirm",component:"core_contentbank",param:{name:contentname}},{key:"delete",component:"core"}],deleteButtonText="";Str.get_strings(strings).then((function(langStrings){var modalTitle=langStrings[0],modalContent=langStrings[1];return deleteButtonText=langStrings[2],ModalFactory.create({title:modalTitle,body:modalContent,type:ModalFactory.types.SAVE_CANCEL,large:!0})})).done((function(modal){modal.setSaveButtonText(deleteButtonText),modal.getRoot().on(ModalEvents.save,(function(){return function(contentid,contextid){var request={methodname:"core_contentbank_delete_content",args:{contentids:{contentid:contentid}}},requestType="success";Ajax.call([request])[0].then((function(data){return data.result?"contentdeleted":(requestType="error","contentnotdeleted")})).done((function(message){var params={contextid:contextid};"success"==requestType?params.statusmsg=message:params.errormsg=message,window.location.href=Url.relativeUrl("contentbank/index.php",params,!1)})).fail(Notification.exception)}(contentid,contextid)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()})).catch(Notification.exception)})),$(ACTIONS_RENAME_CONTENT).click((function(e){e.preventDefault();var contentname=$(this).data("contentname"),contentid=$(this).data("contentid"),saveButtonText="";Str.get_strings([{key:"renamecontent",component:"core_contentbank"},{key:"rename",component:"core_contentbank"}]).then((function(langStrings){var modalTitle=langStrings[0];return saveButtonText=langStrings[1],ModalFactory.create({title:modalTitle,body:Templates.render("core_contentbank/renamecontent",{contentid:contentid,name:contentname}),type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){modal.setSaveButtonText(saveButtonText),modal.getRoot().on(ModalEvents.save,(function(e){var newname=$("#newname").val().trim();if(newname)!function(contentid,name){var request={methodname:"core_contentbank_rename_content",args:{contentid:contentid,name:name}},requestType="success";Ajax.call([request])[0].then((function(data){return data.result?"contentrenamed":(requestType="error",data.warnings[0].message)})).then((function(message){var params=null;"success"==requestType?(params={id:contentid,statusmsg:message},window.location.href=Url.relativeUrl("contentbank/view.php",params,!1)):(Notification.addNotification({message:message,type:"error"}),Notification.fetchNotifications())})).catch(Notification.exception)}(contentid,newname);else{Str.get_strings([{key:"error"},{key:"emptynamenotallowed",component:"core_contentbank"}]).then((function(langStrings){Notification.alert(langStrings[0],langStrings[1])})).catch(Notification.exception),e.preventDefault()}})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()})).catch(Notification.exception)}))},{init:function(){return new Actions}}}));
define("core_contentbank/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Define all of the selectors we will be using on the contentbank interface.
   *
   * @module     core_contentbank/selectors
   * @package    core_contentbank
   * @copyright  2020 Sara Arjona <sara@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var getDataSelector=function(name,value){return"[data-".concat(name,'="').concat(value,'"]')},_default={regions:{cbcontentname:getDataSelector("region","cb-content-name"),contentbank:getDataSelector("region","contentbank"),filearea:getDataSelector("region","filearea")},actions:{search:getDataSelector("action","searchcontent"),clearSearch:getDataSelector("action","clearsearchcontent"),viewgrid:getDataSelector("action","viewgrid"),viewlist:getDataSelector("action","viewlist"),sortname:getDataSelector("action","sortname"),sortdate:getDataSelector("action","sortdate"),sortsize:getDataSelector("action","sortsize"),sorttype:getDataSelector("action","sorttype")},elements:{listitem:".cb-listitem",cbnavbarbreadcrumb:".cb-navbar-breadbrumb",cbnavbartotalsearch:".cb-navbar-totalsearch",clearsearch:".input-group-append .clear-icon",searchicon:".input-group-append .search-icon",searchinput:"#searchinput",sortbutton:".cb-btnsort"}};return _exports.default=_default,_exports.default}));
/**
 * A javascript module to handle course ajax actions.
 *
 * @module     core_course/repository
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_course/repository",["jquery","core/ajax"],(function($,Ajax){return{getEnrolledCoursesByTimelineClassification:function(classification,limit,offset,sort){var args={classification:classification};void 0!==limit&&(args.limit=limit),void 0!==offset&&(args.offset=offset),void 0!==sort&&(args.sort=sort);var request={methodname:"core_course_get_enrolled_courses_by_timeline_classification",args:args};return Ajax.call([request])[0]},getLastAccessedCourses:function(userid,limit,offset,sort){var args={};void 0!==userid&&(args.userid=userid),void 0!==limit&&(args.limit=limit),void 0!==offset&&(args.offset=offset),void 0!==sort&&(args.sort=sort);var request={methodname:"core_course_get_recent_courses",args:args};return Ajax.call([request])[0]},getUsersFromCourseModuleID:function(cmid,groupID){var request={methodname:"core_course_get_enrolled_users_by_cmid",args:{cmid:cmid,groupid:groupID}};return Ajax.call([request])[0]}}}));
define("core_course/local/activitychooser/repository",["exports","core/ajax"],(function(_exports,_ajax){var obj;
/**
   *
   * @module     core_course/repository
   * @package    core_course
   * @copyright  2019 Mathew May <mathew.solutions>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.unfavouriteModule=_exports.fetchFooterData=_exports.favouriteModule=_exports.activityModules=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};_exports.activityModules=function(courseid){var request={methodname:"core_course_get_course_content_items",args:{courseid:courseid}};return _ajax.default.call([request])[0]};_exports.favouriteModule=function(modName,modID){var request={methodname:"core_course_add_content_item_to_user_favourites",args:{componentname:modName,contentitemid:modID}};return _ajax.default.call([request])[0]};_exports.unfavouriteModule=function(modName,modID){var request={methodname:"core_course_remove_content_item_from_user_favourites",args:{componentname:modName,contentitemid:modID}};return _ajax.default.call([request])[0]};_exports.fetchFooterData=function(courseid,sectionid){var request={methodname:"core_course_get_activity_chooser_footer",args:{courseid:courseid,sectionid:sectionid}};return _ajax.default.call([request])[0]}}));
define("core_course/local/activitychooser/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Define all of the selectors we will be using on the grading interface.
   *
   * @module     core_course/local/chooser/selectors
   * @package    core_course
   * @copyright  2019 Mathew May <mathew.solutions>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var getDataSelector=function(name,value){return"[data-".concat(name,'="').concat(value,'"]')},_default={regions:{chooser:getDataSelector("region","chooser-container"),getSectionChooserOptions:function(containerid){return"".concat(containerid," ").concat(getDataSelector("region","chooser-options-container"))},chooserOption:{container:getDataSelector("region","chooser-option-container"),actions:getDataSelector("region","chooser-option-actions-container"),info:getDataSelector("region","chooser-option-info-container")},chooserSummary:{container:getDataSelector("region","chooser-option-summary-container"),content:getDataSelector("region","chooser-option-summary-content-container"),header:getDataSelector("region","summary-header"),actions:getDataSelector("region","chooser-option-summary-actions-container")},carousel:getDataSelector("region","carousel"),help:getDataSelector("region","help"),modules:getDataSelector("region","modules"),favouriteTabNav:getDataSelector("region","favourite-tab-nav"),defaultTabNav:getDataSelector("region","default-tab-nav"),activityTabNav:getDataSelector("region","activity-tab-nav"),favouriteTab:getDataSelector("region","favourites"),recommendedTab:getDataSelector("region","recommended"),defaultTab:getDataSelector("region","default"),activityTab:getDataSelector("region","activity"),resourceTab:getDataSelector("region","resources"),getModuleSelector:function(modname){return'[role="menuitem"][data-modname="'.concat(modname,'"]')},searchResults:getDataSelector("region","search-results-container"),searchResultItems:getDataSelector("region","search-result-items-container")},actions:{optionActions:{showSummary:getDataSelector("action","show-option-summary"),manageFavourite:getDataSelector("action","manage-module-favourite")},addChooser:getDataSelector("action","add-chooser-option"),closeOption:getDataSelector("action","close-chooser-option-summary"),hide:getDataSelector("action","hide"),search:getDataSelector("action","search"),clearSearch:getDataSelector("action","clearsearch")},render:{favourites:getDataSelector("render","favourites-area")},elements:{section:".section",sectionmodchooser:"button.section-modchooser-link",sitemenu:".block_site_main_menu",sitetopic:"div.sitetopic",tab:'a[data-toggle="tab"]',activetab:'a[data-toggle="tab"][aria-selected="true"]',visibletabs:'a[data-toggle="tab"]:not(.d-none)',searchicon:".input-group-append .search-icon",clearsearch:".input-group-append .clear"}};return _exports.default=_default,_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_course/local/activitychooser/dialogue",["exports","jquery","core/modal_events","core_course/local/activitychooser/selectors","core/templates","core/key_codes","core/loadingicon","core_course/local/activitychooser/repository","core/notification","core/utils"],(function(_exports,_jquery,ModalEvents,_selectors,Templates,_key_codes,_loadingicon,Repository,_notification,_utils){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.displayChooser=void 0,_jquery=_interopRequireDefault(_jquery),ModalEvents=_interopRequireWildcard(ModalEvents),_selectors=_interopRequireDefault(_selectors),Templates=_interopRequireWildcard(Templates),Repository=_interopRequireWildcard(Repository),_notification=_interopRequireDefault(_notification);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var _ref3,_ref6,_ref7,getPlugin=function(pluginName){return"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require([pluginName],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require(pluginName)):Promise.resolve(_systemImportTransformerGlobalIdentifier[pluginName])},showModuleHelp=function(carousel,moduleData){var modal=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==modal&&!0===moduleData.showFooter&&modal.setFooter(Templates.render("core_course/local/activitychooser/footer_partial",moduleData));var help=carousel.find(_selectors.default.regions.help)[0];help.innerHTML="",help.classList.add("m-auto");var spinnerPromise=(0,_loadingicon.addIconToContainer)(help),transitionPromiseResolver=null,transitionPromise=new Promise((function(resolve){transitionPromiseResolver=resolve})),contentPromise=Templates.renderForPromise("core_course/local/activitychooser/help",moduleData);Promise.all([contentPromise,spinnerPromise,transitionPromise]).then((function(_ref){var _ref2$=_slicedToArray(_ref,1)[0],html=_ref2$.html,js=_ref2$.js;return Templates.replaceNodeContents(help,html,js)})).then((function(){return help.querySelector(_selectors.default.regions.chooserSummary.header).focus(),help})).catch(_notification.default.exception),carousel.one("slid.bs.carousel",(function(){transitionPromiseResolver()})),carousel.carousel("next")},manageFavouriteState=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee(modalBody,caller,partialFavourite){var isFavourite,id,name,internal;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(isFavourite=caller.dataset.favourited,id=caller.dataset.id,name=caller.dataset.name,internal=caller.dataset.internal,"true"!==isFavourite){_context.next=10;break}return _context.next=7,Repository.unfavouriteModule(name,id);case 7:partialFavourite(internal,!1,modalBody),_context.next=13;break;case 10:return _context.next=12,Repository.favouriteModule(name,id);case 12:partialFavourite(internal,!0,modalBody);case 13:case"end":return _context.stop()}}),_callee)}))),function(_x,_x2,_x3){return _ref3.apply(this,arguments)}),initChooserOptionsKeyboardNavigation=function(body,mappedModules,chooserOptionsContainer){var modal=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,chooserOptions=chooserOptionsContainer.querySelectorAll(_selectors.default.regions.chooserOption.container);Array.from(chooserOptions).forEach((function(element){return element.addEventListener("keydown",(function(e){if((e.keyCode===_key_codes.enter||e.keyCode===_key_codes.space)&&e.target.matches(_selectors.default.actions.optionActions.showSummary)){e.preventDefault();var moduleName=e.target.closest(_selectors.default.regions.chooserOption.container).dataset.modname,moduleData=mappedModules.get(moduleName),carousel=(0,_jquery.default)(body.querySelector(_selectors.default.regions.carousel));carousel.carousel({interval:!1,pause:!0,keyboard:!1}),moduleData.showFooter=modal.hasFooterContent(),showModuleHelp(carousel,moduleData,modal)}if(e.keyCode===_key_codes.arrowRight){e.preventDefault();var currentOption=e.target.closest(_selectors.default.regions.chooserOption.container),nextOption=currentOption.nextElementSibling,firstOption=chooserOptionsContainer.firstElementChild,toFocusOption=clickErrorHandler(nextOption,firstOption);focusChooserOption(toFocusOption,currentOption)}if(e.keyCode===_key_codes.arrowLeft){e.preventDefault();var _currentOption=e.target.closest(_selectors.default.regions.chooserOption.container),previousOption=_currentOption.previousElementSibling,lastOption=chooserOptionsContainer.lastElementChild,_toFocusOption=clickErrorHandler(previousOption,lastOption);focusChooserOption(_toFocusOption,_currentOption)}if(e.keyCode===_key_codes.home){e.preventDefault();var _currentOption2=e.target.closest(_selectors.default.regions.chooserOption.container),_firstOption=chooserOptionsContainer.firstElementChild;focusChooserOption(_firstOption,_currentOption2)}if(e.keyCode===_key_codes.end){e.preventDefault();var _currentOption3=e.target.closest(_selectors.default.regions.chooserOption.container),_lastOption=chooserOptionsContainer.lastElementChild;focusChooserOption(_lastOption,_currentOption3)}}))}))},focusChooserOption=function(currentChooserOption){var previousChooserOption=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==previousChooserOption&&toggleFocusableChooserOption(previousChooserOption,!1),toggleFocusableChooserOption(currentChooserOption,!0),currentChooserOption.focus()},toggleFocusableChooserOption=function(chooserOption,isFocusable){var chooserOptionLink=chooserOption.querySelector(_selectors.default.actions.addChooser),chooserOptionHelp=chooserOption.querySelector(_selectors.default.actions.optionActions.showSummary),chooserOptionFavourite=chooserOption.querySelector(_selectors.default.actions.optionActions.manageFavourite);isFocusable?(chooserOption.tabIndex=0,chooserOptionLink.tabIndex=0,chooserOptionHelp.tabIndex=0,chooserOptionFavourite.tabIndex=0):(chooserOption.tabIndex=-1,chooserOptionLink.tabIndex=-1,chooserOptionHelp.tabIndex=-1,chooserOptionFavourite.tabIndex=-1)},clickErrorHandler=function(item,fallback){return null!==item?item:fallback},renderSearchResults=(_ref6=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(searchResultsContainer,searchResultsData){var templateData,_yield$Templates$rend,html,js;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return templateData={searchresultsnumber:searchResultsData.length,searchresults:searchResultsData},_context4.next=3,Templates.renderForPromise("core_course/local/activitychooser/search_results",templateData);case 3:return _yield$Templates$rend=_context4.sent,html=_yield$Templates$rend.html,js=_yield$Templates$rend.js,_context4.next=8,Templates.replaceNodeContents(searchResultsContainer,html,js);case 8:case"end":return _context4.stop()}}),_callee4)}))),function(_x6,_x7){return _ref6.apply(this,arguments)}),toggleSearchResultsView=(_ref7=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(modal,mappedModules,searchQuery){var modalBody,searchResultsContainer,chooserContainer,clearSearchButton,searchIcon,searchResultsData,searchResultItemsContainer,firstSearchResultItem;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(modalBody=modal.getBody()[0],searchResultsContainer=modalBody.querySelector(_selectors.default.regions.searchResults),chooserContainer=modalBody.querySelector(_selectors.default.regions.chooser),clearSearchButton=modalBody.querySelector(_selectors.default.elements.clearsearch),searchIcon=modalBody.querySelector(_selectors.default.elements.searchicon),!(searchQuery.length>0)){_context5.next=18;break}return searchResultsData=searchModules(mappedModules,searchQuery),_context5.next=9,renderSearchResults(searchResultsContainer,searchResultsData);case 9:searchResultItemsContainer=searchResultsContainer.querySelector(_selectors.default.regions.searchResultItems),(firstSearchResultItem=searchResultItemsContainer.querySelector(_selectors.default.regions.chooserOption.container))&&(toggleFocusableChooserOption(firstSearchResultItem,!0),initChooserOptionsKeyboardNavigation(modalBody,mappedModules,searchResultItemsContainer,modal)),searchIcon.classList.add("d-none"),clearSearchButton.classList.remove("d-none"),chooserContainer.setAttribute("hidden","hidden"),searchResultsContainer.removeAttribute("hidden"),_context5.next=22;break;case 18:clearSearchButton.classList.add("d-none"),searchIcon.classList.remove("d-none"),searchResultsContainer.setAttribute("hidden","hidden"),chooserContainer.removeAttribute("hidden");case 22:case"end":return _context5.stop()}}),_callee5)}))),function(_x8,_x9,_x10){return _ref7.apply(this,arguments)}),searchModules=function(modules,searchTerm){if(""===searchTerm)return modules;searchTerm=searchTerm.toLowerCase();var searchResults=[];return modules.forEach((function(activity){var activityName=activity.title.toLowerCase(),activityDesc=activity.help.toLowerCase();(activityName.includes(searchTerm)||activityDesc.includes(searchTerm))&&searchResults.push(activity)})),searchResults},disableFocusAllChooserOptions=function(sectionChooserOptions){sectionChooserOptions.querySelectorAll(_selectors.default.regions.chooserOption.container).forEach((function(chooserOption){toggleFocusableChooserOption(chooserOption,!1)}))};_exports.displayChooser=function(modalPromise,sectionModules,partialFavourite,footerData){var mappedModules=new Map;sectionModules.forEach((function(module){mappedModules.set(module.componentname+"_"+module.link,module)})),modalPromise.then((function(modal){return function(modal,mappedModules,partialFavourite,footerData){var _ref4,_ref5,bodyClickListener=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(e){var carousel,module,moduleName,moduleData,caller,activeSectionId,sectionChooserOptions,firstChooserOption,_carousel,searchInput;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(e.target.closest(_selectors.default.actions.optionActions.showSummary)&&(carousel=(0,_jquery.default)(modal.getBody()[0].querySelector(_selectors.default.regions.carousel)),module=e.target.closest(_selectors.default.regions.chooserOption.container),moduleName=module.dataset.modname,(moduleData=mappedModules.get(moduleName)).showFooter=modal.hasFooterContent(),showModuleHelp(carousel,moduleData,modal)),!e.target.closest(_selectors.default.actions.optionActions.manageFavourite)){_context2.next=10;break}return caller=e.target.closest(_selectors.default.actions.optionActions.manageFavourite),_context2.next=5,manageFavouriteState(modal.getBody()[0],caller,partialFavourite);case 5:activeSectionId=modal.getBody()[0].querySelector(_selectors.default.elements.activetab).getAttribute("href"),sectionChooserOptions=modal.getBody()[0].querySelector(_selectors.default.regions.getSectionChooserOptions(activeSectionId)),firstChooserOption=sectionChooserOptions.querySelector(_selectors.default.regions.chooserOption.container),toggleFocusableChooserOption(firstChooserOption,!0),initChooserOptionsKeyboardNavigation(modal.getBody()[0],mappedModules,sectionChooserOptions,modal);case 10:e.target.matches(_selectors.default.actions.closeOption)&&((_carousel=(0,_jquery.default)(modal.getBody()[0].querySelector(_selectors.default.regions.carousel))).carousel("prev"),_carousel.on("slid.bs.carousel",(function(){modal.getBody()[0].querySelector(_selectors.default.regions.modules).querySelector(_selectors.default.regions.getModuleSelector(e.target.dataset.modname)).focus()}))),e.target.closest(_selectors.default.actions.clearSearch)&&((searchInput=modal.getBody()[0].querySelector(_selectors.default.actions.search)).value="",searchInput.focus(),toggleSearchResultsView(modal,mappedModules,searchInput.value));case 12:case"end":return _context2.stop()}}),_callee2)}))),function(_x4){return _ref4.apply(this,arguments)}),footerClickListener=(_ref5=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(e){var footerjs;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!0!==footerData.footer){_context3.next=6;break}return _context3.next=3,getPlugin(footerData.customfooterjs);case 3:return footerjs=_context3.sent,_context3.next=6,footerjs.footerClickListener(e,footerData,modal);case 6:case"end":return _context3.stop()}}),_callee3)}))),function(_x5){return _ref5.apply(this,arguments)});modal.getBodyPromise().then((function(body){return body[0]})).then((function(body){return(0,_jquery.default)(body.querySelector(_selectors.default.regions.carousel)).carousel({interval:!1,pause:!0,keyboard:!1}),body})).then((function(body){return body.addEventListener("click",bodyClickListener),body})).then((function(body){var searchInput=body.querySelector(_selectors.default.actions.search);return searchInput.addEventListener("input",(0,_utils.debounce)((function(){toggleSearchResultsView(modal,mappedModules,searchInput.value)}),300)),body})).then((function(body){var activeSectionId=body.querySelector(_selectors.default.elements.activetab).getAttribute("href"),sectionChooserOptions=body.querySelector(_selectors.default.regions.getSectionChooserOptions(activeSectionId)),firstChooserOption=sectionChooserOptions.querySelector(_selectors.default.regions.chooserOption.container);return toggleFocusableChooserOption(firstChooserOption,!0),initChooserOptionsKeyboardNavigation(body,mappedModules,sectionChooserOptions,modal),body})).catch(),modal.getFooterPromise().then((function(footer){return footer[0]})).then((function(footer){return footer.addEventListener("click",footerClickListener),footer})).catch()}(modal,mappedModules,partialFavourite,footerData),function(modal,mappedModules){modal.getModal()[0].tabIndex=-1,modal.getBodyPromise().then((function(body){(0,_jquery.default)(_selectors.default.elements.tab).on("shown.bs.tab",(function(e){var activeSectionId=e.target.getAttribute("href"),activeSectionChooserOptions=body[0].querySelector(_selectors.default.regions.getSectionChooserOptions(activeSectionId)),firstChooserOption=activeSectionChooserOptions.querySelector(_selectors.default.regions.chooserOption.container),prevActiveSectionId=e.relatedTarget.getAttribute("href"),prevActiveSectionChooserOptions=body[0].querySelector(_selectors.default.regions.getSectionChooserOptions(prevActiveSectionId));disableFocusAllChooserOptions(prevActiveSectionChooserOptions),toggleFocusableChooserOption(firstChooserOption,!0),initChooserOptionsKeyboardNavigation(body[0],mappedModules,activeSectionChooserOptions,modal)}))})).catch(_notification.default.exception)}(modal,mappedModules),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal})).catch()}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_course/activitychooser",["exports","core_course/local/activitychooser/dialogue","core_course/local/activitychooser/repository","core_course/local/activitychooser/selectors","core/custom_interaction_events","core/templates","core/modal_factory","core/str","core/pending"],(function(_exports,ChooserDialogue,Repository,_selectors,_custom_interaction_events,Templates,ModalFactory,_str,_pending){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,ChooserDialogue=_interopRequireWildcard(ChooserDialogue),Repository=_interopRequireWildcard(Repository),_selectors=_interopRequireDefault(_selectors),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),Templates=_interopRequireWildcard(Templates),ModalFactory=_interopRequireWildcard(ModalFactory),_pending=_interopRequireDefault(_pending);_exports.init=function(courseId,chooserConfig){var pendingPromise=new _pending.default;registerListenerEvents(courseId,chooserConfig),pendingPromise.resolve()};var registerListenerEvents=function(courseId,chooserConfig){var innerPromise,footerInnerPromise,events=["click",_custom_interaction_events.default.events.activate,_custom_interaction_events.default.events.keyboardActivate],fetchModuleData=(innerPromise=null,function(){return innerPromise||(innerPromise=new Promise((function(resolve){resolve(Repository.activityModules(courseId))}))),innerPromise}),fetchFooterData=(footerInnerPromise=null,function(sectionId){return footerInnerPromise||(footerInnerPromise=new Promise((function(resolve){resolve(Repository.fetchFooterData(courseId,sectionId))}))),footerInnerPromise});_custom_interaction_events.default.define(document,events),events.forEach((function(event){var _ref;document.addEventListener(event,(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(e){var caller,sectionDiv,button,bodyPromiseResolver,bodyPromise,footerData,sectionModal,data,builtModuleData;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!e.target.closest(_selectors.default.elements.sectionmodchooser)){_context2.next=21;break}return sectionDiv=e.target.closest(_selectors.default.elements.section),button=e.target.closest(_selectors.default.elements.sectionmodchooser),caller=null!==sectionDiv&&sectionDiv.hasAttribute("data-sectionid")?sectionDiv:button,bodyPromise=new Promise((function(resolve){bodyPromiseResolver=resolve})),_context2.next=7,fetchFooterData(caller.dataset.sectionid);case 7:return footerData=_context2.sent,sectionModal=buildModal(bodyPromise,footerData),_context2.next=11,fetchModuleData().catch(function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee(e){var errorTemplateData;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return errorTemplateData={errormessage:e.message},_context.t0=bodyPromiseResolver,_context.next=4,Templates.render("core_course/local/activitychooser/error",errorTemplateData);case 4:_context.t1=_context.sent,(0,_context.t0)(_context.t1);case 6:case"end":return _context.stop()}}),_callee)})));return function(_x2){return _ref2.apply(this,arguments)}}());case 11:if(data=_context2.sent){_context2.next=14;break}return _context2.abrupt("return");case 14:return builtModuleData=sectionIdMapper(data,caller.dataset.sectionid,caller.dataset.sectionreturnid),ChooserDialogue.displayChooser(sectionModal,builtModuleData,partiallyAppliedFavouriteManager(data,caller.dataset.sectionid),footerData),_context2.t0=bodyPromiseResolver,_context2.next=19,Templates.render("core_course/activitychooser",templateDataBuilder(builtModuleData,chooserConfig));case 19:_context2.t1=_context2.sent,(0,_context2.t0)(_context2.t1);case 21:case"end":return _context2.stop()}}),_callee2)}))),function(_x){return _ref.apply(this,arguments)}))}))},sectionIdMapper=function(webServiceData,id,sectionreturnid){var newData=JSON.parse(JSON.stringify(webServiceData));return newData.content_items.forEach((function(module){module.link+="&section="+id+"&sr="+(null!=sectionreturnid?sectionreturnid:0)})),newData.content_items},templateDataBuilder=function(data,chooserConfig){var activities=[],resources=[],showAll=!0,showActivities=!1,showResources=!1,tabMode=parseInt(chooserConfig.tabmode),favourites=data.filter((function(mod){return!0===mod.favourite})),recommended=data.filter((function(mod){return!0===mod.recommended}));0!==tabMode&&2!==tabMode||1===tabMode||(activities=data.filter((function(mod){return 0===mod.archetype})),resources=data.filter((function(mod){return 1===mod.archetype})),showActivities=!0,showResources=!0,2===tabMode&&(showAll=!1));var favouritesFirst=!!favourites.length;return{default:data,showAll:showAll,activities:activities,showActivities:showActivities,activitiesFirst:!1===showAll&&!1===favouritesFirst,resources:resources,showResources:showResources,favourites:favourites,recommended:recommended,favouritesFirst:favouritesFirst,fallback:!0===showAll&&!1===favouritesFirst}},buildModal=function(bodyPromise,footer){return ModalFactory.create({type:ModalFactory.types.DEFAULT,title:(0,_str.get_string)("addresourceoractivity"),body:bodyPromise,footer:footer.customfootertemplate,large:!0,templateContext:{classes:"modchooser"}}).then((function(modal){return modal.show(),modal}))},nullFavouriteDomManager=function(favouriteTabNav,modalBody){if(favouriteTabNav.tabIndex=-1,favouriteTabNav.classList.add("d-none"),favouriteTabNav.classList.contains("active")){favouriteTabNav.classList.remove("active"),favouriteTabNav.setAttribute("aria-selected","false"),modalBody.querySelector(_selectors.default.regions.favouriteTab).classList.remove("active");var defaultTabNav=modalBody.querySelector(_selectors.default.regions.defaultTabNav),activitiesTabNav=modalBody.querySelector(_selectors.default.regions.activityTabNav);if(!1===defaultTabNav.classList.contains("d-none"))defaultTabNav.classList.add("active"),defaultTabNav.setAttribute("aria-selected","true"),defaultTabNav.tabIndex=0,defaultTabNav.focus(),modalBody.querySelector(_selectors.default.regions.defaultTab).classList.add("active");else activitiesTabNav.classList.add("active"),activitiesTabNav.setAttribute("aria-selected","true"),activitiesTabNav.tabIndex=0,activitiesTabNav.focus(),modalBody.querySelector(_selectors.default.regions.activityTab).classList.add("active")}},partiallyAppliedFavouriteManager=function(moduleData,sectionId){return _ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(internal,favourite,modalBody){var favouriteArea,favouriteButtons,favouriteTabNav,result,newFaves,builtFaves,_yield$Templates$rend,html,js,nodeToRemove;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(favouriteArea=modalBody.querySelector(_selectors.default.render.favourites),favouriteButtons=modalBody.querySelectorAll('[data-internal="'.concat(internal,'"] ').concat(_selectors.default.actions.optionActions.manageFavourite)),favouriteTabNav=modalBody.querySelector(_selectors.default.regions.favouriteTabNav),result=moduleData.content_items.find((function(_ref4){return _ref4.name===internal})),newFaves={},!result){_context3.next=27;break}if(!favourite){_context3.next=21;break}return result.favourite=!0,newFaves.content_items=moduleData.content_items.filter((function(mod){return!0===mod.favourite})),builtFaves=sectionIdMapper(newFaves,sectionId),_context3.next=12,Templates.renderForPromise("core_course/local/activitychooser/favourites",{favourites:builtFaves});case 12:return _yield$Templates$rend=_context3.sent,html=_yield$Templates$rend.html,js=_yield$Templates$rend.js,_context3.next=17,Templates.replaceNodeContents(favouriteArea,html,js);case 17:Array.from(favouriteButtons).forEach((function(element){element.classList.remove("text-muted"),element.classList.add("text-primary"),element.dataset.favourited="true",element.setAttribute("aria-pressed",!0),element.firstElementChild.classList.remove("fa-star-o"),element.firstElementChild.classList.add("fa-star")})),favouriteTabNav.classList.remove("d-none"),_context3.next=27;break;case 21:result.favourite=!1,(nodeToRemove=favouriteArea.querySelector('[data-internal="'.concat(internal,'"]'))).parentNode.removeChild(nodeToRemove),Array.from(favouriteButtons).forEach((function(element){element.classList.add("text-muted"),element.classList.remove("text-primary"),element.dataset.favourited="false",element.setAttribute("aria-pressed",!1),element.firstElementChild.classList.remove("fa-star"),element.firstElementChild.classList.add("fa-star-o")})),0===moduleData.content_items.filter((function(mod){return!0===mod.favourite})).length&&nullFavouriteDomManager(favouriteTabNav,modalBody);case 27:case"end":return _context3.stop()}}),_callee3)}))),function(_x3,_x4,_x5){return _ref3.apply(this,arguments)};var _ref3}}));
define("core_course/recommendations",["exports","core/ajax","core/notification"],(function(_exports,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * A javascript module to handle toggling activity chooser recommendations.
   *
   * @module     core_course/recommendations
   * @copyright  2020 Adrian Greeve <adrian@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);var toggleRecommendation=function(e){var data={methodname:"core_course_toggle_activity_recommendation",args:{area:e.currentTarget.dataset.area,id:e.currentTarget.dataset.id}};_ajax.default.call([data])[0].fail(_notification.default.exception)};_exports.init=function(){document.querySelectorAll("[data-area]").forEach((function(checkbox){checkbox.addEventListener("change",toggleRecommendation)}))}}));
/**
 * Various actions on modules and sections in the editing mode - hiding, duplicating, deleting, etc.
 *
 * @module     core_course/actions
 * @package    core
 * @copyright  2016 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.3
 */
define("core_course/actions",["jquery","core/ajax","core/templates","core/notification","core/str","core/url","core/yui","core/modal_factory","core/modal_events","core/key_codes","core/log"],(function($,ajax,templates,notification,str,url,Y,ModalFactory,ModalEvents,KeyCodes,log){var CSS_EDITINPROGRESS="editinprogress",CSS_EDITINGMOVE="editing_move",SELECTOR={ACTIVITYLI:"li.activity",ACTIONAREA:".actions",ACTIVITYACTION:"a.cm-edit-action",MENU:".moodle-actionmenu[data-enhance=moodle-core-actionmenu]",TOGGLE:".toggle-display,.dropdown-toggle",SECTIONLI:"li.section",SECTIONACTIONMENU:".section_action_menu",ADDSECTIONS:"#changenumsections [data-add-sections]"};Y.use("moodle-course-coursebase",(function(){var courseformatselector=M.course.format.get_section_selector();courseformatselector&&(SELECTOR.SECTIONLI=courseformatselector)}));var getModuleId=function(element){var id;return Y.use("moodle-course-util",(function(Y){id=Y.Moodle.core_course.util.cm.getId(Y.Node(element.get(0)))})),id},addActivitySpinner=function(activity){activity.addClass(CSS_EDITINPROGRESS);var actionarea=activity.find(SELECTOR.ACTIONAREA).get(0);if(actionarea){var spinner=M.util.add_spinner(Y,Y.Node(actionarea));return spinner.show(),spinner}return null},addSectionLightbox=function(sectionelement){var lightbox=M.util.add_lightbox(Y,Y.Node(sectionelement.get(0)));return lightbox.show(),lightbox},removeSpinner=function(element,spinner,delay){window.setTimeout((function(){element.removeClass(CSS_EDITINPROGRESS),spinner&&spinner.hide()}),delay)},removeLightbox=function(lightbox,delay){lightbox&&window.setTimeout((function(){lightbox.hide()}),delay)},initActionMenu=function(elementid){Y.use("moodle-course-coursebase",(function(){M.course.coursebase.invoke_function("setup_for_resource","#"+elementid)})),M.core.actionmenu&&M.core.actionmenu.newDOMNode&&M.core.actionmenu.newDOMNode(Y.one("#"+elementid))},editModule=function(moduleElement,cmid,target){var lightbox,action=target.attr("data-action"),spinner=addActivitySpinner(moduleElement),promises=ajax.call([{methodname:"core_course_edit_module",args:{id:cmid,action:action,sectionreturn:target.attr("data-sectionreturn")?target.attr("data-sectionreturn"):0}}],!0);"duplicate"===action&&(lightbox=addSectionLightbox(target.closest(SELECTOR.SECTIONLI))),$.when.apply($,promises).done((function(data){var mainElement,tabables,isInside,foundElement,elementToFocus=(mainElement=moduleElement,tabables=$("a:visible"),isInside=!1,foundElement=null,tabables.each((function(){if($.contains(mainElement[0],this))isInside=!0;else if(isInside)return foundElement=this,!1})),foundElement);moduleElement.replaceWith(data),$("<div>"+data+"</div>").find(SELECTOR.ACTIVITYLI).each((function(index){initActionMenu($(this).attr("id")),0===index&&(!function(elementId,action){var mainelement=$("#"+elementId),selector="[data-action="+action+"]";"groupsseparate"!==action&&"groupsvisible"!==action&&"groupsnone"!==action||(selector="[data-action=groupsseparate],[data-action=groupsvisible],[data-action=groupsnone]"),mainelement.find(selector).is(":visible")?mainelement.find(selector).focus():mainelement.find(SELECTOR.MENU).find(SELECTOR.TOGGLE).focus()}($(this).attr("id"),action),elementToFocus=null)})),elementToFocus&&elementToFocus.focus(),removeSpinner(moduleElement,spinner,400),removeLightbox(lightbox,400),moduleElement.trigger($.Event("coursemoduleedited",{ajaxreturn:data,action:action}))})).fail((function(ex){removeSpinner(moduleElement,spinner),removeLightbox(lightbox);var e=$.Event("coursemoduleeditfailed",{exception:ex,action:action});moduleElement.trigger(e),e.isDefaultPrevented()||notification.exception(ex)}))},confirmDeleteModule=function(mainelement,onconfirm){var element,name,modtypename=mainelement.attr("class").match(/modtype_([^\s]*)/)[1],modulename=(element=mainelement,Y.use("moodle-course-util",(function(Y){name=Y.Moodle.core_course.util.cm.getName(Y.Node(element.get(0)))})),name);str.get_string("pluginname",modtypename).done((function(pluginname){var plugindata={type:pluginname,name:modulename};str.get_strings([{key:"confirm"},{key:null===modulename?"deletechecktype":"deletechecktypename",param:plugindata},{key:"yes"},{key:"no"}]).done((function(s){notification.confirm(s[0],s[1],s[2],s[3],onconfirm)}))}))},replaceActionItem=function(actionitem,image,stringname,stringcomponent,newaction){var stringRequests=[{key:stringname,component:stringcomponent}];return str.get_strings(stringRequests).then((function(strings){return actionitem.find("span.menu-action-text").html(strings[0]),templates.renderPix(image,"core")})).then((function(pixhtml){actionitem.find(".icon").replaceWith(pixhtml),actionitem.attr("data-action",newaction)})).catch(notification.exception)},replaceActivityHtmlWith=function(activityHTML){$("<div>"+activityHTML+"</div>").find(SELECTOR.ACTIVITYLI).each((function(){var id=$(this).attr("id");$(SELECTOR.ACTIVITYLI+"#"+id).replaceWith(activityHTML),initActionMenu(id)}))},editSection=function(sectionElement,sectionid,target,courseformat){var action=target.attr("data-action"),sectionreturn=target.attr("data-sectionreturn")?target.attr("data-sectionreturn"):0,spinner=function(sectionelement){sectionelement.addClass(CSS_EDITINPROGRESS);var actionarea=sectionelement.find(SELECTOR.SECTIONACTIONMENU).get(0);if(actionarea){var spinner=M.util.add_spinner(Y,Y.Node(actionarea));return spinner.show(),spinner}return null}(sectionElement),promises=ajax.call([{methodname:"core_course_edit_section",args:{id:sectionid,action:action,sectionreturn:sectionreturn}}],!0),lightbox=addSectionLightbox(sectionElement);$.when.apply($,promises).done((function(dataencoded){var data=$.parseJSON(dataencoded);removeSpinner(sectionElement,spinner),removeLightbox(lightbox),sectionElement.find(SELECTOR.SECTIONACTIONMENU).find(SELECTOR.TOGGLE).focus();var e=$.Event("coursesectionedited",{ajaxreturn:data,action:action});sectionElement.trigger(e),e.isDefaultPrevented()||function(sectionElement,actionItem,data,courseformat){var action=actionItem.attr("data-action");if("hide"===action||"show"===action){if("hide"===action?(sectionElement.addClass("hidden"),replaceActionItem(actionItem,"i/show","showfromothers","format_"+courseformat,"show")):(sectionElement.removeClass("hidden"),replaceActionItem(actionItem,"i/hide","hidefromothers","format_"+courseformat,"hide")),void 0!==data.modules)for(var i in data.modules)replaceActivityHtmlWith(data.modules[i]);void 0!==data.section_availability&&sectionElement.find(".section_availability").first().replaceWith(data.section_availability)}else if("setmarker"===action){var oldmarker=$(SELECTOR.SECTIONLI+".current"),oldActionItem=oldmarker.find(SELECTOR.SECTIONACTIONMENU+" a[data-action=removemarker]");oldmarker.removeClass("current"),replaceActionItem(oldActionItem,"i/marker","highlight","core","setmarker"),sectionElement.addClass("current"),replaceActionItem(actionItem,"i/marked","highlightoff","core","removemarker")}else"removemarker"===action&&(sectionElement.removeClass("current"),replaceActionItem(actionItem,"i/marker","highlight","core","setmarker"))}(sectionElement,target,data,courseformat)})).fail((function(ex){removeSpinner(sectionElement,spinner),removeLightbox(lightbox);var e=$.Event("coursesectioneditfailed",{exception:ex,action:action});sectionElement.trigger(e),e.isDefaultPrevented()||notification.exception(ex)}))};return Y.use("moodle-course-coursebase",(function(){M.course.coursebase.register_module({set_visibility_resource_ui:function(args){var mainelement=$(args.element.getDOMNode()),cmid=getModuleId(mainelement);if(cmid){var sectionreturn=mainelement.find("."+CSS_EDITINGMOVE).attr("data-sectionreturn");!function(activityElement,cmid,sectionreturn){var spinner=addActivitySpinner(activityElement),promises=ajax.call([{methodname:"core_course_get_module",args:{id:cmid,sectionreturn:sectionreturn}}],!0);$.when.apply($,promises).done((function(data){removeSpinner(activityElement,spinner,400),replaceActivityHtmlWith(data)})).fail((function(){removeSpinner(activityElement,spinner)}))}(mainelement,cmid,sectionreturn)}}})})),{initCoursePage:function(courseformat){$("body").on("click keypress",SELECTOR.ACTIVITYLI+" "+SELECTOR.ACTIVITYACTION+"[data-action]",(function(e){if("keypress"!==e.type||13===e.keyCode){var actionItem=$(this),moduleElement=actionItem.closest(SELECTOR.ACTIVITYLI),action=actionItem.attr("data-action"),moduleId=getModuleId(moduleElement);switch(action){case"moveleft":case"moveright":case"delete":case"duplicate":case"hide":case"stealth":case"show":case"groupsseparate":case"groupsvisible":case"groupsnone":break;default:return}moduleId&&(e.preventDefault(),"delete"===action?confirmDeleteModule(moduleElement,(function(){editModule(moduleElement,moduleId,actionItem)})):editModule(moduleElement,moduleId,actionItem))}})),$("body").on("click keypress",SELECTOR.SECTIONLI+" "+SELECTOR.SECTIONACTIONMENU+"[data-sectionid] a[data-action]",(function(e){if("keypress"!==e.type||13===e.keyCode){var message,onconfirm,actionItem=$(this),sectionElement=actionItem.closest(SELECTOR.SECTIONLI),sectionId=actionItem.closest(SELECTOR.SECTIONACTIONMENU).attr("data-sectionid");e.preventDefault(),actionItem.attr("data-confirm")?(message=actionItem.attr("data-confirm"),onconfirm=function(){editSection(sectionElement,sectionId,actionItem,courseformat)},str.get_strings([{key:"confirm"},{key:"yes"},{key:"no"}]).done((function(s){notification.confirm(s[0],message,s[1],s[2],onconfirm)}))):editSection(sectionElement,sectionId,actionItem,courseformat)}})),str.get_string("numberweeks").done((function(strNumberSections){var trigger=$(SELECTOR.ADDSECTIONS),modalTitle=trigger.attr("data-add-sections"),newSections=trigger.attr("data-new-sections"),modalBody=$('<div><label for="add_section_numsections"></label> <input id="add_section_numsections" type="number" min="1" max="'+newSections+'" value="1"></div>');modalBody.find("label").html(strNumberSections),ModalFactory.create({title:modalTitle,type:ModalFactory.types.SAVE_CANCEL,body:modalBody.html()},trigger).done((function(modal){var numSections=$(modal.getBody()).find("#add_section_numsections"),addSections=function(){""+parseInt(numSections.val())===numSections.val()&&parseInt(numSections.val())>=1&&(document.location=trigger.attr("href")+"&numsections="+parseInt(numSections.val()))};modal.setSaveButtonText(modalTitle),modal.getRoot().on(ModalEvents.shown,(function(){numSections.focus().select().on("keydown",(function(e){e.keyCode===KeyCodes.enter&&addSections()}))})),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),addSections()}))}))}))},replaceSectionActionItem:function(sectionelement,selector,image,stringname,stringcomponent,newaction){log.debug("replaceSectionActionItem() is deprecated and will be removed.");var actionitem=sectionelement.find(SELECTOR.SECTIONACTIONMENU+" "+selector);replaceActionItem(actionitem,image,stringname,stringcomponent,newaction)}}}));
/**
 * Contain the events the course component can trigger.
 *
 * @module     core_course/events
 * @package    core_course
 * @copyright  2018 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_course/events",[],(function(){return{favourited:"core_course:favourited",unfavorited:"core_course:unfavorited"}}));
/**
 * This module provides the course copy modal from the course and
 * category management screen.
 *
 * @module     course
 * @package    core
 * @copyright  2020 onward The Moodle Users Association <https://moodleassociation.org/>
 * @author     Matt Porritt <mattp@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.9
 */
define("core_course/copy_modal",["jquery","core/str","core/modal_factory","core/modal_events","core/ajax","core/fragment","core/notification","core/config"],(function($,Str,ModalFactory,ModalEvents,ajax,Fragment,Notification,Config){var contextid,course,modalObj,CopyModal={},spinner='<p class="text-center"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i></p>';function updateModalBody(formdata){void 0===formdata&&(formdata={});var params={jsonformdata:JSON.stringify(formdata),courseid:course.id};modalObj.setBody(spinner),Str.get_string("copycoursetitle","backup",course.shortname).then((function(title){modalObj.setTitle(title),modalObj.setBody(Fragment.loadFragment("course","new_base_form",contextid,params))})).catch((function(){Notification.exception(new Error("Failed to load string: copycoursetitle"))}))}function processModalForm(e){e.preventDefault();var copyform=modalObj.getRoot().find("form").serialize(),formjson=JSON.stringify(copyform),invalid=$.merge(modalObj.getRoot().find('[aria-invalid="true"]'),modalObj.getRoot().find(".error"));invalid.length?invalid.first().focus():ajax.call([{methodname:"core_backup_submit_copy_form",args:{jsonformdata:formjson}}])[0].done((function(){if(modalObj.setBody(spinner),modalObj.hide(),1==e.formredirect){var redirect=Config.wwwroot+"/backup/copyprogress.php?id="+course.id;window.location.assign(redirect)}})).fail((function(){updateModalBody(copyform)}))}return CopyModal.init=function(context){contextid=context,Str.get_string("loading").then((function(title){ModalFactory.create({type:ModalFactory.types.DEFAULT,title:title,body:spinner,large:!0}).done((function(modal){(modalObj=modal).getRoot().on("click","#id_submitreturn",processModalForm),modalObj.getRoot().on("click","#id_submitdisplay",(function(e){e.formredirect=!0,processModalForm(e)})),modalObj.getRoot().on("click","#id_cancel",(function(e){e.preventDefault(),modalObj.setBody(spinner),modalObj.hide()}))}))})).catch((function(){Notification.exception(new Error("Failed to load string: loading"))})),$(".action-copy").on("click",(function(e){e.preventDefault();var url=new URL(this.getAttribute("href")),courseid=new URLSearchParams(url.search).get("id");ajax.call([{methodname:"core_course_get_courses",args:{options:{ids:[courseid]}}}])[0].done((function(response){course=response[0],updateModalBody()})).fail((function(){Notification.exception(new Error("Failed to load course"))})),modalObj.show()}))},CopyModal}));
/**
 * This module depends on the real jquery - and returns the non-global version of it.
 *
 * @module     core_customfield/form
 * @package    core_customfield
 * @copyright  2018 Toni Barbera
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_customfield/form",["jquery","core/str","core/notification","core/ajax","core/templates","core/sortable_list","core/pending","core/inplace_editable"],(function($,Str,Notification,Ajax,Templates,SortableList,Pending){var confirmDelete=function(id,type,component,area,itemid){var pendingPromise=new Pending("core_customfield/form:confirmDelete");Str.get_strings([{key:"confirm"},{key:"confirmdelete"+type,component:"core_customfield"},{key:"yes"},{key:"no"}]).then((function(s){Notification.confirm(s[0],s[1],s[2],s[3],(function(){var pendingDeletePromise=new Pending("core_customfield/form:confirmDelete"),func="field"===type?"core_customfield_delete_field":"core_customfield_delete_category";Ajax.call([{methodname:func,args:{id:id}},{methodname:"core_customfield_reload_template",args:{component:component,area:area,itemid:itemid}}])[1].then((function(response){return Templates.render("core_customfield/list",response)})).then((function(html,js){return Templates.replaceNode($('[data-region="list-page"]'),html,js),null})).then(pendingDeletePromise.resolve).catch(Notification.exception)}))})).then(pendingPromise.resolve).catch(Notification.exception)};return{init:function(){var mainlist=$("#customfield_catlist"),component=mainlist.attr("data-component"),area=mainlist.attr("data-area"),itemid=mainlist.attr("data-itemid");$("[data-role=deletefield]").on("click",(function(e){confirmDelete($(this).attr("data-id"),"field",component,area,itemid),e.preventDefault()})),$("[data-role=deletecategory]").on("click",(function(e){confirmDelete($(this).attr("data-id"),"category",component,area,itemid),e.preventDefault()})),$("[data-role=addnewcategory]").on("click",(function(){!function(component,area,itemid){var categoryid,pendingPromise=new Pending("core_customfield/form:confirmDelete"),promises=Ajax.call([{methodname:"core_customfield_create_category",args:{component:component,area:area,itemid:itemid}},{methodname:"core_customfield_reload_template",args:{component:component,area:area,itemid:itemid}}]);promises[0].then((function(response){return categoryid=response,null})).catch(Notification.exception),promises[1].then((function(response){return Templates.render("core_customfield/list",response)})).then((function(html,js){return Templates.replaceNode($('[data-region="list-page"]'),html,js),window.location.href="#category-"+categoryid,null})).catch(Notification.exception),Promise.all(promises).then(pendingPromise.resolve).catch()}(component,area,itemid)}));var categoryName=function(element){return element.closest("[data-category-id]").find("[data-inplaceeditable][data-itemtype=category][data-component=core_customfield]").attr("data-value")};new SortableList($("#customfield_catlist .categorieslist"),{moveHandlerSelector:".movecategory [data-drag-type=move]"}).getElementName=function(el){return $.Deferred().resolve(categoryName(el))},$("[data-category-id]").on("sortablelist-drop",(function(evt,info){if(info.positionChanged){var pendingPromise=new Pending("core_customfield/form:categoryid:on:sortablelist-drop");Ajax.call([{methodname:"core_customfield_move_category",args:{id:info.element.data("category-id"),beforeid:info.targetNextElement.data("category-id")}}])[0].then(pendingPromise.resolve).catch(Notification.exception)}evt.stopPropagation()})),new SortableList($("#customfield_catlist .fieldslist tbody"),{moveHandlerSelector:".movefield [data-drag-type=move]"}).getDestinationName=function(parentElement,afterElement){return afterElement.length?afterElement.attr("data-field-name")?Str.get_string("afterfield","customfield",afterElement.attr("data-field-name")):$.Deferred().resolve(""):Str.get_string("totopofcategory","customfield",categoryName(parentElement))},$("[data-field-name]").on("sortablelist-drop",(function(evt,info){if(evt.stopPropagation(),info.positionChanged){var pendingPromise=new Pending("core_customfield/form:fieldname:on:sortablelist-drop");Ajax.call([{methodname:"core_customfield_move_field",args:{id:info.element.data("field-id"),beforeid:info.targetNextElement.data("field-id"),categoryid:Number(info.targetList.closest("[data-category-id]").attr("data-category-id"))}}])[0].then(pendingPromise.resolve).catch(Notification.exception)}})),$("[data-field-name]").on("sortablelist-drag",(function(evt){var pendingPromise=new Pending("core_customfield/form:fieldname:on:sortablelist-drag");evt.stopPropagation(),Str.get_string("therearenofields","core_customfield").then((function(s){return $("#customfield_catlist .categorieslist").children().each((function(){var fields=$(this).find($(".field")),nofields=$(this).find($(".nofields"));fields.length||nofields.length||$(this).find("tbody").append('<tr class="nofields"><td colspan="5">'+s+"</td></tr>"),fields.length&&nofields.length&&nofields.remove()})),null})).then(pendingPromise.resolve).catch(Notification.exception)})),$("[data-category-id], [data-field-name]").on("sortablelist-dragstart",(function(evt,info){setTimeout((function(){$(".sortable-list-is-dragged").width(info.element.width())}),501)}))}}}));
/**
 * Functionality for the form element defaultcustom
 *
 * @module     core_form/defaultcustom
 * @package    core_form
 * @class      defaultcustom
 * @copyright  2017 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.3
 */
define("core_form/defaultcustom",["jquery"],(function($){$("body").on("change","input[data-defaultcustom=true]",(function(event){var element=$(event.target),defaultvalue=JSON.parse(element.attr("data-defaultvalue")),customvalue=JSON.parse(element.attr("data-customvalue")),type=element.attr("data-type"),form=element.closest("form"),elementName=element.attr("name").replace(/\[customize\]$/,"[value]"),newvalue=element.prop("checked")?customvalue:defaultvalue;"text"===type?form.find('[name="'+elementName+'"]').val(newvalue):"date_selector"===type?(form.find('[name="'+elementName+'[day]"]').val(newvalue.day),form.find('[name="'+elementName+'[month]"]').val(newvalue.month),form.find('[name="'+elementName+'[year]"]').val(newvalue.year)):"date_time_selector"===type&&(form.find('[name="'+elementName+'[day]"]').val(newvalue.day),form.find('[name="'+elementName+'[month]"]').val(newvalue.month),form.find('[name="'+elementName+'[year]"]').val(newvalue.year),form.find('[name="'+elementName+'[hour]"]').val(newvalue.hour),form.find('[name="'+elementName+'[minute]"]').val(newvalue.minute))}))}));
define("core_form/submit",["exports","core_form/events"],(function(_exports,_events){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;
/**
   * Submit button JavaScript. All submit buttons will be automatically disabled once the form is
   * submitted, unless that submission results in an error/cancelling the submit.
   *
   * @module core_form/submit
   * @package core_form
   * @copyright 2019 The Open University
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since 3.8
   */
var cookieListener=0,cookieListeningButtons=[],getCookieName=function(){return"moodledownload_"+M.cfg.sesskey},clearDownloadCookie=function(){document.cookie=encodeURIComponent(getCookieName())+"=deleted; expires="+new Date(0).toUTCString()};_exports.init=function(elementId){var button=document.getElementById(elementId);document.addEventListener(_events.formEventTypes.uploadStarted,(function(e){window.console.log(e.target),button.disabled=!0})),document.addEventListener(_events.formEventTypes.uploadCompleted,(function(e){window.console.log(e.target),button.disabled=!1})),"off"!==button.form.dataset.doubleSubmitProtection&&button.form.addEventListener("submit",(function(event){var disableAction=function(){event.defaultPrevented||button.disabled||(button.disabled=!0,clearDownloadCookie(),function(button){cookieListeningButtons.push(button),cookieListener||(cookieListener=setInterval((function(){2==document.cookie.split(getCookieName()+"=").length&&(clearDownloadCookie(),clearInterval(cookieListener),cookieListener=0,cookieListeningButtons.forEach((function(button){button.disabled=!1})))}),500))}(button))};window.addEventListener("beforeunload",disableAction),setTimeout((function(){window.removeEventListener("beforeunload",disableAction)}),0)}),!1)}}));
/**
 * A class to help show and hide advanced form content.
 *
 * @module     core_form/showadvanced
 * @class      showadvanced
 * @package    core_form
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_form/showadvanced",["jquery","core/log","core/str","core/notification"],(function($,Log,Strings,Notification){var SELECTORS_FIELDSETCONTAINSADVANCED="fieldset.containsadvancedelements",SELECTORS_DIVFITEMADVANCED="div.fitem.advanced",SELECTORS_DIVADVANCEDSECTION="div#form-advanced-div",SELECTORS_MORELESSLINK="fieldset.containsadvancedelements .moreless-toggler",CSS_SHOW="show",CSS_MORELESSACTIONS="moreless-actions",CSS_MORELESSTOGGLER="moreless-toggler",CSS_SHOWLESS="moreless-less",WRAPPERS_FITEM='<div class="fitem"></div>',WRAPPERS_FELEMENT='<div class="felement"></div>',WRAPPERS_ADVANCEDDIV='<div id="form-advanced-div"></div>',uniqIdSeed=0,ShowAdvanced=function(id){this.id=id;var form=$(document.getElementById(id));this.enhanceForm(form)};return ShowAdvanced.prototype.id="",ShowAdvanced.prototype.enhanceForm=function(form){return form.find(SELECTORS_FIELDSETCONTAINSADVANCED).each(function(index,item){this.enhanceFieldset($(item))}.bind(this)),form.on("click",SELECTORS_MORELESSLINK,this.switchState),form.on("keydown",SELECTORS_MORELESSLINK,function(e){return 13!=e.which&&32!=e.which||this.switchState(e)}.bind(this)),this},ShowAdvanced.prototype.generateId=function(node){var id=node.prop("id");return void 0===id&&(id="showadvancedid-"+uniqIdSeed++,node.prop("id",id)),id},ShowAdvanced.prototype.enhanceFieldset=function(fieldset){var statuselement=$("input[name=mform_showmore_"+fieldset.prop("id")+"]");return statuselement.length?(Strings.get_strings([{key:"showmore",component:"core_form"},{key:"showless",component:"core_form"}]).then(function(results){var showmore=results[0],showless=results[1],morelesslink=$('<a href="#"></a>');morelesslink.addClass(CSS_MORELESSTOGGLER),"0"===statuselement.val()?(morelesslink.html(showmore),morelesslink.attr("aria-expanded","false")):(morelesslink.html(showless),morelesslink.attr("aria-expanded","true"),morelesslink.addClass(CSS_SHOWLESS),fieldset.find(SELECTORS_DIVFITEMADVANCED).addClass(CSS_SHOW));var idlist=[];fieldset.find(SELECTORS_DIVFITEMADVANCED).each(function(index,node){idlist[idlist.length]=this.generateId($(node))}.bind(this)),morelesslink.attr("role","button"),morelesslink.attr("aria-controls","form-advanced-div");var formadvancedsection=$(WRAPPERS_ADVANCEDDIV);fieldset.find(SELECTORS_DIVFITEMADVANCED).wrapAll(formadvancedsection);var fitem=$(WRAPPERS_FITEM);fitem.addClass(CSS_MORELESSACTIONS);var felement=$(WRAPPERS_FELEMENT);return felement.append(morelesslink),fitem.append(felement),fieldset.find(SELECTORS_DIVADVANCEDSECTION).before(fitem),!0}.bind(this)).fail(Notification.exception),this):(Log.debug("M.form.showadvanced::processFieldset was called on an fieldset without a status field: '"+fieldset.prop("id")+"'"),this)},ShowAdvanced.prototype.switchState=function(e){return e.preventDefault(),Strings.get_strings([{key:"showmore",component:"core_form"},{key:"showless",component:"core_form"}]).then((function(results){var showmore=results[0],showless=results[1],fieldset=$(e.target).closest(SELECTORS_FIELDSETCONTAINSADVANCED);fieldset.find(SELECTORS_DIVFITEMADVANCED).toggleClass(CSS_SHOW);var statuselement=$("input[name=mform_showmore_"+fieldset.prop("id")+"]");return"0"===statuselement.val()?(statuselement.val(1),$(e.target).addClass(CSS_SHOWLESS),$(e.target).html(showless),$(e.target).attr("aria-expanded","true")):(statuselement.val(0),$(e.target).removeClass(CSS_SHOWLESS),$(e.target).html(showmore),$(e.target).attr("aria-expanded","false")),!0})).fail(Notification.exception),this},{init:function(formid){return new ShowAdvanced(formid)}}}));
define("core_form/events",["exports","core/str"],(function(_exports,_str){
/**
   * Contain the events the form component can trigger.
   *
   * @module core_form/events
   * @package core_form
   * @copyright 2021 Huong Nguyen <huongnv13@gmail.com>
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since 3.10
   */
var changesMadeString;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.triggerUploadStarted=_exports.triggerUploadCompleted=_exports.formEventTypes=void 0,(0,_str.get_string)("changesmadereallygoaway","moodle").then((function(string){return changesMadeString=string,string})).catch();var changesMadeCheck=function(e){e&&(e.returnValue=changesMadeString)},formEventTypes={uploadStarted:"core_form/uploadStarted",uploadCompleted:"core_form/uploadCompleted"};_exports.formEventTypes=formEventTypes;_exports.triggerUploadStarted=function(elementId){window.addEventListener("beforeunload",changesMadeCheck);var customEvent=new CustomEvent(formEventTypes.uploadStarted,{bubbles:!0,cancellable:!1});return document.getElementById(elementId).dispatchEvent(customEvent),customEvent};_exports.triggerUploadCompleted=function(elementId){window.removeEventListener("beforeunload",changesMadeCheck);var customEvent=new CustomEvent(formEventTypes.uploadCompleted,{bubbles:!0,cancellable:!1});return document.getElementById(elementId).dispatchEvent(customEvent),customEvent}}));
/**
 * This module allows to enhance the form elements MoodleQuickForm_filetypes
 *
 * @module     core_form/filetypes
 * @package    core_form
 * @copyright  2017 David Mudrak <david@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.3
 */
define("core_form/filetypes",["jquery","core/log","core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","core/tree"],(function($,Log,Str,ModalFactory,ModalEvents,Ajax,Templates,Tree){var FileTypes=function(elementId,elementLabel,onlyTypes,allowAll){this.elementId=elementId,this.elementLabel=elementLabel,this.onlyTypes=onlyTypes,this.allowAll=allowAll,this.inputField=$("#"+elementId),this.wrapperBrowserTrigger=$('[data-filetypesbrowser="'+elementId+'"]'),this.wrapperDescriptions=$('[data-filetypesdescriptions="'+elementId+'"]'),this.wrapperBrowserTrigger.length&&(this.inputField.length&&this.wrapperDescriptions.length?this.prepareBrowserTrigger().then(function(){return this.prepareBrowserModal()}.bind(this)).then(function(){return this.prepareBrowserTree()}.bind(this)):Log.error("core_form/filetypes: Unexpected DOM structure, unable to enhance filetypes field "+elementId))};return FileTypes.prototype.prepareBrowserTrigger=function(){return Templates.render("core_form/filetypes-trigger",{}).then(function(html){this.wrapperBrowserTrigger.html(html),this.browserTrigger=this.wrapperBrowserTrigger.find('[data-filetypeswidget="browsertrigger"]')}.bind(this))},FileTypes.prototype.prepareBrowserModal=function(){return ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:this.elementLabel}).then(function(modal){this.browserModal=modal}.bind(this)).then(function(){this.browserModal.getRoot().on(ModalEvents.hidden,function(){this.browserTrigger.focus()}.bind(this)),this.browserModal.getRoot().on(ModalEvents.save,function(){this.saveBrowserModal()}.bind(this))}.bind(this))},FileTypes.prototype.prepareBrowserTree=function(){return this.browserTrigger.on("click",function(e){if(e.preventDefault(),!this.inputField.is("[disabled]")){var bodyContent=this.loadBrowserModalBody();bodyContent.then(function(){this.browserTree=new Tree(this.browserModal.getBody()),this.browserTree.handleKeyDown=function(item,e){e.keyCode==this.browserTree.keys.enter||e.keyCode==this.browserTree.keys.space?(e.preventDefault(),e.stopPropagation(),this.toggleCheckbox(item.attr("data-filetypesbrowserkey"))):Tree.prototype.handleKeyDown.call(this.browserTree,item,e)}.bind(this),this.allowAll&&(this.hideOrShowItemsDependingOnAllowAll(this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="*"]').first()),this.browserModal.getRoot().on("change",'input[type="checkbox"][data-filetypesbrowserkey="*"]',function(e){this.hideOrShowItemsDependingOnAllowAll($(e.currentTarget))}.bind(this))),this.browserModal.getRoot().on("change",'input[type="checkbox"][data-filetypesbrowserkey]',function(e){var checkbox=$(e.currentTarget),key=checkbox.attr("data-filetypesbrowserkey");this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="'+key+'"]').prop("checked",checkbox.prop("checked"))}.bind(this))}.bind(this)).then(function(){this.browserModal.show()}.bind(this)),this.browserModal.setBody(bodyContent)}}.bind(this)),$.when()},FileTypes.prototype.loadBrowserModalBody=function(){var args={onlytypes:this.onlyTypes.join(),allowall:this.allowAll,current:this.inputField.val()};return Ajax.call([{methodname:"core_form_get_filetypes_browser_data",args:args}])[0].then(function(browserData){return Templates.render("core_form/filetypes-browser",{elementid:this.elementId,groups:browserData.groups})}.bind(this))},FileTypes.prototype.toggleCheckbox=function(key){var checkbox=this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="'+key+'"]').first();checkbox.prop("checked",!checkbox.prop("checked"))},FileTypes.prototype.saveBrowserModal=function(){if(this.allowAll){var allcheckbox=this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="*"]');if(allcheckbox.length&&allcheckbox.prop("checked"))return this.inputField.val("*"),void this.updateDescriptions(["*"])}var newvalue=[];this.browserModal.getRoot().find('input[type="checkbox"]').each((function(){var checkbox=$(this),key=checkbox.attr("data-filetypesbrowserkey");checkbox.prop("checked")&&newvalue.push(key)})),newvalue=newvalue.filter((function(x,i,a){return a.indexOf(x)==i})),this.inputField.val(newvalue.join(" ")),this.updateDescriptions(newvalue)},FileTypes.prototype.updateDescriptions=function(keys){var descriptions=[];keys.forEach(function(key){descriptions.push({description:this.browserModal.getRoot().find('[data-filetypesname="'+key+'"]').first().text().trim(),extensions:this.browserModal.getRoot().find('[data-filetypesextensions="'+key+'"]').first().text().trim()})}.bind(this));var templatedata={hasdescriptions:descriptions.length>0,descriptions:descriptions};return Templates.render("core_form/filetypes-descriptions",templatedata).then(function(html){this.wrapperDescriptions.html(html)}.bind(this))},FileTypes.prototype.hideOrShowItemsDependingOnAllowAll=function(allcheckbox){var others=this.browserModal.getRoot().find('[role="treeitem"][data-filetypesbrowserkey!="*"]');allcheckbox.prop("checked")?others.hide():others.show()},{init:function(elementId,elementLabel,onlyTypes,allowAll){new FileTypes(elementId,elementLabel,onlyTypes,allowAll)}}}));
/**
 * Password Unmask functionality.
 *
 * @module     core_form/passwordunmask
 * @package    core_form
 * @class      passwordunmask
 * @copyright  2016 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("core_form/passwordunmask",["jquery","core/templates"],(function($,Template){var PasswordUnmask=function(elementid){this.wrapperSelector='[data-passwordunmask="wrapper"][data-passwordunmaskid="'+elementid+'"]',this.wrapper=$(this.wrapperSelector),this.editorSpace=this.wrapper.find('[data-passwordunmask="editor"]'),this.editLink=this.wrapper.find('a[data-passwordunmask="edit"]'),this.editInstructions=this.wrapper.find('[data-passwordunmask="instructions"]'),this.displayValue=this.wrapper.find('[data-passwordunmask="displayvalue"]'),this.inputFieldLabel=$('label[for="'+elementid+'"]'),this.inputField=this.editorSpace.find(document.getElementById(elementid)),this.inputField.attr("type","hidden"),this.inputField.removeClass("hiddenifjs"),this.editInstructions.attr("id")||this.editInstructions.attr("id",elementid+"_instructions"),this.editInstructions.hide(),this.setDisplayValue(),this.addListeners()};return PasswordUnmask.prototype.addListeners=function(){return this.wrapper.on("click keypress",'[data-passwordunmask="edit"]',$.proxy((function(e){"keypress"===e.type&&13!==e.keyCode||(e.stopImmediatePropagation(),e.preventDefault(),"hidden"!==this.inputField.attr("type")?"click"===e.type||$(e.relatedTarget).is(":input")?this.turnEditingOff(!1):this.turnEditingOff(!0):this.turnEditingOn())}),this)),this.wrapper.on("click keypress",'[data-passwordunmask="unmask"]',$.proxy((function(e){"keypress"===e.type&&13!==e.keyCode||(e.stopImmediatePropagation(),e.preventDefault(),this.wrapper.data("unmasked",!this.wrapper.data("unmasked")),this.setDisplayValue())}),this)),this.wrapper.on("keydown","input",$.proxy((function(e){"keydown"===e.type&&13!==e.keyCode||(e.stopImmediatePropagation(),e.preventDefault(),this.turnEditingOff(!0))}),this)),this.inputFieldLabel.on("click",$.proxy((function(e){e.preventDefault(),this.turnEditingOn()}),this)),this},PasswordUnmask.prototype.checkFocusOut=function(e){this.isEditing()&&window.setTimeout($.proxy((function(){var relatedTarget=e.relatedTarget||document.activeElement;this.wrapper.has($(relatedTarget)).length||this.turnEditingOff(!$(relatedTarget).is(":input,a"))}),this),100)},PasswordUnmask.prototype.passwordVisible=function(){return!!this.wrapper.data("unmasked")},PasswordUnmask.prototype.isEditing=function(){return"hidden"!==this.inputField.attr("type")},PasswordUnmask.prototype.turnEditingOn=function(){var value=this.getDisplayValue();return this.passwordVisible()?this.inputField.attr("type","text"):this.inputField.attr("type","password"),this.inputField.val(value),this.inputField.attr("size",this.inputField.attr("data-size")),this.editInstructions.length&&(this.inputField.attr("aria-describedby",this.editInstructions.attr("id")),this.editInstructions.show()),this.wrapper.attr("data-passwordunmask-visible",1),this.editLink.hide(),this.inputField.focus().select(),$("body").on("focusout",this.wrapperSelector,$.proxy(this.checkFocusOut,this)),this},PasswordUnmask.prototype.turnEditingOff=function(focusOnEditLink){$("body").off("focusout",this.wrapperSelector,this.checkFocusOut);var value=this.getDisplayValue();return this.inputField.attr("type","hidden").attr("aria-describedby",null),this.inputField.val(value),this.editInstructions.hide(),this.wrapper.removeAttr("data-passwordunmask-visible"),this.inputField.removeAttr("size"),this.editLink.show(),this.setDisplayValue(),focusOnEditLink&&this.editLink.focus(),this},PasswordUnmask.prototype.getDisplayValue=function(){return this.inputField.val()},PasswordUnmask.prototype.setDisplayValue=function(){var value=this.getDisplayValue();return this.isEditing()&&(this.wrapper.data("unmasked")?this.inputField.attr("type","text"):this.inputField.attr("type","password"),this.inputField.val(value)),value&&this.wrapper.data("unmasked")?this.displayValue.text(value):(value||(value=""),Template.render("core_form/element-passwordunmask-fill",{element:{frozen:this.inputField.is("[readonly]"),value:value,valuechars:value.split("")}}).done($.proxy((function(html,js){this.displayValue.html(html),Template.runTemplateJS(js)}),this))),this},PasswordUnmask}));
define("core_grades/grades/grader/gradingpanel/repository",["exports","core/ajax","./normalise"],(function(_exports,_ajax,_normalise){function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.saveGrade=_exports.fetchGrade=void 0;_exports.fetchGrade=function(type){return function(component,contextid,itemname,gradeduserid){return(0,_ajax.call)([{methodname:"core_grades_grader_gradingpanel_".concat(type,"_fetch"),args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid}}])[0]}};_exports.saveGrade=function(type){return fn=regeneratorRuntime.mark((function _callee(component,contextid,itemname,gradeduserid,notifyUser,formdata){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.t0=_normalise.normaliseResult,_context.next=3,(0,_ajax.call)([{methodname:"core_grades_grader_gradingpanel_".concat(type,"_store"),args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid,notifyuser:notifyUser,formdata:formdata}}])[0];case 3:return _context.t1=_context.sent,_context.abrupt("return",(0,_context.t0)(_context.t1));case 5:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4,_x5,_x6){return _ref.apply(this,arguments)};var fn,_ref}}));
define("core_grades/grades/grader/gradingpanel/normalise",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.normaliseResult=_exports.invalidResult=_exports.failedUpdate=void 0;_exports.normaliseResult=function(result){return{result:result,failed:!!result.warnings.length,success:!result.warnings.length,error:null}};_exports.invalidResult=function(){return{success:!1,failed:!1,result:{},error:null}};_exports.failedUpdate=function(error){return{success:!1,failed:!0,result:{},error:error}}}));
define("core_grades/grades/grader/gradingpanel/comparison",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.fillInitialValues=_exports.compareData=void 0;
/**
   * Compare a given form's values and its previously set data attributes.
   *
   * @module     core_grades/grades/grader/gradingpanel/comparison
   * @package    core_grades
   * @copyright  2019 Mathew May <mathew.solutions>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var fillInitialValues=function(form){Array.prototype.forEach.call(form.elements,(function(input){"submit"!==input.type&&"button"!==input.type&&("radio"===input.type||"checkbox"===input.type?input.dataset.initialValue=JSON.stringify(input.checked):void 0!==input.value?input.dataset.initialValue=JSON.stringify(input.value):"select-one"===input.type&&Array.prototype.forEach.call(input.options,(function(option){option.dataset.initialValue=JSON.stringify(option.selected)})))}))};_exports.fillInitialValues=fillInitialValues;_exports.compareData=function(form){var result=Array.prototype.some.call(form.elements,(function(input){if("submit"===input.type||"button"===input.type)return!1;if("radio"===input.type||"checkbox"===input.type){if(void 0!==input.dataset.initialValue)return input.dataset.initialValue!==JSON.stringify(input.checked)}else if(void 0!==input.value){if(void 0!==input.dataset.initialValue)return input.dataset.initialValue!==JSON.stringify(input.value)}else if("select-one"===input.type)return Array.prototype.some.call(input.options,(function(option){return void 0!==option.dataset.initialValue&&option.dataset.initialValue!==JSON.stringify(option.selected)}));return!0}));return fillInitialValues(form),result}}));
define("core_grades/grades/grader/gradingpanel/point",["exports","./repository","core_grades/grades/grader/gradingpanel/comparison","jquery","./normalise"],(function(_exports,_repository,_comparison,_jquery,_normalise){var obj;function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.storeCurrentGrade=_exports.fetchCurrentGrade=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.fetchCurrentGrade=function(){return(0,_repository.fetchGrade)("point").apply(void 0,arguments)};var fn,_ref,storeCurrentGrade=(fn=regeneratorRuntime.mark((function _callee(component,context,itemname,userId,notifyUser,rootNode){var form,grade;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(form=rootNode.querySelector("form"),(grade=form.querySelector('input[name="grade"]')).checkValidity()&&grade.value.trim()){_context.next=4;break}return _context.abrupt("return",_normalise.invalidResult);case 4:if(!0!==(0,_comparison.compareData)(form)){_context.next=10;break}return _context.next=7,(0,_repository.saveGrade)("point")(component,context,itemname,userId,notifyUser,(0,_jquery.default)(form).serialize());case 7:return _context.abrupt("return",_context.sent);case 10:return _context.abrupt("return","");case 11:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4,_x5,_x6){return _ref.apply(this,arguments)});_exports.storeCurrentGrade=storeCurrentGrade}));
define("core_grades/grades/grader/gradingpanel/scale",["exports","./repository","core_grades/grades/grader/gradingpanel/comparison","jquery","./normalise"],(function(_exports,_repository,_comparison,_jquery,_normalise){var obj;
/**
   * Grading panel for simple direct grading.
   *
   * @module     core_grades/grades/grader/gradingpanel/scale
   * @package    core_grades
   * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.storeCurrentGrade=_exports.fetchCurrentGrade=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.fetchCurrentGrade=function(){return(0,_repository.fetchGrade)("scale").apply(void 0,arguments)};_exports.storeCurrentGrade=function(component,context,itemname,userId,notifyUser,rootNode){var form=rootNode.querySelector("form"),grade=form.querySelector('select[name="grade"]');return grade.checkValidity()&&grade.value.trim()?!0===(0,_comparison.compareData)(form)?(0,_repository.saveGrade)("scale")(component,context,itemname,userId,notifyUser,(0,_jquery.default)(form).serialize()):"":_normalise.invalidResult}}));
/**
 * Enhance the gradebook tree setup with various facilities.
 *
 * @module     core_grades/edittree_index
 * @package    core_grades
 * @copyright  2016 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_grades/edittree_index",["jquery"],(function($){var edittree=function edittree(){$("body").on("change",".weightoverride",edittree.toggleWeightInput),$("#menumoveafter").on("change",(function(){var form=$(this).closest("form");form.find("#bulkmoveinput").val(1),form.submit()}))};return edittree.toggleWeightInput=function(e){e.preventDefault();var node=$(this),row=node.closest("tr");$('input[name="weight_'+row.data("itemid")+'"]').prop("disabled",!node.prop("checked"))},{enhance:edittree}}));
define("core_h5p/editor_display",["exports","jquery"],(function(_exports,_jquery){var obj;
/**
   * This module handles the display of the H5P authoring tool.
   *
   * @module     core_h5p/editor_display
   * @package    core_h5p
   * @copyright  2020 Victor Deniz <victor@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.init=function(elementId){var editorwrapper=(0,_jquery.default)("#"+elementId),editor=(0,_jquery.default)(".h5p-editor"),mform=editor.closest("form"),editorupload=(0,_jquery.default)("h5p-editor-upload"),h5plibrary=(0,_jquery.default)('input[name="h5plibrary"]'),h5pparams=(0,_jquery.default)('input[name="h5pparams"]'),inputname=(0,_jquery.default)('input[name="name"]'),h5paction=(0,_jquery.default)('input[name="h5paction"]');h5paction.val("create"),H5PEditor.init(mform,h5paction,editorupload,editorwrapper,editor,h5plibrary,h5pparams,"",inputname,(function($button){return $button.is('[name="cancel"]')})),document.querySelector("#"+elementId+" iframe").setAttribute("name","h5p-editor")}}));
/**
 * Controls the group info page of the message drawer.
 *
 * @module     core_message/message_drawer_view_group_info
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_group_info",["jquery","core/str","core/templates","core_message/message_repository","core_message/message_drawer_lazy_load_list"],(function($,Str,Templates,Repository,LazyLoadList){var SELECTORS_CONTENT_CONTAINER='[data-region="group-info-content-container"]',TEMPLATES_CONTENT="core_message/message_drawer_view_group_info_body_content",TEMPLATES_MEMBERS_LIST="core_message/message_drawer_view_group_info_participants_list",getContentContainer=function(root){return root.find(SELECTORS_CONTENT_CONTAINER)},renderMembersCallback=function(contentContainer,members){return Templates.render(TEMPLATES_MEMBERS_LIST,{contacts:members}).then((function(html){return contentContainer.append(html),html}))};return{show:function(namespace,header,body,footer,conversation,loggedInUserId){var root=$(body);return getContentContainer(root).empty(),function(root,conversation,loggedInUserId){var placeholderCount=conversation.totalMemberCount>50?50:conversation.totalMemberCount,placeholders=Array.apply(null,Array(placeholderCount)).map((function(){return!0})),templateContext={name:conversation.name,subname:conversation.subname,imageurl:conversation.imageUrl,placeholders:placeholders,loggedinuser:{id:loggedInUserId}};return Templates.render(TEMPLATES_CONTENT,templateContext).then((function(html){return getContentContainer(root).append(html),html}))}(root,conversation,loggedInUserId).then((function(){var listRoot=LazyLoadList.getRoot(root);LazyLoadList.show(listRoot,function(conversation,limit,offset){return function(root,userId){return Repository.getConversationMembers(conversation.id,userId,limit+1,offset).then((function(members){return members.length>limit?members=members.slice(0,-1):LazyLoadList.setLoadedAll(root,!0),offset+=limit,members.filter((function(member){return member.id!=userId}))}))}}(conversation,50,0),renderMembersCallback)}))},description:function(root,conversation){return Str.get_string("messagedrawerviewgroupinfo","core_message",conversation.name)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * This module will take 2 view states from the message_drawer_view_conversation
 * module and generate a patch that can be given to the
 * message_drawer_view_conversation_renderer module to update the UI.
 *
 * This module should never modify either state. It's purely a read only
 * module.
 *
 * @module     core_message/message_drawer_view_conversation_patcher
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core_message/message_drawer_view_conversation_patcher",["jquery","core/user_date","core_message/message_drawer_view_conversation_constants"],(function($,UserDate,Constants){var sortMessagesByDay=function(messages,midnight){var messagesByDay=messages.reduce((function(carry,message){var timeCreated=message.timeCreated?message.timeCreated:midnight,dayTimestamp=UserDate.getUserMidnightForTimestamp(timeCreated,midnight);return carry.hasOwnProperty(dayTimestamp)?carry[dayTimestamp].push(message):carry[dayTimestamp]=[message],carry}),{});return Object.keys(messagesByDay).map((function(dayTimestamp){return{timestamp:dayTimestamp,messages:messagesByDay[dayTimestamp]}}))},diffArrays=function(a,b,matchFunction){b=b.slice();var missingFromB=[],matches=[];return a.forEach((function(current){for(var found=!1,index=0;index<b.length;index++){var next=b[index];if(matchFunction(current,next)){found=!0,matches.push({a:current,b:next});break}}found?b.splice(index,1):missingFromB.push(current)})),{missingFromA:b,missingFromB:missingFromB,matches:matches}},findPositionInArray=function(array,breakFunction){for(var i=0;i<array.length;i++){var candidate=array[i];if(breakFunction(candidate))return candidate}return null},isArrayEqual=function(a,b){a=a.slice(),b=b.slice(),a.sort(),b.sort();var aLength=a.length,bLength=b.length;return aLength<1&&bLength<1||aLength==bLength&&a.every((function(item,index){return item==b[index]}))},isObjectEqual=function isObjectEqual(a,b){var aKeys=Object.keys(a),bKeys=Object.keys(b);return aKeys.length==bKeys.length&&aKeys.every((function(key){var aVal=a[key],bVal=b[key],aType=_typeof(aVal),bType=_typeof(bVal);if(bType=null===aVal?"null":bType,(aType="object"===(aType=null===aVal?"null":aType)&&Array.isArray(aType)?"array":aType)!==(bType="object"===bType&&Array.isArray(bType)?"array":bType))return!1;switch(aType){case"object":return isObjectEqual(aVal,bVal);case"array":return isArrayEqual(aVal,bVal);default:return a[key]==b[key]}}))},isMessageEqual=function(a,b){return isObjectEqual({id:a.id,state:a.sendState,text:a.text,timeCreated:a.timeCreated},{id:b.id,state:b.sendState,text:b.text,timeCreated:b.timeCreated})},buildDaysPatch=function(current,remove,add){return{remove:remove,add:add.map((function(day){return{before:findPositionInArray(current,(function(candidate){return day.timestamp<candidate.timestamp})),value:day}}))}},buildConversationPatch=function(state,newState){var matchingDays,remove,add,update,diff=diffArrays(state.messages,newState.messages,isMessageEqual);if(diff.missingFromA.length||diff.missingFromB.length){var current=sortMessagesByDay(state.messages,state.midnight),next=sortMessagesByDay(newState.messages,newState.midnight),daysDiff=diffArrays(current,next,(function(dayCurrent,dayNext){return dayCurrent.timestamp==dayNext.timestamp}));return{days:buildDaysPatch(current,daysDiff.missingFromB,daysDiff.missingFromA),messages:(matchingDays=daysDiff.matches,remove=[],add=[],update=[],matchingDays.forEach((function(days){var dayCurrent=days.a,dayNext=days.b,messagesDiff=diffArrays(dayCurrent.messages,dayNext.messages,isMessageEqual),patch=diffArrays(messagesDiff.missingFromB,messagesDiff.missingFromA,(function(a,b){return a.id==b.id||a.sendState!=b.sendState&&a.timeAdded==b.timeAdded}));remove=remove.concat(patch.missingFromB),patch.missingFromA.forEach((function(message){var before=null;message.timeCreated&&(before=findPositionInArray(dayCurrent.messages,(function(candidate){return message.timeCreated==candidate.timeCreated?message.id<candidate.id:message.timeCreated<candidate.timeCreated}))),add.push({before:before,value:message,day:dayCurrent})})),update=update.concat(patch.matches.map((function(message){return{before:message.a,after:message.b}})))})),{add:add,remove:remove,update:update})}}return null},buildHeaderPatchTypePrivate=function(state,newState){var requireAddContact=buildRequireAddContact(state,newState),confirmContactRequest=buildConfirmContactRequest(state,newState),oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState),requiresAddContact=requireAddContact&&requireAddContact.show&&!requireAddContact.hasMessages,requiredAddContact=requireAddContact&&!requireAddContact.show,shouldRenderHeader=!oldOtherUser&&newOtherUser;return(shouldRenderHeader=(shouldRenderHeader=shouldRenderHeader||requiresAddContact||requiredAddContact)||null!==confirmContactRequest)?{type:Constants.CONVERSATION_TYPES.PRIVATE,showControls:!requiresAddContact&&!confirmContactRequest,context:{id:newState.id,name:newState.name,subname:newState.subname,totalmembercount:newState.totalMemberCount,imageurl:newState.imageUrl,isfavourite:newState.isFavourite,ismuted:newState.isMuted,showfavourite:null!==newState.id,userid:newOtherUser.id,showonlinestatus:newOtherUser.showonlinestatus,isonline:newOtherUser.isonline,isblocked:newOtherUser.isblocked,iscontact:newOtherUser.iscontact}}:null},buildHeaderPatchTypeSelf=function(state,newState){return null===state.name&&null!==newState.name?{type:Constants.CONVERSATION_TYPES.SELF,showControls:!1,context:{id:newState.id,name:newState.name,subname:newState.subname,imageurl:newState.imageUrl,isfavourite:newState.isFavourite,showfavourite:null!==newState.id,showonlinestatus:!0}}:null},buildHeaderPatchTypePublic=function(state,newState){return state.totalMemberCount!=newState.totalMemberCount?{type:Constants.CONVERSATION_TYPES.PUBLIC,showControls:!0,context:{id:newState.id,name:newState.name,subname:newState.subname,totalmembercount:newState.totalMemberCount,imageurl:newState.imageUrl,isfavourite:newState.isFavourite,ismuted:newState.isMuted,showfavourite:null!==newState.id}}:null},buildScrollToMessagePatch=function(state,newState){var oldMessages=state.messages,newMessages=newState.messages;if(newMessages.length<1)return null;if(oldMessages.length<1)return newMessages[newMessages.length-1].id;var previousNewest=oldMessages[state.messages.length-1],currentNewest=newMessages[newMessages.length-1],previousOldest=oldMessages[0],currentOldest=newMessages[0];return previousNewest.id!=currentNewest.id?currentNewest.id:previousOldest.id!=currentOldest.id?previousOldest.id:null},buildLoadingMembersPatch=function(state,newState){return!(state.loadingMembers||!newState.loadingMembers)||!(state.loadingMembers&&!newState.loadingMembers)&&null},buildLoadingFirstMessages=function(state,newState){return state.hasTriedToLoadMessages===newState.hasTriedToLoadMessages?null:!(newState.hasTriedToLoadMessages||!newState.loadingMessages)||!(newState.hasTriedToLoadMessages&&!newState.loadingMessages)&&null},buildLoadingMessages=function(state,newState){return!(state.loadingMessages||!newState.loadingMessages)||!(state.loadingMessages&&!newState.loadingMessages)&&null},buildShowEmojiPicker=function(state,newState){return!(state.showEmojiPicker||!newState.showEmojiPicker)||!(state.showEmojiPicker&&!newState.showEmojiPicker)&&null},buildShowEmojiAutoComplete=function(state,newState){return!(state.showEmojiAutoComplete||!newState.showEmojiAutoComplete)||!(state.showEmojiAutoComplete&&!newState.showEmojiAutoComplete)&&null},buildConfirmBlockUser=function(state,newState){if(newState.pendingBlockUserIds.length){var userId=newState.pendingBlockUserIds[0];return newState.members[userId]}return!state.pendingBlockUserIds.length&&null},buildConfirmUnblockUser=function(state,newState){if(newState.pendingUnblockUserIds.length){var userId=newState.pendingUnblockUserIds[0];return newState.members[userId]}return!state.pendingUnblockUserIds.length&&null},buildConfirmAddContact=function(state,newState){if(newState.pendingAddContactIds.length){var userId=newState.pendingAddContactIds[0];return newState.members[userId]}return!state.pendingAddContactIds.length&&null},buildConfirmRemoveContact=function(state,newState){if(newState.pendingRemoveContactIds.length){var userId=newState.pendingRemoveContactIds[0];return newState.members[userId]}return!state.pendingRemoveContactIds.length&&null},buildConfirmDeleteSelectedMessages=function(state,newState){var oldPendingCount=state.pendingDeleteMessageIds.length,newPendingCount=newState.pendingDeleteMessageIds.length;return newPendingCount&&!oldPendingCount?{show:!0,type:newState.type,canDeleteMessagesForAllUsers:newState.canDeleteMessagesForAllUsers}:oldPendingCount&&!newPendingCount?{show:!1}:null},buildConfirmDeleteConversation=function(state,newState){return!state.pendingDeleteConversation&&newState.pendingDeleteConversation?newState.type:!(state.pendingDeleteConversation&&!newState.pendingDeleteConversation)&&null},buildConfirmContactRequest=function(state,newState){var loggedInUserId=state.loggedInUserId,oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState),oldReceivedRequests=oldOtherUser?oldOtherUser.contactrequests.filter((function(request){return request.requesteduserid==loggedInUserId&&request.userid==oldOtherUser.id})):[],newReceivedRequests=newOtherUser?newOtherUser.contactrequests.filter((function(request){return request.requesteduserid==loggedInUserId&&request.userid==newOtherUser.id})):[],oldRequest=oldReceivedRequests.length?oldReceivedRequests[0]:null,newRequest=newReceivedRequests.length?newReceivedRequests[0]:null;return!oldRequest&&newRequest?newOtherUser:!(oldRequest&&!newRequest)&&null},buildIsBlocked=function(state,newState){var oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState);return oldOtherUser||newOtherUser?!oldOtherUser&&newOtherUser?!!newOtherUser.isblocked||null:!newOtherUser&&oldOtherUser?!oldOtherUser.isblocked&&null:!(oldOtherUser.isblocked&&!newOtherUser.isblocked)&&(!(oldOtherUser.isblocked||!newOtherUser.isblocked)||null):null},buildIsFavourite=function(state,newState){var oldIsFavourite=state.isFavourite,newIsFavourite=newState.isFavourite;return null===state.id&&null===newState.id?null:null===state.id&&null!==newState.id?"show-add":null!==state.id&&null===newState.id?"hide":oldIsFavourite==newIsFavourite?null:!oldIsFavourite&&newIsFavourite?"show-remove":oldIsFavourite&&!newIsFavourite?"show-add":null},buildIsMuted=function(state,newState){var oldIsMuted=state.isMuted,newIsMuted=newState.isMuted;return null===state.id&&null===newState.id?null:null===state.id&&null!==newState.id?"show-mute":null!==state.id&&null===newState.id?"hide":oldIsMuted==newIsMuted?null:!oldIsMuted&&newIsMuted?"show-unmute":oldIsMuted&&!newIsMuted?"show-mute":null},buildIsContact=function(state,newState){var loggedInUserId=state.loggedInUserId,oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState),oldContactRequests=oldOtherUser?oldOtherUser.contactrequests.filter((function(request){return request.userid==loggedInUserId&&request.requesteduserid==oldOtherUser.id||request.userid==oldOtherUser.id&&request.requesteduserid==loggedInUserId})):[],newContactRequests=newOtherUser?newOtherUser.contactrequests.filter((function(request){return request.userid==loggedInUserId&&request.requesteduserid==newOtherUser.id||request.userid==newOtherUser.id&&request.requesteduserid==loggedInUserId})):[],oldHasContactRequests=oldContactRequests.length>0,newHasContactRequests=newContactRequests.length>0;return oldOtherUser||newOtherUser?oldHasContactRequests&&newHasContactRequests?null:oldHasContactRequests||!newHasContactRequests||newOtherUser.iscontact?!oldOtherUser&&newOtherUser?newOtherUser.iscontact?"contact":null:!newOtherUser&&oldOtherUser?oldOtherUser.iscontact?"non-contact":null:oldOtherUser.iscontact&&!newOtherUser.iscontact?newHasContactRequests?"pending-contact":"non-contact":!oldOtherUser.iscontact&&newOtherUser.iscontact?"contact":null:"pending-contact":null},buildLoadingConfirmationAction=function(state,newState){return!(state.loadingConfirmAction||!newState.loadingConfirmAction)||!(state.loadingConfirmAction&&!newState.loadingConfirmAction)&&null},buildInEditMode=function(state,newState){var oldHasSelectedMessages=state.selectedMessageIds.length>0,newHasSelectedMessages=newState.selectedMessageIds.length>0,numberOfMessagesHasChanged=state.messages.length!=newState.messages.length;return!(oldHasSelectedMessages||!newHasSelectedMessages)||!(oldHasSelectedMessages&&!newHasSelectedMessages)&&(!(!oldHasSelectedMessages||!numberOfMessagesHasChanged)||null)},buildSelectedMessages=function(state,newState){var oldSelectedMessages=state.selectedMessageIds,newSelectedMessages=newState.selectedMessageIds;if(isArrayEqual(oldSelectedMessages,newSelectedMessages))return null;var diff=diffArrays(oldSelectedMessages,newSelectedMessages,(function(a,b){return a==b}));return{count:newSelectedMessages.length,add:diff.missingFromA,remove:diff.missingFromB}},getOtherUserFromState=function(state){return Object.keys(state.members).reduce((function(carry,userId){return userId==state.loggedInUserId||carry||(carry=state.members[userId]),carry}),null)},requiresContactRequest=function(loggedInUserId,user){if(user.canmessage)return!1;var hasSentContactRequest=user.contactrequests.filter((function(request){return request.userid==loggedInUserId||request.requesteduserid})).length>0;return user.requirescontact&&!user.iscontact&&!hasSentContactRequest},buildRequireAddContact=function(state,newState){var oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState),hadMessages=state.messages.length>0,hasMessages=newState.messages.length>0,loggedInUserId=newState.loggedInUserId,prevRequiresContactRequest=oldOtherUser&&requiresContactRequest(loggedInUserId,oldOtherUser),nextRequiresContactRequest=newOtherUser&&requiresContactRequest(loggedInUserId,newOtherUser),finishedAddContact=!1===buildConfirmAddContact(state,newState);if(!state.hasTriedToLoadMessages&&!newState.hasTriedToLoadMessages)return null;if(!oldOtherUser&&!newOtherUser)return null;if(!oldOtherUser&&nextRequiresContactRequest)return{show:!0,hasMessages:hasMessages,user:newOtherUser};if(finishedAddContact&&nextRequiresContactRequest)return{show:!0,hasMessages:hasMessages,user:newOtherUser};if(state.hasTriedToLoadMessages&&newState.hasTriedToLoadMessages){if(!prevRequiresContactRequest&&nextRequiresContactRequest)return{show:!0,hasMessages:hasMessages,user:newOtherUser};if(prevRequiresContactRequest&&!nextRequiresContactRequest)return{show:!1,hasMessages:hasMessages}}return!state.hasTriedToLoadMessages&&newState.hasTriedToLoadMessages&&nextRequiresContactRequest?{show:!0,hasMessages:hasMessages,user:newOtherUser}:state.hasTriedToLoadMessages&&!newState.hasTriedToLoadMessages&&prevRequiresContactRequest?{show:!1,hasMessages:hadMessages}:null},buildFooterPatchTypePrivate=function(state,newState){var loadingFirstMessages=buildLoadingFirstMessages(state,newState),inEditMode=buildInEditMode(state,newState),requireAddContact=buildRequireAddContact(state,newState),requireUnblock=function(state,newState){var oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState);return oldOtherUser||newOtherUser?oldOtherUser&&!newOtherUser?!oldOtherUser.isblocked&&null:!oldOtherUser&&newOtherUser?!!newOtherUser.isblocked||null:!(oldOtherUser.isblocked||!newOtherUser.isblocked)||!(oldOtherUser.isblocked&&!newOtherUser.isblocked)&&null:null}(state,newState),unableToMessage=function(state,newState){var oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState);return newState.type==Constants.CONVERSATION_TYPES.SELF?null:oldOtherUser||newOtherUser?oldOtherUser&&!newOtherUser?!oldOtherUser.canmessage||null:!oldOtherUser&&newOtherUser?!newOtherUser.canmessage||null:!(!oldOtherUser.canmessage&&newOtherUser.canmessage)&&(!(!oldOtherUser.canmessage||newOtherUser.canmessage)||null):null}(state,newState),showRequireAddContact=null!==requireAddContact?requireAddContact.show&&requireAddContact.hasMessages:null,otherUser=getOtherUserFromState(newState),generateReturnValue=function(checkValue,successReturn){if(checkValue)return successReturn;if(null!==checkValue&&!checkValue){if(!otherUser)return{type:"content"};if(otherUser.isblocked)return{type:"unblock"};if(newState.messages.length&&requiresContactRequest(newState.loggedInUserId,otherUser))return{type:"add-contact",user:otherUser};if(!otherUser.canmessage&&otherUser.requirescontact&&!otherUser.iscontact)return{type:"unable-to-message"}}return null};if(null===loadingFirstMessages&&null===inEditMode&&null===requireAddContact&&null===requireUnblock)return null;for(var checks=[[loadingFirstMessages,{type:"placeholder"}],[inEditMode,{type:"edit-mode"}],[unableToMessage,{type:"unable-to-message"}],[requireUnblock,{type:"unblock"}],[showRequireAddContact,{type:"add-contact",user:otherUser}]],i=0;i<checks.length;i++){var result=generateReturnValue(checks[i][0],checks[i][1]);if(null!==result)return result}return{type:"content"}},buildFooterPatchTypePublic=function(state,newState){var loadingFirstMessages=buildLoadingFirstMessages(state,newState),inEditMode=buildInEditMode(state,newState);return null===loadingFirstMessages&&null===inEditMode?null:loadingFirstMessages?{type:"placeholder"}:inEditMode?{type:"edit-mode"}:{type:"content"}},buildReset=function(state,newState){var oldType=state.type,newType=newState.type,oldConversationId=state.id,newConversationId=newState.id,oldMemberIds=Object.keys(state.members),newMemberIds=Object.keys(newState.members);oldMemberIds.sort(),newMemberIds.sort();var membersUnchanged=oldMemberIds.every((function(id,index){return id==newMemberIds[index]}));return oldType!=newType||(!(!oldConversationId||newConversationId)||(!(!oldConversationId||!newConversationId||oldConversationId==newConversationId)||(!(oldConversationId||newConversationId||membersUnchanged)||null)))},buildSelfConversationMessage=function(state,newState){return state.type!=newState.type?newState.type==Constants.CONVERSATION_TYPES.SELF:null},buildContactRequestSent=function(state,newState){var loggedInUserId=newState.loggedInUserId,oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState),oldSentRequests=oldOtherUser?oldOtherUser.contactrequests.filter((function(request){return request.userid==loggedInUserId})):[],newSentRequests=newOtherUser?newOtherUser.contactrequests.filter((function(request){return request.userid==loggedInUserId})):[],oldRequest=oldSentRequests.length>0,newRequest=newSentRequests.length>0,hadMessages=state.messages.length>0,hasMessages=state.messages.length>0;return oldRequest||!newRequest||newOtherUser.iscontact||hasMessages?!(oldOtherUser&&!oldOtherUser.iscontact&&newRequest&&newOtherUser.iscontact)&&(!(oldRequest&&!newRequest)&&(!(!hadMessages&&hasMessages)&&null)):newOtherUser.fullname};return{buildPatch:function(state,newState){var config={all:{reset:buildReset,conversation:buildConversationPatch,scrollToMessage:buildScrollToMessagePatch,loadingMembers:buildLoadingMembersPatch,loadingFirstMessages:buildLoadingFirstMessages,loadingMessages:buildLoadingMessages,confirmDeleteSelectedMessages:buildConfirmDeleteSelectedMessages,inEditMode:buildInEditMode,selectedMessages:buildSelectedMessages,isFavourite:buildIsFavourite,isMuted:buildIsMuted,showEmojiPicker:buildShowEmojiPicker,showEmojiAutoComplete:buildShowEmojiAutoComplete}};config[Constants.CONVERSATION_TYPES.PRIVATE]={header:buildHeaderPatchTypePrivate,footer:buildFooterPatchTypePrivate,confirmBlockUser:buildConfirmBlockUser,confirmUnblockUser:buildConfirmUnblockUser,confirmAddContact:buildConfirmAddContact,confirmRemoveContact:buildConfirmRemoveContact,confirmContactRequest:buildConfirmContactRequest,confirmDeleteConversation:buildConfirmDeleteConversation,isBlocked:buildIsBlocked,isContact:buildIsContact,loadingConfirmAction:buildLoadingConfirmationAction,requireAddContact:buildRequireAddContact,contactRequestSent:buildContactRequestSent},config[Constants.CONVERSATION_TYPES.PUBLIC]={header:buildHeaderPatchTypePublic,footer:buildFooterPatchTypePublic},config[Constants.CONVERSATION_TYPES.SELF]={header:buildHeaderPatchTypeSelf,footer:buildFooterPatchTypePublic,confirmDeleteConversation:buildConfirmDeleteConversation,selfConversationMessage:buildSelfConversationMessage};var patchConfig=$.extend({},config.all);return newState.type&&newState.type in config&&(patchConfig=$.extend(patchConfig,config[newState.type])),Object.keys(patchConfig).reduce((function(patch,key){var value=(0,patchConfig[key])(state,newState);return null!==value&&(patch[key]=value),patch}),{})}}}));
/**
 * Controls the message preference page.
 *
 * @module     core_message/message_preferences
 * @class      message_preferences
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_preferences",["jquery","core/ajax","core/notification","core_message/message_notification_preference","core/custom_interaction_events"],(function($,Ajax,Notification,MessageNotificationPreference,CustomEvents){var SELECTORS_PREFERENCE="[data-state]",SELECTORS_PREFERENCES_CONTAINER='[data-region="preferences-container"]',SELECTORS_CONTACTABLE_PRIVACY_CONTAINER='[data-region="privacy-setting-container"]',MessagePreferences=function(element){this.root=$(element),this.userId=this.root.find(SELECTORS_PREFERENCES_CONTAINER).attr("data-user-id"),this.registerEventListeners()};return MessagePreferences.prototype.preferencesDisabled=function(){return this.root.find(SELECTORS_PREFERENCES_CONTAINER).hasClass("disabled")},MessagePreferences.prototype.saveContactablePrivacySetting=function(){var container=this.root.find(SELECTORS_CONTACTABLE_PRIVACY_CONTAINER),value=$("input[type='radio']:checked").val();if(container.hasClass("loading"))return $.Deferred().resolve();container.addClass("loading");var request={methodname:"core_user_update_user_preferences",args:{userid:this.userId,preferences:[{type:container.attr("data-preference-key"),value:value}]}};return Ajax.call([request])[0].fail(Notification.exception).always((function(){container.removeClass("loading")}))},MessagePreferences.prototype.registerEventListeners=function(){CustomEvents.define(this.root,[CustomEvents.events.activate]),this.root.on("change",function(e){if("message_blocknoncontacts"==e.target.name)this.saveContactablePrivacySetting();else if(!this.preferencesDisabled()){var preferencesContainer=$(e.target).closest(SELECTORS_PREFERENCES_CONTAINER),preferenceElement=$(e.target).closest(SELECTORS_PREFERENCE),messagePreference=new MessageNotificationPreference(preferencesContainer,this.userId);preferenceElement.addClass("loading"),messagePreference.save().always((function(){preferenceElement.removeClass("loading")}))}}.bind(this))},MessagePreferences}));
/**
 * Controls the message popover in the nav bar.
 *
 * @module     core_message/message_popover
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_popover",["jquery","core/custom_interaction_events","core/pubsub","core_message/message_drawer_events"],(function($,CustomEvents,PubSub,MessageDrawerEvents){var SELECTORS_COUNT_CONTAINER='[data-region="count-container"]',handleDecrementConversationCount=function(button){return function(){var countContainer=button.find(SELECTORS_COUNT_CONTAINER),count=parseInt(countContainer.text(),10);isNaN(count)||!count||count<2?countContainer.addClass("hidden"):(count-=1,countContainer.text(count))}},registerEventListeners=function(button){CustomEvents.define(button,[CustomEvents.events.activate]),button.on(CustomEvents.events.activate,(function(e,data){var buttonid;buttonid=button.attr("id"),PubSub.publish(MessageDrawerEvents.TOGGLE_VISIBILITY,buttonid),button.focus(),data.originalEvent.preventDefault()})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_READ,handleDecrementConversationCount(button)),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED,handleDecrementConversationCount(button)),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_DECLINED,handleDecrementConversationCount(button))};return{init:function(button){button=$(button),registerEventListeners(button)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Controls the conversation page in the message drawer.
 *
 * This function handles all of the user actions that the user can take
 * when interacting with the conversation page.
 *
 * It maintains a view state which is a data representation of the view
 * and only operates on that data.
 *
 * The view state is immutable and should never be modified directly. Instead
 * all changes to the view state should be done using the StateManager which
 * will generate a new version of the view state with the requested changes.
 *
 * After any changes to the view state the module will call the render function
 * to ask the renderer to update the UI.
 *
 * General rules for this module:
 * 1.) Never modify viewState directly. All changes should be via the StateManager.
 * 2.) Call render() with the new state when you want to update the UI
 * 3.) Never modify the UI directly in this module. This module is only concerned
 *     with the data in the view state.
 *
 * The general flow for a user interaction will be something like:
 * User interaction: User clicks "confirm block" button to block the other user
 *      1.) This module is hears the click
 *      2.) This module sends a request to the server to block the user
 *      3.) The server responds with the new user profile
 *      4.) This module generates a new state using the StateManager with the updated
 *          user profile.
 *      5.) This module asks the Patcher to generate a patch from the current state and
 *          the newly generated state. This patch tells the renderer what has changed
 *          between the states.
 *      6.) This module gives the Renderer the generated patch. The renderer updates
 *          the UI with changes according to the patch.
 *
 * @module     core_message/message_drawer_view_conversation
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core_message/message_drawer_view_conversation",["jquery","core/auto_rows","core/backoff_timer","core/custom_interaction_events","core/notification","core/pending","core/pubsub","core/str","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_view_conversation_constants","core_message/message_drawer_view_conversation_patcher","core_message/message_drawer_view_conversation_renderer","core_message/message_drawer_view_conversation_state_manager","core_message/message_drawer_router","core_message/message_drawer_routes","core/emoji/auto_complete","core/emoji/picker"],(function($,AutoRows,BackOffTimer,CustomEvents,Notification,Pending,PubSub,Str,Repository,MessageDrawerEvents,Constants,Patcher,Renderer,StateManager,MessageDrawerRouter,MessageDrawerRoutes,initialiseEmojiAutoComplete,initialiseEmojiPicker){var stateCache={},viewState=null,loadedAllMessages=!1,messagesOffset=0,newMessagesPollTimer=null,isRendering=!1,renderBuffer=[],isResetting=!0,isSendingMessage=!1,isDeletingConversationContent=!1,sendMessageBuffer=[],render=null,renderers=[],NEWEST_FIRST=Constants.NEWEST_MESSAGES_FIRST,LOAD_MESSAGE_LIMIT=Constants.LOAD_MESSAGE_LIMIT,MILLISECONDS_IN_SEC=Constants.MILLISECONDS_IN_SEC,SELECTORS=Constants.SELECTORS,CONVERSATION_TYPES=Constants.CONVERSATION_TYPES,getOtherUserId=function(){if(!viewState||viewState.type==CONVERSATION_TYPES.PUBLIC)return null;var loggedInUserId=viewState.loggedInUserId;if(viewState.type==CONVERSATION_TYPES.SELF)return loggedInUserId;var otherUserIds=Object.keys(viewState.members).filter((function(userId){return loggedInUserId!=userId}));return otherUserIds.length?otherUserIds[0]:null},getMessagesOffset=function(){return messagesOffset},setMessagesOffset=function(value){messagesOffset=value,stateCache[viewState.id].messagesOffset=value},hasLoadedAllMessages=function(){return loadedAllMessages},setLoadedAllMessages=function(value){loadedAllMessages=value,stateCache[viewState.id].loadedAllMessages=value},formatConversationForEvent=function(state){return{id:state.id,name:state.name,subname:state.subname,imageUrl:state.imageUrl,isFavourite:state.isFavourite,isMuted:state.isMuted,type:state.type,totalMemberCount:state.totalMemberCount,loggedInUserId:state.loggedInUserId,messages:state.messages.map((function(message){return $.extend({},message)})),members:Object.keys(state.members).map((function(id){var formattedMember=$.extend({},state.members[id]);return formattedMember.contactrequests=state.members[id].contactrequests.map((function(request){return $.extend({},request)})),formattedMember}))}},updateStateFromConversation=function(conversation,loggedInUserId){var otherUser=null;if(conversation.type==CONVERSATION_TYPES.PRIVATE){var otherUsers=conversation.members.filter((function(member){return member.id!=loggedInUserId}));otherUser=otherUsers.length?otherUsers[0]:null}else conversation.type==CONVERSATION_TYPES.SELF&&(otherUser=conversation.members[0]);var name=conversation.name,imageUrl=conversation.imageurl;conversation.type!=CONVERSATION_TYPES.PUBLIC&&(name=name||otherUser?otherUser.fullname:"",imageUrl=imageUrl||otherUser?otherUser.profileimageurl:"");var newState=StateManager.addMembers(viewState,conversation.members);return newState=StateManager.setName(newState,name),newState=StateManager.setSubname(newState,conversation.subname),newState=StateManager.setType(newState,conversation.type),newState=StateManager.setImageUrl(newState,imageUrl),newState=StateManager.setTotalMemberCount(newState,conversation.membercount),newState=StateManager.setIsFavourite(newState,conversation.isfavourite),newState=StateManager.setIsMuted(newState,conversation.ismuted),newState=StateManager.addMessages(newState,conversation.messages),newState=StateManager.setCanDeleteMessagesForAllUsers(newState,conversation.candeletemessagesforallusers)},loadMessages=function(conversationId,limit,offset,newestFirst,ignoreList,timeFrom){return Repository.getMessages(viewState.loggedInUserId,conversationId,limit?limit+1:limit,offset,newestFirst,timeFrom).then((function(result){return result.id!=viewState.id&&(result.messages=[],result.id in stateCache&&delete stateCache[result.id]),result})).then((function(result){return result.messages.length&&ignoreList.length&&(result.messages=result.messages.filter((function(message){return ignoreList.indexOf(parseInt(message.id,10))<0}))),result})).then((function(result){return limit?(result.messages.length>limit?result.messages=result.messages.slice(0,-1):setLoadedAllMessages(!0),result):result})).then((function(result){var membersToAdd=result.members.filter((function(member){return!(member.id in viewState.members)})),newState=StateManager.addMembers(viewState,membersToAdd);return newState=StateManager.addMessages(newState,result.messages),newState=StateManager.setLoadingMessages(newState,!1),render(newState).then((function(){return result}))})).catch((function(error){var newState=StateManager.setLoadingMessages(viewState,!1);throw render(newState),error}))},markConversationAsRead=function(conversationId){var loggedInUserId=viewState.loggedInUserId,pendingPromise=new Pending("core_message/message_drawer_view_conversation:markConversationAsRead");return Repository.markAllConversationMessagesAsRead(loggedInUserId,conversationId).then((function(){var newState=StateManager.markMessagesAsRead(viewState,viewState.messages);return PubSub.publish(MessageDrawerEvents.CONVERSATION_READ,conversationId),render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},requestBlockUser=function(userId){cancelRequest(userId);var newState=StateManager.addPendingBlockUsersById(viewState,[userId]);render(newState)},blockUser=function(userId){var newState=StateManager.setLoadingConfirmAction(viewState,!0),pendingPromise=new Pending("core_message/message_drawer_view_conversation:blockUser");return render(newState),Repository.blockUser(viewState.loggedInUserId,userId).then((function(profile){var newState=StateManager.addMembers(viewState,[profile]);return newState=StateManager.removePendingBlockUsersById(newState,[userId]),newState=StateManager.setLoadingConfirmAction(newState,!1),PubSub.publish(MessageDrawerEvents.CONTACT_BLOCKED,userId),render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},requestUnblockUser=function(userId){cancelRequest(userId);var newState=StateManager.addPendingUnblockUsersById(viewState,[userId]);render(newState)},unblockUser=function(userId){var newState=StateManager.setLoadingConfirmAction(viewState,!0),pendingPromise=new Pending("core_message/message_drawer_view_conversation:unblockUser");return render(newState),Repository.unblockUser(viewState.loggedInUserId,userId).then((function(profile){var newState=StateManager.addMembers(viewState,[profile]);return newState=StateManager.removePendingUnblockUsersById(newState,[userId]),newState=StateManager.setLoadingConfirmAction(newState,!1),PubSub.publish(MessageDrawerEvents.CONTACT_UNBLOCKED,userId),render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},requestRemoveContact=function(userId){cancelRequest(userId);var newState=StateManager.addPendingRemoveContactsById(viewState,[userId]);render(newState)},removeContact=function(userId){var newState=StateManager.setLoadingConfirmAction(viewState,!0),pendingPromise=new Pending("core_message/message_drawer_view_conversation:removeContact");return render(newState),Repository.deleteContacts(viewState.loggedInUserId,[userId]).then((function(profiles){var newState=StateManager.addMembers(viewState,profiles);return newState=StateManager.removePendingRemoveContactsById(newState,[userId]),newState=StateManager.setLoadingConfirmAction(newState,!1),PubSub.publish(MessageDrawerEvents.CONTACT_REMOVED,userId),render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},requestAddContact=function(userId){cancelRequest(userId);var newState=StateManager.addPendingAddContactsById(viewState,[userId]);render(newState)},addContact=function(userId){var newState=StateManager.setLoadingConfirmAction(viewState,!0),pendingPromise=new Pending("core_message/message_drawer_view_conversation:addContactRequests");return render(newState),Repository.createContactRequest(viewState.loggedInUserId,userId).then((function(response){if(!response.request)throw new Error(response.warnings[0].message);return response.request})).then((function(request){var newState=StateManager.removePendingAddContactsById(viewState,[userId]);return newState=StateManager.addContactRequests(newState,[request]),newState=StateManager.setLoadingConfirmAction(newState,!1),render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},requestDeleteSelectedMessages=function(userId){var selectedMessageIds=viewState.selectedMessageIds;cancelRequest(userId);var newState=StateManager.addPendingDeleteMessagesById(viewState,selectedMessageIds);render(newState)},deleteSelectedMessages=function(){var pendingPromise=new Pending("core_message/message_drawer_view_conversation:deleteSelectedMessages"),messageIds=viewState.pendingDeleteMessageIds,sentMessages=viewState.messages.filter((function(message){return messageIds.indexOf(message.id)>=0&&("sent"==message.sendState||null===message.sendState)})),newState=StateManager.setLoadingConfirmAction(viewState,!0);render(newState);var deleteMessagesPromise=$.Deferred().resolve().promise();if(sentMessages.length){var sentMessageIds=sentMessages.map((function(message){return message.id}));deleteMessagesPromise=newState.deleteMessagesForAllUsers?Repository.deleteMessagesForAllUsers(viewState.loggedInUserId,sentMessageIds):Repository.deleteMessages(viewState.loggedInUserId,sentMessageIds)}return isDeletingConversationContent=!0,newMessagesPollTimer&&newMessagesPollTimer.stop(),deleteMessagesPromise.then((function(){var newState=StateManager.removeMessagesById(viewState,messageIds);newState=StateManager.removePendingDeleteMessagesById(newState,messageIds),newState=StateManager.removeSelectedMessagesById(newState,messageIds),newState=StateManager.setLoadingConfirmAction(newState,!1),newState=StateManager.setDeleteMessagesForAllUsers(newState,!1);var prevLastMessage=viewState.messages[viewState.messages.length-1],newLastMessage=newState.messages.length?newState.messages[newState.messages.length-1]:null;if(newLastMessage&&newLastMessage.id!=prevLastMessage.id){var conversation=formatConversationForEvent(newState);PubSub.publish(MessageDrawerEvents.CONVERSATION_NEW_LAST_MESSAGE,conversation)}else newState.messages.length||PubSub.publish(MessageDrawerEvents.CONVERSATION_DELETED,newState.id);return isDeletingConversationContent=!1,render(newState)})).then((function(result){return pendingPromise.resolve(),result})).catch(Notification.exception)},requestDeleteConversation=function(userId){cancelRequest(userId);var newState=StateManager.setPendingDeleteConversation(viewState,!0);render(newState)},deleteConversation=function(){var pendingPromise=new Pending("core_message/message_drawer_view_conversation:markConversationAsRead"),newState=StateManager.setLoadingConfirmAction(viewState,!0);return render(newState),isDeletingConversationContent=!0,newMessagesPollTimer&&newMessagesPollTimer.stop(),Repository.deleteConversation(viewState.loggedInUserId,viewState.id).then((function(){var newState=StateManager.removeMessages(viewState,viewState.messages);return newState=StateManager.removeSelectedMessagesById(newState,viewState.selectedMessageIds),newState=StateManager.setPendingDeleteConversation(newState,!1),newState=StateManager.setLoadingConfirmAction(newState,!1),PubSub.publish(MessageDrawerEvents.CONVERSATION_DELETED,newState.id),isDeletingConversationContent=!1,render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},cancelRequest=function(userId){var pendingDeleteMessageIds=viewState.pendingDeleteMessageIds,newState=StateManager.removePendingAddContactsById(viewState,[userId]);newState=StateManager.removePendingRemoveContactsById(newState,[userId]),newState=StateManager.removePendingUnblockUsersById(newState,[userId]),newState=StateManager.removePendingBlockUsersById(newState,[userId]),newState=StateManager.removePendingDeleteMessagesById(newState,pendingDeleteMessageIds),newState=StateManager.setPendingDeleteConversation(newState,!1),newState=StateManager.setDeleteMessagesForAllUsers(newState,!1),render(newState)},acceptContactRequest=function(userId){var pendingPromise=new Pending("core_message/message_drawer_view_conversation:acceptContactRequest"),loggedInUserId=viewState.loggedInUserId,requests=viewState.members[userId].contactrequests.filter((function(request){return request.requesteduserid==loggedInUserId})),request=requests[0],newState=StateManager.setLoadingConfirmAction(viewState,!0);return render(newState),Repository.acceptContactRequest(userId,loggedInUserId).then((function(profile){var newState=StateManager.removeContactRequests(viewState,[request]);return newState=StateManager.addMembers(viewState,[profile]),newState=StateManager.setLoadingConfirmAction(newState,!1),render(newState)})).then((function(){PubSub.publish(MessageDrawerEvents.CONTACT_ADDED,viewState.members[userId]),PubSub.publish(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED,request)})).then((function(result){return pendingPromise.resolve(),result}))},declineContactRequest=function(userId){var pendingPromise=new Pending("core_message/message_drawer_view_conversation:declineContactRequest"),loggedInUserId=viewState.loggedInUserId,requests=viewState.members[userId].contactrequests.filter((function(request){return request.requesteduserid==loggedInUserId})),request=requests[0],newState=StateManager.setLoadingConfirmAction(viewState,!0);return render(newState),Repository.declineContactRequest(userId,loggedInUserId).then((function(profile){var newState=StateManager.removeContactRequests(viewState,[request]);return newState=StateManager.addMembers(viewState,[profile]),newState=StateManager.setLoadingConfirmAction(newState,!1),render(newState)})).then((function(){PubSub.publish(MessageDrawerEvents.CONTACT_REQUEST_DECLINED,request)})).then((function(result){return pendingPromise.resolve(),result}))},processSendMessageBuffer=function processSendMessageBuffer(){if(!isSendingMessage&&sendMessageBuffer.length){var pendingPromise=new Pending("core_message/message_drawer_view_conversation:processSendMessageBuffer");isSendingMessage=!0;var messagesToSend=sendMessageBuffer.slice();sendMessageBuffer=[];var conversationId=viewState.id,newConversationId=null,messagesText=messagesToSend.map((function(message){return message.text})),messageIds=messagesToSend.map((function(message){return message.id})),sendMessagePromise=null,newCanDeleteMessagesForAllUsers=null;if(conversationId||viewState.type==CONVERSATION_TYPES.PUBLIC)sendMessagePromise=Repository.sendMessagesToConversation(conversationId,messagesText);else{var otherUserId=getOtherUserId();sendMessagePromise=Repository.sendMessagesToUser(otherUserId,messagesText).then((function(messages){return messages.length&&(newConversationId=parseInt(messages[0].conversationid,10),newCanDeleteMessagesForAllUsers=messages[0].candeletemessagesforallusers),messages}))}sendMessagePromise.then((function(messages){var newMessageIds=messages.map((function(message){return message.id})),data=[],selectedToRemove=[],selectedToAdd=[];messagesToSend.forEach((function(oldMessage,index){var newMessage=messages[index];data.push([oldMessage,newMessage]),viewState.selectedMessageIds.indexOf(oldMessage.id)>=0&&(selectedToRemove.push(oldMessage.id),selectedToAdd.push(newMessage.id))}));var newState=StateManager.updateMessages(viewState,data);newState=StateManager.setMessagesSendSuccessById(newState,newMessageIds),selectedToRemove.length&&(newState=StateManager.removeSelectedMessagesById(newState,selectedToRemove)),selectedToAdd.length&&(newState=StateManager.addSelectedMessagesById(newState,selectedToAdd));var conversation=formatConversationForEvent(newState);newState.id||(newState=StateManager.setId(newState,newConversationId),conversation.id=newConversationId,resetMessagePollTimer(newConversationId),PubSub.publish(MessageDrawerEvents.CONVERSATION_CREATED,conversation),newState=StateManager.setCanDeleteMessagesForAllUsers(newState,newCanDeleteMessagesForAllUsers)),render(newState),isSendingMessage=!1,processSendMessageBuffer(),PubSub.publish(MessageDrawerEvents.CONVERSATION_NEW_LAST_MESSAGE,conversation)})).then((function(result){return pendingPromise.resolve(),result})).catch((function(e){var errorMessage;errorMessage=e.message?$.Deferred().resolve(e.message).promise():Str.get_string("unknownerror","core");var handleFailedMessages=function(errorMessage){var newState=StateManager.setMessagesSendFailById(viewState,messageIds,errorMessage);render(newState),isSendingMessage=!1,processSendMessageBuffer()};errorMessage.then(handleFailedMessages).then((function(result){return pendingPromise.resolve(),result})).catch((function(e){var finalError=e.message||"Something went wrong!";handleFailedMessages(finalError)}))}))}},previewText=function(text){var plaintext=text.replace(/<style([\s\S]*?)<\/style>/gi,"");return(plaintext=(plaintext=(plaintext=(plaintext=(plaintext=(plaintext=(plaintext=(plaintext=(plaintext=plaintext.replace(/<script([\s\S]*?)<\/script>/gi,"")).replace(/<\/div>/gi,"\n")).replace(/<\/li>/gi,"\n")).replace(/<li>/gi,"  *  ")).replace(/<\/ul>/gi,"\n")).replace(/<\/p>/gi,"\n")).replace(/<br[^>]*>/gi,"\n")).replace(/<[^>]+>/gi,"")).replace(/\n+/gi,"\n")).replace(/\n/gi,"<br>")},processRenderBuffer=function processRenderBuffer(header,body,footer){if(!isRendering&&renderBuffer.length){isRendering=!0;var renderable=renderBuffer.shift(),renderPromises=renderers.map((function(renderFunc){return renderFunc(renderable.patch)}));$.when.apply(null,renderPromises).then((function(){isRendering=!1,renderable.deferred.resolve(!0),processRenderBuffer(header,body,footer)})).catch((function(error){isRendering=!1,renderable.deferred.reject(error),Notification.exception(error)}))}},generateRenderFunction=function(header,body,footer,isNewConversation){var rendererFunc=function(patch){return Renderer.render(header,body,footer,patch)};if(!isNewConversation){var initialState=StateManager.buildInitialState(viewState.midnight,viewState.loggedInUserId,viewState.id);rendererFunc(Patcher.buildPatch(initialState,viewState))}return renderers.push(rendererFunc),function(newState){var patch=Patcher.buildPatch(viewState,newState),deferred=$.Deferred();return Object.keys(patch).length?renderBuffer.push({patch:patch,deferred:deferred}):deferred.resolve(!0),viewState=newState,newState.id&&(stateCache[newState.id]={state:newState,messagesOffset:getMessagesOffset(),loadedAllMessages:hasLoadedAllMessages()}),processRenderBuffer(header,body,footer),deferred.promise()}},generateConfirmActionHandler=function(actionCallback){return function(e,data){if(!viewState.loadingConfirmAction){actionCallback(getOtherUserId());var newState=StateManager.setLoadingConfirmAction(viewState,!1);render(newState)}data.originalEvent.preventDefault()}},handleSendMessage=function(e,data){var textArea=$(e.target).closest(SELECTORS.FOOTER_CONTAINER).find(SELECTORS.MESSAGE_TEXT_AREA),text=textArea.val().trim();""!==text&&(!function(text){var id="temp"+Date.now(),loadingmessage={id:id,useridfrom:viewState.loggedInUserId,text:previewText(text),timecreated:null},newState=StateManager.addMessages(viewState,[loadingmessage]);render(newState);var message={id:id,useridfrom:viewState.loggedInUserId,text:text,timecreated:null};sendMessageBuffer.push(message),processSendMessageBuffer()}(text),textArea.val(""),textArea.focus()),data.originalEvent.preventDefault()},handleSelectMessage=function(e,data){var selection=window.getSelection(),target=$(e.target);""==selection.toString()&&(target.is("a")||(!function(messageId){var newState=viewState;newState=viewState.selectedMessageIds.indexOf(messageId)>-1?StateManager.removeSelectedMessagesById(viewState,[messageId]):StateManager.addSelectedMessagesById(viewState,[messageId]),render(newState)}(target.closest(SELECTORS.MESSAGE).attr("data-message-id")),data.originalEvent.preventDefault()))},handleRetrySendMessage=function(e,data){var messageId=$(e.target).closest(SELECTORS.MESSAGE).attr("data-message-id"),messages=viewState.messages.filter((function(message){return message.id==messageId})),message=messages.length?messages[0]:null;message&&function(message){var newState=StateManager.setMessagesSendPendingById(viewState,[message.id]);render(newState),sendMessageBuffer.push(message),processSendMessageBuffer()}(message),data.originalEvent.preventDefault(),data.originalEvent.stopPropagation(),e.stopPropagation()},handleCancelEditMode=function(e,data){!function(){cancelRequest(getOtherUserId());var newState=StateManager.removeSelectedMessagesById(viewState,viewState.selectedMessageIds);render(newState)}(),data.originalEvent.preventDefault()},generateHandleViewContact=function(namespace){return function(e,data){var otherUserId=getOtherUserId(),otherUser=viewState.members[otherUserId];MessageDrawerRouter.go(namespace,MessageDrawerRoutes.VIEW_CONTACT,otherUser),data.originalEvent.preventDefault()}},handleSetFavourite=function(e,data){var userId,conversationId,pendingPromise;(userId=viewState.loggedInUserId,conversationId=viewState.id,pendingPromise=new Pending("core_message/message_drawer_view_conversation:setFavourite"),Repository.setFavouriteConversations(userId,[conversationId]).then((function(){var newState=StateManager.setIsFavourite(viewState,!0);return render(newState)})).then((function(){return PubSub.publish(MessageDrawerEvents.CONVERSATION_SET_FAVOURITE,formatConversationForEvent(viewState))})).then((function(result){return pendingPromise.resolve(),result}))).catch(Notification.exception),data.originalEvent.preventDefault()},handleUnsetFavourite=function(e,data){var userId,conversationId,pendingPromise;(userId=viewState.loggedInUserId,conversationId=viewState.id,pendingPromise=new Pending("core_message/message_drawer_view_conversation:unsetFavourite"),Repository.unsetFavouriteConversations(userId,[conversationId]).then((function(){var newState=StateManager.setIsFavourite(viewState,!1);return render(newState)})).then((function(){return PubSub.publish(MessageDrawerEvents.CONVERSATION_UNSET_FAVOURITE,formatConversationForEvent(viewState))})).then((function(result){return pendingPromise.resolve(),result}))).catch(Notification.exception),data.originalEvent.preventDefault()},handleSetMuted=function(e,data){var userId,conversationId,pendingPromise;(userId=viewState.loggedInUserId,conversationId=viewState.id,pendingPromise=new Pending("core_message/message_drawer_view_conversation:markConversationAsRead"),Repository.setMutedConversations(userId,[conversationId]).then((function(){var newState=StateManager.setIsMuted(viewState,!0);return render(newState)})).then((function(){return PubSub.publish(MessageDrawerEvents.CONVERSATION_SET_MUTED,formatConversationForEvent(viewState))})).then((function(result){return pendingPromise.resolve(),result}))).catch(Notification.exception),data.originalEvent.preventDefault()},handleUnsetMuted=function(e,data){var userId,conversationId;(userId=viewState.loggedInUserId,conversationId=viewState.id,Repository.unsetMutedConversations(userId,[conversationId]).then((function(){var newState=StateManager.setIsMuted(viewState,!1);return render(newState)})).then((function(){return PubSub.publish(MessageDrawerEvents.CONVERSATION_UNSET_MUTED,formatConversationForEvent(viewState))}))).catch(Notification.exception),data.originalEvent.preventDefault()},handleDeleteMessagesForAllUsersToggle=function(e){var newValue=$(e.target).prop("checked"),newState=StateManager.setDeleteMessagesForAllUsers(viewState,newValue);render(newState)},generateHandleViewGroupInfo=function(namespace){return function(e,data){MessageDrawerRouter.go(namespace,MessageDrawerRoutes.VIEW_GROUP_INFO,{id:viewState.id,name:viewState.name,subname:viewState.subname,imageUrl:viewState.imageUrl,totalMemberCount:viewState.totalMemberCount},viewState.loggedInUserId),data.originalEvent.preventDefault()}},handleToggleEmojiPicker=function(e,data){var newState=StateManager.setShowEmojiPicker(viewState,!viewState.showEmojiPicker);render(newState),data.originalEvent.preventDefault()},handleCloseEmojiPicker=function(e){var target=$(e.target);if(viewState.showEmojiPicker&&!target.closest(SELECTORS.EMOJI_PICKER_CONTAINER).length&&!target.closest(SELECTORS.TOGGLE_EMOJI_PICKER_BUTTON).length){var newState=StateManager.setShowEmojiPicker(viewState,!1);render(newState)}},registerEventListeners=function(namespace,header,body,footer){var isLoadingMoreMessages=!1,messagesContainer=function(body){return body.find(SELECTORS.MESSAGES_CONTAINER)}(body),emojiPickerElement=footer.find(SELECTORS.EMOJI_PICKER),emojiAutoCompleteContainer=footer.find(SELECTORS.EMOJI_AUTO_COMPLETE_CONTAINER),messageTextArea=footer.find(SELECTORS.MESSAGE_TEXT_AREA),headerActivateHandlers=[[SELECTORS.ACTION_REQUEST_BLOCK,generateConfirmActionHandler(requestBlockUser)],[SELECTORS.ACTION_REQUEST_UNBLOCK,generateConfirmActionHandler(requestUnblockUser)],[SELECTORS.ACTION_REQUEST_ADD_CONTACT,generateConfirmActionHandler(requestAddContact)],[SELECTORS.ACTION_REQUEST_REMOVE_CONTACT,generateConfirmActionHandler(requestRemoveContact)],[SELECTORS.ACTION_REQUEST_DELETE_CONVERSATION,generateConfirmActionHandler(requestDeleteConversation)],[SELECTORS.ACTION_CANCEL_EDIT_MODE,handleCancelEditMode],[SELECTORS.ACTION_VIEW_CONTACT,generateHandleViewContact(namespace)],[SELECTORS.ACTION_VIEW_GROUP_INFO,generateHandleViewGroupInfo(namespace)],[SELECTORS.ACTION_CONFIRM_FAVOURITE,handleSetFavourite],[SELECTORS.ACTION_CONFIRM_MUTE,handleSetMuted],[SELECTORS.ACTION_CONFIRM_UNFAVOURITE,handleUnsetFavourite],[SELECTORS.ACTION_CONFIRM_UNMUTE,handleUnsetMuted]],bodyActivateHandlers=[[SELECTORS.ACTION_CANCEL_CONFIRM,generateConfirmActionHandler(cancelRequest)],[SELECTORS.ACTION_CONFIRM_BLOCK,generateConfirmActionHandler(blockUser)],[SELECTORS.ACTION_CONFIRM_UNBLOCK,generateConfirmActionHandler(unblockUser)],[SELECTORS.ACTION_CONFIRM_ADD_CONTACT,generateConfirmActionHandler(addContact)],[SELECTORS.ACTION_CONFIRM_REMOVE_CONTACT,generateConfirmActionHandler(removeContact)],[SELECTORS.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES,generateConfirmActionHandler(deleteSelectedMessages)],[SELECTORS.ACTION_CONFIRM_DELETE_CONVERSATION,generateConfirmActionHandler(deleteConversation)],[SELECTORS.ACTION_OKAY_CONFIRM,generateConfirmActionHandler(cancelRequest)],[SELECTORS.ACTION_REQUEST_ADD_CONTACT,generateConfirmActionHandler(requestAddContact)],[SELECTORS.ACTION_ACCEPT_CONTACT_REQUEST,generateConfirmActionHandler(acceptContactRequest)],[SELECTORS.ACTION_DECLINE_CONTACT_REQUEST,generateConfirmActionHandler(declineContactRequest)],[SELECTORS.MESSAGE,handleSelectMessage],[SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE,handleDeleteMessagesForAllUsersToggle],[SELECTORS.RETRY_SEND,handleRetrySendMessage]],footerActivateHandlers=[[SELECTORS.SEND_MESSAGE_BUTTON,handleSendMessage],[SELECTORS.TOGGLE_EMOJI_PICKER_BUTTON,handleToggleEmojiPicker],[SELECTORS.ACTION_REQUEST_DELETE_SELECTED_MESSAGES,generateConfirmActionHandler(requestDeleteSelectedMessages)],[SELECTORS.ACTION_REQUEST_ADD_CONTACT,generateConfirmActionHandler(requestAddContact)],[SELECTORS.ACTION_REQUEST_UNBLOCK,generateConfirmActionHandler(requestUnblockUser)]];AutoRows.init(footer),emojiAutoCompleteContainer.length&&initialiseEmojiAutoComplete(emojiAutoCompleteContainer[0],messageTextArea[0],(function(hasSuggestions){var newState=StateManager.setShowEmojiAutoComplete(viewState,hasSuggestions);render(newState)}),(function(emoji){var newState=StateManager.setShowEmojiAutoComplete(viewState,!1);render(newState),messageTextArea.focus();var cursorPos=messageTextArea.prop("selectionStart"),currentText=messageTextArea.val(),textBefore=currentText.substring(0,cursorPos).replace(/\S*$/,""),textAfter=currentText.substring(cursorPos).replace(/^\S*/,"");messageTextArea.val(textBefore+emoji+textAfter),messageTextArea.prop("selectionStart",textBefore.length+emoji.length),messageTextArea.prop("selectionEnd",textBefore.length+emoji.length)})),emojiPickerElement.length&&initialiseEmojiPicker(emojiPickerElement[0],(function(emoji){var newState=StateManager.setShowEmojiPicker(viewState,!viewState.showEmojiPicker);render(newState),messageTextArea.focus();var cursorPos=messageTextArea.prop("selectionStart"),currentText=messageTextArea.val(),textBefore=currentText.substring(0,cursorPos),textAfter=currentText.substring(cursorPos,currentText.length);messageTextArea.val(textBefore+emoji+textAfter),messageTextArea.prop("selectionStart",cursorPos+emoji.length),messageTextArea.prop("selectionEnd",cursorPos+emoji.length)})),CustomEvents.define(header,[CustomEvents.events.activate]),CustomEvents.define(body,[CustomEvents.events.activate]),CustomEvents.define(footer,[CustomEvents.events.activate,CustomEvents.events.enter,CustomEvents.events.escape]),CustomEvents.define(messagesContainer,[CustomEvents.events.scrollTop,CustomEvents.events.scrollLock]),messagesContainer.on(CustomEvents.events.scrollTop,(function(e,data){var hasMembers=Object.keys(viewState.members).length>1;if(!isResetting&&!isLoadingMoreMessages&&!hasLoadedAllMessages()&&hasMembers){isLoadingMoreMessages=!0;var newState=StateManager.setLoadingMessages(viewState,!0);render(newState),loadMessages(viewState.id,LOAD_MESSAGE_LIMIT,getMessagesOffset(),NEWEST_FIRST,[]).then((function(){isLoadingMoreMessages=!1,setMessagesOffset(getMessagesOffset()+LOAD_MESSAGE_LIMIT)})).catch((function(error){isLoadingMoreMessages=!1,Notification.exception(error)}))}data.originalEvent.preventDefault()})),headerActivateHandlers.forEach((function(handler){var selector=handler[0],handlerFunction=handler[1];header.on(CustomEvents.events.activate,selector,handlerFunction)})),bodyActivateHandlers.forEach((function(handler){var selector=handler[0],handlerFunction=handler[1];body.on(CustomEvents.events.activate,selector,handlerFunction)})),footerActivateHandlers.forEach((function(handler){var selector=handler[0],handlerFunction=handler[1];footer.on(CustomEvents.events.activate,selector,handlerFunction)})),footer.on(CustomEvents.events.enter,SELECTORS.MESSAGE_TEXT_AREA,(function(e,data){var enterToSend=footer.attr("data-enter-to-send");enterToSend&&"false"!=enterToSend&&"0"!=enterToSend&&handleSendMessage(e,data)})),footer.on(CustomEvents.events.escape,SELECTORS.EMOJI_PICKER_CONTAINER,handleToggleEmojiPicker),$(document.body).on("click",handleCloseEmojiPicker),PubSub.subscribe(MessageDrawerEvents.ROUTE_CHANGED,(function(newRouteData){newMessagesPollTimer&&newRouteData.route!=MessageDrawerRoutes.VIEW_CONVERSATION&&newMessagesPollTimer.stop()}))},resetMessagePollTimer=function(conversationId){newMessagesPollTimer&&newMessagesPollTimer.stop(),newMessagesPollTimer=new BackOffTimer(function(conversationId,newestFirst){return function(){var messages=viewState.messages,mostRecentMessage=messages.length?messages[messages.length-1]:null,lastTimeCreated=mostRecentMessage?mostRecentMessage.timeCreated:null;if(lastTimeCreated&&!isResetting&&!isSendingMessage&&!isDeletingConversationContent){for(var ignoreMessageIds=[],i=messages.length-1;i>=0;i--){var message=messages[i];if(message.timeCreated!==lastTimeCreated)break;ignoreMessageIds.push(message.id)}return loadMessages(conversationId,0,0,newestFirst,ignoreMessageIds,lastTimeCreated).then((function(result){if(result.messages.length){newMessagesPollTimer.restart();var conversation=formatConversationForEvent(viewState);return PubSub.publish(MessageDrawerEvents.CONVERSATION_NEW_LAST_MESSAGE,conversation),markConversationAsRead(conversationId)}return result}))}return $.Deferred().resolve().promise()}}(conversationId,NEWEST_FIRST),BackOffTimer.getIncrementalCallback(viewState.messagePollMin*MILLISECONDS_IN_SEC,MILLISECONDS_IN_SEC,viewState.messagePollMax*MILLISECONDS_IN_SEC,viewState.messagePollAfterMax*MILLISECONDS_IN_SEC)),newMessagesPollTimer.start()},resetState=function(body,conversationId,loggedInUserProfile){newMessagesPollTimer&&newMessagesPollTimer.stop(),loadedAllMessages=!1,messagesOffset=0,newMessagesPollTimer=null,isRendering=!1,renderBuffer=[],isResetting=!0,isSendingMessage=!1,isDeletingConversationContent=!1,sendMessageBuffer=[];var loggedInUserId=loggedInUserProfile.id,midnight=parseInt(body.attr("data-midnight"),10),messagePollMin=parseInt(body.attr("data-message-poll-min"),10),messagePollMax=parseInt(body.attr("data-message-poll-max"),10),messagePollAfterMax=parseInt(body.attr("data-message-poll-after-max"),10),initialState=StateManager.buildInitialState(midnight,loggedInUserId,conversationId,messagePollMin,messagePollMax,messagePollAfterMax);viewState||(viewState=initialState),render(initialState)},resetNoConversation=function(body,loggedInUserProfile,otherUserId){resetState(body,null,loggedInUserProfile);return(loggedInUserProfile.id!=otherUserId?Repository.getConversationBetweenUsers(loggedInUserProfile.id,otherUserId,!0,!0,0,0,LOAD_MESSAGE_LIMIT,0,NEWEST_FIRST):Repository.getSelfConversation(loggedInUserProfile.id,LOAD_MESSAGE_LIMIT,0,NEWEST_FIRST)).then((function(conversation){return resetByConversation(body,conversation,loggedInUserProfile)})).catch((function(){return function(loggedInUserProfile,otherUserId){var loggedInUserId=loggedInUserProfile.id,conversationType=loggedInUserId==otherUserId?CONVERSATION_TYPES.SELF:CONVERSATION_TYPES.PRIVATE,newState=StateManager.setLoadingMembers(viewState,!0);return newState=StateManager.setLoadingMessages(newState,!0),render(newState),Repository.getMemberInfo(loggedInUserId,[otherUserId],!0,!0).then((function(profiles){if(profiles.length)return profiles[0];throw new Error("Unable to load other user profile")})).then((function(profile){var members=conversationType==CONVERSATION_TYPES.SELF?[profile]:[profile,loggedInUserProfile],newState=StateManager.addMembers(viewState,members);return newState=StateManager.setLoadingMembers(newState,!1),newState=StateManager.setLoadingMessages(newState,!1),newState=StateManager.setName(newState,profile.fullname),newState=StateManager.setType(newState,conversationType),newState=StateManager.setImageUrl(newState,profile.profileimageurl),newState=StateManager.setTotalMemberCount(newState,members.length),render(newState),profile})).catch((function(error){var newState=StateManager.setLoadingMembers(viewState,!1);render(newState),Notification.exception(error)}))}(loggedInUserProfile,otherUserId)}))},resetById=function(body,conversationId,loggedInUserProfile){var cache=null;conversationId in stateCache&&(cache=stateCache[conversationId]),resetState(body,conversationId,loggedInUserProfile);var promise=$.Deferred().resolve({}).promise();if(cache){var newState=cache.state;newState=StateManager.setLoadingMessages(newState,!1),newState=StateManager.setLoadingMembers(newState,!1),setMessagesOffset(cache.messagesOffset),setLoadedAllMessages(cache.loadedAllMessages),render(newState)}else promise=function(conversationId,loggedInUserProfile,messageLimit,messageOffset,newestFirst){var loggedInUserId=loggedInUserProfile.id,newState=StateManager.setLoadingMembers(viewState,!0);return newState=StateManager.setLoadingMessages(newState,!0),render(newState),Repository.getConversation(loggedInUserId,conversationId,!0,!0,0,0,messageLimit+1,messageOffset,newestFirst).then((function(conversation){return conversation.messages.length>messageLimit?conversation.messages=conversation.messages.slice(1):setLoadedAllMessages(!0),setMessagesOffset(messageOffset+messageLimit),conversation})).then((function(conversation){conversation.members.filter((function(member){return member.id==loggedInUserProfile.id})).length<1&&(conversation.members=conversation.members.concat([loggedInUserProfile]));var newState=updateStateFromConversation(conversation,loggedInUserProfile.id);return newState=StateManager.setLoadingMembers(newState,!1),newState=StateManager.setLoadingMessages(newState,!1),render(newState).then((function(){return conversation}))})).then((function(){return markConversationAsRead(conversationId)})).catch((function(error){var newState=StateManager.setLoadingMembers(viewState,!1);newState=StateManager.setLoadingMessages(newState,!1),render(newState),Notification.exception(error)}))}(conversationId,loggedInUserProfile,LOAD_MESSAGE_LIMIT,0,NEWEST_FIRST);return promise.then((function(){return resetMessagePollTimer(conversationId)}))},resetByConversation=function(body,conversation,loggedInUserProfile){var cache=null;conversation.id in stateCache&&(cache=stateCache[conversation.id]),resetState(body,conversation.id,loggedInUserProfile);var promise=$.Deferred().resolve({}).promise();if(cache){var newState=cache.state;newState=StateManager.setLoadingMessages(newState,!1),newState=StateManager.setLoadingMembers(newState,!1),setMessagesOffset(cache.messagesOffset),setLoadedAllMessages(cache.loadedAllMessages),render(newState)}else promise=function(conversation,loggedInUserProfile,messageLimit,newestFirst){conversation.members.filter((function(member){return member.id==loggedInUserProfile.id})).length<1&&(conversation.members=conversation.members.concat([loggedInUserProfile]));var messageCount=conversation.messages.length,hasLoadedEnoughMessages=messageCount>=messageLimit,newState=updateStateFromConversation(conversation,loggedInUserProfile.id);return newState=StateManager.setLoadingMembers(newState,!1),newState=StateManager.setLoadingMessages(newState,!hasLoadedEnoughMessages),render(newState).then((function(){return hasLoadedEnoughMessages?{messages:conversation.messages}:loadMessages(conversation.id,messageLimit,messageCount,newestFirst,[])})).then((function(){var messages=viewState.messages;return setMessagesOffset(messages.length),markConversationAsRead(viewState.id),messages})).catch(Notification.exception)}(conversation,loggedInUserProfile,LOAD_MESSAGE_LIMIT,NEWEST_FIRST);return promise.then((function(){return resetMessagePollTimer(conversation.id)}))};return{show:function(namespace,header,body,footer,conversationOrId,action,otherUserId){var userId,conversation=null,conversationId=null;conversationOrId&&null!==conversationOrId&&"object"==_typeof(conversationOrId)?(conversation=conversationOrId,conversationId=parseInt(conversation.id,10)):(conversation=null,conversationId=parseInt(conversationOrId,10),conversationId=isNaN(conversationId)?null:conversationId),!conversationId&&action&&otherUserId&&(userId=otherUserId,conversationId=Object.keys(stateCache).reduce((function(carry,id){if(!carry){var state=stateCache[id].state;state.type!=CONVERSATION_TYPES.PUBLIC&&userId in state.members&&(carry=state.id)}return carry}),null));var isNewConversation=!viewState||viewState.id!=conversationId||otherUserId&&otherUserId!=getOtherUserId();if(body.attr("data-init")||(render=generateRenderFunction(header,body,footer,isNewConversation),registerEventListeners(namespace,header,body,footer),body.attr("data-init",!0)),isNewConversation){var loggedInUserProfile=function(body){return{id:parseInt(body.attr("data-user-id"),10),fullname:null,profileimageurl:null,profileimageurlsmall:null,isonline:null,showonlinestatus:null,isblocked:null,iscontact:null,isdeleted:null,canmessage:null,canmessageevenifblocked:null,requirescontact:null,contactrequests:[]}}(body);return(conversation?resetByConversation(body,conversation,loggedInUserProfile,otherUserId):conversationId?resetById(body,conversationId,loggedInUserProfile):resetNoConversation(body,loggedInUserProfile,otherUserId)).then((function(){isResetting=!1,header.find(Constants.SELECTORS.CAN_RECEIVE_FOCUS).first().focus()})).catch((function(error){isResetting=!1,Notification.exception(error)}))}if(resetMessagePollTimer(conversationId),viewState.type==CONVERSATION_TYPES.PRIVATE&&action){var currentOtherUserId=getOtherUserId();switch(action){case"block":return requestBlockUser(currentOtherUserId);case"unblock":return requestUnblockUser(currentOtherUserId);case"add-contact":return requestAddContact(currentOtherUserId);case"remove-contact":return requestRemoveContact(currentOtherUserId)}}return $.Deferred().resolve().promise()},description:function(){return Str.get_string("messagedrawerviewconversation","core_message",viewState.name)}}}));
/**
 * Controls the preference for an individual notification type on the
 * message preference page.
 *
 * @module     core_message/message_notification_preference
 * @class      message_notification_preference
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_notification_preference",["jquery","core_message/notification_preference"],(function($,NotificationPreference){var SELECTORS_PREFERENCE_KEY="[data-preference-key]",MessageNotificationPreference=function(element,userId){NotificationPreference.call(this,element,userId)};return(MessageNotificationPreference.prototype=Object.create(NotificationPreference.prototype)).constructor=MessageNotificationPreference,MessageNotificationPreference.prototype.getPreferenceKey=function(){return this.root.find(SELECTORS_PREFERENCE_KEY).attr("data-preference-key")},MessageNotificationPreference}));
/**
 * Controls the contact page in the message drawer.
 *
 * @module     core_message/message_drawer_view_contact
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_contact",["jquery","core/str","core/templates"],(function($,Str,Templates){var SELECTORS_CONTENT_CONTAINER='[data-region="content-container"]',TEMPLATES_CONTENT="core_message/message_drawer_view_contact_body_content",getContentContainer=function(root){return root.find(SELECTORS_CONTENT_CONTAINER)};return{show:function(namespace,header,body,footer,contact){var root=$(body);return getContentContainer(root).empty(),function(root,profile){return Templates.render(TEMPLATES_CONTENT,profile).then((function(html){return getContentContainer(root).append(html),html}))}(root,contact)},description:function(root,contact){return Str.get_string("messagedrawerviewcontact","core_message",contact.fullname)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * A simple router for the message drawer that allows navigating between
 * the "pages" in the drawer.
 *
 * This module will maintain a linear history of the unique pages access
 * to allow navigating back.
 *
 * @module     core_message/message_drawer_router
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core_message/message_drawer_router",["jquery","core/pubsub","core/str","core_message/message_drawer_events"],(function($,PubSub,Str,MessageDrawerEvents){var routes={},history={},SELECTORS_CAN_RECEIVE_FOCUS='input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',SELECTORS_ROUTES_BACK="[data-route-back]",changeRoute=function(namespace,newRoute){var newConfig,fromPanel=[].slice.call(arguments).some((function(arg){return"frompanel"==arg})),args=[].slice.call(arguments,2),renderPromise=$.Deferred().resolve().promise();if(Object.keys(routes[namespace]).forEach((function(route){var config=routes[namespace][route],isMatch=route===newRoute;isMatch&&(newConfig=config),config.parameters.forEach((function(element){"object"===_typeof(element)&&null!==element&&(element.removeClass("previous"),element.attr("data-from-panel",!1),isMatch?(fromPanel&&element.attr("data-from-panel",!0),element.removeClass("hidden"),element.attr("aria-hidden",!1)):element.attr("data-in-panel")&&"view-search"!=newRoute&&"view-overview"!=newRoute||(element.addClass("hidden"),element.attr("aria-hidden",!0)))}))})),newConfig&&newConfig.onGo){renderPromise=newConfig.onGo.apply(void 0,newConfig.parameters.concat(args));for(var currentFocusElement=$(document.activeElement),hasFocus=!1,firstFocusable=null,i=1;i<newConfig.parameters.length;i++){var element=newConfig.parameters[i];if("object"===_typeof(element)&&null!==element&&(firstFocusable||(firstFocusable=element),element.has(currentFocusElement).length)){hasFocus=!0;break}}hasFocus||firstFocusable.find(SELECTORS_CAN_RECEIVE_FOCUS).filter(":visible").first().focus()}var record={route:newRoute,params:args,renderPromise:renderPromise};return PubSub.publish(MessageDrawerEvents.ROUTE_CHANGED,record),record},go=function(namespace){var currentFocusElement=$(document.activeElement),record=changeRoute.apply(namespace,arguments),inHistory=!1;history[namespace]||(history[namespace]=[]),history[namespace]=history[namespace].reduce((function(carry,previous){return previous.route===record.route&&(inHistory=!0),inHistory||carry.push(previous),carry}),[]);var historylength=history[namespace].length,previousRecord=historylength?history[namespace][historylength-1]:null;if(previousRecord){for(var prevConfig=routes[namespace][previousRecord.route],elements=prevConfig.parameters,i=1;i<elements.length;i++)"object"===_typeof(elements[i])&&null!==elements[i]&&elements[i].addClass("previous");previousRecord.focusElement=currentFocusElement,prevConfig.getDescription&&prevConfig.getDescription.apply(null,prevConfig.parameters.concat(previousRecord.params)).then((function(description){return Str.get_string("backto","core_message",description)})).then((function(label){return record.renderPromise.then((function(){routes[namespace][record.route].parameters.forEach((function(element){"object"===_typeof(element)&&element&&element.find(SELECTORS_ROUTES_BACK).attr("aria-label",label)}))}))})).catch((function(){}))}return history[namespace].push(record),record};return{add:function(namespace,route,parameters,onGo,getDescription){routes[namespace]||(routes[namespace]=[]),routes[namespace][route]={parameters:parameters,onGo:onGo,getDescription:getDescription}},go:go,back:function(namespace){if(history[namespace].length){history[namespace].pop();var previous=history[namespace].pop();previous&&(go.apply(void 0,[namespace,previous.route].concat(previous.params)),window.setTimeout((function(){previous.focusElement.focus()}),50))}}}}));
/**
 * This module updates the UI for the conversation page in the message
 * drawer.
 *
 * The module will take a patch from the message_drawer_view_conversation_patcher
 * module and update the UI to reflect the changes.
 *
 * This is the only module that ever modifies the UI of the conversation page.
 *
 * @module     core_message/message_drawer_view_conversation_renderer
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_conversation_renderer",["jquery","core/notification","core/str","core/templates","core/user_date","core_message/message_drawer_view_conversation_constants"],(function($,Notification,Str,Templates,UserDate,Constants){var SELECTORS=Constants.SELECTORS,TEMPLATES=Constants.TEMPLATES,CONVERSATION_TYPES=Constants.CONVERSATION_TYPES,getMessagesContainer=function(body){return body.find(SELECTORS.CONTENT_MESSAGES_CONTAINER)},getSelfConversationMessageContainer=function(body){return body.find(SELECTORS.SELF_CONVERSATION_MESSAGE_CONTAINER)},getContactRequestSentContainer=function(body){return body.find(SELECTORS.CONTACT_REQUEST_SENT_MESSAGE_CONTAINER)},getFooterContentContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_CONTAINER)},getFooterEditModeContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER)},getFooterPlaceholderContainer=function(footer){return footer.find(SELECTORS.PLACEHOLDER_CONTAINER)},showFooterPlaceholder=function(footer){getFooterPlaceholderContainer(footer).removeClass("hidden")},getFooterRequireContactContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER)},getFooterRequireUnblockContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER)},getFooterUnableToMessageContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER)},hideAllFooterElements=function(footer){!function(footer){getFooterContentContainer(footer).addClass("hidden")}(footer),function(footer){getFooterEditModeContainer(footer).addClass("hidden")}(footer),function(footer){getFooterPlaceholderContainer(footer).addClass("hidden")}(footer),function(footer){getFooterRequireContactContainer(footer).addClass("hidden")}(footer),function(footer){getFooterRequireUnblockContainer(footer).addClass("hidden")}(footer),function(footer){getFooterUnableToMessageContainer(footer).addClass("hidden")}(footer)},getContentPlaceholderContainer=function(body){return body.find(SELECTORS.CONTENT_PLACEHOLDER_CONTAINER)},getHeaderContent=function(header){return header.find(SELECTORS.HEADER)},showHeaderContent=function(header){getHeaderContent(header).removeClass("hidden")},hideHeaderContent=function(header){getHeaderContent(header).addClass("hidden")},getHeaderEditMode=function(header){return header.find(SELECTORS.HEADER_EDIT_MODE)},hideHeaderEditMode=function(header){getHeaderEditMode(header).addClass("hidden")},getHeaderPlaceholderContainer=function(header){return header.find(SELECTORS.HEADER_PLACEHOLDER_CONTAINER)},showHeaderPlaceholder=function(header){getHeaderPlaceholderContainer(header).removeClass("hidden")},hideHeaderPlaceholder=function(header){getHeaderPlaceholderContainer(header).addClass("hidden")},getMessageElement=function(body,messageId){return getMessagesContainer(body).find('[data-message-id="'+messageId+'"]')},getDayElement=function(body,dayTimeCreated){return getMessagesContainer(body).find('[data-day-id="'+dayTimeCreated+'"]')},getMoreMessagesLoadingIconContainer=function(body){return body.find(SELECTORS.MORE_MESSAGES_LOADING_ICON_CONTAINER)},getConfirmDialogueContainer=function(root){return root.find(SELECTORS.CONFIRM_DIALOGUE_CONTAINER)},showConfirmDialogueContainer=function(root){var container=getConfirmDialogueContainer(root),siblings=container.siblings(":not(.hidden)");siblings.attr("aria-hidden",!0),siblings.attr("tabindex",-1),siblings.attr("data-confirm-dialogue-hidden",!0),container.removeClass("hidden")},hideConfirmDialogueContainer=function(root){var container=getConfirmDialogueContainer(root),siblings=container.siblings('[data-confirm-dialogue-hidden="true"]');siblings.removeAttr("aria-hidden"),siblings.removeAttr("tabindex"),siblings.removeAttr("data-confirm-dialogue-hidden"),container.addClass("hidden")},formatMessagesForTemplate=function(messages,datesCache){return messages.map((function(message){return{id:message.id,isread:message.isRead,fromloggedinuser:message.fromLoggedInUser,userfrom:message.userFrom,text:message.text,formattedtime:message.timeCreated?datesCache[message.timeCreated]:null}}))},renderConversation=function(header,body,footer,data){var renderingPromises=[],hasAddDays=data.days.add.length>0,hasAddMessages=data.messages.add.length>0,hasUpdateMessages=data.messages.update.length>0,timestampsToFormat=[],datesCachePromise=$.Deferred().resolve({}).promise();return hasAddDays&&(timestampsToFormat=timestampsToFormat.concat(data.days.add.reduce((function(carry,day){return carry.concat(day.value.messages.reduce((function(timestamps,message){return message.timeCreated&&timestamps.push(message.timeCreated),timestamps}),[]))}),[]))),hasAddMessages&&(timestampsToFormat=timestampsToFormat.concat(data.messages.add.reduce((function(timestamps,message){return message.value.timeCreated&&timestamps.push(message.value.timeCreated),timestamps}),[]))),hasUpdateMessages&&(timestampsToFormat=timestampsToFormat.concat(data.messages.update.reduce((function(timestamps,message){return message.before.timeCreated!=message.after.timeCreated&&timestamps.push(message.after.timeCreated),timestamps}),[]))),timestampsToFormat.length&&(datesCachePromise=Str.get_string("strftimetime24","core_langconfig").then((function(format){var requests=timestampsToFormat.map((function(timestamp){return{timestamp:timestamp,format:format}}));return UserDate.get(requests)})).then((function(formattedTimes){return timestampsToFormat.reduce((function(carry,timestamp,index){return carry[timestamp]=formattedTimes[index],carry}),{})}))),hasAddDays&&renderingPromises.push(datesCachePromise.then((function(datesCache){return function(header,body,footer,days,datesCache){var messagesContainer=getMessagesContainer(body),daysRenderPromises=days.map((function(data){return Templates.render(TEMPLATES.DAY,{timestamp:data.value.timestamp,messages:formatMessagesForTemplate(data.value.messages,datesCache)})}));return $.when.apply($,daysRenderPromises).then((function(){days.forEach((function(data,index){daysRenderPromises[index].then((function(html){if(data.before){var element=getDayElement(body,data.before.timestamp);return $(html).insertBefore(element)}return messagesContainer.append(html)})).catch((function(){}))}))}))}(0,body,0,data.days.add,datesCache)}))),hasAddMessages&&renderingPromises.push(datesCachePromise.then((function(datesCache){return function(header,body,footer,messages,datesCache){var messagesData=messages.map((function(data){return data.value})),formattedMessages=formatMessagesForTemplate(messagesData,datesCache);return Templates.render(TEMPLATES.MESSAGES,{messages:formattedMessages}).then((function(html){var messageList=$(html);messages.forEach((function(data){var messageHtml=messageList.find('[data-message-id="'+data.value.id+'"]');if(data.before){var element=getMessageElement(body,data.before.id);return messageHtml.insertBefore(element)}return getDayElement(body,data.day.timestamp).find(SELECTORS.DAY_MESSAGES_CONTAINER).append(messageHtml)}))}))}(0,body,0,data.messages.add,datesCache)}))),hasUpdateMessages&&renderingPromises.push(datesCachePromise.then((function(datesCache){return function(header,body,footer,messages,datesCache){messages.forEach((function(message){var before=message.before,after=message.after,element=getMessageElement(body,before.id);if(before.id!=after.id&&element.attr("data-message-id",after.id),before.timeCreated!=after.timeCreated){var formattedTime=datesCache[after.timeCreated];element.find(SELECTORS.LOADING_ICON_CONTAINER).addClass("hidden"),element.find(SELECTORS.TIME_CREATED).text(formattedTime).removeClass("hidden")}if(before.sendState!=after.sendState){var loading=element.find(SELECTORS.LOADING_ICON_CONTAINER),time=element.find(SELECTORS.TIME_CREATED),retry=element.find(SELECTORS.RETRY_SEND);switch(loading.addClass("hidden"),loading.attr("aria-hidden","true"),time.addClass("hidden"),time.attr("aria-hidden","true"),retry.addClass("hidden"),retry.attr("aria-hidden","true"),element.removeClass("border border-danger"),after.sendState){case"pending":loading.removeClass("hidden"),loading.attr("aria-hidden","false");break;case"error":retry.removeClass("hidden"),retry.attr("aria-hidden","false"),element.addClass("border border-danger");break;case"sent":time.removeClass("hidden"),time.attr("aria-hidden","false")}}if(before.text!=after.text&&element.find(SELECTORS.TEXT_CONTAINER).html(after.text),before.errorMessage!=after.errorMessage){var messageContainer=element.find(SELECTORS.ERROR_MESSAGE_CONTAINER);message=messageContainer.find(SELECTORS.ERROR_MESSAGE),after.errorMessage?(messageContainer.removeClass("hidden"),messageContainer.attr("aria-hidden","false"),message.text(after.errorMessage)):(messageContainer.addClass("hidden"),messageContainer.attr("aria-hidden","true"),message.text(""))}}))}(0,body,0,data.messages.update,datesCache)}))),data.days.remove.length>0&&function(body,days){days.forEach((function(data){getDayElement(body,data.timestamp).remove()}))}(body,data.days.remove),data.messages.remove.length>0&&function(body,messages){messages.forEach((function(data){getMessageElement(body,data.id).remove()}))}(body,data.messages.remove),$.when.apply($,renderingPromises)},renderHeader=function(header,body,footer,data){var headerContainer=getHeaderContent(header),template=TEMPLATES.HEADER_PUBLIC;return data.context.showrouteback="false"===header.attr("data-from-panel"),data.type==CONVERSATION_TYPES.PRIVATE?template=data.showControls?TEMPLATES.HEADER_PRIVATE:TEMPLATES.HEADER_PRIVATE_NO_CONTROLS:data.type==CONVERSATION_TYPES.SELF&&(template=TEMPLATES.HEADER_SELF),Templates.render(template,data.context).then((function(html,js){Templates.replaceNodeContents(headerContainer,html,js)}))},renderFooter=function(header,body,footer,data){switch(hideAllFooterElements(footer),data.type){case"placeholder":return showFooterPlaceholder(footer);case"add-contact":return Str.get_strings([{key:"requirecontacttomessage",component:"core_message",param:data.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:data.user.fullname}]).then((function(strings){var title=strings[1],text=strings[0],footerContainer=getFooterRequireContactContainer(footer);return footerContainer.find(SELECTORS.TITLE).text(title),footerContainer.find(SELECTORS.TEXT).text(text),function(footer){getFooterRequireContactContainer(footer).removeClass("hidden")}(footer),strings}));case"edit-mode":return function(footer){getFooterEditModeContainer(footer).removeClass("hidden")}(footer);case"content":return function(footer){getFooterContentContainer(footer).removeClass("hidden")}(footer);case"unblock":return function(footer){getFooterRequireUnblockContainer(footer).removeClass("hidden")}(footer);case"unable-to-message":return function(footer){getFooterUnableToMessageContainer(footer).removeClass("hidden")}(footer)}return!0},renderScrollToMessage=function(header,body,footer,messageId){var messagesContainer=getMessagesContainer(body),position=getMessageElement(body,messageId).position();if(position){var scrollTop=messagesContainer.scrollTop()+position.top;messagesContainer.scrollTop(scrollTop)}},renderLoadingMembers=function(header,body,footer,isLoadingMembers){isLoadingMembers?(hideHeaderContent(header),showHeaderPlaceholder(header)):(showHeaderContent(header),hideHeaderPlaceholder(header))},renderLoadingFirstMessages=function(header,body,footer,isLoadingFirstMessages){isLoadingFirstMessages?(function(body){getMessagesContainer(body).addClass("hidden")}(body),function(body){getContentPlaceholderContainer(body).removeClass("hidden")}(body)):(function(body){getMessagesContainer(body).removeClass("hidden")}(body),function(body){getContentPlaceholderContainer(body).addClass("hidden")}(body))},renderLoadingMessages=function(header,body,footer,isLoading){isLoading?function(body){getMoreMessagesLoadingIconContainer(body).removeClass("hidden")}(body):function(body){getMoreMessagesLoadingIconContainer(body).addClass("hidden")}(body)},renderShowEmojiPicker=function(header,body,footer,show){var container=function(footer){return footer.find(SELECTORS.EMOJI_PICKER_CONTAINER)}(footer);show?(container.removeClass("hidden"),container.attr("aria-hidden",!1),container.find(SELECTORS.EMOJI_PICKER_SEARCH_INPUT).focus()):(container.addClass("hidden"),container.attr("aria-hidden",!0))},renderShowEmojiAutoComplete=function(header,body,footer,show){var container=function(footer){return footer.find(SELECTORS.EMOJI_AUTO_COMPLETE_CONTAINER)}(footer);show?(container.removeClass("hidden"),container.attr("aria-hidden",!1)):(container.addClass("hidden"),container.attr("aria-hidden",!0))},showConfirmDialogue=function(header,body,footer,buttonSelectors,bodyText,headerText,canCancel,skipHeader,showOk){var dialogue=getConfirmDialogueContainer(body),buttons=buttonSelectors.map((function(selector){return dialogue.find(selector)})),cancelButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON),okayButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_OKAY_BUTTON),text=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT),dialogueHeader=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);(dialogue.find("button").addClass("hidden"),canCancel?cancelButton.removeClass("hidden"):cancelButton.addClass("hidden"),showOk?okayButton.removeClass("hidden"):okayButton.addClass("hidden"),headerText)?((dialogueHeader=$('<h3 class="h6" data-region="dialogue-header"></h3>')).text(headerText),dialogue.find(SELECTORS.CONFIRM_DIALOGUE).prepend(dialogueHeader)):dialogueHeader.length&&dialogueHeader.remove();buttons.forEach((function(button){button.removeClass("hidden")})),text.text(bodyText),showConfirmDialogueContainer(footer),showConfirmDialogueContainer(body),skipHeader||showConfirmDialogueContainer(header),dialogue.find(SELECTORS.CAN_RECEIVE_FOCUS).filter(":visible").first().focus()},hideConfirmDialogue=function(header,body,footer){var dialogue=getConfirmDialogueContainer(body),cancelButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON),okayButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_OKAY_BUTTON),text=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT),dialogueHeader=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);return hideCheckDeleteDialogue(body),hideConfirmDialogueContainer(body),hideConfirmDialogueContainer(footer),hideConfirmDialogueContainer(header),dialogue.find("button").addClass("hidden"),cancelButton.removeClass("hidden"),okayButton.removeClass("hidden"),text.text(""),dialogueHeader.length&&dialogueHeader.remove(),header.find(SELECTORS.CAN_RECEIVE_FOCUS).first().focus(),!0},renderConfirmBlockUser=function(header,body,footer,user){return user?user.canmessageevenifblocked?Str.get_string("cantblockuser","core_message",user.fullname).then((function(string){return showConfirmDialogue(header,body,footer,[],string,"",!1,!1,!0)})):Str.get_string("blockuserconfirm","core_message",user.fullname).then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_BLOCK],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmUnblockUser=function(header,body,footer,user){return user?Str.get_string("unblockuserconfirm","core_message",user.fullname).then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_UNBLOCK],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmAddContact=function(header,body,footer,user){return user?Str.get_string("addcontactconfirm","core_message",user.fullname).then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_ADD_CONTACT],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmRemoveContact=function(header,body,footer,user){return user?Str.get_string("removecontactconfirm","core_message",user.fullname).then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_REMOVE_CONTACT],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmDeleteSelectedMessages=function(header,body,footer,data){var showmessage=null;return data.type==CONVERSATION_TYPES.SELF?showmessage="deleteselectedmessagesconfirmselfconversation":data.canDeleteMessagesForAllUsers?(showCheckDeleteDialogue(body),showmessage="deleteforeveryoneselectedmessagesconfirm"):showmessage="deleteselectedmessagesconfirm",data.show?Str.get_string(showmessage,"core_message").then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmDeleteConversation=function(header,body,footer,type){var showmessage=null;return type==CONVERSATION_TYPES.SELF?showmessage="deleteallselfconfirm":type&&(showmessage="deleteallconfirm"),showmessage?Str.get_string(showmessage,"core_message").then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_DELETE_CONVERSATION],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmContactRequest=function(header,body,footer,user){return user?Str.get_string("userwouldliketocontactyou","core_message",user.fullname).then((function(string){var buttonSelectors=[SELECTORS.ACTION_ACCEPT_CONTACT_REQUEST,SELECTORS.ACTION_DECLINE_CONTACT_REQUEST];return showConfirmDialogue(header,body,footer,buttonSelectors,string,"",!1,!0)})):hideConfirmDialogue(header,body,footer)},showCheckDeleteDialogue=function(body){getConfirmDialogueContainer(body).find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER).removeClass("hidden")},hideCheckDeleteDialogue=function(body){var dialogue=getConfirmDialogueContainer(body),checkboxRegion=dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER);dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE).prop("checked",!1),checkboxRegion.addClass("hidden")},renderIsBlocked=function(header,body,footer,isBlocked){isBlocked?(header.find(SELECTORS.ACTION_REQUEST_BLOCK).addClass("hidden"),header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).removeClass("hidden")):(header.find(SELECTORS.ACTION_REQUEST_BLOCK).removeClass("hidden"),header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).addClass("hidden"))},renderIsFavourite=function(header,body,footer,state){var favouriteIcon=header.find(SELECTORS.FAVOURITE_ICON_CONTAINER),addFavourite=header.find(SELECTORS.ACTION_CONFIRM_FAVOURITE),removeFavourite=header.find(SELECTORS.ACTION_CONFIRM_UNFAVOURITE);switch(state){case"hide":favouriteIcon.addClass("hidden"),addFavourite.addClass("hidden"),removeFavourite.addClass("hidden");break;case"show-add":favouriteIcon.addClass("hidden"),addFavourite.removeClass("hidden"),removeFavourite.addClass("hidden");break;case"show-remove":favouriteIcon.removeClass("hidden"),addFavourite.addClass("hidden"),removeFavourite.removeClass("hidden")}},renderIsMuted=function(header,body,footer,state){var muteIcon=header.find(SELECTORS.MUTED_ICON_CONTAINER),setMuted=header.find(SELECTORS.ACTION_CONFIRM_MUTE),unsetMuted=header.find(SELECTORS.ACTION_CONFIRM_UNMUTE);switch(state){case"hide":muteIcon.addClass("hidden"),setMuted.addClass("hidden"),unsetMuted.addClass("hidden");break;case"show-mute":muteIcon.addClass("hidden"),setMuted.removeClass("hidden"),unsetMuted.addClass("hidden");break;case"show-unmute":muteIcon.removeClass("hidden"),setMuted.addClass("hidden"),unsetMuted.removeClass("hidden")}},renderIsContact=function(header,body,footer,state){var addContact=header.find(SELECTORS.ACTION_REQUEST_ADD_CONTACT),removeContact=header.find(SELECTORS.ACTION_REQUEST_REMOVE_CONTACT);switch(state){case"pending-contact":addContact.addClass("hidden"),removeContact.addClass("hidden");break;case"contact":addContact.addClass("hidden"),removeContact.removeClass("hidden");break;case"non-contact":addContact.removeClass("hidden"),removeContact.addClass("hidden")}},renderLoadingConfirmAction=function(header,body,footer,isLoading){var dialogue=getConfirmDialogueContainer(body),buttons=dialogue.find("button"),buttonText=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_BUTTON_TEXT),loadingIcon=dialogue.find(SELECTORS.LOADING_ICON_CONTAINER);isLoading?(buttons.prop("disabled",!0),buttonText.addClass("hidden"),loadingIcon.removeClass("hidden")):(buttons.prop("disabled",!1),buttonText.removeClass("hidden"),loadingIcon.addClass("hidden"))},renderInEditMode=function(header,body,footer,inEditMode){var messages=null;inEditMode?((messages=body.find(SELECTORS.MESSAGE_NOT_SELECTED)).find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden"),hideHeaderContent(header),function(header){getHeaderEditMode(header).removeClass("hidden")}(header)):((messages=getMessagesContainer(body)).find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass("hidden"),messages.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass("hidden"),showHeaderContent(header),hideHeaderEditMode(header))},renderSelectedMessages=function(header,body,footer,data){var hasSelectedMessages=data.count>0;data.add.length&&data.add.forEach((function(messageId){var message=getMessageElement(body,messageId);message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass("hidden"),message.find(SELECTORS.MESSAGE_SELECTED_ICON).removeClass("hidden"),message.attr("aria-checked",!0)})),data.remove.length&&data.remove.forEach((function(messageId){var message=getMessageElement(body,messageId);hasSelectedMessages&&message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden"),message.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass("hidden"),message.attr("aria-checked",!1)})),function(header,value){getHeaderEditMode(header).find(SELECTORS.MESSAGES_SELECTED_COUNT).text(value)}(header,data.count)},renderRequireAddContact=function(header,body,footer,data){return data.show&&!data.hasMessages?Str.get_strings([{key:"requirecontacttomessage",component:"core_message",param:data.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:data.user.fullname}]).then((function(strings){var title=strings[1],text=strings[0];return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_REQUEST_ADD_CONTACT],text,title,!1,!0)})):hideConfirmDialogue(header,body,footer)},renderSelfConversationMessage=function(header,body,footer,displayMessage){var container=getSelfConversationMessageContainer(body);return displayMessage?container.removeClass("hidden"):container.addClass("hidden"),!0},renderContactRequestSent=function(header,body,footer,userFullName){var container=getContactRequestSentContainer(body);return userFullName?Str.get_string("yourcontactrequestpending","core_message",userFullName).then((function(string){return container.find(SELECTORS.TEXT).text(string),container.removeClass("hidden"),string})):(container.addClass("hidden"),!0)},renderReset=function(header,body,footer){return hideConfirmDialogue(header,body,footer),function(body){getContactRequestSentContainer(body).addClass("hidden")}(body),function(body){getSelfConversationMessageContainer(body).addClass("hidden")}(body),function(header){hideHeaderContent(header),hideHeaderEditMode(header),hideHeaderPlaceholder(header)}(header),showHeaderPlaceholder(header),hideAllFooterElements(footer),showFooterPlaceholder(footer),!0};return{render:function(header,body,footer,patch){var configs=[{reset:renderReset},{conversation:renderConversation,header:renderHeader,footer:renderFooter,confirmBlockUser:renderConfirmBlockUser,confirmUnblockUser:renderConfirmUnblockUser,confirmAddContact:renderConfirmAddContact,confirmRemoveContact:renderConfirmRemoveContact,confirmDeleteSelectedMessages:renderConfirmDeleteSelectedMessages,confirmDeleteConversation:renderConfirmDeleteConversation,confirmContactRequest:renderConfirmContactRequest,requireAddContact:renderRequireAddContact,selfConversationMessage:renderSelfConversationMessage,contactRequestSent:renderContactRequestSent},{loadingMembers:renderLoadingMembers,loadingFirstMessages:renderLoadingFirstMessages,loadingMessages:renderLoadingMessages,isBlocked:renderIsBlocked,isContact:renderIsContact,isFavourite:renderIsFavourite,isMuted:renderIsMuted,loadingConfirmAction:renderLoadingConfirmAction,inEditMode:renderInEditMode,showEmojiPicker:renderShowEmojiPicker,showEmojiAutoComplete:renderShowEmojiAutoComplete},{scrollToMessage:renderScrollToMessage,selectedMessages:renderSelectedMessages}],processConfig=function(config){var results=[];for(var key in patch)if(config.hasOwnProperty(key)){var renderFunc=config[key],patchValue=patch[key];results.push(renderFunc(header,body,footer,patchValue))}return results},renderingPromises=processConfig(configs[0]);return renderingPromises=renderingPromises.concat(processConfig(configs[1])),$.when.apply($,renderingPromises).then((function(){for(var i=2;i<configs.length;i++)processConfig(configs[i])})).catch(Notification.exception)}}}));
/**
 * Retrieves messages from the server.
 *
 * @module     core_message/message_repository
 * @class      message_repository
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_repository",["jquery","core/ajax","core/notification","core_message/message_drawer_view_conversation_constants"],(function($,Ajax,Notification,Constants){var CONVERSATION_TYPES=Constants.CONVERSATION_TYPES,sendMessagesToUser=function(toUserId,messages){var request={methodname:"core_message_send_instant_messages",args:{messages:messages.map((function(message){return{touserid:toUserId,text:message}}))}};return Ajax.call([request])[0].then((function(results){var errors=results.reduce((function(carry,result){return result.errormessage&&carry.push(result.errormessage),carry}),[]);if(errors.length)throw new Error(errors.join("\n"));return results})).then((function(results){return results.map((function(result){return{id:result.msgid,text:result.text,timecreated:result.timecreated,useridfrom:result.useridfrom,conversationid:result.conversationid,candeletemessagesforallusers:result.candeletemessagesforallusers}}))}))},sendMessagesToConversation=function(conversationId,messages){var request={methodname:"core_message_send_messages_to_conversation",args:{conversationid:conversationId,messages:messages.map((function(message){return{text:message}}))}};return Ajax.call([request])[0]};return{query:function(args){void 0===args.limit&&(args.limit=0),void 0===args.offset&&(args.offset=0),void 0===args.type&&(args.type=null),void 0===args.favouritesonly&&(args.favouritesonly=!1),args.limitfrom=args.offset,args.limitnum=args.limit,delete args.limit,delete args.offset;var request={methodname:"core_message_data_for_messagearea_conversations",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},countUnreadConversations:function(args){var request={methodname:"core_message_get_unread_conversations_count",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},markAllAsRead:function(args){var request={methodname:"core_message_mark_all_messages_as_read",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},getContacts:function(userId,limit,offset){var args={userid:userId};void 0!==limit&&(args.limitnum=limit),void 0!==offset&&(args.limitfrom=offset);var request={methodname:"core_message_get_user_contacts",args:args};return Ajax.call([request])[0]},getProfile:function(userId,profileUserId){var request={methodname:"core_message_data_for_messagearea_get_profile",args:{currentuserid:userId,otheruserid:profileUserId}};return Ajax.call([request])[0]},blockUser:function(userId,blockedUserId){var requests=[{methodname:"core_message_block_user",args:{userid:userId,blockeduserid:blockedUserId}},{methodname:"core_message_get_member_info",args:{referenceuserid:userId,userids:[blockedUserId],includecontactrequests:!0,includeprivacyinfo:!0}}];return $.when.apply(null,Ajax.call(requests)).then((function(reponse1,profiles){return profiles.length?profiles[0]:{}}))},unblockUser:function(userId,unblockedUserId){var requests=[{methodname:"core_message_unblock_user",args:{userid:userId,unblockeduserid:unblockedUserId}},{methodname:"core_message_get_member_info",args:{referenceuserid:userId,userids:[unblockedUserId],includecontactrequests:!0,includeprivacyinfo:!0}}];return $.when.apply(null,Ajax.call(requests)).then((function(reponse1,profiles){return profiles.length?profiles[0]:{}}))},createContactRequest:function(userId,requestUserIds){var request={methodname:"core_message_create_contact_request",args:{userid:userId,requesteduserid:requestUserIds}};return Ajax.call([request])[0]},deleteContacts:function(userId,contactUserIds){var requests=[{methodname:"core_message_delete_contacts",args:{userid:userId,userids:contactUserIds}},{methodname:"core_message_get_member_info",args:{referenceuserid:userId,userids:contactUserIds,includecontactrequests:!0,includeprivacyinfo:!0}}];return $.when.apply(null,Ajax.call(requests)).then((function(response1,profiles){return profiles}))},getMessages:function(currentUserId,conversationId,limit,offset,newestFirst,timeFrom){var args={currentuserid:currentUserId,convid:conversationId,newest:!!newestFirst};void 0!==limit&&(args.limitnum=limit),void 0!==offset&&(args.limitfrom=offset),void 0!==timeFrom&&(args.timefrom=timeFrom);var request={methodname:"core_message_get_conversation_messages",args:args};return Ajax.call([request])[0]},searchUsers:function(userId,searchString,limit,offset){var args={userid:userId,search:searchString};void 0!==limit&&(args.limitnum=limit),void 0!==offset&&(args.limitfrom=offset);var request={methodname:"core_message_message_search_users",args:args};return Ajax.call([request])[0]},searchMessages:function(userId,searchString,limit,offset){var args={userid:userId,search:searchString};void 0!==limit&&(args.limitnum=limit),void 0!==offset&&(args.limitfrom=offset);var request={methodname:"core_message_data_for_messagearea_search_messages",args:args};return Ajax.call([request])[0]},sendMessagesToUser:sendMessagesToUser,sendMessageToUser:function(toUserId,text){return sendMessagesToUser(toUserId,[text]).then((function(results){return results[0]}))},sendMessagesToConversation:sendMessagesToConversation,sendMessageToConversation:function(conversationId,text){return sendMessagesToConversation(conversationId,[text]).then((function(result){return result[0]}))},savePreferences:function(userId,preferences){var request={methodname:"core_user_update_user_preferences",args:{userid:userId,preferences:preferences}};return Ajax.call([request])[0]},getPreferences:function(userId){var request={methodname:"core_user_get_user_preferences",args:{userid:userId}};return Ajax.call([request])[0]},deleteMessages:function(userId,messageIds){return $.when.apply(null,Ajax.call(messageIds.map((function(messageId){return{methodname:"core_message_delete_message",args:{messageid:messageId,userid:userId}}}))))},deleteMessagesForAllUsers:function(userId,messageIds){return $.when.apply(null,Ajax.call(messageIds.map((function(messageId){return{methodname:"core_message_delete_message_for_all_users",args:{messageid:messageId,userid:userId}}}))))},deleteConversation:function(userId,conversationId){var request={methodname:"core_message_delete_conversations_by_id",args:{userid:userId,conversationids:[conversationId]}};return Ajax.call([request])[0]},getContactRequests:function(userId){var request={methodname:"core_message_get_contact_requests",args:{userid:userId}};return Ajax.call([request])[0]},acceptContactRequest:function(sendingUserId,recipientUserId){var requests=[{methodname:"core_message_confirm_contact_request",args:{userid:sendingUserId,requesteduserid:recipientUserId}},{methodname:"core_message_get_member_info",args:{referenceuserid:recipientUserId,userids:[sendingUserId],includecontactrequests:!0,includeprivacyinfo:!0}}];return $.when.apply(null,Ajax.call(requests)).then((function(reponse1,profiles){return profiles.length?profiles[0]:{}}))},declineContactRequest:function(sendingUserId,recipientUserId){var requests=[{methodname:"core_message_decline_contact_request",args:{userid:sendingUserId,requesteduserid:recipientUserId}},{methodname:"core_message_get_member_info",args:{referenceuserid:recipientUserId,userids:[sendingUserId],includecontactrequests:!0,includeprivacyinfo:!0}}];return $.when.apply(null,Ajax.call(requests)).then((function(reponse1,profiles){return profiles.length?profiles[0]:{}}))},getConversation:function(loggedInUserId,conversationId,includeContactRequests,includePrivacyInfo,memberLimit,memberOffset,messageLimit,messageOffset,newestMessagesFirst){var args={userid:loggedInUserId,conversationid:conversationId};null!=includeContactRequests&&(args.includecontactrequests=includeContactRequests),null!=includePrivacyInfo&&(args.includeprivacyinfo=includePrivacyInfo),null!=memberLimit&&(args.memberlimit=memberLimit),null!=memberOffset&&(args.memberoffset=memberOffset),null!=messageLimit&&(args.messagelimit=messageLimit),null!=messageOffset&&(args.messageoffset=messageOffset),null!=newestMessagesFirst&&(args.newestmessagesfirst=newestMessagesFirst);var request={methodname:"core_message_get_conversation",args:args};return Ajax.call([request])[0]},getConversationBetweenUsers:function(loggedInUserId,otherUserId,includeContactRequests,includePrivacyInfo,memberLimit,memberOffset,messageLimit,messageOffset,newestMessagesFirst){var args={userid:loggedInUserId,otheruserid:otherUserId};null!=includeContactRequests&&(args.includecontactrequests=includeContactRequests),null!=includePrivacyInfo&&(args.includeprivacyinfo=includePrivacyInfo),null!=memberLimit&&(args.memberlimit=memberLimit),null!=memberOffset&&(args.memberoffset=memberOffset),null!=messageLimit&&(args.messagelimit=messageLimit),null!=messageOffset&&(args.messageoffset=messageOffset),null!=newestMessagesFirst&&(args.newestmessagesfirst=newestMessagesFirst);var request={methodname:"core_message_get_conversation_between_users",args:args};return Ajax.call([request])[0]},getSelfConversation:function(loggedInUserId,messageLimit,messageOffset,newestMessagesFirst){var args={userid:loggedInUserId};null!=messageLimit&&(args.messagelimit=messageLimit),null!=messageOffset&&(args.messageoffset=messageOffset),null!=newestMessagesFirst&&(args.newestmessagesfirst=newestMessagesFirst);var request={methodname:"core_message_get_self_conversation",args:args};return Ajax.call([request])[0]},getConversations:function(userId,type,limit,offset,favourites,mergeself){var args={userid:userId,type:type};null!=limit&&(args.limitnum=limit),null!=offset&&(args.limitfrom=offset),null!=favourites&&(args.favourites=favourites),null!=mergeself&&(args.mergeself=mergeself);var request={methodname:"core_message_get_conversations",args:args};return Ajax.call([request])[0].then((function(result){return result.conversations.length&&(result.conversations=result.conversations.map((function(conversation){if(conversation.type==CONVERSATION_TYPES.PRIVATE||conversation.type==CONVERSATION_TYPES.SELF){var otherUser=conversation.members.length?conversation.members[0]:null;otherUser&&(conversation.name=conversation.name?conversation.name:otherUser.fullname,conversation.imageurl=conversation.imageurl?conversation.imageurl:otherUser.profileimageurl)}return conversation}))),result}))},getConversationMembers:function(conversationId,loggedInUserId,limit,offset,includeContactRequests){var args={userid:loggedInUserId,conversationid:conversationId};null!=limit&&(args.limitnum=limit),null!=offset&&(args.limitfrom=offset),null!=includeContactRequests&&(args.includecontactrequests=includeContactRequests);var request={methodname:"core_message_get_conversation_members",args:args};return Ajax.call([request])[0]},setFavouriteConversations:function(userId,conversationIds){var request={methodname:"core_message_set_favourite_conversations",args:{userid:userId,conversations:conversationIds}};return Ajax.call([request])[0]},setMutedConversations:function(userId,conversationIds){var request={methodname:"core_message_mute_conversations",args:{userid:userId,conversationids:conversationIds}};return Ajax.call([request])[0]},unsetFavouriteConversations:function(userId,conversationIds){var request={methodname:"core_message_unset_favourite_conversations",args:{userid:userId,conversations:conversationIds}};return Ajax.call([request])[0]},unsetMutedConversations:function(userId,conversationIds){var request={methodname:"core_message_unmute_conversations",args:{userid:userId,conversationids:conversationIds}};return Ajax.call([request])[0]},getMemberInfo:function(referenceUserId,userIds,includeContactRequests,includePrivacyInfo){var args={referenceuserid:referenceUserId,userids:userIds};void 0!==includeContactRequests&&(args.includecontactrequests=includeContactRequests),void 0!==includePrivacyInfo&&(args.includeprivacyinfo=includePrivacyInfo);var request={methodname:"core_message_get_member_info",args:args};return Ajax.call([request])[0]},markAllConversationMessagesAsRead:function(userId,conversationId){var request={methodname:"core_message_mark_all_conversation_messages_as_read",args:{userid:userId,conversationid:conversationId}};return Ajax.call([request])[0]},getUserMessagePreferences:function(userId){var request={methodname:"core_message_get_user_message_preferences",args:{userid:userId}};return Ajax.call([request])[0]},getTotalConversationCounts:function(userId){var request={methodname:"core_message_get_conversation_counts",args:{userid:userId}};return Ajax.call([request])[0]},getUnreadConversationCounts:function(userId){var request={methodname:"core_message_get_unread_conversation_counts",args:{userid:userId}};return Ajax.call([request])[0]},getAllConversationCounts:function(userId){var requests=[{methodname:"core_message_get_conversation_counts",args:{userid:userId}},{methodname:"core_message_get_unread_conversation_counts",args:{userid:userId}}];return $.when.apply(null,Ajax.call(requests)).then((function(total,unread){return{total:total,unread:unread}}))}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Controls the search page of the message drawer.
 *
 * @module     core_message/message_drawer_view_search
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core_message/message_drawer_view_search",["jquery","core/custom_interaction_events","core/notification","core/pubsub","core/str","core/templates","core_message/message_repository","core_message/message_drawer_events"],(function($,CustomEvents,Notification,PubSub,Str,Templates,Repository,Events){var SELECTORS_BLOCK_ICON_CONTAINER='[data-region="block-icon-container"]',SELECTORS_CANCEL_SEARCH_BUTTON='[data-action="cancel-search"]',SELECTORS_CONTACTS_CONTAINER='[data-region="contacts-container"]',SELECTORS_CONTACTS_LIST='[data-region="contacts-container"] [data-region="list"]',SELECTORS_EMPTY_MESSAGE_CONTAINER='[data-region="empty-message-container"]',SELECTORS_LIST='[data-region="list"]',SELECTORS_LOADING_ICON_CONTAINER='[data-region="loading-icon-container"]',SELECTORS_LOADING_PLACEHOLDER='[data-region="loading-placeholder"]',SELECTORS_MESSAGES_LIST='[data-region="messages-container"] [data-region="list"]',SELECTORS_MESSAGES_CONTAINER='[data-region="messages-container"]',SELECTORS_NON_CONTACTS_CONTAINER='[data-region="non-contacts-container"]',SELECTORS_NON_CONTACTS_LIST='[data-region="non-contacts-container"] [data-region="list"]',SELECTORS_SEARCH_ICON_CONTAINER='[data-region="search-icon-container"]',SELECTORS_SEARCH_ACTION='[data-action="search"]',SELECTORS_SEARCH_INPUT='[data-region="search-input"]',SELECTORS_SEARCH_RESULTS_CONTAINER='[data-region="search-results-container"]',SELECTORS_LOAD_MORE_USERS='[data-action="load-more-users"]',SELECTORS_LOAD_MORE_MESSAGES='[data-action="load-more-messages"]',SELECTORS_BUTTON_TEXT='[data-region="button-text"]',SELECTORS_NO_RESULTS_CONTAINTER='[data-region="no-results-container"]',SELECTORS_ALL_CONTACTS_CONTAINER='[data-region="all-contacts-container"]',TEMPLATES_CONTACTS_LIST="core_message/message_drawer_contacts_list",TEMPLATES_NON_CONTACTS_LIST="core_message/message_drawer_non_contacts_list",TEMPLATES_MESSAGES_LIST="core_message/message_drawer_messages_list",getLoggedInUserId=function(body){return body.attr("data-user-id")},getEmptyMessageContainer=function(body){return body.find(SELECTORS_EMPTY_MESSAGE_CONTAINER)},getLoadingIconContainer=function(header){return header.find(SELECTORS_LOADING_ICON_CONTAINER)},getLoadingPlaceholder=function(body){return body.find(SELECTORS_LOADING_PLACEHOLDER)},getSearchIconContainer=function(header){return header.find(SELECTORS_SEARCH_ICON_CONTAINER)},getSearchInput=function(header){return header.find(SELECTORS_SEARCH_INPUT)},getSearchResultsContainer=function(body){return body.find(SELECTORS_SEARCH_RESULTS_CONTAINER)},getContactsContainer=function(body){return body.find(SELECTORS_CONTACTS_CONTAINER)},getNonContactsContainer=function(body){return body.find(SELECTORS_NON_CONTACTS_CONTAINER)},hideEmptyMessage=function(body){getEmptyMessageContainer(body).addClass("hidden")},hideLoadingIcon=function(header){getLoadingIconContainer(header).addClass("hidden")},hideLoadingPlaceholder=function(body){getLoadingPlaceholder(body).addClass("hidden")},showSearchIcon=function(header){getSearchIconContainer(header).removeClass("hidden")},hideSearchResults=function(body){getSearchResultsContainer(body).addClass("hidden")},clearAllSearchResults=function(body){body.find(SELECTORS_CONTACTS_LIST).empty(),body.find(SELECTORS_NON_CONTACTS_LIST).empty(),body.find(SELECTORS_MESSAGES_LIST).empty(),function(body){var container=getSearchResultsContainer(body);container.find(SELECTORS_ALL_CONTACTS_CONTAINER).removeClass("hidden"),container.find(SELECTORS_MESSAGES_CONTAINER).removeClass("hidden"),container.find(SELECTORS_NO_RESULTS_CONTAINTER).addClass("hidden")}(body),function(body){getSearchResultsContainer(body).find(SELECTORS_ALL_CONTACTS_CONTAINER).removeClass("hidden")}(body),function(body){getSearchResultsContainer(body).find(SELECTORS_CONTACTS_CONTAINER).removeClass("hidden")}(body),function(body){getSearchResultsContainer(body).find(SELECTORS_NON_CONTACTS_CONTAINER).removeClass("hidden")}(body),function(body){getSearchResultsContainer(body).find(SELECTORS_MESSAGES_CONTAINER).removeClass("hidden")}(body),showLoadMoreUsersButton(body),showLoadMoreMessagesButton(body)},startLoading=function(header,body){!function(header){getSearchIconContainer(header).addClass("hidden")}(header),hideEmptyMessage(body),hideSearchResults(body),function(header){getLoadingIconContainer(header).removeClass("hidden")}(header),function(body){getLoadingPlaceholder(body).removeClass("hidden")}(body),function(header){getSearchInput(header).prop("disabled",!0)}(header)},stopLoading=function(header,body){showSearchIcon(header),hideEmptyMessage(body),function(body){getSearchResultsContainer(body).removeClass("hidden")}(body),hideLoadingIcon(header),hideLoadingPlaceholder(body),function(header){getSearchInput(header).prop("disabled",!1)}(header)},hideUsersLoadingIcon=function(root){var button=root.find(SELECTORS_LOAD_MORE_USERS);button.prop("disabled",!1),button.find(SELECTORS_BUTTON_TEXT).removeClass("hidden"),button.find(SELECTORS_LOADING_ICON_CONTAINER).addClass("hidden")},showLoadMoreUsersButton=function(root){root.find(SELECTORS_LOAD_MORE_USERS).removeClass("hidden")},hideMessagesLoadingIcon=function(root){var button=root.find(SELECTORS_LOAD_MORE_MESSAGES);button.prop("disabled",!1),button.find(SELECTORS_BUTTON_TEXT).removeClass("hidden"),button.find(SELECTORS_LOADING_ICON_CONTAINER).addClass("hidden")},showLoadMoreMessagesButton=function(root){root.find(SELECTORS_LOAD_MORE_MESSAGES).removeClass("hidden")},findContact=function(root,userId){return root.find('[data-contact-user-id="'+userId+'"]')},highlightSearch=function(content,searchText){if(!content)return"";var regex=new RegExp("("+searchText+")","gi");return content.replace(regex,'<span class="matchtext">$1</span>')},renderMessages=function(root,messages){var container=root.find(SELECTORS_MESSAGES_CONTAINER),frompanel=root.attr("data-in-panel"),list=container.find(SELECTORS_LIST);return Templates.render(TEMPLATES_MESSAGES_LIST,{messages:messages,frompanel:frompanel}).then((function(html){return list.append(html),html}))},loadMoreUsers=function(root,loggedInUserId,text,limit,offset){var loadedAll=!1;return function(root){var button=root.find(SELECTORS_LOAD_MORE_USERS);button.prop("disabled",!0),button.find(SELECTORS_BUTTON_TEXT).addClass("hidden"),button.find(SELECTORS_LOADING_ICON_CONTAINER).removeClass("hidden")}(root),Repository.searchUsers(loggedInUserId,text,limit+1,offset).then((function(results){var contacts=results.contacts,noncontacts=results.noncontacts;return contacts.length<=limit&&noncontacts.length<=limit?(loadedAll=!0,{contacts:contacts,noncontacts:noncontacts}):{contacts:contacts.slice(0,limit),noncontacts:noncontacts.slice(0,limit)}})).then((function(results){var contactsCount=results.contacts.length,nonContactsCount=results.noncontacts.length;return contactsCount&&results.contacts.forEach((function(contact){contact.highlight=highlightSearch(contact.fullname,text)})),nonContactsCount&&results.noncontacts.forEach((function(contact){contact.highlight=highlightSearch(contact.fullname,text)})),$.when(!contactsCount||function(root,contacts){var container=getContactsContainer(root),frompanel=root.attr("data-in-panel"),list=container.find(SELECTORS_LIST);return Templates.render(TEMPLATES_CONTACTS_LIST,{contacts:contacts,frompanel:frompanel}).then((function(html){return list.append(html),html}))}(root,results.contacts),!nonContactsCount||function(root,nonContacts){var container=getNonContactsContainer(root),frompanel=root.attr("data-in-panel"),list=container.find(SELECTORS_LIST);return Templates.render(TEMPLATES_NON_CONTACTS_LIST,{noncontacts:nonContacts,frompanel:frompanel}).then((function(html){return list.append(html),html}))}(root,results.noncontacts)).then((function(){return{contactsCount:contactsCount,nonContactsCount:nonContactsCount}}))})).then((function(counts){return hideUsersLoadingIcon(root),loadedAll&&function(root){root.find(SELECTORS_LOAD_MORE_USERS).addClass("hidden")}(root),counts})).catch((function(error){throw hideUsersLoadingIcon(root),error}))},loadMoreMessages=function(root,loggedInUserId,text,limit,offset){var loadedAll=!1;return function(root){var button=root.find(SELECTORS_LOAD_MORE_MESSAGES);button.prop("disabled",!0),button.find(SELECTORS_BUTTON_TEXT).addClass("hidden"),button.find(SELECTORS_LOADING_ICON_CONTAINER).removeClass("hidden")}(root),Repository.searchMessages(loggedInUserId,text,limit+1,offset).then((function(results){var messages=results.contacts;return messages.length<=limit?(loadedAll=!0,messages):messages.slice(0,limit)})).then((function(messages){return messages.length?(messages.forEach((function(message){message.lastmessage=highlightSearch(message.lastmessage,text)})),renderMessages(root,messages).then((function(){return messages.length}))):messages.length})).then((function(count){return hideMessagesLoadingIcon(root),loadedAll&&function(root){root.find(SELECTORS_LOAD_MORE_MESSAGES).addClass("hidden")}(root),count})).catch((function(error){throw hideMessagesLoadingIcon(root),error}))},search=function(header,body,searchText,usersLimit,usersOffset,messagesLimit,messagesOffset){var loggedInUserId=getLoggedInUserId(body);return startLoading(header,body),clearAllSearchResults(body),$.when(loadMoreUsers(body,loggedInUserId,searchText,usersLimit,usersOffset),loadMoreMessages(body,loggedInUserId,searchText,messagesLimit,messagesOffset)).then((function(userCounts,messagesCount){var contactsCount=userCounts.contactsCount,nonContactsCount=userCounts.nonContactsCount;stopLoading(header,body),contactsCount||nonContactsCount||messagesCount?(contactsCount||nonContactsCount?(contactsCount||function(body){getSearchResultsContainer(body).find(SELECTORS_CONTACTS_CONTAINER).addClass("hidden")}(body),nonContactsCount||function(body){getSearchResultsContainer(body).find(SELECTORS_NON_CONTACTS_CONTAINER).addClass("hidden")}(body)):function(body){getSearchResultsContainer(body).find(SELECTORS_ALL_CONTACTS_CONTAINER).addClass("hidden")}(body),messagesCount||function(body){getSearchResultsContainer(body).find(SELECTORS_MESSAGES_CONTAINER).addClass("hidden")}(body)):function(body){var container=getSearchResultsContainer(body);container.find(SELECTORS_ALL_CONTACTS_CONTAINER).addClass("hidden"),container.find(SELECTORS_MESSAGES_CONTAINER).addClass("hidden"),container.find(SELECTORS_NO_RESULTS_CONTAINTER).removeClass("hidden")}(body)}))},registerEventListeners=function(header,body){var loggedInUserId=getLoggedInUserId(body),searchInput=getSearchInput(header),searchText="",messagesOffset=0,usersOffset=0,searchEventHandler=function(e,data){""!==(searchText=searchInput.val().trim())&&search(header,body,searchText,3,usersOffset=0,50,messagesOffset=0).then((function(){searchInput.focus(),usersOffset+=3,messagesOffset+=50})).catch(Notification.exception),data.originalEvent.preventDefault()};CustomEvents.define(searchInput,[CustomEvents.events.enter]),CustomEvents.define(header,[CustomEvents.events.activate]),CustomEvents.define(body,[CustomEvents.events.activate]),searchInput.on(CustomEvents.events.enter,searchEventHandler),header.on(CustomEvents.events.activate,SELECTORS_SEARCH_ACTION,searchEventHandler),body.on(CustomEvents.events.activate,SELECTORS_LOAD_MORE_MESSAGES,(function(e,data){""!==searchText&&loadMoreMessages(body,loggedInUserId,searchText,50,messagesOffset).then((function(){messagesOffset+=50})).catch(Notification.exception),data.originalEvent.preventDefault()})),body.on(CustomEvents.events.activate,SELECTORS_LOAD_MORE_USERS,(function(e,data){""!==searchText&&loadMoreUsers(body,loggedInUserId,searchText,50,usersOffset).then((function(){usersOffset+=50})).catch(Notification.exception),data.originalEvent.preventDefault()})),header.on(CustomEvents.events.activate,SELECTORS_CANCEL_SEARCH_BUTTON,(function(){!function(header){getSearchInput(header).val("")}(header),function(body){getEmptyMessageContainer(body).removeClass("hidden")}(body),showSearchIcon(header),hideSearchResults(body),hideLoadingIcon(header),hideLoadingPlaceholder(body),usersOffset=0,messagesOffset=0})),PubSub.subscribe(Events.CONTACT_ADDED,(function(userId){!function(root,contact){var nonContactsContainer=getNonContactsContainer(root),nonContact=findContact(nonContactsContainer,contact.userid);if(nonContact.length){nonContact.remove();var contactsContainer=getContactsContainer(root);contactsContainer.removeClass("hidden"),contactsContainer.find(SELECTORS_LIST).append(nonContact)}nonContactsContainer.find(SELECTORS_LIST).children().length||nonContactsContainer.addClass("hidden")}(body,userId)})),PubSub.subscribe(Events.CONTACT_REMOVED,(function(userId){!function(root,userId){var contactsContainer=getContactsContainer(root),contact=findContact(contactsContainer,userId);if(contact.length){contact.remove();var nonContactsContainer=getNonContactsContainer(root);nonContactsContainer.removeClass("hidden"),nonContactsContainer.find(SELECTORS_LIST).append(contact)}contactsContainer.find(SELECTORS_LIST).children().length||contactsContainer.addClass("hidden")}(body,userId)})),PubSub.subscribe(Events.CONTACT_BLOCKED,(function(userId){!function(root,userId){var contact=findContact(root,userId);contact.length&&contact.find(SELECTORS_BLOCK_ICON_CONTAINER).removeClass("hidden")}(body,userId)})),PubSub.subscribe(Events.CONTACT_UNBLOCKED,(function(userId){!function(root,userId){var contact=findContact(root,userId);contact.length&&contact.find(SELECTORS_BLOCK_ICON_CONTAINER).addClass("hidden")}(body,userId)}))};return{show:function(namespace,header,body){return body.attr("data-init")||(registerEventListeners(header,body),body.attr("data-init",!0)),getSearchInput(header).focus(),$.Deferred().resolve().promise()},description:function(namespace,header){if("object"!==_typeof(header))return Str.get_string("messagedrawerviewsearch","core_message");var searchText=getSearchInput(header).val().trim();return Str.get_string("messagedrawerviewsearch","core_message",searchText)}}}));
/**
 * Lazy loaded list of items.
 *
 * @module     core_message/message_drawer_lazy_load_list
 * @package    message
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_lazy_load_list",["jquery","core/custom_interaction_events"],(function($,CustomEvents){var SELECTORS_ROOT='[data-region="lazy-load-list"]',SELECTORS_LOADING_ICON_CONTAINER='[data-region="loading-icon-container"]',SELECTORS_CONTENT_CONTAINER='[data-region="content-container"]',SELECTORS_EMPTY_MESSAGE='[data-region="empty-message-container"]',SELECTORS_PLACEHOLDER='[data-region="placeholder-container"]',stopLoading=function(root){root.attr("data-loading",!1)},getContentContainer=function(root){return root.find(SELECTORS_CONTENT_CONTAINER)},hideLoadingIcon=function(root){root.find(SELECTORS_LOADING_ICON_CONTAINER).addClass("hidden")},showEmptyMessage=function(root){root.find(SELECTORS_EMPTY_MESSAGE).removeClass("hidden")},hidePlaceholder=function(root){root.find(SELECTORS_PLACEHOLDER).addClass("hidden")},showContent=function(root){getContentContainer(root).removeClass("hidden")},hideContent=function(root){getContentContainer(root).addClass("hidden")},setLoadedAll=function(root,value){root.attr("data-loaded-all",value)},loadAndRender=function(root,loadCallback,renderCallback){var userId=function(root){return root.attr("data-user-id")}(root);return function(root){root.attr("data-loading",!0)}(root),loadCallback(root,userId).then((function(items){if(items.length>0){var contentContainer=getContentContainer(root);return renderCallback(contentContainer,items,userId).then((function(){return items}))}return items})).then((function(items){return stopLoading(root),root.attr("data-seen",!0),items.length||setLoadedAll(root,!0),items})).catch((function(){stopLoading(root),root.attr("data-seen",!0)}))},initialLoadAndRender=function(root,loadCallback,renderCallback){return getContentContainer(root).empty(),function(root){root.find(SELECTORS_PLACEHOLDER).removeClass("hidden")}(root),hideContent(root),loadAndRender(root,loadCallback,renderCallback).then((function(items){hidePlaceholder(root),items.length?showContent(root):showEmptyMessage(root)})).catch((function(){hidePlaceholder(root),showContent(root)}))},registerEventListeners=function(root,loadCallback,renderCallback){CustomEvents.define(root,[CustomEvents.events.scrollBottom]),root.on(CustomEvents.events.scrollBottom,(function(){(function(root){return!function(root){return"true"==root.attr("data-loaded-all")}(root)&&!function(root){return"true"===root.attr("data-loading")}(root)})(root)&&(!function(root){root.find(SELECTORS_LOADING_ICON_CONTAINER).removeClass("hidden")}(root),loadAndRender(root,loadCallback,renderCallback).then((function(){return hideLoadingIcon(root)})).catch((function(){return hideLoadingIcon(root)})))}))};return{show:function(root,loadCallback,renderCallback){(root=$(root)).attr("data-init")||(registerEventListeners(root,loadCallback,renderCallback),initialLoadAndRender(root,loadCallback,renderCallback),root.attr("data-init",!0))},getContentContainer:getContentContainer,getRoot:function(containerElement){return containerElement.find(SELECTORS_ROOT)},setLoadedAll:setLoadedAll,showEmptyMessage:showEmptyMessage,hideEmptyMessage:function(root){root.find(SELECTORS_EMPTY_MESSAGE).addClass("hidden")},showContent:showContent,hideContent:hideContent}}));
/**
 * Controls the preferences for the list of notification types on the
 * message preference page
 *
 * @module     core_message/preferences_notifications_list_controller
 * @class      preferences_notifications_list_controller
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/preferences_notifications_list_controller",["jquery","core/ajax","core/notification","core/custom_interaction_events","core_message/notification_preference","core_message/notification_processor_settings","core/modal_factory"],(function($,Ajax,Notification,CustomEvents,NotificationPreference,NotificationProcessorSettings,ModalFactory){var SELECTORS_DISABLE_NOTIFICATIONS='[data-region="disable-notification-container"] [data-disable-notifications]',SELECTORS_DISABLE_NOTIFICATIONS_CONTAINER='[data-region="disable-notification-container"]',SELECTORS_PREFERENCE="[data-state]",SELECTORS_PREFERENCE_ROW='[data-region="preference-row"]',SELECTORS_PREFERENCE_INPUT="[data-state] input",SELECTORS_PROCESSOR_SETTING="[data-processor-setting]",PreferencesController=function(element){this.root=$(element),this.userId=this.root.attr("data-user-id"),this.registerEventListeners()};return PreferencesController.prototype.isDisabled=function(){return this.root.hasClass("disabled")},PreferencesController.prototype.setDisabled=function(){this.root.addClass("disabled"),this.root.find(SELECTORS_PREFERENCE_INPUT).prop("disabled",!0)},PreferencesController.prototype.setEnabled=function(){this.root.removeClass("disabled"),this.root.find(SELECTORS_PREFERENCE_INPUT).prop("disabled",!1)},PreferencesController.prototype.toggleDisableAllStatus=function(){var checkbox=$(SELECTORS_DISABLE_NOTIFICATIONS),container=$(SELECTORS_DISABLE_NOTIFICATIONS_CONTAINER),ischecked=checkbox.prop("checked");if(container.hasClass("loading"))return $.Deferred().resolve();container.addClass("loading");var request={methodname:"core_user_update_user_preferences",args:{userid:this.userId,emailstop:ischecked?1:0}};return Ajax.call([request])[0].done(function(){ischecked?this.setDisabled():this.setEnabled()}.bind(this)).always((function(){container.removeClass("loading")})).fail(Notification.exception)},PreferencesController.prototype.registerEventListeners=function(){var disabledNotificationsElement=$(SELECTORS_DISABLE_NOTIFICATIONS);CustomEvents.define(this.root,[CustomEvents.events.activate]),this.root.on("change",function(e){if(!this.isDisabled()){var preferenceElement=$(e.target).closest(SELECTORS_PREFERENCE),preferenceRow=$(e.target).closest(SELECTORS_PREFERENCE_ROW),preference=new NotificationPreference(preferenceRow,this.userId);preferenceElement.addClass("loading"),preference.save().always((function(){preferenceElement.removeClass("loading")}))}}.bind(this));var eventFormPromise=ModalFactory.create({type:NotificationProcessorSettings.TYPE});this.root.on(CustomEvents.events.activate,SELECTORS_PROCESSOR_SETTING,(function(e){var element=$(e.target).closest(SELECTORS_PROCESSOR_SETTING);e.preventDefault(),eventFormPromise.then((function(modal){modal.setUserId($(element).attr("data-user-id")),modal.setName($(element).attr("data-name")),modal.setContextId($(element).attr("data-context-id")),modal.setElement(element),modal.show(),e.stopImmediatePropagation()})).fail(Notification.exception)})),CustomEvents.define(disabledNotificationsElement,[CustomEvents.events.activate]),disabledNotificationsElement.on(CustomEvents.events.activate,function(){this.toggleDisableAllStatus()}.bind(this))},PreferencesController}));
/**
 * Controls the contacts page of the message drawer.
 *
 * @module     core_message/message_drawer_view_contacts
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_contacts",["jquery","core/pubsub","core/str","core_message/message_drawer_events","core_message/message_drawer_view_contacts_section_contacts","core_message/message_drawer_view_contacts_section_requests"],(function($,PubSub,Str,MessageDrawerEvents,ContactsSection,RequestsSection){var SELECTORS_ACTION_SHOW_CONTACTS_SECTION='[data-action="show-contacts-section"]',SELECTORS_ACTION_SHOW_REQUESTS_SECTION='[data-action="show-requests-section"]',SELECTORS_CONTACT_REQUEST_COUNT='[data-region="contact-request-count"]',SELECTORS_CONTACTS_SECTION_CONTAINER='[data-section="contacts"]',SELECTORS_REQUESTS_SECTION_CONTAINER='[data-section="requests"]',getContactsSectionContainer=function(body){return body.find(SELECTORS_CONTACTS_SECTION_CONTAINER)},getRequestsSectionContainer=function(body){return body.find(SELECTORS_REQUESTS_SECTION_CONTAINER)},getShowContactsAction=function(body){return body.find(SELECTORS_ACTION_SHOW_CONTACTS_SECTION)},getShowRequestsAction=function(body){return body.find(SELECTORS_ACTION_SHOW_REQUESTS_SECTION)},decrementContactRequestCount=function(body){return function(){var countContainer=body.find(SELECTORS_CONTACT_REQUEST_COUNT),count=parseInt(countContainer.text(),10);(count=isNaN(count)?0:count-1)<=0?countContainer.addClass("hidden"):countContainer.text(count)}};return{show:function(namespace,header,body,footer,tab){(body=$(body)).attr("data-contacts-init")||(!function(body){var contactsSection=getContactsSectionContainer(body),requestsSection=getRequestsSectionContainer(body),showContactsAction=getShowContactsAction(body),showRequestsAction=getShowRequestsAction(body);showContactsAction.on("show.bs.tab",(function(){ContactsSection.show(contactsSection)})),showRequestsAction.on("show.bs.tab",(function(){RequestsSection.show(requestsSection)})),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED,decrementContactRequestCount(body)),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_DECLINED,decrementContactRequestCount(body))}(body),body.attr("data-contacts-init",!0));var contactsSection=getContactsSectionContainer(body),requestsSection=getRequestsSectionContainer(body);if(tab){var showContactsAction=getShowContactsAction(body),showRequestsAction=getShowRequestsAction(body);"requests"==tab?(showContactsAction.removeClass("active"),contactsSection.removeClass("show active"),showRequestsAction.addClass("active"),requestsSection.addClass("show active")):(showRequestsAction.removeClass("active"),requestsSection.removeClass("show active"),showContactsAction.addClass("active"),contactsSection.addClass("show active"))}return contactsSection.hasClass("active")?ContactsSection.show(contactsSection):RequestsSection.show(requestsSection),$.Deferred().resolve().promise()},description:function(){return Str.get_string("messagedrawerviewcontacts","core_message")}}}));
/**
 * Module to message a user from their profile page.
 *
 * @module     core_message/message_user_button
 * @copyright  2019 Mark Nelson <markn@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_user_button",["jquery","core/custom_interaction_events","core_message/message_drawer_helper","core/templates"],(function($,CustomEvents,MessageDrawerHelper,Templates){var SELECTORS_MESSAGE_TEXTAREA='[data-region="send-message-txt"]',SELECTORS_MESSAGE_USER_BUTTON="#message-user-button",TEMPLATES_CONTENT="core_message/message_jumpto",getUserId=function(element){return parseInt(element.attr("data-userid"))},getConversationId=function(element){return parseInt(element.attr("data-conversationid"))};return{send:function(element){element=$(element);var args={conversationid:getConversationId(element),buttonid:$(element).attr("id"),userid:getUserId(element)};Templates.render(TEMPLATES_CONTENT,{}).then((function(html){element.after(html)})).then((function(){$(SELECTORS_MESSAGE_USER_BUTTON).next().focus((function(){$(SELECTORS_MESSAGE_TEXTAREA).focus()}))})),CustomEvents.define(element,[CustomEvents.events.activate]),element.on(CustomEvents.events.activate,(function(e,data){$(e.target).hasClass("active")?(MessageDrawerHelper.hide(),$(SELECTORS_MESSAGE_USER_BUTTON).next().attr("tabindex",-1)):($(SELECTORS_MESSAGE_USER_BUTTON).next().attr("tabindex",0),args.conversationid?MessageDrawerHelper.showConversation(args):MessageDrawerHelper.createConversationWithUser(args)),$(e.target).focus(),$(e.target).toggleClass("active"),e.preventDefault(),data.originalEvent.preventDefault()}))}}}));
/**
 * Module to add/remove contact using ajax.
 *
 * @module     core_message/toggle_contact_button
 * @class      toggle_contact_button
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/toggle_contact_button",["jquery","core/ajax","core/templates","core/notification","core/custom_interaction_events"],(function($,Ajax,Templates,Notification,CustomEvents){var getUserId=function(element){return element.attr("data-userid")},isLoading=function(element){return element.hasClass("loading")||element.attr("disabled")},sendRequest=function(element,request){return isLoading(element)?$.Deferred():(element.addClass("loading"),element.attr("disabled","disabled"),Ajax.call([request])[0].fail(Notification.exception).always((function(){element.removeClass("loading"),element.removeAttr("disabled")})))};return{enhance:function(element){(element=$(element)).children(".loading-icon").length||Templates.render("core/loading",{}).done((function(html,js){element.append(html,js)})),CustomEvents.define(element,[CustomEvents.events.activate]),element.on(CustomEvents.events.activate,(function(e,data){!function(element){return"1"==element.attr("data-is-contact")}(element)?function(element){if(!isLoading(element)){var request={methodname:"core_message_create_contacts",args:{userids:[getUserId(element)]}};sendRequest(element,request).done((function(){!function(element){element.attr("data-is-contact","1")}(element),Templates.render("message/remove_contact_button",{}).done((function(html,js){Templates.replaceNodeContents(element,html,js)}))}))}}(element):function(element){if(!isLoading(element)){var request={methodname:"core_message_delete_contacts",args:{userids:[getUserId(element)]}};sendRequest(element,request).done((function(){!function(element){element.attr("data-is-contact","0")}(element),Templates.render("message/add_contact_button",{}).done((function(html,js){Templates.replaceNodeContents(element,html,js)}))}))}}(element),e.preventDefault(),data.originalEvent.preventDefault()}))}}}));
/**
 * Events for the message drawer.
 *
 * @module     core_message/message_drawer_events
 * @package    message
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_events",[],(function(){return{CREATE_CONVERSATION_WITH_USER:"message-drawer-create-conversation-with-user",CONTACT_BLOCKED:"message-drawer-contact-blocked",CONTACT_UNBLOCKED:"message-drawer-contact-unblocked",CONTACT_ADDED:"message-drawer-contact-added",CONTACT_REMOVED:"message-drawer-contact-removed",CONTACT_REQUEST_ACCEPTED:"message-drawer-contact-request-accepted",CONTACT_REQUEST_DECLINED:"message-drawer-contact-request-declined",CONVERSATION_CREATED:"message-drawer-conversation-created",CONVERSATION_NEW_LAST_MESSAGE:"message-drawer-conversation-new-last-message",CONVERSATION_DELETED:"message-drawer-conversation-deleted",CONVERSATION_READ:"message-drawer-conversation-read",CONVERSATION_SET_FAVOURITE:"message-drawer-conversation-set-favourite",CONVERSATION_SET_MUTED:"message-drawer-conversation-set-muted",CONVERSATION_UNSET_FAVOURITE:"message-drawer-conversation-unset-favourite",CONVERSATION_UNSET_MUTED:"message-drawer-conversation-unset-muted",PREFERENCES_UPDATED:"message-drawer-preferences-updated",ROUTE_CHANGED:"message-drawer-route-change",SHOW:"message-drawer-show",HIDE:"message-drawer-hide",TOGGLE_VISIBILITY:"message-drawer-toggle",SHOW_CONVERSATION:"message-drawer-show-conversation",SHOW_SETTINGS:"message-drawer-show-settings"}}));
/**
 * Represents the notification processor (e.g. email, popup, jabber)
 *
 * @module     core_message/notification_processor
 * @class      notification_processor
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/notification_processor",["jquery"],(function($){var SELECTORS_STATE_NONE='[data-state="none"]',SELECTORS_STATE_BOTH='[data-state="both"]',SELECTORS_STATE_LOGGED_IN='[data-state="loggedin"]',SELECTORS_STATE_LOGGED_OFF='[data-state="loggedoff"]',NotificationProcessor=function(element){this.root=$(element)};return NotificationProcessor.prototype.getName=function(){return this.root.attr("data-processor-name")},NotificationProcessor.prototype.isLoggedInEnabled=function(){if(this.root.find(SELECTORS_STATE_NONE).find("input").prop("checked"))return!1;var both=this.root.find(SELECTORS_STATE_BOTH).find("input");return this.root.find(SELECTORS_STATE_LOGGED_IN).find("input").prop("checked")||both.prop("checked")},NotificationProcessor.prototype.isLoggedOffEnabled=function(){if(this.root.find(SELECTORS_STATE_NONE).find("input").prop("checked"))return!1;var both=this.root.find(SELECTORS_STATE_BOTH).find("input");return this.root.find(SELECTORS_STATE_LOGGED_OFF).find("input").prop("checked")||both.prop("checked")},NotificationProcessor}));
/**
 * Manages the processor form on the message preferences page.
 *
 * @module     core_message/preferences_processor_form
 * @class      preferences_processor_form
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/preferences_processor_form",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){var ProcessorForm=function(element){this.root=$(element),this.userId=this.root.attr("data-user-id"),this.name=this.root.attr("data-processor-name"),this.root.find("form").on("submit",function(e){e.preventDefault(),this.save().done((function(){$(element).trigger("mpp:formsubmitted")}))}.bind(this))};return ProcessorForm.prototype.startLoading=function(){this.root.addClass("loading")},ProcessorForm.prototype.stopLoading=function(){this.root.removeClass("loading")},ProcessorForm.prototype.isLoading=function(){return this.root.hasClass("loading")},ProcessorForm.prototype.save=function(){if(this.isLoading())return $.Deferred();this.startLoading();var data=this.root.find("form").serializeArray(),request={methodname:"core_message_message_processor_config_form",args:{userid:this.userId,name:this.name,formvalues:data}};return Ajax.call([request])[0].fail(Notification.exception).always(function(){this.stopLoading()}.bind(this))},ProcessorForm}));
/**
 * Provides some helper functions to trigger actions in the message drawer.
 *
 * @module     core_message/message_drawer_helper
 * @package    message
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_helper",["core/pubsub","core_message/message_drawer_events"],(function(PubSub,MessageDrawerEvents){return{createConversationWithUser:function(args){PubSub.publish(MessageDrawerEvents.CREATE_CONVERSATION_WITH_USER,args)},hide:function(){PubSub.publish(MessageDrawerEvents.HIDE)},show:function(){PubSub.publish(MessageDrawerEvents.SHOW)},showConversation:function(args){PubSub.publish(MessageDrawerEvents.SHOW_CONVERSATION,args)},showSettings:function(){PubSub.publish(MessageDrawerEvents.SHOW_SETTINGS)}}}));
/**
 * Controls the message drawer.
 *
 * @module     core_message/message_drawer
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer",["jquery","core/custom_interaction_events","core/pubsub","core_message/message_drawer_view_contact","core_message/message_drawer_view_contacts","core_message/message_drawer_view_conversation","core_message/message_drawer_view_group_info","core_message/message_drawer_view_overview","core_message/message_drawer_view_search","core_message/message_drawer_view_settings","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_events","core/pending","core/drawer"],(function($,CustomEvents,PubSub,ViewContact,ViewContacts,ViewConversation,ViewGroupInfo,ViewOverview,ViewSearch,ViewSettings,Router,Routes,Events,Pending,Drawer){var SELECTORS_DRAWER='[data-region="right-hand-drawer"]',SELECTORS_JUMPTO='.popover-region [data-region="jumpto"]',SELECTORS_PANEL_BODY_CONTAINER='[data-region="panel-body-container"]',SELECTORS_PANEL_HEADER_CONTAINER='[data-region="panel-header-container"]',SELECTORS_VIEW_CONTACT='[data-region="view-contact"]',SELECTORS_VIEW_CONTACTS='[data-region="view-contacts"]',SELECTORS_VIEW_CONVERSATION='[data-region="view-conversation"]',SELECTORS_VIEW_GROUP_INFO='[data-region="view-group-info"]',SELECTORS_VIEW_OVERVIEW='[data-region="view-overview"]',SELECTORS_VIEW_SEARCH='[data-region="view-search"]',SELECTORS_VIEW_SETTINGS='[data-region="view-settings"]',SELECTORS_ROUTES="[data-route]",SELECTORS_ROUTES_BACK="[data-route-back]",SELECTORS_HEADER_CONTAINER='[data-region="header-container"]',SELECTORS_BODY_CONTAINER='[data-region="body-container"]',SELECTORS_FOOTER_CONTAINER='[data-region="footer-container"]',SELECTORS_CLOSE_BUTTON='[data-action="closedrawer"]',routes=[[Routes.VIEW_CONTACT,SELECTORS_VIEW_CONTACT,ViewContact.show,ViewContact.description],[Routes.VIEW_CONTACTS,SELECTORS_VIEW_CONTACTS,ViewContacts.show,ViewContacts.description],[Routes.VIEW_CONVERSATION,SELECTORS_VIEW_CONVERSATION,ViewConversation.show,ViewConversation.description],[Routes.VIEW_GROUP_INFO,SELECTORS_VIEW_GROUP_INFO,ViewGroupInfo.show,ViewGroupInfo.description],[Routes.VIEW_OVERVIEW,SELECTORS_VIEW_OVERVIEW,ViewOverview.show,ViewOverview.description],[Routes.VIEW_SEARCH,SELECTORS_VIEW_SEARCH,ViewSearch.show,ViewSearch.description],[Routes.VIEW_SETTINGS,SELECTORS_VIEW_SETTINGS,ViewSettings.show,ViewSettings.description]],createRoutes=function(namespace,root){routes.forEach((function(route){Router.add(namespace,route[0],function(namespace,root,selector){var header=root.find(SELECTORS_HEADER_CONTAINER).find(selector);header.length||(header=root.find(SELECTORS_PANEL_HEADER_CONTAINER).find(selector));var body=root.find(SELECTORS_BODY_CONTAINER).find(selector);body.length||(body=root.find(SELECTORS_PANEL_BODY_CONTAINER).find(selector));var footer=root.find(SELECTORS_FOOTER_CONTAINER).find(selector);return[namespace,header.length?header:null,body.length?body:null,footer.length?footer:null]}(namespace,root,route[1]),route[2],route[3])}))},show=function(namespace,root){root.attr("data-shown")||(Router.go(namespace,Routes.VIEW_OVERVIEW),root.attr("data-shown",!0));var drawerRoot=Drawer.getDrawerRoot(root);drawerRoot.length&&Drawer.show(drawerRoot)},hide=function(root){var drawerRoot=Drawer.getDrawerRoot(root);drawerRoot.length&&Drawer.hide(drawerRoot)},setJumpFrom=function(buttonid){$(SELECTORS_DRAWER).attr("data-origin",buttonid)},registerEventListeners=function(namespace,root,alwaysVisible){CustomEvents.define(root,[CustomEvents.events.activate]);var paramRegex=/^data-route-param-?(\d*)$/;root.on(CustomEvents.events.activate,SELECTORS_ROUTES,(function(e,data){for(var element=$(e.target).closest(SELECTORS_ROUTES),route=element.attr("data-route"),attributes=[],i=0;i<element[0].attributes.length;i++)attributes.push(element[0].attributes[i]);var paramAttributes=attributes.filter((function(attribute){var name=attribute.nodeName;return paramRegex.test(name)}));paramAttributes.sort((function(a,b){var aParts=paramRegex.exec(a.nodeName),bParts=paramRegex.exec(b.nodeName),aIndex=aParts.length>1?aParts[1]:0,bIndex=bParts.length>1?bParts[1]:0;return aIndex<bIndex?-1:bIndex<aIndex?1:0}));var params=paramAttributes.map((function(attribute){return attribute.nodeValue})),routeParams=[namespace,route].concat(params);Router.go.apply(null,routeParams),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_ROUTES_BACK,(function(e,data){Router.back(namespace),data.originalEvent.preventDefault()})),root.on("hide.bs.collapse",".collapse",(function(e){var pendingPromise=new Pending;$(e.target).one("hidden.bs.collapse",(function(){pendingPromise.resolve()}))})),root.on("show.bs.collapse",".collapse",(function(e){var pendingPromise=new Pending;$(e.target).one("shown.bs.collapse",(function(){pendingPromise.resolve()}))})),$(SELECTORS_JUMPTO).focus((function(){var firstInput=$(SELECTORS_HEADER_CONTAINER).find("input:visible");firstInput.length?firstInput.focus():$(SELECTORS_HEADER_CONTAINER).find(SELECTORS_ROUTES_BACK).focus()})),$(SELECTORS_DRAWER).focus((function(){var button=$(this).attr("data-origin");button&&$("#"+button).focus()})),alwaysVisible||(PubSub.subscribe(Events.SHOW,(function(){show(namespace,root)})),PubSub.subscribe(Events.HIDE,(function(){hide(root)})),PubSub.subscribe(Events.TOGGLE_VISIBILITY,(function(buttonid){!function(root){var drawerRoot=Drawer.getDrawerRoot(root);return!drawerRoot.length||Drawer.isVisible(drawerRoot)}(root)?(show(namespace,root),setJumpFrom(buttonid),$(SELECTORS_JUMPTO).attr("tabindex",0)):(hide(root),$(SELECTORS_JUMPTO).attr("tabindex",-1))}))),PubSub.subscribe(Events.SHOW_CONVERSATION,(function(args){setJumpFrom(args.buttonid),show(namespace,root),Router.go(namespace,Routes.VIEW_CONVERSATION,args.conversationid)})),root.find(SELECTORS_CLOSE_BUTTON).on(CustomEvents.events.activate,(function(){PubSub.publish(Events.TOGGLE_VISIBILITY)})),PubSub.subscribe(Events.CREATE_CONVERSATION_WITH_USER,(function(args){setJumpFrom(args.buttonid),show(namespace,root),Router.go(namespace,Routes.VIEW_CONVERSATION,null,"create",args.userid)})),PubSub.subscribe(Events.SHOW_SETTINGS,(function(){show(namespace,root),Router.go(namespace,Routes.VIEW_SETTINGS)})),PubSub.subscribe(Events.PREFERENCES_UPDATED,(function(preferences){var filteredPreferences=preferences.filter((function(preference){return"message_entertosend"==preference.type})),enterToSendPreference=filteredPreferences.length?filteredPreferences[0]:null;enterToSendPreference&&root.find(SELECTORS_FOOTER_CONTAINER).find(SELECTORS_VIEW_CONVERSATION).attr("data-enter-to-send",enterToSendPreference.value)}))};return{init:function(root,uniqueId,alwaysVisible,route){if(root=$(root),createRoutes(uniqueId,root),registerEventListeners(uniqueId,root,alwaysVisible),alwaysVisible&&(show(uniqueId,root),route)){var routeParams=route.params||[];routeParams=[uniqueId,route.path].concat(routeParams),Router.go.apply(null,routeParams)}}}}));
/**
 * Controls the contacts section of the contacts page.
 *
 * @module     core_message/message_drawer_view_contacts_section_contacts
 * @package    message
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_contacts_section_contacts",["jquery","core/notification","core/pubsub","core/templates","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_lazy_load_list"],(function($,Notification,PubSub,Templates,MessageRepository,Events,LazyLoadList){var SELECTORS_BLOCK_ICON_CONTAINER='[data-region="block-icon-container"]',SELECTORS_CONTACT='[data-region="contact"]',TEMPLATES_CONTACTS_LIST="core_message/message_drawer_contacts_list",findContact=function(body,userId){return body.find('[data-contact-user-id="'+userId+'"]')},render=function(contentContainer,contacts){var formattedContacts=contacts.map((function(contact){return $.extend(contact,{id:contact.userid})}));return Templates.render(TEMPLATES_CONTACTS_LIST,{contacts:formattedContacts}).then((function(html){return contentContainer.append(html),html})).catch(Notification.exception)},registerEventListeners=function(root){PubSub.subscribe(Events.CONTACT_ADDED,(function(profile){var listContentContainer=LazyLoadList.getContentContainer(root);render(listContentContainer,[profile]),LazyLoadList.hideEmptyMessage(root),LazyLoadList.showContent(root)})),PubSub.subscribe(Events.CONTACT_REMOVED,(function(userId){!function(body,userId){findContact(body,userId).remove()}(root,userId),root.find(SELECTORS_CONTACT).length||(LazyLoadList.hideContent(root),LazyLoadList.showEmptyMessage(root))})),PubSub.subscribe(Events.CONTACT_BLOCKED,(function(userId){!function(body,userId){var contact=findContact(body,userId);contact.length&&contact.find(SELECTORS_BLOCK_ICON_CONTAINER).removeClass("hidden")}(root,userId)})),PubSub.subscribe(Events.CONTACT_UNBLOCKED,(function(userId){!function(body,userId){var contact=findContact(body,userId);contact.length&&contact.find(SELECTORS_BLOCK_ICON_CONTAINER).addClass("hidden")}(root,userId)}))};return{show:function(root){var offset;root.attr("data-contacts-init")||(registerEventListeners(root),root.attr("data-contacts-init",!0)),LazyLoadList.show(root,(offset=0,function(listRoot,userId){return MessageRepository.getContacts(userId,101,offset).then((function(result){return result})).then((function(contacts){return contacts.length>100?contacts.pop():LazyLoadList.setLoadedAll(listRoot,!0),contacts})).then((function(contacts){return offset+=100,contacts})).catch(Notification.exception)}),render)}}}));
/**
 * Load the settings for a message processor.
 *
 * @module     core_message/notification_processor_settings
 * @class      notification_processor_settings
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/notification_processor_settings",["jquery","core/ajax","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/fragment"],(function($,Ajax,Str,Notification,CustomEvents,Modal,ModalRegistry,Fragment){var registered=!1,SELECTORS_SAVE_BUTTON='[data-action="save"]',SELECTORS_CANCEL_BUTTON='[data-action="cancel"]',SELECTORS_PROCESSOR="[data-processor-name]",SELECTORS_PREFERENCE_ROW='[data-region="preference-row"]',NotificationProcessorSettings=function(root){Modal.call(this,root),this.name=null,this.userId=null,this.contextId=null,this.element=null,this.saveButton=this.getFooter().find(SELECTORS_SAVE_BUTTON),this.cancelButton=this.getFooter().find(SELECTORS_CANCEL_BUTTON)};return NotificationProcessorSettings.TYPE="core_message-notification_processor_settings",(NotificationProcessorSettings.prototype=Object.create(Modal.prototype)).constructor=NotificationProcessorSettings,NotificationProcessorSettings.prototype.setUserId=function(id){this.userId=id},NotificationProcessorSettings.prototype.getUserId=function(){return this.userId},NotificationProcessorSettings.prototype.setElement=function(element){this.element=element},NotificationProcessorSettings.prototype.getElement=function(){return this.element},NotificationProcessorSettings.prototype.setName=function(name){this.name=name},NotificationProcessorSettings.prototype.getName=function(){return this.name},NotificationProcessorSettings.prototype.setContextId=function(id){this.contextId=id},NotificationProcessorSettings.prototype.getContextId=function(){return this.contextId},NotificationProcessorSettings.prototype.getForm=function(){return this.getBody().find("form")},NotificationProcessorSettings.prototype.disableButtons=function(){this.saveButton.prop("disabled",!0),this.cancelButton.prop("disabled",!0)},NotificationProcessorSettings.prototype.enableButtons=function(){this.saveButton.prop("disabled",!1),this.cancelButton.prop("disabled",!1)},NotificationProcessorSettings.prototype.loadTitleContent=function(){return this.titlePromise=Str.get_string("processorsettings","message"),this.setTitle(this.titlePromise),this.titlePromise},NotificationProcessorSettings.prototype.loadBodyContent=function(){this.disableButtons();var args={userid:this.getUserId(),type:this.getName()};return this.bodyPromise=Fragment.loadFragment("message","processor_settings",this.getContextId(),args),this.setBody(this.bodyPromise),this.bodyPromise.then(function(){this.enableButtons()}.bind(this)).fail(Notification.exception),this.bodyPromise},NotificationProcessorSettings.prototype.loadAllContent=function(){return $.when(this.loadTitleContent(),this.loadBodyContent())},NotificationProcessorSettings.prototype.show=function(){this.loadAllContent(),Modal.prototype.show.call(this)},NotificationProcessorSettings.prototype.hide=function(){Modal.prototype.hide.call(this),this.setContextId(null),this.setName(null),this.setUserId(null)},NotificationProcessorSettings.prototype.updateConfiguredStatus=function(){var processorHeader=$(this.getElement()).closest(SELECTORS_PROCESSOR);if(!processorHeader.hasClass("unconfigured"))return!1;var processorName=processorHeader.attr("data-processor-name"),request={methodname:"core_message_get_message_processor",args:{name:processorName,userid:this.userId}};return Ajax.call([request])[0].fail(Notification.exception).done((function(result){if(result.userconfigured){var notifications=$(SELECTORS_PREFERENCE_ROW+' [data-processor-name="'+processorName+'"]');processorHeader.removeClass("unconfigured"),notifications.removeClass("disabled")}}))},NotificationProcessorSettings.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_SAVE_BUTTON,function(e,data){this.getForm().submit(),data.originalEvent.preventDefault()}.bind(this)),this.getModal().on("mpp:formsubmitted",function(e){this.hide(),this.updateConfiguredStatus(),e.stopPropagation()}.bind(this)),this.getModal().on(CustomEvents.events.activate,SELECTORS_CANCEL_BUTTON,function(e,data){this.hide(),data.originalEvent.preventDefault(),e.stopPropagation()}.bind(this))},registered||(ModalRegistry.register(NotificationProcessorSettings.TYPE,NotificationProcessorSettings,"core/modal_save_cancel"),registered=!0),NotificationProcessorSettings}));
/**
 * Constant values for the conversation page in the message drawer.
 *
 * @module     core_message/message_drawer_view_conversation_constants
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_conversation_constants",[],(function(){return{SELECTORS:{ACTION_ACCEPT_CONTACT_REQUEST:'[data-action="accept-contact-request"]',ACTION_CANCEL_CONFIRM:'[data-action="cancel-confirm"]',ACTION_OKAY_CONFIRM:'[data-action="okay-confirm"]',ACTION_CANCEL_EDIT_MODE:'[data-action="cancel-edit-mode"]',ACTION_CONFIRM_ADD_CONTACT:'[data-action="confirm-add-contact"]',ACTION_CONFIRM_BLOCK:'[data-action="confirm-block"]',ACTION_CONFIRM_DELETE_SELECTED_MESSAGES:'[data-action="confirm-delete-selected-messages"]',ACTION_CONFIRM_DELETE_CONVERSATION:'[data-action="confirm-delete-conversation"]',ACTION_CONFIRM_FAVOURITE:'[data-action="confirm-favourite"]',ACTION_CONFIRM_MUTE:'[data-action="confirm-mute"]',ACTION_CONFIRM_UNFAVOURITE:'[data-action="confirm-unfavourite"]',ACTION_CONFIRM_REMOVE_CONTACT:'[data-action="confirm-remove-contact"]',ACTION_CONFIRM_UNBLOCK:'[data-action="confirm-unblock"]',ACTION_CONFIRM_UNMUTE:'[data-action="confirm-unmute"]',ACTION_DECLINE_CONTACT_REQUEST:'[data-action="decline-contact-request"]',ACTION_REQUEST_ADD_CONTACT:'[data-action="request-add-contact"]',ACTION_REQUEST_BLOCK:'[data-action="request-block"]',ACTION_REQUEST_DELETE_CONVERSATION:'[data-action="request-delete-conversation"]',ACTION_REQUEST_DELETE_SELECTED_MESSAGES:'[data-action="delete-selected-messages"]',ACTION_REQUEST_REMOVE_CONTACT:'[data-action="request-remove-contact"]',ACTION_REQUEST_UNBLOCK:'[data-action="request-unblock"]',ACTION_VIEW_CONTACT:'[data-action="view-contact"]',ACTION_VIEW_GROUP_INFO:'[data-action="view-group-info"]',CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',CONFIRM_DIALOGUE:'[data-region="confirm-dialogue"]',CONFIRM_DIALOGUE_BUTTON_TEXT:'[data-region="dialogue-button-text"]',CONFIRM_DIALOGUE_CANCEL_BUTTON:'[data-action="cancel-confirm"]',CONFIRM_DIALOGUE_CONTAINER:'[data-region="confirm-dialogue-container"]',CONFIRM_DIALOGUE_HEADER:'[data-region="dialogue-header"]',CONFIRM_DIALOGUE_OKAY_BUTTON:'[data-action="okay-confirm"]',CONFIRM_DIALOGUE_TEXT:'[data-region="dialogue-text"]',CONTACT_REQUEST_SENT_MESSAGE_CONTAINER:'[data-region="contact-request-sent-message-container"]',CONTENT_PLACEHOLDER_CONTAINER:'[data-region="content-placeholder"]',CONTENT_CONTAINER:'[data-region="content-container"]',CONTENT_MESSAGES_CONTAINER:'[data-region="content-message-container"]',CONTENT_MESSAGES_FOOTER_CONTAINER:'[data-region="content-messages-footer-container"]',CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER:'[data-region="content-messages-footer-edit-mode-container"]',CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER:'[data-region="content-messages-footer-require-contact-container"]',CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER:'[data-region="content-messages-footer-require-unblock-container"]',CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER:'[data-region="content-messages-footer-unable-to-message"]',DAY_MESSAGES_CONTAINER:'[data-region="day-messages-container"]',DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE:'[data-region="delete-messages-for-all-users-toggle"]',DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER:'[data-region="delete-messages-for-all-users-toggle-container"]',EMOJI_AUTO_COMPLETE_CONTAINER:'[data-region="emoji-auto-complete-container"]',EMOJI_PICKER_CONTAINER:'[data-region="emoji-picker-container"]',EMOJI_PICKER:'[data-region="emoji-picker"]',EMOJI_PICKER_SEARCH_INPUT:'[data-region="search-input"]',ERROR_MESSAGE_CONTAINER:'[data-region="error-message-container"]',ERROR_MESSAGE:'[data-region="error-message"]',FAVOURITE_ICON_CONTAINER:'[data-region="favourite-icon-container"]',FOOTER_CONTAINER:'[data-region="content-messages-footer-container"]',HEADER:'[data-region="header-content"]',HEADER_EDIT_MODE:'[data-region="header-edit-mode"]',HEADER_PLACEHOLDER_CONTAINER:'[data-region="header-placeholder"]',LOADING_ICON_CONTAINER:'[data-region="loading-icon-container"]',MESSAGE:'[data-region="message"]',MESSAGE_NOT_SELECTED:'[data-region="message"][aria-checked="false"]',MESSAGE_NOT_SELECTED_ICON:'[data-region="not-selected-icon"]',MESSAGE_SELECTED_ICON:'[data-region="selected-icon"]',MESSAGES:'[data-region="content-message-container"]',MESSAGES_CONTAINER:'[data-region="content-message-container"]',MESSAGES_SELECTED_COUNT:'[data-region="message-selected-court"]',MESSAGE_TEXT_AREA:'[data-region="send-message-txt"]',MORE_MESSAGES_LOADING_ICON_CONTAINER:'[data-region="more-messages-loading-icon-container"]',MUTED_ICON_CONTAINER:'[data-region="muted-icon-container"]',PLACEHOLDER_CONTAINER:'[data-region="placeholder-container"]',RETRY_SEND:'[data-region="retry-send"]',SELF_CONVERSATION_MESSAGE_CONTAINER:'[data-region="self-conversation-message-container"]',SEND_MESSAGE_BUTTON:'[data-action="send-message"]',SEND_MESSAGE_ICON_CONTAINER:'[data-region="send-icon-container"]',TEXT:'[data-region="text"]',TEXT_CONTAINER:'[data-region="text-container"]',TIME_CREATED:'[data-region="time-created"]',TITLE:'[data-region="title"]',TOGGLE_EMOJI_PICKER_BUTTON:'[data-action="toggle-emoji-picker"]'},TEMPLATES:{HEADER_PRIVATE:"core_message/message_drawer_view_conversation_header_content_type_private",HEADER_PRIVATE_NO_CONTROLS:"core_message/message_drawer_view_conversation_header_content_type_private_no_controls",HEADER_PUBLIC:"core_message/message_drawer_view_conversation_header_content_type_public",HEADER_SELF:"core_message/message_drawer_view_conversation_header_content_type_self",DAY:"core_message/message_drawer_view_conversation_body_day",MESSAGE:"core_message/message_drawer_view_conversation_body_message",MESSAGES:"core_message/message_drawer_view_conversation_body_messages"},CONVERSATION_TYPES:{PRIVATE:1,PUBLIC:2,SELF:3},NEWEST_MESSAGES_FIRST:!0,LOAD_MESSAGE_LIMIT:100,MILLISECONDS_IN_SEC:1e3}}));
/**
 * Controls the settings page in the message drawer.
 *
 * @module     core_message/message_drawer_view_settings
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_settings",["jquery","core/notification","core/str","core/pubsub","core/templates","core_message/message_repository","core/custom_interaction_events","core_message/message_drawer_events"],(function($,Notification,Str,PubSub,Templates,Repository,CustomEvents,MessageDrawerEvents){var SELECTORS_CHECKBOX='input[type="checkbox"]',SELECTORS_SETTINGS='[data-region="settings"]',SELECTORS_PRIVACY_PREFERENCE='[data-preference="blocknoncontacts"] input[type="radio"]',SELECTORS_NOTIFICATIONS_PREFERENCE='[data-preference="notifications"] input[type="checkbox"]',SELECTORS_ENTER_TO_SEND_PREFERENCE='[data-preference="entertosend"] input[type="checkbox"]',SELECTORS_NOTIFICATION_PREFERENCES_CONTAINER='[data-region="notification-preference-container"]',SELECTORS_CONTENT_CONTAINER='[data-region="content-container"]',SELECTORS_PLACEHOLDER_CONTAINER='[data-region="placeholder-container"]',TEMPLATES_NOTIFICATION_PREFERENCES="core_message/message_drawer_view_settings_body_content_notification_preferences",savePreferences=function(loggedInUserId,preferences){return Repository.savePreferences(loggedInUserId,preferences).then((function(){PubSub.publish(MessageDrawerEvents.PREFERENCES_UPDATED,preferences)})).catch(Notification.exception)},init=function(body,loggedInUserId){Repository.getUserMessagePreferences(loggedInUserId).then((function(response){!function(body,value){body.find(SELECTORS_PRIVACY_PREFERENCE).each((function(index,input){(input=$(input)).val()==value?input.prop("checked",!0):input.prop("checked",!1)}))}(body,response.blocknoncontacts),function(body,value){var checkbox=body.find(SELECTORS_ENTER_TO_SEND_PREFERENCE);value?checkbox.prop("checked",!0):checkbox.prop("checked",!1)}(body,response.entertosend);var notificationProcessors=[];response.preferences.components.length&&response.preferences.components.forEach((function(component){if(component.notifications.length&&component.notifications.filter((function(notification){return"message_provider_moodle_instantmessage"==notification.preferencekey})).length){var configuration=component.notifications[0];notificationProcessors=configuration.processors.map((function(processor){var checked=processor.loggedin.checked||processor.loggedoff.checked;return{displayname:processor.displayname,name:processor.name,checked:checked,locked:processor.locked,lockedmessage:processor.lockedmessage||null}}))}}));var container=body.find(SELECTORS_NOTIFICATION_PREFERENCES_CONTAINER);return!notificationProcessors.length||(container.removeClass("hidden"),Templates.render(TEMPLATES_NOTIFICATION_PREFERENCES,{processors:notificationProcessors}).then((function(html){return container.append(html),html})))})).then((function(){body.find(SELECTORS_CONTENT_CONTAINER).removeClass("hidden"),body.find(SELECTORS_PLACEHOLDER_CONTAINER).addClass("hidden"),function(body,loggedInUserId){var settingsContainer=body.find(SELECTORS_SETTINGS);CustomEvents.define(settingsContainer,[CustomEvents.events.activate]),settingsContainer.on(CustomEvents.events.activate,SELECTORS_NOTIFICATIONS_PREFERENCE,(function(e){var checkboxes=$(e.target).closest(SELECTORS_NOTIFICATION_PREFERENCES_CONTAINER).find(SELECTORS_CHECKBOX);if(checkboxes.length){var values=checkboxes.toArray().reduce((function(carry,checkbox){return(checkbox=$(checkbox)).prop("checked")&&carry.push(checkbox.attr("data-name")),carry}),[]),newValue=values.length?values.join(","):"none";savePreferences(loggedInUserId,[{type:"message_provider_moodle_instantmessage_loggedoff",value:newValue},{type:"message_provider_moodle_instantmessage_loggedin",value:newValue}])}})),settingsContainer.on("change",SELECTORS_PRIVACY_PREFERENCE,(function(e){var newValue=$(e.target).val();savePreferences(loggedInUserId,[{type:"message_blocknoncontacts",value:newValue}])})),settingsContainer.on(CustomEvents.events.activate,SELECTORS_ENTER_TO_SEND_PREFERENCE,(function(e){var newValue=$(e.target).prop("checked");savePreferences(loggedInUserId,[{type:"message_entertosend",value:newValue}])}))}(body,loggedInUserId)})).catch(Notification.exception)};return{show:function(namespace,header,body,footer,loggedInUserId){return body.attr("data-init")||(init(body,loggedInUserId),body.attr("data-init",!0)),$.Deferred().resolve().promise()},description:function(){return Str.get_string("messagedrawerviewsettings","core_message")}}}));
function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}
/**
 * Controls a section of the overview page in the message drawer.
 *
 * @module     core_message/message_drawer_view_overview_section
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_overview_section",["jquery","core/custom_interaction_events","core/notification","core/pubsub","core/str","core/pending","core/templates","core/user_date","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_lazy_load_list","core_message/message_drawer_view_conversation_constants"],(function($,CustomEvents,Notification,PubSub,Str,Pending,Templates,UserDate,MessageRepository,MessageDrawerEvents,MessageDrawerRouter,MessageDrawerRoutes,LazyLoadList,MessageDrawerViewConversationContants){var SELECTORS_TOGGLE='[data-region="toggle"]',SELECTORS_CONVERSATION="[data-conversation-id]",SELECTORS_BLOCKED_ICON_CONTAINER='[data-region="contact-icon-blocked"]',SELECTORS_MUTED_ICON_CONTAINER='[data-region="muted-icon-container"]',SELECTORS_UNREAD_COUNT='[data-region="unread-count"]',SELECTORS_SECTION_TOTAL_COUNT='[data-region="section-total-count"]',SELECTORS_SECTION_TOTAL_COUNT_CONTAINER='[data-region="section-total-count-container"]',SELECTORS_SECTION_UNREAD_COUNT='[data-region="section-unread-count"]',SELECTORS_PLACEHOLDER_CONTAINER='[data-region="placeholder-container"]',TEMPLATES_CONVERSATIONS_LIST="core_message/message_drawer_conversations_list",TEMPLATES_CONVERSATIONS_LIST_ITEMS_PLACEHOLDER="core_message/message_drawer_conversations_list_items_placeholder",loadedConversationsById={},deletedConversationsById={},loadedTotalCounts=!1,loadedUnreadCounts=!1,isVisible=function(root){return LazyLoadList.getRoot(root).hasClass("show")},setExpanded=function(root){root.addClass("expanded")},formatConversationFromEvent=function(conversation){var formatted=function recursivelyLowercaseKeys(object){return Object.keys(object).reduce((function(carry,key){return $.isArray(object[key])?carry[key.toLowerCase()]=object[key].map(recursivelyLowercaseKeys):carry[key.toLowerCase()]=object[key],carry}),{})}(conversation);return formatted.messages=formatted.messages.map((function(message){return message.useridfrom=message.userfrom.id,message})),formatted},render=function(conversations,userId){var fn,_ref,pending=new Pending,formatMessagePreview=(fn=regeneratorRuntime.mark((function _callee(lastMessage){var tmpElement,messagePreview,pix,label,labelString,icon;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(lastMessage){_context.next=2;break}return _context.abrupt("return",null);case 2:if((tmpElement=document.createElement("element")).innerHTML=lastMessage.text.replace(/<img /g,"<noimg "),tmpElement.querySelector("[src]")){_context.next=10;break}if(!(messagePreview=$(lastMessage.text).text())){_context.next=10;break}if(-1!=messagePreview.indexOf("<")){_context.next=10;break}return _context.abrupt("return",messagePreview);case 10:return pix="i/messagecontentmultimediageneral",label="messagecontentmultimediageneral",lastMessage.text.includes("<img")?(pix="i/messagecontentimage",label="messagecontentimage"):lastMessage.text.includes("<video")?(pix="i/messagecontentvideo",label="messagecontentvideo"):lastMessage.text.includes("<audio")&&(pix="i/messagecontentaudio",label="messagecontentaudio"),_context.prev=13,_context.next=16,Str.get_string(label,"core_message");case 16:return labelString=_context.sent,_context.next=19,Templates.renderPix(pix,"core",labelString);case 19:return icon=_context.sent,_context.abrupt("return",icon+" "+labelString);case 23:return _context.prev=23,_context.t0=_context.catch(13),Notification.exception(_context.t0),_context.abrupt("return",null);case 27:case"end":return _context.stop()}}),_callee,null,[[13,23]])})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x){return _ref.apply(this,arguments)}),mapPromises=conversations.map((function(conversation){var lastMessage=conversation.messages.length?conversation.messages[conversation.messages.length-1]:null;return formatMessagePreview(lastMessage).then((function(messagePreview){var formattedConversation={id:conversation.id,imageurl:conversation.imageurl,name:conversation.name,subname:conversation.subname,unreadcount:conversation.unreadcount,ismuted:conversation.ismuted,lastmessagedate:lastMessage?lastMessage.timecreated:null,sentfromcurrentuser:lastMessage?lastMessage.useridfrom==userId:null,lastmessage:messagePreview},otherUser=null;return conversation.type==MessageDrawerViewConversationContants.CONVERSATION_TYPES.SELF?otherUser=conversation.members[0]:conversation.type==MessageDrawerViewConversationContants.CONVERSATION_TYPES.PRIVATE&&(otherUser=conversation.members.reduce((function(carry,member){return carry||member.id==userId||(carry=member),carry}),null)),null!==otherUser&&(formattedConversation.userid=otherUser.id,formattedConversation.showonlinestatus=otherUser.showonlinestatus,formattedConversation.isonline=otherUser.isonline,formattedConversation.isblocked=otherUser.isblocked),conversation.type==MessageDrawerViewConversationContants.CONVERSATION_TYPES.PUBLIC&&(formattedConversation.lastsendername=conversation.members.reduce((function(carry,member){return!carry&&lastMessage&&member.id==lastMessage.useridfrom&&(carry=member.fullname),carry}),null)),formattedConversation})).catch(Notification.exception)}));return Promise.all(mapPromises).then((function(formattedConversations){return formattedConversations.forEach((function(conversation){(new Date).toDateString()==new Date(1e3*conversation.lastmessagedate).toDateString()&&(conversation.istoday=!0)})),Templates.render(TEMPLATES_CONVERSATIONS_LIST,{conversations:formattedConversations})})).then((function(html,js){return pending.resolve(),$.Deferred().resolve(html,js)})).catch((function(error){pending.resolve(),Notification.exception(error)}))},getTotalConversationCountElement=function(root){return root.find(SELECTORS_SECTION_TOTAL_COUNT)},decrementTotalUnreadConversationCount=function(root){if(loadedUnreadCounts){var element=function(root){return root.find(SELECTORS_SECTION_UNREAD_COUNT)}(root),count=parseInt(element.text());count-=1,element.text(count),count<1&&element.addClass("hidden")}},getConversationElement=function(root,conversationId){return root.find('[data-conversation-id="'+conversationId+'"]')},getConversationElementFromUserId=function(root,userId){return root.find('[data-user-id="'+userId+'"]')},createNewConversationFromEvent=function(root,conversation,userId){if(!root.find(SELECTORS_CONVERSATION).length){var listRoot=LazyLoadList.getRoot(root);LazyLoadList.showContent(listRoot),LazyLoadList.hideEmptyMessage(listRoot)}return loadedConversationsById[conversation.id]=conversation,render([conversation],userId).then((function(html){return LazyLoadList.getContentContainer(root).prepend(html)})).then((function(){return function(root){if(loadedTotalCounts){var element=getTotalConversationCountElement(root),count=parseInt(element.text());count+=1,element.text(count)}}(root)})).catch(Notification.exception)},deleteConversation=function(root,conversationElement){if(conversationElement.remove(),function(root){if(loadedTotalCounts){var element=getTotalConversationCountElement(root),count=parseInt(element.text());count-=1,element.text(count)}}(root),!root.find(SELECTORS_CONVERSATION).length){var listRoot=LazyLoadList.getRoot(root);LazyLoadList.hideContent(listRoot),LazyLoadList.showEmptyMessage(listRoot)}},registerEventListeners=function(namespace,root,loadCallback,types,includeFavourites,fromPanel){var listRoot=LazyLoadList.getRoot(root),conversationBelongsToThisSection=function(conversation){var conversationType=parseInt(conversation.type,10);return!(types&&types.indexOf(conversationType)<0||includeFavourites&&!conversation.isFavourite||!includeFavourites&&conversation.isFavourite)},toggle=root.find(SELECTORS_TOGGLE);root.css("min-height",toggle.outerHeight()),root.on("show.bs.collapse",(function(){setExpanded(root),LazyLoadList.show(listRoot,loadCallback,(function(contentContainer,conversations,userId){return render(conversations,userId).then((function(html){return contentContainer.append(html),html})).catch(Notification.exception)}))})),root.on("hidden.bs.collapse",(function(){!function(root){root.removeClass("expanded")}(root)})),PubSub.subscribe(MessageDrawerEvents.CONTACT_BLOCKED,(function(userId){var conversationElement=getConversationElementFromUserId(root,userId);conversationElement.length&&function(conversationElement){conversationElement.find(SELECTORS_BLOCKED_ICON_CONTAINER).removeClass("hidden")}(conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONTACT_UNBLOCKED,(function(userId){var conversationElement=getConversationElementFromUserId(root,userId);conversationElement.length&&function(conversationElement){conversationElement.find(SELECTORS_BLOCKED_ICON_CONTAINER).addClass("hidden")}(conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_SET_MUTED,(function(conversation){var conversationId=conversation.id,conversationElement=getConversationElement(root,conversationId);conversationElement.length&&function(conversationElement){conversationElement.find(SELECTORS_MUTED_ICON_CONTAINER).removeClass("hidden")}(conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_UNSET_MUTED,(function(conversation){var conversationId=conversation.id,conversationElement=getConversationElement(root,conversationId);conversationElement.length&&function(conversationElement){conversationElement.find(SELECTORS_MUTED_ICON_CONTAINER).addClass("hidden")}(conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_NEW_LAST_MESSAGE,(function(conversation){if(conversationBelongsToThisSection(conversation)){var pendingPromise=new Pending("core_message/message_drawer_view_overview_section:new"),loggedInUserId=conversation.loggedInUserId,conversationId=conversation.id,element=getConversationElement(root,conversationId);if(conversation=formatConversationFromEvent(conversation),element.length){var contentContainer=LazyLoadList.getContentContainer(root);render([conversation],loggedInUserId).then((function(html){deletedConversationsById[conversationId]&&conversation.messages[0].timeadded<deletedConversationsById[conversationId]||(contentContainer.prepend(html),element.remove())})).then(pendingPromise.resolve).catch(Notification.exception)}else conversation.messages.length?createNewConversationFromEvent(root,conversation,loggedInUserId).then(pendingPromise.resolve).catch():pendingPromise.resolve()}})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_DELETED,(function(conversationId){var conversationElement=getConversationElement(root,conversationId);delete loadedConversationsById[conversationId],deletedConversationsById[conversationId]=new Date,conversationElement.length&&deleteConversation(root,conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_READ,(function(conversationId){var conversationElement=getConversationElement(root,conversationId);conversationElement.length&&function(root,conversationElement){var unreadCount=conversationElement.find(SELECTORS_UNREAD_COUNT);unreadCount.text("0"),unreadCount.addClass("hidden"),decrementTotalUnreadConversationCount(root)}(root,conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_SET_FAVOURITE,(function(conversation){var conversationElement=null;conversationBelongsToThisSection(conversation)?(conversationElement=getConversationElement(root,conversation.id)).length||createNewConversationFromEvent(root,formatConversationFromEvent(conversation),conversation.loggedInUserId):(conversationElement=getConversationElement(root,conversation.id)).length&&deleteConversation(root,conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_UNSET_FAVOURITE,(function(conversation){var conversationElement=null;conversationBelongsToThisSection(conversation)?(conversationElement=getConversationElement(root,conversation.id)).length||createNewConversationFromEvent(root,formatConversationFromEvent(conversation),conversation.loggedInUserId):(conversationElement=getConversationElement(root,conversation.id)).length&&deleteConversation(root,conversationElement)})),CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_CONVERSATION,(function(e,data){var conversationId=$(e.target).closest(SELECTORS_CONVERSATION).attr("data-conversation-id"),conversation=loadedConversationsById[conversationId];MessageDrawerRouter.go(namespace,MessageDrawerRoutes.VIEW_CONVERSATION,conversation,fromPanel),data.originalEvent.preventDefault()}))};return{show:function(namespace,header,body,footer,types,includeFavourites,totalCountPromise,unreadCountPromise,fromPanel){var root=$(body);if(!root.attr("data-init")){var loadCallback=function(types,includeFavourites,offset){var type=null,includeSelfConversations=!0;if(types&&types.length){var nonSelfConversationTypes=types.filter((function(candidate){return candidate!=MessageDrawerViewConversationContants.CONVERSATION_TYPES.SELF}));includeSelfConversations=types.length!=nonSelfConversationTypes.length,type=nonSelfConversationTypes[0]}return function(root,userId){return MessageRepository.getConversations(userId,type,51,offset,includeFavourites,includeSelfConversations).then((function(response){var conversations=response.conversations;return conversations.length>50?conversations=conversations.slice(0,-1):LazyLoadList.setLoadedAll(root,!0),offset+=50,conversations.forEach((function(conversation){loadedConversationsById[conversation.id]=conversation})),conversations})).catch(Notification.exception)}}(types,includeFavourites,0);if(registerEventListeners(namespace,root,loadCallback,types,includeFavourites,fromPanel),isVisible(root)){setExpanded(root);var listRoot=LazyLoadList.getRoot(root);LazyLoadList.show(listRoot,loadCallback,(function(contentContainer,conversations,userId){return render(conversations,userId).then((function(html){return contentContainer.append(html),html})).catch(Notification.exception)}))}totalCountPromise.then((function(count){!function(root,count){var container=root.find(SELECTORS_SECTION_TOTAL_COUNT_CONTAINER);container.find(SELECTORS_SECTION_TOTAL_COUNT).text(count),container.removeClass("hidden"),Str.get_string("totalconversations","core_message",count).done((function(string){container.attr("aria-label",string)}));var numPlaceholders=count>20?20:count,placeholders=Array.apply(null,Array(numPlaceholders)).map((function(){return!0}));Templates.render(TEMPLATES_CONVERSATIONS_LIST_ITEMS_PLACEHOLDER,{placeholders:placeholders}).then((function(html){root.find(SELECTORS_PLACEHOLDER_CONTAINER).html(html)})).catch((function(){}))}(root,count),loadedTotalCounts=!0})).catch((function(){})),unreadCountPromise.then((function(count){!function(root,count){var countElement=root.find(SELECTORS_SECTION_UNREAD_COUNT);countElement.text(count),Str.get_string("unreadconversations","core_message",count).done((function(string){countElement.attr("aria-label",string)})),count>0&&countElement.removeClass("hidden")}(root,count),loadedUnreadCounts=!0})).catch((function(){})),root.attr("data-init",!0)}},isVisible:isVisible}}));
/**
 * Controls the requests section of the contacts page.
 *
 * @module     core_message/message_drawer_view_contacts_section_requests
 * @package    message
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_contacts_section_requests",["jquery","core/notification","core/pubsub","core/templates","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_lazy_load_list"],(function($,Notification,PubSub,Templates,MessageRepository,MessageDrawerEvents,LazyLoadList){var SELECTORS_CONTACT_REQUEST='[data-region="contact-request"]',TEMPLATES_REQUESTS_LIST="core_message/message_drawer_view_contacts_body_section_requests_list",render=function(contentContainer,requests){var formattedRequests=requests.map((function(request){return{id:request.id,profileimageurl:request.profileimageurl,fullname:request.fullname}}));return Templates.render(TEMPLATES_REQUESTS_LIST,{requests:formattedRequests}).then((function(html){return contentContainer.append(html),html})).catch(Notification.exception)},load=function(listRoot,userId){return MessageRepository.getContactRequests(userId).then((function(requests){return LazyLoadList.setLoadedAll(listRoot,!0),requests})).catch(Notification.exception)},handleContactRequestProcessed=function(root){return function(request){root.find('[data-request-id="'+request.userid+'"]').remove(),root.find(SELECTORS_CONTACT_REQUEST).length||(LazyLoadList.showEmptyMessage(root),LazyLoadList.hideContent(root))}};return{show:function(root){root.attr("data-contacts-init")||(!function(root){PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED,handleContactRequestProcessed(root)),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_DECLINED,handleContactRequestProcessed(root))}(root),root.attr("data-contacts-init",!0)),LazyLoadList.show(root,load,render)}}}));
/**
 * Controls the overview page of the message drawer.
 *
 * @module     core_message/message_drawer_view_overview
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_overview",["jquery","core/key_codes","core/pubsub","core/str","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_events","core_message/message_drawer_view_overview_section","core_message/message_repository","core_message/message_drawer_view_conversation_constants"],(function($,KeyCodes,PubSub,Str,Router,Routes,MessageDrawerEvents,Section,MessageRepository,Constants){var SELECTORS_CONTACT_REQUEST_COUNT='[data-region="contact-request-count"]',SELECTORS_FAVOURITES='[data-region="view-overview-favourites"]',SELECTORS_GROUP_MESSAGES='[data-region="view-overview-group-messages"]',SELECTORS_MESSAGES='[data-region="view-overview-messages"]',SELECTORS_SEARCH_INPUT='[data-region="view-overview-search-input"]',SELECTORS_SECTION_TOGGLE_BUTTON="[data-toggle]",OVERVIEW_SECTION_TYPES={PRIVATE:[Constants.CONVERSATION_TYPES.PRIVATE,Constants.CONVERSATION_TYPES.SELF],PUBLIC:[Constants.CONVERSATION_TYPES.PUBLIC],FAVOURITE:null},loadAllCountsPromise=null,filterCountsByTypes=function(counts,types,includeFavourites){var total=0;return types&&types.length&&(total=types.reduce((function(carry,type){return carry+counts.types[type]}),total)),includeFavourites&&(total+=counts.favourites),total},getSearchInput=function(header){return header.find(SELECTORS_SEARCH_INPUT)},decrementContactRequestCount=function(header){return function(){var countContainer=header.find(SELECTORS_CONTACT_REQUEST_COUNT),count=parseInt(countContainer.text(),10);(count=isNaN(count)?0:count-1)<=0?countContainer.addClass("hidden"):countContainer.text(count)}};return{show:function(namespace,header,body){header.attr("data-init")||(!function(namespace,header){var searchInput=getSearchInput(header),ignoredKeys=[KeyCodes.tab,KeyCodes.shift,KeyCodes.ctrl,KeyCodes.alt];searchInput.on("click",(function(){Router.go(namespace,Routes.VIEW_SEARCH)})),searchInput.on("keydown",(function(e){ignoredKeys.indexOf(e.keyCode)<0&&"Meta"!=e.key&&Router.go(namespace,Routes.VIEW_SEARCH)})),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED,decrementContactRequestCount(header)),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_DECLINED,decrementContactRequestCount(header))}(namespace,header),header.attr("data-init",!0));var fromPanel=header.attr("data-in-panel")?"frompanel":null;getSearchInput(header).val("");var loggedInUserId=function(body){return body.attr("data-user-id")}(body),allCounts=function(loggedInUserId){return null===loadAllCountsPromise&&(loadAllCountsPromise=MessageRepository.getAllConversationCounts(loggedInUserId)),loadAllCountsPromise}(loggedInUserId),sections=[[body.find(SELECTORS_FAVOURITES),OVERVIEW_SECTION_TYPES.FAVOURITE,!0],[body.find(SELECTORS_GROUP_MESSAGES),OVERVIEW_SECTION_TYPES.PUBLIC,!1],[body.find(SELECTORS_MESSAGES),OVERVIEW_SECTION_TYPES.PRIVATE,!1]];return sections.forEach((function(args){var sectionRoot=args[0],sectionTypes=args[1],includeFavourites=args[2],totalCountPromise=allCounts.then((function(result){return filterCountsByTypes(result.total,sectionTypes,includeFavourites)})),unreadCountPromise=allCounts.then((function(result){return filterCountsByTypes(result.unread,sectionTypes,includeFavourites)}));Section.show(namespace,null,sectionRoot,null,sectionTypes,includeFavourites,totalCountPromise,unreadCountPromise,fromPanel)})),allCounts.then((function(result){return function(sections){sections.some((function(section){var sectionRoot=section[0];return Section.isVisible(sectionRoot)}))||(sections.sort((function(a,b){var aTotal=a[1],aUnread=a[2],bTotal=b[1],bUnread=b[2];return aUnread>0&&0==bUnread?-1:0==aUnread&&bUnread>0?1:aTotal>0&&0==bTotal?-1:0==aTotal&&bTotal>0?1:0})),sections[0][0].find(SELECTORS_SECTION_TOGGLE_BUTTON).click())}(sections.map((function(section){var sectionRoot=section[0],sectionTypes=section[1],includeFavourites=section[2];return[sectionRoot,filterCountsByTypes(result.total,sectionTypes,includeFavourites),filterCountsByTypes(result.unread,sectionTypes,includeFavourites)]})))}))},description:function(){return Str.get_string("messagedrawerviewoverview","core_message")}}}));
/**
 * Available routes for the message drawer.
 *
 * @module     core_message/message_drawer_routes
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_routes",[],(function(){return{VIEW_CONTACT:"view-contact",VIEW_CONTACTS:"view-contacts",VIEW_CONVERSATION:"view-conversation",VIEW_GROUP_INFO:"view-group-info",VIEW_OVERVIEW:"view-overview",VIEW_SEARCH:"view-search",VIEW_SETTINGS:"view-settings"}}));
/**
 * This module operates on the view states from the message_drawer_view_conversation module.
 * It exposes functions that can be used to generate new version of the state.
 *
 * Important notes for this module:
 * 1.) The existing state is always immutable. It should never be modified.
 * 2.) All functions that operate on the state should always clone the state and
 *     modify the cloned state before returning it.
 *
 * It's important that the states remain immutable because they are diff'd in
 * the message_drawer_view_conversation_patcher module in order to work out what
 * has changed.
 *
 * @module     core_message/message_drawer_view_conversation_state_manager
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_conversation_state_manager",["jquery"],(function($){var cloneState=function(state){return $.extend(!0,{},state)},formatMessages=function(messages,loggedInUserId,members){return messages.map((function(message){var fromLoggedInUser=message.useridfrom==loggedInUserId;return{id:""+message.id,fromLoggedInUser:fromLoggedInUser,userFrom:members[message.useridfrom],text:message.text,timeCreated:message.timecreated?parseInt(message.timecreated,10):null}}))};return{buildInitialState:function(midnight,loggedInUserId,id,messagePollMin,messagePollMax,messagePollAfterMax){return{midnight:midnight,loggedInUserId:loggedInUserId,id:id,messagePollMin:messagePollMin,messagePollMax:messagePollMax,messagePollAfterMax:messagePollAfterMax,name:null,subname:null,type:null,totalMemberCount:null,imageUrl:null,isFavourite:null,isMuted:null,canDeleteMessagesForAllUsers:!1,deleteMessagesForAllUsers:!1,members:{},messages:[],hasTriedToLoadMessages:!1,loadingMessages:!0,loadingMembers:!0,loadingConfirmAction:!1,pendingBlockUserIds:[],pendingUnblockUserIds:[],pendingRemoveContactIds:[],pendingAddContactIds:[],pendingDeleteMessageIds:[],pendingSendMessageIds:[],pendingDeleteConversation:!1,selectedMessageIds:[],showEmojiAutoComplete:!1,showEmojiPicker:!1}},addMessages:function(state,messages){var newState=cloneState(state),formattedMessages=formatMessages(messages,state.loggedInUserId,state.members);formattedMessages=formattedMessages.map((function(message){return message.sendState=null,message.timeAdded=Date.now(),message.errorMessage=null,message}));var allMessages=state.messages.concat(formattedMessages);return allMessages.sort((function(a,b){if(null===a.timeCreated&&null===b.timeCreated){if(a.timeAdded<b.timeAdded)return-1;if(a.timeAdded>b.timeAdded)return 1}return null===a.timeCreated&&null!==b.timeCreated?1:null!==a.timeCreated&&null===b.timeCreated||a.timeCreated<b.timeCreated?-1:a.timeCreated>b.timeCreated?1:a.id<b.id?-1:a.id>b.id?1:0})),newState.messages=allMessages.filter((function(message,index,sortedMessages){return!index||message.id!=sortedMessages[index-1].id})),newState},updateMessages:function(state,data){var newState=cloneState(state),updatesById=data.reduce((function(carry,messageData){var oldMessage=messageData[0],newMessage=messageData[1],formattedMessage=formatMessages([newMessage],state.loggedInUserId,state.members)[0];return carry[oldMessage.id]=formattedMessage,carry}),{});return newState.messages=newState.messages.map((function(message){return message.id in updatesById?$.extend(message,updatesById[message.id]):message})),newState},removeMessages:function(state,messages){var newState=cloneState(state),removeMessageIds=messages.map((function(message){return""+message.id}));return newState.messages=newState.messages.filter((function(message){return removeMessageIds.indexOf(message.id)<0})),newState},removeMessagesById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.messages=newState.messages.filter((function(message){return messageIds.indexOf(message.id)<0})),newState},addMembers:function(state,members){var newState=cloneState(state),formattedMembers=function(members){return members.map((function(member){return{id:member.id,fullname:member.fullname,profileurl:member.profileurl,profileimageurl:member.profileimageurl,profileimageurlsmall:member.profileimageurlsmall,isonline:member.isonline,showonlinestatus:member.showonlinestatus,isblocked:member.isblocked,iscontact:member.iscontact,isdeleted:member.isdeleted,canmessage:member.canmessage,canmessageevenifblocked:member.canmessageevenifblocked,requirescontact:member.requirescontact,contactrequests:member.contactrequests||[]}}))}(members);return formattedMembers.forEach((function(member){newState.members[member.id]=member})),newState},removeMembers:function(state,members){var newState=cloneState(state);return members.forEach((function(member){delete newState.members[member.id]})),newState},setLoadingMessages:function(state,value){var newState=cloneState(state);return newState.loadingMessages=value,state.loadingMessages&&!value&&(newState.hasTriedToLoadMessages=!0),newState},setLoadingMembers:function(state,value){var newState=cloneState(state);return newState.loadingMembers=value,newState},setId:function(state,value){var newState=cloneState(state);return newState.id=value,newState},setName:function(state,value){var newState=cloneState(state);return newState.name=value,newState},setSubname:function(state,value){var newState=cloneState(state);return newState.subname=value,newState},setType:function(state,type){var newState=cloneState(state);return newState.type=type,newState},setIsFavourite:function(state,isFavourite){var newState=cloneState(state);return newState.isFavourite=isFavourite,newState},setIsMuted:function(state,isMuted){var newState=cloneState(state);return newState.isMuted=isMuted,newState},setCanDeleteMessagesForAllUsers:function(state,value){var newState=cloneState(state);return newState.canDeleteMessagesForAllUsers=value,newState},setDeleteMessagesForAllUsers:function(state,value){var newState=cloneState(state);return newState.deleteMessagesForAllUsers=value,newState},setTotalMemberCount:function(state,count){var newState=cloneState(state);return newState.totalMemberCount=count,newState},setImageUrl:function(state,url){var newState=cloneState(state);return newState.imageUrl=url,newState},setLoadingConfirmAction:function(state,value){var newState=cloneState(state);return newState.loadingConfirmAction=value,newState},setPendingDeleteConversation:function(state,value){var newState=cloneState(state);return newState.pendingDeleteConversation=value,newState},setMessagesSendPendingById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.messages.forEach((function(message){messageIds.indexOf(message.id)>=0&&(message.sendState="pending",message.errorMessage=null)})),newState},setMessagesSendSuccessById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.messages.forEach((function(message){messageIds.indexOf(message.id)>=0&&(message.sendState="sent",message.errorMessage=null)})),newState},setMessagesSendFailById:function(state,messageIds,errorMessage){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.messages.forEach((function(message){messageIds.indexOf(message.id)>=0&&(message.sendState="error",message.errorMessage=errorMessage)})),newState},setShowEmojiAutoComplete:function(state,show){var newState=cloneState(state);return newState.showEmojiAutoComplete=show,newState},setShowEmojiPicker:function(state,show){var newState=cloneState(state);return newState.showEmojiPicker=show,newState},addPendingBlockUsersById:function(state,userIds){var newState=cloneState(state);return userIds.forEach((function(id){newState.pendingBlockUserIds.push(id)})),newState},addPendingRemoveContactsById:function(state,userIds){var newState=cloneState(state);return userIds.forEach((function(id){newState.pendingRemoveContactIds.push(id)})),newState},addPendingUnblockUsersById:function(state,userIds){var newState=cloneState(state);return userIds.forEach((function(id){newState.pendingUnblockUserIds.push(id)})),newState},addPendingAddContactsById:function(state,userIds){var newState=cloneState(state);return userIds.forEach((function(id){newState.pendingAddContactIds.push(id)})),newState},addPendingDeleteMessagesById:function(state,messageIds){var newState=cloneState(state);return messageIds.forEach((function(id){newState.pendingDeleteMessageIds.push(id)})),newState},removePendingBlockUsersById:function(state,userIds){var newState=cloneState(state);return newState.pendingBlockUserIds=newState.pendingBlockUserIds.filter((function(id){return userIds.indexOf(id)<0})),newState},removePendingRemoveContactsById:function(state,userIds){var newState=cloneState(state);return newState.pendingRemoveContactIds=newState.pendingRemoveContactIds.filter((function(id){return userIds.indexOf(id)<0})),newState},removePendingUnblockUsersById:function(state,userIds){var newState=cloneState(state);return newState.pendingUnblockUserIds=newState.pendingUnblockUserIds.filter((function(id){return userIds.indexOf(id)<0})),newState},removePendingAddContactsById:function(state,userIds){var newState=cloneState(state);return newState.pendingAddContactIds=newState.pendingAddContactIds.filter((function(id){return userIds.indexOf(id)<0})),newState},removePendingDeleteMessagesById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.pendingDeleteMessageIds=newState.pendingDeleteMessageIds.filter((function(id){return messageIds.indexOf(id)<0})),newState},addSelectedMessagesById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.selectedMessageIds=newState.selectedMessageIds.concat(messageIds),newState},removeSelectedMessagesById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.selectedMessageIds=newState.selectedMessageIds.filter((function(id){return messageIds.indexOf(id)<0})),newState},markMessagesAsRead:function(state,readMessages){var newState=cloneState(state),readMessageIds=readMessages.map((function(message){return message.id}));return newState.messages=newState.messages.map((function(message){return readMessageIds.indexOf(message.id)>=0&&(message.isRead=!0),message})),newState},addContactRequests:function(state,requests){var newState=cloneState(state);return requests.forEach((function(request){var fromUserId=request.userid,toUserId=request.requesteduserid;newState.members[fromUserId].contactrequests.push(request),newState.members[toUserId].contactrequests.push(request)})),newState},removeContactRequests:function(state,requests){var newState=cloneState(state);return requests.forEach((function(request){var fromUserId=request.userid,toUserId=request.requesteduserid;newState.members[fromUserId].contactrequests=newState.members[fromUserId].contactrequests.filter((function(existing){return existing.userid!=fromUserId})),newState.members[toUserId].contactrequests=newState.members[toUserId].contactrequests.filter((function(existing){return existing.requesteduserid!=toUserId}))})),newState}}}));
/**
 * Controls the preference for an individual notification type on the
 * message preference page.
 *
 * @module     core_message/notification_preference
 * @class      notification_preference
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/notification_preference",["jquery","core/ajax","core/notification","core_message/notification_processor"],(function($,Ajax,Notification,NotificationProcessor){var SELECTORS_PROCESSOR="[data-processor-name]",SELECTORS_STATE_INPUTS="[data-state] input",NotificationPreference=function(element,userId){this.root=$(element),this.userId=userId};return NotificationPreference.prototype.getPreferenceKey=function(){return this.root.attr("data-preference-key")},NotificationPreference.prototype.getLoggedInPreferenceKey=function(){return this.getPreferenceKey()+"_loggedin"},NotificationPreference.prototype.getLoggedOffPreferenceKey=function(){return this.getPreferenceKey()+"_loggedoff"},NotificationPreference.prototype.getProcessors=function(){return this.root.find(SELECTORS_PROCESSOR).map((function(index,element){return new NotificationProcessor($(element))}))},NotificationPreference.prototype.startLoading=function(){this.root.addClass("loading"),this.root.find(SELECTORS_STATE_INPUTS).prop("disabled",!0)},NotificationPreference.prototype.stopLoading=function(){this.root.removeClass("loading"),this.root.find(SELECTORS_STATE_INPUTS).prop("disabled",!1)},NotificationPreference.prototype.isLoading=function(){return this.root.hasClass("loading")},NotificationPreference.prototype.save=function(){if(this.isLoading())return $.Deferred().resolve();this.startLoading();var loggedInValue="",loggedOffValue="";this.getProcessors().each((function(index,processor){processor.isLoggedInEnabled()&&(""===loggedInValue?loggedInValue=processor.getName():loggedInValue+=","+processor.getName()),processor.isLoggedOffEnabled()&&(""===loggedOffValue?loggedOffValue=processor.getName():loggedOffValue+=","+processor.getName())})),""===loggedInValue&&(loggedInValue="none"),""===loggedOffValue&&(loggedOffValue="none");var request={methodname:"core_user_update_user_preferences",args:{userid:this.userId,preferences:[{type:this.getLoggedInPreferenceKey(),value:loggedInValue},{type:this.getLoggedOffPreferenceKey(),value:loggedOffValue}]}};return Ajax.call([request])[0].fail(Notification.exception).always(function(){this.stopLoading()}.bind(this))},NotificationPreference}));
define("core_message/message_send_bulk",["exports","core/str","core/modal_factory","core/templates","core/modal_events","core/ajax","core/notification"],(function(_exports,_str,_modal_factory,_templates,_modal_events,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Send bulk message to the given user ids.
   *
   * @module     core_message/message_send_bulk
   * @copyright  2019 Shamim Rezaie <shamim@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.showModal=_exports.sendMessage=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_templates=_interopRequireDefault(_templates),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);_exports.showModal=function(users){var callback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!users.length)return Promise.resolve();var titlePromise=null;return titlePromise=1==users.length?(0,_str.get_string)("sendbulkmessagesingle","core_message"):(0,_str.get_string)("sendbulkmessage","core_message",users.length),_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:_templates.default.render("core_message/send_bulk_message",{}),title:titlePromise}).then((function(modal){return modal.setSaveButtonText(titlePromise),modal.getRoot().on(_modal_events.default.hidden,(function(){callback&&callback(),modal.getRoot().remove()})),modal.getRoot().on(_modal_events.default.save,(function(){var messageText=modal.getRoot().find("form textarea").val();sendMessage(messageText,users)})),modal.show(),modal}))};var sendMessage=function(messageText,users){var messages=[];return users.forEach((function(user){messages.push({touserid:user,text:messageText})})),_ajax.default.call([{methodname:"core_message_send_instant_messages",args:{messages:messages}}])[0].then((function(messageIds){return 1==messageIds.length?(0,_str.get_string)("sendbulkmessagesentsingle","core_message"):(0,_str.get_string)("sendbulkmessagesent","core_message",messageIds.length)})).then((function(msg){return _notification.default.addNotification({message:msg,type:"success"}),!0})).catch(_notification.default.exception)};_exports.sendMessage=sendMessage}));
/**
 * A javascript module to handle question ajax actions.
 *
 * @module     core_question/repository
 * @class      repository
 * @package    core_question
 * @copyright  2017 Simey Lameze <lameze@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_question/repository",["jquery","core/ajax"],(function($,Ajax){return{submitTagCreateUpdateForm:function(questionId,contextId,formdata){var request={methodname:"core_question_submit_tags_form",args:{questionid:questionId,contextid:contextId,formdata:formdata}};return Ajax.call([request])[0]}}}));
/**
 * A javascript module to handle question tags editing.
 *
 * @module     core_question/edit_tags
 * @copyright  2018 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_question/edit_tags",["jquery","core/fragment","core/str","core/modal_events","core/modal_factory","core/notification","core/custom_interaction_events","core_question/repository","core_question/selectors"],(function($,Fragment,Str,ModalEvents,ModalFactory,Notification,CustomEvents,Repository,QuestionSelectors){var enableSaveButton=function(root){root.find(QuestionSelectors.actions.save).prop("disabled",!1)},disableSaveButton=function(root){root.find(QuestionSelectors.actions.save).prop("disabled",!0)},startLoading=function(root){root.find(QuestionSelectors.containers.loadingIcon).removeClass("hidden")},stopLoading=function(root){root.find(QuestionSelectors.containers.loadingIcon).addClass("hidden")},save=function(modal,root){disableSaveButton(root),startLoading(root);var formData=function(modal){return modal.getBody().find("form").serialize()}(modal),questionId=function(modal){return modal.getBody().data("questionid")}(modal),contextId=function(modal){return modal.getBody().data("contextid")}(modal);return Repository.submitTagCreateUpdateForm(questionId,contextId,formData).always((function(){stopLoading(root),enableSaveButton(root)})).fail(Notification.exception)};return{init:function(root){!function(root){var modalPromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,large:!1},[root,QuestionSelectors.actions.edittags]).then((function(modal){return Str.get_string("questiontags","question").then((function(string){return modal.setTitle(string),string})).fail(Notification.exception),modal.getRoot().on(ModalEvents.save,(function(e){modal.getBody().find("form").submit(),e.preventDefault()})),modal.getRoot().on("submit","form",(function(e){save(modal,root).then((function(){modal.hide(),location.reload()})).fail(Notification.exception),e.preventDefault(),e.stopPropagation()})),modal}));root.on(CustomEvents.events.activate,QuestionSelectors.actions.edittags,(function(e){var currentTarget=$(e.currentTarget),questionId=currentTarget.data("questionid"),canTag=!!currentTarget.data("cantag"),contextId=currentTarget.data("contextid");modalPromise.then((function(modal){disableSaveButton(root),startLoading(root);var args={id:questionId},tagsFragment=Fragment.loadFragment("question","tags_form",contextId,args);return modal.setBody(tagsFragment),tagsFragment.then((function(){enableSaveButton(root)})).always((function(){stopLoading(root)})).fail(Notification.exception),canTag?modal.getRoot().find(QuestionSelectors.actions.save).show():modal.getRoot().find(QuestionSelectors.actions.save).hide(),function(modal,questionId){modal.getBody().attr("data-questionid",questionId)}(modal,questionId),function(modal,contextId){modal.getBody().attr("data-contextid",contextId)}(modal,contextId),modal})).fail(Notification.exception),e.preventDefault()}))}(root=$(root))}}}));
/**
 * The purpose of this module is to centralize selectors related to question.
 *
 * @module     core_question/question_selectors
 * @package    core_question
 * @copyright  2018 Simey Lameze <lameze@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_question/selectors",[],(function(){return{actions:{save:'[data-action="save"]',edittags:'[data-action="edittags"]'},containers:{loadingIcon:'[data-region="overlay-icon-container"]'}}}));
/**
 * Search user selector module.
 *
 * @module core_search/form-search-user-selector
 * @class form-search-user-selector
 * @package core_search
 * @copyright 2017 The Open University
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_search/form-search-user-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var users=[];return $.each(results,(function(index,user){users.push({value:user.id,label:user._label})})),users},transport:function(selector,query,success,failure){var args={query:query},courseid=$(selector).attr("withincourseid");void 0!==courseid&&""!==$("#id_searchwithin").val()?args.courseid=courseid:args.courseid=0,Ajax.call([{methodname:"core_search_get_relevant_users",args:args}])[0].then((function(results){var promises=[];return $.each(results,(function(index,user){promises.push(Templates.render("core_search/form-user-selector-suggestion",user))})),$.when.apply($.when,promises).then((function(){var args=arguments,i=0;$.each(results,(function(index,user){user._label=args[i++]})),success(results)}))})).fail(failure)}}}));
define("core_table/local/dynamic/repository",["exports","core/ajax"],(function(_exports,_ajax){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.fetch=void 0;_exports.fetch=function(component,handler,uniqueid){var _ref=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},_ref$sortData=_ref.sortData,sortData=void 0===_ref$sortData?[]:_ref$sortData,_ref$joinType=_ref.joinType,joinType=void 0===_ref$joinType?null:_ref$joinType,_ref$filters=_ref.filters,filters=void 0===_ref$filters?{}:_ref$filters,_ref$firstinitial=_ref.firstinitial,firstinitial=void 0===_ref$firstinitial?null:_ref$firstinitial,_ref$lastinitial=_ref.lastinitial,lastinitial=void 0===_ref$lastinitial?null:_ref$lastinitial,_ref$pageNumber=_ref.pageNumber,pageNumber=void 0===_ref$pageNumber?null:_ref$pageNumber,_ref$pageSize=_ref.pageSize,pageSize=void 0===_ref$pageSize?null:_ref$pageSize,_ref$hiddenColumns=_ref.hiddenColumns,hiddenColumns=void 0===_ref$hiddenColumns?{}:_ref$hiddenColumns,resetPreferences=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,_ajax.call)([{methodname:"core_table_get_dynamic_table_content",args:{component:component,handler:handler,uniqueid:uniqueid,sortdata:sortData,jointype:joinType,filters:filters,firstinitial:firstinitial,lastinitial:lastinitial,pagenumber:pageNumber,pagesize:pageSize,hiddencolumns:hiddenColumns,resetpreferences:resetPreferences}}])[0]}}));
define("core_table/local/dynamic/events",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Dynamic table selectors.
   *
   * @module     core_table/local/dynamic/events
   * @package    core_table
   * @copyright  2020 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var eventName,_default={tableContentRefreshed:(eventName="tableContentRefreshed","core_table/dynamic:".concat(eventName))};return _exports.default=_default,_exports.default}));
define("core_table/local/dynamic/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={main:{region:'[data-region="core_table/dynamic"]',fromRegionId:function(regionId){return'[data-region="core_table/dynamic"][data-table-uniqueid="'.concat(regionId,'"]')}},table:{links:{sortableColumn:'a[data-sortable="1"]',hide:'a[data-action="hide"]',show:'a[data-action="show"]'}},initialsBar:{links:{firstInitial:".firstinitial [data-initial]",lastInitial:".lastinitial [data-initial]"}},paginationBar:{links:{pageItem:".pagination [data-page-number]"}}},_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_table/dynamic",["exports","core_table/local/dynamic/selectors","./local/dynamic/events","core/pending","core/loadingicon","core_table/local/dynamic/repository","core/notification"],(function(_exports,Selectors,_events,_pending,_loadingicon,_repository,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"Events",{enumerable:!0,get:function(){return _events.default}}),_exports.updateTable=_exports.showColumn=_exports.setSortOrder=_exports.setPageSize=_exports.setPageNumber=_exports.setLastInitial=_exports.setFirstInitial=_exports.setFilters=_exports.refreshTableContent=_exports.init=_exports.hideColumn=_exports.getTableFromId=_exports.getPageSize=_exports.getPageNumber=_exports.getLastInitial=_exports.getFirstInitial=_exports.getFilters=void 0,Selectors=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Selectors),_events=_interopRequireDefault(_events),_pending=_interopRequireDefault(_pending),_notification=_interopRequireDefault(_notification);var watching=!1,checkTableIsDynamic=function(tableRoot){if(!tableRoot)throw new Error("The table specified is not a dynamic table and cannot be updated");if(!tableRoot.matches(Selectors.main.region))throw new Error("The table specified is not a dynamic table and cannot be updated");return!0},getFiltersetFromTable=function(tableRoot){return JSON.parse(tableRoot.dataset.tableFilters)},refreshTableContent=function(tableRoot){var resetContent=arguments.length>1&&void 0!==arguments[1]&&arguments[1],filterset=getFiltersetFromTable(tableRoot);(0,_loadingicon.addIconToContainer)(tableRoot);var pendingPromise=new _pending.default("core_table/dynamic:refreshTableContent");return(0,_repository.fetch)(tableRoot.dataset.tableComponent,tableRoot.dataset.tableHandler,tableRoot.dataset.tableUniqueid,{sortData:JSON.parse(tableRoot.dataset.tableSortData),joinType:filterset.jointype,filters:filterset.filters,firstinitial:tableRoot.dataset.tableFirstInitial,lastinitial:tableRoot.dataset.tableLastInitial,pageNumber:tableRoot.dataset.tablePageNumber,pageSize:tableRoot.dataset.tablePageSize,hiddenColumns:JSON.parse(tableRoot.dataset.tableHiddenColumns)},resetContent).then((function(data){var placeholder=document.createElement("div");return placeholder.innerHTML=data.html,tableRoot.replaceWith.apply(tableRoot,_toConsumableArray(placeholder.childNodes)),getTableFromId(tableRoot.dataset.tableUniqueid)})).then((function(tableRoot){return tableRoot.dispatchEvent(new CustomEvent(_events.default.tableContentRefreshed,{bubbles:!0})),tableRoot})).then((function(tableRoot){return pendingPromise.resolve(),tableRoot}))};_exports.refreshTableContent=refreshTableContent;var updateTable=function(tableRoot){var _ref=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_ref$sortBy=_ref.sortBy,sortBy=void 0===_ref$sortBy?null:_ref$sortBy,_ref$sortOrder=_ref.sortOrder,sortOrder=void 0===_ref$sortOrder?null:_ref$sortOrder,_ref$filters=_ref.filters,filters=void 0===_ref$filters?null:_ref$filters,_ref$firstInitial=_ref.firstInitial,firstInitial=void 0===_ref$firstInitial?null:_ref$firstInitial,_ref$lastInitial=_ref.lastInitial,lastInitial=void 0===_ref$lastInitial?null:_ref$lastInitial,_ref$pageNumber=_ref.pageNumber,pageNumber=void 0===_ref$pageNumber?null:_ref$pageNumber,_ref$pageSize=_ref.pageSize,pageSize=void 0===_ref$pageSize?null:_ref$pageSize,_ref$hiddenColumns=_ref.hiddenColumns,hiddenColumns=void 0===_ref$hiddenColumns?null:_ref$hiddenColumns,refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];checkTableIsDynamic(tableRoot);var pendingPromise=new _pending.default("core_table/dynamic:updateTable"),tableConfigChanged=!1;if(sortBy&&sortOrder){tableConfigChanged=!0;var sortData=JSON.parse(tableRoot.dataset.tableSortData);sortData.unshift({sortby:sortBy,sortorder:parseInt(sortOrder,10)}),tableRoot.dataset.tableSortData=JSON.stringify(sortData)}if(null!==firstInitial&&(tableRoot.dataset.tableFirstInitial!==firstInitial&&(tableConfigChanged=!0),tableRoot.dataset.tableFirstInitial=firstInitial),null!==lastInitial&&(tableRoot.dataset.tableLastInitial!==lastInitial&&(tableConfigChanged=!0),tableRoot.dataset.tableLastInitial=lastInitial),null!==pageSize&&(tableRoot.dataset.tablePageSize!=pageSize&&(tableConfigChanged=!0),tableRoot.dataset.tablePageSize=pageSize),filters){var filterJson=JSON.stringify(filters);tableRoot.dataset.tableFilters!==filterJson&&(tableConfigChanged=!0),tableRoot.dataset.tableFilters=filterJson}if(tableConfigChanged&&(pageNumber=1),hiddenColumns){var columnJson=JSON.stringify(hiddenColumns);tableRoot.dataset.tableHiddenColumns!==columnJson&&(tableConfigChanged=!0),tableRoot.dataset.tableHiddenColumns=columnJson}return null!==pageNumber&&(tableRoot.dataset.tablePageNumber!=pageNumber&&(tableConfigChanged=!0),tableRoot.dataset.tablePageNumber=pageNumber),refreshContent&&tableConfigChanged?refreshTableContent(tableRoot).then((function(tableRoot){return pendingPromise.resolve(),tableRoot})):(pendingPromise.resolve(),Promise.resolve(tableRoot))};_exports.updateTable=updateTable;var getTableData=function(tableRoot){return checkTableIsDynamic(tableRoot),tableRoot.dataset};_exports.setFilters=function(tableRoot,filters){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return updateTable(tableRoot,{filters:filters},refreshContent)};_exports.getFilters=function(tableRoot){return checkTableIsDynamic(tableRoot),getFiltersetFromTable(tableRoot)};var setSortOrder=function(tableRoot,sortBy,sortOrder){var refreshContent=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return updateTable(tableRoot,{sortBy:sortBy,sortOrder:sortOrder},refreshContent)};_exports.setSortOrder=setSortOrder;var setPageNumber=function(tableRoot,pageNumber){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return updateTable(tableRoot,{pageNumber:pageNumber},refreshContent)};_exports.setPageNumber=setPageNumber;_exports.getPageNumber=function(tableRoot){return getTableData(tableRoot).tablePageNumber};_exports.setPageSize=function(tableRoot,pageSize){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return updateTable(tableRoot,{pageSize:pageSize,pageNumber:1},refreshContent)};_exports.getPageSize=function(tableRoot){return getTableData(tableRoot).tablePageSize};var setFirstInitial=function(tableRoot,firstInitial){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return updateTable(tableRoot,{firstInitial:firstInitial},refreshContent)};_exports.setFirstInitial=setFirstInitial;_exports.getFirstInitial=function(tableRoot){return getTableData(tableRoot).tableFirstInitial};var setLastInitial=function(tableRoot,lastInitial){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return updateTable(tableRoot,{lastInitial:lastInitial},refreshContent)};_exports.setLastInitial=setLastInitial;_exports.getLastInitial=function(tableRoot){return getTableData(tableRoot).tableLastInitial};var hideColumn=function(tableRoot,columnToHide){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],hiddenColumns=JSON.parse(tableRoot.dataset.tableHiddenColumns);return hiddenColumns.push(columnToHide),updateTable(tableRoot,{hiddenColumns:hiddenColumns},refreshContent)};_exports.hideColumn=hideColumn;var showColumn=function(tableRoot,columnToShow){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],hiddenColumns=JSON.parse(tableRoot.dataset.tableHiddenColumns);return hiddenColumns=hiddenColumns.filter((function(columnName){return columnName!==columnToShow})),updateTable(tableRoot,{hiddenColumns:hiddenColumns},refreshContent)};_exports.showColumn=showColumn;_exports.init=function(){watching||(watching=!0,document.addEventListener("click",(function(e){var tableRoot=e.target.closest(Selectors.main.region);if(tableRoot){var sortableLink=e.target.closest(Selectors.table.links.sortableColumn);sortableLink&&(e.preventDefault(),setSortOrder(tableRoot,sortableLink.dataset.sortby,sortableLink.dataset.sortorder).catch(_notification.default.exception));var firstInitialLink=e.target.closest(Selectors.initialsBar.links.firstInitial);null!==firstInitialLink&&(e.preventDefault(),setFirstInitial(tableRoot,firstInitialLink.dataset.initial).catch(_notification.default.exception));var lastInitialLink=e.target.closest(Selectors.initialsBar.links.lastInitial);null!==lastInitialLink&&(e.preventDefault(),setLastInitial(tableRoot,lastInitialLink.dataset.initial).catch(_notification.default.exception));var pageItem=e.target.closest(Selectors.paginationBar.links.pageItem);pageItem&&(e.preventDefault(),setPageNumber(tableRoot,pageItem.dataset.pageNumber).catch(_notification.default.exception));var hide=e.target.closest(Selectors.table.links.hide);hide&&(e.preventDefault(),hideColumn(tableRoot,hide.dataset.column).catch(_notification.default.exception));var show=e.target.closest(Selectors.table.links.show);show&&(e.preventDefault(),showColumn(tableRoot,show.dataset.column).catch(_notification.default.exception)),e.target.closest(".resettable a")&&(e.preventDefault(),function(tableRoot){return refreshTableContent(tableRoot,!0)}(tableRoot).catch(_notification.default.exception))}})))};var getTableFromId=function(tableRegionId){var tableRoot=document.querySelector(Selectors.main.fromRegionId(tableRegionId));if(!tableRoot)throw new Error("The table specified is not a dynamic table and cannot be updated");return tableRoot};_exports.getTableFromId=getTableFromId}));
define("core_user/repository",["exports","core/ajax"],(function(_exports,_ajax){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.unenrolUser=_exports.submitUserEnrolmentForm=_exports.sendMessagesToUsers=_exports.createNotesForUsers=void 0;_exports.unenrolUser=function(userEnrolmentId){return(0,_ajax.call)([{methodname:"core_enrol_unenrol_user_enrolment",args:{ueid:userEnrolmentId}}])[0]};_exports.submitUserEnrolmentForm=function(formdata){return(0,_ajax.call)([{methodname:"core_enrol_submit_user_enrolment_form",args:{formdata:formdata}}])[0]};_exports.createNotesForUsers=function(notes){return(0,_ajax.call)([{methodname:"core_notes_create_notes",args:{notes:notes}}])[0]};_exports.sendMessagesToUsers=function(messages){return(0,_ajax.call)([{methodname:"core_message_send_instant_messages",args:{messages:messages}}])[0]}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/participants",["exports","core_table/dynamic","core/str","core/checkbox-toggleall","core/custom_interaction_events","core_table/local/dynamic/selectors","core/modal_events","core/notification","core/pending","jquery","core_user/local/participants/bulkactions"],(function(_exports,DynamicTable,Str,_checkboxToggleall,_custom_interaction_events,_selectors,_modal_events,_notification,_pending,_jquery,_bulkactions){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,DynamicTable=_interopRequireWildcard(DynamicTable),Str=_interopRequireWildcard(Str),_checkboxToggleall=_interopRequireDefault(_checkboxToggleall),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_selectors=_interopRequireDefault(_selectors),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending),_jquery=_interopRequireDefault(_jquery);var Selectors_bulkActionSelect="#formactionid",Selectors_bulkUserSelectedCheckBoxes="input[data-togglegroup='participants-table'][data-toggle='slave']:checked",Selectors_checkCountButton="#checkall",Selectors_showCountText='[data-region="participant-count"]',Selectors_showCountToggle='[data-action="showcount"]',Selectors_stateHelpIcon='[data-region="state-help-icon"]',Selectors_tableForm=function(uniqueId){return'form[data-table-unique-id="'.concat(uniqueId,'"]')};_exports.init=function(_ref){var uniqueid=_ref.uniqueid,_ref$noteStateNames=_ref.noteStateNames,noteStateNames=void 0===_ref$noteStateNames?{}:_ref$noteStateNames,root=document.querySelector(Selectors_tableForm(uniqueid)),getTableFromUniqueId=function(uniqueId){return root.querySelector(_selectors.default.main.fromRegionId(uniqueId))},resetBulkAction=function(bulkActionSelect){bulkActionSelect.value=""};_custom_interaction_events.default.define(Selectors_bulkActionSelect,[_custom_interaction_events.default.events.accessibleChange]),(0,_jquery.default)(Selectors_bulkActionSelect).on(_custom_interaction_events.default.events.accessibleChange,(function(e){var bulkActionSelect=e.target.closest("select"),action=bulkActionSelect.value,checkboxes=getTableFromUniqueId(uniqueid).querySelectorAll(Selectors_bulkUserSelectedCheckBoxes),pendingPromise=new _pending.default("core_user/participants:bulkActionSelect");if(-1!==action.indexOf("#")){e.preventDefault();var bulkAction,ids=[];if(checkboxes.forEach((function(checkbox){ids.push(checkbox.getAttribute("name").replace("user",""))})),"#messageselect"===action?bulkAction=(0,_bulkactions.showSendMessage)(ids):"#addgroupnote"===action&&(bulkAction=(0,_bulkactions.showAddNote)(root.dataset.courseId,ids,noteStateNames,root.querySelector(Selectors_stateHelpIcon))),bulkAction){var pendingBulkAction=new _pending.default("core_user/participants:bulkActionSelected");bulkAction.then((function(modal){return modal.getRoot().on(_modal_events.default.hidden,(function(){bulkActionSelect.focus()})),pendingBulkAction.resolve(),modal})).catch(_notification.default.exception)}}else""!==action&&checkboxes.length&&bulkActionSelect.form.submit();resetBulkAction(bulkActionSelect),pendingPromise.resolve()})),root.addEventListener("click",(function(e){var showCountLink=root.querySelector(Selectors_showCountToggle),checkCountButton=root.querySelector(Selectors_checkCountButton),showCountLinkClicked=showCountLink&&showCountLink.contains(e.target),checkCountButtonClicked=checkCountButton&&checkCountButton.contains(e.target);if(showCountLinkClicked||checkCountButtonClicked){e.preventDefault();var tableRoot=getTableFromUniqueId(uniqueid);DynamicTable.setPageSize(tableRoot,showCountLink.dataset.targetPageSize).then((function(tableRoot){return _checkboxToggleall.default.setGroupState(root,"participants-table",checkCountButtonClicked),tableRoot})).catch(_notification.default.exception)}})),root.addEventListener(DynamicTable.Events.tableContentRefreshed,(function(e){var showCountLink=root.querySelector(Selectors_showCountToggle),checkCountButton=root.querySelector(Selectors_checkCountButton),tableRoot=e.target,defaultPageSize=parseInt(root.dataset.tableDefaultPerPage,10),currentPageSize=parseInt(tableRoot.dataset.tablePageSize,10),totalRowCount=parseInt(tableRoot.dataset.tableTotalRows,10);_checkboxToggleall.default.updateSlavesFromMasterState(root,"participants-table");var pageCountStrings=[{key:"countparticipantsfound",component:"core_user",param:totalRowCount}];totalRowCount<=defaultPageSize?(showCountLink.classList.add("hidden"),checkCountButton&&checkCountButton.classList.add("hidden")):totalRowCount<=currentPageSize?(pageCountStrings.push({key:"showperpage",component:"core",param:defaultPageSize}),pageCountStrings.push({key:"selectalluserswithcount",component:"core",param:defaultPageSize}),showCountLink.classList.remove("hidden"),showCountLink.dataset.targetPageSize=defaultPageSize,checkCountButton&&checkCountButton.classList.add("hidden")):(pageCountStrings.push({key:"showall",component:"core",param:totalRowCount}),pageCountStrings.push({key:"selectalluserswithcount",component:"core",param:totalRowCount}),showCountLink.classList.remove("hidden"),showCountLink.dataset.targetPageSize=totalRowCount,checkCountButton&&checkCountButton.classList.remove("hidden")),Str.get_strings(pageCountStrings).then((function(_ref2){var _ref3=_slicedToArray(_ref2,3),showingParticipantCountString=_ref3[0],showCountString=_ref3[1],selectCountString=_ref3[2];root.querySelector(Selectors_showCountText).innerHTML=showingParticipantCountString,showCountString&&(showCountLink.innerHTML=showCountString),selectCountString&&checkCountButton&&(checkCountButton.value=selectCountString)})).catch(_notification.default.exception)}))}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/local/participantsfilter/filtertypes/keyword",["exports","../filter","core/str"],(function(_exports,_filter,_str){var obj;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=function(_Filter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(_default,_Filter);var Constructor,protoProps,staticProps,_super=_createSuper(_default);function _default(){return _classCallCheck(this,_default),_super.apply(this,arguments)}return Constructor=_default,(protoProps=[{key:"values",get:function(){return this.rawValues}},{key:"placeholder",get:function(){return(0,_str.get_string)("placeholdertype","core_user")}},{key:"showSuggestions",get:function(){return!1}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}((_filter=(obj=_filter)&&obj.__esModule?obj:{default:obj}).default);return _exports.default=_default,_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/local/participantsfilter/filtertypes/courseid",["exports","../filter"],(function(_exports,_filter){var obj;function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=function(_Filter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(_default,_Filter);var Constructor,protoProps,staticProps,fn,_addValueSelector,_super=_createSuper(_default);function _default(filterType,filterSet){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_default),_super.call(this,filterType,filterSet)}return Constructor=_default,protoProps=[{key:"addValueSelector",value:(fn=regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:case"end":return _context.stop()}}),_callee)})),_addValueSelector=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(){return _addValueSelector.apply(this,arguments)})},{key:"filterValue",get:function(){return{name:this.name,jointype:1,values:[parseInt(this.rootNode.dataset.tableCourseId,10)]}}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}((_filter=(obj=_filter)&&obj.__esModule?obj:{default:obj}).default);return _exports.default=_default,_exports.default}));
define("core_user/local/participantsfilter/filter",["exports","core/form-autocomplete","./selectors","core/str"],(function(_exports,_formAutocomplete,_selectors,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_formAutocomplete=_interopRequireDefault(_formAutocomplete),_selectors=_interopRequireDefault(_selectors);var _default=function(){function _default(filterType,rootNode,initialValues){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_default),this.filterType=filterType,this.rootNode=rootNode,this.addValueSelector(initialValues)}var Constructor,protoProps,staticProps,fn,_addValueSelector;return Constructor=_default,protoProps=[{key:"tearDown",value:function(){}},{key:"placeholder",get:function(){return(0,_str.get_string)("placeholdertypeorselect","core_user")}},{key:"showSuggestions",get:function(){return!0}},{key:"addValueSelector",value:(fn=regeneratorRuntime.mark((function _callee(){var initialValues,filterValueNode,dataSource,filterValueLabel,_this=this,_args=arguments;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return initialValues=_args.length>0&&void 0!==_args[0]?_args[0]:[],(filterValueNode=this.getFilterValueNode()).innerHTML=this.getSourceDataForFilter().outerHTML,(dataSource=filterValueNode.querySelector("select")).id="filter-value-"+dataSource.getAttribute("data-field-name"),(filterValueLabel=document.createElement("label")).setAttribute("for",dataSource.id),filterValueLabel.classList.add("sr-only"),filterValueLabel.innerText=dataSource.getAttribute("data-field-title"),filterValueNode.appendChild(filterValueLabel),initialValues.forEach((function(filterValue){var selectedOption=dataSource.querySelector('option[value="'.concat(filterValue,'"]'));selectedOption?selectedOption.selected=!0:_this.showSuggestions||((selectedOption=document.createElement("option")).value=filterValue,selectedOption.innerHTML=filterValue,selectedOption.selected=!0,dataSource.append(selectedOption))})),_context.t0=_formAutocomplete.default,_context.t1=dataSource,_context.t2="1"==dataSource.dataset.allowCustom,_context.next=16,this.placeholder;case 16:_context.t3=_context.sent,_context.t4=this.showSuggestions,_context.t5=!dataSource.multiple,_context.t6={items:"core_user/local/participantsfilter/autocomplete_selection_items",layout:"core_user/local/participantsfilter/autocomplete_layout",selection:"core_user/local/participantsfilter/autocomplete_selection"},_context.t0.enhance.call(_context.t0,_context.t1,_context.t2,null,_context.t3,!1,_context.t4,null,_context.t5,_context.t6);case 21:case"end":return _context.stop()}}),_callee,this)})),_addValueSelector=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(){return _addValueSelector.apply(this,arguments)})},{key:"filterRoot",get:function(){return this.rootNode.querySelector(_selectors.default.filter.byName(this.filterType))}},{key:"getSourceDataForFilter",value:function(){return this.rootNode.querySelector(_selectors.default.filterset.regions.datasource).querySelector(_selectors.default.data.fields.byName(this.filterType))}},{key:"getFilterValueNode",value:function(){return this.filterRoot.querySelector(_selectors.default.filter.regions.values)}},{key:"name",get:function(){return this.filterType}},{key:"jointype",get:function(){return parseInt(this.filterRoot.querySelector(_selectors.default.filter.fields.join).value,10)}},{key:"rawValues",get:function(){var select,filterValueSelect=this.getFilterValueNode().querySelector("select");return Object.values((select=filterValueSelect,select.querySelectorAll(":checked"))).map((function(option){return option.value}))}},{key:"values",get:function(){return this.rawValues.map((function(option){return parseInt(option,10)}))}},{key:"filterValue",get:function(){return{name:this.name,jointype:this.jointype,values:this.values}}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}();return _exports.default=_default,_exports.default}));
define("core_user/local/participantsfilter/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Module containing the selectors for user filters.
   *
   * @module     core_user/local/user_filter/selectors
   * @package    core_user
   * @copyright  2020 Michael Hawkins <michaelh@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var getFilterRegion=function(region){return'[data-filterregion="'.concat(region,'"]')},getFilterAction=function(action){return'[data-filteraction="'.concat(action,'"]')},getFilterField=function(field){return'[data-filterfield="'.concat(field,'"]')},_default={filter:{region:getFilterRegion("filter"),actions:{remove:getFilterAction("remove")},fields:{join:getFilterField("join"),type:getFilterField("type")},regions:{values:getFilterRegion("value")},byName:function(name){return"".concat(getFilterRegion("filter"),'[data-filter-type="').concat(name,'"]')}},filterset:{region:getFilterRegion("actions"),actions:{addRow:getFilterAction("add"),applyFilters:getFilterAction("apply"),resetFilters:getFilterAction("reset")},regions:{filtermatch:getFilterRegion("filtermatch"),filterlist:getFilterRegion("filters"),datasource:getFilterRegion("filtertypedata")},fields:{join:"".concat(getFilterRegion("filtermatch")," ").concat(getFilterField("join"))}},data:{fields:{byName:function(name){return'[data-field-name="'.concat(name,'"]')},all:"".concat(getFilterRegion("filtertypedata")," [data-field-name]")},typeList:getFilterRegion("filtertypelist"),typeListSelect:"select".concat(getFilterRegion("filtertypelist"))}};return _exports.default=_default,_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/local/participants/bulkactions",["exports","core_user/repository","core/str","core/modal_events","core/modal_factory","core/notification","core/templates","core/toast"],(function(_exports,Repository,Str,_modal_events,_modal_factory,_notification,_templates,_toast){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}
/**
   * Bulk actions for lists of participants.
   *
   * @module     core_user/local/participants/bulkactions
   * @package    core_user
   * @copyright  2020 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.showSendMessage=_exports.showAddNote=void 0,Repository=_interopRequireWildcard(Repository),Str=_interopRequireWildcard(Str),_modal_events=_interopRequireDefault(_modal_events),_modal_factory=_interopRequireDefault(_modal_factory),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);_exports.showAddNote=function(courseid,users,noteStateNames,stateHelpIcon){if(!users.length)return Promise.resolve();var states=[];for(var key in noteStateNames)switch(key){case"draft":states.push({value:"personal",label:noteStateNames[key]});break;case"public":states.push({value:"course",label:noteStateNames[key],selected:1});break;case"site":states.push({value:key,label:noteStateNames[key]})}var context={stateNames:states,stateHelpIcon:stateHelpIcon.innerHTML},titlePromise=null;return titlePromise=1===users.length?Str.get_string("addbulknotesingle","core_notes"):Str.get_string("addbulknote","core_notes",users.length),_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:_templates.default.render("core_user/add_bulk_note",context),title:titlePromise,buttons:{save:titlePromise},removeOnClose:!0}).then((function(modal){return modal.getRoot().on(_modal_events.default.save,(function(){return submitAddNote(courseid,users,modal)})),modal.show(),modal}))};var submitAddNote=function(courseid,users,modal){var text=modal.getRoot().find("form textarea").val(),publishstate=modal.getRoot().find("form select").val(),notes=users.map((function(userid){return{userid:userid,text:text,courseid:courseid,publishstate:publishstate}}));return Repository.createNotesForUsers(notes).then((function(noteIds){return 1===noteIds.length?Str.get_string("addbulknotedonesingle","core_notes"):Str.get_string("addbulknotedone","core_notes",noteIds.length)})).then((function(msg){return(0,_toast.add)(msg)})).catch(_notification.default.exception)};_exports.showSendMessage=function(users){return users.length?(titlePromise=1===users.length?Str.get_string("sendbulkmessagesingle","core_message"):Str.get_string("sendbulkmessage","core_message",users.length),_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:_templates.default.render("core_user/send_bulk_message",{}),title:titlePromise,buttons:{save:titlePromise},removeOnClose:!0}).then((function(modal){return modal.getRoot().on(_modal_events.default.save,(function(e){var text=modal.getRoot().find("form textarea").val();if(""===text.trim())return modal.getRoot().find('[data-role="messagetextrequired"]').removeAttr("hidden"),void e.preventDefault();submitSendMessage(modal,users,text)})),modal.show(),modal}))):Promise.resolve();var titlePromise};var submitSendMessage=function(modal,users,text){var messages=users.map((function(touserid){return{touserid:touserid,text:text}}));return Repository.sendMessagesToUsers(messages).then((function(messageIds){return 1==messageIds.length?Str.get_string("sendbulkmessagesentsingle","core_message"):Str.get_string("sendbulkmessagesent","core_message",messageIds.length)})).then((function(msg){return(0,_toast.add)(msg)})).catch(_notification.default.exception)}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/status_field",["exports","core_table/dynamic","./repository","core/str","core_table/local/dynamic/selectors","core/fragment","core/modal_events","core/modal_factory","core/notification","core/templates","core/toast"],(function(_exports,DynamicTable,Repository,Str,_selectors,_fragment,_modal_events,_modal_factory,_notification,_templates,_toast){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,DynamicTable=_interopRequireWildcard(DynamicTable),Repository=_interopRequireWildcard(Repository),Str=_interopRequireWildcard(Str),_selectors=_interopRequireDefault(_selectors),_fragment=_interopRequireDefault(_fragment),_modal_events=_interopRequireDefault(_modal_events),_modal_factory=_interopRequireDefault(_modal_factory),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);var Selectors_editEnrolment='[data-action="editenrolment"]',Selectors_showDetails='[data-action="showdetails"]',Selectors_unenrol='[data-action="unenrol"]',Selectors_statusElement="[data-status]",getDynamicTableFromLink=function(link){return link.closest(_selectors.default.main.region)},getStatusContainer=function(link){return link.closest(Selectors_statusElement)},getUserEnrolmentIdFromLink=function(link){return link.getAttribute("rel")},showEditDialogue=function(link,getBody){var container=getStatusContainer(link),userEnrolmentId=getUserEnrolmentIdFromLink(link);_modal_factory.default.create({large:!0,title:Str.get_string("edituserenrolment","enrol",container.dataset.fullname),type:_modal_factory.default.types.SAVE_CANCEL,body:getBody(userEnrolmentId)}).then((function(modal){return modal.getRoot().on(_modal_events.default.save,(function(e){e.preventDefault(),submitEditFormAjax(link,getBody,modal,userEnrolmentId,container.dataset)})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show(),modal})).catch(_notification.default.exception)},showUnenrolConfirmation=function(link){var container=getStatusContainer(link),userEnrolmentId=getUserEnrolmentIdFromLink(link);_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL}).then((function(modal){modal.getRoot().on(_modal_events.default.save,(function(e){e.preventDefault(),submitUnenrolFormAjax(link,modal,{ueid:userEnrolmentId},container.dataset)})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show();var stringData=[{key:"unenrol",component:"enrol"},{key:"unenrolconfirm",component:"enrol",param:{user:container.dataset.fullname,course:container.dataset.coursename,enrolinstancename:container.dataset.enrolinstancename}}];return Promise.all([Str.get_strings(stringData),modal])})).then((function(_ref){var _ref2=_slicedToArray(_ref,2),strings=_ref2[0],modal=_ref2[1];return modal.setTitle(strings[0]),modal.setSaveButtonText(strings[0]),modal.setBody(strings[1]),modal})).catch(_notification.default.exception)},showStatusDetails=function(link){var container=getStatusContainer(link),context=function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({editenrollink:"",statusclass:container.querySelector("span.badge").getAttribute("class")},container.dataset),editEnrolLink=container.querySelector(Selectors_editEnrolment);editEnrolLink&&(context.editenrollink=editEnrolLink.outerHTML),_modal_factory.default.create({large:!0,type:_modal_factory.default.types.CANCEL,title:Str.get_string("enroldetails","enrol"),body:_templates.default.render("core_user/status_details",context)}).then((function(modal){return editEnrolLink&&modal.getRoot().on("click",Selectors_editEnrolment,(function(e){e.preventDefault(),modal.hide(),editEnrolLink.click()})),modal.show(),modal.getRoot().on(_modal_events.default.hidden,(function(){return modal.destroy()})),modal})).catch(_notification.default.exception)},submitEditFormAjax=function(clickedLink,getBody,modal,userEnrolmentId,userData){var form=modal.getRoot().find("form");Repository.submitUserEnrolmentForm(form.serialize()).then((function(data){if(!data.result)throw data.result;return modal.hide(),modal.destroy(),data})).then((function(){return DynamicTable.refreshTableContent(getDynamicTableFromLink(clickedLink)).catch(_notification.default.exception),Str.get_string("enrolmentupdatedforuser","core_enrol",userData)})).then((function(notificationString){(0,_toast.add)(notificationString)})).catch((function(){return modal.setBody(getBody(userEnrolmentId,JSON.stringify(form.serialize()))),modal}))},submitUnenrolFormAjax=function(clickedLink,modal,args,userData){Repository.unenrolUser(args.ueid).then((function(data){return data.result?(modal.hide(),modal.destroy(),data):(_notification.default.alert(data.errors[0].key,data.errors[0].message),data)})).then((function(){return DynamicTable.refreshTableContent(getDynamicTableFromLink(clickedLink)).catch(_notification.default.exception),Str.get_string("unenrolleduser","core_enrol",userData)})).then((function(notificationString){(0,_toast.add)(notificationString)})).catch(_notification.default.exception)},getBody=function(contextId,ueid){var formdata=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return _fragment.default.loadFragment("enrol","user_enrolment_form",contextId,{ueid:ueid,formdata:formdata})};_exports.init=function(_ref3){var contextId,uniqueId,getBodyFunction,contextid=_ref3.contextid,uniqueid=_ref3.uniqueid;contextId=contextid,uniqueId=uniqueid,getBodyFunction=function(userEnrolmentId,formData){return getBody(contextId,userEnrolmentId,formData)},document.addEventListener("click",(function(e){if(e.target.closest(_selectors.default.main.fromRegionId(uniqueId))){var editLink=e.target.closest(Selectors_editEnrolment);editLink&&(e.preventDefault(),showEditDialogue(editLink,getBodyFunction));var unenrolLink=e.target.closest(Selectors_unenrol);unenrolLink&&(e.preventDefault(),showUnenrolConfirmation(unenrolLink));var showDetailsLink=e.target.closest(Selectors_showDetails);showDetailsLink&&(e.preventDefault(),showStatusDetails(showDetailsLink))}}))}}));
/**
 * Unified filter page JS module for the course participants page.
 *
 * @deprecated since Moodle 3.9 MDL-68612 - user unified filter replaced by participants filter.
 * @module     core_user/unified_filter
 * @package    core_user
 * @copyright  2017 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_user/unified_filter",["jquery","core/form-autocomplete","core/str","core/notification"],(function($,Autocomplete,Str,Notification){var SELECTORS_UNIFIED_FILTERS="#unified-filters";return{init:function(){!function(){M.util.js_pending("unified_filter_datasource"),Str.get_strings([{key:"userfilterplaceholder",component:"moodle"},{key:"nofiltersapplied",component:"moodle"}]).done((function(langstrings){var placeholder=langstrings[0],noSelectionString=langstrings[1];Autocomplete.enhance(SELECTORS_UNIFIED_FILTERS,!0,"core_user/unified_filter_datasource",placeholder,!1,!0,noSelectionString,!0).then((function(){M.util.js_complete("unified_filter_datasource")})).fail(Notification.exception)})).fail(Notification.exception);var last=$(SELECTORS_UNIFIED_FILTERS).val();$(SELECTORS_UNIFIED_FILTERS).on("change",(function(){var current=$(this).val(),listoffilters=[],textfilters=[],updatedselectedfilters=!1;if($.each(current,(function(index,catoption){var catandoption=catoption.split(":",2);if(2!==catandoption.length)return textfilters.push(catoption),!0;var category=catandoption[0],option=catandoption[1];return void 0!==listoffilters[category]&&(updatedselectedfilters=!0),listoffilters[category]=option,!0})),updatedselectedfilters){var updatefilters=[];for(var category in listoffilters)updatefilters.push(category+":"+listoffilters[category]);updatefilters=updatefilters.concat(textfilters),$(this).val(updatefilters)}last.join(",")!=current.join(",")&&this.form.submit()}))}()},getForm:function(){return $(SELECTORS_UNIFIED_FILTERS).closest("form")}}}));
/**
 * Datasource for the core_user/unified_filter.
 * @deprecated since Moodle 3.9 MDL-68612 - user unified filter replaced by participants filter.
 *
 * This module is compatible with core/form-autocomplete.
 *
 * @package    core_user
 * @copyright  2017 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_user/unified_filter_datasource",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{list:function(selector,query){var filteredOptions=[],el=$(selector),originalOptions=$(selector).data("originaloptionsjson"),selectedFilters=el.val();$.each(originalOptions,(function(index,option){return""!==query.trim()&&-1===option.label.toLocaleLowerCase().indexOf(query.toLocaleLowerCase())||$.inArray(option.value,selectedFilters)>-1||filteredOptions.push(option),!0}));var deferred=new $.Deferred;return deferred.resolve(filteredOptions),deferred.promise()},processResults:function(selector,results){var options=[];return $.each(results,(function(index,data){options.push({value:data.value,label:data.label})})),options},transport:function(selector,query,callback){this.list(selector,query).then(callback).catch(Notification.exception)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/participantsfilter",["exports","./local/participantsfilter/filtertypes/courseid","core_table/dynamic","./local/participantsfilter/filter","core/str","core/notification","core/pending","./local/participantsfilter/selectors","core/templates","core/custom_interaction_events","jquery"],(function(_exports,_courseid,DynamicTable,_filter,_str,_notification,_pending,_selectors,_templates,_custom_interaction_events,_jquery){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_courseid=_interopRequireDefault(_courseid),DynamicTable=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(DynamicTable),_filter=_interopRequireDefault(_filter),_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending),_selectors=_interopRequireDefault(_selectors),_templates=_interopRequireDefault(_templates),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_jquery=_interopRequireDefault(_jquery);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}_exports.init=function(participantsRegionId){var _ref2,_ref3,_ref9,filterSet=document.querySelector("#".concat(participantsRegionId)),activeFilters={courseid:new _courseid.default("courseid",filterSet)},getFilterRegion=function(){return filterSet.querySelector(_selectors.default.filterset.regions.filterlist)},addFilterRow=function(){var pendingPromise=new _pending.default("core_user/participantsfilter:addFilterRow"),rownum=1+getFilterRegion().querySelectorAll(_selectors.default.filter.region).length;return _templates.default.renderForPromise("core_user/local/participantsfilter/filterrow",{rownumber:rownum}).then((function(_ref){var html=_ref.html,js=_ref.js;return _templates.default.appendNodeContents(getFilterRegion(),html,js)})).then((function(filterRow){var typeList=filterSet.querySelector(_selectors.default.data.typeList);return filterRow.forEach((function(contentNode){var contentTypeList=contentNode.querySelector(_selectors.default.filter.fields.type);contentTypeList&&(contentTypeList.innerHTML=typeList.innerHTML)})),filterRow})).then((function(filterRow){return updateFiltersOptions(),filterRow})).then((function(result){return pendingPromise.resolve(),result})).catch(_notification.default.exception)},getFilterDataSource=function(filterType){return filterSet.querySelector(_selectors.default.filterset.regions.datasource).querySelector(_selectors.default.data.fields.byName(filterType))},addFilter=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee(filterRow,filterType,initialFilterValues){var filterDataNode,Filter,typeField;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(filterRow.dataset.filterType=filterType,filterDataNode=getFilterDataSource(filterType),Filter=_filter.default,!filterDataNode.dataset.filterTypeClass){_context.next=7;break}return _context.next=6,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require([filterDataNode.dataset.filterTypeClass],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require(filterDataNode.dataset.filterTypeClass)):Promise.resolve(_systemImportTransformerGlobalIdentifier[filterDataNode.dataset.filterTypeClass]);case 6:Filter=_context.sent;case 7:return activeFilters[filterType]=new Filter(filterType,filterSet,initialFilterValues),(typeField=filterRow.querySelector(_selectors.default.filter.fields.type)).value=filterType,typeField.disabled="disabled",updateFiltersOptions(),_context.abrupt("return",activeFilters[filterType]);case 13:case"end":return _context.stop()}}),_callee)}))),function(_x,_x2,_x3){return _ref2.apply(this,arguments)}),removeOrReplaceFilterRow=function(filterRow,refreshContent){1===getFilterRegion().querySelectorAll(_selectors.default.filter.region).length?replaceFilterRow(filterRow,refreshContent):removeFilterRow(filterRow,refreshContent)},removeFilterRow=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(filterRow){var refreshContent,filterType,hasFilterValue,filterLegends,_args2=arguments;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return refreshContent=!(_args2.length>1&&void 0!==_args2[1])||_args2[1],filterType=filterRow.querySelector(_selectors.default.filter.fields.type),hasFilterValue=!!filterType.value,removeFilterObject(filterRow.dataset.filterType),filterRow.remove(),updateFiltersOptions(),hasFilterValue&&refreshContent&&updateTableFromFilter(),_context2.next=9,getAvailableFilterLegends();case 9:filterLegends=_context2.sent,getFilterRegion().querySelectorAll(_selectors.default.filter.region).forEach((function(filterRow,index){filterRow.querySelector("legend").innerText=filterLegends[index]}));case 11:case"end":return _context2.stop()}}),_callee2)}))),function(_x4){return _ref3.apply(this,arguments)}),replaceFilterRow=function(filterRow){var refreshContent=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],rowNum=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return removeFilterObject(filterRow.dataset.filterType),_templates.default.renderForPromise("core_user/local/participantsfilter/filterrow",{rownumber:rowNum}).then((function(_ref4){var html=_ref4.html,js=_ref4.js;return _templates.default.replaceNode(filterRow,html,js)})).then((function(filterRow){var typeList=filterSet.querySelector(_selectors.default.data.typeList);return filterRow.forEach((function(contentNode){var contentTypeList=contentNode.querySelector(_selectors.default.filter.fields.type);contentTypeList&&(contentTypeList.innerHTML=typeList.innerHTML)})),filterRow})).then((function(filterRow){return updateFiltersOptions(),filterRow})).then((function(filterRow){return refreshContent?updateTableFromFilter():filterRow})).catch(_notification.default.exception)},removeFilterObject=function(filterName){if(filterName){var filter=activeFilters[filterName];filter&&(filter.tearDown(),delete activeFilters[filterName])}},updateFiltersOptions=function(){var filters=getFilterRegion().querySelectorAll(_selectors.default.filter.region);filters.forEach((function(filterRow){filterRow.querySelectorAll(_selectors.default.filter.fields.type+" option").forEach((function(option){option.value===filterRow.dataset.filterType?(option.classList.remove("hidden"),option.disabled=!1):activeFilters[option.value]?(option.classList.add("hidden"),option.disabled=!0):(option.classList.remove("hidden"),option.disabled=!1)}))}));var addRowButton=filterSet.querySelector(_selectors.default.filterset.actions.addRow);filterSet.querySelectorAll(_selectors.default.data.fields.all).length<=filters.length?addRowButton.setAttribute("disabled","disabled"):addRowButton.removeAttribute("disabled"),1===filters.length?(filterSet.querySelector(_selectors.default.filterset.regions.filtermatch).classList.add("hidden"),filterSet.querySelector(_selectors.default.filterset.fields.join).value=1,filterSet.dataset.filterverb=1):filterSet.querySelector(_selectors.default.filterset.regions.filtermatch).classList.remove("hidden")},updateTableFromFilter=function(){var pendingPromise=new _pending.default("core_user/participantsfilter:updateTableFromFilter"),filters={};return Object.values(activeFilters).forEach((function(filter){filters[filter.filterValue.name]=filter.filterValue})),DynamicTable.setFilters(DynamicTable.getTableFromId(filterSet.dataset.tableRegion),{jointype:parseInt(filterSet.querySelector(_selectors.default.filterset.fields.join).value,10),filters:filters}).then((function(result){return pendingPromise.resolve(),result})).catch(_notification.default.exception)},getAvailableFilterLegends=(_ref9=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var maxFilters,requests,legendStrings;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return maxFilters=document.querySelector(_selectors.default.data.typeListSelect).length-1,requests=[],_toConsumableArray(Array(maxFilters)).forEach((function(_,rowIndex){requests.push({key:"filterrowlegend",component:"core_user",param:rowIndex+1})})),_context3.next=5,(0,_str.get_strings)(requests).then((function(fetchedStrings){return fetchedStrings})).catch(_notification.default.exception);case 5:return legendStrings=_context3.sent,_context3.abrupt("return",legendStrings);case 7:case"end":return _context3.stop()}}),_callee3)}))),function(){return _ref9.apply(this,arguments)});filterSet.querySelector(_selectors.default.filterset.region).addEventListener("click",(function(e){var pendingPromise;e.target.closest(_selectors.default.filterset.actions.addRow)&&(e.preventDefault(),addFilterRow()),e.target.closest(_selectors.default.filterset.actions.applyFilters)&&(e.preventDefault(),updateTableFromFilter()),e.target.closest(_selectors.default.filterset.actions.resetFilters)&&(e.preventDefault(),pendingPromise=new _pending.default("core_user/participantsfilter:setFilterFromConfig"),getFilterRegion().querySelectorAll(_selectors.default.filter.region).forEach((function(filterRow){return removeOrReplaceFilterRow(filterRow,!1)})),updateTableFromFilter().then((function(result){return pendingPromise.resolve(),result})))})),filterSet.querySelector(_selectors.default.filterset.regions.filterlist).addEventListener("click",(function(e){e.target.closest(_selectors.default.filter.actions.remove)&&(e.preventDefault(),removeOrReplaceFilterRow(e.target.closest(_selectors.default.filter.region),!0))}));var filterRegion=(0,_jquery.default)(getFilterRegion());_custom_interaction_events.default.define(filterRegion,[_custom_interaction_events.default.events.accessibleChange]),filterRegion.on(_custom_interaction_events.default.events.accessibleChange,(function(e){var typeField=e.target.closest(_selectors.default.filter.fields.type);if(typeField&&typeField.value){var filter=e.target.closest(_selectors.default.filter.region);addFilter(filter,typeField.value)}})),filterSet.querySelector(_selectors.default.filterset.fields.join).addEventListener("change",(function(e){filterSet.dataset.filterverb=e.target.value}));var tableRoot=DynamicTable.getTableFromId(filterSet.dataset.tableRegion),initialFilters=DynamicTable.getFilters(tableRoot);if(initialFilters){var initialFilterPromise=new _pending.default("core_user/participantsfilter:setFilterFromConfig");(function(config){var filterConfig=Object.entries(config.filters);if(!filterConfig.length)return Promise.resolve();filterSet.querySelector(_selectors.default.filterset.fields.join).value=config.jointype;var filterPromises=filterConfig.map((function(_ref5){var _ref6=_slicedToArray(_ref5,2),filterType=_ref6[0],filterData=_ref6[1];if("courseid"===filterType)return!1;var filterValues=filterData.values;return!!filterValues.length&&addFilterRow().then((function(_ref7){var filterRow=_slicedToArray(_ref7,1)[0];return addFilter(filterRow,filterType,filterValues)}))})).filter((function(promise){return promise}));return filterPromises.length?Promise.all(filterPromises).then((function(){getFilterRegion().querySelectorAll(_selectors.default.filter.region).forEach((function(filterRow){filterRow.querySelector(_selectors.default.filter.fields.type).value||removeOrReplaceFilterRow(filterRow,!1)}))})).then(updateFiltersOptions).then(updateTableFromFilter):Promise.resolve()})(initialFilters).then((function(){return initialFilterPromise.resolve()})).catch()}}}));
/*
 * JavaScript to allow dragging options to slots (using mouse down or touch) or tab through slots using keyboard.
 *
 * @module     qtype_ddimageortext/form
 * @package    qtype_ddimageortext
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_ddimageortext/form",["jquery","core/dragdrop"],(function($,dragDrop){var dragDropToImageForm={maxBgImageSize:null,maxDragImageSize:null,fp:null,init:function(){dragDropToImageForm.fp=dragDropToImageForm.filePickers(),$("#id_previewareaheader").append('<div class="ddarea que ddimageortext">  <div class="droparea">    <img class="dropbackground" />    <div class="dropzones"></div>  </div>  <div class="dragitems"></div></div>'),dragDropToImageForm.updateVisibilityOfFilePickers(),dragDropToImageForm.setOptionsForDragItemSelectors(),dragDropToImageForm.setupEventHandlers(),dragDropToImageForm.waitForFilePickerToInitialise()},waitForFilePickerToInitialise:function(){null!==dragDropToImageForm.fp.file("bgimage").href?(M.util.js_pending("dragDropToImageForm"),$("form.mform").on("change",".filepickerhidden",(function(){M.util.js_pending("dragDropToImageForm"),dragDropToImageForm.loadPreviewImage()})),dragDropToImageForm.loadPreviewImage()):setTimeout(dragDropToImageForm.waitForFilePickerToInitialise,1e3)},loadPreviewImage:function(){$("fieldset#id_previewareaheader .dropbackground").one("load",dragDropToImageForm.afterPreviewImageLoaded).attr("src",dragDropToImageForm.fp.file("bgimage").href)},afterPreviewImageLoaded:function(){dragDropToImageForm.createDropZones(),M.util.js_complete("dragDropToImageForm")},createDropZones:function(){var dropZoneHolder=$(".dropzones");if(dropZoneHolder.empty(),null!==dragDropToImageForm.fp.file("bgimage").href){for(var numDrops=dragDropToImageForm.form.getFormValue("nodropzone",[]),dropNo=0;dropNo<numDrops;dropNo++){var dragNo=dragDropToImageForm.form.getFormValue("drops",[dropNo,"choice"]);if("0"!==dragNo){dragNo-=1;var group=dragDropToImageForm.form.getFormValue("drags",[dragNo,"draggroup"]),label=dragDropToImageForm.form.getFormValue("draglabel",[dragNo]);if("image"===dragDropToImageForm.form.getFormValue("drags",[dragNo,"dragitemtype"])){var imgUrl=dragDropToImageForm.fp.file("dragitem["+dragNo+"]").href;if(null===imgUrl)continue;dropZoneHolder.append('<img class="droppreview group'+group+" drop"+dropNo+'" src="'+imgUrl+'" alt="'+label+'" data-drop-no="'+dropNo+'">')}else""!==label&&dropZoneHolder.append('<div class="droppreview group'+group+" drop"+dropNo+'"  data-drop-no="'+dropNo+'">'+label+"</div>")}}dragDropToImageForm.waitForAllDropImagesToBeLoaded()}},waitForAllDropImagesToBeLoaded:function(){$(".dropzones img").not((function(i,imgNode){return dragDropToImageForm.imageIsLoaded(imgNode)})).length>0?setTimeout((function(){dragDropToImageForm.waitForAllDropImagesToBeLoaded()}),100):dragDropToImageForm.updateDropZones()},imageIsLoaded:function(imgElement){return imgElement.complete&&0!==imgElement.naturalHeight},updateDropZones:function(){if(null!==dragDropToImageForm.fp.file("bgimage").href){for(var dropBackgroundPosition=$("fieldset#id_previewareaheader .dropbackground").offset(),numDrops=dragDropToImageForm.form.getFormValue("nodropzone",[]),dropNo=0;dropNo<numDrops;dropNo++){var drop=$(".dropzones .drop"+dropNo);if(0!==drop.length){var dragNo=dragDropToImageForm.form.getFormValue("drops",[dropNo,"choice"])-1;drop.offset({left:dropBackgroundPosition.left+parseInt(dragDropToImageForm.form.getFormValue("drops",[dropNo,"xleft"])),top:dropBackgroundPosition.top+parseInt(dragDropToImageForm.form.getFormValue("drops",[dropNo,"ytop"]))});var label=dragDropToImageForm.form.getFormValue("draglabel",[dragNo]);drop.is("img")?drop.attr("alt",label):drop.html(label)}}$(".dropzones .droppreview").css("padding","0");for(var numGroups=$(".draggroup select").first().find("option").length,group=1;group<=numGroups;group++)dragDropToImageForm.resizeAllDragsAndDropsInGroup(group)}},resizeAllDragsAndDropsInGroup:function(group){var drops=$(".dropzones .droppreview.group"+group),maxWidth=0,maxHeight=0;drops.each((function(i,drop){maxWidth=Math.max(maxWidth,Math.ceil(drop.offsetWidth)),maxHeight=Math.max(maxHeight,Math.ceil(drop.offsetHeight))})),maxWidth+=10,maxHeight+=10,drops.each((function(i,drop){var left=Math.round((maxWidth-drop.offsetWidth)/2),top=Math.floor((maxHeight-drop.offsetHeight)/2);$(drop).css({"padding-left":left+"px","padding-right":maxWidth-drop.offsetWidth-left+"px","padding-top":top+"px","padding-bottom":maxHeight-drop.offsetHeight-top+"px"})}))},setupEventHandlers:function(){$("fieldset#id_draggableitemheader").on("change input","input, select",(function(e){var input=$(e.target).closest("select, input");input.hasClass("dragitemtype")&&dragDropToImageForm.updateVisibilityOfFilePickers(),dragDropToImageForm.setOptionsForDragItemSelectors(),input.is(".dragitemtype, .draggroup")?dragDropToImageForm.createDropZones():input.is(".draglabel")&&dragDropToImageForm.updateDropZones()})),$("fieldset#id_dropzoneheader").on("change input","input, select",(function(e){$(e.target).closest("select, input").is("select")?dragDropToImageForm.createDropZones():dragDropToImageForm.updateDropZones()})),$("fieldset#id_previewareaheader").on("mousedown touchstart",".droppreview",(function(e){dragDropToImageForm.dragStart(e)})),$(window).on("resize",(function(){dragDropToImageForm.updateDropZones()}))},updateVisibilityOfFilePickers:function(){for(var numDrags=dragDropToImageForm.form.getFormValue("noitems",[]),dragNo=0;dragNo<numDrags;dragNo++){var picker=$("input#id_dragitem_"+dragNo).closest(".fitem_ffilepicker");"image"===dragDropToImageForm.form.getFormValue("drags",[dragNo,"dragitemtype"])?picker.show():picker.hide()}},setOptionsForDragItemSelectors:function(){for(var dragItemOptions={0:""},numDrags=dragDropToImageForm.form.getFormValue("noitems",[]),numDrops=dragDropToImageForm.form.getFormValue("nodropzone",[]),dragNo=0;dragNo<numDrags;dragNo++){var label=dragDropToImageForm.form.getFormValue("draglabel",[dragNo]),file=dragDropToImageForm.fp.file(dragDropToImageForm.form.toNameWithIndex("dragitem",[dragNo]));"image"===dragDropToImageForm.form.getFormValue("drags",[dragNo,"dragitemtype"])&&null!==file.name?dragItemOptions[dragNo+1]=dragNo+1+". "+label+" ("+file.name+")":""!==label&&(dragItemOptions[dragNo+1]=dragNo+1+". "+label)}for(var dropNo=0;dropNo<numDrops;dropNo++){var selector=$("#id_drops_"+dropNo+"_choice"),selectedvalue=selector.val();for(var value in selector.find("option").remove(),dragItemOptions)if(dragItemOptions.hasOwnProperty(value)){selector.append('<option value="'+value+'">'+dragItemOptions[value]+"</option>");var optionnode=selector.find('option[value="'+value+'"]');parseInt(value)===parseInt(selectedvalue)?optionnode.attr("selected",!0):dragDropToImageForm.isItemUsed(parseInt(value))&&optionnode.attr("disabled",!0)}}},isItemUsed:function(value){return 0!==value&&(!dragDropToImageForm.form.getFormValue("drags",[value-1,"infinite"])&&0!==$("fieldset#id_dropzoneheader select").filter((function(i,selectNode){return parseInt($(selectNode).val())===value})).length)},dragStart:function(e){var drop=$(e.target).closest(".droppreview");dragDrop.prepare(e).start&&dragDrop.start(e,drop,(function(x,y,drop){dragDropToImageForm.dragMove(drop)}),(function(){dragDropToImageForm.dragEnd()}))},dragMove:function(drop){var backgroundImage=$("fieldset#id_previewareaheader .dropbackground"),backgroundPosition=backgroundImage.offset(),dropNo=drop.data("dropNo"),dropPosition=drop.offset(),left=Math.round(dropPosition.left-backgroundPosition.left),top=Math.round(dropPosition.top-backgroundPosition.top);left=Math.round(Math.max(0,Math.min(left,backgroundImage.outerWidth()-drop.outerWidth()))),top=Math.round(Math.max(0,Math.min(top,backgroundImage.outerHeight()-drop.outerHeight()))),dragDropToImageForm.form.setFormValue("drops",[dropNo,"xleft"],left),dragDropToImageForm.form.setFormValue("drops",[dropNo,"ytop"],top)},dragEnd:function(){dragDropToImageForm.updateDropZones()},form:{toNameWithIndex:function(name,indexes){for(var indexString=name,i=0;i<indexes.length;i++)indexString=indexString+"["+indexes[i]+"]";return indexString},getEl:function(name,indexes){return $("form.mform")[0].elements[this.toNameWithIndex(name,indexes)]},getFormValue:function(name,indexes){var el=this.getEl(name,indexes);return el.type||(el=el[el.length-1]),"checkbox"===el.type?el.checked:el.value},setFormValue:function(name,indexes,value){var el=this.getEl(name,indexes);"checkbox"===el.type?el.checked=value:el.value=value}},filePickers:function(){var draftItemIdsToName,nameToParentNode;void 0===draftItemIdsToName&&(draftItemIdsToName={},nameToParentNode={},$("form.mform input.filepickerhidden").each((function(index,filepicker){draftItemIdsToName[filepicker.value]=filepicker.name,nameToParentNode[filepicker.name]=filepicker.parentNode})));return{file:function(name){var fileAnchor=$(nameToParentNode[name]).find("div.filepicker-filelist a");return fileAnchor.length?{href:fileAnchor.get(0).href,name:fileAnchor.get(0).innerHTML}:{href:null,name:null}},name:function(draftitemid){return draftItemIdsToName[draftitemid]}}}};return{init:dragDropToImageForm.init}}));
/*
 * JavaScript to allow dragging options to slots (using mouse down or touch) or tab through slots using keyboard.
 *
 * @module     qtype_ddimageortext/question
 * @package    qtype_ddimageortext
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_ddimageortext/question",["jquery","core/dragdrop","core/key_codes"],(function($,dragDrop,keys){function DragDropOntoImageQuestion(containerId,readOnly,places){this.containerId=containerId,M.util.js_pending("qtype_ddimageortext-init-"+this.containerId),this.places=places,this.allImagesLoaded=!1,this.imageLoadingTimeoutId=null,this.isPrinting=!1,readOnly&&this.getRoot().addClass("qtype_ddimageortext-readonly");var thisQ=this;this.getNotYetLoadedImages().one("load",(function(){thisQ.waitForAllImagesToBeLoaded()})),this.waitForAllImagesToBeLoaded()}DragDropOntoImageQuestion.prototype.waitForAllImagesToBeLoaded=function(){var thisQ=this;this.allImagesLoaded||(null!==this.imageLoadingTimeoutId&&clearTimeout(this.imageLoadingTimeoutId),this.getNotYetLoadedImages().length>0?this.imageLoadingTimeoutId=setTimeout((function(){thisQ.waitForAllImagesToBeLoaded()}),100):(this.allImagesLoaded=!0,thisQ.setupQuestion()))},DragDropOntoImageQuestion.prototype.getNotYetLoadedImages=function(){var thisQ=this;return this.getRoot().find(".ddarea img").not((function(i,imgNode){return thisQ.imageIsLoaded(imgNode)}))},DragDropOntoImageQuestion.prototype.imageIsLoaded=function(imgElement){return imgElement.complete&&0!==imgElement.naturalHeight},DragDropOntoImageQuestion.prototype.setupQuestion=function(){this.resizeAllDragsAndDrops(),this.cloneDrags(),this.positionDragsAndDrops(),M.util.js_complete("qtype_ddimageortext-init-"+this.containerId)},DragDropOntoImageQuestion.prototype.resizeAllDragsAndDrops=function(){var thisQ=this;this.getRoot().find(".draghomes > div").each((function(i,node){thisQ.resizeAllDragsAndDropsInGroup(thisQ.getClassnameNumericSuffix($(node),"dragitemgroup"))}))},DragDropOntoImageQuestion.prototype.resizeAllDragsAndDropsInGroup=function(group){var root=this.getRoot(),dragHomes=root.find(".dragitemgroup"+group+" .draghome"),maxWidth=0,maxHeight=0;for(var i in dragHomes.each((function(i,drag){maxWidth=Math.max(maxWidth,Math.ceil(drag.offsetWidth)),maxHeight=Math.max(maxHeight,Math.ceil(drag.offsetHeight))})),maxWidth+=10,maxHeight+=10,dragHomes.each((function(i,drag){var left=Math.round((maxWidth-drag.offsetWidth)/2),top=Math.floor((maxHeight-drag.offsetHeight)/2);$(drag).css({"padding-left":left+"px","padding-right":maxWidth-drag.offsetWidth-left+"px","padding-top":top+"px","padding-bottom":maxHeight-drag.offsetHeight-top+"px"})})),this.places)if(this.places.hasOwnProperty(i)){var place=this.places[i],label=place.text;parseInt(place.group)===group&&(""===label&&(label=M.util.get_string("blank","qtype_ddimageortext")),root.find(".dropzones").append('<div class="dropzone active group'+place.group+" place"+i+'" tabindex="0"><span class="accesshide">'+label+"</span>&nbsp;</div>"),root.find(".dropzone.place"+i).width(maxWidth-2).height(maxHeight-2))}},DragDropOntoImageQuestion.prototype.cloneDrags=function(){var thisQ=this;thisQ.getRoot().find(".draghome").each((function(index,dragHome){var drag=$(dragHome),placeHolder=drag.clone();placeHolder.removeClass(),placeHolder.addClass("draghome choice"+thisQ.getChoice(drag)+" group"+thisQ.getGroup(drag)+" dragplaceholder"),drag.before(placeHolder)}))},DragDropOntoImageQuestion.prototype.cloneDragsForOneChoice=function(dragHome){if(dragHome.hasClass("infinite"))for(var noOfDrags=this.noOfDropsInGroup(this.getGroup(dragHome)),i=0;i<noOfDrags;i++)this.cloneDrag(dragHome);else this.cloneDrag(dragHome)},DragDropOntoImageQuestion.prototype.cloneDrag=function(dragHome){var drag=dragHome.clone();drag.removeClass("draghome").addClass("drag unplaced moodle-has-zindex").offset(dragHome.offset()),this.getRoot().find(".dragitems").append(drag)},DragDropOntoImageQuestion.prototype.positionDragsAndDrops=function(){var thisQ=this,root=this.getRoot(),bgRatio=this.bgRatio();root.find(".ddarea .dropzone").each((function(i,dropNode){var drop=$(dropNode),place=thisQ.places[thisQ.getPlace(drop)];drop.css("left",parseInt(place.xy[0])*bgRatio).css("top",parseInt(place.xy[1])*bgRatio),drop.data("originX",parseInt(place.xy[0])).data("originY",parseInt(place.xy[1])),thisQ.handleElementScale(drop,"left top")})),root.find(".draghome").not(".dragplaceholder").each((function(i,dragNode){var drag=$(dragNode),currentPlace=thisQ.getClassnameNumericSuffix(drag,"inplace");drag.addClass("unplaced").removeClass("placed"),drag.removeAttr("tabindex"),null!==currentPlace&&drag.removeClass("inplace"+currentPlace)})),root.find("input.placeinput").each((function(i,inputNode){var input=$(inputNode),choice=input.val();if(!(0===choice.length||choice.length>0&&"0"===choice)){var place=thisQ.getPlace(input),unplacedDrag=thisQ.getUnplacedChoice(thisQ.getGroup(input),choice),hiddenDrag=thisQ.getDragClone(unplacedDrag);if(hiddenDrag.length)if(unplacedDrag.hasClass("infinite")){var noOfDrags=thisQ.noOfDropsInGroup(thisQ.getGroup(unplacedDrag));if(thisQ.getInfiniteDragClones(unplacedDrag,!1).length<noOfDrags){var cloneDrag=unplacedDrag.clone();cloneDrag.removeClass("beingdragged"),cloneDrag.removeAttr("tabindex"),hiddenDrag.after(cloneDrag)}else hiddenDrag.addClass("active")}else hiddenDrag.addClass("active");var drop=root.find(".dropzone.place"+place);thisQ.sendDragToDrop(unplacedDrag,drop)}}))},DragDropOntoImageQuestion.prototype.handleDragStart=function(e){var thisQ=this,drag=$(e.target).closest(".draghome"),newIndex=this.calculateZIndex()+2;if(dragDrop.prepare(e).start){drag.addClass("beingdragged").css("transform","").css("z-index",newIndex);var currentPlace=this.getClassnameNumericSuffix(drag,"inplace");if(null!==currentPlace){this.setInputValue(currentPlace,0),drag.removeClass("inplace"+currentPlace);var hiddenDrop=thisQ.getDrop(drag,currentPlace);hiddenDrop.length&&(hiddenDrop.addClass("active"),drag.offset(hiddenDrop.offset()))}else{var hiddenDrag=thisQ.getDragClone(drag);if(hiddenDrag.length)if(drag.hasClass("infinite")){var noOfDrags=this.noOfDropsInGroup(thisQ.getGroup(drag));if(this.getInfiniteDragClones(drag,!1).length<noOfDrags){var cloneDrag=drag.clone();cloneDrag.removeClass("beingdragged"),cloneDrag.removeAttr("tabindex"),hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag),drag.offset(cloneDrag.offset())}else hiddenDrag.addClass("active"),drag.offset(hiddenDrag.offset())}else hiddenDrag.addClass("active"),drag.offset(hiddenDrag.offset())}dragDrop.start(e,drag,(function(x,y,drag){thisQ.dragMove(x,y,drag)}),(function(x,y,drag){thisQ.dragEnd(x,y,drag)}))}},DragDropOntoImageQuestion.prototype.dragMove=function(pageX,pageY,drag){var thisQ=this,highlighted=!1;this.getRoot().find(".dropzone.group"+this.getGroup(drag)).each((function(i,dropNode){var drop=$(dropNode);thisQ.isPointInDrop(pageX,pageY,drop)&&!highlighted?(highlighted=!0,drop.addClass("valid-drag-over-drop")):drop.removeClass("valid-drag-over-drop")})),this.getRoot().find(".draghome.placed.group"+this.getGroup(drag)).not(".beingdragged").each((function(i,dropNode){var drop=$(dropNode);!thisQ.isPointInDrop(pageX,pageY,drop)||highlighted||thisQ.isDragSameAsDrop(drag,drop)?drop.removeClass("valid-drag-over-drop"):(highlighted=!0,drop.addClass("valid-drag-over-drop"))}))},DragDropOntoImageQuestion.prototype.dragEnd=function(pageX,pageY,drag){var thisQ=this,root=this.getRoot(),placed=!1;root.find(".dropzone.group"+this.getGroup(drag)).each((function(i,dropNode){var drop=$(dropNode);return!thisQ.isPointInDrop(pageX,pageY,drop)||(drop.removeClass("valid-drag-over-drop"),thisQ.sendDragToDrop(drag,drop),placed=!0,!1)})),placed||root.find(".draghome.placed.group"+this.getGroup(drag)).not(".beingdragged").each((function(i,placedNode){var placedDrag=$(placedNode);if(!thisQ.isPointInDrop(pageX,pageY,placedDrag)||thisQ.isDragSameAsDrop(drag,placedDrag))return!0;placedDrag.removeClass("valid-drag-over-drop");var currentPlace=thisQ.getClassnameNumericSuffix(placedDrag,"inplace"),drop=thisQ.getDrop(drag,currentPlace);return thisQ.sendDragToDrop(drag,drop),placed=!0,!1})),placed||this.sendDragHome(drag)},DragDropOntoImageQuestion.prototype.sendDragToDrop=function(drag,drop){var oldDrag=this.getCurrentDragInPlace(this.getPlace(drop));if(0!==oldDrag.length){oldDrag.addClass("beingdragged"),oldDrag.offset(oldDrag.offset());var currentPlace=this.getClassnameNumericSuffix(oldDrag,"inplace");this.getDrop(oldDrag,currentPlace).addClass("active"),this.sendDragHome(oldDrag)}0===drag.length?(this.setInputValue(this.getPlace(drop),0),drop.data("isfocus")&&drop.focus()):(this.setInputValue(this.getPlace(drop),this.getChoice(drag)),drag.removeClass("unplaced").addClass("placed inplace"+this.getPlace(drop)),drag.attr("tabindex",0),this.animateTo(drag,drop))},DragDropOntoImageQuestion.prototype.sendDragHome=function(drag){var currentPlace=this.getClassnameNumericSuffix(drag,"inplace");null!==currentPlace&&drag.removeClass("inplace"+currentPlace),drag.data("unplaced",!0),this.animateTo(drag,this.getDragHome(this.getGroup(drag),this.getChoice(drag)))},DragDropOntoImageQuestion.prototype.handleKeyPress=function(e){var drop=$(e.target).closest(".dropzone");if(0===drop.length){var placedDrag=$(e.target),currentPlace=this.getClassnameNumericSuffix(placedDrag,"inplace");null!==currentPlace&&(drop=this.getDrop(placedDrag,currentPlace))}var currentDrag=this.getCurrentDragInPlace(this.getPlace(drop)),nextDrag=$();switch(e.keyCode){case keys.space:case keys.arrowRight:case keys.arrowDown:nextDrag=this.getNextDrag(this.getGroup(drop),currentDrag);break;case keys.arrowLeft:case keys.arrowUp:nextDrag=this.getPreviousDrag(this.getGroup(drop),currentDrag);break;case keys.escape:questionManager.isKeyboardNavigation=!1;break;default:return void(questionManager.isKeyboardNavigation=!1)}if(nextDrag.length){nextDrag.data("isfocus",!0),nextDrag.addClass("beingdragged");var hiddenDrag=this.getDragClone(nextDrag);if(hiddenDrag.length)if(nextDrag.hasClass("infinite")){var noOfDrags=this.noOfDropsInGroup(this.getGroup(nextDrag));if(this.getInfiniteDragClones(nextDrag,!1).length<noOfDrags){var cloneDrag=nextDrag.clone();cloneDrag.removeClass("beingdragged"),cloneDrag.removeAttr("tabindex"),hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag),nextDrag.offset(cloneDrag.offset())}else hiddenDrag.addClass("active"),nextDrag.offset(hiddenDrag.offset())}else hiddenDrag.addClass("active"),nextDrag.offset(hiddenDrag.offset())}else drop.data("isfocus",!0);e.preventDefault(),this.sendDragToDrop(nextDrag,drop)},DragDropOntoImageQuestion.prototype.getNextDrag=function(group,drag){var choice,numChoices=this.noOfChoicesInGroup(group);choice=0===drag.length?1:this.getChoice(drag)+1;for(var next=this.getUnplacedChoice(group,choice);0===next.length&&choice<numChoices;)choice++,next=this.getUnplacedChoice(group,choice);return next},DragDropOntoImageQuestion.prototype.getPreviousDrag=function(group,drag){var choice;choice=0===drag.length?this.noOfChoicesInGroup(group):this.getChoice(drag)-1;for(var previous=this.getUnplacedChoice(group,choice);0===previous.length&&choice>1;)choice--,previous=this.getUnplacedChoice(group,choice);return previous},DragDropOntoImageQuestion.prototype.animateTo=function(drag,target){var currentPos=drag.offset(),targetPos=target.offset(),thisQ=this;M.util.js_pending("qtype_ddimageortext-animate-"+thisQ.containerId),drag.animate({left:parseInt(drag.css("left"))+targetPos.left-currentPos.left,top:parseInt(drag.css("top"))+targetPos.top-currentPos.top},{duration:"fast",done:function(){$("body").trigger("qtype_ddimageortext-dragmoved",[drag,target,thisQ]),M.util.js_complete("qtype_ddimageortext-animate-"+thisQ.containerId)}})},DragDropOntoImageQuestion.prototype.isPointInDrop=function(pageX,pageY,drop){var position=drop.offset();return drop.hasClass("draghome")?pageX>=position.left&&pageX<position.left+drop.outerWidth()&&pageY>=position.top&&pageY<position.top+drop.outerHeight():pageX>=position.left&&pageX<position.left+drop.width()&&pageY>=position.top&&pageY<position.top+drop.height()},DragDropOntoImageQuestion.prototype.setInputValue=function(place,choice){this.getRoot().find("input.placeinput.place"+place).val(choice)},DragDropOntoImageQuestion.prototype.getRoot=function(){return $(document.getElementById(this.containerId))},DragDropOntoImageQuestion.prototype.bgImage=function(){return this.getRoot().find("img.dropbackground")},DragDropOntoImageQuestion.prototype.getDragHome=function(group,choice){return this.getRoot().find(".draghome.dragplaceholder.group"+group+".choice"+choice).is(":visible")?this.getRoot().find(".draghome.dragplaceholder.group"+group+".choice"+choice):this.getRoot().find(".dragitemgroup"+group+" .draghome.infinite.choice"+choice+".group"+group)},DragDropOntoImageQuestion.prototype.getUnplacedChoice=function(group,choice){return this.getRoot().find(".ddarea .draghome.group"+group+".choice"+choice+".unplaced").slice(0,1)},DragDropOntoImageQuestion.prototype.getCurrentDragInPlace=function(place){return this.getRoot().find(".ddarea .draghome.inplace"+place)},DragDropOntoImageQuestion.prototype.noOfDropsInGroup=function(group){return this.getRoot().find(".dropzone.group"+group).length},DragDropOntoImageQuestion.prototype.noOfChoicesInGroup=function(group){return this.getRoot().find(".dragitemgroup"+group+" .draghome").length},DragDropOntoImageQuestion.prototype.getClassnameNumericSuffix=function(node,prefix){var classes=node.attr("class");if(""!==classes)for(var classesArr=classes.split(" "),index=0;index<classesArr.length;index++){if(new RegExp("^"+prefix+"([0-9])+$").test(classesArr[index])){var match=new RegExp("([0-9])+$").exec(classesArr[index]);return Number(match[0])}}return null},DragDropOntoImageQuestion.prototype.getChoice=function(drag){return this.getClassnameNumericSuffix(drag,"choice")},DragDropOntoImageQuestion.prototype.getGroup=function(node){return this.getClassnameNumericSuffix(node,"group")},DragDropOntoImageQuestion.prototype.getPlace=function(node){return this.getClassnameNumericSuffix(node,"place")},DragDropOntoImageQuestion.prototype.getDragClone=function(drag){return this.getRoot().find(".dragitemgroup"+this.getGroup(drag)+" .draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".dragplaceholder")},DragDropOntoImageQuestion.prototype.getInfiniteDragClones=function(drag,inHome){return inHome?this.getRoot().find(".dragitemgroup"+this.getGroup(drag)+" .draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".infinite").not(".dragplaceholder"):this.getRoot().find(".draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".infinite").not(".dragplaceholder")},DragDropOntoImageQuestion.prototype.getDrop=function(drag,currentPlace){return this.getRoot().find(".dropzone.group"+this.getGroup(drag)+".place"+currentPlace)},DragDropOntoImageQuestion.prototype.handleResize=function(){var thisQ=this,bgRatio=this.bgRatio();this.isPrinting&&(bgRatio=1),this.getRoot().find(".ddarea .dropzone").each((function(i,dropNode){$(dropNode).css("left",parseInt($(dropNode).data("originX"))*parseFloat(bgRatio)).css("top",parseInt($(dropNode).data("originY"))*parseFloat(bgRatio)),thisQ.handleElementScale(dropNode,"left top")})),this.getRoot().find("div.droparea .draghome").not(".beingdragged").each((function(key,drag){$(drag).css("left",parseFloat($(drag).data("originX"))*parseFloat(bgRatio)).css("top",parseFloat($(drag).data("originY"))*parseFloat(bgRatio)),thisQ.handleElementScale(drag,"left top")}))},DragDropOntoImageQuestion.prototype.bgRatio=function(){var bgImg=this.bgImage(),bgImgNaturalWidth=bgImg.get(0).naturalWidth;return bgImg.width()/bgImgNaturalWidth},DragDropOntoImageQuestion.prototype.handleElementScale=function(element,type){var bgRatio=parseFloat(this.bgRatio());this.isPrinting&&(bgRatio=1),$(element).css({"-webkit-transform":"scale("+bgRatio+")","-moz-transform":"scale("+bgRatio+")","-ms-transform":"scale("+bgRatio+")","-o-transform":"scale("+bgRatio+")",transform:"scale("+bgRatio+")","transform-origin":type})},DragDropOntoImageQuestion.prototype.calculateZIndex=function(){var zIndex=0;return this.getRoot().find(".ddarea .dropzone, div.droparea .draghome").each((function(i,dropNode){var itemZIndex=(dropNode=$(dropNode)).css("z-index")?parseInt(dropNode.css("z-index")):0;itemZIndex>zIndex&&(zIndex=itemZIndex)})),zIndex},DragDropOntoImageQuestion.prototype.isDragSameAsDrop=function(drag,drop){return this.getChoice(drag)===this.getChoice(drop)&&this.getGroup(drag)===this.getGroup(drop)};var questionManager={eventHandlersInitialised:!1,isPrinting:!1,isKeyboardNavigation:!1,questions:{},init:function(containerId,readOnly,places){questionManager.questions[containerId]=new DragDropOntoImageQuestion(containerId,readOnly,places),questionManager.eventHandlersInitialised||(questionManager.setupEventHandlers(),questionManager.eventHandlersInitialised=!0)},setupEventHandlers:function(){questionManager.addEventHandlersToDrag($(".que.ddimageortext:not(.qtype_ddimageortext-readonly) .draghome")),$("body").on("keydown",".que.ddimageortext:not(.qtype_ddimageortext-readonly) .dropzones .dropzone",questionManager.handleKeyPress).on("keydown",".que.ddimageortext:not(.qtype_ddimageortext-readonly) .draghome.placed:not(.beingdragged)",questionManager.handleKeyPress).on("qtype_ddimageortext-dragmoved",questionManager.handleDragMoved),$(window).on("resize",(function(){questionManager.handleWindowResize(!1)})),window.addEventListener("beforeprint",(function(){questionManager.isPrinting=!0,questionManager.handleWindowResize(questionManager.isPrinting)})),window.addEventListener("afterprint",(function(){questionManager.isPrinting=!1,questionManager.handleWindowResize(questionManager.isPrinting)})),setTimeout((function(){questionManager.fixLayoutIfThingsMoved()}),100)},addEventHandlersToDrag:function(element){element.unbind("mousedown touchstart"),element.on("mousedown touchstart",questionManager.handleDragStart)},handleDragStart:function(e){e.preventDefault();var question=questionManager.getQuestionForEvent(e);question&&question.handleDragStart(e)},handleKeyPress:function(e){if(!questionManager.isKeyboardNavigation){questionManager.isKeyboardNavigation=!0;var question=questionManager.getQuestionForEvent(e);question&&question.handleKeyPress(e)}},handleWindowResize:function(isPrinting){for(var containerId in questionManager.questions)questionManager.questions.hasOwnProperty(containerId)&&(questionManager.questions[containerId].isPrinting=isPrinting,questionManager.questions[containerId].handleResize())},fixLayoutIfThingsMoved:function(){this.handleWindowResize(questionManager.isPrinting),setTimeout((function(){questionManager.fixLayoutIfThingsMoved(questionManager.isPrinting)}),100)},handleDragMoved:function(e,drag,target,thisQ){drag.removeClass("beingdragged").css("z-index",""),drag.css("top",target.position().top).css("left",target.position().left),target.after(drag),target.removeClass("active"),void 0!==drag.data("unplaced")&&!0===drag.data("unplaced")?(drag.removeClass("placed").addClass("unplaced"),drag.removeAttr("tabindex"),drag.removeData("unplaced"),drag.css("top","").css("left","").css("transform",""),drag.hasClass("infinite")&&thisQ.getInfiniteDragClones(drag,!0).length>1&&thisQ.getInfiniteDragClones(drag,!0).first().remove()):(drag.data("originX",target.data("originX")).data("originY",target.data("originY")),thisQ.handleElementScale(drag,"left top")),void 0!==drag.data("isfocus")&&!0===drag.data("isfocus")&&(drag.focus(),drag.removeData("isfocus")),void 0!==target.data("isfocus")&&!0===target.data("isfocus")&&target.removeData("isfocus"),questionManager.isKeyboardNavigation&&(questionManager.isKeyboardNavigation=!1)},getQuestionForEvent:function(e){var containerId=$(e.currentTarget).closest(".que.ddimageortext").attr("id");return questionManager.questions[containerId]}};return{init:questionManager.init}}));
/**
 * Library of classes for handling simple shapes.
 *
 * These classes can represent shapes, let you alter them, can go to and from a string
 * representation, and can give you an SVG representation.
 *
 * @package    qtype_ddmarker
 * @subpackage shapes
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_ddmarker/shapes",(function(){function Point(x,y){this.x=x,this.y=y}function Shape(label,x,y){this.label=label,this.centre=new Point(x||0,y||0)}function Circle(label,x,y,radius){x=x||15,y=y||15,Shape.call(this,label,x,y),this.radius=radius||15}function Rectangle(label,x,y,width,height){Shape.call(this,label,x,y),this.width=width||30,this.height=height||30}function Polygon(label,points){Shape.call(this,label,0,0),this.points=points?points.slice():[new Point(10,10),new Point(40,10),new Point(10,40)],this.normalizeShape(),this.ratio=1}function NullShape(label){Shape.call(this,label)}function createSvgElement(svg,tagName){var svgEl=svg.ownerDocument.createElementNS("http://www.w3.org/2000/svg",tagName);return svg.appendChild(svgEl),svgEl}function createSvgShapeGroup(svg,tagName){var svgEl=createSvgElement(svg,"g");return createSvgElement(svgEl,tagName).setAttribute("class","shape"),createSvgElement(svgEl,"text").setAttribute("class","shapeLabel"),svgEl}return Point.prototype.toString=function(){return this.x+","+this.y},Point.prototype.move=function(dx,dy){this.x+=dx,this.y+=dy},Point.prototype.offset=function(offsetX,offsetY){return offsetX instanceof Point&&(offsetY=offsetX.y,offsetX=offsetX.x),new Point(this.x+offsetX,this.y+offsetY)},Point.parse=function(coordinates){var bits=coordinates.split(",");if(2!==bits.length)throw new Error(coordinates+" is not a valid point");return new Point(Math.round(bits[0]),Math.round(bits[1]))},Shape.prototype.getType=function(){throw new Error("Not implemented.")},Shape.prototype.getCoordinates=function(){throw new Error("Not implemented.")},Shape.prototype.parse=function(coordinates,ratio){throw new Error("Not implemented.")},Shape.prototype.move=function(dx,dy,maxX,maxY){},Shape.prototype.edit=function(handleIndex,dx,dy,maxX,maxY){},Shape.prototype.normalizeShape=function(){},Shape.prototype.makeSvg=function(svg){throw new Error("Not implemented.")},Shape.prototype.updateSvg=function(svgEl){},Shape.prototype.makeSimilarCircle=function(){throw new Error("Not implemented.")},Shape.prototype.makeSimilarRectangle=function(){throw new Error("Not implemented.")},Shape.prototype.makeSimilarPolygon=function(){throw new Error("Not implemented.")},Shape.prototype.getHandlePositions=function(){return null},Circle.prototype=new Shape,Circle.prototype.getType=function(){return"circle"},Circle.prototype.getCoordinates=function(){return this.centre+";"+Math.abs(this.radius)},Circle.prototype.makeSvg=function(svg){var svgEl=createSvgShapeGroup(svg,"circle");return this.updateSvg(svgEl),svgEl},Circle.prototype.updateSvg=function(svgEl){svgEl.childNodes[0].setAttribute("cx",this.centre.x),svgEl.childNodes[0].setAttribute("cy",this.centre.y),svgEl.childNodes[0].setAttribute("r",Math.abs(this.radius)),svgEl.childNodes[1].setAttribute("x",this.centre.x),svgEl.childNodes[1].setAttribute("y",this.centre.y+15),svgEl.childNodes[1].textContent=this.label},Circle.prototype.parse=function(coordinates,ratio){if(!coordinates.match(/^\d+(\.\d+)?,\d+(\.\d+)?;\d+(\.\d+)?$/))return!1;var bits=coordinates.split(";");return this.centre=Point.parse(bits[0]),this.centre.x=this.centre.x*parseFloat(ratio),this.centre.y=this.centre.y*parseFloat(ratio),this.radius=Math.round(bits[1])*parseFloat(ratio),!0},Circle.prototype.move=function(dx,dy,maxX,maxY){this.centre.move(dx,dy),this.centre.x<this.radius&&(this.centre.x=this.radius),this.centre.x>maxX-this.radius&&(this.centre.x=maxX-this.radius),this.centre.y<this.radius&&(this.centre.y=this.radius),this.centre.y>maxY-this.radius&&(this.centre.y=maxY-this.radius)},Circle.prototype.edit=function(handleIndex,dx,dy,maxX,maxY){this.radius+=dx;var limit=Math.min(this.centre.x,this.centre.y,maxX-this.centre.x,maxY-this.centre.y);this.radius>limit&&(this.radius=limit),this.radius<-limit&&(this.radius=-limit)},Circle.prototype.normalizeShape=function(){this.radius=Math.abs(this.radius)},Circle.prototype.makeSimilarRectangle=function(){return new Rectangle(this.label,this.centre.x-this.radius,this.centre.y-this.radius,2*this.radius,2*this.radius)},Circle.prototype.makeSimilarPolygon=function(){return new Polygon(this.label,[this.centre.offset(-this.radius,-this.radius),this.centre.offset(-this.radius,this.radius),this.centre.offset(this.radius,this.radius),this.centre.offset(this.radius,-this.radius)])},Circle.prototype.getHandlePositions=function(){return{moveHandle:this.centre,editHandles:[this.centre.offset(this.radius,0)]}},Rectangle.prototype=new Shape,Rectangle.prototype.getType=function(){return"rectangle"},Rectangle.prototype.getCoordinates=function(){return this.centre+";"+this.width+","+this.height},Rectangle.prototype.makeSvg=function(svg){var svgEl=createSvgShapeGroup(svg,"rect");return this.updateSvg(svgEl),svgEl},Rectangle.prototype.updateSvg=function(svgEl){this.width>=0?(svgEl.childNodes[0].setAttribute("x",this.centre.x),svgEl.childNodes[0].setAttribute("width",this.width)):(svgEl.childNodes[0].setAttribute("x",this.centre.x+this.width),svgEl.childNodes[0].setAttribute("width",-this.width)),this.height>=0?(svgEl.childNodes[0].setAttribute("y",this.centre.y),svgEl.childNodes[0].setAttribute("height",this.height)):(svgEl.childNodes[0].setAttribute("y",this.centre.y+this.height),svgEl.childNodes[0].setAttribute("height",-this.height)),svgEl.childNodes[1].setAttribute("x",this.centre.x+this.width/2),svgEl.childNodes[1].setAttribute("y",this.centre.y+this.height/2+15),svgEl.childNodes[1].textContent=this.label},Rectangle.prototype.parse=function(coordinates,ratio){if(!coordinates.match(/^\d+(\.\d+)?,\d+(\.\d+)?;\d+(\.\d+)?,\d+(\.\d+)?$/))return!1;var bits=coordinates.split(";");this.centre=Point.parse(bits[0]),this.centre.x=this.centre.x*parseFloat(ratio),this.centre.y=this.centre.y*parseFloat(ratio);var size=Point.parse(bits[1]);return this.width=size.x*parseFloat(ratio),this.height=size.y*parseFloat(ratio),!0},Rectangle.prototype.move=function(dx,dy,maxX,maxY){this.centre.move(dx,dy),this.centre.x<0&&(this.centre.x=0),this.centre.x>maxX-this.width&&(this.centre.x=maxX-this.width),this.centre.y<0&&(this.centre.y=0),this.centre.y>maxY-this.height&&(this.centre.y=maxY-this.height)},Rectangle.prototype.edit=function(handleIndex,dx,dy,maxX,maxY){this.width+=dx,this.height+=dy,this.width<-this.centre.x&&(this.width=-this.centre.x),this.width>maxX-this.centre.x&&(this.width=maxX-this.centre.x),this.height<-this.centre.y&&(this.height=-this.centre.y),this.height>maxY-this.centre.y&&(this.height=maxY-this.centre.y)},Rectangle.prototype.normalizeShape=function(){this.width<0&&(this.centre.x+=this.width,this.width=-this.width),this.height<0&&(this.centre.y+=this.height,this.height=-this.height)},Rectangle.prototype.makeSimilarCircle=function(){return new Circle(this.label,Math.round(this.centre.x+this.width/2),Math.round(this.centre.y+this.height/2),Math.round((this.width+this.height)/4))},Rectangle.prototype.makeSimilarPolygon=function(){return new Polygon(this.label,[this.centre,this.centre.offset(0,this.height),this.centre.offset(this.width,this.height),this.centre.offset(this.width,0)])},Rectangle.prototype.getHandlePositions=function(){return{moveHandle:this.centre.offset(this.width/2,this.height/2),editHandles:[this.centre.offset(this.width,this.height)]}},Polygon.prototype=new Shape,Polygon.prototype.getType=function(){return"polygon"},Polygon.prototype.getCoordinates=function(){for(var coordinates="",i=0;i<this.points.length;i++)coordinates+=this.centre.offset(this.points[i])+";";return coordinates.slice(0,coordinates.length-1)},Polygon.prototype.makeSvg=function(svg){var svgEl=createSvgShapeGroup(svg,"polygon");return this.updateSvg(svgEl),svgEl},Polygon.prototype.updateSvg=function(svgEl){svgEl.childNodes[0].setAttribute("points",this.getCoordinates().replace(/[,;]/g," ")),svgEl.childNodes[0].setAttribute("transform","scale("+parseFloat(this.ratio)+")"),svgEl.childNodes[1].setAttribute("x",this.centre.x),svgEl.childNodes[1].setAttribute("y",this.centre.y+15),svgEl.childNodes[1].textContent=this.label},Polygon.prototype.parse=function(coordinates,ratio){if(!coordinates.match(/^\d+(\.\d+)?,\d+(\.\d+)?(?:;\d+(\.\d+)?,\d+(\.\d+)?)*$/))return!1;for(var bits=coordinates.split(";"),points=[],i=0;i<bits.length;i++)points.push(Point.parse(bits[i]));return this.points=points,this.centre.x=0,this.centre.y=0,this.ratio=ratio,this.normalizeShape(),!0},Polygon.prototype.move=function(dx,dy,maxX,maxY){this.centre.move(dx,dy);for(var bbXMin=maxX,bbXMax=0,bbYMin=maxY,bbYMax=0,i=0;i<this.points.length;i++)bbXMin=Math.min(bbXMin,this.points[i].x),bbXMax=Math.max(bbXMax,this.points[i].x),bbYMin=Math.min(bbYMin,this.points[i].y),bbYMax=Math.max(bbYMax,this.points[i].y);this.centre.x<-bbXMin&&(this.centre.x=-bbXMin),this.centre.x>maxX-bbXMax&&(this.centre.x=maxX-bbXMax),this.centre.y<-bbYMin&&(this.centre.y=-bbYMin),this.centre.y>maxY-bbYMax&&(this.centre.y=maxY-bbYMax)},Polygon.prototype.edit=function(handleIndex,dx,dy,maxX,maxY){this.points[handleIndex].move(dx,dy),this.points[handleIndex].x<-this.centre.x&&(this.points[handleIndex].x=-this.centre.x),this.points[handleIndex].x>maxX-this.centre.x&&(this.points[handleIndex].x=maxX-this.centre.x),this.points[handleIndex].y<-this.centre.y&&(this.points[handleIndex].y=-this.centre.y),this.points[handleIndex].y>maxY-this.centre.y&&(this.points[handleIndex].y=maxY-this.centre.y)},Polygon.prototype.addNewPointAfter=function(pointIndex){this.points.splice(pointIndex,0,new Point(this.points[pointIndex].x,this.points[pointIndex].y))},Polygon.prototype.normalizeShape=function(){var i,x=0,y=0;if(0!==this.points.length){for(i=0;i<this.points.length;i++)x+=this.points[i].x,y+=this.points[i].y;if(x=Math.round(x/this.points.length),y=Math.round(y/this.points.length),0!==x||0!==y){for(i=0;i<this.points.length;i++)this.points[i].move(-x,-y);this.centre.move(x,y)}}},Polygon.prototype.makeSimilarCircle=function(){return this.makeSimilarRectangle().makeSimilarCircle()},Polygon.prototype.makeSimilarRectangle=function(){for(var p,minX=0,maxX=0,minY=0,maxY=0,i=0;i<this.points.length;i++)p=this.points[i],minX=Math.min(minX,p.x),maxX=Math.max(maxX,p.x),minY=Math.min(minY,p.y),maxY=Math.max(maxY,p.y);return new Rectangle(this.label,this.centre.x+minX,this.centre.y+minY,Math.max(maxX-minX,10),Math.max(maxY-minY,10))},Polygon.prototype.getHandlePositions=function(){for(var editHandles=[],i=0;i<this.points.length;i++)editHandles.push(this.points[i].offset(this.centre.x,this.centre.y));return this.centre.x=this.centre.x*parseFloat(this.ratio),this.centre.y=this.centre.y*parseFloat(this.ratio),{moveHandle:this.centre,editHandles:editHandles}},NullShape.prototype=new Shape,NullShape.prototype.getType=function(){return"null"},NullShape.prototype.getCoordinates=function(){return""},NullShape.prototype.makeSvg=function(svg){return null},NullShape.prototype.updateSvg=function(svgEl){},NullShape.prototype.parse=function(coordinates){return!1},NullShape.prototype.makeSimilarCircle=function(){return new Circle(this.label)},NullShape.prototype.makeSimilarRectangle=function(){return new Rectangle(this.label)},NullShape.prototype.makeSimilarPolygon=function(){return new Polygon(this.label)},{Point:Point,Shape:Shape,Circle:Circle,Rectangle:Rectangle,Polygon:Polygon,NullShape:NullShape,createSvgElement:createSvgElement,make:function(shapeType,label){switch(shapeType){case"circle":return new Circle(label);case"rectangle":return new Rectangle(label);case"polygon":return new Polygon(label);default:return new NullShape(label)}},getSimilar:function(shapeType,shape){if(shapeType===shape.getType())return shape;switch(shapeType){case"circle":return shape.makeSimilarCircle();case"rectangle":return shape.makeSimilarRectangle();case"polygon":return shape.makeSimilarPolygon();default:return new NullShape(shape.label)}}}}));
/**
 * This class provides the enhancements to the drag-drop marker editing form.
 *
 * @package    qtype_ddmarker
 * @subpackage form
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_ddmarker/form",["jquery","core/dragdrop","qtype_ddmarker/shapes"],(function($,dragDrop,Shapes){function DropZoneManager(dropzoneNo){this.dropzoneNo=dropzoneNo,this.svgEl=null,this.shape=Shapes.make(this.getShapeType(),this.getLabel()),this.updateCoordinatesFromForm()}DropZoneManager.prototype.updateCoordinatesFromForm=function(svg){var coordinates=this.getCoordinates(),currentNumPoints="polygon"===this.shape.getType()&&this.shape.points.length;if(this.shape.getCoordinates()!==coordinates&&this.shape.parse(coordinates,1)){if("polygon"===this.shape.getType()&&currentNumPoints!==this.shape.points.length){var currentyActive=this.isActive();this.removeFromSvg(),svg&&(this.addToSvg(svg),currentyActive&&this.setActive())}else this.updateSvgEl();this.setCoordinatesInForm()}},DropZoneManager.prototype.updateLabel=function(){var label=this.getLabel();this.shape.label!==label&&(this.shape.label=label,this.updateSvgEl())},DropZoneManager.prototype.changeShape=function(svg){var newShapeType=this.getShapeType(),currentyActive=this.isActive();newShapeType!==this.shape.getType()&&(this.removeFromSvg(),this.shape=Shapes.getSimilar(newShapeType,this.shape),svg&&(this.addToSvg(svg),currentyActive&&this.setActive()),this.setCoordinatesInForm())},DropZoneManager.prototype.addToSvg=function(svg){if(null!==this.svgEl)throw new Error("this.svgEl already set");if(this.svgEl=this.shape.makeSvg(svg),this.svgEl){this.svgEl.setAttribute("class","dropzone"),this.svgEl.setAttribute("data-dropzone-no",this.dropzoneNo);var handles=this.shape.getHandlePositions();if(null!==handles){var moveHandle=Shapes.createSvgElement(this.svgEl,"circle");moveHandle.setAttribute("cx",handles.moveHandle.x),moveHandle.setAttribute("cy",handles.moveHandle.y),moveHandle.setAttribute("r",7),moveHandle.setAttribute("class","handle move");for(var i=0;i<handles.editHandles.length;++i)this.makeEditHandle(i,handles.editHandles[i])}}},DropZoneManager.prototype.makeEditHandle=function(index,point){var editHandle=Shapes.createSvgElement(this.svgEl,"rect");editHandle.setAttribute("x",point.x-6),editHandle.setAttribute("y",point.y-6),editHandle.setAttribute("width",11),editHandle.setAttribute("height",11),editHandle.setAttribute("class","handle edit"),editHandle.setAttribute("data-edit-handle-no",index)},DropZoneManager.prototype.removeFromSvg=function(){null!==this.svgEl&&(this.svgEl.parentNode.removeChild(this.svgEl),this.svgEl=null)},DropZoneManager.prototype.updateSvgEl=function(){if(null!==this.svgEl){this.shape.updateSvg(this.svgEl);var handles=this.shape.getHandlePositions();if(null!==handles){this.svgEl.childNodes[2].setAttribute("cx",handles.moveHandle.x),this.svgEl.childNodes[2].setAttribute("cy",handles.moveHandle.y);for(var i=0;i<handles.editHandles.length;++i)this.svgEl.childNodes[3+i].setAttribute("x",handles.editHandles[i].x-6),this.svgEl.childNodes[3+i].setAttribute("y",handles.editHandles[i].y-6)}}},DropZoneManager.prototype.isActive=function(){return null!==this.svgEl&&this.svgEl.getAttribute("class").match(/\bactive\b/)},DropZoneManager.prototype.setActive=function(){var parent=this.svgEl.parentNode;parent.removeChild(this.svgEl),parent.appendChild(this.svgEl),this.svgEl.setAttribute("class",this.svgEl.getAttribute("class")+" active")},DropZoneManager.prototype.setCoordinatesInForm=function(){dragDropForm.form.setFormValue("drops",[this.dropzoneNo,"coords"],this.shape.getCoordinates())},DropZoneManager.prototype.getCoordinates=function(){return dragDropForm.form.getFormValue("drops",[this.dropzoneNo,"coords"]).replace(/\s*/g,"")},DropZoneManager.prototype.getChoiceNo=function(){return dragDropForm.form.getFormValue("drops",[this.dropzoneNo,"choice"])},DropZoneManager.prototype.getLabel=function(){return dragDropForm.form.getMarkerText(this.getChoiceNo())},DropZoneManager.prototype.getShapeType=function(){return dragDropForm.form.getFormValue("drops",[this.dropzoneNo,"shape"])},DropZoneManager.prototype.handleMove=function(e){var info=dragDrop.prepare(e);if(info.start){var movingDropZone=this,lastX=info.x,lastY=info.y,dragProxy=this.makeDragProxy(info.x,info.y),bgImg=$("fieldset#id_previewareaheader .dropbackground"),maxX=bgImg.width(),maxY=bgImg.height();dragDrop.start(e,$(dragProxy),(function(pageX,pageY){movingDropZone.shape.move(pageX-lastX,pageY-lastY,maxX,maxY),lastX=pageX,lastY=pageY,movingDropZone.updateSvgEl(),movingDropZone.setCoordinatesInForm()}),(function(){document.body.removeChild(dragProxy)}))}},DropZoneManager.prototype.handleEdit=function(e,handleIndex,svg){var info=dragDrop.prepare(e);if(info.start){"polygon"===this.shape.getType()&&(e.ctrlKey||e.metaKey)&&(this.shape.addNewPointAfter(handleIndex),this.removeFromSvg(),this.addToSvg(svg),this.setActive());var changingDropZone=this,lastX=info.x,lastY=info.y,dragProxy=this.makeDragProxy(info.x,info.y),bgImg=$("fieldset#id_previewareaheader .dropbackground"),maxX=bgImg.width(),maxY=bgImg.height();dragDrop.start(e,$(dragProxy),(function(pageX,pageY){changingDropZone.shape.edit(handleIndex,pageX-lastX,pageY-lastY,maxX,maxY),lastX=pageX,lastY=pageY,changingDropZone.updateSvgEl(),changingDropZone.setCoordinatesInForm()}),(function(){document.body.removeChild(dragProxy),changingDropZone.shape.normalizeShape(),changingDropZone.updateSvgEl(),changingDropZone.setCoordinatesInForm()}))}},DropZoneManager.prototype.makeDragProxy=function(x,y){var dragProxy=document.createElement("div");return dragProxy.style.position="absolute",dragProxy.style.top=y+"px",dragProxy.style.left=x+"px",dragProxy.style.width="1px",dragProxy.style.height="1px",document.body.appendChild(dragProxy),dragProxy};var dragDropForm={fp:null,noDropZones:null,dropZones:[],init:function(){dragDropForm.fp=dragDropForm.filePickers(),dragDropForm.noDropZones=dragDropForm.form.getFormValue("nodropzone",[]),dragDropForm.setupPreviewArea(),dragDropForm.setOptionsForDragItemSelectors(),dragDropForm.createShapes(),dragDropForm.setupEventHandlers(),dragDropForm.waitForFilePickerToInitialise()},setupPreviewArea:function(){$("fieldset#id_previewareaheader div.fcontainer").append('<div class="ddarea que ddmarker">   <div id="ddm-droparea" class="droparea">       <img class="dropbackground" />       <div id="ddm-dropzone" class="dropzones">       </div>   </div></div>')},setOptionsForDragItemSelectors:function(){var selector,i,label,dragItemsOptions={0:""},noItems=dragDropForm.form.getFormValue("noitems",[]),selectedValues=[];for(i=1;i<=noItems;i++)""!==(label=dragDropForm.form.getMarkerText(i))&&(dragItemsOptions[i]=$("<div/>").text(label).html());for(i=0;i<dragDropForm.noDropZones;i++)selector=$("#id_drops_"+i+"_choice"),selectedValues[i]=Number(selector.val());for(i=0;i<dragDropForm.noDropZones;i++){for(var value in(selector=$("#id_drops_"+i+"_choice")).find("option").remove(),dragItemsOptions){var option='<option value="'+(value=Number(value))+'">'+dragItemsOptions[value]+"</option>";selector.append(option);var optionnode=selector.find('option[value="'+value+'"]');if(0!==value)if(value!==selectedValues[i]){var noofdrags=dragDropForm.form.getFormValue("drags",[value-1,"noofdrags"]);if(0!==Number(noofdrags))for(var k in selectedValues)if(Number(selectedValues[k])===value){if(1===Number(noofdrags)){optionnode.attr("disabled",!0);break}noofdrags--}}else optionnode.attr("selected",!0)}dragDropForm.dropZones.length>0&&dragDropForm.dropZones[i].updateLabel()}},createShapes:function(){for(var dropzoneNo=0;dropzoneNo<dragDropForm.noDropZones;dropzoneNo++)dragDropForm.dropZones[dropzoneNo]=new DropZoneManager(dropzoneNo)},setupEventHandlers:function(){$("fieldset#id_draggableitemheader").on("change input","input, select",(function(){dragDropForm.setOptionsForDragItemSelectors()})),$("fieldset#id_dropzoneheader").on("change input","input, select",(function(e){var ids=e.currentTarget.name.match(/^drops\[(\d+)]\[([a-z]*)]$/);if(ids){var dropzoneNo=ids[1],inputType=ids[2],dropZone=dragDropForm.dropZones[dropzoneNo];switch(inputType){case"shape":dropZone.changeShape(dragDropForm.form.getSvg());break;case"coords":dropZone.updateCoordinatesFromForm(dragDropForm.form.getSvg());break;case"choice":dropZone.updateLabel()}}}));var previewArea=$("fieldset#id_previewareaheader");previewArea.on("click","g.dropzone",(function(e){var dropzoneNo=$(e.currentTarget).data("dropzone-no"),currentlyActive=dragDropForm.dropZones[dropzoneNo].isActive();$(dragDropForm.form.getSvg()).find(".dropzone.active").removeClass("active"),currentlyActive||dragDropForm.dropZones[dropzoneNo].setActive()})),previewArea.on("mousedown touchstart",".dropzone .handle.move",(function(e){var dropzoneNo=$(e.currentTarget).closest("g").data("dropzoneNo");dragDropForm.dropZones[dropzoneNo].handleMove(e)})),previewArea.on("mousedown touchstart",".dropzone .handle.edit",(function(e){var dropzoneNo=$(e.currentTarget).closest("g").data("dropzoneNo"),handleIndex=e.currentTarget.getAttribute("data-edit-handle-no");dragDropForm.dropZones[dropzoneNo].handleEdit(e,handleIndex,dragDropForm.form.getSvg())}))},waitForFilePickerToInitialise:function(){null!==dragDropForm.fp.file("bgimage").href?($("form.mform").on("change","#id_bgimage",dragDropForm.loadPreviewImage),dragDropForm.loadPreviewImage()):setTimeout(dragDropForm.waitForFilePickerToInitialise,1e3)},loadPreviewImage:function(){$("fieldset#id_previewareaheader .dropbackground").one("load",dragDropForm.afterPreviewImageLoaded).attr("src",dragDropForm.fp.file("bgimage").href)},afterPreviewImageLoaded:function(){var bgImg=$("fieldset#id_previewareaheader .dropbackground");$("#ddm-dropzone").css("position","relative").css("top",-1*(bgImg.height()+1)),$("#ddm-droparea").css("height",bgImg.height()+20),dragDropForm.updateSvgDisplay()},updateSvgDisplay:function(){var dropzoneNo,bgImg=$("fieldset#id_previewareaheader .dropbackground");if(dragDropForm.form.getSvg())for(dropzoneNo=0;dropzoneNo<dragDropForm.noDropZones;dropzoneNo++)dragDropForm.dropZones[dropzoneNo].updateSvgEl();else for($("#ddm-dropzone").html('<svg xmlns="http://www.w3.org/2000/svg" class="dropzones" width="'+bgImg.outerWidth()+'" height="'+bgImg.outerHeight()+'"></svg>'),dropzoneNo=0;dropzoneNo<dragDropForm.noDropZones;dropzoneNo++)dragDropForm.dropZones[dropzoneNo].addToSvg(dragDropForm.form.getSvg())},form:{getMarkerText:function(markerNo){return 0!==Number(markerNo)?dragDropForm.form.getFormValue("drags",[markerNo-1,"label"]).replace(new RegExp("^\\s*(.*)\\s*$"),"$1"):""},getSvg:function(){var svg=$("fieldset#id_previewareaheader svg");return 0===svg.length?null:svg[0]},toNameWithIndex:function(name,indexes){for(var indexString=name,i=0;i<indexes.length;i++)indexString=indexString+"["+indexes[i]+"]";return indexString},getEl:function(name,indexes){return $("form.mform")[0].elements[this.toNameWithIndex(name,indexes)]},getFormValue:function(name,indexes){var el=this.getEl(name,indexes);return"checkbox"===el.type?el.checked:el.value},setFormValue:function(name,indexes,value){var el=this.getEl(name,indexes);"checkbox"===el.type?el.checked=value:el.value=value}},filePickers:function(){var draftItemIdsToName,nameToParentNode;return void 0===draftItemIdsToName&&(draftItemIdsToName={},nameToParentNode={},$("form.mform input.filepickerhidden").each((function(key,filepicker){draftItemIdsToName[filepicker.value]=filepicker.name,nameToParentNode[filepicker.name]=filepicker.parentNode}))),{file:function(name){var fileAnchor=$(nameToParentNode[name]).find("div.filepicker-filelist a");return fileAnchor.length?{href:fileAnchor.get(0).href,name:fileAnchor.get(0).innerHTML}:{href:null,name:null}},name:function(draftitemid){return draftItemIdsToName[draftitemid]}}}};return{init:dragDropForm.init}}));
/**
 * Question class for drag and drop marker question type, used to support the question and preview pages.
 *
 * @package    qtype_ddmarker
 * @subpackage question
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_ddmarker/question",["jquery","core/dragdrop","qtype_ddmarker/shapes","core/key_codes"],(function($,dragDrop,Shapes,keys){function DragDropMarkersQuestion(containerId,readOnly,visibleDropZones){this.containerId=containerId,this.visibleDropZones=visibleDropZones,this.shapes=[],this.shapeSVGs=[],this.isPrinting=!1,readOnly&&this.getRoot().addClass("qtype_ddmarker-readonly"),this.cloneDrags(),this.repositionDrags(),this.drawDropzones()}DragDropMarkersQuestion.prototype.drawDropzones=function(){if(this.visibleDropZones.length>0){var bgImage=this.bgImage();this.getRoot().find("div.dropzones").html('<svg xmlns="http://www.w3.org/2000/svg" class="dropzones" width="'+bgImage.outerWidth()+'" height="'+bgImage.outerHeight()+'"></svg>');for(var svg=this.getRoot().find("svg.dropzones"),nextColourIndex=0,dropZoneNo=0;dropZoneNo<this.visibleDropZones.length;dropZoneNo++){var colourClass="color"+nextColourIndex;nextColourIndex=(nextColourIndex+1)%8,this.addDropzone(svg,dropZoneNo,colourClass)}}},DragDropMarkersQuestion.prototype.addDropzone=function(svg,dropZoneNo,colourClass){var existingmarkertext,dropZone=this.visibleDropZones[dropZoneNo],shape=Shapes.make(dropZone.shape,""),bgRatio=this.bgRatio();if(shape.parse(dropZone.coords,bgRatio)){if((existingmarkertext=this.getRoot().find("div.markertexts span.markertext"+dropZoneNo)).length)""!==dropZone.markertext?existingmarkertext.html(dropZone.markertext):existingmarkertext.remove();else if(""!==dropZone.markertext){var classnames="markertext markertext"+dropZoneNo;this.getRoot().find("div.markertexts").append('<span class="'+classnames+'">'+dropZone.markertext+"</span>");var markerspan=this.getRoot().find("div.ddarea div.markertexts span.markertext"+dropZoneNo);if(markerspan.length){var handles=shape.getHandlePositions(),positionLeft=handles.moveHandle.x-markerspan.outerWidth()/2-4,positionTop=handles.moveHandle.y-markerspan.outerHeight()/2;markerspan.css("left",positionLeft).css("top",positionTop),markerspan.data("originX",markerspan.position().left/bgRatio).data("originY",markerspan.position().top/bgRatio),this.handleElementScale(markerspan,"center")}}var shapeSVG=shape.makeSvg(svg[0]);shapeSVG.setAttribute("class","dropzone "+colourClass),this.shapes[this.shapes.length]=shape,this.shapeSVGs[this.shapeSVGs.length]=shapeSVG}},DragDropMarkersQuestion.prototype.repositionDrags=function(){var root=this.getRoot(),thisQ=this;root.find("div.draghomes .marker").not(".dragplaceholder").each((function(key,item){$(item).addClass("unneeded")})),root.find("input.choices").each((function(key,input){var choiceNo=thisQ.getChoiceNoFromElement(input),coords=thisQ.getCoords(input);if(coords.length){var drag=thisQ.getRoot().find(".draghomes span.marker.choice"+choiceNo).not(".dragplaceholder");drag.remove();for(var i=0;i<coords.length;i++){var dragInDrop=drag.clone();dragInDrop.data("pagex",coords[i].x).data("pagey",coords[i].y),thisQ.sendDragToDrop(dragInDrop,!1)}thisQ.getDragClone(drag).addClass("active"),thisQ.cloneDragIfNeeded(drag)}}))},DragDropMarkersQuestion.prototype.getCoords=function(inputNode){var coords=[],val=$(inputNode).val();if(""!==val)for(var coordsStrings=val.split(";"),i=0;i<coordsStrings.length;i++)coords[i]=this.convertToWindowXY(Shapes.Point.parse(coordsStrings[i]));return coords},DragDropMarkersQuestion.prototype.convertToWindowXY=function(point){var bgImage=this.bgImage();return point.offset(bgImage.offset().left+1,bgImage.offset().top+1)},DragDropMarkersQuestion.prototype.convertToBgImgXY=function(point){var bgImage=this.bgImage();return point.offset(-bgImage.offset().left-1,-bgImage.offset().top-1)},DragDropMarkersQuestion.prototype.coordsInBgImg=function(point){var bgImage=this.bgImage(),bgPosition=bgImage.offset();return point.x>=bgPosition.left&&point.x<bgPosition.left+bgImage.width()&&point.y>=bgPosition.top&&point.y<bgPosition.top+bgImage.height()},DragDropMarkersQuestion.prototype.getRoot=function(){return $(document.getElementById(this.containerId))},DragDropMarkersQuestion.prototype.bgImage=function(){return this.getRoot().find("img.dropbackground")},DragDropMarkersQuestion.prototype.handleDragStart=function(e){var thisQ=this,dragged=$(e.target).closest(".marker");if(dragDrop.prepare(e).start){if(dragged.addClass("beingdragged").css("transform",""),!!dragged.hasClass("unneeded")){var hiddenDrag=thisQ.getDragClone(dragged);hiddenDrag.length&&(hiddenDrag.addClass("active"),dragged.offset(hiddenDrag.offset()))}dragDrop.start(e,dragged,(function(){}),(function(x,y,dragged){thisQ.dragEnd(dragged)}))}},DragDropMarkersQuestion.prototype.dragEnd=function(dragged){var dragXY,placed=!1,choiceNo=this.getChoiceNoFromElement(dragged),bgRatio=this.bgRatio();if(dragged.data("pagex",dragged.offset().left).data("pagey",dragged.offset().top),dragXY=new Shapes.Point(dragged.data("pagex"),dragged.data("pagey")),this.coordsInBgImg(dragXY)){this.sendDragToDrop(dragged,!0),placed=!0;var bgImgXY=this.convertToBgImgXY(dragXY);bgImgXY=new Shapes.Point(bgImgXY.x/bgRatio,bgImgXY.y/bgRatio),dragged.data("originX",bgImgXY.x).data("originY",bgImgXY.y)}placed?this.cloneDragIfNeeded(dragged):(this.sendDragHome(dragged),this.removeDragIfNeeded(dragged)),this.saveCoordsForChoice(choiceNo)},DragDropMarkersQuestion.prototype.saveCoordsForChoice=function(choiceNo){var coords=[],items=this.getRoot().find("div.droparea span.marker.choice"+choiceNo),thiQ=this,bgRatio=this.bgRatio();items.length&&items.each((function(){var drag=$(this);if(!drag.hasClass("beingdragged")){var dragXY=new Shapes.Point(drag.data("pagex"),drag.data("pagey"));if(thiQ.coordsInBgImg(dragXY)){var bgImgXY=thiQ.convertToBgImgXY(dragXY);bgImgXY=new Shapes.Point(bgImgXY.x/bgRatio,bgImgXY.y/bgRatio),coords[coords.length]=bgImgXY}}})),this.getRoot().find("input.choice"+choiceNo).val(coords.join(";"))},DragDropMarkersQuestion.prototype.handleKeyPress=function(e){var drag=$(e.target).closest(".marker"),point=new Shapes.Point(drag.offset().left,drag.offset().top),choiceNo=this.getChoiceNoFromElement(drag);switch(e.keyCode){case keys.arrowLeft:case 65:point.x-=1;break;case keys.arrowRight:case 68:point.x+=1;break;case keys.arrowDown:case 83:point.y+=1;break;case keys.arrowUp:case 87:point.y-=1;break;case keys.space:case keys.escape:point=null;break;default:return}if(e.preventDefault(),null!==point){point=this.constrainToBgImg(point),drag.offset({left:point.x,top:point.y}),drag.data("pagex",drag.offset().left).data("pagey",drag.offset().top);var dragXY=this.convertToBgImgXY(new Shapes.Point(drag.data("pagex"),drag.data("pagey")));if(drag.data("originX",dragXY.x/this.bgRatio()).data("originY",dragXY.y/this.bgRatio()),this.coordsInBgImg(new Shapes.Point(drag.offset().left,drag.offset().top))&&drag.hasClass("unneeded")){this.sendDragToDrop(drag,!0);var hiddenDrag=this.getDragClone(drag);hiddenDrag.length&&hiddenDrag.addClass("active"),this.cloneDragIfNeeded(drag)}}else drag.css("left","").css("top",""),drag.data("pagex",drag.offset().left).data("pagey",drag.offset().top),this.sendDragHome(drag),this.removeDragIfNeeded(drag);drag.focus(),this.saveCoordsForChoice(choiceNo)},DragDropMarkersQuestion.prototype.constrainToBgImg=function(windowxy){var bgImg=this.bgImage(),bgImgXY=this.convertToBgImgXY(windowxy);return bgImgXY.x=Math.max(0,bgImgXY.x),bgImgXY.y=Math.max(0,bgImgXY.y),bgImgXY.x=Math.min(bgImg.width(),bgImgXY.x),bgImgXY.y=Math.min(bgImg.height(),bgImgXY.y),this.convertToWindowXY(bgImgXY)},DragDropMarkersQuestion.prototype.getChoiceNoFromElement=function(node){return Number(this.getClassnameNumericSuffix(node,"choice"))},DragDropMarkersQuestion.prototype.getClassnameNumericSuffix=function(node,prefix){var classes=$(node).attr("class");if(void 0!==classes&&""!==classes)for(var classesarr=classes.split(" "),index=0;index<classesarr.length;index++){if(new RegExp("^"+prefix+"([0-9])+$").test(classesarr[index])){var match=new RegExp("([0-9])+$").exec(classesarr[index]);return Number(match[0])}}return null},DragDropMarkersQuestion.prototype.handleResize=function(){var thisQ=this,bgRatio=this.bgRatio();this.isPrinting&&(bgRatio=1),this.getRoot().find("div.droparea .marker").not(".beingdragged").each((function(key,drag){$(drag).css("left",parseFloat($(drag).data("originX"))*parseFloat(bgRatio)).css("top",parseFloat($(drag).data("originY"))*parseFloat(bgRatio)),thisQ.handleElementScale(drag,"left top")})),this.getRoot().find("div.droparea svg.dropzones").width(this.bgImage().width()).height(this.bgImage().height());for(var dropZoneNo=0;dropZoneNo<this.visibleDropZones.length;dropZoneNo++){var originCoords=thisQ.visibleDropZones[dropZoneNo].coords,shape=thisQ.shapes[dropZoneNo],shapeSVG=thisQ.shapeSVGs[dropZoneNo];shape.parse(originCoords,bgRatio),shape.updateSvg(shapeSVG);var handles=shape.getHandlePositions(),markerSpan=this.getRoot().find("div.ddarea div.markertexts span.markertext"+dropZoneNo);markerSpan.css("left",handles.moveHandle.x-markerSpan.outerWidth()/2-4).css("top",handles.moveHandle.y-markerSpan.outerHeight()/2),thisQ.handleElementScale(markerSpan,"center")}},DragDropMarkersQuestion.prototype.cloneDrags=function(){var thisQ=this;this.getRoot().find("div.draghomes span.marker").each((function(index,draghome){var drag=$(draghome),placeHolder=drag.clone();placeHolder.removeClass(),placeHolder.addClass("marker"),placeHolder.addClass("choice"+thisQ.getChoiceNoFromElement(drag)),placeHolder.addClass(thisQ.getDragNoClass(drag,!1)),placeHolder.addClass("dragplaceholder"),drag.before(placeHolder)}))},DragDropMarkersQuestion.prototype.getDragNo=function(drag){return this.getClassnameNumericSuffix(drag,"dragno")},DragDropMarkersQuestion.prototype.getDragNoClass=function(drag,includeSelector){var className="dragno"+this.getDragNo(drag);return this.isInfiniteDrag(drag)&&(className="infinite"),includeSelector?"."+className:className},DragDropMarkersQuestion.prototype.getDragClone=function(drag){return this.getRoot().find(".draghomes span.marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)+".dragplaceholder")},DragDropMarkersQuestion.prototype.dropArea=function(){return this.getRoot().find("div.droparea")},DragDropMarkersQuestion.prototype.sendDragHome=function(drag){drag.removeClass("beingdragged").addClass("unneeded").css("top","").css("left","").css("transform","");var placeHolder=this.getDragClone(drag);placeHolder.after(drag),placeHolder.removeClass("active")},DragDropMarkersQuestion.prototype.sendDragToDrop=function(drag,isScaling){var dropArea=this.dropArea(),bgRatio=this.bgRatio();drag.removeClass("beingdragged").removeClass("unneeded");var dragXY=this.convertToBgImgXY(new Shapes.Point(drag.data("pagex"),drag.data("pagey")));isScaling?(drag.data("originX",dragXY.x/bgRatio).data("originY",dragXY.y/bgRatio),drag.css("left",dragXY.x).css("top",dragXY.y)):(drag.data("originX",dragXY.x).data("originY",dragXY.y),drag.css("left",dragXY.x*bgRatio).css("top",dragXY.y*bgRatio)),dropArea.append(drag),this.handleElementScale(drag,"left top")},DragDropMarkersQuestion.prototype.cloneDragIfNeeded=function(drag){var inputNode=this.getInput(drag),noOfDrags=Number(this.getClassnameNumericSuffix(inputNode,"noofdrags")),displayedDragsInDropArea=this.getRoot().find("div.droparea .marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)).length,displayedDragsInDragHomes=this.getRoot().find("div.draghomes .marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)).not(".dragplaceholder").length;if((this.isInfiniteDrag(drag)||!this.isInfiniteDrag(drag)&&displayedDragsInDropArea<noOfDrags)&&0===displayedDragsInDragHomes){var dragClone=drag.clone();dragClone.addClass("unneeded").css("top","").css("left","").css("transform",""),this.getDragClone(drag).removeClass("active").after(dragClone),questionManager.addEventHandlersToMarker(dragClone)}},DragDropMarkersQuestion.prototype.removeDragIfNeeded=function(drag){for(var dragsInHome=this.getRoot().find("div.draghomes .marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)).not(".dragplaceholder"),displayedDrags=dragsInHome.length;displayedDrags>1;)dragsInHome.first().remove(),displayedDrags--},DragDropMarkersQuestion.prototype.getInput=function(drag){var choiceNo=this.getChoiceNoFromElement(drag);return this.getRoot().find("input.choices.choice"+choiceNo)},DragDropMarkersQuestion.prototype.bgRatio=function(){var bgImg=this.bgImage(),bgImgNaturalWidth=bgImg.get(0).naturalWidth;return bgImg.width()/bgImgNaturalWidth},DragDropMarkersQuestion.prototype.handleElementScale=function(element,type){var bgRatio=parseFloat(this.bgRatio());this.isPrinting&&(bgRatio=1),$(element).css({"-webkit-transform":"scale("+bgRatio+")","-moz-transform":"scale("+bgRatio+")","-ms-transform":"scale("+bgRatio+")","-o-transform":"scale("+bgRatio+")",transform:"scale("+bgRatio+")","transform-origin":type})},DragDropMarkersQuestion.prototype.isInfiniteDrag=function(drag){return drag.hasClass("infinite")};var questionManager={eventHandlersInitialised:!1,isPrinting:!1,isKeyboardNavigation:!1,questions:{},init:function(containerId,readOnly,visibleDropZones){questionManager.questions[containerId]=new DragDropMarkersQuestion(containerId,readOnly,visibleDropZones),questionManager.eventHandlersInitialised||(questionManager.setupEventHandlers(),questionManager.eventHandlersInitialised=!0)},setupEventHandlers:function(){questionManager.addEventHandlersToMarker($(".que.ddmarker:not(.qtype_ddmarker-readonly) div.draghomes .marker")),questionManager.addEventHandlersToMarker($(".que.ddmarker:not(.qtype_ddmarker-readonly) div.droparea .marker")),$(window).on("resize",(function(){questionManager.handleWindowResize(!1)})),window.addEventListener("beforeprint",(function(){questionManager.isPrinting=!0,questionManager.handleWindowResize(questionManager.isPrinting)})),window.addEventListener("afterprint",(function(){questionManager.isPrinting=!1,questionManager.handleWindowResize(questionManager.isPrinting)})),setTimeout((function(){questionManager.fixLayoutIfThingsMoved()}),100)},addEventHandlersToMarker:function(element){element.on("mousedown touchstart",questionManager.handleDragStart).on("keydown keypress",questionManager.handleKeyPress).focusin((function(e){questionManager.handleKeyboardFocus(e,!0)})).focusout((function(e){questionManager.handleKeyboardFocus(e,!1)}))},handleDragStart:function(e){e.preventDefault();var question=questionManager.getQuestionForEvent(e);question&&question.handleDragStart(e)},handleKeyPress:function(e){var question=questionManager.getQuestionForEvent(e);question&&question.handleKeyPress(e)},handleWindowResize:function(isPrinting){for(var containerId in questionManager.questions)questionManager.questions.hasOwnProperty(containerId)&&(questionManager.questions[containerId].isPrinting=isPrinting,questionManager.questions[containerId].handleResize())},handleKeyboardFocus:function(e,isNavigating){questionManager.isKeyboardNavigation=isNavigating},fixLayoutIfThingsMoved:function(){questionManager.isKeyboardNavigation||this.handleWindowResize(questionManager.isPrinting),setTimeout((function(){questionManager.fixLayoutIfThingsMoved(questionManager.isPrinting)}),100)},getQuestionForEvent:function(e){var containerId=$(e.currentTarget).closest(".que.ddmarker").attr("id");return questionManager.questions[containerId]}};return{init:questionManager.init}}));
/**
 * JavaScript to make drag-drop into text questions work.
 *
 * Some vocabulary to help understand this code:
 *
 * The question text contains 'drops' - blanks into which the 'drags', the missing
 * words, can be put.
 *
 * The thing that can be moved into the drops are called 'drags'. There may be
 * multiple copies of the 'same' drag which does not really cause problems.
 * Each drag has a 'choice' number which is the value set on the drop's hidden
 * input when this drag is placed in a drop.
 *
 * These may be in separate 'groups', distinguished by colour.
 * Things can only interact with other things in the same group.
 * The groups are numbered from 1.
 *
 * The place where a given drag started from is called its 'home'.
 *
 * @module     qtype_ddwtos/ddwtos
 * @package    qtype_ddwtos
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.6
 */
define("qtype_ddwtos/ddwtos",["jquery","core/dragdrop","core/key_codes"],(function($,dragDrop,keys){function DragDropToTextQuestion(containerId,readOnly){this.containerId=containerId,readOnly&&this.getRoot().addClass("qtype_ddwtos-readonly"),this.resizeAllDragsAndDrops(),this.cloneDrags(),this.positionDrags()}DragDropToTextQuestion.prototype.resizeAllDragsAndDrops=function(){var thisQ=this;this.getRoot().find(".answercontainer > div").each((function(i,node){thisQ.resizeAllDragsAndDropsInGroup(thisQ.getClassnameNumericSuffix($(node),"draggrouphomes"))}))},DragDropToTextQuestion.prototype.resizeAllDragsAndDropsInGroup=function(group){var thisQ=this,dragHomes=this.getRoot().find(".draggrouphomes"+group+" span.draghome"),maxWidth=0,maxHeight=0;dragHomes.each((function(i,drag){maxWidth=Math.max(maxWidth,Math.ceil(drag.offsetWidth)),maxHeight=Math.max(maxHeight,Math.ceil(0+drag.offsetHeight))})),maxWidth+=8,maxHeight+=2,dragHomes.each((function(i,drag){thisQ.setElementSize(drag,maxWidth,maxHeight)})),this.getRoot().find("span.drop.group"+group).each((function(i,drop){thisQ.setElementSize(drop,maxWidth,maxHeight)}))},DragDropToTextQuestion.prototype.setElementSize=function(element,width,height){$(element).width(width).height(height).css("lineHeight",height+"px")},DragDropToTextQuestion.prototype.cloneDrags=function(){var thisQ=this;thisQ.getRoot().find("span.draghome").each((function(index,draghome){var drag=$(draghome),placeHolder=drag.clone();placeHolder.removeClass(),placeHolder.addClass("draghome choice"+thisQ.getChoice(drag)+" group"+thisQ.getGroup(drag)+" dragplaceholder"),drag.before(placeHolder)}))},DragDropToTextQuestion.prototype.positionDrags=function(){var thisQ=this,root=this.getRoot();root.find("span.draghome").not(".dragplaceholder").each((function(i,dragNode){var drag=$(dragNode),currentPlace=thisQ.getClassnameNumericSuffix(drag,"inplace");drag.addClass("unplaced").removeClass("placed"),drag.removeAttr("tabindex"),null!==currentPlace&&drag.removeClass("inplace"+currentPlace)})),root.find("input.placeinput").each((function(i,inputNode){var input=$(inputNode),choice=input.val(),place=thisQ.getPlace(input),drop=root.find(".drop.place"+place),dropPosition=drop.offset();if(drop.data("prev-top",dropPosition.top).data("prev-left",dropPosition.left),"0"!==choice){var unplacedDrag=thisQ.getUnplacedChoice(thisQ.getGroup(input),choice),hiddenDrag=thisQ.getDragClone(unplacedDrag);if(hiddenDrag.length)if(unplacedDrag.hasClass("infinite")){var noOfDrags=thisQ.noOfDropsInGroup(thisQ.getGroup(unplacedDrag));if(thisQ.getInfiniteDragClones(unplacedDrag,!1).length<noOfDrags){var cloneDrag=unplacedDrag.clone();hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag)}else hiddenDrag.addClass("active")}else hiddenDrag.addClass("active");thisQ.sendDragToDrop(thisQ.getUnplacedChoice(thisQ.getGroup(input),choice),drop)}}))},DragDropToTextQuestion.prototype.handleDragStart=function(e){var thisQ=this,drag=$(e.target).closest(".draghome");if(dragDrop.prepare(e).start){drag.addClass("beingdragged");var currentPlace=this.getClassnameNumericSuffix(drag,"inplace");if(null!==currentPlace){this.setInputValue(currentPlace,0),drag.removeClass("inplace"+currentPlace);var hiddenDrop=thisQ.getDrop(drag,currentPlace);hiddenDrop.length&&(hiddenDrop.addClass("active"),drag.offset(hiddenDrop.offset()))}else{var hiddenDrag=thisQ.getDragClone(drag);if(hiddenDrag.length)if(drag.hasClass("infinite")){var noOfDrags=this.noOfDropsInGroup(this.getGroup(drag));if(this.getInfiniteDragClones(drag,!1).length<noOfDrags){var cloneDrag=drag.clone();cloneDrag.removeClass("beingdragged"),hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag),drag.offset(cloneDrag.offset())}else hiddenDrag.addClass("active"),drag.offset(hiddenDrag.offset())}else hiddenDrag.addClass("active"),drag.offset(hiddenDrag.offset())}dragDrop.start(e,drag,(function(x,y,drag){thisQ.dragMove(x,y,drag)}),(function(x,y,drag){thisQ.dragEnd(x,y,drag)}))}},DragDropToTextQuestion.prototype.dragMove=function(pageX,pageY,drag){var thisQ=this;this.getRoot().find("span.drop.group"+this.getGroup(drag)).each((function(i,dropNode){var drop=$(dropNode);thisQ.isPointInDrop(pageX,pageY,drop)?drop.addClass("valid-drag-over-drop"):drop.removeClass("valid-drag-over-drop")})),this.getRoot().find("span.draghome.placed.group"+this.getGroup(drag)).not(".beingdragged").each((function(i,dropNode){var drop=$(dropNode);thisQ.isPointInDrop(pageX,pageY,drop)&&!thisQ.isDragSameAsDrop(drag,drop)?drop.addClass("valid-drag-over-drop"):drop.removeClass("valid-drag-over-drop")}))},DragDropToTextQuestion.prototype.dragEnd=function(pageX,pageY,drag){var thisQ=this,root=this.getRoot(),placed=!1;root.find("span.drop.group"+this.getGroup(drag)).each((function(i,dropNode){var drop=$(dropNode);return!thisQ.isPointInDrop(pageX,pageY,drop)||(drop.removeClass("valid-drag-over-drop"),thisQ.sendDragToDrop(drag,drop),placed=!0,!1)})),root.find("span.draghome.placed.group"+this.getGroup(drag)).not(".beingdragged").each((function(i,placedNode){var placedDrag=$(placedNode);if(!thisQ.isPointInDrop(pageX,pageY,placedDrag)||thisQ.isDragSameAsDrop(drag,placedDrag))return!0;placedDrag.removeClass("valid-drag-over-drop");var currentPlace=thisQ.getClassnameNumericSuffix(placedDrag,"inplace"),drop=thisQ.getDrop(drag,currentPlace);return thisQ.sendDragToDrop(drag,drop),placed=!0,!1})),placed||this.sendDragHome(drag)},DragDropToTextQuestion.prototype.sendDragToDrop=function(drag,drop){var oldDrag=this.getCurrentDragInPlace(this.getPlace(drop));if(0!==oldDrag.length){var currentPlace=this.getClassnameNumericSuffix(oldDrag,"inplace"),hiddenDrop=this.getDrop(oldDrag,currentPlace);hiddenDrop.addClass("active"),oldDrag.addClass("beingdragged"),oldDrag.offset(hiddenDrop.offset()),this.sendDragHome(oldDrag)}0===drag.length?(this.setInputValue(this.getPlace(drop),0),drop.data("isfocus")&&drop.focus()):(this.setInputValue(this.getPlace(drop),this.getChoice(drag)),drag.removeClass("unplaced").addClass("placed inplace"+this.getPlace(drop)),drag.attr("tabindex",0),this.animateTo(drag,drop))},DragDropToTextQuestion.prototype.sendDragHome=function(drag){var currentPlace=this.getClassnameNumericSuffix(drag,"inplace");null!==currentPlace&&drag.removeClass("inplace"+currentPlace),drag.data("unplaced",!0),this.animateTo(drag,this.getDragHome(this.getGroup(drag),this.getChoice(drag)))},DragDropToTextQuestion.prototype.handleKeyPress=function(e){var drop=$(e.target).closest(".drop");if(0===drop.length){var placedDrag=$(e.target),currentPlace=this.getClassnameNumericSuffix(placedDrag,"inplace");null!==currentPlace&&(drop=this.getDrop(placedDrag,currentPlace))}var currentDrag=this.getCurrentDragInPlace(this.getPlace(drop)),nextDrag=$();switch(e.keyCode){case keys.space:case keys.arrowRight:case keys.arrowDown:nextDrag=this.getNextDrag(this.getGroup(drop),currentDrag);break;case keys.arrowLeft:case keys.arrowUp:nextDrag=this.getPreviousDrag(this.getGroup(drop),currentDrag);break;case keys.escape:break;default:return void(questionManager.isKeyboardNavigation=!1)}if(nextDrag.length){nextDrag.data("isfocus",!0),nextDrag.addClass("beingdragged");var hiddenDrag=this.getDragClone(nextDrag);if(hiddenDrag.length)if(nextDrag.hasClass("infinite")){var noOfDrags=this.noOfDropsInGroup(this.getGroup(nextDrag));if(this.getInfiniteDragClones(nextDrag,!1).length<noOfDrags){var cloneDrag=nextDrag.clone();cloneDrag.removeClass("beingdragged"),cloneDrag.removeAttr("tabindex"),hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag),nextDrag.offset(cloneDrag.offset())}else hiddenDrag.addClass("active"),nextDrag.offset(hiddenDrag.offset())}else hiddenDrag.addClass("active"),nextDrag.offset(hiddenDrag.offset())}else drop.data("isfocus",!0);e.preventDefault(),this.sendDragToDrop(nextDrag,drop)},DragDropToTextQuestion.prototype.getNextDrag=function(group,drag){var choice,numChoices=this.noOfChoicesInGroup(group);choice=0===drag.length?1:this.getChoice(drag)+1;for(var next=this.getUnplacedChoice(group,choice);0===next.length&&choice<numChoices;)choice++,next=this.getUnplacedChoice(group,choice);return next},DragDropToTextQuestion.prototype.getPreviousDrag=function(group,drag){var choice;choice=0===drag.length?this.noOfChoicesInGroup(group):this.getChoice(drag)-1;for(var previous=this.getUnplacedChoice(group,choice);0===previous.length&&choice>1;)choice--,previous=this.getUnplacedChoice(group,choice);return previous},DragDropToTextQuestion.prototype.animateTo=function(drag,target){var currentPos=drag.offset(),targetPos=target.offset(),thisQ=this;M.util.js_pending("qtype_ddwtos-animate-"+thisQ.containerId),drag.animate({left:parseInt(drag.css("left"))+targetPos.left-currentPos.left,top:parseInt(drag.css("top"))+targetPos.top-currentPos.top},{duration:"fast",done:function(){$("body").trigger("qtype_ddwtos-dragmoved",[drag,target,thisQ]),M.util.js_complete("qtype_ddwtos-animate-"+thisQ.containerId)}})},DragDropToTextQuestion.prototype.isPointInDrop=function(pageX,pageY,drop){var position=drop.offset();return pageX>=position.left&&pageX<position.left+drop.width()&&pageY>=position.top&&pageY<position.top+drop.height()},DragDropToTextQuestion.prototype.setInputValue=function(place,choice){this.getRoot().find("input.placeinput.place"+place).val(choice)},DragDropToTextQuestion.prototype.getRoot=function(){return $(document.getElementById(this.containerId))},DragDropToTextQuestion.prototype.getDragHome=function(group,choice){return this.getRoot().find(".draghome.dragplaceholder.group"+group+".choice"+choice).is(":visible")?this.getRoot().find(".draghome.dragplaceholder.group"+group+".choice"+choice):this.getRoot().find(".draggrouphomes"+group+" span.draghome.infinite.choice"+choice+".group"+group)},DragDropToTextQuestion.prototype.getUnplacedChoice=function(group,choice){return this.getRoot().find(".draghome.group"+group+".choice"+choice+".unplaced").slice(0,1)},DragDropToTextQuestion.prototype.getCurrentDragInPlace=function(place){return this.getRoot().find("span.draghome.inplace"+place)},DragDropToTextQuestion.prototype.noOfDropsInGroup=function(group){return this.getRoot().find(".drop.group"+group).length},DragDropToTextQuestion.prototype.noOfChoicesInGroup=function(group){return this.getRoot().find(".draghome.group"+group).length},DragDropToTextQuestion.prototype.getClassnameNumericSuffix=function(node,prefix){var classes=node.attr("class");if(""!==classes)for(var classesArr=classes.split(" "),index=0;index<classesArr.length;index++){if(new RegExp("^"+prefix+"([0-9])+$").test(classesArr[index])){var match=new RegExp("([0-9])+$").exec(classesArr[index]);return Number(match[0])}}return null},DragDropToTextQuestion.prototype.getChoice=function(drag){return this.getClassnameNumericSuffix(drag,"choice")},DragDropToTextQuestion.prototype.getGroup=function(node){return this.getClassnameNumericSuffix(node,"group")},DragDropToTextQuestion.prototype.getPlace=function(node){return this.getClassnameNumericSuffix(node,"place")},DragDropToTextQuestion.prototype.getDragClone=function(drag){return this.getRoot().find(".draggrouphomes"+this.getGroup(drag)+" span.draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".dragplaceholder")},DragDropToTextQuestion.prototype.getInfiniteDragClones=function(drag,inHome){return inHome?this.getRoot().find(".draggrouphomes"+this.getGroup(drag)+" span.draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".infinite").not(".dragplaceholder"):this.getRoot().find("span.draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".infinite").not(".dragplaceholder")},DragDropToTextQuestion.prototype.getDrop=function(drag,currentPlace){return this.getRoot().find(".drop.group"+this.getGroup(drag)+".place"+currentPlace)},DragDropToTextQuestion.prototype.isDragSameAsDrop=function(drag,drop){return this.getChoice(drag)===this.getChoice(drop)&&this.getGroup(drag)===this.getGroup(drop)};var questionManager={eventHandlersInitialised:!1,isKeyboardNavigation:!1,questions:{},init:function(containerId,readOnly){questionManager.questions[containerId]=new DragDropToTextQuestion(containerId,readOnly),questionManager.eventHandlersInitialised||(questionManager.setupEventHandlers(),questionManager.eventHandlersInitialised=!0)},setupEventHandlers:function(){questionManager.addEventHandlersToDrag($(".que.ddwtos:not(.qtype_ddwtos-readonly) span.draghome")),$("body").on("keydown",".que.ddwtos:not(.qtype_ddwtos-readonly) span.drop",questionManager.handleKeyPress).on("keydown",".que.ddwtos:not(.qtype_ddwtos-readonly) span.draghome.placed:not(.beingdragged)",questionManager.handleKeyPress).on("qtype_ddwtos-dragmoved",questionManager.handleDragMoved)},addEventHandlersToDrag:function(element){element.unbind("mousedown touchstart"),element.on("mousedown touchstart",questionManager.handleDragStart)},handleDragStart:function(e){e.preventDefault();var question=questionManager.getQuestionForEvent(e);question&&question.handleDragStart(e)},handleKeyPress:function(e){if(!questionManager.isKeyboardNavigation){questionManager.isKeyboardNavigation=!0;var question=questionManager.getQuestionForEvent(e);question&&question.handleKeyPress(e)}},getQuestionForEvent:function(e){var containerId=$(e.currentTarget).closest(".que.ddwtos").attr("id");return questionManager.questions[containerId]},handleDragMoved:function(e,drag,target,thisQ){drag.removeClass("beingdragged"),drag.css("top","").css("left",""),target.after(drag),target.removeClass("active"),void 0!==drag.data("unplaced")&&!0===drag.data("unplaced")&&(drag.removeClass("placed").addClass("unplaced"),drag.removeAttr("tabindex"),drag.removeData("unplaced"),drag.hasClass("infinite")&&thisQ.getInfiniteDragClones(drag,!0).length>1&&thisQ.getInfiniteDragClones(drag,!0).first().remove()),void 0!==drag.data("isfocus")&&!0===drag.data("isfocus")&&(drag.focus(),drag.removeData("isfocus")),void 0!==target.data("isfocus")&&!0===target.data("isfocus")&&target.removeData("isfocus"),questionManager.isKeyboardNavigation&&(questionManager.isKeyboardNavigation=!1)}};return{init:questionManager.init}}));
define("qtype_multichoice/answers",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Handles events related to the multiple-choice question type answers.
   *
   * @module     qtype_multichoice/answers
   * @package    qtype_multichoice
   * @copyright  2020 Jun Pataleta <jun@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var SELECTORS_ANSWER_LABEL="[data-region=answer-label]",_default={init:function(rootId){var root=document.getElementById(rootId);root.querySelectorAll(SELECTORS_ANSWER_LABEL).forEach((function(answerLabel){answerLabel.addEventListener("click",(function(e){var labelId=e.currentTarget.id;root.querySelector('[aria-labelledby="'.concat(labelId,'"]')).click()}))}))}};return _exports.default=_default,_exports.default}));
/**
 * Manages 'Clear my choice' functionality actions.
 *
 * @module     qtype_multichoice/clearchoice
 * @copyright  2019 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.7
 */
define("qtype_multichoice/clearchoice",["jquery","core/custom_interaction_events"],(function($,CustomEvents){var SELECTORS_CHOICE_ELEMENT=".answer input",SELECTORS_LINK="a",SELECTORS_RADIO='input[type="radio"]',registerEventListeners=function(root,fieldPrefix){var clearChoiceContainer=function(root,fieldPrefix){return root.find('div[id="'+fieldPrefix+'"]')}(root,fieldPrefix);clearChoiceContainer.on(CustomEvents.events.activate,SELECTORS_LINK,(function(e,data){!function(clearChoiceContainer){clearChoiceContainer.find(SELECTORS_RADIO).prop("disabled",!1).prop("checked",!0)}(clearChoiceContainer),function(clearChoiceContainer){clearChoiceContainer.addClass("sr-only"),clearChoiceContainer.attr("aria-hidden",!0),clearChoiceContainer.find(SELECTORS_LINK).attr("tabindex",-1)}(clearChoiceContainer),data.originalEvent.preventDefault()})),root.on("change",SELECTORS_CHOICE_ELEMENT,(function(){!function(clearChoiceContainer){clearChoiceContainer.removeClass("sr-only"),clearChoiceContainer.removeAttr("aria-hidden"),clearChoiceContainer.find(SELECTORS_LINK).attr("tabindex",0),clearChoiceContainer.find(SELECTORS_RADIO).prop("disabled",!0)}(clearChoiceContainer)})),clearChoiceContainer.find(SELECTORS_RADIO).focus((function(){root.find(SELECTORS_CHOICE_ELEMENT).first().focus()}))};return{init:function(root,fieldPrefix){root=$("#"+root),registerEventListeners(root,fieldPrefix)}}}));
define('qtype_ordering/dragdrop', ["jquery","qtype_ordering/autoscroll"],function(a,b){var c={eventCaptureOptions:{passive:!1,capture:!0},dragProxy:null,onMove:null,onDrop:null,initialPosition:null,initialX:null,initialY:null,touching:null,prepare:function(a){a.preventDefault();var b;if(b="touchstart"===a.type?null===c.touching&&a.changedTouches.length>0:1===a.which){var d=c.getEventXY(a);return d.start=!0,d}return{start:!1}},start:function(a,d,e,f){var g=c.getEventXY(a);switch(c.initialX=g.x,c.initialY=g.y,c.initialPosition=d.offset(),c.dragProxy=d,c.onMove=e,c.onDrop=f,a.type){case"mousedown":c.addEventSpecial("mousemove",c.mouseMove),c.addEventSpecial("mouseup",c.mouseUp);break;case"touchstart":c.addEventSpecial("touchend",c.touchEnd),c.addEventSpecial("touchcancel",c.touchEnd),c.addEventSpecial("touchmove",c.touchMove),c.touching=a.changedTouches[0].identifier;break;default:throw new Error("Unexpected event type: "+a.type)}b.start(c.scroll)},addEventSpecial:function(a,b){try{window.addEventListener(a,b,c.eventCaptureOptions)}catch(d){c.eventCaptureOptions=!0,window.addEventListener(a,b,c.eventCaptureOptions)}},getEventXY:function(a){switch(a.type){case"touchstart":return{x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY};case"mousedown":return{x:a.pageX,y:a.pageY};default:throw new Error("Unexpected event type: "+a.type)}},touchMove:function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)a.changedTouches[b].identifier===c.touching&&c.handleMove(a.changedTouches[b].pageX,a.changedTouches[b].pageY)},mouseMove:function(a){c.handleMove(a.pageX,a.pageY)},handleMove:function(b,d){var e=c.dragProxy.offset(),f=e.top-parseInt(c.dragProxy.css("top")),g=e.left-parseInt(c.dragProxy.css("left")),h=a(document).height()-c.dragProxy.outerHeight()-f,i=a(document).width()-c.dragProxy.outerWidth()-g,j=-f,k=-g,l=c.initialPosition,m={top:Math.max(j,Math.min(h,l.top+(d-c.initialY)-f)),left:Math.max(k,Math.min(i,l.left+(b-c.initialX)-g))};c.dragProxy.css(m),c.onMove(b,d,c.dragProxy)},touchEnd:function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)a.changedTouches[b].identifier===c.touching&&c.handleEnd(a.changedTouches[b].pageX,a.changedTouches[b].pageY)},mouseUp:function(a){c.handleEnd(a.pageX,a.pageY)},handleEnd:function(a,d){null!==c.touching?(window.removeEventListener("touchend",c.touchEnd,c.eventCaptureOptions),window.removeEventListener("touchcancel",c.touchEnd,c.eventCaptureOptions),window.removeEventListener("touchmove",c.touchMove,c.eventCaptureOptions),c.touching=null):(window.removeEventListener("mousemove",c.mouseMove,c.eventCaptureOptions),window.removeEventListener("mouseup",c.mouseUp,c.eventCaptureOptions)),b.stop(),c.onDrop(a,d,c.dragProxy)},scroll:function(b){var d=a(document).height()-c.dragProxy.outerHeight(),e=c.dragProxy.offset();e.top=Math.min(d,e.top+b),c.dragProxy.css(e)}};return{prepare:c.prepare,start:c.start}});
define('qtype_ordering/key_codes', [],function(){return{tab:9,enter:13,escape:27,space:32,end:35,home:36,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,8:56,asterix:106,pageUp:33,pageDown:34}});
define ("qtype_ordering/reorder",["jquery","qtype_ordering/drag_reorder"],function(a,b){return{init:function init(c,d){new b({list:"ul#"+c,item:"li.sortableitem",proxyHtml:"<div class=\"que ordering dragproxy\"><ul class=\"%%LIST_CLASS_NAME%%\"><li class=\"%%ITEM_CLASS_NAME%% item-moving\">%%ITEM_HTML%%</li></ul></div>",itemMovingClass:"current-drop",idGetter:function idGetter(b){return a(b).attr("id")},nameGetter:function nameGetter(b){return a(b).text},reorderStart:function reorderStart(){},reorderEnd:function reorderEnd(){},reorderDone:function reorderDone(b,c,e){a("input#"+d)[0].value=e.join(",")}})}}});
define ("qtype_ordering/drag_reorder",["jquery",require.specified("core/dragdrop")?"core/dragdrop":"qtype_ordering/dragdrop",require.specified("core/key_codes")?"core/key_codes":"qtype_ordering/key_codes"],function(a,b,c){return function(d){var e=null,f=null,g=null,h=null,j=null,k=null,l=function(c,h){k=a(d.list);e={time:new Date().getTime(),x:h.x,y:h.y};g=a(c.currentTarget).closest(d.itemInPage);if("undefined"!=typeof d.reorderStart){d.reorderStart(g.closest(d.list),g)}f=t();j=a(d.proxyHtml.replace("%%ITEM_HTML%%",g.html()).replace("%%ITEM_CLASS_NAME%%",g.attr("class")).replace("%%LIST_CLASS_NAME%%",k.attr("class")));a(document.body).append(j);j.css("position","absolute");j.css(g.offset());j.width(g.outerWidth());j.height(g.outerHeight());g.addClass(d.itemMovingClass);n(g);b.start(c,j,m,o)},m=function(){var b=g.closest(d.list),c=null,e=null;b.find(d.item).each(function(b,d){var f=s(d,j);if(null===c||f<e){c=a(d);e=f}});if(c[0]===g[0]){return}if(r(j)<r(c)){g.insertBefore(c)}else{g.insertAfter(c)}n(g)},n=function(a){for(var b=a.closest("ol, ul"),c=b.find("li"),d=c.length,e=0;e<d;++e){if(a[0]===c[e]){j.find("li").attr("value",e+1);break}}},o=function(a,b){if("undefined"!=typeof d.reorderEnd){d.reorderEnd(g.closest(d.list),g)}var c=t();if(!u(f,c)){d.reorderDone(g.closest(d.list),g,c)}else if(500>new Date().getTime()-e.time&&10>Math.abs(e.x-a)&&10>Math.abs(e.y-b)){g[0].focus()}j.remove();j=null;g.removeClass(d.itemMovingClass);g=null;e=null},p=function(a,b){switch(a.keyCode){case c.space:case c.arrowRight:case c.arrowDown:a.preventDefault();a.stopPropagation();var d=b.next();if(d.length){d.insertBefore(b)}break;case c.arrowLeft:case c.arrowUp:a.preventDefault();a.stopPropagation();var e=b.prev();if(e.length){e.insertAfter(b)}break;}},q=function(a){return a.offset().left+a.outerWidth()/2},r=function(a){return a.offset().top+a.outerHeight()/2},s=function(b,c){var d=a(b),e=a(c),f=q(d)-q(e),g=r(d)-r(e);return Math.sqrt(f*f+g*g)},t=function(){return(g||h).closest(d.list).find(d.item).map(function(a,b){return d.idGetter(b)}).get()},u=function(a,b){return a.length===b.length&&a.every(function(a,c){return a===b[c]})};d.itemInPage=function combineSelectors(a,b){var c=[];a.split(",").forEach(function(a){b.split(",").forEach(function(b){c.push(a.trim()+" "+b.trim())})});return c.join(", ")}(d.list,d.item);a(d.list).on("mousedown touchstart",d.item,function(a){var c=b.prepare(a);if(c.start){l(a,c)}});a(d.list).on("keydown",d.item,function(b){h=a(b.currentTarget).closest(d.itemInPage);f=t();p(b,h);var c=t();if(!u(f,c)){d.reorderDone(h.closest(d.list),h,c)}});a(d.itemInPage).attr("tabindex","0")}});
define('qtype_ordering/autoscroll', ["jquery"],function(a){var b={SCROLL_THRESHOLD:30,SCROLL_FREQUENCY:1e3/60,SCROLL_SPEED:.5,scrollingId:null,scrollAmount:0,callback:null,start:function(c){a(window).on("mousemove",b.mouseMove),a(window).on("touchmove",b.touchMove),b.callback=c},stop:function(){a(window).off("mousemove",b.mouseMove),a(window).off("touchmove",b.touchMove),null!==b.scrollingId&&b.stopScrolling()},touchMove:function(a){for(var c=0;c<a.changedTouches.length;c++)b.handleMove(a.changedTouches[c].clientX,a.changedTouches[c].clientY)},mouseMove:function(a){b.handleMove(a.clientX,a.clientY)},handleMove:function(c,d){d<b.SCROLL_THRESHOLD?b.scrollAmount=-Math.min(b.SCROLL_THRESHOLD-d,b.SCROLL_THRESHOLD):d>a(window).height()-b.SCROLL_THRESHOLD?b.scrollAmount=Math.min(d-(a(window).height()-b.SCROLL_THRESHOLD),b.SCROLL_THRESHOLD):b.scrollAmount=0,b.scrollAmount&&null===b.scrollingId?b.startScrolling():b.scrollAmount||null===b.scrollingId||b.stopScrolling()},startScrolling:function(){var c=a(document).height()-a(window).height();b.scrollingId=window.setInterval(function(){var d=a(window).scrollTop(),e=Math.round(b.scrollAmount*b.SCROLL_SPEED);if(d+e<0&&(e=-d),d+e>c&&(e=c-d),0!==e){a(window).scrollTop(d+e);var f=a(window).scrollTop()-d;0!==f&&b.callback&&b.callback(f)}},b.SCROLL_FREQUENCY)},stopScrolling:function(){window.clearInterval(b.scrollingId),b.scrollingId=null}};return{start:b.start,stop:b.stop}});
/**
 * Javascript controller for the "User summary" panel at the top of the page.
 *
 * @module     mod_assign/grading_navigation_user_info
 * @package    mod_assign
 * @class      UserInfo
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_navigation_user_info",["jquery","core/notification","core/ajax","core/templates"],(function($,notification,ajax,templates){var UserInfo=function(selector){this._regionSelector=selector,this._region=$(selector),this._userCache={},$(document).on("user-changed",this._refreshUserInfo.bind(this))};return UserInfo.prototype._regionSelector=null,UserInfo.prototype._userCache=null,UserInfo.prototype._region=null,UserInfo.prototype._lastUserId=0,UserInfo.prototype._getAssignmentId=function(){return this._region.attr("data-assignmentid")},UserInfo.prototype._refreshUserInfo=function(event,userid){var promise=$.Deferred();this._region.attr("data-userid",userid),this._lastUserId!=userid&&(this._lastUserId=userid,templates.render("mod_assign/loading",{}).done(function(html,js){if(this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js),this._region.fadeIn("fast")}.bind(this)),userid<0)templates.render("mod_assign/grading_navigation_no_users",{}).done(function(html,js){userid==this._lastUserId&&this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(notification.exception);else{if(void 0!==this._userCache[userid])promise.resolve(this._userCache[userid]);else{var assignmentId=this._getAssignmentId();ajax.call([{methodname:"mod_assign_get_participant",args:{userid:userid,assignid:assignmentId,embeduser:!0}}])[0].done(function(participant){participant.hasOwnProperty("id")?(this._userCache[userid]=participant,promise.resolve(this._userCache[userid])):promise.reject("No users")}.bind(this)).fail(notification.exception)}promise.done(function(context){var identityfields=$("[data-showuseridentity]").data("showuseridentity").split(","),identity=[];context.courseid=$('[data-region="grading-navigation-panel"]').attr("data-courseid"),context.user&&($.each(identityfields,(function(i,k){void 0!==context.user[k]&&""!==context.user[k]&&(context.hasidentity=!0,identity.push(context.user[k]))})),context.identity=identity.join(", "),context.user.profileimageurl&&(context.profileimageurl=context.user.profileimageurl)),templates.render("mod_assign/grading_navigation_user_summary",context).done(function(html,js){userid==this._lastUserId&&this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(notification.exception)}.bind(this)).fail(function(){templates.render("mod_assign/grading_navigation_no_users",{}).done(function(html,js){this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(notification.exception)}.bind(this))}}.bind(this)).fail(notification.exception))},UserInfo}));
/**
 * Javascript controller for the "Actions" panel at the bottom of the page.
 *
 * @module     mod_assign/grading_actions
 * @package    mod_assign
 * @class      GradingActions
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_actions",["jquery","mod_assign/grading_events"],(function($,GradingEvents){var GradingActions=function(selector){this._regionSelector=selector,this._region=$(selector),this.registerEventListeners()};return GradingActions.prototype._regionSelector=null,GradingActions.prototype._lastUserId=0,GradingActions.prototype._region=null,GradingActions.prototype._showActionsForm=function(event,userid){var form=this._region.find("[data-region=grading-actions-form]");userid!=this._lastUserId&&userid>0&&(this._lastUserId=userid),userid>0?form.removeClass("hide"):form.addClass("hide")},GradingActions.prototype._trigger=function(action){$(document).trigger(action)},GradingActions.prototype.getReviewPanelElement=function(){return $('[data-region="review-panel"]')},GradingActions.prototype.hasReviewPanelElement=function(){return this.getReviewPanelElement().length>0},GradingActions.prototype.getCollapseGradePanelButton=function(){return $('[data-region="grade-actions"] .collapse-grade-panel')},GradingActions.prototype.getCollapseReviewPanelButton=function(){return $('[data-region="grade-actions"] .collapse-review-panel')},GradingActions.prototype.getExpandAllPanelsButton=function(){return $('[data-region="grade-actions"] .collapse-none')},GradingActions.prototype.resetLayoutButtons=function(){this.getCollapseGradePanelButton().removeClass("active"),this.getCollapseReviewPanelButton().removeClass("active"),this.getExpandAllPanelsButton().removeClass("active")},GradingActions.prototype.collapseReviewPanel=function(){$(document).trigger(GradingEvents.COLLAPSE_REVIEW_PANEL),$(document).trigger(GradingEvents.EXPAND_GRADE_PANEL),this.resetLayoutButtons(),this.getCollapseReviewPanelButton().addClass("active")},GradingActions.prototype.collapseGradePanel=function(){$(document).trigger(GradingEvents.COLLAPSE_GRADE_PANEL),$(document).trigger(GradingEvents.EXPAND_REVIEW_PANEL),this.resetLayoutButtons(),this.getCollapseGradePanelButton().addClass("active")},GradingActions.prototype.expandAllPanels=function(){$(document).trigger(GradingEvents.EXPAND_GRADE_PANEL),$(document).trigger(GradingEvents.EXPAND_REVIEW_PANEL),this.resetLayoutButtons(),this.getExpandAllPanelsButton().addClass("active")},GradingActions.prototype.registerEventListeners=function(){if(this.hasReviewPanelElement()){var collapseReviewPanelButton=this.getCollapseReviewPanelButton();collapseReviewPanelButton.click(function(e){this.collapseReviewPanel(),e.preventDefault()}.bind(this)),collapseReviewPanelButton.keydown(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||13!==e.keyCode&&32!==e.keyCode||(this.collapseReviewPanel(),e.preventDefault())}.bind(this));var collapseGradePanelButton=this.getCollapseGradePanelButton();collapseGradePanelButton.click(function(e){this.collapseGradePanel(),e.preventDefault()}.bind(this)),collapseGradePanelButton.keydown(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||13!==e.keyCode&&32!==e.keyCode||(this.collapseGradePanel(),e.preventDefault())}.bind(this));var expandAllPanelsButton=this.getExpandAllPanelsButton();expandAllPanelsButton.click(function(e){this.expandAllPanels(),e.preventDefault()}.bind(this)),expandAllPanelsButton.keydown(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||13!==e.keyCode&&32!==e.keyCode||(this.expandAllPanels(),e.preventDefault())}.bind(this))}$(document).on("user-changed",this._showActionsForm.bind(this)),this._region.find('[name="savechanges"]').on("click",this._trigger.bind(this,"save-changes")),this._region.find('[name="saveandshownext"]').on("click",this._trigger.bind(this,"save-and-show-next")),this._region.find('[name="resetbutton"]').on("click",this._trigger.bind(this,"reset")),this._region.find("form").on("submit",(function(e){e.preventDefault()}))},GradingActions}));
/**
 * Custom auto-complete adapter to load users from the assignment list_participants webservice.
 *
 * @module     mod_assign/participants_selector
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_assign/participant_selector",["core/ajax","jquery","core/templates"],(function(ajax,$,templates){return{processResults:function(selector,data){return data},transport:function(selector,query,success,failure){var assignmentid=$(selector).attr("data-assignmentid"),groupid=$(selector).attr("data-groupid"),filters=$('[data-region="configure-filters"] input[type="checkbox"]'),filterstrings=[];filters.each((function(index,element){filterstrings[$(element).attr("name")]=$(element).prop("checked")})),ajax.call([{methodname:"mod_assign_list_participants",args:{assignid:assignmentid,groupid:groupid,filter:query,limit:30,includeenrolments:!1,tablesort:!0}}])[0].then((function(results){var promises=[],identityfields=$("[data-showuseridentity]").data("showuseridentity").split(",");return $.each(results,(function(index,user){var ctx=user,identity=[],show=!0;filterstrings.filter_submitted&&!user.submitted&&(show=!1),filterstrings.filter_notsubmitted&&user.submitted&&(show=!1),filterstrings.filter_requiregrading&&!user.requiregrading&&(show=!1),filterstrings.filter_grantedextension&&!user.grantedextension&&(show=!1),show&&($.each(identityfields,(function(i,k){void 0!==user[k]&&""!==user[k]&&(ctx.hasidentity=!0,identity.push(user[k]))})),ctx.identity=identity.join(", "),promises.push(templates.render("mod_assign/list_participant_user_summary",ctx).then((function(html){return{value:user.id,label:html}}))))})),$.when.apply($,promises)})).then((function(){var users=[];arguments[0]&&(users=Array.prototype.slice.call(arguments)),success(users)})).catch(failure)}}}));
/**
 * Javascript controller for the "Review" panel at the left of the page.
 *
 * @module     mod_assign/grading_review_panel
 * @package    mod_assign
 * @class      GradingReviewPanel
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_review_panel",["jquery","mod_assign/grading_events"],(function($,GradingEvents){var GradingReviewPanel=function(){this._region=$('[data-region="review-panel-content"]'),this.registerEventListeners()};return GradingReviewPanel.prototype._region=null,GradingReviewPanel.prototype.getReviewPanel=function(pluginname){return void 0===this._region.data("panel-owner")&&this._region.data("review-panel-plugin",pluginname),this._region.data("review-panel-plugin")==pluginname&&this._region[0]},GradingReviewPanel.prototype.getTogglePanelButton=function(){return this.getPanelElement().find('[data-region="review-panel-toggle"]')},GradingReviewPanel.prototype.getPanelElement=function(){return $('[data-region="review-panel"]')},GradingReviewPanel.prototype.getPanelContentElement=function(){return $('[data-region="review-panel-content"]')},GradingReviewPanel.prototype.togglePanel=function(){this.getPanelElement().hasClass("collapsed")?$(document).trigger(GradingEvents.EXPAND_REVIEW_PANEL):$(document).trigger(GradingEvents.COLLAPSE_REVIEW_PANEL)},GradingReviewPanel.prototype.collapsePanel=function(){this.getPanelElement().addClass("collapsed").removeClass("grade-panel-collapsed"),this.getPanelContentElement().attr("aria-hidden",!0)},GradingReviewPanel.prototype.expandPanel=function(){this.getPanelElement().removeClass("collapsed"),this.getPanelContentElement().removeAttr("aria-hidden")},GradingReviewPanel.prototype.registerEventListeners=function(){var toggleReviewPanelButton=this.getTogglePanelButton();toggleReviewPanelButton.click(function(e){this.togglePanel(),e.preventDefault()}.bind(this)),toggleReviewPanelButton.keydown(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||13!==e.keyCode&&32!==e.keyCode||(this.togglePanel(),e.preventDefault())}.bind(this));var docElement=$(document);docElement.on(GradingEvents.COLLAPSE_REVIEW_PANEL,function(){this.collapsePanel()}.bind(this)),docElement.on(GradingEvents.COLLAPSE_GRADE_PANEL,function(){this.expandPanel(),this.getPanelElement().addClass("grade-panel-collapsed")}.bind(this)),docElement.on(GradingEvents.EXPAND_REVIEW_PANEL,function(){this.expandPanel()}.bind(this)),docElement.on(GradingEvents.EXPAND_GRADE_PANEL,function(){this.getPanelElement().removeClass("grade-panel-collapsed")}.bind(this))},GradingReviewPanel}));
define("mod_assign/override_form",["exports","jquery"],(function(_exports,_jquery){var obj;
/**
   * A javascript module to enhance the override form.
   *
   * @copyright  2019 Ryan Wyllie <ryan@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.init=function(formId,selectElementName){var form=document.getElementById(formId),selectElement=form.querySelector('[name="'.concat(selectElementName,'"]'));(0,_jquery.default)(selectElement).on("change",(function(){var inputElement=document.createElement("input");inputElement.setAttribute("type","hidden"),inputElement.setAttribute("name","userchange"),inputElement.setAttribute("value",!0),form.appendChild(inputElement),void 0!==M.core_formchangechecker&&M.core_formchangechecker.reset_form_dirty_state(),form.submit()}))}}));
/**
 * Simple method to check for changes to a form between two points in time.
 *
 * @module     mod_assign/grading_form_change_checker
 * @package    mod_assign
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_form_change_checker",["jquery"],(function($){return{saveFormState:function(selector){$(selector).trigger("save-form-state");var data=$(selector).serialize();$(selector).data("saved-form-state",data)},checkFormForChanges:function(selector){$(selector).trigger("save-form-state");var data=$(selector).serialize(),previousdata=$(selector).data("saved-form-state");return void 0!==previousdata&&previousdata!=data}}}));
/**
 * Events for the grading interface.
 *
 * @module     mod_assign/grading_events
 * @package    mod_assign
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_events",(function(){return{COLLAPSE_REVIEW_PANEL:"grading:collapse-review-panel",EXPAND_REVIEW_PANEL:"grading:expand-review-panel",COLLAPSE_GRADE_PANEL:"grading:collapse-grade-panel",EXPAND_GRADE_PANEL:"grading:expand-grade-panel"}}));
/**
 * Javascript to handle changing users via the user selector in the header.
 *
 * @module     mod_assign/grading_navigation
 * @package    mod_assign
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_navigation",["jquery","core/notification","core/str","core/form-autocomplete","core/ajax","mod_assign/grading_form_change_checker"],(function($,notification,str,autocomplete,ajax,checker){var GradingNavigation=function(selector){this._regionSelector=selector,this._region=$(selector),this._filters=[],this._users=[],this._filteredUsers=[],this._lastXofYUpdate=0,this._firstLoadUsers=!0,this._loadAllUsers(),this._region.find('[data-action="previous-user"]').on("click",this._handlePreviousUser.bind(this)),this._region.find('[data-action="next-user"]').on("click",this._handleNextUser.bind(this)),this._region.find('[data-action="change-user"]').on("change",this._handleChangeUser.bind(this)),this._region.find('[data-region="user-filters"]').on("click",this._toggleExpandFilters.bind(this)),$(document).on("user-changed",this._refreshSelector.bind(this)),$(document).on("done-saving-show-next",this._handleNextUser.bind(this));var toggleLink=this._region.find('[data-region="user-filters"]');$(document.getElementById(toggleLink.attr("aria-controls"))).on("change","select",this._filterChanged.bind(this));var userid=$('[data-region="grading-navigation-panel"]').data("first-userid");userid&&this._selectUserById(userid),str.get_string("changeuser","mod_assign").done((function(s){autocomplete.enhance("[data-action=change-user]",!1,"mod_assign/participant_selector",s)})).fail(notification.exception),$(document).bind("start-loading-user",function(){this._isLoading=!0}.bind(this)),$(document).bind("finish-loading-user",function(){this._isLoading=!1}.bind(this))};return GradingNavigation.prototype._isLoading=!1,GradingNavigation.prototype._regionSelector=null,GradingNavigation.prototype._filters=null,GradingNavigation.prototype._users=null,GradingNavigation.prototype._region=null,GradingNavigation.prototype._lastFilters="",GradingNavigation.prototype._loadAllUsers=function(){var select=this._region.find("[data-action=change-user]"),assignmentid=select.attr("data-assignmentid"),groupid=select.attr("data-groupid"),filterPanel=this._region.find('[data-region="configure-filters"]'),filter=filterPanel.find('select[name="filter"]').val(),workflowFilter=filterPanel.find('select[name="workflowfilter"]');workflowFilter&&(filter+=","+workflowFilter.val());var markerFilter=filterPanel.find('select[name="markerfilter"]');return markerFilter&&(filter+=","+markerFilter.val()),this._lastFilters!=filter&&(this._lastFilters=filter,ajax.call([{methodname:"mod_assign_list_participants",args:{assignid:assignmentid,groupid:groupid,filter:"",onlyids:!0,tablesort:!0},done:this._usersLoaded.bind(this),fail:notification.exception}]),!0)},GradingNavigation.prototype._usersLoaded=function(users){if(this._firstLoadUsers=!1,this._filteredUsers=this._users=users,this._users.length){var toggleLink=this._region.find('[data-region="user-filters"]');$(document.getElementById(toggleLink.attr("aria-controls"))).find('select[name="filter"]').trigger("change")}else this._selectNoUser();this._triggerNextUserEvent()},GradingNavigation.prototype._checkClickOutsideConfigureFilters=function(event){var configPanel=this._region.find('[data-region="configure-filters"]');if(!configPanel.is(event.target)&&0===configPanel.has(event.target).length){var toggleLink=this._region.find('[data-region="user-filters"]');configPanel.hide(),configPanel.attr("aria-hidden","true"),toggleLink.attr("aria-expanded","false"),$(document).unbind("click.mod_assign_grading_navigation")}},GradingNavigation.prototype._updateFilterPreferences=function(userId,filterList,preferenceNames){var preferences=[],i=0;if(0==filterList.length||this._firstLoadUsers){var deferred=$.Deferred();return deferred.resolve(),deferred}for(i=0;i<filterList.length;i++){var newValue=filterList[i];"none"==newValue&&(newValue=""),preferences.push({userid:userId,name:preferenceNames[i],value:newValue})}return ajax.call([{methodname:"core_user_set_user_preferences",args:{preferences:preferences}}])[0]},GradingNavigation.prototype._filterChanged=function(){var filterPanel=this._region.find('[data-region="configure-filters"]'),filters=filterPanel.find("select"),preferenceNames=[];this._filters=[],filters.each(function(idx,ele){var element=$(ele);this._filters.push(element.val()),preferenceNames.push("assign_"+element.prop("name"))}.bind(this));var filterlist=[];filterPanel.find("option:checked").each((function(idx,ele){filterlist[filterlist.length]=$(ele).text()})),filterlist.length?this._region.find('[data-region="user-filters"] span').text(filterlist.join(", ")):str.get_string("nofilters","mod_assign").done(function(s){this._region.find('[data-region="user-filters"] span').text(s)}.bind(this)).fail(notification.exception);var select=this._region.find("[data-action=change-user]"),currentUserID=select.data("currentuserid");this._updateFilterPreferences(currentUserID,this._filters,preferenceNames).done(function(){if(!this._loadAllUsers()){var userid=parseInt(select.attr("data-selected")),foundIndex=0;$.each(this._filteredUsers,(function(index,user){userid==user.id&&(foundIndex=index)})),this._filteredUsers.length?this._selectUserById(this._filteredUsers[foundIndex].id):this._selectNoUser()}}.bind(this)).fail(notification.exception),this._refreshCount()},GradingNavigation.prototype._selectNoUser=function(){this._isLoading||(checker.checkFormForChanges('[data-region="grade-panel"] .gradeform')?str.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done((function(strs){notification.confirm(strs[0],strs[1],strs[2],strs[3],(function(){$(document).trigger("save-changes",-1)}))})):$(document).trigger("user-changed",-1))},GradingNavigation.prototype._selectUserById=function(userid){var select=this._region.find("[data-action=change-user]"),useridnumber=parseInt(userid,10);this._isLoading||(checker.checkFormForChanges('[data-region="grade-panel"] .gradeform')?str.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done((function(strs){notification.confirm(strs[0],strs[1],strs[2],strs[3],(function(){$(document).trigger("save-changes",useridnumber)}))})):(select.attr("data-selected",userid),!isNaN(useridnumber)&&useridnumber>0&&$(document).trigger("user-changed",userid)))},GradingNavigation.prototype._toggleExpandFilters=function(event){event.preventDefault();var toggleLink=$(event.target).closest('[data-region="user-filters"]'),expanded="true"==toggleLink.attr("aria-expanded"),configPanel=$(document.getElementById(toggleLink.attr("aria-controls")));expanded?(configPanel.hide(),configPanel.attr("aria-hidden","true"),toggleLink.attr("aria-expanded","false"),$(document).unbind("click.mod_assign_grading_navigation")):(configPanel.css("display","inline-block"),configPanel.attr("aria-hidden","false"),toggleLink.attr("aria-expanded","true"),event.stopPropagation(),$(document).on("click.mod_assign_grading_navigation",this._checkClickOutsideConfigureFilters.bind(this)))},GradingNavigation.prototype._handlePreviousUser=function(e){e.preventDefault();var currentUserId=this._region.find("[data-action=change-user]").attr("data-selected"),i=0,currentIndex=0;for(i=0;i<this._filteredUsers.length;i++)if(this._filteredUsers[i].id==currentUserId){currentIndex=i;break}var count=this._filteredUsers.length,newIndex=currentIndex-1;newIndex<0&&(newIndex=count-1),count&&this._selectUserById(this._filteredUsers[newIndex].id)},GradingNavigation.prototype._handleNextUser=function(e,saved){e.preventDefault();var select=this._region.find("[data-action=change-user]"),currentUserId=select.attr("data-selected"),i=0,currentIndex=0;for(i=0;i<this._filteredUsers.length;i++)if(this._filteredUsers[i].id==currentUserId){currentIndex=i;break}var count=this._filteredUsers.length,newIndex=(currentIndex+1)%count;if(saved&&count){var userid=this._filteredUsers[newIndex].id,useridnumber=parseInt(userid,10);select.attr("data-selected",userid),!isNaN(useridnumber)&&useridnumber>0&&$(document).trigger("user-changed",userid)}else count&&this._selectUserById(this._filteredUsers[newIndex].id)},GradingNavigation.prototype._setCountString=function(x,y){var updateNumber;this._lastXofYUpdate++,updateNumber=this._lastXofYUpdate;var param={x:x,y:y};str.get_string("xofy","mod_assign",param).done(function(s){updateNumber==this._lastXofYUpdate&&this._region.find('[data-region="user-count-summary"]').text(s)}.bind(this)).fail(notification.exception)},GradingNavigation.prototype._refreshCount=function(){var userid=this._region.find("[data-action=change-user]").attr("data-selected"),i=0,currentIndex=0;if(isNaN(userid)||userid<=0)this._region.find('[data-region="user-count"]').hide();else{for(this._region.find('[data-region="user-count"]').show(),i=0;i<this._filteredUsers.length;i++)if(this._filteredUsers[i].id==userid){currentIndex=i;break}var count=this._filteredUsers.length;if(count&&(currentIndex+=1),this._setCountString(currentIndex,count),currentIndex>0){var url=new URL(window.location);if(parseInt(url.searchParams.get("blindid"))>0){var newid=this._filteredUsers[currentIndex-1].recordid;url.searchParams.set("blindid",newid)}else url.searchParams.set("userid",userid);window.history.replaceState({},"",url)}}},GradingNavigation.prototype._refreshSelector=function(event,userid){var select=this._region.find("[data-action=change-user]");userid=parseInt(userid,10),!isNaN(userid)&&userid>0&&select.attr("data-selected",userid),this._refreshCount()},GradingNavigation.prototype._triggerNextUserEvent=function(){this._filteredUsers.length>1?$(document).trigger("next-user",{nextUserId:null,nextUser:!0}):$(document).trigger("next-user",{nextUser:!1})},GradingNavigation.prototype._handleChangeUser=function(){var select=this._region.find("[data-action=change-user]"),userid=parseInt(select.val(),10);this._isLoading||(checker.checkFormForChanges('[data-region="grade-panel"] .gradeform')?str.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done((function(strs){notification.confirm(strs[0],strs[1],strs[2],strs[3],(function(){$(document).trigger("save-changes",userid)}))})):!isNaN(userid)&&userid>0&&(select.attr("data-selected",userid),$(document).trigger("user-changed",userid)))},GradingNavigation}));
/**
 * Javascript controller for the "Grading" panel at the right of the page.
 *
 * @module     mod_assign/grading_panel
 * @package    mod_assign
 * @class      GradingPanel
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_panel",["jquery","core/yui","core/notification","core/templates","core/fragment","core/ajax","core/str","mod_assign/grading_form_change_checker","mod_assign/grading_events","core/event"],(function($,Y,notification,templates,fragment,ajax,str,checker,GradingEvents,Event){var GradingPanel=function(selector){this._regionSelector=selector,this._region=$(selector),this._userCache=[],this.registerEventListeners()};return GradingPanel.prototype._regionSelector=null,GradingPanel.prototype._lastUserId=0,GradingPanel.prototype._lastAttemptNumber=-1,GradingPanel.prototype._region=null,GradingPanel.prototype.nextUserId=null,GradingPanel.prototype.nextUser=!1,GradingPanel.prototype._niceReplaceNodeContents=function(node,html,js){var promise=$.Deferred();return node.fadeOut("fast",(function(){templates.replaceNodeContents(node,html,js),node.fadeIn("fast",(function(){promise.resolve()}))})),promise.promise()},GradingPanel.prototype._saveFormState=function(){var checked=$('[data-region="grading-actions-form"] [name="sendstudentnotifications"]').prop("checked");$('.gradeform [name="sendstudentnotifications"]').val(checked)},GradingPanel.prototype._submitForm=function(event,nextUserId,nextUser){var form=$(this._region.find("form.gradeform"));$('[data-region="overlay"]').show(),form.trigger("save-form-state"),Event.notifyFormSubmitAjax(form[0]);var data=form.serialize(),assignmentid=this._region.attr("data-assignmentid");ajax.call([{methodname:"mod_assign_submit_grading_form",args:{assignmentid:assignmentid,userid:this._lastUserId,jsonformdata:JSON.stringify(data)},done:this._handleFormSubmissionResponse.bind(this,data,nextUserId,nextUser),fail:notification.exception}])},GradingPanel.prototype._handleFormSubmissionResponse=function(formdata,nextUserId,nextUser,response){void 0===nextUserId&&(nextUserId=this._lastUserId),response.length?$(document).trigger("reset",[this._lastUserId,formdata]):(str.get_strings([{key:"changessaved",component:"core"},{key:"gradechangessaveddetail",component:"mod_assign"}]).done((function(strs){notification.alert(strs[0],strs[1])})).fail(notification.exception),Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),nextUserId==this._lastUserId?$(document).trigger("reset",nextUserId):nextUser?$(document).trigger("done-saving-show-next",!0):$(document).trigger("user-changed",nextUserId)),$('[data-region="overlay"]').hide()},GradingPanel.prototype._resetForm=function(e,userid,formdata){var event=$.Event("custom");void 0===userid&&(userid=this._lastUserId),this._lastUserId=0,this._refreshGradingPanel(event,userid,formdata)},GradingPanel.prototype._chooseAttempt=function(e){var submissionsId=$(e.target).data("submissions"),formhtml=$(document.getElementById(submissionsId)).clone().wrap($("<form/>")).html();str.get_strings([{key:"viewadifferentattempt",component:"mod_assign"},{key:"view",component:"core"},{key:"cancel",component:"core"}]).done(function(strs){notification.confirm(strs[0],formhtml,strs[1],strs[2],function(){var attemptnumber=$("input:radio[name='select-attemptnumber']:checked").val();this._refreshGradingPanel(null,this._lastUserId,"",attemptnumber)}.bind(this))}.bind(this)).fail(notification.exception)},GradingPanel.prototype._addPopoutButtons=function(selector){var region=$(selector);templates.render("mod_assign/popout_button",{}).done(function(html){region.find('[data-fieldtype="filemanager"],[data-fieldtype="editor"],[data-fieldtype="grading"]').closest(".fitem").addClass("has-popout").find("label").parent().append(html),region.on("click",'[data-region="popout-button"]',this._togglePopout.bind(this))}.bind(this)).fail(notification.exception)},GradingPanel.prototype._togglePopout=function(event){event.preventDefault();var container=$(event.target).closest(".fitem");container.hasClass("popout")?$(".popout").removeClass("popout"):($(".popout").removeClass("popout"),container.addClass("popout"),container.addClass("moodle-has-zindex"))},GradingPanel.prototype._refreshGradingPanel=function(event,userid,submissiondata,attemptnumber){var contextid=this._region.attr("data-contextid");void 0===submissiondata&&(submissiondata=""),void 0===attemptnumber&&(attemptnumber=-1),this._lastUserId==userid&&this._lastAttemptNumber==attemptnumber&&""===submissiondata||(this._lastUserId=userid,this._lastAttemptNumber=attemptnumber,$(document).trigger("start-loading-user"),window.M.util.js_pending("mod-assign-loading-user"),templates.render("mod_assign/loading",{}).done(function(html,js){this._niceReplaceNodeContents(this._region,html,js).done(function(){if(userid>0){this._region.show();var params={userid:userid,attemptnumber:attemptnumber,jsonformdata:JSON.stringify(submissiondata)};fragment.loadFragment("mod_assign","gradingpanel",contextid,params).done(function(html,js){this._niceReplaceNodeContents(this._region,html,js).done(function(){checker.saveFormState('[data-region="grade-panel"] .gradeform'),$(document).on("editor-content-restored",(function(){checker.saveFormState('[data-region="grade-panel"] .gradeform')})),$('[data-region="attempt-chooser"]').on("click",this._chooseAttempt.bind(this)),this._addPopoutButtons('[data-region="grade-panel"] .gradeform'),$(document).trigger("finish-loading-user"),window.M.util.js_complete("mod-assign-loading-user")}.bind(this)).fail(notification.exception)}.bind(this)).fail(notification.exception),$('[data-region="review-panel"]').show()}else this._region.hide(),$('[data-region="review-panel"]').hide(),$(document).trigger("finish-loading-user"),window.M.util.js_complete("mod-assign-loading-user")}.bind(this))}.bind(this)).fail(notification.exception))},GradingPanel.prototype._getNextUser=function(event,data){this.nextUserId=data.nextUserId,this.nextUser=data.nextUser},GradingPanel.prototype._handleSaveAndShowNext=function(){this._submitForm(null,this.nextUserId,this.nextUser)},GradingPanel.prototype.getPanelElement=function(){return $('[data-region="grade-panel"]')},GradingPanel.prototype.collapsePanel=function(){this.getPanelElement().addClass("collapsed")},GradingPanel.prototype.expandPanel=function(){this.getPanelElement().removeClass("collapsed")},GradingPanel.prototype.registerEventListeners=function(){var docElement=$(document);$(this._region).on("submit","form",(function(e){e.preventDefault()})),docElement.on("next-user",this._getNextUser.bind(this)),docElement.on("user-changed",this._refreshGradingPanel.bind(this)),docElement.on("save-changes",this._submitForm.bind(this)),docElement.on("save-and-show-next",this._handleSaveAndShowNext.bind(this)),docElement.on("reset",this._resetForm.bind(this)),docElement.on("save-form-state",this._saveFormState.bind(this)),docElement.on(GradingEvents.COLLAPSE_GRADE_PANEL,function(){this.collapsePanel()}.bind(this)),docElement.on(GradingEvents.COLLAPSE_REVIEW_PANEL,function(){this.expandPanel()}.bind(this)),docElement.on(GradingEvents.EXPAND_GRADE_PANEL,function(){this.expandPanel()}.bind(this))},GradingPanel}));
define('mod_choicegroup/select_all_choices', ["jquery"],function(a){return{init:function(){a(".selectallnone a").on("click",function(b){b.preventDefault(),a("#attemptsform").find("input:checkbox").prop("checked",a(this).data("selectInfo"))})}}});
define('mod_choicegroup/choicegroupdatadisplay', ["jquery","core/str"],function(a,b){return{init:function(){a(".choicegroup-memberdisplay").click(function(c){c.preventDefault(),a(".choicegroups-membersnames").toggleClass("hidden");var d=b.get_string("showgroupmembers","mod_choicegroup"),e=b.get_string("hidegroupmembers","mod_choicegroup");a(".choicegroups-membersnames").is(":visible")?a.when(e).done(function(b){a(".choicegroup-memberdisplay").html(b)}):a.when(d).done(function(b){a(".choicegroup-memberdisplay").html(b)})}),a(".choicegroup-descriptiondisplay").click(function(c){c.preventDefault(),a(".choicegroups-descriptions").toggleClass("hidden");var d=b.get_string("hidedescription","mod_choicegroup"),e=b.get_string("showdescription","mod_choicegroup");a(".choicegroups-descriptions").is(":visible")?a.when(d).done(function(b){a(".choicegroup-descriptiondisplay").html(b)}):a.when(e).done(function(b){a(".choicegroup-descriptiondisplay").html(b)})})}}});
define ("mod_customcert/rearrange-area",["jquery","core/yui","core/fragment","mod_customcert/dialogue","core/notification","core/str","core/templates","core/ajax"],function(a,b,c,d,f,g,h,i){var j=function(b){this._node=a(b);this._setEvents()};j.prototype.CUSTOMCERT_REF_POINT_TOPLEFT=0;j.prototype.CUSTOMCERT_REF_POINT_TOPCENTER=1;j.prototype.CUSTOMCERT_REF_POINT_TOPRIGHT=2;j.prototype.PIXELSINMM=3.779527559055;j.prototype._setEvents=function(){this._node.on("click",".element",this._editElement.bind(this))};j.prototype._editElement=function(a){var e=a.currentTarget.id.substr(8),h=this._node.attr("data-contextid");c.loadFragment("mod_customcert","editelement",h,{elementid:e}).done(function(a,c){g.get_string("editelement","mod_customcert").done(function(f){b.use("moodle-core-formchangechecker",function(){new d(f,"<div id='elementcontent'></div>",this._editElementDialogueConfig.bind(this,e,a,c),void 0,!0)}.bind(this))}.bind(this))}.bind(this)).fail(f.exception)};j.prototype._editElementDialogueConfig=function(b,c,d,g){h.replaceNode("#elementcontent",c,d);this._setPositionInForm(b);var i=a(g.getContent());i.on("click","#id_submitbutton",function(c){M.core_formchangechecker.reset_form_dirty_state();this._saveElement(b).then(function(){this._getElementHTML(b).done(function(c){var d=this._node.find("#element-"+b),e=parseInt(a("#id_refpoint").val()),f="";if(e==this.CUSTOMCERT_REF_POINT_TOPLEFT){f="refpoint-left"}else if(e==this.CUSTOMCERT_REF_POINT_TOPCENTER){f="refpoint-center"}else if(e==this.CUSTOMCERT_REF_POINT_TOPRIGHT){f="refpoint-right"}d.empty().append(c);d.removeClass();d.addClass("element "+f);d.attr("data-refpoint",e);var h=a("#editelementform #id_posx").val(),i=a("#editelementform #id_posy").val();this._setPosition(b,e,h,i);g.close()}.bind(this))}.bind(this)).fail(f.exception);c.preventDefault()}.bind(this));i.on("click","#id_cancel",function(a){g.close();a.preventDefault()})};j.prototype._setPosition=function(a,c,d,e){var f=b.one("#element-"+a);d=b.one("#pdf").getX()+d*this.PIXELSINMM;e=b.one("#pdf").getY()+e*this.PIXELSINMM;var g=parseFloat(f.getComputedStyle("width")),h=f.width*this.PIXELSINMM;if(h&&g>h){g=h}switch(c){case this.CUSTOMCERT_REF_POINT_TOPCENTER:d-=g/2;break;case this.CUSTOMCERT_REF_POINT_TOPRIGHT:d=d-g+2;break;}f.setX(d);f.setY(e)};j.prototype._setPositionInForm=function(c){var d=a("#editelementform #id_posx"),e=a("#editelementform #id_posy");if(d.length&&e.length){var f=b.one("#element-"+c),g=f.getX()-b.one("#pdf").getX(),h=f.getY()-b.one("#pdf").getY(),i=parseInt(f.getData("refpoint")),j=parseFloat(f.getComputedStyle("width"));switch(i){case this.CUSTOMCERT_REF_POINT_TOPCENTER:g+=j/2;break;case this.CUSTOMCERT_REF_POINT_TOPRIGHT:g+=j;break;}g=Math.round(parseFloat(g/this.PIXELSINMM));h=Math.round(parseFloat(h/this.PIXELSINMM));d.val(g);e.val(h)}};j.prototype._getElementHTML=function(a){var b=this._node.attr("data-templateid"),c=i.call([{methodname:"mod_customcert_get_element_html",args:{templateid:b,elementid:a}}]);return c[0]};j.prototype._saveElement=function(b){var c=this._node.attr("data-templateid"),d=a("#editelementform").serializeArray(),e=i.call([{methodname:"mod_customcert_save_element",args:{templateid:c,elementid:b,values:d}}]);return e[0]};return{init:function init(a){new j(a)}}});
define ("mod_customcert/dialogue",["core/yui"],function(a){var b=function(b,c,d,e,f){this.yuiDialogue=null;var g=this;if("undefined"==typeof f){f=!1}a.use("moodle-core-notification","timers",function(){var h="480px";if(f){h="800px"}g.yuiDialogue=new M.core.dialogue({headerContent:b,bodyContent:c,draggable:!0,visible:!1,center:!0,modal:!0,width:h});g.yuiDialogue.after("visibleChange",function(b){if(b.newVal){if("undefined"!=typeof d){a.soon(function(){d(g);g.yuiDialogue.centerDialogue()})}}else{if("undefined"!=typeof e){a.soon(function(){e(g)})}}});g.yuiDialogue.show()})};b.prototype.close=function(){this.yuiDialogue.hide();this.yuiDialogue.destroy()};b.prototype.getContent=function(){return this.yuiDialogue.bodyNode.getDOMNode()};return b});
define('mod_etherpadlite/modal_iframe', ["jquery"],function(a){return{init:function(c,b){a("#etherpadmodal_"+b).on("show.bs.modal",function(d){a("#etherpadiframe_"+b).attr("src","");a("#etherpadiframe2_"+b).attr("src",c);a("body").addClass("modal-open")});a("#etherpadmodal_"+b).on("hide.bs.modal",function(d){a("#etherpadiframe2_"+b).attr("src","");a("#etherpadiframe_"+b).attr("src",c);a("body").removeClass("modal-open")});a("#etherpadiframe_"+b).attr("src",c)}}});
define ("mod_etherpadlite/copy_to_clipboard",["exports"],function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;var c=null;function b(){navigator.clipboard.writeText(c);require(["core/str","core/notification"],function(a,b){a.get_strings([{key:"link_copied",component:"mod_etherpadlite"},{key:"etherpadlite_link_copied_to_clipboard",component:"mod_etherpadlite"}]).done(function(a){b.alert(a[0],a[1])})})}a.init=function init(a){c=a;var d=document.getElementsByClassName("copy_etherpadlink_to_clipboard_button").item(0);d.addEventListener("click",b)}});
define("mod_feedback/edit",["jquery","core/ajax","core/str","core/notification"],(function($,ajax,str,notification){var manager={deleteItem:function(e){e.preventDefault();var targetUrl=$(e.currentTarget).attr("href");str.get_strings([{key:"confirmation",component:"admin"},{key:"confirmdeleteitem",component:"mod_feedback"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).then((function(s){notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location=targetUrl}))})).catch()},setup:function(){$("body").delegate('[data-action="delete"]',"click",manager.deleteItem)}};return{setup:manager.setup}}));
/**
 * Module for the list of discussions on when viewing a forum.
 *
 * @module     mod_forum/discussion_list
 * @package    mod_forum
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/discussion_list",["jquery","core/templates","core/str","core/notification","mod_forum/subscription_toggle","mod_forum/selectors","mod_forum/repository","core/pubsub","mod_forum/forum_events"],(function($,Templates,Str,Notification,SubscriptionToggle,Selectors,Repository,PubSub,ForumEvents){return{init:function(root){SubscriptionToggle.init(root,!1,(function(toggleElement,context){var toggleId=toggleElement.attr("id"),newTargetState=context.userstate.subscribed?0:1;toggleElement.data("targetstate",newTargetState);var stringKey=context.userstate.subscribed?"unsubscribediscussion":"subscribediscussion";return Str.get_string(stringKey,"mod_forum").then((function(string){return toggleElement.closest("td").find('label[for="'+toggleId+'"]').find("span").text(string),string}))})),function(root){PubSub.subscribe(ForumEvents.SUBSCRIPTION_TOGGLED,(function(data){var discussionId=data.discussionId,subscribed=data.subscriptionState,discussionListItem=root.find(Selectors.discussion.item+"[data-discussionid= "+discussionId+"]"),subscribedLabel=discussionListItem.find(Selectors.discussion.subscribedLabel);subscribed?(discussionListItem.addClass("subscribed"),subscribedLabel.removeAttr("hidden")):(discussionListItem.removeClass("subscribed"),subscribedLabel.attr("hidden",!0))})),root.on("click",Selectors.favourite.toggle,(function(){var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),subscriptionState=toggleElement.data("targetstate");Repository.setFavouriteDiscussionState(forumId,discussionId,subscriptionState).then((function(){return location.reload()})).catch(Notification.exception)})),root.on("click",Selectors.pin.toggle,(function(e){e.preventDefault();var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),state=toggleElement.data("targetstate");Repository.setPinDiscussionState(forumId,discussionId,state).then((function(){return location.reload()})).catch(Notification.exception)})),root.on("click",Selectors.lock.toggle,(function(e){var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),state=toggleElement.data("state");Repository.setDiscussionLockState(forumId,discussionId,state).then((function(context){var icon=toggleElement.parents(Selectors.summary.actions).find(Selectors.lock.icon),lockedLabel=toggleElement.parents(Selectors.discussion.item).find(Selectors.discussion.lockedLabel);return context.locked?(icon.removeClass("hidden"),lockedLabel.removeAttr("hidden")):(icon.addClass("hidden"),lockedLabel.attr("hidden",!0)),context})).then((function(context){return context.forumid=forumId,Templates.render("mod_forum/discussion_lock_toggle",context)})).then((function(html,js){return Templates.replaceNode(toggleElement,html,js)})).then((function(){return Str.get_string("lockupdated","forum").done((function(s){return Notification.addNotification({message:s,type:"info"})}))})).catch(Notification.exception),e.preventDefault()}))}(root)}}}));
/**
 * Forum repository class to encapsulate all of the AJAX requests that subscribe or unsubscribe
 * can be sent for forum.
 *
 * @module     mod_forum/repository
 * @package    mod_forum
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/repository",["core/ajax"],(function(Ajax){return{setDiscussionSubscriptionState:function(forumId,discussionId,targetState){var request={methodname:"mod_forum_set_subscription_state",args:{forumid:forumId,discussionid:discussionId,targetstate:targetState}};return Ajax.call([request])[0]},addDiscussionPost:function(postid,subject,message,messageformat,isprivatereply,topreferredformat){var request={methodname:"mod_forum_add_discussion_post",args:{postid:postid,message:message,messageformat:messageformat,subject:subject,options:[{name:"private",value:isprivatereply},{name:"topreferredformat",value:topreferredformat}]}};return Ajax.call([request])[0]},setDiscussionLockState:function(forumId,discussionId,targetState){var request={methodname:"mod_forum_set_lock_state",args:{forumid:forumId,discussionid:discussionId,targetstate:targetState}};return Ajax.call([request])[0]},setFavouriteDiscussionState:function(forumId,discussionId,targetState){var request={methodname:"mod_forum_toggle_favourite_state",args:{discussionid:discussionId,targetstate:targetState}};return Ajax.call([request])[0]},setPinDiscussionState:function(forumid,discussionid,targetstate){var request={methodname:"mod_forum_set_pin_state",args:{discussionid:discussionid,targetstate:targetstate}};return Ajax.call([request])[0]},getDiscussionByUserID:function(userid,cmid){var sortby=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"modified",sortdirection=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"DESC",request={methodname:"mod_forum_get_discussion_posts_by_userid",args:{userid:userid,cmid:cmid,sortby:sortby,sortdirection:sortdirection}};return Ajax.call([request])[0]},getDiscussionPosts:function(discussionId){var sortby=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"created",sortdirection=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ASC",request={methodname:"mod_forum_get_discussion_posts",args:{discussionid:discussionId,sortby:sortby,sortdirection:sortdirection}};return Ajax.call([request])[0]}}}));
/**
 * Module for viewing a discussion.
 *
 * @module     mod_forum/discussion_list
 * @package    mod_forum
 * @copyright  2019 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/discussion",["jquery","core/custom_interaction_events","mod_forum/selectors","core/pubsub","mod_forum/forum_events","core/str","core/notification"],(function($,CustomEvents,Selectors,PubSub,ForumEvents,String,Notification){var isElementInInPageReplySection=function(element){return!!$(element).closest(Selectors.post.inpageReplyContent).length},initAccessibilityKeyboardNav=function(root){root.find(Selectors.post.post).each((function(index,post){var actions=$(post).find(Selectors.post.action),firstAction=actions.first();actions.attr("tabindex","-1"),firstAction.attr("tabindex",0)})),CustomEvents.define(root,[CustomEvents.events.up,CustomEvents.events.down,CustomEvents.events.next,CustomEvents.events.previous,CustomEvents.events.home,CustomEvents.events.end]),root.on(CustomEvents.events.up,(function(e,data){var activeElement=document.activeElement;if(!isElementInInPageReplySection(activeElement)){var focusPost=$(activeElement).closest(Selectors.post.post);focusPost.length?function(currentPost){var prevPost=currentPost.prev(Selectors.post.post);if(prevPost.length){var replyPost=prevPost.find(Selectors.post.post).last();replyPost.length?replyPost.focus():prevPost.focus()}else currentPost.parents(Selectors.post.post).first().focus()}(focusPost):root.find(Selectors.post.post).first().focus(),data.originalEvent.preventDefault()}})),root.on(CustomEvents.events.down,(function(e,data){var activeElement=document.activeElement;if(!isElementInInPageReplySection(activeElement)){var focusPost=$(activeElement).closest(Selectors.post.post);focusPost.length?function(currentPost){var replyPost=currentPost.find(Selectors.post.post).first();if(replyPost.length)replyPost.focus();else{var siblingPost=currentPost.next(Selectors.post.post);if(siblingPost.length)siblingPost.focus();else for(var parentPosts=currentPost.parents(Selectors.post.post).toArray(),i=0;i<parentPosts.length;i++){var ancestorSiblingPost=$(parentPosts[i]).next(Selectors.post.post);if(ancestorSiblingPost.length){ancestorSiblingPost.focus();break}}}}(focusPost):root.find(Selectors.post.post).first().focus(),data.originalEvent.preventDefault()}})),root.on(CustomEvents.events.home,(function(e,data){isElementInInPageReplySection(document.activeElement)||(root.find(Selectors.post.post).first().focus(),data.originalEvent.preventDefault())})),root.on(CustomEvents.events.end,(function(e,data){isElementInInPageReplySection(document.activeElement)||(root.find(Selectors.post.post).last().focus(),data.originalEvent.preventDefault())})),root.on(CustomEvents.events.next,Selectors.post.action,(function(e,data){var currentAction=$(e.target),actions=currentAction.closest(Selectors.post.actionsContainer).find(Selectors.post.action),nextAction=currentAction.next(Selectors.post.action);actions.attr("tabindex","-1"),nextAction.length||(nextAction=actions.first()),nextAction.attr("tabindex",0),nextAction.focus(),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.previous,Selectors.post.action,(function(e,data){var currentAction=$(e.target),actions=currentAction.closest(Selectors.post.actionsContainer).find(Selectors.post.action),nextAction=currentAction.prev(Selectors.post.action);actions.attr("tabindex","-1"),nextAction.length||(nextAction=actions.last()),nextAction.attr("tabindex",0),nextAction.focus(),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.home,Selectors.post.action,(function(e,data){var actions=$(e.target).closest(Selectors.post.actionsContainer).find(Selectors.post.action),firstAction=actions.first();actions.attr("tabindex","-1"),firstAction.attr("tabindex",0),firstAction.focus(),e.stopPropagation(),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.end,Selectors.post.action,(function(e,data){var actions=$(e.target).closest(Selectors.post.actionsContainer).find(Selectors.post.action),lastAction=actions.last();actions.attr("tabindex","-1"),lastAction.attr("tabindex",0),lastAction.focus(),e.stopPropagation(),data.originalEvent.preventDefault()})),PubSub.subscribe(ForumEvents.SUBSCRIPTION_TOGGLED,(function(data){var updateMessage=data.subscriptionState?"discussionsubscribed":"discussionunsubscribed";String.get_string(updateMessage,"forum").then((function(s){return Notification.addNotification({message:s,type:"info"})})).catch(Notification.exception)}))};return{init:function(root){initAccessibilityKeyboardNav(root)}}}));
define("mod_forum/local/grades/local/grader/user_picker/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={regions:{currentUser:'[data-region="user_picker/current_user"]',userRegion:'[data-region="user_picker/user"]'},actions:{changeUser:'[data-action="change-user"]'}},_exports.default}));
define("mod_forum/local/grades/local/grader/user_picker",["exports","core/templates","./user_picker/selectors","core/str"],(function(_exports,_templates,_selectors,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=_interopRequireDefault(_templates),_selectors=_interopRequireDefault(_selectors);var _ref2,UserPicker=function(){function UserPicker(userList,showUserCallback,preChangeUserCallback){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,UserPicker),this.userList=userList,this.showUserCallback=showUserCallback,this.preChangeUserCallback=preChangeUserCallback,this.currentUserIndex=0,this.render=this.render.bind(this),this.setUserId=this.setUserId.bind(this)}var Constructor,protoProps,staticProps,_showUser,_render;return Constructor=UserPicker,protoProps=[{key:"setUserId",value:function(userId){var userIndex=this.userList.findIndex((function(user){return user.id===parseInt(userId)}));if(-1===userIndex)throw Error("User with id ".concat(userId," not found"));this.currentUserIndex=userIndex}},{key:"render",value:(_render=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var _yield$this$renderNav,html,js;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return this.root=document.createElement("div"),_context.next=3,this.renderNavigator();case 3:return _yield$this$renderNav=_context.sent,html=_yield$this$renderNav.html,js=_yield$this$renderNav.js,_templates.default.replaceNodeContents(this.root,html,js),_context.next=9,this.showUser(this.currentUser);case 9:this.registerEventListeners();case 10:case"end":return _context.stop()}}),_callee,this)}))),function(){return _render.apply(this,arguments)})},{key:"renderNavigator",value:function(){return _templates.default.renderForPromise("".concat("mod_forum/local/grades/local/grader","/user_picker"),{})}},{key:"renderUserChange",value:function(context){return _templates.default.renderForPromise("".concat("mod_forum/local/grades/local/grader","/user_picker/user"),context)}},{key:"showUser",value:(_showUser=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(user){var _yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,html,js,userRegion,currentUserRegion;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Promise.all([this.renderUserChange(user),this.showUserCallback(user)]);case 2:return _yield$Promise$all=_context2.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,1),_yield$Promise$all2$=_yield$Promise$all2[0],html=_yield$Promise$all2$.html,js=_yield$Promise$all2$.js,userRegion=this.root.querySelector(_selectors.default.regions.userRegion),_templates.default.replaceNodeContents(userRegion,html,js),currentUserRegion=this.root.querySelector(_selectors.default.regions.currentUser),_context2.next=12,(0,_str.get_string)("nowgradinguser","mod_forum",user.fullname);case 12:currentUserRegion.textContent=_context2.sent;case 13:case"end":return _context2.stop()}}),_callee2,this)}))),function(_x){return _showUser.apply(this,arguments)})},{key:"registerEventListeners",value:function(){var _ref,_this=this;this.root.addEventListener("click",(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(e){var button;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!(button=e.target.closest(_selectors.default.actions.changeUser))){_context3.next=9;break}return _context3.next=4,_this.preChangeUserCallback(_this.currentUser);case 4:if(_context3.sent.failed){_context3.next=9;break}return _this.updateIndex(parseInt(button.dataset.direction)),_context3.next=9,_this.showUser(_this.currentUser);case 9:case"end":return _context3.stop()}}),_callee3)}))),function(_x2){return _ref.apply(this,arguments)}))}},{key:"updateIndex",value:function(direction){return this.currentUserIndex+=direction,this.currentUserIndex<0?this.currentUserIndex=this.userList.length-1:this.currentUserIndex>this.userList.length-1&&(this.currentUserIndex=0),this.currentUserIndex}},{key:"currentUser",get:function(){return _objectSpread(_objectSpread({},this.userList[this.currentUserIndex]),{},{total:this.userList.length,displayIndex:this.currentUserIndex+1})}},{key:"rootNode",get:function(){return this.root}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),UserPicker}(),_default=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(users,showUserCallback,preChangeUserCallback){var _ref3,_ref3$initialUserId,initialUserId,userPicker,_args4=arguments;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _ref3=_args4.length>3&&void 0!==_args4[3]?_args4[3]:{},_ref3$initialUserId=_ref3.initialUserId,initialUserId=void 0===_ref3$initialUserId?null:_ref3$initialUserId,userPicker=new UserPicker(users,showUserCallback,preChangeUserCallback),initialUserId&&userPicker.setUserId(initialUserId),_context4.next=5,userPicker.render();case 5:return _context4.abrupt("return",userPicker);case 6:case"end":return _context4.stop()}}),_callee4)}))),function(_x3,_x4,_x5){return _ref2.apply(this,arguments)});return _exports.default=_default,_exports.default}));
define("mod_forum/local/grades/local/grader/gradingpanel",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}
/**
   * Grading panel functions.
   *
   * @module     mod_forum/local/grades/local/grader/gradingpnael
   * @package    mod_forum
   * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var fn,_ref,_default=(fn=regeneratorRuntime.mark((function _callee(component,context,gradingComponent,gradingSubtype,itemName){var gradingMethodHandler,GradingMethod;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return gradingMethodHandler="".concat(gradingComponent,"/grades/grader/gradingpanel"),gradingSubtype&&(gradingMethodHandler+="/".concat(gradingSubtype)),_context.next=4,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require([gradingMethodHandler],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require(gradingMethodHandler)):Promise.resolve(_systemImportTransformerGlobalIdentifier[gradingMethodHandler]);case 4:return GradingMethod=_context.sent,_context.abrupt("return",{getter:function(userId){return GradingMethod.fetchCurrentGrade(component,context,itemName,userId)},setter:function(userId,notifyStudent,formData){return GradingMethod.storeCurrentGrade(component,context,itemName,userId,notifyStudent,formData)}});case 6:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4,_x5){return _ref.apply(this,arguments)});return _exports.default=_default,_exports.default}));
define("mod_forum/local/grades/local/grader/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Define all of the selectors we will be using on the grading interface.
   *
   * @module     mod_forum/local/grades/local/grader/selectors
   * @package    mod_forum
   * @copyright  2019 Mathew May <mathew.solutions>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var getDataSelector=function(name,value){return"[data-".concat(name,'="').concat(value,'"]')},_default={buttons:{toggleFullscreen:getDataSelector("action","togglefullscreen"),closeGrader:getDataSelector("action","closegrader"),collapseGradingDrawer:getDataSelector("action","collapse-grading-drawer"),saveGrade:getDataSelector("action","savegrade"),selectUser:getDataSelector("action","select-user"),toggleSearch:getDataSelector("action","toggle-search")},regions:{bodyContainer:getDataSelector("region","body-container"),moduleContainer:getDataSelector("region","module_content_container"),moduleReplace:getDataSelector("region","module_content"),pickerRegion:getDataSelector("region","user_picker"),gradingInfoContainer:getDataSelector("region","grading-info-container"),gradingPanel:getDataSelector("region","grade"),gradingPanelContainer:getDataSelector("region","grading-panel-container"),gradingPanelErrors:getDataSelector("region","grade-errors"),searchResultsContainer:getDataSelector("region","search-results-container"),statusContainer:getDataSelector("region","status-container"),userSearchContainer:getDataSelector("region","user-search-container"),userSearchInput:getDataSelector("region","user-search-input")},values:{sendStudentNotifications:'[data-region="notification"] input[type="radio"]:checked'}};return _exports.default=_default,_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("mod_forum/local/grades/grader",["exports","core/templates","./local/grader/selectors","./local/grader/user_picker","mod_forum/local/layout/fullscreen","./local/grader/gradingpanel","core/toast","core/notification","core/str","core_grades/grades/grader/gradingpanel/normalise","core/loadingicon","core/utils","core_grades/grades/grader/gradingpanel/comparison","core/modal_factory","core/modal_events","core/pubsub","core/drawer_events"],(function(_exports,_templates,_selectors,_user_picker,_fullscreen,_gradingpanel,_toast,_notification,_str,_normalise,_loadingicon,_utils,_comparison,Modal,ModalEvents,_pubsub,_drawer_events){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"getGradingPanelFunctions",{enumerable:!0,get:function(){return _gradingpanel.default}}),_exports.view=_exports.launch=void 0,_templates=_interopRequireDefault(_templates),_selectors=_interopRequireDefault(_selectors),_user_picker=_interopRequireDefault(_user_picker),_gradingpanel=_interopRequireDefault(_gradingpanel),Modal=_interopRequireWildcard(Modal),ModalEvents=_interopRequireWildcard(ModalEvents),_drawer_events=_interopRequireDefault(_drawer_events);var _ref2,_ref4,_ref5,templateNames_grader={app:"mod_forum/local/grades/grader",gradingPanel:{error:"mod_forum/local/grades/local/grader/gradingpanel/error"},searchResults:"mod_forum/local/grades/local/grader/user_picker/user_search",status:"mod_forum/local/grades/local/grader/status"},displayUserPicker=function(root,html){var pickerRegion=root.querySelector(_selectors.default.regions.pickerRegion);_templates.default.replaceNodeContents(pickerRegion,html,"")},fetchContentFromRender=function(html,js){return[html,js]},getUpdateUserContentFunction=function(root,getContentForUser,getGradeForUser,saveGradeForUser){var _ref,firstLoad=!0;return _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(user){var spinner,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,html,js,userGrade,_yield$Templates$rend,_yield$Templates$rend2,gradingPanelHtml,gradingPanelJS,panelContainer,panel,form;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return spinner=firstLoad?null:(0,_loadingicon.addIconToContainerWithPromise)(root),_context.next=3,Promise.all([getContentForUser(user.id).then(fetchContentFromRender),getGradeForUser(user.id)]);case 3:return _yield$Promise$all=_context.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2),_yield$Promise$all2$=_slicedToArray(_yield$Promise$all2[0],2),html=_yield$Promise$all2$[0],js=_yield$Promise$all2$[1],userGrade=_yield$Promise$all2[1],_templates.default.replaceNodeContents(root.querySelector(_selectors.default.regions.moduleReplace),html,js),_context.next=12,_templates.default.render(userGrade.templatename,userGrade.grade).then(fetchContentFromRender);case 12:return _yield$Templates$rend=_context.sent,_yield$Templates$rend2=_slicedToArray(_yield$Templates$rend,2),gradingPanelHtml=_yield$Templates$rend2[0],gradingPanelJS=_yield$Templates$rend2[1],panelContainer=root.querySelector(_selectors.default.regions.gradingPanelContainer),panel=panelContainer.querySelector(_selectors.default.regions.gradingPanel),_templates.default.replaceNodeContents(panel,gradingPanelHtml,gradingPanelJS),form=panel.querySelector("form"),(0,_comparison.fillInitialValues)(form),form.addEventListener("submit",(function(event){saveGradeForUser(user),event.preventDefault()})),panelContainer.scrollTop=0,firstLoad=!1,spinner&&spinner.resolve(),_context.abrupt("return",userGrade);case 26:case"end":return _context.stop()}}),_callee)}))),function(_x){return _ref.apply(this,arguments)}},hideSearchResultContainer=function(bodyContainer,userPickerContainer,searchResultsContainer){bodyContainer.classList.remove("hidden"),userPickerContainer.classList.remove("hidden"),searchResultsContainer.classList.add("hidden")},hideUserSearchInput=function(toggleSearchButton,searchContainer,searchInput){searchContainer.classList.add("collapsed"),toggleSearchButton.setAttribute("aria-expanded","false"),toggleSearchButton.classList.add("collapse"),toggleSearchButton.classList.remove("expand"),toggleSearchButton.focus(),searchContainer.parentElement.querySelector(_selectors.default.regions.gradingInfoContainer).removeAttribute("aria-hidden");var collapseGradingDrawer=searchContainer.parentElement.querySelector(_selectors.default.buttons.collapseGradingDrawer);collapseGradingDrawer.removeAttribute("aria-hidden"),collapseGradingDrawer.setAttribute("tabindex","0"),searchInput.value=""},renderSearchResults=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(searchResultsContainer,users){var _yield$Templates$rend3,html,js;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,_templates.default.renderForPromise(templateNames_grader.searchResults,{users:users});case 2:_yield$Templates$rend3=_context2.sent,html=_yield$Templates$rend3.html,js=_yield$Templates$rend3.js,_templates.default.replaceNodeContents(searchResultsContainer,html,js);case 6:case"end":return _context2.stop()}}),_callee2)}))),function(_x2,_x3){return _ref2.apply(this,arguments)}),registerEventListeners=function(graderLayout,userPicker,saveGradeFunction,userList){var graderContainer=graderLayout.getContainer(),toggleSearchButton=graderContainer.querySelector(_selectors.default.buttons.toggleSearch),searchInputContainer=graderContainer.querySelector(_selectors.default.regions.userSearchContainer),searchInput=searchInputContainer.querySelector(_selectors.default.regions.userSearchInput),bodyContainer=graderContainer.querySelector(_selectors.default.regions.bodyContainer),userPickerContainer=graderContainer.querySelector(_selectors.default.regions.pickerRegion),searchResultsContainer=graderContainer.querySelector(_selectors.default.regions.searchResultsContainer);graderContainer.addEventListener("click",(function(e){if(e.target.closest(_selectors.default.buttons.toggleFullscreen))return e.stopImmediatePropagation(),e.preventDefault(),void graderLayout.toggleFullscreen();if(e.target.closest(_selectors.default.buttons.closeGrader))return e.stopImmediatePropagation(),e.preventDefault(),void graderLayout.close();if(e.target.closest(_selectors.default.buttons.saveGrade)&&saveGradeFunction(userPicker.currentUser),e.target.closest(_selectors.default.buttons.toggleSearch))"true"===toggleSearchButton.getAttribute("aria-expanded")?(hideUserSearchInput(toggleSearchButton,searchInputContainer,searchInput),hideSearchResultContainer(bodyContainer,userPickerContainer,searchResultsContainer),searchResultsContainer.innerHTML=""):(!function(toggleSearchButton,searchContainer,searchInput){searchContainer.classList.remove("collapsed"),toggleSearchButton.setAttribute("aria-expanded","true"),toggleSearchButton.classList.add("expand"),toggleSearchButton.classList.remove("collapse"),searchContainer.parentElement.querySelector(_selectors.default.regions.gradingInfoContainer).setAttribute("aria-hidden","true");var collapseGradingDrawer=searchContainer.parentElement.querySelector(_selectors.default.buttons.collapseGradingDrawer);collapseGradingDrawer.setAttribute("aria-hidden","true"),collapseGradingDrawer.setAttribute("tabindex","-1"),searchInput.focus()}(toggleSearchButton,searchInputContainer,searchInput),function(bodyContainer,userPickerContainer,searchResultsContainer){bodyContainer.classList.add("hidden"),userPickerContainer.classList.add("hidden"),searchResultsContainer.classList.remove("hidden")}(bodyContainer,userPickerContainer,searchResultsContainer),renderSearchResults(searchResultsContainer,userList));else{var selectUserButton=e.target.closest(_selectors.default.buttons.selectUser);if(selectUserButton){var userId=selectUserButton.getAttribute("data-userid"),user=userList.find((function(user){return user.id==userId}));userPicker.setUserId(userId),userPicker.showUser(user),hideUserSearchInput(toggleSearchButton,searchInputContainer,searchInput),hideSearchResultContainer(bodyContainer,userPickerContainer,searchResultsContainer),searchResultsContainer.innerHTML=""}}})),searchInput.addEventListener("input",(0,_utils.debounce)((function(){var users=function(userList,searchTerm){return""===searchTerm?userList:(searchTerm=searchTerm.toLowerCase(),userList.filter((function(user){return user.fullname.toLowerCase().includes(searchTerm)})))}(userList,searchInput.value);renderSearchResults(searchResultsContainer,users)}),300)),(0,_pubsub.subscribe)(_drawer_events.default.DRAWER_HIDDEN,(function(drawerRoot){drawerRoot[0].querySelector(_selectors.default.regions.gradingPanel)&&setContentContainerMargin(graderContainer,0)})),(0,_pubsub.subscribe)(_drawer_events.default.DRAWER_SHOWN,(function(drawerRoot){var gradingPanel=drawerRoot[0];gradingPanel.querySelector(_selectors.default.regions.gradingPanel)&&setContentContainerMargin(graderContainer,gradingPanel.offsetWidth)}))},setContentContainerMargin=function(graderContainer,rightMargin){var contentContainer=graderContainer.querySelector(_selectors.default.regions.moduleContainer);contentContainer&&(contentContainer.style.marginRight="".concat(rightMargin,"px"))},getSaveUserGradeFunction=function(root,setGradeForUser){return _ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(user){var result;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,root.querySelector(_selectors.default.regions.gradingPanelErrors).innerHTML="",_context3.next=4,setGradeForUser(user.id,root.querySelector(_selectors.default.values.sendStudentNotifications).value,root.querySelector(_selectors.default.regions.gradingPanel));case 4:if(!(result=_context3.sent).success){_context3.next=11;break}return _context3.t0=_toast.add,_context3.next=9,(0,_str.get_string)("grades:gradesavedfor","mod_forum",user);case 9:_context3.t1=_context3.sent,(0,_context3.t0)(_context3.t1);case 11:return result.failed&&displayGradingError(root,user,result.error),_context3.abrupt("return",result);case 15:return _context3.prev=15,_context3.t2=_context3.catch(0),displayGradingError(root,user,_context3.t2),_context3.abrupt("return",(0,_normalise.failedUpdate)(_context3.t2));case 19:case"end":return _context3.stop()}}),_callee3,null,[[0,15]])}))),function(_x4){return _ref3.apply(this,arguments)};var _ref3},displayGradingError=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(root,user,err){var _yield$Promise$all3,_yield$Promise$all4,_yield$Promise$all4$,html,js,errorString;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.t0=Promise,_context4.t1=_templates.default.renderForPromise(templateNames_grader.gradingPanel.error,{error:err}),_context4.next=4,(0,_str.get_string)("grades:gradesavefailed","mod_forum",_objectSpread({error:err.message},user));case 4:return _context4.t2=_context4.sent,_context4.t3=[_context4.t1,_context4.t2],_context4.next=8,_context4.t0.all.call(_context4.t0,_context4.t3);case 8:_yield$Promise$all3=_context4.sent,_yield$Promise$all4=_slicedToArray(_yield$Promise$all3,2),_yield$Promise$all4$=_yield$Promise$all4[0],html=_yield$Promise$all4$.html,js=_yield$Promise$all4$.js,errorString=_yield$Promise$all4[1],_templates.default.replaceNodeContents(root.querySelector(_selectors.default.regions.gradingPanelErrors),html,js),(0,_toast.add)(errorString);case 16:case"end":return _context4.stop()}}),_callee4)}))),function(_x5,_x6,_x7){return _ref4.apply(this,arguments)}),launch=(_ref5=_asyncToGenerator(regeneratorRuntime.mark((function _callee6(getListOfUsers,getContentForUser,getGradeForUser,setGradeForUser){var _ref6,_ref6$initialUserId,initialUserId,moduleName,courseName,courseUrl,sendStudentNotifications,_ref6$focusOnClose,focusOnClose,userList,_yield$Promise$all5,_yield$Promise$all6,graderLayout,_yield$Promise$all6$,html,js,graderContainer,saveGradeFunction,updateUserContent,userIds,statusContainer,userPicker,_args6=arguments;return regeneratorRuntime.wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _ref6=_args6.length>4&&void 0!==_args6[4]?_args6[4]:{},_ref6$initialUserId=_ref6.initialUserId,initialUserId=void 0===_ref6$initialUserId?null:_ref6$initialUserId,moduleName=_ref6.moduleName,courseName=_ref6.courseName,courseUrl=_ref6.courseUrl,sendStudentNotifications=_ref6.sendStudentNotifications,_ref6$focusOnClose=_ref6.focusOnClose,focusOnClose=void 0===_ref6$focusOnClose?null:_ref6$focusOnClose,_context6.next=3,getListOfUsers();case 3:if((userList=_context6.sent).length){_context6.next=12;break}return _context6.t0=_notification.addNotification,_context6.next=8,(0,_str.get_string)("nouserstograde","core_grades");case 8:return _context6.t1=_context6.sent,_context6.t2={message:_context6.t1,type:"error"},(0,_context6.t0)(_context6.t2),_context6.abrupt("return");case 12:return _context6.next=14,Promise.all([(0,_fullscreen.createLayout)({fullscreen:!1,showLoader:!1,focusOnClose:focusOnClose}),_templates.default.renderForPromise(templateNames_grader.app,{moduleName:moduleName,courseName:courseName,courseUrl:courseUrl,drawer:{show:!0},defaultsendnotifications:sendStudentNotifications})]);case 14:return _yield$Promise$all5=_context6.sent,_yield$Promise$all6=_slicedToArray(_yield$Promise$all5,2),graderLayout=_yield$Promise$all6[0],_yield$Promise$all6$=_yield$Promise$all6[1],html=_yield$Promise$all6$.html,js=_yield$Promise$all6$.js,graderContainer=graderLayout.getContainer(),saveGradeFunction=getSaveUserGradeFunction(graderContainer,setGradeForUser),_templates.default.replaceNodeContents(graderContainer,html,js),updateUserContent=getUpdateUserContentFunction(graderContainer,getContentForUser,getGradeForUser,saveGradeFunction),userIds=userList.map((function(user){return user.id})),statusContainer=graderContainer.querySelector(_selectors.default.regions.statusContainer),_context6.next=28,(0,_user_picker.default)(userList,function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(user){var userGrade,renderContext;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,updateUserContent(user);case 2:userGrade=_context5.sent,renderContext={status:userGrade.hasgrade,index:userIds.indexOf(user.id)+1,total:userList.length},_templates.default.render(templateNames_grader.status,renderContext).then((function(html){return statusContainer.innerHTML=html,html})).catch();case 5:case"end":return _context5.stop()}}),_callee5)})));return function(_x12){return _ref7.apply(this,arguments)}}(),saveGradeFunction,{initialUserId:initialUserId});case 28:userPicker=_context6.sent,registerEventListeners(graderLayout,userPicker,saveGradeFunction,userList),displayUserPicker(graderContainer,userPicker.rootNode);case 31:case"end":return _context6.stop()}}),_callee6)}))),function(_x8,_x9,_x10,_x11){return _ref5.apply(this,arguments)});_exports.launch=launch;var _ref8,view=(_ref8=_asyncToGenerator(regeneratorRuntime.mark((function _callee7(getGradeForUser,userid,moduleName){var _ref9,_ref9$focusOnClose,focusOnClose,_yield$Promise$all7,_yield$Promise$all8,userGrade,modal,spinner,output,_yield$Templates$rend4,html,js,_yield$renderGradeTem,_yield$renderGradeTem2,gradeHTML,gradeJS,gradeReplace,_args7=arguments;return regeneratorRuntime.wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _ref9=_args7.length>3&&void 0!==_args7[3]?_args7[3]:{},_ref9$focusOnClose=_ref9.focusOnClose,focusOnClose=void 0===_ref9$focusOnClose?null:_ref9$focusOnClose,_context7.next=3,Promise.all([getGradeForUser(userid),Modal.create({title:moduleName,large:!0,type:Modal.types.CANCEL})]);case 3:return _yield$Promise$all7=_context7.sent,_yield$Promise$all8=_slicedToArray(_yield$Promise$all7,2),userGrade=_yield$Promise$all8[0],modal=_yield$Promise$all8[1],spinner=(0,_loadingicon.addIconToContainerWithPromise)(modal.getRoot()),modal.getRoot().on(ModalEvents.hidden,(function(){if(modal.destroy(),focusOnClose)try{focusOnClose.focus()}catch(e){}})),modal.show(),output=document.createElement("div"),_context7.next=13,_templates.default.renderForPromise("mod_forum/local/grades/view_grade",userGrade);case 13:return _yield$Templates$rend4=_context7.sent,html=_yield$Templates$rend4.html,js=_yield$Templates$rend4.js,_templates.default.replaceNodeContents(output,html,js),_context7.next=19,renderGradeTemplate(userGrade);case 19:_yield$renderGradeTem=_context7.sent,_yield$renderGradeTem2=_slicedToArray(_yield$renderGradeTem,2),gradeHTML=_yield$renderGradeTem2[0],gradeJS=_yield$renderGradeTem2[1],gradeReplace=output.querySelector('[data-region="grade-template"]'),_templates.default.replaceNodeContents(gradeReplace,gradeHTML,gradeJS),modal.setBody(output.outerHTML),spinner.resolve();case 27:case"end":return _context7.stop()}}),_callee7)}))),function(_x13,_x14,_x15){return _ref8.apply(this,arguments)});_exports.view=view;var _ref10,renderGradeTemplate=(_ref10=_asyncToGenerator(regeneratorRuntime.mark((function _callee8(userGrade){var _yield$Templates$rend5,html,js;return regeneratorRuntime.wrap((function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,_templates.default.renderForPromise(userGrade.templatename,userGrade.grade);case 2:return _yield$Templates$rend5=_context8.sent,html=_yield$Templates$rend5.html,js=_yield$Templates$rend5.js,_context8.abrupt("return",[html,js]);case 6:case"end":return _context8.stop()}}),_callee8)}))),function(_x16){return _ref10.apply(this,arguments)})}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("mod_forum/local/layout/fullscreen",["exports","core/loadingicon","core/toast","core/local/aria/focuslock"],(function(_exports,_loadingicon,_toast,FocusLockManager){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.createLayout=void 0,FocusLockManager=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}
/**
   * Full screen window layout.
   *
   * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */(FocusLockManager);var getLayoutHelpers=function(layoutNode,FocusLockManager,focusOnClose){var contentNode=document.createElement("div");layoutNode.append(contentNode);var loadingNode=document.createElement("div");layoutNode.append(loadingNode);var requestFullscreen=function(){layoutNode.requestFullscreen?layoutNode.requestFullscreen():layoutNode.msRequestFullscreen?layoutNode.msRequestFullscreen():layoutNode.mozRequestFullscreen?layoutNode.mozRequestFullscreen():layoutNode.webkitRequestFullscreen?layoutNode.webkitRequestFullscreen():layoutNode.setTop(0)},exitFullscreen=function(){if(document.exitRequestFullScreen){if(document.fullScreenElement!==layoutNode)return;document.exitRequestFullScreen()}else if(document.msExitFullscreen){if(document.msFullscreenElement!==layoutNode)return;document.msExitFullscreen()}else if(document.mozCancelFullScreen){if(document.mozFullScreenElement!==layoutNode)return;document.mozCancelFullScreen()}else if(document.webkitExitFullscreen){if(document.webkitFullscreenElement!==layoutNode)return;document.webkitExitFullscreen()}},hideLoadingIcon=function(){for(var child=loadingNode.lastElementChild;child;)loadingNode.removeChild(child),child=loadingNode.lastElementChild};return{close:function(){if(exitFullscreen(),unlockBodyScroll(),FocusLockManager.untrapFocus(),layoutNode.remove(),focusOnClose)try{focusOnClose.focus()}catch(e){}},toggleFullscreen:function(){document.exitRequestFullScreen?document.fullScreenElement===layoutNode?exitFullscreen():requestFullscreen():document.msExitFullscreen?document.msFullscreenElement===layoutNode?exitFullscreen():requestFullscreen():document.mozCancelFullScreen?document.mozFullScreenElement===layoutNode?exitFullscreen():requestFullscreen():document.webkitExitFullscreen&&(document.webkitFullscreenElement===layoutNode?exitFullscreen():requestFullscreen())},requestFullscreen:requestFullscreen,exitFullscreen:exitFullscreen,getContainer:function(){return contentNode},setContent:function(content){hideLoadingIcon();for(var child=contentNode.lastElementChild;child;)contentNode.removeChild(child),child=contentNode.lastElementChild;contentNode.append(content)},showLoadingIcon:function(){(0,_loadingicon.addIconToContainer)(loadingNode)},hideLoadingIcon:hideLoadingIcon}},lockBodyScroll=function(){document.querySelector("body").classList.add("overflow-hidden")},unlockBodyScroll=function(){document.querySelector("body").classList.remove("overflow-hidden")},createLayout=function(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$fullscreen=_ref.fullscreen,fullscreen=void 0===_ref$fullscreen||_ref$fullscreen,_ref$showLoader=_ref.showLoader,showLoader=void 0!==_ref$showLoader&&_ref$showLoader,_ref$focusOnClose=_ref.focusOnClose,focusOnClose=void 0===_ref$focusOnClose?null:_ref$focusOnClose,container=document.createElement("div");document.body.append(container),container.classList.add("layout"),container.classList.add("fullscreen"),container.setAttribute("role","application"),(0,_toast.addToastRegion)(container),lockBodyScroll(),FocusLockManager.trapFocus(container);var helpers=getLayoutHelpers(container,FocusLockManager,focusOnClose);return showLoader&&helpers.showLoadingIcon(),fullscreen&&helpers.requestFullscreen(),helpers};_exports.createLayout=createLayout}));
define("mod_forum/local/layouts",["exports","./layout/fullscreen"],(function(_exports,_fullscreen){Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"createFullScreenWindow",{enumerable:!0,get:function(){return _fullscreen.createLayout}})}));
/**
 * Enrolled user selector module.
 *
 * @module     mod_forum/form-user-selector
 * @class      form-user-selector
 * @package    mod_forum
 * @copyright  2019 Shamim Rezaie
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/form-user-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var users=[];return $.each(results,(function(index,user){users.push({value:user.id,label:user._label})})),users},transport:function(selector,query,success,failure){var courseid=$(selector).attr("courseid");Ajax.call([{methodname:"core_enrol_search_users",args:{courseid:courseid,search:query,searchanywhere:!0,page:0,perpage:30}}])[0].then((function(results){var promises=[],i=0;return $.each(results,(function(index,user){promises.push(Templates.render("mod_forum/form-user-selector-suggestion",user))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results,(function(index,user){user._label=args[i],i++})),success(results)}))})).fail(failure)}}}));
/**
 * This module is the highest level module for the calendar. It is
 * responsible for initialising all of the components required for
 * the calendar to run. It also coordinates the interaction between
 * components by listening for and responding to different events
 * triggered within the calendar UI.
 *
 * @module     mod_forum/pin_toggle
 * @package    mod_forum
 * @copyright  2018 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/pin_toggle",["jquery","core/ajax","core/str","core/templates","core/notification","mod_forum/repository","mod_forum/selectors","core/str"],(function($,Ajax,Str,Templates,Notification,Repository,Selectors,String){return{init:function(root,preventDefault,callback){root.on("click",Selectors.pin.toggle,(function(e){var toggleElement=$(this),forumid=toggleElement.data("forumid"),discussionid=toggleElement.data("discussionid"),pinstate=toggleElement.data("targetstate");Repository.setPinDiscussionState(forumid,discussionid,pinstate).then((function(context){return callback(toggleElement,context)})).then((function(){return String.get_string("pinupdated","forum").done((function(s){return Notification.addNotification({message:s,type:"info"})}))})).fail(Notification.exception),preventDefault&&e.preventDefault()}))}}}));
/**
 * This module is the highest level module for the calendar. It is
 * responsible for initialising all of the components required for
 * the calendar to run. It also coordinates the interaction between
 * components by listening for and responding to different events
 * triggered within the calendar UI.
 *
 * @module     mod_forum/posts_list
 * @package    mod_forum
 * @copyright  2019 Peter Dias
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/posts_list",["jquery","core/templates","core/notification","core/pending","core/yui","mod_forum/selectors","mod_forum/inpage_reply"],(function($,Templates,Notification,Pending,Y,Selectors,InPageReply){return{init:function(root){!function(root){root.on("click",Selectors.post.inpageReplyLink,(function(e){if(e.preventDefault(),window.location.hash){var url=window.location.href.split("#")[0];history.pushState({},document.title,url)}var pending=new Pending("inpage-reply"),currentTarget=$(e.currentTarget).parents(Selectors.post.forumCoreContent),currentSubject=currentTarget.find(Selectors.post.forumSubject),currentRoot=$(e.currentTarget).parents(Selectors.post.forumContent),context={postid:$(currentRoot).data("post-id"),reply_url:$(e.currentTarget).attr("href"),sesskey:M.cfg.sesskey,parentsubject:currentSubject.data("replySubject"),canreplyprivately:$(e.currentTarget).data("can-reply-privately"),postformat:InPageReply.CONTENT_FORMATS.MOODLE};if(currentRoot.find(Selectors.post.inpageReplyContent).length){var form=currentRoot.find(Selectors.post.inpageReplyContent);form.slideToggle(300,pending.resolve),form.is(":visible")&&form.find("textarea").focus()}else Templates.render("mod_forum/inpage_reply",context).then((function(html,js){return Templates.appendNodeContents(currentTarget,html,js)})).then((function(){return currentRoot.find(Selectors.post.inpageReplyContent).slideToggle(300,pending.resolve).find("textarea").focus()})).then((function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.init({formid:"inpage-reply-".concat(context.postid)})}))})).fail(Notification.exception)}))}(root),InPageReply.init(root)}}}));
/**
 * Handle discussion subscription toggling on a discussion list in
 * the forum view.
 *
 * @module     mod_forum/favourite_toggle
 * @package    mod_forum
 * @copyright  2019 Peter Dias <peter@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/favourite_toggle",["jquery","core/templates","core/notification","mod_forum/repository","mod_forum/selectors","core/str"],(function($,Templates,Notification,Repository,Selectors,String){return{init:function(root,preventDefault,callback){root.on("click",Selectors.favourite.toggle,(function(e){var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),subscriptionState=toggleElement.data("targetstate");Repository.setFavouriteDiscussionState(forumId,discussionId,subscriptionState).then((function(context){return callback(toggleElement,context)})).then((function(){return String.get_string("favouriteupdated","forum").done((function(s){return Notification.addNotification({message:s,type:"info"})}))})).catch(Notification.exception),preventDefault&&e.preventDefault()}))}}}));
/**
 * This module handles the in page replying to forum posts.
 *
 * @module     mod_forum/inpage_reply
 * @package    mod_forum
 * @copyright  2019 Peter Dias
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/inpage_reply",["jquery","core/templates","core/notification","mod_forum/repository","mod_forum/selectors"],(function($,Templates,Notification,Repository,Selectors){var DISPLAYCONSTANTS_NESTED_V2=4,DISPLAYCONSTANTS_THREADED=2,DISPLAYCONSTANTS_NESTED=3,DISPLAYCONSTANTS_FLAT_NEWEST_FIRST=-1,EVENTS={POST_CREATED:"mod_forum-post-created"},CONTENT_FORMATS={MOODLE:0},hideSubmitButtonLoadingIcon=function(button){var textContainer=button.find(Selectors.post.inpageSubmitBtnText),loadingIconContainer=button.find(Selectors.post.loadingIconContainer);button.css("width",""),textContainer.removeClass("hidden"),loadingIconContainer.addClass("hidden")},registerEventListeners=function(root){root.on("click",Selectors.post.inpageSubmitBtn,(function(e){e.preventDefault();var newid,button,textContainer,loadingIconContainer,width,submitButton=$(e.currentTarget),allButtons=submitButton.parent().find(Selectors.post.inpageReplyButton),form=submitButton.parents(Selectors.post.inpageReplyForm).get(0),message=form.elements.post.value.trim(),messageformat=CONTENT_FORMATS.MOODLE,postid=form.elements.reply.value,subject=form.elements.subject.value,currentRoot=submitButton.closest(Selectors.post.post),isprivatereply=null!=form.elements.privatereply&&form.elements.privatereply.checked,modeSelector=root.find(Selectors.post.modeSelect),mode=modeSelector.length?parseInt(modeSelector.get(0).value):null;message.length&&(textContainer=(button=submitButton).find(Selectors.post.inpageSubmitBtnText),loadingIconContainer=button.find(Selectors.post.loadingIconContainer),width=button.outerWidth(),button.css("width",width),textContainer.addClass("hidden"),loadingIconContainer.removeClass("hidden"),allButtons.prop("disabled",!0),Repository.addDiscussionPost(postid,subject,message,messageformat,isprivatereply,!0).then((function(context){var message=context.messages.reduce((function(carry,message){return"success"==message.type&&(carry+="<p>"+message.message+"</p>"),carry}),"");return Notification.addNotification({message:message,type:"success"}),context})).then((function(context){form.reset();var post=context.post;switch(newid=post.id,mode){case DISPLAYCONSTANTS_NESTED_V2:var capabilities=post.capabilities,currentAuthorName=currentRoot.children().not(Selectors.post.repliesContainer).find(Selectors.post.authorName).text();return post.parentauthorname=currentAuthorName,post.showactionmenu=capabilities.view||capabilities.controlreadstatus||capabilities.edit||capabilities.split||capabilities.delete||capabilities.export||post.urls.viewparent,Templates.render("mod_forum/forum_discussion_nested_v2_post_reply",post);case DISPLAYCONSTANTS_THREADED:return Templates.render("mod_forum/forum_discussion_threaded_post",post);case DISPLAYCONSTANTS_NESTED:return Templates.render("mod_forum/forum_discussion_nested_post",post);default:return Templates.render("mod_forum/forum_discussion_post",post)}})).then((function(html,js){var repliesnode=currentRoot.find(Selectors.post.repliesContainer).first();return mode==DISPLAYCONSTANTS_FLAT_NEWEST_FIRST?Templates.prependNodeContents(repliesnode,html,js):Templates.appendNodeContents(repliesnode,html,js)})).then((function(){return submitButton.trigger(EVENTS.POST_CREATED,newid),hideSubmitButtonLoadingIcon(submitButton),allButtons.prop("disabled",!1),void 0!==M.core_formchangechecker&&M.core_formchangechecker.reset_form_dirty_state(),currentRoot.find(Selectors.post.inpageReplyContent).hide()})).then((function(){location.href="#p"+newid})).catch((function(error){return hideSubmitButtonLoadingIcon(submitButton),allButtons.prop("disabled",!1),Notification.exception(error)})))}))};return{init:function(root){registerEventListeners(root)},CONTENT_FORMATS:CONTENT_FORMATS,EVENTS:EVENTS}}));
/**
 * Handle the manual locking of individual discussions
 *
 * @module     mod_forum/lock_toggle
 * @package    mod_forum
 * @copyright  2019 Peter Dias <peter@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/lock_toggle",["jquery","core/templates","core/notification","mod_forum/repository","mod_forum/selectors"],(function($,Templates,Notification,Repository,Selectors){return{init:function(root,preventDefault){root.on("click",Selectors.lock.toggle,(function(e){var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),state=toggleElement.data("state");Repository.setDiscussionLockState(forumId,discussionId,state).then((function(){return location.reload()})).catch(Notification.exception),preventDefault&&e.preventDefault()}))}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("mod_forum/grades/grader",["exports","./grader/selectors","mod_forum/repository","core/templates","../local/grades/grader","core/notification","core_course/repository","core/url"],(function(_exports,Selectors,_repository,_templates,Grader,_notification,_repository2,_url){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.registerLaunchListeners=void 0,Selectors=_interopRequireWildcard(Selectors),_repository=_interopRequireDefault(_repository),_templates=_interopRequireDefault(_templates),Grader=_interopRequireWildcard(Grader),_notification=_interopRequireDefault(_notification),_repository2=_interopRequireDefault(_repository2);var _ref2,_ref4,templateNames_contentRegion="mod_forum/grades/grader/discussion/posts",getContentForUserIdFunction=function(cmid,experimentalDisplayMode){return function(userid){return _repository.default.getDiscussionByUserID(userid,cmid).then((function(context){return context.discussions=context.discussions.map(discussionPostMapper),context.experimentaldisplaymode=!!experimentalDisplayMode,_templates.default.render(templateNames_contentRegion,context)})).catch(_notification.default.exception)}},getUsersForCmidFunction=function(cmid,groupID){return _asyncToGenerator(regeneratorRuntime.mark((function _callee(){var context;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_repository2.default.getUsersFromCourseModuleID(cmid,groupID);case 2:return context=_context.sent,_context.abrupt("return",context.users);case 4:case"end":return _context.stop()}}),_callee)})))},findGradableNode=function(node){return node.closest(Selectors.gradableItem)},discussionPostMapper=function(discussion){var parentMap=new Map;discussion.posts.parentposts.forEach((function(post){return parentMap.set(post.id,post)}));var userPosts=discussion.posts.userposts.map((function(post){post.readonly=!0,post.hasreplies=!1,post.replies=[];var parent=post.parentid?parentMap.get(post.parentid):null;return parent&&(parent.hasreplies=!1,parent.replies=[],parent.readonly=!0,post.parentauthorname=parent.author.fullname),{parent:parent,post:post}}));return _objectSpread(_objectSpread({},discussion),{},{posts:userPosts})},launchWholeForumGrading=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(rootNode){var _ref3,_ref3$focusOnClose,focusOnClose,data,gradingPanelFunctions,groupID,_args2=arguments;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _ref3=_args2.length>1&&void 0!==_args2[1]?_args2[1]:{},_ref3$focusOnClose=_ref3.focusOnClose,focusOnClose=void 0===_ref3$focusOnClose?null:_ref3$focusOnClose,data=rootNode.dataset,_context2.next=4,Grader.getGradingPanelFunctions("mod_forum",data.contextid,data.gradingComponent,data.gradingComponentSubtype,data.gradableItemtype);case 4:return gradingPanelFunctions=_context2.sent,groupID=data.group?data.group:0,_context2.next=8,Grader.launch(getUsersForCmidFunction(data.cmid,groupID),getContentForUserIdFunction(data.cmid,"1"==data.experimentalDisplayMode),gradingPanelFunctions.getter,gradingPanelFunctions.setter,{groupid:data.groupid,initialUserId:data.initialuserid,moduleName:data.name,courseName:data.courseName,courseUrl:(0,_url.relativeUrl)("/course/view.php",{id:data.courseId}),sendStudentNotifications:data.sendStudentNotifications,focusOnClose:focusOnClose});case 8:case"end":return _context2.stop()}}),_callee2)}))),function(_x){return _ref2.apply(this,arguments)}),launchViewGrading=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(rootNode){var _ref5,_ref5$focusOnClose,focusOnClose,data,gradingPanelFunctions,_args3=arguments;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _ref5=_args3.length>1&&void 0!==_args3[1]?_args3[1]:{},_ref5$focusOnClose=_ref5.focusOnClose,focusOnClose=void 0===_ref5$focusOnClose?null:_ref5$focusOnClose,data=rootNode.dataset,_context3.next=4,Grader.getGradingPanelFunctions("mod_forum",data.contextid,data.gradingComponent,data.gradingComponentSubtype,data.gradableItemtype);case 4:return gradingPanelFunctions=_context3.sent,_context3.next=7,Grader.view(gradingPanelFunctions.getter,data.userid,data.name,{focusOnClose:focusOnClose});case 7:case"end":return _context3.stop()}}),_callee3)}))),function(_x2){return _ref4.apply(this,arguments)});_exports.registerLaunchListeners=function(){var _ref6;document.addEventListener("click",(_ref6=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(e){var rootNode,_rootNode;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!e.target.matches(Selectors.launch)){_context4.next=17;break}if(rootNode=findGradableNode(e.target)){_context4.next=4;break}throw Error("Unable to find a gradable item");case 4:if(!rootNode.matches(Selectors.gradableItems.wholeForum)){_context4.next=16;break}return e.preventDefault(),_context4.prev=6,_context4.next=9,launchWholeForumGrading(rootNode,{focusOnClose:e.target});case 9:_context4.next=14;break;case 11:_context4.prev=11,_context4.t0=_context4.catch(6),_notification.default.exception(_context4.t0);case 14:_context4.next=17;break;case 16:throw Error("Unable to find a valid gradable item");case 17:if(!e.target.matches(Selectors.viewGrade)){_context4.next=35;break}if(e.preventDefault(),_rootNode=findGradableNode(e.target)){_context4.next=22;break}throw Error("Unable to find a gradable item");case 22:if(!_rootNode.matches(Selectors.gradableItems.wholeForum)){_context4.next=34;break}return e.preventDefault(),_context4.prev=24,_context4.next=27,launchViewGrading(_rootNode,{focusOnClose:e.target});case 27:_context4.next=32;break;case 29:_context4.prev=29,_context4.t1=_context4.catch(24),_notification.default.exception(_context4.t1);case 32:_context4.next=35;break;case 34:throw Error("Unable to find a valid gradable item");case 35:case"end":return _context4.stop()}}),_callee4,null,[[6,11],[24,29]])}))),function(_x3){return _ref6.apply(this,arguments)}))}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("mod_forum/grades/expandconversation",["exports","./grader/selectors","mod_forum/repository","core/notification","core/templates","core/modal_factory","core/modal_events"],(function(_exports,ForumSelectors,_repository,_notification,_templates,Modal,ModalEvents){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.registerEventListeners=void 0,ForumSelectors=_interopRequireWildcard(ForumSelectors),_repository=_interopRequireDefault(_repository),_templates=_interopRequireDefault(_templates),Modal=_interopRequireWildcard(Modal),ModalEvents=_interopRequireWildcard(ModalEvents);var fn,_ref,showPostInContext=(fn=regeneratorRuntime.mark((function _callee(rootNode){var _ref2,_ref2$focusOnClose,focusOnClose,postId,discussionId,discussionName,experimentalDisplayMode,_yield$Promise$all,_yield$Promise$all2,allPosts,modal,postsById,posts,templatePromise,_args=arguments;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _ref2=_args.length>1&&void 0!==_args[1]?_args[1]:{},_ref2$focusOnClose=_ref2.focusOnClose,focusOnClose=void 0===_ref2$focusOnClose?null:_ref2$focusOnClose,postId=rootNode.dataset.postid,discussionId=rootNode.dataset.discussionid,discussionName=rootNode.dataset.name,experimentalDisplayMode="1"==rootNode.dataset.experimentalDisplayMode,_context.next=7,Promise.all([_repository.default.getDiscussionPosts(parseInt(discussionId)),Modal.create({title:discussionName,large:!0,type:Modal.types.CANCEL})]);case 7:_yield$Promise$all=_context.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2),allPosts=_yield$Promise$all2[0],modal=_yield$Promise$all2[1],postsById=new Map(allPosts.posts.map((function(post){return post.readonly=!0,post.hasreplies=!1,post.replies=[],[post.id,post]}))),posts=[],allPosts.posts.forEach((function(post){if(post.parentid){var parent=postsById.get(post.parentid);parent?(post.parentauthorname=parent.author.fullname,parent.hasreplies=!0,parent.replies.push(post)):posts.push(post)}else posts.push(post)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy();try{focusOnClose.focus()}catch(e){}})),modal.getRoot().on(ModalEvents.bodyRendered,(function(){var relevantPost=modal.getRoot()[0].querySelector("#p".concat(postId));relevantPost&&relevantPost.scrollIntoView({behavior:"smooth"})})),modal.show(),templatePromise=_templates.default.render("mod_forum/grades/grader/discussion/post_modal",{posts:posts,experimentaldisplaymode:experimentalDisplayMode}),modal.setBody(templatePromise);case 19:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x){return _ref.apply(this,arguments)});_exports.registerEventListeners=function(rootNode){rootNode.addEventListener("click",(function(e){var rootNode=e.target.closest(ForumSelectors.expandConversation);if(rootNode){e.preventDefault();try{showPostInContext(rootNode,{focusOnClose:e.target})}catch(err){(0,_notification.exception)(err)}}}))}}));
define("mod_forum/grades/grader/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={launch:'[data-grade-action="launch"]',gradableItem:"[data-gradable-itemtype]",gradableItems:{wholeForum:'[data-gradable-itemtype="forum"]'},expandConversation:'[data-action="view-context"]',posts:'[data-region="posts"]',viewGrade:'[data-grade-action="view"]'},_exports.default}));
/**
 * Handle discussion subscription toggling on a discussion list in
 * the forum view.
 *
 * @module     mod_forum/subscription_toggle
 * @package    mod_forum
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/subscription_toggle",["jquery","core/templates","core/notification","mod_forum/repository","mod_forum/selectors","core/pubsub","mod_forum/forum_events"],(function($,Templates,Notification,Repository,Selectors,PubSub,ForumEvents){return{init:function(root,preventDefault,callback){root.on("click",Selectors.subscription.toggle,(function(e){var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),subscriptionState=toggleElement.data("targetstate");Repository.setDiscussionSubscriptionState(forumId,discussionId,subscriptionState).then((function(context){return PubSub.publish(ForumEvents.SUBSCRIPTION_TOGGLED,{discussionId:discussionId,subscriptionState:subscriptionState}),callback(toggleElement,context)})).catch(Notification.exception),preventDefault&&e.preventDefault()}))}}}));
define("mod_forum/discussion_nested_v2",["exports","jquery","core/auto_rows","core/custom_interaction_events","core/notification","core/templates","mod_forum/discussion","mod_forum/inpage_reply","mod_forum/lock_toggle","mod_forum/favourite_toggle","mod_forum/pin_toggle","mod_forum/selectors","mod_forum/subscription_toggle"],(function(_exports,_jquery,_auto_rows,_custom_interaction_events,_notification,_templates,_discussion,_inpage_reply,_lock_toggle,_favourite_toggle,_pin_toggle,_selectors,_subscription_toggle){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_auto_rows=_interopRequireDefault(_auto_rows),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates),_discussion=_interopRequireDefault(_discussion),_inpage_reply=_interopRequireDefault(_inpage_reply),_lock_toggle=_interopRequireDefault(_lock_toggle),_favourite_toggle=_interopRequireDefault(_favourite_toggle),_pin_toggle=_interopRequireDefault(_pin_toggle),_selectors=_interopRequireDefault(_selectors),_subscription_toggle=_interopRequireDefault(_subscription_toggle);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var getPostContainer=function(element){return element.closest(_selectors.default.post.post)},getPostContainerById=function(element,id){return element.find("".concat(_selectors.default.post.post,"[data-post-id=").concat(id,"]"))},getPostContentContainer=function(postContainer){return postContainer.children().not(_selectors.default.post.repliesContainer).find(_selectors.default.post.forumCoreContent)},getInPageReplyContainer=function(postContainer){return postContainer.children().filter(_selectors.default.post.inpageReplyContainer)},getInPageReplyForm=function(postContainer){return getInPageReplyContainer(postContainer).find(_selectors.default.post.inpageReplyContent)},getInPageReplyCreateButton=function(postContainer){return getPostContentContainer(postContainer).find(_selectors.default.post.inpageReplyCreateButton)},getRepliesVisibilityToggleContainer=function(postContainer){return postContainer.children(_selectors.default.post.repliesVisibilityToggleContainer)},getRepliesContainer=function(postContainer){return postContainer.children(_selectors.default.post.repliesContainer)},hasReplies=function(postContainer){return getRepliesContainer(postContainer).children().length>0},getShowRepliesButton=function(replyVisibilityToggleContainer){return replyVisibilityToggleContainer.find(_selectors.default.post.showReplies)},getHideRepliesButton=function(replyVisibilityToggleContainer){return replyVisibilityToggleContainer.find(_selectors.default.post.hideReplies)},repliesVisible=function(postContainer){return getRepliesContainer(postContainer).is(":visible")},showReplies=function(postContainer){var postIdToSee=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,repliesContainer=getRepliesContainer(postContainer),replyVisibilityToggleContainer=getRepliesVisibilityToggleContainer(postContainer),showButton=getShowRepliesButton(replyVisibilityToggleContainer),hideButton=getHideRepliesButton(replyVisibilityToggleContainer);showButton.addClass("hidden"),hideButton.removeClass("hidden"),repliesContainer.slideDown({duration:150,queue:!1,complete:function(){if(postIdToSee){var postContainerToSee=getPostContainerById(repliesContainer,postIdToSee);postContainerToSee.length&&postContainerToSee[0].scrollIntoView()}}}).css("display","none").fadeIn(150)},hideReplies=function(postContainer){var repliesContainer=getRepliesContainer(postContainer),replyVisibilityToggleContainer=getRepliesVisibilityToggleContainer(postContainer),showButton=getShowRepliesButton(replyVisibilityToggleContainer),hideButton=getHideRepliesButton(replyVisibilityToggleContainer);showButton.removeClass("hidden"),hideButton.addClass("hidden"),repliesContainer.slideUp({duration:150,queue:!1}).fadeOut(150)},showInPageReplyForm=null,buildShowInPageReplyFormFunction=function(additionalTemplateContext){return fn=regeneratorRuntime.mark((function _callee(postContainer){var inPageReplyContainer,repliesVisibilityToggleContainer,inPageReplyCreateButton,html;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(inPageReplyContainer=getInPageReplyContainer(postContainer),repliesVisibilityToggleContainer=getRepliesVisibilityToggleContainer(postContainer),inPageReplyCreateButton=getInPageReplyCreateButton(postContainer),hasInPageReplyForm(inPageReplyContainer)){_context.next=15;break}return _context.prev=4,_context.next=7,renderInPageReplyTemplate(additionalTemplateContext,inPageReplyCreateButton,postContainer);case 7:html=_context.sent,_templates.default.appendNodeContents(inPageReplyContainer,html,""),_context.next=14;break;case 11:_context.prev=11,_context.t0=_context.catch(4),_notification.default.exception(_context.t0);case 14:("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/yui"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/yui")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/yui"])).then((function(Y){return new Promise((function(resolve){Y.use("moodle-core-formchangechecker",(function(Y){resolve(Y)}))}))})).then((function(Y){return M.core_formchangechecker.init({formid:Y.one(postContainer[0].querySelector("form")).generateID()}),Y})).catch();case 15:inPageReplyCreateButton.fadeOut(150,(function(){var inPageReplyForm=getInPageReplyForm(postContainer);inPageReplyForm.slideDown({duration:150,queue:!1,complete:function(){inPageReplyForm.find("textarea").focus()}}).css("display","none").fadeIn(150),repliesVisibilityToggleContainer.length&&hasReplies(postContainer)&&(repliesVisibilityToggleContainer.fadeIn(150),hideReplies(postContainer))}));case 16:case"end":return _context.stop()}}),_callee,null,[[4,11]])})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x){return _ref.apply(this,arguments)};var fn,_ref},hideInPageReplyForm=function(postContainer){var postIdToSee=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,inPageReplyForm=getInPageReplyForm(postContainer),inPageReplyCreateButton=getInPageReplyCreateButton(postContainer),repliesVisibilityToggleContainer=getRepliesVisibilityToggleContainer(postContainer);repliesVisibilityToggleContainer.length&&hasReplies(postContainer)&&(repliesVisibilityToggleContainer.fadeOut(150),repliesVisible(postContainer)||showReplies(postContainer,postIdToSee)),inPageReplyForm.slideUp({duration:150,queue:!1,complete:function(){inPageReplyCreateButton.fadeIn(150)}}).fadeOut(200)},hasInPageReplyForm=function(inPageReplyContainer){return inPageReplyContainer.find(_selectors.default.post.inpageReplyContent).length>0},renderInPageReplyTemplate=function(additionalTemplateContext,button,postContainer){var postContentContainer=getPostContentContainer(postContainer),currentSubject=postContentContainer.find(_selectors.default.post.forumSubject).text(),currentAuthorName=postContentContainer.find(_selectors.default.post.authorName).text(),context=function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({postid:postContainer.data("post-id"),reply_url:button.attr("data-href"),sesskey:M.cfg.sesskey,parentsubject:currentSubject,parentauthorname:currentAuthorName,canreplyprivately:button.data("can-reply-privately"),postformat:_inpage_reply.default.CONTENT_FORMATS.MOODLE},additionalTemplateContext);return _templates.default.render("mod_forum/inpage_reply_v2",context)},registerEventListeners=function(root){_custom_interaction_events.default.define(root,[_custom_interaction_events.default.events.activate]),_auto_rows.default.init(root),root.on(_custom_interaction_events.default.events.activate,_selectors.default.post.inpageReplyCreateButton,(function(e,data){data.originalEvent.preventDefault();var postContainer=getPostContainer((0,_jquery.default)(e.currentTarget));showInPageReplyForm(postContainer)})),root.on(_custom_interaction_events.default.events.activate,_selectors.default.post.inpageReplyCancelButton,(function(e,data){data.originalEvent.preventDefault();var postContainer=getPostContainer((0,_jquery.default)(e.currentTarget));hideInPageReplyForm(postContainer)})),root.on(_custom_interaction_events.default.events.activate,_selectors.default.post.showReplies,(function(e,data){data.originalEvent.preventDefault();var postContainer=getPostContainer((0,_jquery.default)(e.target));showReplies(postContainer)})),root.on(_custom_interaction_events.default.events.activate,_selectors.default.post.hideReplies,(function(e,data){data.originalEvent.preventDefault();var postContainer=getPostContainer((0,_jquery.default)(e.target));hideReplies(postContainer)})),root.on(_inpage_reply.default.EVENTS.POST_CREATED,_selectors.default.post.inpageSubmitBtn,(function(e,newPostId){var currentTarget=(0,_jquery.default)(e.currentTarget),postContainer=getPostContainer(currentTarget),postContainers=currentTarget.parents(_selectors.default.post.post);hideInPageReplyForm(postContainer,newPostId),postContainers.each((function(index,container){!function(postContainer){getRepliesVisibilityToggleContainer(postContainer).find(_selectors.default.post.replyCount).each((function(index,element){var currentCount=parseInt(element.innerText,10);element.innerText=currentCount+1}))}((0,_jquery.default)(container))}))}))};_exports.init=function(root,context){showInPageReplyForm=buildShowInPageReplyFormFunction(context),registerEventListeners(root),_discussion.default.init(root),_inpage_reply.default.init(root);var discussionToolsContainer=root.find(_selectors.default.discussion.tools);_lock_toggle.default.init(discussionToolsContainer,!1),_favourite_toggle.default.init(discussionToolsContainer,!1,(function(toggleElement,response){var newTargetState=response.userstate.favourited?0:1;return toggleElement.data("targetstate",newTargetState)})),_pin_toggle.default.init(discussionToolsContainer,!1,(function(toggleElement,response){var newTargetState=response.pinned?0:1;return toggleElement.data("targetstate",newTargetState)})),_subscription_toggle.default.init(discussionToolsContainer,!1,(function(toggleElement,response){var newTargetState=response.userstate.subscribed?0:1;toggleElement.data("targetstate",newTargetState)}))}}));
/**
 * Common CSS selectors for the forum UI.
 *
 * @module     mod_forum/selectors
 * @package    mod_forum
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/selectors",[],(function(){return{subscription:{toggle:"[data-type='subscription-toggle'][data-action='toggle']"},summary:{actions:"[data-container='discussion-summary-actions']"},post:{post:'[data-region="post"]',action:'[data-region="post-action"]',actionsContainer:'[data-region="post-actions-container"]',authorName:'[data-region="author-name"]',forumCoreContent:"[data-region-content='forum-post-core']",forumContent:"[data-content='forum-post']",forumSubject:"[data-region-content='forum-post-core-subject']",inpageReplyButton:"button",inpageReplyLink:"[data-action='collapsible-link']",inpageReplyCancelButton:"[data-action='cancel-inpage-reply']",inpageReplyCreateButton:"[data-action='create-inpage-reply']",inpageReplyContainer:'[data-region="inpage-reply-container"]',inpageReplyContent:"[data-content='inpage-reply-content']",inpageReplyForm:"form[data-content='inpage-reply-form']",inpageSubmitBtn:"[data-action='forum-inpage-submit']",inpageSubmitBtnText:"[data-region='submit-text']",loadingIconContainer:"[data-region='loading-icon-container']",repliesContainer:"[data-region='replies-container']",replyCount:'[data-region="reply-count"]',modeSelect:"select[name='mode']",showReplies:'[data-action="show-replies"]',hideReplies:'[data-action="hide-replies"]',repliesVisibilityToggleContainer:'[data-region="replies-visibility-toggle-container"]'},lock:{toggle:"[data-action='toggle'][data-type='lock-toggle']",icon:"[data-region='locked-icon']"},favourite:{toggle:"[data-type='favorite-toggle'][data-action='toggle']"},pin:{toggle:"[data-type='pin-toggle'][data-action='toggle']"},discussion:{tools:'[data-container="discussion-tools"]',item:'[data-region="discussion-list-item"]',lockedLabel:"[data-region='locked-label']",subscribedLabel:"[data-region='subscribed-label']",timedLabel:"[data-region='timed-label']"}}}));
/**
 * Events for the forum activity.
 *
 * @module     mod_forum/forum_events
 * @package    mod_forum
 * @copyright  2019 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/forum_events",[],(function(){return{SUBSCRIPTION_TOGGLED:"mod_forum/subscription_toggle:subscriptionToggled"}}));
/**
 * Handles the return params from the external registration page after it
 * redirects back to Moodle.
 *
 * See also: mod/lti/externalregistrationreturn.php
 *
 * @module     mod_lti/external_registration_return
 * @class      external_registration_return
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/external_registration_return",[],(function(){return{init:function(message,error,id,status){window.parent&&window.parent.triggerExternalRegistrationComplete({message:message,error:error,id:id,status:status})}}}));
/**
 * A list of keys and their keycodes that are used by the LTI modules.
 *
 * @module     mod_lti/keys
 * @class      keys
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/keys",[],(function(){return{ENTER:13,SPACE:32}}));
/**
 * Processes the result of LTI tool creation from a Content-Item message type.
 *
 * @module     mod_lti/contentitem_return
 * @class      contentitem_return
 * @package    mod_lti
 * @copyright  2016 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("mod_lti/contentitem_return",["jquery"],(function($){return{init:function(returnData){$(window).ready((function(){window!=top?parent.processContentItemReturnData(returnData):window.processContentItemReturnData(returnData)}))}}}));
/**
 * Standard Ajax wrapper for Moodle. It calls the central Ajax script,
 * which can call any existing webservice using the current session.
 * In addition, it can batch multiple requests and return multiple responses.
 *
 * @module     mod_lti/tool_configure_controller
 * @class      tool_configure_controller
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/tool_configure_controller",["jquery","core/ajax","core/notification","core/templates","mod_lti/events","mod_lti/keys","mod_lti/tool_type","mod_lti/tool_proxy","core/str"],(function($,ajax,notification,templates,ltiEvents,KEYS,toolType,toolProxy,str){var SELECTORS_EXTERNAL_REGISTRATION_CONTAINER="#external-registration-container",SELECTORS_CARTRIDGE_REGISTRATION_CONTAINER="#cartridge-registration-container",SELECTORS_CARTRIDGE_REGISTRATION_FORM="#cartridge-registration-form",SELECTORS_ADD_TOOL_FORM="#add-tool-form",SELECTORS_TOOL_LIST_CONTAINER="#tool-list-container",SELECTORS_TOOL_CREATE_BUTTON="#tool-create-button",SELECTORS_REGISTRATION_CHOICE_CONTAINER="#registration-choice-container",SELECTORS_TOOL_URL="#tool-url",getToolListContainer=function(){return $(SELECTORS_TOOL_LIST_CONTAINER)},getExternalRegistrationContainer=function(){return $(SELECTORS_EXTERNAL_REGISTRATION_CONTAINER)},getCartridgeRegistrationContainer=function(){return $(SELECTORS_CARTRIDGE_REGISTRATION_CONTAINER)},getRegistrationChoiceContainer=function(){return $(SELECTORS_REGISTRATION_CHOICE_CONTAINER)},hideExternalRegistration=function(){getExternalRegistrationContainer().addClass("hidden")},hideCartridgeRegistration=function(){getCartridgeRegistrationContainer().addClass("hidden")},hideRegistrationChoices=function(){getRegistrationChoiceContainer().addClass("hidden")},showRegistrationChoices=function(){hideExternalRegistration(),hideCartridgeRegistration(),getRegistrationChoiceContainer().removeClass("hidden"),screenReaderAnnounce(getRegistrationChoiceContainer())},screenReaderAnnounce=function(element){element.children().detach().appendTo(element)},startLoading=function(element){element.addClass("loading")},stopLoading=function(element){element.removeClass("loading")},reloadToolList=function(){var promise=$.Deferred(),container=getToolListContainer();startLoading(container),$.when(toolType.query(),toolProxy.query({orphanedonly:!0})).done((function(types,proxies){templates.render("mod_lti/tool_list",{tools:types,proxies:proxies}).done((function(html,js){container.empty(),container.append(html),templates.runTemplateJS(js),promise.resolve()})).fail(promise.reject)})).fail(promise.reject),promise.fail(notification.exception).always((function(){stopLoading(container)}))},addTool=function(){var url=$(SELECTORS_TOOL_URL).val().trim();if(""===url)return $.Deferred().resolve();var toolButton=$(SELECTORS_TOOL_CREATE_BUTTON);startLoading(toolButton);var promise=toolType.isCartridge(url);return promise.always((function(){stopLoading(toolButton)})),promise.done((function(result){result.iscartridge?($(SELECTORS_TOOL_URL).val(""),$(document).trigger(ltiEvents.START_CARTRIDGE_REGISTRATION,url)):$(document).trigger(ltiEvents.START_EXTERNAL_REGISTRATION,{url:url})})),promise.fail((function(){str.get_string("errorbadurl","mod_lti").done((function(s){$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,{message:s,error:!0})})).fail(notification.exception)})),promise},registerEventListeners=function(){$(document).on(ltiEvents.NEW_TOOL_TYPE,(function(){reloadToolList()})),$(document).on(ltiEvents.START_EXTERNAL_REGISTRATION,(function(){hideCartridgeRegistration(),hideRegistrationChoices(),getExternalRegistrationContainer().removeClass("hidden"),screenReaderAnnounce(getExternalRegistrationContainer()),$(SELECTORS_TOOL_URL).val(""),getToolListContainer().addClass("hidden")})),$(document).on(ltiEvents.STOP_EXTERNAL_REGISTRATION,(function(){getToolListContainer().removeClass("hidden"),showRegistrationChoices()})),$(document).on(ltiEvents.START_CARTRIDGE_REGISTRATION,(function(event,url){!function(url){hideExternalRegistration(),hideRegistrationChoices();var container=getCartridgeRegistrationContainer();container.find("input").val(""),container.removeClass("hidden"),container.find(SELECTORS_CARTRIDGE_REGISTRATION_FORM).attr("data-cartridge-url",url),screenReaderAnnounce(container)}(url)})),$(document).on(ltiEvents.STOP_CARTRIDGE_REGISTRATION,(function(){getCartridgeRegistrationContainer().find(SELECTORS_CARTRIDGE_REGISTRATION_FORM).removeAttr("data-cartridge-url"),showRegistrationChoices()})),$(document).on(ltiEvents.REGISTRATION_FEEDBACK,(function(event,data){!function(data){var type=data.error?"error":"success";notification.addNotification({message:data.message,type:type})}(data)})),$(SELECTORS_ADD_TOOL_FORM).submit((function(e){e.preventDefault(),addTool()}))};return{init:function(){registerEventListeners(),reloadToolList()}}}));
/**
 * Launches the modal dialogue that contains the iframe that sends the Content-Item selection request to an
 * LTI tool provider that supports Content-Item type message.
 *
 * See template: mod_lti/contentitem
 *
 * @module     mod_lti/contentitem
 * @class      contentitem
 * @package    mod_lti
 * @copyright  2016 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("mod_lti/contentitem",["jquery","core/notification","core/str","core/templates","mod_lti/form-field","core/modal_factory","core/modal_events"],(function($,notification,str,templates,FormField,ModalFactory,ModalEvents){var dialogue,doneCallback,contentItem={init:function(url,postData,cb){doneCallback=cb;var context={url:url,postData:postData},bodyPromise=templates.render("mod_lti/contentitem",context);if(dialogue)return dialogue.setBody(bodyPromise),void dialogue.show();str.get_string("selectcontent","lti").then((function(title){return ModalFactory.create({title:title,body:bodyPromise,large:!0})})).then((function(modal){dialogue=modal,modal.getRoot().on(ModalEvents.hidden,(function(){modal.setBody(""),notification.fetchNotifications()})),modal.show()})).catch(notification.exception)}},ltiFormFields=[new FormField("name",FormField.TYPES.TEXT,!1,""),new FormField("introeditor",FormField.TYPES.EDITOR,!1,""),new FormField("toolurl",FormField.TYPES.TEXT,!0,""),new FormField("securetoolurl",FormField.TYPES.TEXT,!0,""),new FormField("instructorchoiceacceptgrades",FormField.TYPES.CHECKBOX,!0,!0),new FormField("instructorchoicesendname",FormField.TYPES.CHECKBOX,!0,!0),new FormField("instructorchoicesendemailaddr",FormField.TYPES.CHECKBOX,!0,!0),new FormField("instructorcustomparameters",FormField.TYPES.TEXT,!0,""),new FormField("icon",FormField.TYPES.TEXT,!0,""),new FormField("secureicon",FormField.TYPES.TEXT,!0,""),new FormField("launchcontainer",FormField.TYPES.SELECT,!0,0),new FormField("grade_modgrade_point",FormField.TYPES.TEXT,!1,""),new FormField("lineitemresourceid",FormField.TYPES.TEXT,!0,""),new FormField("lineitemtag",FormField.TYPES.TEXT,!0,"")];return window.processContentItemReturnData=function(returnData){var index;for(index in dialogue&&dialogue.hide(),ltiFormFields){var field=ltiFormFields[index],value=null;void 0!==returnData[field.name]&&(value=returnData[field.name]),field.setFieldValue(value)}doneCallback&&doneCallback()},contentItem}));
/**
 * Provides an interface for a tool type in the Moodle server.
 *
 * @module     mod_lti/tool_type
 * @class      tool_type
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/tool_type",["core/ajax","core/notification"],(function(ajax,notification){return{query:function(args){var request={methodname:"mod_lti_get_tool_types",args:args||{}},promise=ajax.call([request])[0];return promise.fail(notification.exception),promise},create:function(args){var request={methodname:"mod_lti_create_tool_type",args:args};return ajax.call([request])[0]},update:function(args){var request={methodname:"mod_lti_update_tool_type",args:args},promise=ajax.call([request])[0];return promise.fail(notification.exception),promise},delete:function(id){var request={methodname:"mod_lti_delete_tool_type",args:{id:id}},promise=ajax.call([request])[0];return promise.fail(notification.exception),promise},getFromToolProxyId:function(id){return this.query({toolproxyid:id})},isCartridge:function(url){var request={methodname:"mod_lti_is_cartridge",args:{url:url}};return ajax.call([request])[0]},constants:{state:{configured:1,pending:2,rejected:3}}}}));
/**
 * Provides an interface for a tool proxy in the Moodle server.
 *
 * @module     mod_lti/tool_proxy
 * @class      tool_proxy
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/tool_proxy",["core/ajax","core/notification"],(function(ajax,notification){return{query:function(args){var request={methodname:"mod_lti_get_tool_proxies",args:args||{}},promise=ajax.call([request])[0];return promise.fail(notification.exception),promise},delete:function(id){var request={methodname:"mod_lti_delete_tool_proxy",args:{id:id}},promise=ajax.call([request])[0];return promise.fail(notification.exception),promise},create:function(args){var request={methodname:"mod_lti_create_tool_proxy",args:args};return ajax.call([request])[0]}}}));
/**
 * Encapsules the behavior for creating a tool type and tool proxy from a
 * registration url in Moodle.
 *
 * Manages the UI while operations are occuring, including rendering external
 * registration page within the iframe.
 *
 * See template: mod_lti/external_registration
 *
 * @module     mod_lti/external_registration
 * @class      external_registration
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/external_registration",["jquery","core/ajax","core/notification","core/templates","mod_lti/events","mod_lti/tool_proxy","mod_lti/tool_type","mod_lti/keys","core/str"],(function($,ajax,notification,templates,ltiEvents,toolProxy,toolType,KEYS,str){var SELECTORS_EXTERNAL_REGISTRATION_CONTAINER="#external-registration-page-container",SELECTORS_EXTERNAL_REGISTRATION_TEMPLATE_CONTAINER="#external-registration-template-container",SELECTORS_EXTERNAL_REGISTRATION_CANCEL_BUTTON="#cancel-external-registration",SELECTORS_TOOL_TYPE_CAPABILITIES_CONTAINER="#tool-type-capabilities-container",SELECTORS_TOOL_TYPE_CAPABILITIES_TEMPLATE_CONTAINER="#tool-type-capabilities-template-container",SELECTORS_CAPABILITIES_AGREE_CONTAINER=".capabilities-container",getExternalRegistrationCancelButton=function(){return $(SELECTORS_EXTERNAL_REGISTRATION_CANCEL_BUTTON)},getExternalRegistrationContainer=function(){return $(SELECTORS_EXTERNAL_REGISTRATION_CONTAINER)},getExternalRegistrationTemplateContainer=function(){return $(SELECTORS_EXTERNAL_REGISTRATION_TEMPLATE_CONTAINER)},getToolTypeCapabilitiesContainer=function(){return $(SELECTORS_TOOL_TYPE_CAPABILITIES_CONTAINER)},stopLoadingCancel=function(){getExternalRegistrationCancelButton().removeClass("loading")},hideExternalRegistrationContent=function(){getExternalRegistrationContainer().addClass("hidden")},getToolProxyId=function(){return getExternalRegistrationCancelButton().attr("data-tool-proxy-id")},hasToolProxyId=function(){return!!getToolProxyId()},hasCreatedToolProxy=function(){return getExternalRegistrationCancelButton().attr("data-tool-proxy-new")&&hasToolProxyId()},cancelRegistration=function(){getExternalRegistrationCancelButton().addClass("loading");var promise=$.Deferred();if(hasCreatedToolProxy()){var id=getToolProxyId();toolProxy.delete(id).done((function(){promise.resolve()})).fail((function(failure){promise.reject(failure)}))}else promise.resolve();return promise.done((function(){finishExternalRegistration(),stopLoadingCancel()})).fail((function(failure){notification.exception(failure),finishExternalRegistration(),stopLoadingCancel(),str.get_string("failedtodeletetoolproxy","mod_lti").done((function(s){var feedback={message:s,error:!0};$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,feedback)})).fail(notification.exception)})),promise},renderExternalRegistrationWindow=function(registrationRequest){var promise=templates.render("mod_lti/tool_proxy_registration_form",registrationRequest);return promise.done((function(html,js){var container=getExternalRegistrationTemplateContainer();container.append(html),templates.runTemplateJS(js),container.find("form").submit(),getExternalRegistrationContainer().removeClass("hidden")})).fail(notification.exception),promise},promptForToolTypeCapabilitiesAgreement=function(typeData){var promise=$.Deferred();return templates.render("mod_lti/tool_type_capabilities_agree",typeData).done((function(html,js){var container=$(SELECTORS_TOOL_TYPE_CAPABILITIES_TEMPLATE_CONTAINER);hideExternalRegistrationContent(),getToolTypeCapabilitiesContainer().removeClass("hidden"),templates.replaceNodeContents(container,html,js);var choiceContainer=container.find(SELECTORS_CAPABILITIES_AGREE_CONTAINER);choiceContainer.on(ltiEvents.CAPABILITIES_AGREE,(function(){getToolTypeCapabilitiesContainer().addClass("loading"),function(typeData){return toolType.update({id:typeData.id,state:toolType.constants.state.configured})}(typeData).always((function(){getToolTypeCapabilitiesContainer().removeClass("loading"),container.empty(),promise.resolve()}))})),choiceContainer.on(ltiEvents.CAPABILITIES_DECLINE,(function(){container.empty(),promise.resolve()}))})).fail(promise.reject),promise.done((function(){getToolTypeCapabilitiesContainer().addClass("hidden")})).fail(notification.exception),promise},createAndRegisterToolProxy=function(url){var promise=$.Deferred();return url&&""!==url?toolProxy.create({regurl:url}).done((function(result){getExternalRegistrationCancelButton().attr("data-tool-proxy-new","new"),promise=registerProxy(result.id)})).fail((function(exception){cancelRegistration();var feedback={message:exception.message,error:!0};$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,feedback),promise.reject(exception)})):promise.resolve(),promise},registerProxy=function(id){var promise=$.Deferred();return function(id){getExternalRegistrationCancelButton().attr("data-tool-proxy-id",id)}(id),function(id){var request={methodname:"mod_lti_get_tool_proxy_registration_request",args:{id:id}};return ajax.call([request])[0]}(id).done((function(registrationRequest){renderExternalRegistrationWindow(registrationRequest).done((function(){promise.resolve()})).fail(promise.fail)})).fail(promise.fail),promise},finishExternalRegistration=function(){hasToolProxyId()&&getExternalRegistrationCancelButton().removeAttr("data-tool-proxy-id"),getExternalRegistrationCancelButton().removeAttr("data-tool-proxy-new"),hideExternalRegistrationContent(),getExternalRegistrationTemplateContainer().empty(),$(document).trigger(ltiEvents.STOP_EXTERNAL_REGISTRATION)};return{init:function(){!function(){$(document).on(ltiEvents.START_EXTERNAL_REGISTRATION,(function(event,data){data&&(data.url&&createAndRegisterToolProxy(data.url),data.proxyid&&registerProxy(data.proxyid))}));var cancelExternalRegistrationButton=getExternalRegistrationCancelButton();cancelExternalRegistrationButton.click((function(e){e.preventDefault(),cancelRegistration()})),cancelExternalRegistrationButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),cancelRegistration())})),window.triggerExternalRegistrationComplete=function(data){var promise=$.Deferred(),feedback={message:"",error:!1};if("success"==data.status){if(str.get_string("successfullycreatedtooltype","mod_lti").done((function(s){feedback.message=s})).fail(notification.exception),promise.done((function(){finishExternalRegistration(),$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,feedback),$(document).trigger(ltiEvents.NEW_TOOL_TYPE)})).fail(notification.exception),hasCreatedToolProxy()){var proxyId=getToolProxyId();toolType.getFromToolProxyId(proxyId).done((function(types){if(types&&types.length){var typeData=types[0];typeData.hascapabilitygroups?promptForToolTypeCapabilitiesAgreement(typeData).always((function(){promise.resolve()})):promise.resolve()}else promise.resolve()})).fail((function(){promise.resolve()}))}}else feedback.message=data.error,feedback.error=!0,promise.done((function(){cancelRegistration().always((function(){$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,feedback)}))})).fail(notification.exception),promise.resolve();return promise}}()}}}));
/**
 * Encapsules the behavior for creating a tool type from a cartridge URL
 * in Moodle. Manages the UI while operations are occuring.
 *
 * See template: mod_lti/cartridge_registration_form
 *
 * @module     mod_lti/cartridge_registration_form
 * @class      cartridge_registration_form
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/cartridge_registration_form",["jquery","core/ajax","core/notification","mod_lti/tool_type","mod_lti/events","mod_lti/keys","core/str"],(function($,ajax,notification,toolType,ltiEvents,KEYS,str){var SELECTORS_CONSUMER_KEY="#registration-key",SELECTORS_SHARED_SECRET="#registration-secret",SELECTORS_REGISTRATION_FORM="#cartridge-registration-form",SELECTORS_REGISTRATION_SUBMIT_BUTTON="#cartridge-registration-submit",SELECTORS_REGISTRATION_CANCEL_BUTTON="#cartridge-registration-cancel",getSubmitButton=function(){return $(SELECTORS_REGISTRATION_SUBMIT_BUTTON)},submitCartridgeURL=function(){if(getSubmitButton().hasClass("loading"))return!1;var url=$(SELECTORS_REGISTRATION_FORM).attr("data-cartridge-url");if(""===url)return!1;getSubmitButton().addClass("loading");var consumerKey=$(SELECTORS_CONSUMER_KEY).val(),sharedSecret=$(SELECTORS_SHARED_SECRET).val(),promise=toolType.create({cartridgeurl:url,key:consumerKey,secret:sharedSecret});return promise.done((function(){str.get_string("successfullycreatedtooltype","mod_lti").done((function(s){$(document).trigger(ltiEvents.NEW_TOOL_TYPE),$(document).trigger(ltiEvents.STOP_CARTRIDGE_REGISTRATION),$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,{message:s})})).fail(notification.exception)})).fail((function(){str.get_string("failedtocreatetooltype","mod_lti").done((function(s){$(document).trigger(ltiEvents.NEW_TOOL_TYPE),$(document).trigger(ltiEvents.STOP_CARTRIDGE_REGISTRATION),$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,{message:s,error:!0})})).fail(notification.exception)})).always((function(){getSubmitButton().removeClass("loading")})),promise},registerEventListeners=function(){$(SELECTORS_REGISTRATION_FORM).submit((function(e){e.preventDefault(),submitCartridgeURL()}));var cancelButton=$(SELECTORS_REGISTRATION_CANCEL_BUTTON);cancelButton.click((function(e){e.preventDefault(),$(document).trigger(ltiEvents.STOP_CARTRIDGE_REGISTRATION)})),cancelButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),cancelButton.click())}))};return{init:function(){registerEventListeners()}}}));
/**
 * Provides a list of events that can be triggered in the LTI management
 * page.
 *
 * @module     mod_lti/events
 * @class      events
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/events",[],(function(){return{NEW_TOOL_TYPE:"lti.tool.type.new",START_EXTERNAL_REGISTRATION:"lti.registration.external.start",STOP_EXTERNAL_REGISTRATION:"lti.registration.external.stop",START_CARTRIDGE_REGISTRATION:"lti.registration.cartridge.start",STOP_CARTRIDGE_REGISTRATION:"lti.registration.cartridge.stop",REGISTRATION_FEEDBACK:"lti.registration.feedback",CAPABILITIES_AGREE:"lti.tool.type.capabilities.agree",CAPABILITIES_DECLINE:"lti.tool.type.capabilities.decline"}}));
/**
 * A module that enables the setting of form field values on the client side.
 *
 * @module     mod_lti/form-field
 * @class      form-field
 * @package    mod_lti
 * @copyright  2016 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("mod_lti/form-field",["jquery"],(function($){var FormField=function(name,type,resetIfUndefined,defaultValue){this.name=name,this.id="id_"+this.name,this.selector="#"+this.id,this.type=type,this.resetIfUndefined=resetIfUndefined,this.defaultValue=defaultValue};return FormField.TYPES={TEXT:1,SELECT:2,CHECKBOX:3,EDITOR:4},FormField.prototype.setFieldValue=function(value){if(null===value){if(!this.resetIfUndefined)return;value=this.defaultValue}switch(this.type){case FormField.TYPES.CHECKBOX:value?$(this.selector).prop("checked",!0):$(this.selector).prop("checked",!1);break;case FormField.TYPES.EDITOR:if(void 0!==value.text){var attoEditor=$(this.selector+"editable");attoEditor.length?attoEditor.html(value.text):"undefined"!=typeof tinyMCE&&tinyMCE.execInstanceCommand(this.id,"mceInsertContent",!1,value.text),$(this.selector).val(value.text)}break;default:$(this.selector).val(value)}},FormField}));
/**
 * Controls all of the behaviour and interaction with a tool type card. These are
 * listed on the LTI tool type management page.
 *
 * See template: mod_lti/tool_card
 *
 * @module     mod_lti/tool_card_controller
 * @class      tool_card_controller
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/tool_card_controller",["jquery","core/ajax","core/notification","core/templates","core/modal_factory","mod_lti/tool_type","mod_lti/events","mod_lti/keys","core/str"],(function($,ajax,notification,templates,modalFactory,toolType,ltiEvents,KEYS,str){var SELECTORS_DELETE_BUTTON=".delete",SELECTORS_NAME_ELEMENT=".name",SELECTORS_DESCRIPTION_ELEMENT=".description",SELECTORS_CAPABILITIES_CONTAINER=".capabilities-container",SELECTORS_ACTIVATE_BUTTON=".tool-card-footer a.activate",getNameElement=function(element){return element.find(SELECTORS_NAME_ELEMENT)},getDescriptionElement=function(element){return element.find(SELECTORS_DESCRIPTION_ELEMENT)},getActivateButton=function(element){return element.find(SELECTORS_ACTIVATE_BUTTON)},getCapabilitiesContainer=function(element){return element.find(SELECTORS_CAPABILITIES_CONTAINER)},hasCapabilitiesContainer=function(element){return!!getCapabilitiesContainer(element).length},getTypeId=function(element){return element.attr("data-type-id")},clearAllAnnouncements=function(element){element.removeClass("announcement loading success fail capabilities")},startLoading=function(element){clearAllAnnouncements(element),element.addClass("announcement loading")},stopLoading=function(element){element.removeClass("announcement loading")},announceSuccess=function(element){var promise=$.Deferred();return clearAllAnnouncements(element),element.addClass("announcement success"),setTimeout((function(){element.removeClass("announcement success"),promise.resolve()}),2e3),promise},announceFailure=function(element){var promise=$.Deferred();return clearAllAnnouncements(element),element.addClass("announcement fail"),setTimeout((function(){element.removeClass("announcement fail"),promise.resolve()}),2e3),promise},setValueSnapshot=function(element,value){element.attr("data-val-snapshot",value)},getValueSnapshot=function(element){return element.attr("data-val-snapshot")},setStatusActive=function(element){var id=getTypeId(element);if(""===id)return $.Deferred().resolve();startLoading(element);var promise=toolType.update({id:id,state:toolType.constants.state.configured});return promise.then((function(toolTypeData){return stopLoading(element),announceSuccess(element),toolTypeData})).then((function(toolTypeData){return templates.render("mod_lti/tool_card",toolTypeData)})).then((function(renderResult){var html=renderResult[0],js=renderResult[1];templates.replaceNode(element,html,js)})).catch((function(){stopLoading(element),announceFailure(element)})),promise},registerEventListeners=function(element){var deleteButton=function(element){return element.find(SELECTORS_DELETE_BUTTON)}(element);deleteButton.click((function(e){e.preventDefault(),function(element){var promise=$.Deferred(),typeId=getTypeId(element);startLoading(element),""===typeId?$.Deferred().resolve():str.get_strings([{key:"delete",component:"mod_lti"},{key:"delete_confirmation",component:"mod_lti"},{key:"delete",component:"mod_lti"},{key:"cancel",component:"core"}]).done((function(strs){notification.confirm(strs[0],strs[1],strs[2],strs[3],(function(){toolType.delete(typeId).done((function(){stopLoading(element),announceSuccess(element).done((function(){element.remove()})).fail(notification.exception).always((function(){promise.resolve()}))})).fail((function(error){announceFailure(element),promise.reject(error)}))}),(function(){stopLoading(element),promise.resolve()}))})).fail((function(error){stopLoading(element),notification.exception(error),promise.reject(error)}))}(element)})),deleteButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),deleteButton.click())}));var descriptionElement=getDescriptionElement(element);descriptionElement.focus((function(e){e.preventDefault(),function(element){var descriptionElement=getDescriptionElement(element);if(!descriptionElement.hasClass("loading")){var description=descriptionElement.text().trim();setValueSnapshot(descriptionElement,description)}}(element)})),descriptionElement.blur((function(e){e.preventDefault(),function(element){var typeId=getTypeId(element);if(""===typeId)return $.Deferred().resolve();var descriptionElement=getDescriptionElement(element);if(descriptionElement.hasClass("loading"))return $.Deferred().resolve();var description=descriptionElement.text().trim();if(getValueSnapshot(descriptionElement)==description)return $.Deferred().resolve();descriptionElement.addClass("loading");var promise=toolType.update({id:typeId,description:description});promise.done((function(type){descriptionElement.removeClass("loading"),descriptionElement.text(type.description)})).fail(notification.exception),promise.fail((function(){descriptionElement.removeClass("loading")}))}(element)})),descriptionElement.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode==KEYS.ENTER&&(e.preventDefault(),descriptionElement.blur())}));var nameElement=getNameElement(element);if(nameElement.focus((function(e){e.preventDefault(),function(element){var nameElement=getNameElement(element);if(!nameElement.hasClass("loading")){var name=nameElement.text().trim();setValueSnapshot(nameElement,name)}}(element)})),nameElement.blur((function(e){e.preventDefault(),function(element){var typeId=getTypeId(element);if(""===typeId)return $.Deferred().resolve();var nameElement=getNameElement(element);if(nameElement.hasClass("loading"))return $.Deferred().resolve();var name=nameElement.text().trim();if(getValueSnapshot(nameElement)==name)return $.Deferred().resolve();nameElement.addClass("loading");var promise=toolType.update({id:typeId,name:name});promise.done((function(type){nameElement.removeClass("loading"),nameElement.text(type.name)})),promise.fail((function(){nameElement.removeClass("loading")}))}(element)})),nameElement.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode==KEYS.ENTER&&(e.preventDefault(),nameElement.blur())})),function(element){return!!getActivateButton(element).length}(element)){var activateButton=getActivateButton(element);activateButton.click((function(e){e.preventDefault(),function(element){hasCapabilitiesContainer(element)?function(element){element.addClass("announcement capabilities")}(element):setStatusActive(element)}(element)})),activateButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),activateButton.click())}))}if(hasCapabilitiesContainer(element)){var capabilitiesContainer=getCapabilitiesContainer(element);capabilitiesContainer.on(ltiEvents.CAPABILITIES_AGREE,(function(){setStatusActive(element)})),capabilitiesContainer.on(ltiEvents.CAPABILITIES_DECLINE,(function(){!function(element){element.removeClass("announcement capabilities")}(element)}))}};return{init:function(element){registerEventListeners(element),function(element){var trigger=$("#"+element.data("uniqid")+"-"+element.data("deploymentid")),context={uniqid:element.data("uniqid"),platformid:element.data("platformid"),clientid:element.data("clientid"),deploymentid:element.data("deploymentid"),urls:{publickeyset:element.data("publickeyseturl"),accesstoken:element.data("accesstokenurl"),authrequest:element.data("authrequesturl")}},bodyPromise=templates.render("mod_lti/tool_config_modal_body",context);context={mailto:"mailto:?subject="+encodeURIComponent(element.data("mailtosubject"))+"&body="+encodeURIComponent(element.data("platformidstr"))+":%20"+encodeURIComponent(element.data("platformid"))+"%0D%0A"+encodeURIComponent(element.data("clientidstr"))+":%20"+encodeURIComponent(element.data("clientid"))+"%0D%0A"+encodeURIComponent(element.data("deploymentidstr"))+":%20"+encodeURIComponent(element.data("deploymentid"))+"%0D%0A"+encodeURIComponent(element.data("publickeyseturlstr"))+":%20"+encodeURIComponent(element.data("publickeyseturl"))+"%0D%0A"+encodeURIComponent(element.data("accesstokenurlstr"))+":%20"+encodeURIComponent(element.data("accesstokenurl"))+"%0D%0A"+encodeURIComponent(element.data("authrequesturlstr"))+":%20"+encodeURIComponent(element.data("authrequesturl"))+"%0D%0A"};var footerPromise=templates.render("mod_lti/tool_config_modal_footer",context);modalFactory.create({large:!0,title:element.data("modaltitle"),body:bodyPromise,footer:footerPromise},trigger)}(element)}}}));
/**
 * Controls all of the behaviour and interaction with a tool type card. These are
 * listed on the LTI tool type management page.
 *
 * See template: mod_lti/tool_proxy_card
 *
 * @module     mod_lti/tool_proxy_card_controller
 * @class      tool_card_controller
 * @package    mod_lti
 * @copyright  2016 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/tool_proxy_card_controller",["jquery","core/ajax","core/notification","core/templates","mod_lti/tool_proxy","mod_lti/events","mod_lti/keys","core/str"],(function($,ajax,notification,templates,toolProxy,ltiEvents,KEYS,str){var SELECTORS_DELETE_BUTTON=".delete",SELECTORS_ACTIVATE_BUTTON=".tool-card-footer a.activate",getTypeId=function(element){return element.attr("data-proxy-id")},clearAllAnnouncements=function(element){element.removeClass("announcement loading success fail capabilities")},stopLoading=function(element){element.removeClass("announcement loading")},deleteType=function(element){var promise=$.Deferred(),typeId=getTypeId(element);return function(element){clearAllAnnouncements(element),element.addClass("announcement loading")}(element),""===typeId?$.Deferred().resolve():(str.get_strings([{key:"delete",component:"mod_lti"},{key:"delete_confirmation",component:"mod_lti"},{key:"delete",component:"mod_lti"},{key:"cancel",component:"core"}]).done((function(strs){notification.confirm(strs[0],strs[1],strs[2],strs[3],(function(){toolProxy.delete(typeId).done((function(){stopLoading(element),function(element){var promise=$.Deferred();return clearAllAnnouncements(element),element.addClass("announcement success"),setTimeout((function(){element.removeClass("announcement success"),promise.resolve()}),2e3),promise}(element).done((function(){element.remove(),promise.resolve()})).fail(notification.exception)})).fail((function(error){!function(element){var promise=$.Deferred();clearAllAnnouncements(element),element.addClass("announcement fail"),setTimeout((function(){element.removeClass("announcement fail"),promise.resolve()}),2e3)}(element),promise.reject(error)}))}),(function(){stopLoading(element),promise.resolve()}))})).fail((function(error){stopLoading(element),notification.exception(error),promise.reject(error)})),promise)},registerEventListeners=function(element){var deleteButton=function(element){return element.find(SELECTORS_DELETE_BUTTON)}(element);deleteButton.click((function(e){e.preventDefault(),deleteType(element)})),deleteButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),deleteButton.click())}));var activateButton=function(element){return element.find(SELECTORS_ACTIVATE_BUTTON)}(element);activateButton.click((function(e){e.preventDefault(),function(element){var data={proxyid:getTypeId(element)};$(document).trigger(ltiEvents.START_EXTERNAL_REGISTRATION,data)}(element)})),activateButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),activateButton.click())}))};return{init:function(element){registerEventListeners(element)}}}));
define ("mod_opencast/form_dependent_select",["exports"],function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;function b(a,b){return g(a)||f(a,b)||d(a,b)||c()}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(a,b){if(!a)return;if("string"==typeof a)return e(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return e(a,b)}function e(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function f(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function g(a){if(Array.isArray(a))return a}var h=function(a){var c=document.getElementById("id_series"),d=document.getElementById("id_episode");c.addEventListener("change",function(){var b=this.value;document.getElementById("id_ocinstanceid").value=this.value.substring(this.value.lastIndexOf("_")+1,this.value.length);document.getElementById("id_opencastid").value=this.value.substring(0,this.value.lastIndexOf("_"));document.getElementById("id_opencastid").dispatchEvent(new Event("change"));Array.from(d.options).forEach(function(c){if(c.value in a[b]){c.hidden=!1;c.hidden=!1}else{c.hidden=!0;c.hidden=!0}});d.value="allvideos"});d.addEventListener("change",function(){document.getElementById("id_opencastid").value=this.value;document.getElementById("id_opencastid").dispatchEvent(new Event("change"))});var e=document.getElementById("id_opencastid").value;if(e){d.value=e;for(var f=!1,g=0,h=Object.entries(a);g<h.length;g++){var i=b(h[g],2),j=i[0],k=i[1];if(j.substring(j.lastIndexOf("_")+1,j.length)!==document.getElementById("id_ocinstanceid").value){continue}if(e===j.substring(0,j.lastIndexOf("_"))){c.value=j;d.value="allvideos";f=!0;break}if(e in k){c.value=j;f=!0;break}}if(!f){c.value="invalid"}}else{if(0<c.options.length){c.dispatchEvent(new Event("change"))}}c.form.addEventListener("submit",function(){document.getElementById("id_opencastid").disabled=!1;document.getElementById("id_ocinstanceid").disabled=!1})};a.init=h});
define ("mod_opencast/opencast_player",["jquery"],function(a){function b(c){a().ready(function(){var a=document.getElementById("player-iframe").contentWindow;if(!a.paella||!a.paella.lazyLoad||!window.episode){setTimeout(b,20,c);return}a.paella.lazyLoad("playerContainer",{configUrl:c,data:window.episode})})}return{init:b}});
/**
 * Initialise the an add question modal on the quiz page.
 *
 * @module    mod_quiz/add_question_modal_launcher
 * @package   mod_quiz
 * @copyright 2018 Ryan Wyllie <ryan@moodle.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/add_question_modal_launcher",["jquery","core/notification","core/modal_factory"],(function($,Notification,ModalFactory){return{init:function(modalType,selector,contextId,_preShowCallback){var body=$("body");return ModalFactory.create({type:modalType,large:!0,preShowCallback:function(triggerElement,modal){triggerElement=$(triggerElement),modal.setContextId(contextId),modal.setAddOnPageId(triggerElement.attr("data-addonpage")),modal.setTitle(triggerElement.attr("data-header")),_preShowCallback&&_preShowCallback(triggerElement,modal)}},[body,selector]).fail(Notification.exception)}}}));
/**
 * JavaScript for the add_random_form class.
 *
 * @module    mod_quiz/add_random_form
 * @package   mod_quiz
 * @copyright 2018 Ryan Wyllie <ryan@moodle.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/add_random_form",["jquery","mod_quiz/random_question_form_preview"],(function($,RandomQuestionFormPreview){var SELECTORS_PREVIEW_CONTAINER='[data-region="random-question-preview-container"]',SELECTORS_CATEGORY_FORM_ELEMENT='[name="category"]',SELECTORS_SUBCATEGORY_FORM_ELEMENT='[name="includesubcategories"]',SELECTORS_TAG_IDS_FORM_ELEMENT='[name="fromtags[]"]',getCategorySelectValue=function(form){return form.find(SELECTORS_CATEGORY_FORM_ELEMENT).val()},shouldIncludeSubcategories=function(form,topCategories){return!!function(form,topCategories){var selectedValue=getCategorySelectValue(form);return topCategories.indexOf(selectedValue)>-1}(form,topCategories)||form.find(SELECTORS_SUBCATEGORY_FORM_ELEMENT).is(":checked")},reloadQuestionPreview=function(form,contextId,topCategories){var previewContainer=form.find(SELECTORS_PREVIEW_CONTAINER);RandomQuestionFormPreview.reload(previewContainer,function(form){return getCategorySelectValue(form).split(",")[0]}(form),shouldIncludeSubcategories(form,topCategories),function(form){return form.find(SELECTORS_TAG_IDS_FORM_ELEMENT).val().map((function(value){return value.split(",")[0]}))}(form),contextId)},addEventListeners=function(form,contextId,topCategories){var reloadTimerId=null;form.on("change",(function(e){var element;((element=$(e.target)).closest(SELECTORS_CATEGORY_FORM_ELEMENT).length>0||element.closest(SELECTORS_SUBCATEGORY_FORM_ELEMENT).length>0||element.closest(SELECTORS_TAG_IDS_FORM_ELEMENT).length>0)&&(RandomQuestionFormPreview.showLoadingIcon(form),reloadTimerId&&clearTimeout(reloadTimerId),reloadTimerId=setTimeout((function(){reloadQuestionPreview(form,contextId,topCategories)}),2e3))}))};return{init:function(formId,contextId,topCategories,isTagsEnabled){if(1==isTagsEnabled){var form=$("#"+formId);reloadQuestionPreview(form,contextId,topCategories),addEventListeners(form,contextId,topCategories)}}}}));
/**
 * Contain the logic for the question bank modal.
 *
 * @module     mod_quiz/modal_quiz_question_bank
 * @package    mod_quiz
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/modal_quiz_question_bank",["jquery","core/yui","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment"],(function($,Y,Notification,Modal,ModalEvents,ModalRegistry,Fragment){var registered=!1,SELECTORS_ADD_TO_QUIZ_CONTAINER="td.addtoquizaction",SELECTORS_ANCHOR="a[href]",SELECTORS_PREVIEW_CONTAINER="td.previewaction",SELECTORS_SEARCH_OPTIONS="#advancedsearch",SELECTORS_DISPLAY_OPTIONS="#displayoptions",SELECTORS_ADD_QUESTIONS_FORM='form[action="edit.php"]',ModalQuizQuestionBank=function(root){Modal.call(this,root),this.contextId=null,this.addOnPageId=null};return ModalQuizQuestionBank.TYPE="mod_quiz-quiz-question-bank",(ModalQuizQuestionBank.prototype=Object.create(Modal.prototype)).constructor=ModalQuizQuestionBank,ModalQuizQuestionBank.prototype.setContextId=function(id){this.contextId=id},ModalQuizQuestionBank.prototype.getContextId=function(){return this.contextId},ModalQuizQuestionBank.prototype.setAddOnPageId=function(id){this.addOnPageId=id},ModalQuizQuestionBank.prototype.getAddOnPageId=function(){return this.addOnPageId},ModalQuizQuestionBank.prototype.show=function(){return this.reloadBodyContent(window.location.search),Modal.prototype.show.call(this)},ModalQuizQuestionBank.prototype.reloadBodyContent=function(queryString){var promise=Fragment.loadFragment("mod_quiz","quiz_question_bank",this.getContextId(),{querystring:queryString}).fail(Notification.exception);this.setBody(promise)},ModalQuizQuestionBank.prototype.handleAddToQuizEvent=function(e,anchorElement){var href=anchorElement.attr("href")+"&addonpage="+this.getAddOnPageId();anchorElement.attr("href",href)},ModalQuizQuestionBank.prototype.handlePreviewContainerEvent=function(e,anchorElement){window.openpopup(e,{url:anchorElement.attr("href"),name:"questionpreview",options:["height=600","width=800","top=0","left=0","menubar=0","location=0","scrollbars","resizable","toolbar","status","directories=0","fullscreen=0","dependent"].join(",")})},ModalQuizQuestionBank.prototype.handleDisplayOptionFormEvent=function(e){e.stopPropagation(),e.preventDefault();var queryString="?"+$(e.target).closest(SELECTORS_DISPLAY_OPTIONS).serialize();this.reloadBodyContent(queryString)},ModalQuizQuestionBank.prototype.registerDisplayOptionListeners=function(){this.getModal().on("change",SELECTORS_DISPLAY_OPTIONS,function(e){$(e.target).attr("aria-autocomplete")||this.handleDisplayOptionFormEvent(e)}.bind(this)),this.getModal().on("submit",SELECTORS_DISPLAY_OPTIONS,function(e){this.handleDisplayOptionFormEvent(e)}.bind(this))},ModalQuizQuestionBank.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.registerDisplayOptionListeners(),this.getModal().on("submit",SELECTORS_ADD_QUESTIONS_FORM,function(e){var formElement=$(e.currentTarget);$("<input />").attr("type","hidden").attr("name","addonpage").attr("value",this.getAddOnPageId()).appendTo(formElement)}.bind(this)),this.getModal().on("click",SELECTORS_ANCHOR,function(e){var anchorElement=$(e.currentTarget);anchorElement.closest(SELECTORS_ADD_TO_QUIZ_CONTAINER).length?this.handleAddToQuizEvent(e,anchorElement):anchorElement.closest(SELECTORS_PREVIEW_CONTAINER).length?this.handlePreviewContainerEvent(e,anchorElement):anchorElement.closest(SELECTORS_SEARCH_OPTIONS).length||(e.preventDefault(),this.reloadBodyContent(anchorElement.prop("search")))}.bind(this)),this.getRoot().on(ModalEvents.bodyRendered,(function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()}))}))},registered||(ModalRegistry.register(ModalQuizQuestionBank.TYPE,ModalQuizQuestionBank,"core/modal"),registered=!0),ModalQuizQuestionBank}));
/**
 * Initialise the question bank modal on the quiz page.
 *
 * @module    mod_quiz/quizquestionbank
 * @package   mod_quiz
 * @copyright 2018 Ryan Wyllie <ryan@moodle.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/quizquestionbank",["mod_quiz/add_question_modal_launcher","mod_quiz/modal_quiz_question_bank"],(function(AddQuestionModalLauncher,ModalQuizQuestionBank){return{init:function(contextId){AddQuestionModalLauncher.init(ModalQuizQuestionBank.TYPE,'.menu [data-action="questionbank"]',contextId)}}}));
/**
 * Contain the logic for the add random question modal.
 *
 * @module     mod_quiz/modal_add_random_question
 * @package    mod_quiz
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/modal_add_random_question",["jquery","core/yui","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment","core/templates"],(function($,Y,Notification,Modal,ModalEvents,ModalRegistry,Fragment,Templates){var registered=!1,SELECTORS_EXISTING_CATEGORY_CONTAINER='[data-region="existing-category-container"]',SELECTORS_EXISTING_CATEGORY_FORM_ELEMENT="#id_existingcategoryheader",SELECTORS_NEW_CATEGORY_CONTAINER='[data-region="new-category-container"]',SELECTORS_NEW_CATEGORY_FORM_ELEMENT="#id_newcategoryheader",SELECTORS_TAB_CONTENT='[data-region="tab-content"]',SELECTORS_ADD_ON_PAGE_FORM_ELEMENT='[name="addonpage"]',SELECTORS_SUBMIT_BUTTON_ELEMENT='input[type="submit"]',SELECTORS_CANCEL_BUTTON_ELEMENT='input[type="submit"][name="cancel"]',SELECTORS_FORM_HEADER="legend",SELECTORS_BUTTON_CONTAINER=".fitem",ModalAddRandomQuestion=function(root){Modal.call(this,root),this.contextId=null,this.addOnPageId=null,this.category=null,this.returnUrl=null,this.cmid=null,this.loadedForm=!1};return ModalAddRandomQuestion.TYPE="mod_quiz-quiz-add-random-question",(ModalAddRandomQuestion.prototype=Object.create(Modal.prototype)).constructor=ModalAddRandomQuestion,ModalAddRandomQuestion.prototype.setContextId=function(id){this.contextId=id},ModalAddRandomQuestion.prototype.getContextId=function(){return this.contextId},ModalAddRandomQuestion.prototype.setAddOnPageId=function(id){this.addOnPageId=id,this.getBody().find(SELECTORS_ADD_ON_PAGE_FORM_ELEMENT).val(id)},ModalAddRandomQuestion.prototype.getAddOnPageId=function(){return this.addOnPageId},ModalAddRandomQuestion.prototype.setCategory=function(category){this.category=category},ModalAddRandomQuestion.prototype.getCategory=function(){return this.category},ModalAddRandomQuestion.prototype.setReturnUrl=function(url){this.returnUrl=url},ModalAddRandomQuestion.prototype.getReturnUrl=function(){return this.returnUrl},ModalAddRandomQuestion.prototype.setCMID=function(id){this.cmid=id},ModalAddRandomQuestion.prototype.getCMID=function(){return this.cmid},ModalAddRandomQuestion.prototype.moveFormElementIntoTab=function(formElement,tabElement){var submitButtons=formElement.find(SELECTORS_SUBMIT_BUTTON_ELEMENT),footer=$('<div class="modal-footer mt-1" data-region="footer"></div>');formElement.find(SELECTORS_FORM_HEADER).addClass("hidden"),formElement.wrap(tabElement),submitButtons.closest(SELECTORS_BUTTON_CONTAINER).remove(),submitButtons.appendTo(footer),footer.appendTo(formElement)},ModalAddRandomQuestion.prototype.moveTabsIntoTabContent=function(form){var tabContent=this.getBody().find(SELECTORS_TAB_CONTENT).empty();form.find('[role="tabpanel"]').wrapAll(tabContent)},ModalAddRandomQuestion.prototype.moveCancelButtonToTabs=function(form){var cancelButton=form.find(SELECTORS_CANCEL_BUTTON_ELEMENT).addClass("ml-1"),tabFooters=form.find('[data-region="footer"]');cancelButton.closest(SELECTORS_BUTTON_CONTAINER).remove(),cancelButton.clone().appendTo(tabFooters)},ModalAddRandomQuestion.prototype.loadForm=function(){return Fragment.loadFragment("mod_quiz","add_random_question_form",this.getContextId(),{addonpage:this.getAddOnPageId(),cat:this.getCategory(),returnurl:this.getReturnUrl(),cmid:this.getCMID()}).then(function(html,js){var form=$(html),existingCategoryFormElement=form.find(SELECTORS_EXISTING_CATEGORY_FORM_ELEMENT),existingCategoryTab=this.getBody().find(SELECTORS_EXISTING_CATEGORY_CONTAINER),newCategoryFormElement=form.find(SELECTORS_NEW_CATEGORY_FORM_ELEMENT),newCategoryTab=this.getBody().find(SELECTORS_NEW_CATEGORY_CONTAINER);this.moveFormElementIntoTab(existingCategoryFormElement,existingCategoryTab),this.moveFormElementIntoTab(newCategoryFormElement,newCategoryTab),this.moveTabsIntoTabContent(form),this.moveCancelButtonToTabs(form),Templates.replaceNode(this.getBody().find(SELECTORS_TAB_CONTENT),form,js)}.bind(this)).then((function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()}))})).fail(Notification.exception)},ModalAddRandomQuestion.prototype.show=function(){Modal.prototype.show.call(this),this.loadedForm||(this.loadForm(),this.loadedForm=!0)},registered||(ModalRegistry.register(ModalAddRandomQuestion.TYPE,ModalAddRandomQuestion,"mod_quiz/modal_add_random_question"),registered=!0),ModalAddRandomQuestion}));
/**
 * Initialise the repaginate dialogue on quiz editing page.
 *
 * @module    mod_quiz/repaginate
 * @package   mod_quiz
 * @copyright 2019 The Open University
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/repaginate",["jquery","core/modal_factory"],(function($,ModalFactory){var SELECTORS_REPAGINATECOMMAND="#repaginatecommand",SELECTORS_HEADER="header",SELECTORS_BODY="form";return{init:function(){ModalFactory.create({title:$(SELECTORS_REPAGINATECOMMAND).data(SELECTORS_HEADER),body:$(SELECTORS_REPAGINATECOMMAND).data(SELECTORS_BODY),large:!1},$(SELECTORS_REPAGINATECOMMAND))}}}));
/**
 * JavaScript for the random_question_form_preview of the
 * add_random_form class.
 *
 * @module    mod_quiz/random_question_form_preview
 * @package   mod_quiz
 * @copyright 2018 Ryan Wyllie <ryan@moodle.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/random_question_form_preview",["jquery","core/ajax","core/str","core/notification","core/templates","core/paged_content_factory"],(function($,Ajax,Str,Notification,Templates,PagedContentFactory){var TEMPLATE_NAME="mod_quiz/random_question_form_preview_question_list",SELECTORS_LOADING_ICON_CONTAINER='[data-region="overlay-icon-container"]',SELECTORS_QUESTION_COUNT_CONTAINER='[data-region="question-count-container"]',SELECTORS_QUESTION_LIST_CONTAINER='[data-region="question-list-container"]',showLoadingIcon=function(root){root.find(SELECTORS_LOADING_ICON_CONTAINER).removeClass("hidden")},hideLoadingIcon=function(root){root.find(SELECTORS_LOADING_ICON_CONTAINER).addClass("hidden")},requestQuestions=function(categoryId,includeSubcategories,tagIds,contextId,limit,offset){var request={methodname:"core_question_get_random_question_summaries",args:{categoryid:categoryId,includesubcategories:includeSubcategories,tagids:tagIds,contextid:contextId,limit:limit,offset:offset}};return Ajax.call([request])[0]};return{reload:function(root,categoryId,includeSubcategories,tagIds,contextId){return showLoadingIcon(root),requestQuestions(categoryId,includeSubcategories,tagIds,contextId,5,0).then((function(response){var totalCount=response.totalcount;return function(root,questionCount){Str.get_string("questionsmatchingfilter","mod_quiz",questionCount).then((function(string){root.find(SELECTORS_QUESTION_COUNT_CONTAINER).html(string)})).fail(Notification.exception)}(root,totalCount),response})).then((function(response){var totalQuestionCount=response.totalcount,questions=response.questions;return questions.length?function(categoryId,includeSubcategories,tagIds,contextId,totalQuestionCount,firstPageQuestions){return PagedContentFactory.createFromAjax(totalQuestionCount,5,(function(pagesData){return pagesData.map((function(pageData){var limit=pageData.limit,offset=pageData.offset;return 0==offset?Templates.render(TEMPLATE_NAME,{questions:firstPageQuestions}):requestQuestions(categoryId,includeSubcategories,tagIds,contextId,limit,offset).then((function(response){var questions=response.questions;return Templates.render(TEMPLATE_NAME,{questions:questions})})).fail(Notification.exception)}))}))}(categoryId,includeSubcategories,tagIds,contextId,totalQuestionCount,questions):$.Deferred().resolve("","")})).then((function(html,js){var container=root.find(SELECTORS_QUESTION_LIST_CONTAINER);Templates.replaceNodeContents(container,html,js)})).always((function(){hideLoadingIcon(root)})).fail(Notification.exception)},showLoadingIcon:showLoadingIcon,hideLoadingIcon:hideLoadingIcon}}));
/**
 * This class manages the confirmation pop-up (also called the pre-flight check)
 * that is sometimes shown when a use clicks the start attempt button.
 *
 * This is also responsible for opening the pop-up window, if the quiz requires to be in one.
 *
 * @module    mod_quiz/preflightcheck
 * @class     preflightcheck
 * @package   mod_quiz
 * @copyright 2016 The Open University
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since     3.1
 */
define("mod_quiz/preflightcheck",["jquery","core/yui"],(function($,Y){var t={confirmDialogue:null,init:function(startButton,confirmationTitle,confirmationForm,popupoptions){var finalStartButton=startButton;Y.use("moodle-core-notification",(function(){Y.one(confirmationForm)&&(t.confirmDialogue=new M.core.dialogue({headerContent:confirmationTitle,bodyContent:Y.one(confirmationForm),draggable:!0,visible:!1,center:!0,modal:!0,width:null,extraClasses:["mod_quiz_preflight_popup"]}),Y.one(startButton).on("click",t.displayDialogue),Y.one("#id_cancel").on("click",t.hideDialogue),finalStartButton=t.confirmDialogue.get("boundingBox").one('[name="submitbutton"]')),popupoptions&&Y.one(finalStartButton).on("click",t.launchQuizPopup,t,popupoptions)}))},displayDialogue:function(e){e&&e.halt(),t.confirmDialogue.show()},hideDialogue:function(e){e&&e.halt(),t.confirmDialogue.hide(e)},launchQuizPopup:function(e,popupoptions){e.halt(),Y.use("moodle-core-formchangechecker","io-form",(function(){M.core_formchangechecker.reset_form_dirty_state();var form=e.target.ancestor("form");window.openpopup(e,{url:form.get("action")+"?"+Y.IO.stringify(form).replace(/\bcancel=/,"x="),windowname:"quizpopup",options:popupoptions,fullscreen:!0})}))}};return t}));
/**
 * Initialise the add random question modal on the quiz page.
 *
 * @module    mod_quiz/add_random_question
 * @package   mod_quiz
 * @copyright 2018 Ryan Wyllie <ryan@moodle.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/add_random_question",["mod_quiz/add_question_modal_launcher","mod_quiz/modal_add_random_question"],(function(AddQuestionModalLauncher,ModalAddRandomQuestion){return{init:function(contextId,category,returnUrl,cmid){AddQuestionModalLauncher.init(ModalAddRandomQuestion.TYPE,'.menu [data-action="addarandomquestion"]',contextId,(function(triggerElement,modal){modal.setCategory(category),modal.setReturnUrl(returnUrl),modal.setCMID(cmid)}))}}}));
/**
 * Javascript to handle survey validation.
 *
 * @module     mod_survey/validation
 * @package    mod_survey
 * @copyright  2017 Dan Poltawski <dan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.3
 */
define("mod_survey/validation",["jquery","core/str","core/modal_factory","core/notification"],(function($,Str,ModalFactory,Notification){return{ensureRadiosChosen:function(formid){var modalPromise=Str.get_strings([{key:"error",component:"moodle"},{key:"questionsnotanswered",component:"survey"}]).then((function(strings){return ModalFactory.create({type:ModalFactory.types.CANCEL,title:strings[0],body:strings[1]})})).catch(Notification.exception),form=$("#"+formid);form.submit((function(e){return 0===form.find('input:radio[data-survey-default="true"]:checked').length||(e.preventDefault(),modalPromise.then((function(modal){return modal.show(),!1})))}))}}}));
define ("mod_vpl/evaluationmonitor",["mod_vpl/vplutil"],function(a){return{init:function init(b){b.next=function(){window.location=b.nexturl};function c(c){a.showErrorMessage(c,{next:b.next})}var d,e={ajaxurl:b.ajaxurl,run:c,getLastAction:function getLastAction(){d()}};d=function(){a.requestAction("evaluate","evaluating",{},b.ajaxurl).done(function(d){a.webSocketMonitor(d,"evaluate","evaluating",e).done(b.next).fail(c)}).fail(c)};d()}}});
define ("mod_vpl/vplvnc",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplclipboard","core/log"],function(a,b,c,d,e){window.INCLUDE_URI="../editor/noVNC/include/";function f(){if("undefined"==typeof Util){c.delay("loadVNCScripts",f)}else{Util.load_scripts(["webutil.js","base64.js","websock.js","des.js","keysymdef.js","keyboard.js","input.js","display.js","jsunzip.js","rfb.js","keysym.js"])}}c.delay("loadVNCScripts",f);return function VPLVNCClient(b,f){var q=this,r,s="",u="",v="",x=a("#"+b),y=a("#"+b+" canvas"),z=c.doNothing,A,B=!0,C,D=window.document.createElement("input");D.style.position="absolute";D.style.left="0px";D.style.top="-10000px";D.style.width="1em";D.style.height="1ex";D.style.opacity="0";D.style.backgroundColor="transparent";D.style.borderStyle="none";D.style.outlineStyle="none";D.autocapitalize="off";D.autocomplete="off";D.autocorrect="off";D.wrap="off";D.spellcheck="false";x.append(D);function g(){if(a(D).is(":focus")){D.blur()}else{D.focus()}}function h(){if(q.isConnected()){r.clipboardPasteFrom(A.getEntry2())}}function i(a,b){A.setEntry1(b)}function j(){A.show()}function k(){if(q.isConnected()){r.get_keyboard().set_focused(!0)}}function l(){if(q.isConnected()){r.get_keyboard().set_focused(!1)}}function m(){A.setEntry1(A.getEntry1());document.execCommand("copy")}var E=c.genIcon("copy","sw")+" "+f("copy"),F=c.genIcon("paste","sw")+" "+f("paste");A=new d("vpl_dialog_vnc_clipboard",E,m,F,h,l);y.on("click",function(a){if(a.target==y[0]){k()}else{l()}});this.displayResize=function(){if(q.isConnected()){var a=x.width(),b=x.height();q.setCanvasSize(a,b);r.get_display().viewportChange(0,0,a,b)}};function n(){var b=a("html").width(),c=a(window).height();if(x.width()>b){B=!0;x.dialog("option","width",b)}if(x.parent().height()>c){B=!0;x.dialog("option","height",c-x.prev().outerHeight())}}x.dialog({closeOnEscape:!1,autoOpen:!1,modal:!0,width:"auto",height:"auto",dialogClass:"vpl_ide vpl_vnc",create:function create(){C=c.setTitleBar(x,"vnc","graphic",["clipboard","keyboard"],[j,g])},dragStop:n,focus:k,open:n,beforeClose:function beforeClose(){if(B){var a=x.width(),b=x.height();B=!1;q.setCanvasSize(a,b)}},close:function close(){q.disconnect()},resizeStop:function resizeStop(){n();B=!0}});x.css("padding","1px");x.parent().css("z-index",2e3);this.updateTitle=function(){var a=s;if(""!==u){a+=" ("+u+")"}C.text(f("console")+": "+a)};this.setTitle=function(a){s=a;this.updateTitle()};this.setMessage=function(a){u=a;this.updateTitle()};function o(a,b,c,d){v=b;switch(b){case"normal":q.setMessage("");q.setTitle(f("connected"));break;case"disconnect":case"disconnected":q.setTitle(f("connection_closed"));break;case"failed":q.setTitle(f("connection_fail"));e.log("VNC client: "+d);break;default:q.setMessage("");q.setTitle(f("connecting"));}}this.connect=function(c,d,e,f,g,h){A.setEntry1("");z=h;q.show();var j=a("#"+b+" canvas")[0];if(!r){r=new RFB({target:j,encrypt:c,repeaterID:"",true_color:!0,local_cursor:!0,shared:!1,view_only:!1,onUpdateState:o,onPasswordRequired:null,onClipboard:i});r.set_local_cursor(r.get_display().get_cursor_uri())}if(!e){e=c?443:80}r.connect(d,e,f,g)};this.isOpen=function(){return x.dialog("isOpen")};this.close=function(){x.dialog("close")};this.isConnected=function(){return r&&"disconnected"!=v};this.disconnect=function(){if(r){r.disconnect()}z();A.hide()};function p(a){if(100>a){a=100}return 2*Math.floor(a/2)}this.getCanvasSize=function(){return y.width()+"x"+y.height()};this.setCanvasSize=function(a,b){y.width(p(a));y.height(p(b))};this.show=function(){x.dialog("open");x.width("auto");x.height("auto")};q.setCanvasSize(a(window).width()-150,a(window).height()-150)}});
define ("mod_vpl/vplclipboard",["jquery","jqueryui","mod_vpl/vplutil"],function(a,b,c){return function VPLClipboard(b,d,e,f,g,h){var i=a("#"+b),j=i.find(".vpl_clipboard_label1"),k=i.find(".vpl_clipboard_label2"),l=i.find(".vpl_clipboard_entry1"),m=i.find(".vpl_clipboard_entry2");j.html(d);k.html(f);if(e){j.button().click(e)}if(g){k.button().click(g)}i.dialog({title:c.str("clipboard"),closeOnEscape:!0,autoOpen:!1,width:"auto",height:"auto",resizable:!0,dialogClass:"vpl_clipboard vpl_ide"});if(h){i.on("click",h)}this.show=function(){i.dialog("open")};this.hide=function(){i.dialog("close")};this.setEntry1=function(a){l.val(a);l.select()};this.getEntry1=function(){return l.val()};this.setEntry2=function(a){m.val(a)};this.getEntry2=function(){return m.val()};var n=i.siblings().find(".ui-dialog-title"),o=c.genIcon("clipboard","sw");o+=" "+c.str("clipboard");n.html(o);i.parent().css("overflow","")}});
define ("mod_vpl/vplidecodefile",["jquery","mod_vpl/vplutil"],function(a,b){return function(){var c=this,d=null,e=null,f=c.getFileManager().readOnly,g=this.getContent;this.getContent=function(){if(!this.isOpen()){return g.call(this)}return d.getValue()};var h=this.setContent;this.setContent=function(a){h.call(this,a);if(this.isOpen()){d.setValue(a)}};var i=this.destroy;this.destroy=function(){if(this.isOpen()){d.destroy()}i.call(this)};this.setFontSize=function(a){if(this.isOpen()){d.setFontSize(a)}};var j=this.adjustSize;this.adjustSize=function(){if(j.call(this)){d.resize(!0);return!0}return!1};this.gotoLine=function(a){if(!this.isOpen()){return}d.gotoLine(a,0);d.scrollToLine(a,!0);d.focus()};this.setReadOnly=function(a){f=a;if(this.isOpen()){d.setReadOnly(a)}};this.focus=function(){if(!this.isOpen()){return}var b=this.getTId();a(b).removeClass("ui-widget-content ui-tabs-panel");d.focus()};this.blur=function(){if(!this.isOpen()){return}d.blur()};this.undo=function(){if(!this.isOpen()){return}d.undo();d.focus()};this.redo=function(){if(!this.isOpen()){return}d.redo();d.focus()};this.selectAll=function(){if(!this.isOpen()){return}d.selectAll();d.focus()};this.hasUndo=function(){if(!this.isOpen()){return!1}return e.getUndoManager().hasUndo()};this.hasRedo=function(){if(!this.isOpen()){return!1}return e.getUndoManager().hasRedo()};this.hasSelectAll=b.returnTrue;this.hasFind=b.returnTrue;this.hasFindReplace=b.returnTrue;this.hasNext=b.returnTrue;this.find=function(){if(!this.isOpen()){return}d.execCommand("find")};this.replace=function(){if(!this.isOpen()){return}d.execCommand("replace")};this.next=function(){if(!this.isOpen()){return}d.execCommand("findnext")};this.getAnnotations=function(){if(!this.isOpen()){return[]}return e.getAnnotations()};this.setAnnotations=function(b){if(!this.isOpen()){return!1}return e.setAnnotations(b)};this.clearAnnotations=function(){if(!this.isOpen()){return!1}return e.clearAnnotations()};this.langSelection=function(){if(!this.isOpen()){return}var a=b.fileExtension(this.getFileName()),c="text";if(""!==a){c=b.langType(a)}e.setMode("ace/mode/"+c)};this.getEditor=function(){if(!this.isOpen()){return!1}return d};this.setTheme=function(a){if(!this.isOpen()){return}d.setTheme("ace/theme/"+a)};this.open=function(){this.showFileName();if("undefined"==typeof ace){b.loadScript(["../editor/ace9/ace.js","../editor/ace9/ext-language_tools.js"],function(){c.open()});return!1}if(this.isOpen()){return d}var g=this.getFileManager(),h=this.getTId();a(h).removeClass("ui-widget-content ui-tabs-panel");ace.require("ext/language_tools");d=ace.edit("vpl_file"+this.getId());e=d.getSession();d.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0});d.setValue(this.getContent());d.setFontSize(g.getFontSize());d.setTheme("ace/theme/"+g.getTheme());d.$blockScrolling=1/0;d.gotoLine(1,0);d.setReadOnly(f);e.setUseSoftTabs(!0);e.setTabSize(4);e.setUndoManager(new ace.UndoManager);this.setOpen(!0);this.langSelection();d.execCommand("replace");var i=function(){var b=a(h+" div.ace_search");if(b.length){b.on("drop",g.dropHandler);var c=a(".ace_searchbtn_close");c.trigger("click")}else{setTimeout(i,50)}};d.on("change",function(){c.change()});setTimeout(i,5);var j=d.onPaste;d.onPaste=function(a){if(g.restrictedEdit){d.insert(g.getClipboard())}else{j.call(d,a)}};d.on("copy",function(a){g.setClipboard(a.text)});a(h).on("paste","*",g.restrictedPaste);a(h+" div.ace_content").on("drop",g.dropHandler);a(h+" div.ace_content").on("dragover",g.dragoverHandler);a(h).find("div.ace_scroller").css("position","static");this.adjustSize();a(h).find("div.ace_scroller").css("position","absolute");return d};this.close=function(){this.setOpen(!1);if(null===d){return}this.setContent(d.getValue());d.destroy();d=null;e=null}}});
define ("mod_vpl/vplidefile",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplidecodefile","mod_vpl/vplideblocklyfile","mod_vpl/vplidebinaryfile"],function(a,b,c,d,e,f){return function(b,g,h,i,j){var k="#vpl_file"+b,l="#vpl_tab_name"+b,m=g,n=!0,o=!1,p=this;this.getContent=function(){return h};this.setContent=function(a){h=a};this.getFileManager=function(){return i};this.getFileName=function(){return m};this.getId=function(){return b};this.getTabNameId=function(){return l};this.getTId=function(){return k};this.getFileName=function(){return m};this.isModified=function(){return n};this.resetModified=function(){n=!1;this.showFileName()};this.setModified=function(){n=!0;this.showFileName()};this.getTabPos=function(){return i.getTabPos(this)};this.isOpen=function(){return o};this.setOpen=function(a){o=a};this.getVPLIDE=function(){return j};this.change=function(){if(!n){this.setModified();i.generateFileList();this.showFileName();c.longDelay("setModified",i.setModified)}};this.setFileName=function(a){if(!c.validPath(a)){return!1}if(a!=m){m=a;p.change()}if(!this.isOpen()){return!0}this.showFileName();this.langSelection();return!0};this.showFileName=function(){var b=this.getFileName(),d=c.getFileName(b);if(20<d.length){d=d.substring(0,16)+"..."}var e=(n?c.iconModified():"")+d;if(this.getTabPos()<i.minNumberOfFiles){e=e+c.iconRequired()}else{e=e+c.iconClose()}a(l+" a").html(e);if(d!=b){a(l+" a").attr("title",b)}c.afterAll("adjustTabsTitles"+p.id,function(){i.adjustTabsTitles(!0);c.delay("adjustTabsTitles"+p.id,function(){p.adjustSize()})})};this.destroy=function(){a(l).remove();a(k).remove()};this.adjustSize=function(){if(!this.isOpen()){return!1}var b=a(k),c=b.parent();if(0===b.length){return!1}var d=b.height(),e=b.width(),f=c.height();f-=b.position().top;var g=a("#vpl_tabs_scroll").width();if(f!=d||g!=e){a(b).height(f);a(b).width(g);return!0}return!1};this.gotoLine=c.doNothing;this.setReadOnly=c.doNothing;this.focus=c.doNothing;this.blur=c.doNothing;this.undo=c.doNothing;this.redo=c.doNothing;this.selectAll=c.doNothing;this.open=c.doNothing;this.hasUndo=c.returnFalse;this.hasRedo=c.returnFalse;this.hasSelectAll=c.returnFalse;this.hasFind=c.returnFalse;this.hasFindReplace=c.returnFalse;this.hasNext=c.returnFalse;this.find=c.doNothing;this.replace=c.doNothing;this.next=c.doNothing;this.getAnnotations=function(){return[]};this.setAnnotations=c.doNothing;this.setFontSize=c.doNothing;this.setTheme=c.doNothing;this.clearAnnotations=c.doNothing;this.langSelection=c.doNothing;this.isBinary=c.returnFalse;this.extendToCodeEditor=d;this.extendToBlockly=e;this.extendToBinary=f}});
define ("mod_vpl/vplidebinaryfile",["jquery","mod_vpl/vplutil"],function(a,b){return function(){this.isBinary=function(){return!0};var d=this.setContent;this.setContent=function(a){d.call(this,a);this.setModified();this.updateDataURL()};this.updateDataURL=function(){var c=this.getFileName(),d=this.getContent(),e=this.getTId();if(b.isImage(c)){var f="data:"+b.getMIME(c)+";base64,";a(e).find("img").attr("src",f+d)}else{a(e).find("img").attr("src","")}};this.adjustSize=function(){if(!this.isOpen()){return!1}var b=a(this.getTId());if(0===b.length){return!1}var c=b.parent(),d=c.height();d-=b.position().top;if(d!=b.height()){b.height(d);return!0}return!1};this.open=function(){this.showFileName();var c=this.getFileName(),d=this.getTId();this.setOpen(!0);if(b.isImage(c)){a(d).addClass("vpl_ide_img").append("<img />");this.updateDataURL()}else{a(d).addClass("vpl_ide_binary").text(b.str("binaryfile"))}};this.close=function(){this.setOpen(!1)}}});
function _typeof(e){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}define ("mod_vpl/vplide",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplidefile","mod_vpl/vplidebutton","mod_vpl/vplterminal","mod_vpl/vplvnc"],function(t,e,l,n,a,o,d){var s,r=function(e,c){var C=this,V,k,S,I,N,H,P=c.minfiles||0,W=c.maxfiles||0,O=c.restrictededitor||c.example,R=c.example,E=c.isTeacher,j=!1,D=l.scrollBarWidth(),B=l.str,q=t("#"+e);t("head").append("<meta name=\"viewport\" content=\"initial-scale=1\">").append("<meta name=\"viewport\" width=\"device-width\">").append("<link rel=\"stylesheet\" href=\"../editor/VPLIDE.css\"/>");if("object"!=_typeof(q)){throw new Error("VPL: constructor tag_id not found")}var K={new:!0,rename:!0,delete:!0,save:!0,run:!0,edit:!0,debug:!0,evaluate:!0,import:!0,resetfiles:!0,sort:!0,multidelete:!0,acetheme:!0,console:!0,comments:!0};if("undefined"==typeof c.loadajaxurl){c.loadajaxurl=c.ajaxurl}(function(){var e=P<W;c.new=e;c.rename=e;c.delete=e;c.comments=c.comments&&!c.example;c.acetheme=!0})();c.sort=2<=W-P;c.multidelete=c.sort;c.import=!O;var U=function(e){if(!K[e]){return!0}return c[e]};c.console=U("run")||U("debug");if("undefined"==typeof c.fontSize){c.fontSize=12}c.fontSize=parseInt(c.fontSize);function p(i){if(O){i.originalEvent.dataTransfer.dropEffect="none"}else{i.originalEvent.dataTransfer.dropEffect="copy"}i.preventDefault()}function u(i){if(O){i.stopImmediatePropagation();return!1}var e=i.originalEvent.dataTransfer;if(0<e.files.length){l.readSelectedFiles(e.files,function(e){return V.addFile(e,!0,N,I)},function(){V.fileListVisibleIfNeeded()});i.stopImmediatePropagation();return!1}return!1}q.on("drop",u);q.on("dragover",p);function g(i){if(O){i.stopPropagation();return!1}return!0}var G=t("#vpl_menu"),X=new a(G,U),Y=t("#vpl_tr"),r=t("#vpl_filelist"),Q=t("#vpl_filelist_header"),J=t("#vpl_filelist_content"),Z=t("#vpl_tabs_ul"),$=t("#vpl_tabs"),ee=t("#vpl_results"),ie=t("#vpl_results_accordion");r.vplMinWidth=80;ee.vplMinWidth=100;function m(e,i){if("newHeader"in i){if(i.newHeader.hasClass("vpl_ide_accordion_t_grade")){return!1}}return!0}function h(){var a=t("#vpl_tabs_ul");t("#vpl_tabs").tabs();var o=t("#vpl_tabs").tabs("widget"),d=[],m=[],h=!0,f=this;(function(){var e;f.setVersion=function(i){e=i};f.getVersion=function(){return e}})();this.updateFileList=function(){f.generateFileList()};this.fileNameExists=function(e){for(var t=e.toLowerCase(),l=0;l<d.length;l++){if(d[l].getFileName().toLowerCase()==t){return l}}return-1};function e(e){for(var t=e.toLowerCase()+"/",l=0,n;l<d.length;l++){n=d[l].getFileName().toLowerCase()+"/";if(0===n.indexOf(t)||0===t.indexOf(n)){return!0}}return!1}function i(e,t){if(l.isBlockly(e)){return!1}if(l.isBlockly(t)){for(var n=0;n<d.length;n++){if(l.isBlockly(d[n].getFileName())){return!0}}}return!1}this.restrictedPaste=g;this.dropHandler=u;this.dragoverHandler=p;this.readOnly=R;this.restrictedEdit=O;this.adjustTabsTitles=k;this.minNumberOfFiles=P;this.scrollBarWidth=D;var v="";this.setClipboard=function(e){v=e};this.getClipboard=function(){return v};this.getTabPos=function(e){for(var t=0;t<m.length;t++){if(m[t]==e){return t}}return m.length};this.getTheme=function(){return c.theme};this.setTheme=function(e){c.theme=e;for(var t=0;t<d.length;t++){d[t].setTheme(e)}};this.addTab=function(e){a.append("<li id=\"vpl_tab_name"+e+"\">"+("<a href=\"#vpl_file"+e+"\"></a>")+"</li>");o.append("<div id=\"vpl_file"+e+"\" class=\"vpl_ide_file\"></div>")};this.removeTab=function(e){a.find("#vpl_tab_name"+e).remove();o.find("#vpl_file"+e).remove()};this.open=function(e){var i;if("object"==_typeof(e)){i=e}else{i=d[e]}if(i.isOpen()){return}var t=i.getId();f.addTab(t);m.push(i);X.setGetkeys(i.open());o.tabs("refresh");k(!1);l.delay("updateFileList",f.updateFileList);l.delay("updateMenu",N)};this.close=function(e){if(!e.isOpen()){return}var i,t=e.getId();e.close();f.removeTab(t);var n=f.getTabPos(e);m.splice(n,1);o.tabs("refresh");k(!1);f.fileListVisible(!0);l.delay("updateFileList",f.updateFileList);l.delay("adjustTabsTitles",k,!1);if(m.length>n){i=f.getFilePosById(m[n].getId());f.gotoFile(i,"c");return}if(0<n){i=f.getFilePosById(m[n-1].getId());f.gotoFile(i,"c")}};this.isClosed=function(e){return!d[e].isOpen()};this.fileListVisible=function(e){if(e===r.vplVisible){return}if(e){l.delay("fileListVisible",function(){r.vplVisible=!0;f.updateFileList();r.show();S()})}else{l.delay("fileListVisible",function(){r.vplVisible=!1;r.hide();S()})}};this.isFileListVisible=function(){return r.vplVisible};this.fileListVisibleIfNeeded=function(){if(this.isFileListVisible()){return}for(var e=0;e<d.length;e++){if(!d[e].isOpen()){this.fileListVisible(!0);return}}};this.setFontSize=function(e){c.fontSize=e;for(var t=0;t<d.length;t++){d[t].setFontSize(e)}we.setFontSize(e)};this.getFontSize=function(){return c.fontSize};this.addFile=function(t,a,o,r){if("string"!=typeof t.name||!l.validPath(t.name)){r(B("incorrect_file_name")+" ("+t.name+")");return!1}if(!0!==a){a=!1}var c=this.fileNameExists(t.name);if(-1!=c){if(a){d[c].setContent(t.contents);f.setModified();o();l.delay("updateFileList",f.updateFileList);return t}else{r(B("filenotadded",t.name));return!1}}if(e(t.name)||i("",t.name)){r(B("filenotadded",t.name));return!1}if(d.length>=W){r(B("maxfilesexceeded")+" ("+W+")");return!1}var p=l.getUniqueId(),u=new n(p,t.name,t.contents,this,s);if(1==t.encoding){u.extendToBinary()}else{if(l.isBlockly(t.name)){u.extendToBlockly()}else{u.extendToCodeEditor()}}u.setFileName(t.name);d.push(u);f.setModified();if(5<d.length){f.fileListVisible(!0)}o();return u};this.renameFile=function(t,n,a){var o=this.fileNameExists(t);try{if(-1==o){throw new Error("Internal error: File name not found")}if(o<P){throw new Error("Internal error: Renaming requested filename")}if(d[o].getFileName()==n){return!0}if(!l.validPath(n)||e(n)||i(t,n)){throw B("incorrect_file_name")}if(l.isBinary(t)&&l.fileExtension(t)!=l.fileExtension(n)){throw B("incorrect_file_name")}if(l.isBlockly(t)!=l.isBlockly(n)){throw B("incorrect_file_name")}d[o].setFileName(n)}catch(i){a(B("filenotrenamed",n)+": "+i);return!1}f.setModified();k(!1);l.delay("updateFileList",f.updateFileList);return!0};this.deleteFile=function(e,i,t){var n=this.fileNameExists(e);if(-1==n){t(B("filenotdeleted",e));return!1}if(n<P){t(B("filenotdeleted",e));return!1}f.setModified();f.close(d[n]);d.splice(n,1);l.delay("updateFileList",f.updateFileList);return!0};this.currentFile=function(){var e=o.tabs("option","active");if(e in m){var i=m[e];if(0===arguments.length){return i}var t=arguments[0];if("function"==typeof i[t]){var l=i[t],n=Array.prototype.slice(arguments);n.shift();return l.apply(i,n)}}return!1};this.currentPos=function(){return o.tabs("option","active")};this.getFileTab=function(e){for(var t=0;t<m.length;t++){if(m[t].getId()==e){return t}}return-1};this.getFilePosById=function(e){for(var t=0;t<d.length;t++){if(d[t].getId()==e){return t}}return-1};this.gotoFile=function(e,i){var t=d[e];f.open(t);o.tabs("option","active",f.getFileTab(t.getId()));if("c"!==i){t.gotoLine(parseInt(i,10))}t.focus()};this.gotoFileLink=function(e){var i=t(e),l=i.data("file"),n=-1;if(""<l){n=this.fileNameExists(l)}else{n=f.getFilePosById(i.data("fileid"))}if(0<=n){var a=i.data("line");if("undefined"==typeof a){a="c"}f.gotoFile(n,a);return!0}return!1};this.getFilesToSave=function(){for(var e=[],t=0,l;t<d.length;t++){l={};l.name=d[t].getFileName();l.contents=d[t].getContent();l.encoding=d[t].isBinary()?1:0;e.push(l)}return e};this.resetModified=function(){h=!1;for(var e=0;e<d.length;e++){d[e].resetModified()}l.delay("updateMenu",N);l.delay("updateFileList",f.updateFileList)};this.setModified=function(){h=!0;l.delay("updateFileList",f.updateFileList);l.delay("updateMenu",N)};this.isModified=function(){return h};this.length=function(){return d.length};this.clearAnnotations=function(){for(var e=0;e<d.length;e++){d[e].clearAnnotations()}};this.getFile=function(e){return d[e]};this.getFiles=function(){return d};this.getDirectoryStructure=function(){var t={isDir:!0,content:{}};function e(e){var i=d[e],l=i.getFileName(),n=l.split("/"),a=t;for(var o in n){if(n.hasOwnProperty(o)){var s=n[o];if(o==n.length-1){a.content[s]={isDir:!1,content:i,pos:e}}else{if(!a.content[s]){a.content[s]={isDir:!0,content:{}}}a=a.content[s]}}}}for(var l in d){if(d.hasOwnProperty(l)){e(l)}}return t};this.generateFileList=function(){if(!f.isFileListVisible()){return}function e(i,t,n){for(var a in i.content){if(i.content.hasOwnProperty(a)){var o=i.content[a];if(o.isDir){n.push(t+l.iconFolder()+l.sanitizeText(a));e(o,t+"<span class=\"vpl_ide_dirindent\"></span>",n)}else{var d=o.content,s=l.sanitizeText(a),r=l.sanitizeText(d.getFileName());if(d.isOpen()){s="<b>"+s+"</b>"}var c="href=\"#\" data-fileid=\""+d.getId()+"\" title=\""+r+"\"",p="<a "+c+">"+s+"</a>";if(d.isModified()){p=l.iconModified()+p}if(o.pos<P){p=p+l.iconRequired()}n.push(t+p)}}}}var t=f.getDirectoryStructure(),n=[],a="";e(t,"",n);for(var o=0;o<n.length;o++){a+=n[o]+"<br>"}J.html("<div>"+a+"</div>")};a.on("click","span.vpl_ide_closeicon",function(){V.close(V.currentFile())});a.on("dblclick","span.vpl_ide_closeicon",X.getAction("delete"));a.on("dblclick","a",X.getAction("rename"));J.on("dblclick","a",X.getAction("rename"))}this.updateEvaluationNumber=function(e){if("undefined"!=typeof e.nevaluations){var i=e.nevaluations;if("undefined"!=typeof e.reductionbyevaluation&&""<e.reductionbyevaluation&&0!=e.reductionbyevaluation){if(0!=e.freeevaluations){i=i+"/"+e.freeevaluations}i=i+" -"+e.reductionbyevaluation}X.setExtracontent("evaluate",i)}};this.lastResult=null;this.getTerminal=function(){return we};this.setResultGrade=function(e,i){var t="vpl_ide_accordion_t_grade",l="vpl_ide_accordion_c_grade";if(0==ie.find("."+l).length){ie.append("<div class=\""+t+"\"></div>");ie.append("<div class=\""+l+"\"></div>")}if("undefined"==typeof i){return 0<ie.find("h4."+t).length}var n=ie.find("."+t);if(""<e){n.replaceWith("<h4 class=\""+t+"\">"+e+"</h4>");return!0}else{n.replaceWith("<div class=\""+t+"\"></div>");return!1}};this.setResultTab=function(e,i,l){var n="vpl_ide_accordion_t_"+e,a="vpl_ide_accordion_c_"+e;if(0==ie.find("."+a).length){ie.append("<div class=\""+n+"\"></div>");ie.append("<div class=\""+a+"\"></div>")}if("undefined"==typeof l){return 0<ie.find("h4."+n).length}var o=ie.find("."+n),d=ie.find("."+a),s=t("<div>"+i+"</div>");s.find("h4").replaceWith(function(){return t("<h5>").append(t(this).contents())});if(d.html()==s.html()){return""<i}if(""<i){o.replaceWith("<h4 class=\""+n+"\">"+B(e)+"</h4>");d.replaceWith("<div class=\"ui-widget "+a+"\">"+s.html()+"</div>");return!0}else{o.replaceWith("<div class=\""+n+"\"></div>");d.replaceWith("<div class=\""+a+"\"></div>");return!1}};this.setResult=function(e,t){C.updateEvaluationNumber(e);var n=V.getFiles(),a=[],o;for(o=0;o<n.length;o++){a[o]=n[o].getFileName();n[o].clearAnnotations()}var d=!1,s,r=l.sanitizeText(e.grade),c,p;c=C.setResultGrade(r,e.grade);d=d||c;s=C.setResultTab("variables",e.variables,e.variables);d=d||s;p=l.processResult(e.compilation,a,n,!0,!1);s=C.setResultTab("compilation",p,e.compilation);d=d||s;p=l.processResult(e.evaluation,a,n,!1,!1);s=C.setResultTab("comments",p,e.evaluation);d=d||s;p=l.sanitizeText(e.execution);s=C.setResultTab("execution",p,e.execution);d=d||s;s=C.setResultTab("description",window.VPLDescription,window.VPLDescription);if(s&&"object"==("undefined"==typeof MathJax?"undefined":_typeof(MathJax))){var u=ie.find(".vpl_ide_accordion_c_description")[0];MathJax.Hub.Queue(["Typeset",MathJax.Hub,u])}d=d||s;if(d){ee.show();ee.vplVisible=!0;ie.accordion("refresh");ie.accordion("option","active",c?1:0);for(o=0;o<n.length;o++){for(var g=n[o].getAnnotations(),m=0;m<g.length;m++){if(t||"error"==g[m].type){V.gotoFile(o,g[m].row+1);break}}}}else{ee.hide();ee.vplVisible=!1}l.delay("autoResizeTab",S)};ie.accordion({heightStyle:"fill",header:"h4",animate:!1,beforeActivate:m});ee.width(2*ee.vplMinWidth);ie.on("click","a",function(e){if(V.gotoFileLink(e.currentTarget)){e.preventDefault()}});ee.vplVisible=!1;ee.hide();r.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");Q.text(B("filelist"));Q.html(l.iconFolder()+Q.html());Q.addClass("ui-widget-header ui-button-text-only ui-corner-all");J.addClass("ui-widget ui-corner-all");r.width(2*r.vplMinWidth);r.on("click","a",function(e){e.preventDefault();V.gotoFileLink(e.currentTarget)});r.vplVisible=!1;r.hide();var te=!1;function f(){if(!1===te){te=($.outerWidth(!0)-$.width())/2}return te}function v(i,e){var t=e.position.left-e.originalPosition.left,l;if(0!=t){l=$.width()+r.width()-r.vplMinWidth;$.resizable("option","maxWidth",l);r.width(r.vplOriginalWidth+t)}else{l=$.width()+ee.width()-ee.vplMinWidth;$.resizable("option","maxWidth",l);var n=e.size.width-e.originalSize.width;ee.width(ee.vplOriginalWidth-n)}V.currentFile("adjustSize")}var le={containment:"parent",resize:v,start:function start(){t(window).off("resize",S);$.resizable("option","minWidth",100);if(ee.vplVisible){ee.vplOriginalWidth=ee.width()}if(r.vplVisible){r.vplOriginalWidth=r.width()}},stop:function stop(i,e){v(i,e);$.resizable("option","maxWidth",1e5);$.resizable("option","minWidth",0);S();t(window).on("resize",S)},handles:""};$.resizable(le);function _(){var e=0;e+=r.vplVisible?1:0;e+=ee.vplVisible?2:0;$.resizable("destroy");le.handles=["e","w","e","e, w"][e];le.disable=0===e;$.resizable(le)}function b(){var e=t(window).outerHeight();e-=G.offset().top+G.height()+(j?f():20);if(150>e){e=150}Y.height(e);var i=e-3*f();$.height(i);if(ee.vplVisible){ee.height(i+f());ie.accordion("refresh")}if(r.vplVisible){J.height(i-(Q.outerHeight()+f()));r.height(i)}}k=function(e){var i=$.width(),l=0;Z.width(1e5);var n=Z.children("li:visible").last();if(n.length){var a=Z.parent().scrollLeft();l=a+n.position().left+n.width()+te;Z.width(l);var o=V.currentFile();if(o&&e){var d=t(o.getTabNameId()),s=a+d.position().left;s-=(i-d.outerWidth())/2;if(0>s){s=0}Z.parent().finish().animate({scrollLeft:s},"slow")}}if(l<i){Z.width("")}};S=function(){var e=$.width(),i=G.width(),t=!1;_();Y.width(G.outerWidth());if(r.vplVisible){var l=r.outerWidth()+te;e+=l;if(100<=l){i-=l;$.css("left",l)}else{t=!0}}else{$.css("left",0)}if(ee.vplVisible){var n=ee.outerWidth()+te;e+=n;i-=n;if(100>i){t=!0}}if(t){var a=G.width()/e,o=0;if(r.vplVisible){o=r.width()*a;r.width(o-te);o+=te;$.css("left",o)}$.width($.width()*a);if(ee.vplVisible){ee.width(G.width()-(o+$.width()+te))}}else{$.width(i)}k(!0);b();V.currentFile("adjustSize")};function F(){V.currentFile("focus")}var ne=t.extend({},{close:F},l.dialogbaseOptions);function T(e,i){return l.showMessage(e,t.extend({},ne,i))}I=function(e){return l.showErrorMessage(e,{close:F})};var ae=t("#vpl_ide_dialog_new");function w(e){if(!("click"==e.type||"keypress"==e.type&&13==e.keyCode)){return!0}ae.dialog("close");var i={name:t("#vpl_ide_input_newfilename").val(),contents:"",encoding:0},l=V.addFile(i,!1,N,I);if(l){V.open(l);$.tabs("option","active",V.getTabPos(l));l.focus();return!0}return!1}var oe={};oe[B("ok")]=w;oe[B("cancel")]=function(){t(this).dialog("close")};ae.find("input").on("keypress",w);ae.dialog(t.extend({},ne,{title:B("create_new_file"),buttons:oe}));l.setDialogTitleIcon(ae,"new");var de=t("#vpl_ide_dialog_rename");function y(e){if(!("click"==e.type||"keypress"==e.type&&13==e.keyCode)){return}de.dialog("close");V.renameFile(V.currentFile("getFileName"),t("#vpl_ide_input_renamefilename").val(),I);e.preventDefault()}de.find("input").on("keypress",y);oe[B("ok")]=y;de.dialog(t.extend({},ne,{open:function open(){t("#vpl_ide_input_renamefilename").val(V.currentFile("getFileName"))},title:B("rename_file"),buttons:oe}));l.setDialogTitleIcon(de,"rename");oe[B("ok")]=function(){t(this).dialog("close")};var se=t("#vpl_ide_dialog_comments");se.dialog(t.extend({},ne,{title:B("comments"),width:"40em",buttons:oe}));l.setDialogTitleIcon(se,"comments");t("#vpl_ide_input_comments").width("30em");var re=t("#vpl_ide_dialog_about"),ce={};ce[B("ok")]=function(){t(this).dialog("close")};var pe=t("#vpl_ide_dialog_shortcuts");pe.dialog(t.extend({},ne,{open:function open(){var e=X.getShortcuts(V.currentFile("getEditor"));t("#vpl_ide_dialog_shortcuts").html(e)},title:B("shortcuts"),width:400,height:300,buttons:ce}));pe.dialog("option","height",300);l.setDialogTitleIcon(pe,"shortcuts");ce[B("shortcuts")]=function(){t(this).dialog("close");pe.dialog("open")};re.dialog(t.extend({},ne,{open:function open(){var e=X.getShortcuts(V.currentFile("getEditor"));re.next().find("button").filter(function(){return t(this).text()==B("shortcuts")}).button(""!=e?"enable":"disable")},title:B("about"),width:400,height:300,buttons:ce}));re.dialog("option","height",300);l.setDialogTitleIcon(re,"about");var ue=t("#vpl_ide_dialog_sort"),ge={};ge[B("ok")]=function(){var e=V.getFiles(),l=[],n=0,a=t("#vpl_sort_list li");if(a.length!=e.length){return}a.each(function(){var i=parseInt(this.id.replace(/[^\d]*/,""));l.push(e[i])});for(n=0;n<a.length;n++){e[n]=l[n]}V.setModified();t(this).dialog("close")};ge[B("cancel")]=function(){t(this).dialog("close")};ue.dialog(t.extend({},ne,{title:B("sort"),buttons:ge,open:function open(){var e=t("#vpl_sort_list");e.html("");for(var l=V.getFiles(),n=0,a;n<l.length;n++){a=t("<li id=\"vpl_fsort_"+n+"\"class=\"ui-widget-content\"></li>");if(n<P){a.addClass("ui-state-disabled")}a.text(n+1+"-"+l[n].getFileName());e.append(a)}e.sortable({items:"li:not(.ui-state-disabled)",placeholder:"ui-state-highlight",start:function start(e,i){i.item.addClass("ui-state-highlight")},stop:function stop(e,i){i.item.removeClass("ui-state-highlight")}});e.disableSelection()},maxHeight:400}));l.setDialogTitleIcon(ue,"sort");var me=t("#vpl_ide_dialog_multidelete"),he={};he[B("selectall")]=function(){t(this).find("input").prop("checked",!0)};he[B("deselectall")]=function(){t(this).find("input").prop("checked",!1)};he[B("deleteselected")]=function(){var e=V.getFiles(),n=[],a=t("#vpl_multidelete_list label");a.each(function(){var i=t(this);if(i.find("input").prop("checked")){var l=i.data("fileid");n.push(e[l].getFileName())}});for(var o=0;o<n.length;o++){V.deleteFile(n[o],!1,I)}l.delay("updateMenu",N);l.delay("updateFileList",V.updateFileList);t(this).dialog("close")};he[B("cancel")]=function(){t(this).dialog("close")};me.dialog(t.extend({},ne,{title:B("multidelete"),buttons:he,open:function open(){var e=t("#vpl_multidelete_list");e.html("");for(var n=V.getFiles(),a=P;a<n.length;a++){var o=l.sanitizeText(n[a].getFileName()),d=t("<label><input type=\"checkbox\"> "+o+"</label>");d.data("fileid",a);e.append(d);e.append("<br>")}e.find("label").button()},maxHeight:400,maxWidth:400}));l.setDialogTitleIcon(me,"multidelete");var fe=t("#vpl_ide_dialog_fontsize"),ve=t("#vpl_ide_dialog_fontsize .vpl_fontsize_slider"),_e={};_e[B("ok")]=function(){var e=ve.slider("value");V.setFontSize(e);t(this).dialog("close");t.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({fontSize:e}),contentType:"application/json; charset=utf-8",dataType:"json"})};_e[B("cancel")]=function(){V.setFontSize(ve.data("vpl_fontsize"));t(this).dialog("close")};_e[B("reset")]=function(){ve.slider("value",12)};fe.dialog(t.extend({},ne,{title:B("fontsize"),buttons:_e,open:function open(){ve.data("vpl_fontsize",V.getFontSize());ve.slider("value",V.getFontSize())}}));ve.slider({min:1,max:48,change:function change(){var e=ve.slider("value");V.setFontSize(e);fe.find(".vpl_fontsize_slider_value").text(e)}});l.setDialogTitleIcon(fe,"fontsize");var be=t("#vpl_ide_dialog_acetheme"),Fe=t("#vpl_ide_dialog_acetheme select"),Te={};Te[B("ok")]=function(){V.setTheme(Fe.val());t(this).dialog("close");l.setUserPreferences({aceTheme:Fe.val()})};Te[B("cancel")]=function(){V.setTheme(Fe.data("acetheme"));t(this).dialog("close")};Te[B("reset")]=function(){Fe.val(Fe.data("acetheme"));V.setTheme(Fe.val())};be.dialog(t.extend({},ne,{title:B("theme"),buttons:Te,modal:!1,open:function open(){Fe.data("acetheme",V.getTheme());Fe.val(V.getTheme())}}));Fe.on("change",function(){V.setTheme(Fe.val())});l.setDialogTitleIcon(be,"theme");var we=new o("vpl_dialog_terminal","vpl_terminal",B),ye=new d("vpl_dialog_vnc",B),xe=we,Le=t("#vpl_ide_input_file");Le.on("change",function fileSelectHandler(){l.readSelectedFiles(this.files,function(e){return V.addFile(e,!0,N,I)},function(){V.fileListVisibleIfNeeded()})});X.add({name:"filelist",originalAction:function originalAction(){V.fileListVisible(!V.isFileListVisible());l.delay("updateMenu",N);l.delay("autoResizeTab",S);l.delay("updateFileList",V.updateFileList)},bindKey:{win:"Ctrl-L",mac:"Ctrl-L"}});X.add({name:"new",originalAction:function originalAction(){if(V.length()<W){ae.dialog("open")}},bindKey:{win:"Alt-N",mac:"Option-N"}});X.add({name:"rename",originalAction:function originalAction(){var e=V.currentFile();if(e&&V.getFilePosById(e.getId())>=P){de.dialog("open")}},bindKey:{win:"Ctrl-R",mac:"Ctrl-R"}});X.add({name:"delete",originalAction:function originalAction(){var e=V.currentFile();if(!e){return}var i=e.getFileName(),t=B("delete_file_fq",i);T(t,{ok:function ok(){V.deleteFile(i,I)},title:B("delete_file_q"),icon:"trash"})},bindKey:{win:"Ctrl-D",mac:"Ctrl-D"}});X.add({name:"close",originalAction:function originalAction(){var e=V.currentFile();if(!e){return}V.close(e)},bindKey:{win:"Alt-W",mac:"Option-W"}});X.add({name:"import",originalAction:function originalAction(){Le.val("");Le.trigger("click")},bindKey:{win:"Ctrl-I",mac:"Ctrl-I"}});X.add({name:"sort",originalAction:function originalAction(){ue.dialog("open")},bindKey:{win:"Ctrl-O",mac:"Ctrl-O"}});X.add({name:"multidelete",originalAction:function originalAction(){me.dialog("open")}});X.add({name:"fontsize",originalAction:function originalAction(){fe.dialog("open")}});X.add({name:"theme",originalAction:function originalAction(){be.dialog("open")}});X.add({name:"print",originalAction:function originalAction(){window.print()},bindKey:{win:"Alt-P",mac:"Command-P"}});X.add({name:"undo",originalAction:function originalAction(){V.currentFile("undo")}});X.add({name:"redo",originalAction:function originalAction(){V.currentFile("redo")}});X.add({name:"select_all",editorName:"selectall",originalAction:function originalAction(){V.currentFile("selectAll")}});X.add({name:"find",originalAction:function originalAction(){V.currentFile("find")}});X.add({name:"find_replace",editorName:"replace",originalAction:function originalAction(){V.currentFile("replace")}});X.add({name:"next",editorName:"findnext",originalAction:function originalAction(){V.currentFile("next")}});X.add({name:"fullscreen",originalAction:function originalAction(){var e="header, nav, footer, aside, .dropdown, #page-header, div.navbar, #nav-drawer";e+=", div.tabtree, #dock, .breadcrumb-nav, .moodle-actionmenu";if(j){q.removeClass("vpl_ide_root_fullscreen");t("body").removeClass("vpl_body_fullscreen");X.setText("fullscreen","fullscreen");t(e).show();t("#vpl_ide_user").hide();j=!1}else{t("body").addClass("vpl_body_fullscreen").scrollTop(0);t(e).hide();q.addClass("vpl_ide_root_fullscreen");X.setText("fullscreen","regularscreen");if(c.username){t("#vpl_ide_user").show()}j=!0}F();setTimeout(S,10)},bindKey:{win:"Alt-F",mac:"Ctrl-F"}});X.add({name:"download",originalAction:function originalAction(){window.location=c.download}});function x(){l.requestAction("resetfiles","",{},c.ajaxurl).done(function(e){var i=e.files;for(var t in i){if(i.hasOwnProperty(t)){V.addFile(i[t],!0,l.doNothing,I)}}V.fileListVisibleIfNeeded();l.delay("updateMenu",N)}).fail(I)}X.add({name:"resetfiles",originalAction:function originalAction(){T(B("sureresetfiles"),{title:B("resetfiles"),ok:x,icon:"resetfiles"})}});X.add({name:"save",originalAction:function originalAction(){var i={files:V.getFilesToSave(),comments:t("#vpl_ide_input_comments").val(),version:V.getVersion()};if(JSON.stringify(i).length>c.postMaxSize){I(B("maxpostsizeexceeded"));return}function e(){l.requestAction("save","saving",i,c.ajaxurl).done(function(t){if(t.requestsconfirmation){T(t.question,{title:B("saving"),icon:"alert",yes:function yes(){i.version=t.version;e()}})}else{V.resetModified();V.setVersion(t.version);X.setTimeLeft(t);l.delay("updateMenu",N);if(l.monitorRunning()){i.processid=l.getProcessId();l.requestAction("update","updating",i,c.ajaxurl)}}}).fail(I)}e()},bindKey:{win:"Ctrl-S",mac:"Command-S"}});function L(e,i,t){if(!t){t={}}if(!xe.isConnected()){l.requestAction(e,"",t,c.ajaxurl).done(function(t){l.webSocketMonitor(t,e,i,H)}).fail(I)}}function M(){L("run","running",{XGEOMETRY:ye.getCanvasSize()})}X.add({name:"run",originalAction:function originalAction(){H.setLastAction(M);M()},bindKey:{win:"Ctrl-F11",mac:"Command-U"}});function A(){L("debug","debugging",{XGEOMETRY:ye.getCanvasSize()})}X.add({name:"debug",originalAction:function originalAction(){H.setLastAction(A);A()},bindKey:{win:"Alt-F11",mac:"Option-U"}});function z(){L("evaluate","evaluating")}X.add({name:"evaluate",originalAction:function originalAction(){H.setLastAction(z);z()},bindKey:{win:"Shift-F11",mac:"Command-Option-U"}});X.add({name:"comments",originalAction:function originalAction(){se.dialog("open")}});X.add({name:"console",originalAction:function originalAction(){if(xe.isOpen()){xe.close()}else{xe.show()}}});X.add({name:"user"});X.add({name:"about",originalAction:function originalAction(){re.dialog("open")}});X.add({name:"timeleft",originalAction:function originalAction(){X.toggleTimeLeft()}});X.add({name:"more",originalAction:function originalAction(){var e=t("#vpl_ide_menuextra");if(e.is(":visible")){X.setText("more","more",l.str("more"));e.hide()}else{X.setText("more","less",l.str("less"));e.show()}l.delay("updateMenu",N);l.delay("autoResizeTab",S)}});G.addClass("ui-widget-header ui-corner-all");var Me="";Me+=X.getHTML("more");Me+=X.getHTML("save");Me+="<span id='vpl_ide_mexecution'>";Me+=X.getHTML("run");Me+=X.getHTML("debug");Me+=X.getHTML("evaluate");Me+=X.getHTML("comments");Me+=X.getHTML("console");Me+="</span> ";Me+="<span id='vpl_ide_menuextra'>";Me+="<span id='vpl_ide_file'>";Me+=X.getHTML("filelist");Me+=X.getHTML("new");Me+=X.getHTML("rename");Me+=X.getHTML("delete");Me+=X.getHTML("import");Me+=X.getHTML("download");Me+=X.getHTML("resetfiles");Me+=X.getHTML("sort");Me+=X.getHTML("multidelete");Me+=X.getHTML("fontsize");Me+=X.getHTML("theme");Me+="</span> ";Me+="<span id='vpl_ide_edit'>";Me+=X.getHTML("undo");Me+=X.getHTML("redo");Me+=X.getHTML("select_all");Me+=X.getHTML("find");Me+=X.getHTML("find_replace");Me+=X.getHTML("next");Me+="</span> ";Me+="</span> ";Me+=X.getHTML("fullscreen")+" ";Me+=X.getHTML("about")+" ";Me+=X.getHTML("user")+" ";Me+=X.getHTML("timeleft");Me+="<div class=\"clearfix\"></div>";G.append(Me);t("#vpl_ide_more").button();t("#vpl_ide_save").button();t("#vpl_ide_menuextra").hide();t("#vpl_ide_file").controlgroup();t("#vpl_ide_edit").controlgroup();t("#vpl_ide_mexecution").controlgroup();t("#vpl_ide_fullscreen").button();t("#vpl_ide_acetheme").button();t("#vpl_ide_about").button();t("#vpl_ide_user").button().css("float","right").hide();t("#vpl_ide_timeleft").button().css("float","right").hide();t("#vpl_menu .ui-button").css("padding","6px");t("#vpl_menu .ui-button-text").css("padding","0");for(var Ae=["filelist","more","fullscreen","about","resetfiles","download","comments","console","import","fontsize","timeleft"],ze=0;ze<Ae.length;ze++){X.enable(Ae[ze],!0)}X.setExtracontent("user",c.username);X.setTimeLeft(c);N=function(){var e,t=V.currentFile(),n=V.length();if(n){$.show()}else{$.hide()}if(V.isFileListVisible()){X.setText("filelist","filelistclose",l.str("filelist"))}else{X.setText("filelist","filelist",l.str("filelist"))}var a=V.isModified();X.enable("save",a);var o=l.monitorRunning();if(o){X.setText("run","running")}else{X.setText("run","run")}X.enable("run",!o&&(!a||c.example)&&U("run"));X.enable("debug",!o&&(!a||c.example)&&U("debug"));X.enable("evaluate",!o&&(!a||c.example)&&U("evaluate"));X.enable("download",!a);X.enable("new",n<W);X.enable("sort",1<n-P);X.enable("multidelete",1<n-P);X.enable("theme",!0);var d;if(!t||0===n){d=["rename","delete","undo","redo","select_all","find","find_replace","next"];for(e=0;e<d.length;e++){X.enable(d[e],!1)}return}var s=V.getFilePosById(t.getId());X.enable("rename",s>=P&&0!==n);X.enable("delete",s>=P&&0!==n);X.enable("undo",t.hasUndo());X.enable("redo",t.hasRedo());X.enable("select_all",t.hasSelectAll());X.enable("find",t.hasFind());X.enable("find_replace",t.hasFindReplace());X.enable("next",t.hasNext());l.delay("updateFileList",V.updateFileList)};H={open:N,close:N,getConsole:function getConsole(){return xe},setResult:C.setResult,ajaxurl:c.ajaxurl,run:function run(e,i,n){var a=/^([^:]*):?(.*)/i.exec(e),o=a[1];if("terminal"==o||"webterminal"==o){if(xe&&xe.isOpen()){xe.close()}xe=we;we.connect(i.executionURL,function(){n.close();F()});if("webterminal"==o){var d=(i.secure?"https":"http")+"://"+i.server+":"+i.portToUse;d+="/favicon.ico";var s=t("<img>");s.attr("src",d);s.attr("style","display:none");t("body").append(s)}}else if("vnc"==o){if(xe&&xe.isOpen()){xe.close()}xe=ye;ye.connect(i.secure,i.server,i.portToUse,i.VNCpassword,i.executionPath,function(){n.close();F()})}else if("browser"==o){var r=(i.secure?"https":"http")+"://"+i.server+":"+i.portToUse+"/";r+=a[2]+"/httpPassthrough";if(E){r+="?private"}var c="<a href=\""+r+"\" target=\"_blank\">";c+=l.str("open")+"</a>";var p={width:200,icon:"run",title:l.str("run")};T(c,p)}else{l.log("Type of run error "+e,!0)}},lastAction:!1,getLastAction:function getLastAction(){var e=this.lastAction;this.lastAction=!1;return e},setLastAction:function setLastAction(e){this.lastAction=e}};$.on("tabsactivate",function(){V.currentFile("focus");l.delay("updateMenu",N);l.delay("autoResizeTab",S)});var Ce=t(window);Ce.on("resize",S);if(!c.example){Ce.on("beforeunload",function(){if(V.isModified()){return B("changesNotSaved")}})}V=new h;S();(function(){var i=G.width();function e(){var e=G.width();if(i!=e){i=e;S()}}e();setInterval(e,1e3)})();V.resetModified();l.requestAction("load","loading",c,c.loadajaxurl).done(function(e){for(var n=!0,a=e.files,o=!1,d=0;d<a.length;d++){var s=a[d],p=V.addFile(s,!1,N,I);if(p){p.resetModified();if(d<P||5>=a.length){V.open(p)}else{o=!0}}else{n=!1}}$.tabs("option","active",0);if(e.compilationexecution){C.setResult(e.compilationexecution,!1)}X.setTimeLeft(e);if(""<e.comments){t("#vpl_ide_input_comments").val(e.comments)}if(n){V.resetModified()}else{V.setModified()}if(0===V.length()&&0<W){X.getAction("new")()}else if(!c.saved){V.setModified()}V.setFontSize(c.fontSize);V.setVersion(e.version);V.fileListVisible(o);l.afterAll("AfterLoadFiles",function(){N();S();k(!0)})}).fail(I)};window.VPLIDE=r;return{init:function init(e,i){s=new r(e,i)}}});
define ("mod_vpl/vplutil",["jquery","jqueryui","core/log"],function(a,b,c){var d={doNothing:a.noop,returnFalse:function(){return!1},returnTrue:function(){return!0}},e=!1;d.log=function(a,b){if(e||b){c.debug(a)}};d.setUserPreferences=function(b){a.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify(b),contentType:"application/json; charset=utf-8",dataType:"json"})};d.getUserPreferences=function(b){a.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({getPreferences:!0}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(b)};d.scrollBarWidth=function(){var b,c,d;b=a("<div style=\"width:50px;height:50px;overflow:auto\"><div/></div>").appendTo("body");c=b.children();d=c.innerWidth()-c.height(99).innerWidth();b.remove();return d};d.sanitizeHTML=function(b){if("undefined"==typeof b||""==b.replace(/^\s+$/g,"")){return""}return a("<div>"+b+"</div>").html()};d.sanitizeText=function(a){if("undefined"==typeof a||""==a.replace(/^\s+$/g,"")){return""}return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};d.setProtocol=function(a){var b;if(0==a.securePort||0==a.port){b=0==a.port}else{switch(a.wsProtocol){case"always_use_wss":b=!0;break;case"always_use_ws":b=!1;break;default:b="https:"==window.location.protocol;}}var c=(b?"wss://":"ws://")+a.server;a.secure=b;a.portToUse=b?a.securePort:a.port;c+=":"+a.portToUse+"/";a.monitorURL=c+a.monitorPath;a.executionURL=c+a.executionPath};d.ArrayBuffer2String=function(a){var b=new Uint8Array(a),c=[],d=32e3,e,f;for(e=0,f=b.length;e<f;e+=d){c.push(String.fromCharCode.apply(String,b.subarray(e,Math.min(e+d,f))))}return c.join("")};d.String2ArrayBuffer=function(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++){d[e]=a.charCodeAt(e)}return c};(function(){var a=0;d.getUniqueId=function(){return a++}})();(function(){d.fileExtension=function(a){var b=/\.([^.]*)$/.exec(a);return null!==b?b[1]:""};d.isImage=function(a){return /^(gif|jpg|jpeg|png|ico)$/i.test(d.fileExtension(a))};d.isBinary=function(a){return d.isImage(a)||/^(zip|jar|pdf|tar|bin|7z|arj|deb|gzip|rar|rpm|dat|db|dll|rtf|doc|docx|odt|exe|com)$/i.test(d.fileExtension(a))};d.isBlockly=function(a){return /^blockly[0123]?$/.test(d.fileExtension(a))};d.validFileName=function(a){if(1>a.length){return!1}if(128<a.length){return!1}return!/[\cA-\cZ]|[:-@]|[{-~]|\\|\[|\]|[/^`´]|^-|^ | $|\.\./.test(a)}})();d.getCurrentTime=function(){return parseInt(new Date().valueOf()/1e3)};d.encodeBinary=function(a,b){if(!d.isBinary(a)){return btoa(unescape(encodeURIComponent(b)))}return btoa(d.ArrayBuffer2String(b))};d.decodeBinary=function(a,b){var c=atob(b);if(!d.isBinary(a)){return decodeURIComponent(escape(c))}return d.String2ArrayBuffer(c)};d.validPath=function(a){if(256<a.length){return!1}for(var b=a.split("/"),c=0;c<b.length;c++){if(!d.validFileName(b[c])){return!1}}return!0};d.getFileName=function(a){var b=a.split("/");return b[b.length-1]};d.dataFromURLData=function(a){return a.substr(a.indexOf(",")+1)};d.readZipFile=function(a,b,c,e){if(!e){e=d.doNothing}if("undefined"==typeof JUnzip){d.loadScript(["../editor/zip/inflate.js","../editor/zip/unzip.js"],function(){d.readZipFile(a,b,c,e)});return}var g=d.ArrayBuffer2String(a),h=new JUnzip(g);if(!h.isZipFile()){d.log("Not a ZIP file");e();return}h.readEntries();var j=h.entries.length;function f(a){if(a>=j||c.isClosed()){e();return}var g=h.entries[a],k=g.fileName,l;if(k.match(/\/$/)){f(a+1)}else{c.processFile(k);var m="";if(0===g.compressionMethod){m=g.data}else if(8===g.compressionMethod){m=JSInflate.inflate(g.data)}if(d.isBinary(k)){b({name:k,contents:btoa(m),encoding:1});f(a+1)}else{l=d.String2ArrayBuffer(m);var n=new Blob([l],{type:"text/plain"}),o=new FileReader;o.onload=function(c){b({name:k,contents:c.target.result,encoding:0});f(a+1)};o.onerror=function(b){d.log(b);a=j;f(a+1)};o.readAsText(n)}}}f(0)};d.readSelectedFiles=function(a,b,c){var h=new d.progressBar("import","import"),i="";if(!c){c=d.doNothing}h.processFile=function(a){h.setLabel(a)};function g(j){if(j>=a.length||h.isClosed()){c();h.close();if(""<i){d.showErrorMessage(i)}return}var k=a[j];h.processFile(k.name);var f=d.isBinary(k.name),l=new FileReader,m=d.fileExtension(k.name).toLowerCase();l.onload=function(a){if(f){if("zip"==m){try{d.readZipFile(a.target.result,b,h,function(){g(j+1)});return}catch(a){d.showErrorMessage(a+" : "+k.name)}}else{var c=d.dataFromURLData(a.target.result);b({name:k.name,contents:c,encoding:1})}}else{b({name:k.name,contents:a.target.result,encoding:0})}g(j+1)};l.onerror=function(a){i+="Error \""+a.target.error+"\" reading "+k.name+"\n";g(j+1)};if(f){if("zip"==m){l.readAsArrayBuffer(k)}else{l.readAsDataURL(k)}}else{l.readAsText(k)}}g(0)};(function(){var a={gif:"image/gif",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",ico:"image/vnd.microsoft.icon",pdf:"application/pdf"};d.getMIME=function(b){var c=d.fileExtension(b);if(c in a){return a[c]}return"application/octet-stream"};d.getTimeLeft=function(a){var b="",c=60,d=60*c,e=24*d;if(0>a){b+="-";a=-a}var f=a,g=parseInt(f/e);f-=g*e;if(0!==g){b+=g+"T"}var h=parseInt(f/d);f-=h*d;var i=parseInt(f/c);f-=i*c;var j=parseInt(f);b+=("00"+h).substr(-2)+":";b+=("00"+i).substr(-2);if(a<d){b+=":"+("00"+j).substr(-2)}return b}})();(function(){var a={abap:"abap",abc:"abc",ada:"ada",ads:"ada",adb:"ada",as:"actionscript",as3:"actionscript",asm:"assembly_x86",bash:"sh",bat:"batchfile",c:"c_cpp",C:"c_cpp",cc:"c_cpp",cpp:"c_cpp","c++":"c_cpp",hxx:"c_cpp",h:"c_cpp",H:"c_cpp",cases:"cases",cbl:"cobol",cob:"cobol",coffee:"coffee",clj:"clojure",cs:"csharp",css:"css",d:"d",dart:"dart",e:"eiffel",erl:"erlang",hrl:"erlang",f:"fortran",f77:"fortran",f90:"fortran",for:"fortran",go:"golang",groovy:"groovy",gv:"dot",hs:"haskell",htm:"html",html:"html",hx:"haxe",java:"java",jl:"julia",js:"javascript",json:"json",jsp:"jsp",jsx:"jsx",kt:"kotlin",kts:"kotlin",m:"matlab",md:"markdown",less:"less",lisp:"lisp",lsp:"lisp",lua:"lua",pas:"pascal",p:"pascal",perl:"perl",prl:"perl",php:"php",pro:"prolog",pl:"prolog",py:"python",R:"r",r:"r",rb:"ruby",ruby:"ruby",s:"assembly_x86",sass:"sass",scala:"scala",scm:"scheme",scss:"scss",sh:"sh",swift:"swift",sql:"sql",svg:"svg",tex:"tex",tcl:"tcl",ts:"typescript",twig:"twig",vbs:"vbscript",v:"verilog",vh:"verilog",vhd:"vhdl",vhdl:"vhdl",xml:"xml",yaml:"yaml"};d.langType=function(b){if(b in a){return a[b]}return"plain_text"}})();(function(){var a={};d.str=function(b,c){if(!a[b]){return"{"+b+"}"}if("undefined"!=typeof c){return a[b].replace(/\{\\*\$a\\*}/g,c)}else{return a[b]}};d.setStr=function(b){for(var c in b){if(b.hasOwnProperty(c)){a[c]=b[c]}}d.dialogbaseOptions={minWidth:200,autoOpen:!1,width:"auto",closeText:d.str("cancel"),modal:!0,dialogClass:"vpl_ide vpl_ide_dialog"}};d.setStr(window.VPLi18n)})();(function(){var a={},b={},c=100,e=0;d.delay=function(b,c,d,f){if("undefined"!=typeof a[b]){clearTimeout(a[b]);e--}e++;a[b]=setTimeout(function(){e--;c(d,f);delete a[b]},20)};d.longDelay=function(b,d,f,g){if("undefined"!=typeof a[b]){clearTimeout(a[b]);e--}e++;a[b]=setTimeout(function(){e--;d(f,g);delete a[b]},c)};var f=function(a,d,g,h){if("undefined"!=typeof b[a]){clearTimeout(b[a])}return setTimeout(function(){if(0<e){b[a]=f(a,d,g,h)}else{d(g,h);delete b[a]}},c)};d.afterAll=function(a,c,d,e){b[a]=f(a,c,d,e)}})();d.iconModified=function(){var a="<span title=\""+d.str("modified")+"\" class=\"vpl_ide_charicon\">";a+="<i class=\"fa fa-star\"></i></span> ";return a};d.iconDelete=function(){var a=" <span title=\""+d.str("delete")+"\" class=\"vpl_ide_charicon vpl_ide_delicon\">";a+="<i class=\"fa fa-trash\"></i></span> ";return a};d.iconClose=function(){var a=" <span title=\""+d.str("closebuttontitle");a+="\" class=\"vpl_ide_charicon vpl_ide_closeicon\"><i class=\"fa fa-remove\"></i></span> ";return a};d.iconRequired=function(){var a=" <span title=\""+d.str("required")+"\" class=\"vpl_ide_charicon\">";a+="<i class=\"fa fa-shield\"></i></span> ";return a};d.iconFolder=function(){return"<i class=\"fa fa-folder-open-o\"></i>"};(function(){var a={filelist:"folder-o",filelistclose:"folder-open-o",new:"file-code-o",rename:"pencil",delete:"trash",multidelete:"trash|list",close:"remove",comments:"commenting",import:"upload",print:"print",edit:"edit",undo:"undo",redo:"repeat",select_all:"location-arrow",find:"search",find_replace:"exchange",next:"search-plus",resetfiles:"refresh",download:"download",fullscreen:"expand",regularscreen:"compress",save:"save",shortcuts:"flash",sort:"list-ol",run:"rocket",running:"rocket fa-spin",debug:"bug",evaluate:"check-square-o",console:"terminal",about:"question",info:"info-circle",alert:"warning",trash:"trash",retrieve:"download",spinner:"refresh fa-spin",keyboard:"keyboard-o",clipboard:"clipboard",timeleft:"clock-o",copy:"copy",paste:"paste",more:"plus-square",less:"minus-square",resize:"arrows-alt",graphic:"picture-o",send:"send",theme:"paint-brush",user:"user",fontsize:"text-height"};d.genIcon=function(b,c){if(!a[b]){return""}var d="fa fa-";if(!c){d+="lg"}else{d+=c}for(var e=a[b].split("|"),f="",g=0;g<e.length;g++){f+="<i class='"+d+" fa-"+e[g]+"'></i>"}return f}})();d.setTitleBar=function(b,c,e,f,g){var j=a(b).parent().find("span.ui-dialog-title");function h(a){var b="<a id='vpl_"+c+"_"+a+"' href='#' title='"+d.str(a)+"'>";b+=d.genIcon(a,"fw")+"</a>";return b}var k=d.genIcon(e);k+=" <span class='"+c+"-title-buttons'></span>";k+="<span class='"+c+"-title-text'></span>";j.html(k);var l=j.find("span."+c+"-title-buttons"),m=j.find("span."+c+"-title-text");k="";for(var n=0;n<f.length;n++){k+=h(f[n])}l.html(k);for(var o=0,p;o<g.length;o++){p=j.find("#vpl_"+c+"_"+f[o]);p.button().click(g[o]);p.css("padding","1px 3px")}l.on("focus","*",function(){a(this).blur()});return m};d.setDialogTitleIcon=function(b,c){var e=a(b).parent().find("span.ui-dialog-title");e.html(d.genIcon(c)+" "+e.html())};d.progressBar=function(b,c,e){var f="<div class=\"vpl_ide_progressbaricon\">"+d.genIcon("spinner")+"</div>",g=a("<div class=\"vpl_ide_dialog\" style=\"display:none;\">"+(" <div class=\"vpl_ide_progressbar\">"+f+"<span class=\"vpl_ide_progressbarlabel\"></span>"+"</div>")+"</div>");a("body").append(g);var h=g.find(".vpl_ide_progressbar"),i=h.find(".vpl_ide_progressbarlabel");g.dialog({title:d.str(b),resizable:!1,autoOpen:!1,width:200,height:20,minHeight:20,modal:!0,dialogClass:"vpl_ide vpl_ide_dialog",close:function close(a){if(g){if(e&&a.originalEvent){e()}e=!1}}});this.setLabel=function(a,b){if(g){i.text(a);if(b){i.html(d.genIcon(b)+" "+i.html())}}};this.close=function(){if(g){g.dialog("destroy");a(g).remove();g=!1}};this.isClosed=function(){return!1===g};var j=g.siblings().find(".ui-dialog-title");j.html(d.genIcon(b)+" "+j.html());this.setLabel(d.str(c));g.dialog("open");g.dialog("option","height","auto")};d.showMessage=function(b,c){var e=a.extend({},d.dialogbaseOptions,c),f=a("<div class=\"vpl_ide_dialog\" style=\"display:none\"></div>"),g="",h=" <span class=\"dmessage\">"+b.replace(/\n/g,"<br>")+"</span>";f.html(h);if("undefined"==typeof e.icon){g="info"}else{g=e.icon;delete e.icon}if(!e.title){e.title=d.str("warning")}a("body").append(f);var i={};if("function"==typeof c.ok){i[d.str("ok")]=function(){a(this).dialog("close");c.ok()};i[d.str("cancel")]=function(){a(this).dialog("close")};delete e.ok}else if("function"==typeof c.yes){i[d.str("yes")]=function(){a(this).dialog("close");c.yes()};i[d.str("no")]=function(){a(this).dialog("close")};delete e.yes}else{i[d.str("close")]=function(){a(this).dialog("close")}}if(e.next){i[d.str("next")]=function(){a(this).dialog("close");c.next()}}e.close=function(){a(this).remove();if(c.close){c.close()}};e.buttons=i;f.dialog(e);var j=f.siblings().find(".ui-dialog-title");j.html(d.genIcon(g)+" "+j.html());f.setMessage=function(b){a(f).find(".dmessage").html(b.replace(/\n/g,"<br>"))};f.dialog("open");return f};d.showErrorMessage=function(b,c){var e=a.extend({},d.dialogbaseOptions,{title:d.str("error"),icon:"alert"});if(c){e=a.extend(e,c)}return d.showMessage(b,e)};d.requestAction=function(b,c,f,g,h){var i=a.Deferred(),j=null,k=!1,l=!1;if(!h){if(""===c){c="connecting"}l=new d.progressBar(b,c,function(){if(4!=j.readyState){if(k&&k.abort){k.abort()}}})}j=a.ajax({beforeSend:function beforeSend(a){k=a;return!0},async:!0,type:"POST",url:g+b,data:JSON.stringify(f),contentType:"application/json; charset=utf-8",dataType:"json"}).always(function(){if(!h){l.close()}}).done(function(a){if(!a.success){i.reject(a.error)}else{i.resolve(a.response)}}).fail(function(a,b,c){var f=d.str("connection_fail")+": "+b;if(e&&c.message!=void 0){f+=": "+c.message}d.log(f);i.reject(f)});return i};d.supportWebSocket=function(){if("WebSocket"in window){return!0}return!1};d.isAndroid=function(){return-1<window.navigator.userAgent.indexOf("Android")};d.isFirefox=function(){return-1<window.navigator.userAgent.indexOf("Firefox")};d.isMac=function(){return-1<window.navigator.userAgent.indexOf("Mac")};d.clickServer=function(b){var c=450,e=screen.width/2-275,f=screen.height/2-c/2;try{var g="toolbar=no, location=no, directories=no, status=no, menubar=no";g+=", resizable=yes, scrollbars=yes, copyhistory=no, width=550";g+=", height="+c+", top="+f+", left="+e;var h=window.open(a(this).attr("href"),"_blank",g);if(!h){return!0}}catch(a){d.log(a);return!0}b.preventDefault();a(this).parent().hide();return!1};d.acceptCertificates=function(b,c){if(0<b.length){var e=d.str("acceptcertificatesnote");e+="<ol>";for(var f in b){if(b.hasOwnProperty(f)){var g=1+f;e+="<li><a href=\""+b[f]+"\" target=\"_blank\">Server ";e+=g+"</a></li>"}}e+="</ol>";var h=d.showMessage(e,{ok:function ok(){var a=c();if(a){a()}},icon:"unlocked",title:d.str("acceptcertificates")});a(h).find("a").on("click keypress",d.clickServer)}else{d.log("servers.length == 0");d.showErrorMessage(d.str("connection_fail"))}};d.monitorRunning=d.returnFalse;(function(){var a=-1;d.setProcessId=function(b){a=b};d.getProcessId=function(){return a}})();d.webSocketMonitor=function(b,c,e,f){d.setProtocol(b);d.setProcessId(b.processid);var g=null,h=null,i=a.Deferred(),j=function(a){i.reject(a)},k=!1,l={message:function message(a){var b=/^([^:]*):?([^]*)/.exec(a),c=b[1],g=b[2];if("running"==c){c=e}var i=d.str(c);if(""<g){i+=": "+g}if(null!==h&&!h.isClosed()){h.setLabel(i)}else if(f.getConsole&&f.getConsole().isOpen()){f.getConsole().setMessage(i)}else{d.log("Error: no dialogo. Message not shown: "+i)}},compilation:function compilation(a){if(f.setResult){f.setResult({compilation:a},!1)}},retrieve:function retrieve(){var a={processid:d.getProcessId()};h.close();k=!0;d.requestAction("retrieve","",a,f.ajaxurl).done(function(a){i.resolve();if(f.setResult){f.setResult(a,!0)}}).fail(j)},run:function run(a){h.close();f.run(a,b,g)},close:function close(){d.log("ws close message from jail");g.close();var a={processid:d.getProcessId()};d.requestAction("cancel","",a,f.ajaxurl,!0)}};try{if(d.supportWebSocket()){g=new WebSocket(b.monitorURL)}else{d.log("ws not available");i.reject(d.str("browserupdate"));return i}}catch(a){d.log("ws new say "+a);i.reject(a.message);return i}h=new d.progressBar(c,"connecting",function(){i.reject("Stopped by user");g.close()});g.notOpen=!0;g.onopen=function(){g.notOpen=!1;h.setLabel(d.str("connected"));if(f.open){f.open()}};g.onerror=function(a){d.log("ws error "+a);h.close();if(b.secure&&g.notOpen){d.requestAction("getjails","retrieve",{},f.ajaxurl).done(function(a){d.acceptCertificates(a.servers,function(){return f.getLastAction()})}).fail(j)}else{i.reject(d.str("connection_fail"))}if(f.close){d.delay("externalActions.close",f.close)}};g.onclose=function(){if(f.getConsole){f.getConsole().disconnect()}if(!g.notOpen){h.close();if(!k&&"rejected"!=i.state()){i.resolve()}}if(f.close){f.close()}};g.onmessage=function(a){var b=/^([^:]+):([^]*)/.exec(a.data);if(null!==b){var c=b[1],e=b[2];if(l[c]){l[c](e)}}else{h.setLabel(d.str("error")+": "+a.data)}};d.monitorRunning=function(){return null!==g&&g.readyState!=WebSocket.CLOSED};return i};d.directRun=function(b,e,f){var g=a.Deferred();a.ajax({async:!0,type:"POST",url:b+"directrun",data:JSON.stringify({command:e,files:f}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){if(!a.success){g.reject(a.error)}else{var b=a.response;d.setProtocol(b);var e=new WebSocket(b.executionURL);c.debug("Conecting with:"+b.executionURL);g.resolve({processid:b.processid,homepath:b.homepath,connection:e})}}).fail(function(a,b,d){var e="Connection fail: "+b;if(d.message!=void 0){e+=": "+d.message}c.debug(e);g.reject(e)});return g};d.directRunTest=function(a,b,e){d.directRun(a,b,[{name:"a.c",contents:"int main(){return 0;}",encoding:0},{name:"b.c",contents:"int f(){return 1;}",encoding:0}]).done(function(a){var b=0;a.connection.onopen=function(){c.debug("Ws open "+a.homepath+" processid "+a.processid);if(e!=void 0){a.connection.send(e)}setTimeout(function(){a.connection.close()},600000)};a.connection.onmessage=function(d){c.debug("WS Message ("+ ++b+"): "+d.data);if(10<=b){a.connection.close()}};a.connection.onerror=function(a){c.debug("WS error: "+a)};a.connection.onclose=function(a){c.debug("WS close: "+a.code+" "+a.reason)}}).fail(function(d){c.debug("Direct run fail. URL: "+a+" command: "+b+" message: "+d)})};d.processResult=function(a,b,c,e,f){if("undefined"==typeof a||""==a.replace(/^\s+$/gm,"")){return""}function g(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/,"\\$&")}var p=/^\s*>/,q=new RegExp("\\[err\\]|error|"+g(d.str("error")),"i"),r=new RegExp("\\[warn\\]|warning|note|"+g(d.str("warning")),"i"),s="",t="",u="",v="",w=a.split(/\r\n|\n|\r/),x=[],y=!1,z=!1,A=!1;function h(a){if("undefined"==typeof c[a].getTagId){return"href=\"#\" "}else{return"href=\"#"+c[a].getTagId()+"\" "}}(function(){for(var a=0;a<b.length;a++){var c=g(b[a]);x[a]=new RegExp("(^| |/)"+c+"( on line | line |:|\\()(\\d+)(:|,)?(\\d+)?(\\))?","m")}})();function j(a,e){for(var f=!1,g=0;g<x.length;g++){var j=x[g],k;while(null!==(k=j.exec(a))){var l=c[g].getAnnotations();z=g;f=!0;var m;if(-1<a.search(q)){m="error"}else if(-1<a.search(r)){m="warning"}else if(-1<a.search(/\[info\]|information/i)){m="info"}else{m="error"}y={row:k[3]-1,column:k[5],type:m,text:e};l.push(y);var n=b[g],o=h(g),p=d.sanitizeText(n),s="data-file=\""+n+"\" data-line=\""+k[3]+"\"";a=a.replace(j,"$1<a "+o+" class=\"vpl_fl\" "+s+">"+p+"$2$3$4$5$6</a>");c[g].setAnnotations(l)}}if(!f&&y){if(""!==e){y.text+="\n"+e;c[z].setAnnotations(c[z].getAnnotations())}else{y=!1}}return a}function k(a){y=!1;a=a.substr(1);var b=/\([-]?[\d]+[.]?[\d]*\)\s*$/.exec(a);if(null!==b){a=a.substr(0,a.length-b[0].length)}var c="";if(f){c+="<a href=\"javascript:void(0)\" onclick=\"VPLUtil.showHideDiv(this)\">[+]</a>"}c+="<b class=\"ui-widget-header ui-corner-all\">"+d.sanitizeText(a)+"</b><br>";c=j(c,a);return c}function l(){y=!1;var a=u;u="";return a}function m(a){var b=d.sanitizeText(a);u+=j(b,a)+"<br>"}function n(a){var b=d.sanitizeText(a);v+=j(b,a)+"\n"}function o(){y=!1;var a=v;v="";return"<pre><i>"+a+"</i></pre>"}for(var B=0,C;B<w.length;B++){C=w[B];if(e){t+=j(d.sanitizeText(C),C)+"\n";continue}var D=p.exec(C),E=p.test(C);if(null!==D!=E){d.log("error")}if(/^-.*/.test(C)){switch(s){case"comment":t+=l();break;case"case":t+=o();break;}if(A){t+="</div>"}t+=k(C);t+=f?"<div style=\"display:none\">":"<div>";A=!0;s=""}else if(E){if("comment"==s){t+=l()}n(C.substr(D[0].length));s="case"}else{if("case"==s){t+=o()}m(C);s="comment"}}switch(s){case"comment":t+=l();break;case"case":t+=o();break;}if(A){t+="</div>"}return t};(function(){var a=[];d.loadScript=function(b,c){if(0==b.length){c();return}var e=b[0];if("undefined"==typeof a[e]){b.shift();a[e]=1;var f=document.createElement("script");f.type="text/javascript";f.src=d.options.scriptPath+e;f.onload=function(){a[e]=2;d.loadScript(b,c)};document.head.appendChild(f)}else if(2==a[e]){b.shift();d.loadScript(b,c)}else{d.log("Error loading js "+e+" "+a[e]);setTimeout(function(){d.loadScript(b,c)},50)}};d.isScriptLoading=function(b){if("undefined"==typeof a[b]){return!1}return 1==a[b]};d.isScriptLoaded=function(b){if("undefined"==typeof a[b]){return!1}return 2==a[b]}})();d.adjustBlockly=function(a,b,c){for(var d=a.getAllBlocks(),e=2e4,f=-2e4,g=2e4,h=-2e4,k=0,l;k<d.length;k++){l=d[k].getRelativeToSurfaceXY();e=Math.min(e,l.y);f=Math.max(f,l.y);g=Math.min(g,l.x);h=Math.max(h,l.x)}d=a.getTopBlocks();for(var m=0;m<d.length;m++){d[m].moveBy(b-g,c-e)}return f-e+100+c};(function(){var c=[],e=[],f=[];function b(a,b){var c=this;this.files=a;this.results=b;setTimeout(function(){c.highlight()},10)}b.prototype.highlightBlockly=function(b){d.loadScript(["../editor/blockly/blockly_compressed.js","../editor/blockly/msg/js/en.js","../editor/blockly/blocks_compressed.js"],function(){var e=a("#"+b),f=e.html();a("#"+b+"load").remove();e.html("");e.show();f=a("<div />").html(f).text().replace(/\n/g,"");var g=Blockly.Xml.textToDom(f);e.html("").height(300).width(e.parent().width());var i=Blockly.inject(b,{toolbox:"",readOnly:!0,media:"../editor/blockly/media/"});Blockly.Xml.domToWorkspace(g,i);var j=d.adjustBlockly(i,10,10);e.height(j);e.width("100%");Blockly.svgResize(i);Blockly.resizeSvgContents(i);var k=e.html();i.dispose();e.html(k)})};b.prototype.highlight=function(){for(var b=this,c=!1,e=this.files,g=0,h;g<e.length;g++){h=e[g];if(d.isBinary(h.fileName)||d.isBlockly(h.fileName)){continue}else{c=!0;break}}if(c&&"undefined"==typeof ace){d.loadScript(["../editor/ace9/ace.js"],function(){b.highlight()});return}for(var j=this.results,k=[],l=[],m=0;m<e.length;m++){var n=e[m],o="code"+n.tagId;if(d.isBlockly(n.fileName)){b.highlightBlockly(o);continue}var p=d.fileExtension(n.fileName),q=d.langType(p);a("#"+o).show();a("#"+o+"load").remove();var r=ace.edit(o);r.setTheme("ace/theme/"+n.theme);r.getSession().setMode("ace/mode/"+q);r.renderer.setShowGutter(n.showln);r.setReadOnly(!0);r.setHighlightActiveLine(!1);r.setAutoScrollEditorIntoView(!0);r.setOption("maxLines",n.nl);r.getAnnotations=function(){return this.getSession().getAnnotations()};r.setAnnotations=function(b){return this.getSession().setAnnotations(b)};r.getTagId=function(){return this.vplTagId};r.vplTagId=n.tagId;k.push(r);l.push(n.fileName);f[n.tagId]=r}for(var s=0;s<j.length;s++){var t=document.getElementById(j[s].tagId),u=t.textContent||t.innerText;t.innerHTML=d.processResult(u,l,k,j[s].noFormat,j[s].folding)}};d.addResults=function(a,b,c){e.push({tagId:a,noFormat:b,folding:c})};d.syntaxHighlightFile=function(a,b,d,e,f){c.push({tagId:a,fileName:b,theme:d,showln:e,nl:f})};d.syntaxHighlight=function(){new b(c,e);c=[];e=[]};d.flEventHandler=function(a){var b=a.target.getAttribute("href").substring(1),c=a.target.getAttribute("data-line"),d=f[b];d.gotoLine(c,0);d.scrollToLine(c,!0)};d.setflEventHandler=function(){for(var a=document.getElementsByClassName("vpl_fl"),b=0;b<a.length;b++){a[b].onclick=d.flEventHandler}};d.showHideDiv=function(b){var a=b,c=b;if(!c.nextSibling){c=c.parentNode}c=c.nextSibling;while("DIV"!=c.nodeName&&"PRE"!=c.nodeName){c=c.nextSibling;if(!c){return}}if(a){if("[+]"==a.innerHTML){if(c.savedDisplay){c.style.display=c.savedDisplay}else{c.style.display=""}a.innerHTML="[-]"}else{c.savedDisplay=c.style.display;c.style.display="none";a.innerHTML="[+]"}}}})();d.options={scriptPath:""};if("undefined"!=typeof window.VPLDebugMode){e=window.VPLDebugMode}d.init=function(b){d.options={scriptPath:""};a.extend(d.options,b);if("undefined"!=typeof window.VPLDebugMode){e=window.VPLDebugMode}d.log(d.options)};window.VPLUtil=d;return d});
define ("mod_vpl/vplidebutton",["jquery","jqueryui","mod_vpl/vplutil"],function(a,b,c){var d=function(b,d){var e=this,f={};this.notAdded=function(a){return!f[a]};this.setText=function(b,d,g){if(e.notAdded(b)){return}if(!d){d=f[b].icon}if(!g){g=f[b].title}if(!g){g=c.str(d)}f[b].icon=d;f[b].title=g;if(f[b].hasOwnProperty("key")){g+=" ("+f[b].key+")"}a("#vpl_ide_"+b).attr("title",g);a("#vpl_ide_"+b+" i").replaceWith(c.genIcon(d))};this.setExtracontent=function(b,c){if(e.notAdded(b)){return}var d=a("#vpl_ide_"+b+" i");if(0==d.find(".bt_extrahtml").length){d.append(" <span class=\"bt_extrahtml\"><span>")}d.find(".bt_extrahtml").html(c)};this.add=function(a){if("string"==typeof a){var b=a;a={name:b}}if(!d(a.name)){return}if(!a.hasOwnProperty("icon")){a.icon=a.name}if(!a.hasOwnProperty("title")){a.title=c.str(a.name)}if(!a.hasOwnProperty("active")){a.active=!0}if(!a.hasOwnProperty("editorName")){a.editorName=a.name}if(!a.hasOwnProperty("originalAction")){a.originalAction=c.doNothing}if(e.notAdded(a.name)){f[a.name]=a}else{throw new Error("Button already set "+a.name)}e.setAction(a.name,a.originalAction);if(a.hasOwnProperty("bindKey")){a.command={name:a.editorName,bindKey:a.bindKey,exec:a.action};var g="win";if(navigator.platform.startsWith("Mac")){g="mac"}a.key=a.bindKey[g]}};this.getHTML=function(a){if(e.notAdded(a)){return""}else{var b=f[a].title;if(f[a].hasOwnProperty("key")){b+=" ("+f[a].key+")"}var d="<a id='vpl_ide_"+a+"' href='#' title='"+b+"'>";d+=c.genIcon(a)+"</a>";return d}};this.enable=function(b,c){if(e.notAdded(b)){return}var d=a("#vpl_ide_"+b);f[b].active=c;d.data("vpl-active",c);if(!c){d.addClass("ui-button-disabled ui-state-disabled")}else{d.removeClass("ui-button-disabled ui-state-disabled")}};this.setAction=function(a,b){if(e.notAdded(a)){return}f[a].originalAction=b;f[a].action=function(){if(f[a].active){b()}}};this.getAction=function(a){if(e.notAdded(a)){return c.doNothing}return f[a].action};this.launchAction=function(a){if(e.notAdded(a)){return}f[a].originalAction()};this.setGetkeys=function(a){if(!a){return}var b=a.commands.commands,c=a.commands.platform;for(var d in f){if(f.hasOwnProperty(d)){var g=f[d].editorName;if(b[g]&&b[g].bindKey&&!f[d].Key){f[d].key=b[g].bindKey[c];e.setText(d)}else{if(f[d].bindKey&&!f[d].hasOwnProperty("key")){f[d].key=f[d].bindKey[c];e.setText(d)}}}}};this.getShortcuts=function(a){var b="<ul>";for(var d in f){if(f[d].hasOwnProperty("key")){b+="<li>";b+=f[d].title+" ("+f[d].key+")";b+="</li>"}}b+="</ul>";if(a){b+="<h5>"+c.str("edit")+"</h5>";var e=a.commands.commands,g=a.commands.platform;b+="<ul>";for(var h in e){if(e[h].hasOwnProperty("bindKey")&&""<e[h].bindKey[g]){b+="<li>";b+=h+" ("+e[h].bindKey[g]+")";b+="</li>"}}b+="</ul>"}if("<ul></ul>"==b){return""}return b};a(b).on("click","a",function(b){if(a(this).data("vpl-active")){var c=a(this).attr("id");if("string"==typeof c&&c.startsWith("vpl_ide_")){c=c.replace("vpl_ide_","")}else{return!0}if(e.notAdded(c)){return!0}if(f[c]&&!f[c].active){return!0}var d=e.getAction(c);if("import"!=c){setTimeout(d,10)}else{d()}}b.stopImmediatePropagation();return!1});a("body").on("keydown",function(a){var b=!1,c="";if(a.shiftKey){c+="shift-"}if(a.altKey){c+="alt-";b=!0}if(a.ctrlKey){c+="ctrl-";b=!0}if(a.metaKey){c+="meta-";b=!0}if(112<=a.which&&123>=a.which){c+="f"+(a.which-111);b=!0}else{var d=String.fromCharCode(a.which).toLowerCase();if("a">d||"z"<d){b=!1}else{c+=d}}if(b){for(var e in f){if(f[e].hasOwnProperty("key")){if(c==f[e].key.toLowerCase()){a.preventDefault();a.stopImmediatePropagation();f[e].action();return!1}}}}return!0});this.multiple=function(a,b){return a-a%b};(function(){var b=0,d=0,f=!1,g=3600,h=!1,i=null,j=5,k=1e3,l=0,m=function(a){j=5;k=1e3;if(a>g){j=60;k=5e3}else if(a>24*g){j=300;k=25000}},n=function(){var a=e.multiple(c.getCurrentTime(),j);if(a===d||null===i){return}d=a;var f=l-(d-b),g="";if(0>=f){g="vpl_buttonleft_black"}else if(f<=300){h=!0;g="vpl_buttonleft_red"}else if(f<=900){g="vpl_buttonleft_orange"}else{m(f)}var k="<span class=\""+g+"\">"+c.genIcon("timeleft");if(h){k+=" "+c.getTimeLeft(f)}k+="</span>";i.html(k);i.removeClass("vpl_buttonleft_orange vpl_buttonleft_red vpl_buttonleft_black");i.addClass(g)};e.toggleTimeLeft=function(){h=!h;d=0;n()};e.setTimeLeft=function(g){i=a("#vpl_ide_timeleft");if(!1!==f){clearInterval(f);f=!1}if(g.hasOwnProperty("timeLeft")){l=g.timeLeft;m(l);var h=l%j;l=e.multiple(l,j);b=e.multiple(c.getCurrentTime(),j);d=b-j;setTimeout(function(){f=setInterval(n,k)},1e3*h);a("#vpl_ide_timeleft").show();n()}else{a("#vpl_ide_timeleft").hide()}}})()};window.VPLIDEButtons=d;return d});
define ("mod_vpl/vplterminal",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplclipboard"],function(a,b,c,d){var e=function(b,e,f){var m=this,n=null,o=c.doNothing,p="",q="",r=a("#"+b),s=a("#vplide"),t="",u=null,v=64e3,w="",x,y=a("#"+e);this.updateTitle=function(){var a=p;if(""!==q){a+=" ("+q+")"}t.text(f("console")+": "+a)};this.setTitle=function(a){p=a;this.updateTitle()};this.setMessage=function(a){q=a;this.updateTitle()};function g(a){w+=a;if(w.length>v){var b=w.length-v/2;w=w.substr(b)}}function h(){if(n&&n.readyState==n.OPEN){n.send(u.getEntry2())}}function i(){u.setEntry1(w)}function j(){i();u.show()}this.write=function(a){x.write(a);return a};this.connect=function(a,b){o=b;if("WebSocket"in window){x.reset();x.startBlink();m.show();if(n){n.close()}w="";m.setMessage("");m.setTitle(f("connecting"));n=new WebSocket(a);n.writeBuffer="";n.writeIt=function(){x.write(n.writeBuffer);g(n.writeBuffer);n.writeBuffer=""};n.onmessage=function(a){if(0<n.writeBuffer.length){n.writeBuffer+=a.data}else{n.writeBuffer=a.data;setTimeout(n.writeIt,35)}};n.onopen=function(){m.setMessage("");m.setTitle(f("connected"))};n.onclose=function(){m.setTitle(f("connection_closed"));x.blur();x.stopBlink();b();n.stopOutput=!0}}else{x.write("WebSocket not available: Upgrade your browser")}};this.writeLocal=function(a){n.onmessage({data:a});return a};this.setDataCallback=function(a){n.onData=a};this.closeLocal=function(){if(n){n.writeIt();n.close();x.stopBlink();m.setTitle(f("connection_closed"))}};this.connectLocal=function(a,b){o=a;x.reset();x.startBlink();m.show();if(n){n.close()}w="";m.setMessage("");m.setTitle(f("running"));n={};n.onData=b;n.writeBuffer="";n.readBuffer="";n.readyState=1;n.OPEN=1;n.close=function(){n=!1};n.onmessage=function(a){n.writeBuffer=a.data;n.writeIt()};n.writeIt=function(){if(n){x.write(n.writeBuffer);g(n.writeBuffer);n.writeBuffer=""}};n.send=function(a){if("\x7F"==a){if(0<n.readBuffer.length){m.writeLocal("\b \b");n.readBuffer=n.readBuffer.substr(0,n.readBuffer.length-1)}}else{m.writeLocal(a);n.readBuffer+=a}var b=n.readBuffer.indexOf("\r");if(-1!=b){var c=n.readBuffer.substr(0,b);n.readBuffer=n.readBuffer.substr(b+1);n.onData(c)}}};this.isOpen=function(){return r.dialog("isOpen")};this.close=function(){r.dialog("close")};this.isConnected=function(){return n&&n.readyState!=n.CLOSED};this.disconnect=function(){if(n&&n.readyState==n.OPEN){o();if(n){n.close()}x.stopBlink()}};var z=c.genIcon("copy","sw")+" "+f("copy"),A=c.genIcon("paste","sw")+" "+f("paste");u=new d("vpl_dialog_terminal_clipboard",z,function(){i();document.execCommand("copy")},A,h);this.closeDialog=function(){u.hide();m.disconnect()};function k(a){r.data("terminal_theme",a);c.setUserPreferences({terminalTheme:a});for(var b=0;b<5;b++){r.removeClass("vpl_terminal_theme"+b)}r.addClass("vpl_terminal_theme"+a)}function l(){var a=s.width(),b=s.height();if(r.width()>a){r.dialog("option","width",a)}if(r.parent().height()>b){r.dialog("option","height",b-r.prev().outerHeight())}}r.dialog({closeOnEscape:!1,autoOpen:!1,width:"auto",height:"auto",resizable:!0,dragStop:l,open:l,focus:function focus(){l();x.focus()},dialogClass:"vpl_ide vpl_vnc",create:function create(){t=c.setTitleBar(r,"console","console",["clipboard","keyboard","theme"],[j,function(){x.focus()},function(){var a=(r.data("terminal_theme")+1)%5;k(a)}])},close:function close(){m.closeDialog()},resizeStop:function resizeStop(){r.width(r.parent().width());r.height(r.parent().height()-r.prev().outerHeight());l();x.focus()}});this.setFontSize=function(a){y.css("font-size",a+"px")};c.getUserPreferences(function(a){k(a.preferences.terminalTheme)});r.css("padding","1px");r.parent().css("z-index",2e3);this.show=function(){r.dialog("open");x.focus()};this.init=function(){if("undefined"==typeof Terminal){c.loadScript(["../../vpl/editor/xterm/term.js"],function(){m.init()});return}x=new Terminal({cols:80,rows:24,useStyle:!0,screenKeys:!0});x.on("data",function(a){if(n&&n.readyState==n.OPEN){n.send(a)}});x.open(y[0]);x.reset();x.stopBlink();x.setLineCallback(function(a,b){var c=y.height(),d=r.scrollTop(),e=r.innerHeight();if(e>=c){return}var f=c/b,g=a*f;if(g>=d&&g<e+d-f){return}if(g<d){r.scrollTop(g)}else{r.scrollTop(g-e+2*f)}})};this.init()};window.VPLTerminal=e;return e});
function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("mod_vpl/vplideblocklyfile",["jquery","mod_vpl/vplutil"],function(a,b){return function(){var c=this,d=this.getVPLIDE();this.firstContent=!0;this.workspaceInstance=!1;var e=function(){if("undefined"==typeof Blockly.PHP.workspaceToCodeOld){Blockly.PHP.workspaceToCodeOld=Blockly.PHP.workspaceToCode;Blockly.PHP.workspaceToCode=function(a){return"<?php\n"+Blockly.PHP.workspaceToCodeOld(a)}}if("undefined"==typeof Blockly.Python.workspaceToCodeOld){Blockly.Python.workspaceToCodeOld=Blockly.Python.workspaceToCode;Blockly.Python.workspaceToCode=function(a){return"# -*- coding: utf-8 -*-\n"+Blockly.Python.workspaceToCodeOld(a)}}},f=this.adjustSize;this.adjustSize=function(){if(f.call(this)){var b=a(this.getTId());if(0===b.length){return!1}var c=b.parent(),d=c.height();d-=b.position().top;b.height(d);a("#"+this.bdiv).height(d);a("#"+this.bdiv).width(b.width());Blockly.svgResize(this.workspaceInstance);return!1}return!1};this.undo=function(){if(this.isOpen()){this.workspaceInstance.undo(!1)}};this.redo=function(){if(this.isOpen()){this.workspaceInstance.undo(!0)}};this.interpreter=!1;this.animateRun=!1;this.RUNSTATE=1;this.STEPSTATE=2;this.STOPSTATE=3;this.executionState=this.STOPSTATE;this.goNext=!1;this.initRun=function(a){var e=d.getTerminal();if(e.isConnected()){e.closeLocal()}this.animateRun=a;Blockly.JavaScript.STATEMENT_PREFIX="highlightBlock(%1);\n";Blockly.JavaScript.addReservedWords("highlightBlock");var f=Blockly.JavaScript.workspaceToCode(c.workspaceInstance);c.interpreter=new Interpreter(f,function initApi(a,f){a.setProperty(f,"alert",a.createNativeFunction(function wrapperAlert(b){b="string"!=typeof b?b.toString()+"\r\n":b+"\r\n";return a.createPrimitive(e.writeLocal(b))}));a.setProperty(f,"prompt",a.createAsyncFunction(function wrapperPrompt(a,b){a="string"!=typeof a?a.toString():""+a;e.writeLocal(a);e.setDataCallback(function(a){e.writeLocal("\n");b(a)})}));a.setProperty(f,"highlightBlock",a.createNativeFunction(function wrapperHighlightBlock(a){if(a==c.getBreakpoint()){c.executionState=c.STEPSTATE;c.updateRunButtons();d.getTerminal().setMessage(b.str("breakpoint"))}if(c.animateRun||c.executionState==c.STEPSTATE){c.workspaceInstance.highlightBlock(a)}c.goNext=!1}))});e.connectLocal(c.stop,b.doNothing)};this.reservedWords={Infinity:!0,Array:!0,Boolean:!0,Date:!0,Error:!0,EvalError:!0,Function:!0,JSON:!0,Math:!0,NaN:!0,Number:!0,Object:!0,RangeError:!0,ReferenceError:!0,RegExp:!0,String:!0,SyntaxError:!0,TypeError:!0,URIError:!0,alert:!0,arguments:!0,constructor:!0,eval:!0,highlightBlock:!0,isFinite:!0,isNaN:!0,parseFloat:!0,parseInt:!0,prompt:!0,self:!0,this:!0,window:!0};(function(){var a=null,b=null;c.getBreakpoint=function(){return a};c.setBreakpoint=function(){a=b};c.removeBreakpoint=function(){a=null};c.setLastSelection=function(a){b=a};c.isSelectingBreakpoint=function(){return null===a&&null!==b}})();this.getVarValue=function(a){var d="";if(null===a){d="<b>null</b>"}else if(a!=void 0){var e=_typeof(a);if("string"==e){d="\""+b.sanitizeText(a)+"\""}else if("boolean"==e){d="<b>"+a+"</b>"}else if("object"==e&&"Array"===a.class){d="[";for(var f=a.properties,g=0;g<f.length;g++){d+=c.getVarValue(f[g]);if(g!=f.length-1){d+=", "}}d+="]"}else if("object"==e){d="<b>"+a.toString()+"</b>"}else{d+=""+a}}return d};this.getVariables=function(a){var d="";for(var e in a){if(!0===this.reservedWords[e]){continue}var f=a[e];if(f!=void 0&&!("Function"===f.class)){var g=b.sanitizeText(c.getVarValue(f));d+="<b>"+e+"</b>:&nbsp;"+g+"<br>\n"}}return d};this.getParameters=function(a){for(var b="(",c=0;c<a.length;c++){b+=""+a[c];if(c<a.length-1){b+=", "}}return b+")"};this.showStack=function(a){for(var b=0,e="<table class=\"generaltable\">",f=a.stateStack,g="<tr><td>0</td><td><b>Globals</b></td>",h=0,j;h<f.length;h++){j=f[h];if(""<g&&("CallExpression"==j.node.type||h==f.length-1)){e+=g+"<td>"+c.getVariables(j.scope.properties);e+="</td></tr>"}if("CallExpression"==j.node.type){if(!0!==c.reservedWords[j.node.callee.name]&&j.node.callee.name!=void 0){b++;g="<tr><td>"+b+"</td>";g+="<td>"+j.node.callee.name+c.getParameters(j.arguments_)+"</td>"}else{g=""}}}e+="</table>";d.setResult({variables:e})};this.runLoop=function(){if(!c.interpreter){return}c.goNext=!0;for(var a=0;3e4>a&&c.goNext;a++){if(c.executionState==c.STOPSTATE){break}if(!c.interpreter||!c.interpreter.step()){c.executionState=c.STOPSTATE;c.updateRunButtons();break}}if(c.executionState==c.STOPSTATE){c.workspaceInstance.highlightBlock(-1);d.getTerminal().closeLocal();d.setResult({variables:""});return}if(c.executionState==c.RUNSTATE){if(c.animateRun){setTimeout(c.runLoop,1e3);c.showStack(c.interpreter)}else{setTimeout(c.runLoop,0)}}else{c.showStack(c.interpreter)}};this.start=function(){if(c.executionState!=c.STOPSTATE){return}c.initRun(!1);c.executionState=c.RUNSTATE;c.updateRunButtons();d.getTerminal().setMessage(b.str("start"));c.runLoop()};this.startAnimate=function(){if(c.executionState!=c.STOPSTATE){return}c.initRun(!0);c.executionState=c.RUNSTATE;c.updateRunButtons();d.getTerminal().setMessage(b.str("startanimate"));c.runLoop()};this.stop=function(){c.executionState=c.STOPSTATE;c.workspaceInstance.highlightBlock(-1);c.updateRunButtons();d.getTerminal().setMessage(b.str("stop"));d.getTerminal().closeLocal();c.interpreter=!1;d.setResult({variables:""})};this.pause=function(){if(c.executionState!=c.RUNSTATE){return}c.executionState=c.STEPSTATE;d.getTerminal().setMessage(b.str("pause"));c.updateRunButtons()};this.resume=function(){if(c.executionState!=c.STEPSTATE){return}c.executionState=c.RUNSTATE;d.getTerminal().setMessage(b.str("resume"));c.updateRunButtons();c.runLoop()};this.step=function(){if(c.executionState==c.STOPSTATE){c.initRun(!0)}c.executionState=c.STEPSTATE;c.updateRunButtons();d.getTerminal().setMessage(b.str("step"));c.runLoop()};this.hasUndo=function(){return!0};this.hasRedo=function(){return!0};this.oldSetFileName=this.setFileName;this.generatorMap={py:"Python",dart:"Dart",js:"JavaScript",lua:"Lua",php:"PHP"};this.generator="";this.setFileName=function(a){var d=this.getFileName(),e=b.fileExtension(d);if(!c.oldSetFileName(a)){b.log("Blockly setFileName: name no acepted "+a);return!1}b.log("Blockly set filename "+a);var f=/\.([^.]+)\.blockly[123]?$/.exec(a),g=/(.+)\.blockly[123]?$/.exec(a);if(null!==f&&null!==g&&"string"==typeof this.generatorMap[f[1]]){this.generator=this.generatorMap[f[1]];this.generatedFilename=g[1];b.log("Blockly generator "+this.generator+" for filename "+this.generatedFilename);this.updateGeneratedCode()}else{this.generator=""}if(e!=b.fileExtension(a)){b.log("Blockly extension changed");b.afterAll("reopenBlockly",function(){b.log("reopenBlockly");c.close();c.open()})}return!0};this.updateGeneratedCode=function(){if(c.blocklyNotLoaded){return}var a=c.getFileManager();if(""!=c.generator){b.log("Blockly generate "+c.generator);var d=Blockly[c.generator].workspaceToCode(c.workspaceInstance),e=a.fileNameExists(c.generatedFilename);if(-1==e){b.log("try to create "+c.generatedFilename+" files");a.addFile({name:c.generatedFilename,contents:""},!1,b.doNothing,b.doNothing);e=a.fileNameExists(c.generatedFilename)}if(-1!=e){var f=a.getFile(e);if(f.getContent()!=d){f.setContent(d);f.change();f.gotoLine(1);f.setReadOnly(!0)}}}};this.changeCode=function(a){b.log(a);if("ui"==a.type&&"selected"==a.element){c.setLastSelection(a.newValue);return}if("ui"==a.type&&"category"==a.element&&a.newValue==b.str("run")){b.longDelay("updateRunButtons",c.updateRunButtons);return}if(c.firstContent){if("finished_loading"==a.type){c.firstContent=!1;c.workspaceInstance.clearUndo()}else{return}}if(!a.recordUndo){return}b.log("Call change due changeCode");c.change();if(""!=c.generator){b.afterAll("generate"+c.getFileName(),c.updateGeneratedCode)}};var g=0;this.updateRunButtons=function(){if(0==a(".blocklySelectBreakpointC").length){g++;if(g>20){g=0;b.log("Giving up to tries of updateRunButtons");return}b.longDelay("updateRunButtons",c.updateRunButtons);return}b.log("updateRunButtons");g=0;if(c.isSelectingBreakpoint()){a(".blocklySelectBreakpointC").removeClass("vpl_dimmed")}else{a(".blocklySelectBreakpointC").addClass("vpl_dimmed")}if(null===c.getBreakpoint()){a(".blocklyRemoveBreakpointC").addClass("vpl_dimmed")}else{a(".blocklyRemoveBreakpointC").removeClass("vpl_dimmed")}switch(c.executionState){case c.RUNSTATE:{a(".blocklyStartC").addClass("vpl_dimmed");a(".blocklyStartAnimateC").addClass("vpl_dimmed");a(".blocklyStopC").removeClass("vpl_dimmed");a(".blocklyPauseC").removeClass("vpl_dimmed");a(".blocklyResumeC").addClass("vpl_dimmed");a(".blocklyStepC").addClass("vpl_dimmed");break}case c.STEPSTATE:{a(".blocklyStartC").addClass("vpl_dimmed");a(".blocklyStartAnimateC").addClass("vpl_dimmed");a(".blocklyStopC").removeClass("vpl_dimmed");a(".blocklyPauseC").addClass("vpl_dimmed");a(".blocklyResumeC").removeClass("vpl_dimmed");a(".blocklyStepC").removeClass("vpl_dimmed");break}case c.STOPSTATE:{a(".blocklyStartC").removeClass("vpl_dimmed");a(".blocklyStartAnimateC").removeClass("vpl_dimmed");a(".blocklyStopC").addClass("vpl_dimmed");a(".blocklyPauseC").addClass("vpl_dimmed");a(".blocklyResumeC").addClass("vpl_dimmed");a(".blocklyStepC").removeClass("vpl_dimmed");break}}};this.setToolbox=function(){var d=b.fileExtension(this.getFileName()),e=d+"Toolbox";if(!1===c[e]){a.ajax({url:"../editor/blocklytoolboxes/"+e+".xml",dataType:"text",success:function success(a){c[e]=c.blocklyIn18(a);c.setToolbox()}});return}var f=function(a){return function(){a();c.updateRunButtons()}},g={blocklyStartButton:this.start,blocklyStartAnimateButton:this.startAnimate,blocklyStopButton:this.stop,blocklyPauseButton:this.pause,blocklyResumeButton:this.resume,blocklyStepButton:this.step,blocklySelectBreakpointButton:this.setBreakpoint,blocklyRemoveBreakpointButton:this.removeBreakpoint},h=this.workspaceInstance;h.updateToolbox(this[e]);for(var i in g){h.registerButtonCallback(i,f(g[i]))}this.adjustSize()};this.open=function(){this.showFileName();if(c.blocklyNotLoaded){b.loadScript(["../editor/blockly/blockly_compressed.js","../editor/blockly/msg/js/en.js","../editor/blockly/blocks_compressed.js","../editor/blockly/python_compressed.js","../editor/blockly/javascript_compressed.js","../editor/blockly/php_compressed.js","../editor/blockly/lua_compressed.js","../editor/blockly/dart_compressed.js","../editor/acorn/acorn.js","../editor/acorn/interpreter.js"],function(){b.log("Blocklyloaded",!0);e();c.blocklyNotLoaded=!1;c.open()});return!1}var d=this.getContent();this.setOpen(!0);var f=this.getFileName(),g=!1;if(/.*[0-9]$/.test(b.fileExtension(f))){g=!0}var h=this.getTId();a(h).removeClass("ui-widget-content ui-tabs-panel");a(h).addClass("ui-corner-bottom");this.bdiv="bkdiv"+this.getId();a(h).html("<div id=\""+this.bdiv+"\" style=\"height: 480px; width: 600px;\"></div>");var i={toolbox:"<xml><category name=\"\" colour=\"330\"><block type=\"math_number\"></block></category></xml>",media:"../editor/blockly/media/",horizontalLayout:g,zoom:{controls:!0,wheel:!0,startScale:1,maxScale:3,minScale:.2,scaleSpeed:.3}};this.workspaceInstance=Blockly.inject(this.bdiv,i);this.setToolbox();this.firstContent=!0;c.workspaceInstance.addChangeListener(c.changeCode);this.setContent(d);b.adjustBlockly(c.workspaceInstance,10,10);c.workspaceInstance.scrollX=0;c.workspaceInstance.scrollY=0;Blockly.svgResize(c.workspaceInstance);Blockly.resizeSvgContents(c.workspaceInstance);c.adjustSize();return!1};var h=this.getContent;this.getContent=function(){if(!this.isOpen()){return h.call(this)}var a=Blockly.Xml.workspaceToDom(this.workspaceInstance),b=Blockly.Xml.domToPrettyText(a);return b};var i=this.setContent;this.setContent=function(a){i.call(this,a);if(0<a.length&&this.isOpen()){this.workspaceInstance.clear();var b=Blockly.Xml.textToDom(a);Blockly.Xml.domToWorkspace(b,this.workspaceInstance)}};this.close=function(){if(this.isOpen()){i.call(this,this.getContent());this.workspaceInstance.dispose();this.workspaceInstance=!1;this.setOpen(!1)}};this.blocklyNotLoaded=!0;this.blocklyToolbox=!1;this.blockly0Toolbox=!1;this.blockly1Toolbox=!1;this.blockly2Toolbox=!1;this.blockly3Toolbox=!1;this.blocklyStrs=["basic","intermediate","advanced","variables","operatorsvalues","control","inputoutput","functions","lists","math","text","run","start","startanimate","stop","pause","resume","step","breakpoint","selectbreakpoint","removebreakpoint"];this.blocklyIn18=function(a){for(var c=this.blocklyStrs.length,d=0;d<c;d++){var e=this.blocklyStrs[d],f=new RegExp("\\[\\["+e+"\\]\\]","g"),g=b.str(e);a=a.replace(f,g)}return a}}});
/**
 * Sets the equal height to the user plan widget boxes.
 *
 * @module      mod_workshop/workshopview
 * @category    output
 * @copyright   Loc Nguyen <loc.nguyendinh@harveynash.vn>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_workshop/workshopview",["jquery"],(function($){function equalHeight(group){var tallest=0;group.height("auto"),group.each((function(){var thisHeight=$(this).height();thisHeight>tallest&&(tallest=thisHeight)})),group.height(tallest)}return{init:function(){var $dt=$(".path-mod-workshop .userplan dt"),$dd=$(".path-mod-workshop .userplan dd");equalHeight($dt),equalHeight($dd),$(window).on("resize",(function(){equalHeight($dt),equalHeight($dd)}))}}}));
/**
 * Additional javascript for the Workshop module form.
 *
 * @module      mod_workshop/modform
 * @copyright   The Open University 2018
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_workshop/modform",["jquery"],(function($){var submissionTypes={text:{available:null,required:null,requiredHidden:null},file:{available:null,required:null,requiredHidden:null}};function checkAvailability(checkUnavailable,checkAvailable){checkUnavailable.available.prop("checked")||(checkUnavailable.required.prop("disabled",!0),checkUnavailable.required.prop("checked",!1),checkAvailable.available.prop("checked")&&(checkAvailable.required.prop("disabled",!0),checkAvailable.required.prop("checked",!0),checkAvailable.requiredHidden.val(1)))}function enableRequired(submissionType){submissionType.required.prop("disabled",!1),submissionType.required.prop("checked",!1),submissionType.requiredHidden.val(0)}function submissionTypeChanged(){checkAvailability(submissionTypes.file,submissionTypes.text),checkAvailability(submissionTypes.text,submissionTypes.file),submissionTypes.text.available.prop("checked")&&submissionTypes.file.available.prop("checked")&&(enableRequired(submissionTypes.text),enableRequired(submissionTypes.file))}return{init:function(){submissionTypes.text.available=$("#id_submissiontypetextavailable"),submissionTypes.text.required=$("#id_submissiontypetextrequired"),submissionTypes.text.requiredHidden=$('input[name="submissiontypetextrequired"][type="hidden"]'),submissionTypes.file.available=$("#id_submissiontypefileavailable"),submissionTypes.file.required=$("#id_submissiontypefilerequired"),submissionTypes.file.requiredHidden=$('input[name="submissiontypefilerequired"][type="hidden"]'),submissionTypes.text.available.on("change",submissionTypeChanged),submissionTypes.file.available.on("change",submissionTypeChanged),submissionTypeChanged()}}}));
define ("enrol_apply/manage",["jquery"],function(a){return{init:function init(){a("#toggleall").on("change",function(){a("input[name=\"userenrolments[]\"]").prop("checked",a("#toggleall").prop("checked"))});a("#formaction").on("change",function(){a("#enrol_apply_manage_form").submit()})}}});
/**
 * Potential user selector module.
 *
 * @module     enrol_manual/form-potential-user-selector
 * @class      form-potential-user-selector
 * @package    enrol_manual
 * @copyright  2016 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("enrol_manual/form-potential-user-selector",["jquery","core/ajax","core/templates","core/str"],(function($,Ajax,Templates,Str){return{processResults:function(selector,results){var users=[];return $.isArray(results)?($.each(results,(function(index,user){users.push({value:user.id,label:user._label})})),users):results},transport:function(selector,query,success,failure){var courseid=$(selector).attr("courseid"),userfields=$(selector).attr("userfields").split(",");void 0===courseid&&(courseid="1");var enrolid=$(selector).attr("enrolid");void 0===enrolid&&(enrolid="");var perpage=parseInt($(selector).attr("perpage"));isNaN(perpage)&&(perpage=100),Ajax.call([{methodname:"core_enrol_get_potential_users",args:{courseid:courseid,enrolid:enrolid,search:query,searchanywhere:!0,page:0,perpage:perpage+1}}])[0].then((function(results){var promises=[],i=0;return results.length<=perpage?($.each(results,(function(index,user){var ctx=user,identity=[];$.each(userfields,(function(i,k){void 0!==user[k]&&""!==user[k]&&(ctx.hasidentity=!0,identity.push(user[k]))})),ctx.identity=identity.join(", "),promises.push(Templates.render("enrol_manual/form-user-selector-suggestion",ctx))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results,(function(index,user){user._label=args[i],i++})),success(results)}))):Str.get_string("toomanyuserstoshow","core",">"+perpage).then((function(toomanyuserstoshow){success(toomanyuserstoshow)}))})).fail(failure)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("enrol_manual/quickenrolment",["exports","core_table/dynamic","core/str","core/toast","core/config","core/fragment","core/modal_events","core/modal_factory","core/notification","jquery","core/pending","core/prefetch"],(function(_exports,DynamicTable,Str,Toast,_config,_fragment,_modal_events,_modal_factory,_notification,_jquery,_pending,_prefetch){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,DynamicTable=_interopRequireWildcard(DynamicTable),Str=_interopRequireWildcard(Str),Toast=_interopRequireWildcard(Toast),_config=_interopRequireDefault(_config),_fragment=_interopRequireDefault(_fragment),_modal_events=_interopRequireDefault(_modal_events),_modal_factory=_interopRequireDefault(_modal_factory),_notification=_interopRequireDefault(_notification),_jquery=_interopRequireDefault(_jquery),_pending=_interopRequireDefault(_pending),_prefetch=_interopRequireDefault(_prefetch);var Selectors_cohortSelector="#id_cohortlist",Selectors_triggerButtons=".enrolusersbutton.enrol_manual_plugin [type='submit']",Selectors_unwantedHiddenFields="input[value='_qf__force_multiselect_submission']",Selectors_buttonWrapper='[data-region="wrapper"]',getBodyForContext=function(contextId){return _fragment.default.loadFragment("enrol_manual","enrol_users_form",contextId,{})},registerEventListeners=function(contextId){document.addEventListener("click",(function(e){if(e.target.closest(Selectors_triggerButtons))return e.preventDefault(),void showModal((element=e.target,wrapper=element.closest(Selectors_buttonWrapper),DynamicTable.getTableFromId(wrapper.dataset.tableUniqueid)),contextId);var element,wrapper}))},showModal=function(dynamicTable,contextId){var pendingPromise=new _pending.default("enrol_manual/quickenrolment:showModal");return _modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,large:!0,title:Str.get_string("enrolusers","enrol_manual"),body:getBodyForContext(contextId),buttons:{save:Str.get_string("enrolusers","enrol_manual")}}).then((function(modal){return modal.getRoot().on(_modal_events.default.save,(function(e){e.preventDefault(),modal.getRoot().find("form").submit()})),modal.getRoot().on("submit","form",(function(e){e.preventDefault(),submitFormAjax(dynamicTable,modal)})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show(),modal})).then((function(modal){return Promise.all([modal,modal.getBodyPromise()])})).then((function(_ref){var _ref2=_slicedToArray(_ref,2),modal=_ref2[0];return _ref2[1].get(0).querySelector(Selectors_cohortSelector)?modal.setSaveButtonText(Str.get_string("enroluserscohorts","enrol_manual")).then((function(){return modal})):modal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(_notification.default.exception)},submitFormAjax=function(dynamicTable,modal){var form=modal.getRoot().find("form");form.get(0).querySelectorAll(Selectors_unwantedHiddenFields).forEach((function(hiddenField){return hiddenField.remove()})),modal.hide(),modal.destroy(),_jquery.default.ajax("".concat(_config.default.wwwroot,"/enrol/manual/ajax.php?").concat(form.serialize()),{type:"GET",processData:!1,contentType:"application/json"}).then((function(response){if(response.error)throw new Error(response.error);return response.count})).then((function(count){return Promise.all([Str.get_string("totalenrolledusers","enrol",count),DynamicTable.refreshTableContent(dynamicTable)])})).then((function(_ref3){return _slicedToArray(_ref3,1)[0]})).then((function(notificationBody){return Toast.add(notificationBody)})).catch((function(error){_notification.default.addNotification({message:error.message,type:"error"})}))};_exports.init=function(_ref5){var contextid=_ref5.contextid;registerEventListeners(contextid),_prefetch.default.prefetchStrings("enrol_manual",["enrolusers","enroluserscohorts"]),_prefetch.default.prefetchString("enrol","totalenrolledusers")}}));
/**
 * Retrieves notifications from the server.
 *
 * @module     message_popup/notification_repository
 * @class      notification_repository
 * @package    message_popup
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("message_popup/notification_repository",["core/ajax","core/notification"],(function(Ajax,Notification){return{query:function(args){void 0===args.limit&&(args.limit=20),void 0===args.offset&&(args.offset=0);var request={methodname:"message_popup_get_popup_notifications",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},countUnread:function(args){var request={methodname:"message_popup_get_unread_popup_notification_count",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},markAllAsRead:function(args){var request={methodname:"core_message_mark_all_notifications_as_read",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},markAsRead:function(id,timeread){var args={notificationid:id};timeread&&(args.timeread=timeread);var request={methodname:"core_message_mark_notification_read",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise}}}));
/**
 * Controls the notification popover in the nav bar.
 *
 * See template: message_popup/notification_popover
 *
 * @module     message_popup/notification_popover_controller
 * @class      notification_popover_controller
 * @package    message_popup
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("message_popup/notification_popover_controller",["jquery","core/ajax","core/templates","core/str","core/url","core/notification","core/custom_interaction_events","core/popover_region_controller","message_popup/notification_repository","message_popup/notification_area_events"],(function($,Ajax,Templates,Str,URL,DebugNotification,CustomEvents,PopoverController,NotificationRepo,NotificationAreaEvents){var SELECTORS_MARK_ALL_READ_BUTTON='[data-action="mark-all-read"]',SELECTORS_ALL_NOTIFICATIONS_CONTAINER='[data-region="all-notifications"]',SELECTORS_NOTIFICATION='[data-region="notification-content-item-container"]',SELECTORS_UNREAD_NOTIFICATION='[data-region="notification-content-item-container"].unread',SELECTORS_NOTIFICATION_LINK='[data-action="content-item-link"]',SELECTORS_COUNT_CONTAINER='[data-region="count-container"]',NotificationPopoverController=function(element){PopoverController.call(this,element),this.markAllReadButton=this.root.find(SELECTORS_MARK_ALL_READ_BUTTON),this.unreadCount=0,this.lastQueried=0,this.userId=this.root.attr("data-userid"),this.container=this.root.find(SELECTORS_ALL_NOTIFICATIONS_CONTAINER),this.limit=20,this.offset=0,this.loadedAll=!1,this.initialLoad=!1,this.unreadCount=this.root.find(SELECTORS_COUNT_CONTAINER).html()};return(NotificationPopoverController.prototype=Object.create(PopoverController.prototype)).constructor=NotificationPopoverController,NotificationPopoverController.prototype.updateButtonAriaLabel=function(){this.isMenuOpen()?Str.get_string("hidenotificationwindow","message").done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this)):this.unreadCount?Str.get_string("shownotificationwindowwithcount","message",this.unreadCount).done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this)):Str.get_string("shownotificationwindownonew","message").done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this))},NotificationPopoverController.prototype.getContent=function(){return this.container},NotificationPopoverController.prototype.getOffset=function(){return this.offset},NotificationPopoverController.prototype.incrementOffset=function(){this.offset+=this.limit},NotificationPopoverController.prototype.hasDoneInitialLoad=function(){return this.initialLoad},NotificationPopoverController.prototype.hasLoadedAllContent=function(){return this.loadedAll},NotificationPopoverController.prototype.setLoadedAllContent=function(val){this.loadedAll=val},NotificationPopoverController.prototype.renderUnreadCount=function(){var element=this.root.find(SELECTORS_COUNT_CONTAINER);this.unreadCount?(element.text(this.unreadCount),element.removeClass("hidden")):element.addClass("hidden")},NotificationPopoverController.prototype.hideUnreadCount=function(){this.root.find(SELECTORS_COUNT_CONTAINER).addClass("hidden")},NotificationPopoverController.prototype.getNotificationElement=function(id){var element=this.root.find(SELECTORS_NOTIFICATION+'[data-id="'+id+'"]');return 1==element.length?element:null},NotificationPopoverController.prototype.renderNotifications=function(notifications,container){var promises=[];return $.each(notifications,function(index,notification){var offset=this.getOffset()-this.limit;notification.viewmoreurl=URL.relativeUrl("/message/output/popup/notifications.php",{notificationid:notification.id,offset:offset});var notificationurlparams={notificationid:notification.id};notification.contexturl=URL.relativeUrl("message/output/popup/mark_notification_read.php",notificationurlparams);var promise=Templates.render("message_popup/notification_content_item",notification).then((function(html,js){return{html:html,js:js}}));promises.push(promise)}.bind(this)),$.when.apply($,promises).then((function(){$.each(arguments,(function(index,argument){container.append(argument.html),Templates.runTemplateJS(argument.js)}))}))},NotificationPopoverController.prototype.loadMoreNotifications=function(){if(this.isLoading||this.hasLoadedAllContent())return $.Deferred().resolve();this.startLoading();var request={limit:this.limit,offset:this.getOffset(),useridto:this.userId},container=this.getContent();return NotificationRepo.query(request).then(function(result){var notifications=result.notifications;return this.unreadCount=result.unreadcount,this.lastQueried=Math.floor((new Date).getTime()/1e3),this.setLoadedAllContent(!notifications.length||notifications.length<this.limit),this.initialLoad=!0,this.updateButtonAriaLabel(),!!notifications.length&&(this.incrementOffset(),this.renderNotifications(notifications,container))}.bind(this)).always(function(){this.stopLoading()}.bind(this))},NotificationPopoverController.prototype.markAllAsRead=function(){this.markAllReadButton.addClass("loading");var request={useridto:this.userId,timecreatedto:this.lastQueried};return NotificationRepo.markAllAsRead(request).then(function(){this.unreadCount=0,this.root.find(SELECTORS_UNREAD_NOTIFICATION).removeClass("unread")}.bind(this)).always(function(){this.markAllReadButton.removeClass("loading")}.bind(this))},NotificationPopoverController.prototype.registerEventListeners=function(){CustomEvents.define(this.root,[CustomEvents.events.activate]),this.root.on(CustomEvents.events.activate,SELECTORS_MARK_ALL_READ_BUTTON,function(e,data){this.markAllAsRead(),e.stopPropagation(),data.originalEvent.preventDefault()}.bind(this)),this.root.on(CustomEvents.events.activate,SELECTORS_NOTIFICATION_LINK,function(e){var element=$(e.target).closest(SELECTORS_NOTIFICATION);element.hasClass("unread")&&(this.unreadCount--,element.removeClass("unread")),e.stopPropagation()}.bind(this)),this.root.on(this.events().menuOpened,function(){this.hideUnreadCount(),this.updateButtonAriaLabel(),this.hasDoneInitialLoad()||this.loadMoreNotifications()}.bind(this)),this.root.on(this.events().menuClosed,function(){this.renderUnreadCount(),this.updateButtonAriaLabel()}.bind(this)),this.root.on(this.events().startLoading,function(){this.getContent().attr("aria-busy","true")}.bind(this)),this.root.on(this.events().stopLoading,function(){this.getContent().attr("aria-busy","false")}.bind(this)),this.getContentContainer().on(CustomEvents.events.scrollBottom,function(){this.isLoading||this.hasLoadedAllContent()||this.loadMoreNotifications()}.bind(this)),CustomEvents.define(this.getContentContainer(),[CustomEvents.events.scrollLock]),$(document).on(NotificationAreaEvents.notificationShown,function(e,notification){if(!notification.read){var element=this.getNotificationElement(notification.id);element&&element.removeClass("unread"),this.unreadCount--,this.renderUnreadCount()}}.bind(this))},NotificationPopoverController}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Controls the notification area on the notification page.
 *
 * @module     message_popup/notification_area_control_area
 * @class      notification_area_control_area
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("message_popup/notification_area_control_area",["jquery","core/templates","core/notification","core/custom_interaction_events","message_popup/notification_repository","message_popup/notification_area_events"],(function($,Templates,DebugNotification,CustomEvents,NotificationRepo,NotificationAreaEvents){var SELECTORS_CONTAINER='[data-region="notification-area"]',SELECTORS_CONTENT='[data-region="content"]',SELECTORS_NOTIFICATION='[data-region="notification-content-item-container"]',SELECTORS_CAN_RECEIVE_FOCUS='input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',TEMPLATES_NOTIFICATION="message_popup/notification_content_item",ControlArea=function(root,userId){this.root=$(root),this.container=this.root.closest(SELECTORS_CONTAINER),this.userId=userId,this.content=this.root.find(SELECTORS_CONTENT),this.offset=0,this.limit=20,this.initialLoad=!1,this.isLoading=!1,this.loadedAll=!1,this.notifications={},this.registerEventListeners()};return ControlArea.prototype.getRoot=function(){return this.root},ControlArea.prototype.getContainer=function(){return this.container},ControlArea.prototype.getUserId=function(){return this.userId},ControlArea.prototype.getContent=function(){return this.content},ControlArea.prototype.getOffset=function(){return this.offset},ControlArea.prototype.getLimit=function(){return this.limit},ControlArea.prototype.setOffset=function(value){this.offset=value},ControlArea.prototype.setLimit=function(value){this.limit=value},ControlArea.prototype.incrementOffset=function(){this.offset+=this.limit},ControlArea.prototype.startLoading=function(){this.isLoading=!0,this.getRoot().addClass("loading")},ControlArea.prototype.stopLoading=function(){this.isLoading=!1,this.getRoot().removeClass("loading")},ControlArea.prototype.hasDoneInitialLoad=function(){return this.initialLoad},ControlArea.prototype.hasLoadedAllContent=function(){return this.loadedAll},ControlArea.prototype.setLoadedAllContent=function(val){this.loadedAll=val},ControlArea.prototype.setCacheNotification=function(notification){this.notifications[notification.id]=notification},ControlArea.prototype.getCacheNotification=function(id){return this.notifications[id]},ControlArea.prototype.getNotificationElement=function(id){var element=this.getRoot().find(SELECTORS_NOTIFICATION+'[data-id="'+id+'"]');return 1==element.length?element:null},ControlArea.prototype.scrollNotificationIntoView=function(notificationElement){var position=notificationElement.position(),container=this.getRoot();if(position.top-container.scrollTop()>container.innerHeight()){var height=notificationElement.outerHeight();height*=4;var scrollTo=position.top-height;container.scrollTop(scrollTo)}},ControlArea.prototype.showNotification=function(notificationElement){if("object"!==_typeof(notificationElement)&&(notificationElement=this.getNotificationElement(notificationElement)),notificationElement&&notificationElement.length){this.getRoot().find(SELECTORS_NOTIFICATION).removeClass("selected"),notificationElement.addClass("selected").find(SELECTORS_CAN_RECEIVE_FOCUS).focus();var notificationId=notificationElement.attr("data-id"),notification=this.getCacheNotification(notificationId);this.scrollNotificationIntoView(notificationElement),this.getContainer().trigger(NotificationAreaEvents.showNotification,[$.extend({},notification)])}},ControlArea.prototype.markNotificationAsRead=function(notificationElement){return NotificationRepo.markAsRead(notificationElement.attr("data-id")).done((function(){notificationElement.removeClass("unread")}))},ControlArea.prototype.renderNotifications=function(notifications){var promises=[],container=this.getContent();return $.each(notifications,function(index,notification){var contextUrl=notification.contexturl;delete notification.contexturl;var promise=Templates.render(TEMPLATES_NOTIFICATION,notification).then(function(html,js){return notification.contexturl=contextUrl,this.setCacheNotification(notification),{html:html,js:js}}.bind(this));promises.push(promise)}.bind(this)),$.when.apply($,promises).then((function(){$.each(arguments,(function(index,argument){container.append(argument.html),Templates.runTemplateJS(argument.js)}))}))},ControlArea.prototype.loadMoreNotifications=function(){if(this.isLoading||this.hasLoadedAllContent())return $.Deferred().resolve();this.startLoading();var request={limit:this.getLimit(),offset:this.getOffset(),useridto:this.getUserId()};return this.initialLoad||(request.limit=this.getOffset()+this.getLimit(),request.offset=0),NotificationRepo.query(request).then(function(result){var notifications=result.notifications;return this.unreadCount=result.unreadcount,this.setLoadedAllContent(!notifications.length||notifications.length<this.getLimit()),this.initialLoad=!0,!!notifications.length&&(this.incrementOffset(),this.renderNotifications(notifications))}.bind(this)).always(function(){this.stopLoading()}.bind(this))},ControlArea.prototype.registerEventListeners=function(){CustomEvents.define(this.getRoot(),[CustomEvents.events.activate,CustomEvents.events.scrollBottom,CustomEvents.events.scrollLock,CustomEvents.events.up,CustomEvents.events.down]),this.getRoot().on(CustomEvents.events.scrollBottom,function(){this.loadMoreNotifications()}.bind(this)),this.getRoot().on(CustomEvents.events.activate,SELECTORS_NOTIFICATION,function(e){var notificationElement=$(e.target).closest(SELECTORS_NOTIFICATION);this.showNotification(notificationElement)}.bind(this)),this.getRoot().on(CustomEvents.events.up,SELECTORS_NOTIFICATION,function(e,data){var notificationElement=$(e.target).closest(SELECTORS_NOTIFICATION);this.showNotification(notificationElement.prev()),data.originalEvent.preventDefault()}.bind(this)),this.getRoot().on(CustomEvents.events.down,SELECTORS_NOTIFICATION,function(e,data){var notificationElement=$(e.target).closest(SELECTORS_NOTIFICATION);this.showNotification(notificationElement.next()),data.originalEvent.preventDefault()}.bind(this)),this.getContainer().on(NotificationAreaEvents.notificationShown,function(e,notification){if(!notification.read){var element=this.getNotificationElement(notification.id);element&&this.markNotificationAsRead(element);var cachedNotification=this.getCacheNotification(notification.id);cachedNotification&&(cachedNotification.read=!0)}}.bind(this))},ControlArea}));
/**
 * Contain the events that can be fired in the notification area on
 * the notifications page.
 *
 * @module     message_popup/notification_area_events
 * @class      notification_area_events
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("message_popup/notification_area_events",[],(function(){return{showNotification:"notification-area-events:showNotification",notificationShown:"notification-area-events:notificationShown"}}));
/**
 * Controls the content area of the notification area on the
 * notification page.
 *
 * @module     message_popup/notification_area_content_area
 * @class      notification_area_content_area
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("message_popup/notification_area_content_area",["jquery","core/templates","core/notification","core/custom_interaction_events","message_popup/notification_repository","message_popup/notification_area_events"],(function($,Templates,DebugNotification,CustomEvents,NotificationRepo,NotificationAreaEvents){var SELECTORS={CONTAINER:'[data-region="notification-area"]',CONTENT:'[data-region="content"]',HEADER:'[data-region="header"]',FOOTER:'[data-region="footer"]',TOGGLE_MODE:'[data-action="toggle-mode"]'},TEMPLATES_HEADER="message_popup/notification_area_content_area_header",TEMPLATES_CONTENT="message_popup/notification_area_content_area_content",TEMPLATES_FOOTER="message_popup/notification_area_content_area_footer",ContentArea=function(root,userId){this.root=$(root),this.container=this.root.closest(SELECTORS.CONTAINER),this.userId=userId,this.header=this.root.find(SELECTORS.HEADER),this.content=this.root.find(SELECTORS.CONTENT),this.footer=this.root.find(SELECTORS.FOOTER),this.registerEventListeners()};return ContentArea.prototype.getRoot=function(){return this.root},ContentArea.prototype.getContainer=function(){return this.container},ContentArea.prototype.getUserId=function(){return this.userId},ContentArea.prototype.getHeader=function(){return this.header},ContentArea.prototype.getContent=function(){return this.content},ContentArea.prototype.getFooter=function(){return this.footer},ContentArea.prototype.show=function(){this.getContainer().addClass("show-content-area")},ContentArea.prototype.hide=function(){this.getContainer().removeClass("show-content-area")},ContentArea.prototype.setHeaderHTML=function(html){this.getHeader().empty().html(html)},ContentArea.prototype.setContentHTML=function(html){this.getContent().empty().html(html)},ContentArea.prototype.setFooterHTML=function(html){this.getFooter().empty().html(html)},ContentArea.prototype.showNotification=function(notification){var headerPromise=Templates.render(TEMPLATES_HEADER,notification).done(function(html){this.setHeaderHTML(html)}.bind(this)),contentPromise=Templates.render(TEMPLATES_CONTENT,notification).done(function(html){this.setContentHTML(html)}.bind(this)),footerPromise=Templates.render(TEMPLATES_FOOTER,notification).done(function(html){this.setFooterHTML(html)}.bind(this));return $.when(headerPromise,contentPromise,footerPromise).done(function(){this.show(),this.getContainer().trigger(NotificationAreaEvents.notificationShown,[notification])}.bind(this))},ContentArea.prototype.registerEventListeners=function(){CustomEvents.define(this.getRoot(),[CustomEvents.events.activate]),this.getRoot().on(CustomEvents.events.activate,SELECTORS.VIEW_TOGGLE,function(){this.hide()}.bind(this)),this.getContainer().on(NotificationAreaEvents.showNotification,function(e,notification){this.showNotification(notification)}.bind(this))},ContentArea}));
/**
 * A javascript module to retrieve enrolled coruses from the server.
 *
 * @package    block_myoverview
 * @copyright  2018 Bas Brands <base@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_myoverview/repository",["core/ajax","core/notification"],(function(Ajax,Notification){return{getEnrolledCoursesByTimeline:function(args){var request={methodname:"core_course_get_enrolled_courses_by_timeline_classification",args:args};return Ajax.call([request])[0]},setFavouriteCourses:function(args){var request={methodname:"core_course_set_favourite_courses",args:args};return Ajax.call([request])[0]},updateUserPreferences:function(args){var request={methodname:"core_user_update_user_preferences",args:args};Ajax.call([request])[0].fail(Notification.exception)}}}));
/**
 * Manage the courses view for the overview block.
 *
 * @package    block_myoverview
 * @copyright  2018 Bas Brands <bas@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_myoverview/view",["jquery","block_myoverview/repository","core/paged_content_factory","core/pubsub","core/custom_interaction_events","core/notification","core/templates","core_course/events","block_myoverview/selectors","core/paged_content_events"],(function($,Repository,PagedContentFactory,PubSub,CustomEvents,Notification,Templates,CourseEvents,Selectors,PagedContentEvents){var SELECTORS_ACTION_HIDE_COURSE='[data-action="hide-course"]',SELECTORS_ACTION_SHOW_COURSE='[data-action="show-course"]',SELECTORS_ACTION_ADD_FAVOURITE='[data-action="add-favourite"]',SELECTORS_ACTION_REMOVE_FAVOURITE='[data-action="remove-favourite"]',SELECTORS_FAVOURITE_ICON='[data-region="favourite-icon"]',SELECTORS_ICON_IS_FAVOURITE='[data-region="is-favourite"]',SELECTORS_ICON_NOT_FAVOURITE='[data-region="not-favourite"]',TEMPLATES_COURSES_CARDS="block_myoverview/view-cards",TEMPLATES_COURSES_LIST="block_myoverview/view-list",TEMPLATES_COURSES_SUMMARY="block_myoverview/view-summary",TEMPLATES_NOCOURSES="core_course/no-courses",GROUPINGS_GROUPING_ALLINCLUDINGHIDDEN="allincludinghidden",NUMCOURSES_PERPAGE=[12,24,48,96,0],loadedPages=[],courseOffset=0,lastPage=0,lastLimit=0,namespace=null,getFilterValues=function(root){var courseRegion=root.find(Selectors.courseView.region);return{display:courseRegion.attr("data-display"),grouping:courseRegion.attr("data-grouping"),sort:courseRegion.attr("data-sort"),displaycategories:courseRegion.attr("data-displaycategories"),customfieldname:courseRegion.attr("data-customfieldname"),customfieldvalue:courseRegion.attr("data-customfieldvalue")}},DEFAULT_PAGED_CONTENT_CONFIG={ignoreControlWhileLoading:!0,controlPlacementBottom:!0,persistentLimitKey:"block_myoverview_user_paging_preference"},getFavouriteIconContainer=function(root,courseId){return root.find(SELECTORS_FAVOURITE_ICON+'[data-course-id="'+courseId+'"]')},getPagedContentContainer=function(root,index){return root.find('[data-region="paged-content-page"][data-page="'+index+'"]')},getCourseId=function(root){return root.attr("data-course-id")},getAddFavouriteMenuItem=function(root,courseId){return root.find('[data-action="add-favourite"][data-course-id="'+courseId+'"]')},getRemoveFavouriteMenuItem=function(root,courseId){return root.find('[data-action="remove-favourite"][data-course-id="'+courseId+'"]')},addToFavourites=function(root,courseId){var removeAction=getRemoveFavouriteMenuItem(root,courseId),addAction=getAddFavouriteMenuItem(root,courseId);setCourseFavouriteState(courseId,!0).then((function(success){success?(PubSub.publish(CourseEvents.favourited,courseId),removeAction.removeClass("hidden"),addAction.addClass("hidden"),function(root,courseId){var iconContainer=getFavouriteIconContainer(root,courseId),isFavouriteIcon=iconContainer.find(SELECTORS_ICON_IS_FAVOURITE);isFavouriteIcon.removeClass("hidden"),isFavouriteIcon.attr("aria-hidden",!1);var notFavourteIcon=iconContainer.find(SELECTORS_ICON_NOT_FAVOURITE);notFavourteIcon.addClass("hidden"),notFavourteIcon.attr("aria-hidden",!0)}(root,courseId)):Notification.alert("Starring course failed","Could not change favourite state")})).catch(Notification.exception)},removeFromFavourites=function(root,courseId){var removeAction=getRemoveFavouriteMenuItem(root,courseId),addAction=getAddFavouriteMenuItem(root,courseId);setCourseFavouriteState(courseId,!1).then((function(success){success?(PubSub.publish(CourseEvents.unfavorited,courseId),removeAction.addClass("hidden"),addAction.removeClass("hidden"),function(root,courseId){var iconContainer=getFavouriteIconContainer(root,courseId),isFavouriteIcon=iconContainer.find(SELECTORS_ICON_IS_FAVOURITE);isFavouriteIcon.addClass("hidden"),isFavouriteIcon.attr("aria-hidden",!0);var notFavourteIcon=iconContainer.find(SELECTORS_ICON_NOT_FAVOURITE);notFavourteIcon.removeClass("hidden"),notFavourteIcon.attr("aria-hidden",!1)}(root,courseId)):Notification.alert("Starring course failed","Could not change favourite state")})).catch(Notification.exception)},getHideCourseMenuItem=function(root,courseId){return root.find('[data-action="hide-course"][data-course-id="'+courseId+'"]')},getShowCourseMenuItem=function(root,courseId){return root.find('[data-action="show-course"][data-course-id="'+courseId+'"]')},setCourseHiddenState=function(courseId,status){return!1===status&&(status=null),Repository.updateUserPreferences({preferences:[{type:"block_myoverview_hidden_course_"+courseId,value:status}]})},hideElement=function(root,id){var pagingBar=root.find('[data-region="paging-bar"]'),jumpto=parseInt(pagingBar.attr("data-active-page-number")),reducedCourse=loadedPages[jumpto].courses.reduce((function(accumulator,current){return id!=current.id&&accumulator.push(current),accumulator}),[]);if(null!=loadedPages[jumpto+1]){var newElement=loadedPages[jumpto+1].courses.slice(0,1);loadedPages.forEach((function(courseList,index){if(index>jumpto){var popElement=[];null!=loadedPages[index+1]&&(popElement=loadedPages[index+1].courses.slice(0,1)),loadedPages[index].courses=$.merge(loadedPages[index].courses.slice(1),popElement)}})),reducedCourse=$.merge(reducedCourse,newElement)}if(lastPage==jumpto+1&&0==loadedPages[jumpto+1].courses.length){var pagedContentContainer=root.find('[data-region="paged-content-container"]');PagedContentFactory.resetLastPageNumber($(pagedContentContainer).attr("id"),jumpto)}loadedPages[jumpto].courses=reducedCourse,courseOffset--;var pagedContentPage=getPagedContentContainer(root,jumpto);renderCourses(root,loadedPages[jumpto]).then((function(html,js){return Templates.replaceNodeContents(pagedContentPage,html,js)})).catch(Notification.exception),loadedPages.forEach((function(courseList,index){index>jumpto&&getPagedContentContainer(root,index).remove()}))},setCourseFavouriteState=function(courseId,status){return Repository.setFavouriteCourses({courses:[{id:courseId,favourite:status}]}).then((function(result){return 0==result.warnings.length&&(loadedPages.forEach((function(courseList){courseList.courses.forEach((function(course,index){course.id==courseId&&(courseList.courses[index].isfavourite=status)}))})),!0)})).catch(Notification.exception)},renderCourses=function(root,coursesData){var filters=getFilterValues(root),currentTemplate="";if(currentTemplate="card"==filters.display?TEMPLATES_COURSES_CARDS:"list"==filters.display?TEMPLATES_COURSES_LIST:TEMPLATES_COURSES_SUMMARY,coursesData.courses=coursesData.courses.map((function(course){return course.showcoursecategory="on"==filters.displaycategories,course})),coursesData.courses.length)return Templates.render(currentTemplate,{courses:coursesData.courses});var nocoursesimg=root.find(Selectors.courseView.region).attr("data-nocoursesimg");return Templates.render(TEMPLATES_NOCOURSES,{nocoursesimg:nocoursesimg})},setLimit=function(limit){this.find(Selectors.courseView.region).attr("data-paging",limit)},registerPagedEventHandlers=function(root,namespace){var event=namespace+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;PubSub.subscribe(event,setLimit.bind(root))},initializePagedContent=function(root){namespace="block_myoverview_"+root.attr("id")+"_"+Math.random();var pagingLimit=parseInt(root.find(Selectors.courseView.region).attr("data-paging"),10),itemsPerPage=NUMCOURSES_PERPAGE.map((function(value){var active=!1;return value==pagingLimit&&(active=!0),{value:value,active:active}})),totalCourseCount=parseInt(root.find(Selectors.courseView.region).attr("data-totalcoursecount"),10);itemsPerPage=itemsPerPage.filter((function(pagingOption){return pagingOption.value<totalCourseCount||0===pagingOption.value}));var filters=getFilterValues(root),config=$.extend({},DEFAULT_PAGED_CONTENT_CONFIG);config.eventNamespace=namespace;var pagedContentPromise=PagedContentFactory.createWithLimit(itemsPerPage,(function(pagesData,actions){var promises=[];return pagesData.forEach((function(pageData){var currentPage=pageData.pageNumber,limit=pageData.limit>0?pageData.limit:0;if(lastLimit!=limit&&(loadedPages=[],courseOffset=0,lastPage=0),lastPage==currentPage)return actions.allItemsLoaded(lastPage),void promises.push(renderCourses(root,loadedPages[currentPage]));lastLimit=limit,null==loadedPages[currentPage+1]&&null==loadedPages[currentPage]&&(limit*=2);var pagePromise=function(filters,limit){return Repository.getEnrolledCoursesByTimeline({offset:courseOffset,limit:limit,classification:filters.grouping,sort:filters.sort,customfieldname:filters.customfieldname,customfieldvalue:filters.customfieldvalue})}(filters,limit).then((function(coursesData){var courses=coursesData.courses,nextPageStart=0,pageCourses=[];if(null!=loadedPages[currentPage]){var currentPageLength=(pageCourses=loadedPages[currentPage].courses).length;currentPageLength<pageData.limit&&(nextPageStart=pageData.limit-currentPageLength,pageCourses=$.merge(loadedPages[currentPage].courses,courses.slice(0,nextPageStart)))}else nextPageStart=pageData.limit||!1,pageCourses=pageData.limit>0?courses.slice(0,pageData.limit):courses;loadedPages[currentPage]={courses:pageCourses};var remainingCourses=!1!==nextPageStart?courses.slice(nextPageStart,courses.length):[];return remainingCourses.length&&(loadedPages[currentPage+1]={courses:remainingCourses}),loadedPages[currentPage].courses.length<pageData.limit||!remainingCourses.length?(lastPage=currentPage,actions.allItemsLoaded(currentPage)):null!=loadedPages[currentPage+1]&&loadedPages[currentPage+1].courses.length<pageData.limit&&(lastPage=currentPage+1),courseOffset=coursesData.nextoffset,renderCourses(root,loadedPages[currentPage])})).catch(Notification.exception);promises.push(pagePromise)})),promises}),config);pagedContentPromise.then((function(html,js){return registerPagedEventHandlers(root,namespace),Templates.replaceNodeContents(root.find(Selectors.courseView.region),html,js)})).catch(Notification.exception)},registerEventListeners=function(root){CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_ACTION_ADD_FAVOURITE,(function(e,data){var favourite=$(e.target).closest(SELECTORS_ACTION_ADD_FAVOURITE),courseId=getCourseId(favourite);addToFavourites(root,courseId),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_ACTION_REMOVE_FAVOURITE,(function(e,data){var favourite=$(e.target).closest(SELECTORS_ACTION_REMOVE_FAVOURITE),courseId=getCourseId(favourite);removeFromFavourites(root,courseId),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_FAVOURITE_ICON,(function(e,data){data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_ACTION_HIDE_COURSE,(function(e,data){var target=$(e.target).closest(SELECTORS_ACTION_HIDE_COURSE),courseId=getCourseId(target);!function(root,courseId){var hideAction=getHideCourseMenuItem(root,courseId),showAction=getShowCourseMenuItem(root,courseId),filters=getFilterValues(root);setCourseHiddenState(courseId,!0),filters.grouping!=GROUPINGS_GROUPING_ALLINCLUDINGHIDDEN&&hideElement(root,courseId),hideAction.addClass("hidden"),showAction.removeClass("hidden")}(root,courseId),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_ACTION_SHOW_COURSE,(function(e,data){var target=$(e.target).closest(SELECTORS_ACTION_SHOW_COURSE),courseId=getCourseId(target);!function(root,courseId){var hideAction=getHideCourseMenuItem(root,courseId),showAction=getShowCourseMenuItem(root,courseId),filters=getFilterValues(root);setCourseHiddenState(courseId,null),filters.grouping!=GROUPINGS_GROUPING_ALLINCLUDINGHIDDEN&&hideElement(root,courseId),hideAction.removeClass("hidden"),showAction.addClass("hidden")}(root,courseId),data.originalEvent.preventDefault()}))},init=function(root){root=$(root),loadedPages=[],lastPage=0,courseOffset=0,initializePagedContent(root),root.attr("data-init")||(registerEventListeners(root),root.attr("data-init",!0))};return{init:init,reset:function(root){loadedPages.length>0?loadedPages.forEach((function(courseList,index){var pagedContentPage=getPagedContentContainer(root,index);renderCourses(root,courseList).then((function(html,js){return Templates.replaceNodeContents(pagedContentPage,html,js)})).catch(Notification.exception)})):init(root)}}}));
/**
 * Javascript to initialise the myoverview block.
 *
 * @package    block_myoverview
 * @copyright  2018 Bas Brands <bas@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_myoverview/main",["jquery","block_myoverview/view","block_myoverview/view_nav"],(function($,View,ViewNav){return{init:function(root){root=$(root),ViewNav.init(root),View.init(root)}}}));
/**
 * Manage the timeline view navigation for the overview block.
 *
 * @package    block_myoverview
 * @copyright  2018 Bas Brands <bas@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_myoverview/view_nav",["jquery","core/custom_interaction_events","block_myoverview/repository","block_myoverview/view","block_myoverview/selectors"],(function($,CustomEvents,Repository,View,Selectors){var SELECTORS_FILTERS='[data-region="filter"]',SELECTORS_FILTER_OPTION="[data-filter]",SELECTORS_DISPLAY_OPTION="[data-display-option]",updatePreferences=function(filter,value){var type=null;type="display"==filter?"block_myoverview_user_view_preference":"sort"==filter?"block_myoverview_user_sort_preference":"customfieldvalue"==filter?"block_myoverview_user_grouping_customfieldvalue_preference":"block_myoverview_user_grouping_preference",Repository.updateUserPreferences({preferences:[{type:type,value:value}]})};return{init:function(root){!function(root){var Selector=root.find(SELECTORS_FILTERS);CustomEvents.define(Selector,[CustomEvents.events.activate]),Selector.on(CustomEvents.events.activate,SELECTORS_FILTER_OPTION,(function(e,data){var option=$(e.target);if(!option.hasClass("active")){var filter=option.attr("data-filter"),pref=option.attr("data-pref"),customfieldvalue=option.attr("data-customfieldvalue");root.find(Selectors.courseView.region).attr("data-"+filter,option.attr("data-value")),updatePreferences(filter,pref),customfieldvalue&&(root.find(Selectors.courseView.region).attr("data-customfieldvalue",customfieldvalue),updatePreferences("customfieldvalue",customfieldvalue)),View.init(root),data.originalEvent.preventDefault()}})),CustomEvents.define(Selector,[CustomEvents.events.activate]),Selector.on(CustomEvents.events.activate,SELECTORS_DISPLAY_OPTION,(function(e,data){var option=$(e.target);if(!option.hasClass("active")){var filter=option.attr("data-display-option"),pref=option.attr("data-pref");root.find(Selectors.courseView.region).attr("data-display",option.attr("data-value")),updatePreferences(filter,pref),View.reset(root),data.originalEvent.preventDefault()}}))}(root=$(root))}}}));
/**
 * Javascript to initialise the selectors for the myoverview block.
 *
 * @package    block_myoverview
 * @copyright  2018 Peter Dias <peter@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_myoverview/selectors",[],(function(){return{courseView:{region:'[data-region="courses-view"]',regionContent:'[data-region="course-view-content"]'}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Parse the response from the navblock ajax page and render the correct DOM
 * structure for the tree from it.
 *
 * @module     block_navigation/ajax_response_renderer
 * @package    core
 * @copyright  2015 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("block_navigation/ajax_response_renderer",["jquery","core/templates","core/notification","core/url"],(function($,Templates,Notification,Url){var NODETYPE_ACTIVITY=40,NODETYPE_RESOURCE=50;function buildDOM(rootElement,nodes){var ul=$("<ul></ul>");ul.attr("role","group"),ul.attr("aria-hidden",!0),$.each(nodes,(function(index,node){if("object"===_typeof(node)){var li=$("<li></li>"),p=$("<p></p>"),id=node.id||node.key+"_tree_item",icon=null,isBranch=!(!node.expandable&&!node.haschildren);p.addClass("tree_item"),p.attr("id",id),p.attr("role","treeitem"),p.attr("tabindex","-1"),node.requiresajaxloading&&(p.attr("data-requires-ajax",!0),p.attr("data-node-id",node.id),p.attr("data-node-key",node.key),p.attr("data-node-type",node.type)),isBranch&&(li.addClass("collapsed contains_branch"),p.attr("aria-expanded",!1),p.addClass("branch"));var eleToAddIcon=null;if(node.link){var link=$('<a title="'+node.title+'" href="'+node.link+'"></a>');eleToAddIcon=link,link.append('<span class="item-content-wrap">'+node.name+"</span>"),node.hidden&&link.addClass("dimmed"),p.append(link)}else{var span=$("<span></span>");eleToAddIcon=span,span.append('<span class="item-content-wrap">'+node.name+"</span>"),node.hidden&&span.addClass("dimmed"),p.append(span)}!node.icon||isBranch&&node.type!==NODETYPE_ACTIVITY&&node.type!==NODETYPE_RESOURCE||(li.addClass("item_with_icon"),p.addClass("hasicon"),node.type===NODETYPE_ACTIVITY||node.type===NODETYPE_RESOURCE?((icon=$("<img/>")).attr("alt",node.icon.alt),icon.attr("title",node.icon.title),icon.attr("src",Url.imageUrl(node.icon.pix,node.icon.component)),$.each(node.icon.classes,(function(index,className){icon.addClass(className)})),eleToAddIcon.prepend(icon)):("moodle"==node.icon.component&&(node.icon.component="core"),Templates.renderPix(node.icon.pix,node.icon.component,node.icon.title).then((function(html){eleToAddIcon.prepend(html)})).catch(Notification.exception))),li.append(p),ul.append(li),node.children&&node.children.length?buildDOM(p,node.children):isBranch&&!node.requiresajaxloading&&(li.removeClass("contains_branch"),p.addClass("emptybranch"))}})),rootElement.parent().append(ul);var id=rootElement.attr("id")+"_group";ul.attr("id",id),rootElement.attr("aria-owns",id),rootElement.attr("role","treeitem")}return{render:function(element,nodes){if(nodes.children&&nodes.children.length){buildDOM(element,nodes.children);var item=element.children("[role='treeitem']").first(),group=element.find("#"+item.attr("aria-owns"));item.attr("aria-expanded",!0),group.attr("aria-hidden",!1)}else element.parent().hasClass("contains_branch")&&(element.parent().removeClass("contains_branch"),element.addClass("emptybranch"))}}}));
/**
 * Load the navigation tree javascript.
 *
 * @module     block_navigation/navblock
 * @package    core
 * @copyright  2015 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_navigation/navblock",["jquery","core/tree"],(function($,Tree){return{init:function(instanceid){var navTree=new Tree(".block_navigation .block_tree");navTree.finishExpandingGroup=function(item){Tree.prototype.finishExpandingGroup.call(this,item),Y.use("moodle-core-event",(function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:instanceid})}))},navTree.collapseGroup=function(item){Tree.prototype.collapseGroup.call(this,item),Y.use("moodle-core-event",(function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:instanceid})}))}}}}));
/**
 * Load the nav tree items via ajax and render the response.
 *
 * @module     block_navigation/nav_loader
 * @package    core
 * @copyright  2015 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_navigation/nav_loader",["jquery","core/ajax","core/config","block_navigation/ajax_response_renderer"],(function($,ajax,config,renderer){var URL=config.wwwroot+"/lib/ajax/getnavbranch.php";function getBlockInstanceId(element){return element.closest("[data-block]").attr("data-instanceid")}return{load:function(element){element=$(element);var promise=$.Deferred(),settings={type:"POST",dataType:"json",data:{elementid:element.attr("data-node-id"),id:element.attr("data-node-key"),type:element.attr("data-node-type"),sesskey:config.sesskey,instance:getBlockInstanceId(element)}};return $.ajax(URL,settings).done((function(nodes){renderer.render(element,nodes),promise.resolve()})),promise}}}));
/**
 * Load the site admin nav tree via ajax and render the response.
 *
 * @module     block_navigation/site_admin_loader
 * @package    core
 * @copyright  2015 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_navigation/site_admin_loader",["jquery","core/ajax","core/config","block_navigation/ajax_response_renderer"],(function($,ajax,config,renderer){var URL=config.wwwroot+"/lib/ajax/getsiteadminbranch.php";return{load:function(element){element=$(element);var promise=$.Deferred(),settings={type:"POST",dataType:"json",data:{type:71,sesskey:config.sesskey}};return $.ajax(URL,settings).done((function(nodes){renderer.render(element,nodes),promise.resolve()})),promise}}}));
/**
 * A javascript module that handles the change of the user's visibility in the
 * online users block.
 *
 * @module     block_online_users/change_user_visibility
 * @package    block_online_users
 * @copyright  2018 Mihail Geshoski <mihail@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_online_users/change_user_visibility",["jquery","core/ajax","core/str","core/notification"],(function($,Ajax,Str,Notification){var SELECTORS_CHANGE_VISIBILITY_LINK="#change-user-visibility",SELECTORS_CHANGE_VISIBILITY_ICON="#change-user-visibility .icon",oppositeAction=function(action){return"show"==action?"hide":"show"},changeVisibilityLinkAttr=function(action){getTitle(action).then((function(title){$(SELECTORS_CHANGE_VISIBILITY_LINK).attr({"data-action":action,title:title})})).catch(Notification.exception)},changeVisibilityIconAttr=function(action){var icon=$(SELECTORS_CHANGE_VISIBILITY_ICON);getTitle(action).then((function(title){$(icon).attr({title:title,"aria-label":title}),icon.is("img")?$(icon).attr({src:M.util.image_url("t/"+action),alt:title}):($(icon).addClass(getIconClass(action)),$(icon).removeClass(getIconClass(oppositeAction(action))))})).catch(Notification.exception)},getIconClass=function(action){return"show"==action?"fa-eye-slash":"fa-eye"},getTitle=function(action){return Str.get_string("online_status:"+action,"block_online_users")};return{init:function(){$(SELECTORS_CHANGE_VISIBILITY_LINK).on("click",(function(e){e.preventDefault(),function(action,userid){var request={methodname:"core_user_set_user_preferences",args:{preferences:[{name:"block_online_users_uservisibility",value:"show"==action?1:0,userid:userid}]}};Ajax.call([request])[0].then((function(data){if(data.saved){var newAction=oppositeAction(action);changeVisibilityLinkAttr(newAction),changeVisibilityIconAttr(newAction)}})).catch(Notification.exception)}($(this).attr("data-action"),$(this).attr("data-userid"))}))}}}));
define("block_onlinesurvey/spinner",[],(function(){return{init:function(src){var iframeElem=document.getElementById("block_onlinesurvey_contentframe"),contentElem=document.getElementById("block_onlinesurvey_surveys_content");iframeElem.src=src,iframeElem.addEventListener("load",(function(){contentElem.className=contentElem.className.replace(/block_onlinesurvey_is-loading/,"")}),!0)}}}));
define("block_onlinesurvey/modal-zoom",["core/templates","core/str"],(function(templates){var popupinfotitle="",popupinfocontent="",userlogintime=0,handleClickSmallModal=function(e){e.preventDefault();var originalIframe=e.target.querySelector("iframe");null!==originalIframe||(originalIframe=parent.document.querySelector("iframe")),templates.render("block_onlinesurvey/modal-iframe",{src:originalIframe.src+"&modalZoom=1",title:""}).done((function(source){var div=document.createElement("div");div.innerHTML=source;var modalContainer=div.firstChild;document.body.insertBefore(modalContainer,document.body.firstChild),document.body.className+=" block_onlinesurvey_custom-modal-open";var closeCallback=function(){document.body.className=document.body.className.replace(" block_onlinesurvey_custom-modal-open",""),function(){var myElement=document.getElementById("block_onlinesurvey_contentframe");if(myElement){var oldsrc=myElement.src;myElement.src="",myElement.src=oldsrc}}(),modalContainer.className+=" fading",setTimeout((function(){null!==modalContainer.parentNode&&modalContainer.parentNode.removeChild(modalContainer)}),250)};modalContainer.querySelector(".block_onlinesurvey_custom-modal_close-button").addEventListener("click",(function(e){return e.preventDefault(),closeCallback()})),modalContainer.addEventListener("click",(function(e){return e.preventDefault(),e.target===modalContainer&&closeCallback()}))}))};return{init:function(popuptitle,popupcontent,currentlogin){popupinfotitle=popuptitle,popupinfocontent=popupcontent,userlogintime=currentlogin;for(var zoomContainer=document.querySelectorAll("#block_onlinesurvey_surveys_content"),i=0;i<zoomContainer.length;i++)zoomContainer[i].addEventListener("click",handleClickSmallModal);window.EVASYS={generatepopupinfo:this.generatepopupinfo},window.evasysGeneratePopupinfo=this.generatepopupinfo},generatepopupinfo:function(){var popupinfo=sessionStorage.getItem("onlinesurvey_popupinfo");0!=popupinfo&&null!==popupinfo&&popupinfo==userlogintime||(sessionStorage.setItem("onlinesurvey_popupinfo",userlogintime),templates.render("block_onlinesurvey/popupinfo",{title:popupinfotitle,content:popupinfocontent}).done((function(source){var div=document.createElement("div");div.innerHTML=source;var modalContainer=div.firstChild;document.body.insertBefore(modalContainer,document.body.firstChild),document.body.className+=" block_onlinesurvey_custom-modal-open popupinfo";var closeCallback=function(){document.body.className=document.body.className.replace(" block_onlinesurvey_custom-modal-open",""),modalContainer.className+=" fading",setTimeout((function(){null!==modalContainer.parentNode&&modalContainer.parentNode.removeChild(modalContainer)}),250)};modalContainer.querySelector(".block_onlinesurvey_custom-modal_close-button").addEventListener("click",(function(e){return e.preventDefault(),closeCallback()})),modalContainer.addEventListener("click",(function(e){return e.preventDefault(),e.target===modalContainer&&closeCallback()}))})))}}}));
define ("block_opencast/block_lti_form_handler",["jquery"],function(a){return{init:function init(){a("#ltiLaunchForm").submit()}}});
define ("block_opencast/block_index",["jquery","core/modal_factory","core/modal_events","core/str","core/url"],function(a,b,c,d,f){var g=function(d,g,h){if(document.getElementById("workflowsjson")){var i=JSON.parse(a("#workflowsjson").text());a(".start-workflow").on("click",function(j){j.preventDefault();var e=a(j.currentTarget),k="<select class=\"custom-select mb-3\" id=\"workflowselect\" name=\"workflow\">";for(var l in i){k+="<option value=\""+l+"\">"+i[l].title+"</option>"}k+="</select>";b.create({type:b.types.SAVE_CANCEL,title:h[5],body:"<form id=\"startWorkflowForm\" method=\"post\" action=\""+f.relativeUrl("blocks/opencast/startworkflow.php",{ocinstanceid:d,courseid:g,videoid:e.data("id")})+"\"><div class=\"form-group\"><p>"+h[6]+"</p>"+k+"<div id=\"workflowdesc\"></div><iframe id=\"config-frame\" class=\"w-100 mh-100 border-0\" sandbox=\"allow-forms allow-scripts\" src=\"\"></iframe><input type=\"hidden\" name=\"configparams\" id=\"configparams\"></form>"}).then(function(b){b.setSaveButtonText(h[5]);var e=b.getRoot();e.on(c.save,function(a){document.getElementById("config-frame").contentWindow.postMessage("getdata","*");a.preventDefault()});b.show().then(function(){a("#workflowdesc").html(i[a("#workflowselect").val()].description);a("#config-frame").attr("src",f.relativeUrl("blocks/opencast/serveworkflowconfigpanel.php",{ocinstanceid:d,courseid:g,workflowid:a("#workflowselect").val()}));a("#workflowselect").change(function(){var b=a(this).val();a("#workflowdesc").html(i[b].description);a("#config-frame").attr("src",f.relativeUrl("blocks/opencast/serveworkflowconfigpanel.php",{ocinstanceid:d,courseid:g,workflowid:b}))})})})})}},h=function(d,g,h){a(".report-problem").on("click",function(i){i.preventDefault();var e=a(i.currentTarget);b.create({type:b.types.SAVE_CANCEL,title:h[0],body:"<form id=\"reportProblemForm\" method=\"post\" action=\""+f.relativeUrl("blocks/opencast/reportproblem.php",{ocinstanceid:d,courseid:g,videoid:e.data("id")})+"\"><div class=\"form-group\"><label for=\"inputMessage\">"+h[1]+"</label><textarea class=\"form-control\" id=\"inputMessage\" name=\"inputMessage\" rows=\"4\" placeholder=\""+h[2]+"\"></textarea>  <div class=\"invalid-feedback d-none\" id=\"messageValidation\">"+h[3]+"</div></div></form>"}).then(function(b){b.setSaveButtonText(h[4]);var d=b.getRoot();d.on(c.save,function(b){if(a("#inputMessage").val()){a("#reportProblemForm").submit()}else{a("#inputMessage").addClass("is-invalid");a("#messageValidation").removeClass("d-none")}b.preventDefault()});b.show()})})};return{init:function init(b,c){d.get_strings([{key:"reportproblem_modal_title",component:"block_opencast"},{key:"reportproblem_modal_body",component:"block_opencast"},{key:"reportproblem_modal_placeholder",component:"block_opencast"},{key:"reportproblem_modal_required",component:"block_opencast"},{key:"reportproblem_modal_submit",component:"block_opencast"},{key:"startworkflow",component:"block_opencast"},{key:"startworkflow_modal_body",component:"block_opencast"}]).then(function(a){g(c,b,a);h(c,b,a)});window.addEventListener("message",function(b){if("null"!==b.origin){return}if(b.data===parseInt(b.data)){a("#config-frame").height(b.data)}else{a("#configparams").val(b.data);a("#startWorkflowForm").submit()}})}}});
define ("block_opencast/block_form_handler",["jquery"],function(a){window.presenterIntervalHandle=null;window.presentationIntervalHandle=null;window.presenterRun=!1;window.presentationRun=!1;function b(){if(!window.presentationRun&&!window.presenterRun){clearInterval(window.presentationIntervalHandle);clearInterval(window.presenterIntervalHandle);a("[name=\"submitbutton\"]").removeAttr("disabled")}}function c(){a("div[data-fieldtype=\"autocomplete\"]").each(function(b,c){var d=a(c).find("input");if(!d.hasClass("form-control")){d.addClass("form-control")}})}return{init:function init(){a("#termsofuse").hide();a("#termsofuse_toggle").on("click",function(b){a("#termsofuse").toggle();b.preventDefault()});a(".filepicker-filelist").on("drop",function(c){var d=c.currentTarget,e=a(d).parent().siblings(".filepickerhidden").attr("name");a("[name=\"submitbutton\"]").attr("disabled","disabled");if("video_presenter"==e){a(d).addClass("presenter-uploading");window.presenterIntervalHandle=setInterval(function(){window.presenterRun=!0;if(!a(".presenter-uploading").hasClass("dndupload-inprogress")){window.presenterRun=!1;b()}},500)}else{a(d).addClass("presentation-uploading");window.presenterIntervalHandle=setInterval(function(){window.presentationRun=!0;if(!a(".presentation-uploading").hasClass("dndupload-inprogress")){window.presentationRun=!1;b()}},500)}});setTimeout(function(){c();a(".moreless-actions").on("click",function(){c()})},1e3)}}});
function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("block_opencast/block_settings",["exports","block_opencast/tabulator","jquery","core/modal_factory","core/modal_events","core/str"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=i(b);c=i(c);d=i(d);e=i(e);f=h(f);function g(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;g=function(){return a};return a}function h(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=g();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function i(a){return a&&a.__esModule?a:{default:a}}var j=function(a,g,h,i){f.get_strings([{key:"heading_role",component:"block_opencast"},{key:"heading_actions",component:"block_opencast"},{key:"heading_permanent",component:"block_opencast"},{key:"delete_role",component:"block_opencast"},{key:"delete_confirm_role",component:"block_opencast"},{key:"delete_metadata",component:"block_opencast"},{key:"delete_confirm_metadata",component:"block_opencast"},{key:"heading_name",component:"block_opencast"},{key:"heading_datatype",component:"block_opencast"},{key:"heading_description",component:"block_opencast"},{key:"heading_required",component:"block_opencast"},{key:"heading_readonly",component:"block_opencast"},{key:"heading_params",component:"block_opencast"},{key:"delete",component:"moodle"}]).then(function(f){var j=(0,c.default)("#"+a);j.parent().hide();j.parent().next().hide();if(!j.length){return}var k=(0,c.default)("#"+g);k.parent().hide();k.parent().next().hide();var l=(0,c.default)("#"+h);l.parent().hide();l.parent().next().hide();var m=new b.default("#rolestable_"+i,{data:JSON.parse(j.val()),layout:"fitColumns",dataChanged:function dataChanged(a){a=a.filter(function(a){return a.rolename});j.val(JSON.stringify(a))},columns:[{title:f[0],field:"rolename",editor:"input",widthGrow:4,cellEdited:function cellEdited(a){if(a.getData().rolename.includes("[USERNAME]")||a.getData().rolename.includes("[USERNAME_LOW]")||a.getData().rolename.includes("[USERNAME_UP]")){a.getRow().update({permanent:1});a.getRow().getCell("permanent").getElement().getElementsByTagName("input")[0].disabled=!0}else{a.getRow().getCell("permanent").getElement().getElementsByTagName("input")[0].disabled=!1}}},{title:f[1],field:"actions",editor:"input",widthGrow:1},{title:f[2],field:"permanent",hozAlign:"center",widthGrow:0,formatter:function formatter(a){var b=document.createElement("input");b.type="checkbox";b.checked=a.getValue();b.addEventListener("click",function(){a.getRow().update({permanent:(0,c.default)(this).prop("checked")?1:0})});if(a.getData().rolename.includes("[USERNAME]")||a.getData().rolename.includes("[USERNAME_LOW]")||a.getData().rolename.includes("[USERNAME_UP]")){b.disabled=!0}return b}},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function formatter(){return"<i class=\"icon fa fa-trash fa-fw\"></i>"},cellClick:function cellClick(a,b){d.default.create({type:d.default.types.SAVE_CANCEL,title:f[3],body:f[4]}).then(function(a){a.setSaveButtonText(f[3]);a.getRoot().on(e.default.save,function(){b.getRow().delete()});a.show()})}}]});(0,c.default)("#addrow-rolestable_"+i).click(function(){m.addRow({rolename:"",actions:"",permanent:0})});var n=new b.default("#metadatatable_"+i,{data:JSON.parse(k.val()),layout:"fitColumns",movableRows:!0,rowMoved:function rowMoved(){var a=n.getRows().map(function(a){return a.getData()});a=a.filter(function(a){return a.name});k.val(JSON.stringify(a))},dataChanged:function dataChanged(){var a=n.getRows().map(function(a){return a.getData()});a=a.filter(function(a){return a.name});(0,c.default)("#"+g).val(JSON.stringify(a))},columns:[{title:f[7]+"   "+(0,c.default)("#helpbtnname_"+i).html(),field:"name",editor:"input",widthGrow:1,headerSort:!1},{title:f[8],field:"datatype",widthGrow:1,headerSort:!1,editor:"select",editorParams:{values:{text:"String (text)",select:"Drop Down (select)",autocomplete:"Arrays (autocomplete)",textarea:"Long Text (textarea)",date_time_selector:"Date Time Selector (datetime)"}}},{title:f[9]+"   "+(0,c.default)("#helpbtndescription_"+i).html(),field:"description",editor:"textarea",widthGrow:2,headerSort:!1},{title:f[10],field:"required",hozAlign:"center",widthGrow:0,headerSort:!1,formatter:function formatter(a){var b=document.createElement("input");b.type="checkbox";b.checked=a.getValue();b.addEventListener("click",function(){a.getRow().update({required:(0,c.default)(this).prop("checked")?1:0})});return b}},{title:f[11],field:"readonly",hozAlign:"center",widthGrow:0,headerSort:!1,formatter:function formatter(a){var b=document.createElement("input");b.type="checkbox";b.checked=a.getValue();b.addEventListener("click",function(){a.getRow().update({readonly:(0,c.default)(this).prop("checked")?1:0})});return b}},{title:f[12]+"   "+(0,c.default)("#helpbtnparams_"+i).html(),field:"param_json",editor:"textarea",widthGrow:2,headerSort:!1},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function formatter(){return"<i class=\"icon fa fa-trash fa-fw\"></i>"},cellClick:function cellClick(a,b){d.default.create({type:d.default.types.SAVE_CANCEL,title:f[5],body:f[6]}).then(function(a){a.setSaveButtonText(f[12]);a.getRoot().on(e.default.save,function(){b.getRow().delete()});a.show()})}}]});(0,c.default)("#addrow-metadatatable_"+i).click(function(){n.addRow({datatype:"text",required:0,readonly:0,param_json:null})});var o=new b.default("#metadataseriestable_"+i,{data:JSON.parse(l.val()),layout:"fitColumns",movableRows:!0,rowMoved:function rowMoved(){var a=o.getRows().map(function(a){return a.getData()});a=a.filter(function(a){return a.name});l.val(JSON.stringify(a))},dataChanged:function dataChanged(){var a=o.getRows().map(function(a){return a.getData()});a=a.filter(function(a){return a.name});(0,c.default)("#"+h).val(JSON.stringify(a))},columns:[{title:f[7]+"   "+(0,c.default)("#helpbtnname_"+i).html(),field:"name",editor:"input",widthGrow:1,headerSort:!1},{title:f[8],field:"datatype",widthGrow:1,headerSort:!1,editor:"select",editorParams:{values:{text:"String (text)",select:"Drop Down (select)",autocomplete:"Arrays (autocomplete)",textarea:"Long Text (textarea)",date_time_selector:"Date Time Selector (datetime)"}}},{title:f[9]+"   "+(0,c.default)("#helpbtndescription_"+i).html(),field:"description",editor:"textarea",widthGrow:2,headerSort:!1},{title:f[10],field:"required",hozAlign:"center",widthGrow:0,headerSort:!1,formatter:function formatter(a){var b=document.createElement("input");b.type="checkbox";b.checked=a.getValue();b.addEventListener("click",function(){a.getRow().update({required:(0,c.default)(this).prop("checked")?1:0})});return b}},{title:f[11],field:"readonly",hozAlign:"center",widthGrow:0,headerSort:!1,formatter:function formatter(a){var b=document.createElement("input");b.type="checkbox";b.checked=a.getValue();b.addEventListener("click",function(){a.getRow().update({readonly:(0,c.default)(this).prop("checked")?1:0})});return b}},{title:f[12]+"   "+(0,c.default)("#helpbtnparams_"+i).html(),field:"param_json",editor:"textarea",widthGrow:2,headerSort:!1},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function formatter(){return"<i class=\"icon fa fa-trash fa-fw\"></i>"},cellClick:function cellClick(a,b){d.default.create({type:d.default.types.SAVE_CANCEL,title:f[5],body:f[6]}).then(function(a){a.setSaveButtonText(f[12]);a.getRoot().on(e.default.save,function(){b.getRow().delete()});a.show()})}}]});(0,c.default)("#addrow-metadataseriestable_"+i).click(function(){o.addRow({datatype:"text",required:0,readonly:0,param_json:null})})})};a.init=j});
function _typeof2(t){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof2=function(t){return typeof t}}else{_typeof2=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return _typeof2(t)}var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(t){return _typeof2(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof2(t)};(function(t,o){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module){module.exports=o()}else if("function"==typeof define&&define.amd){define ("block_opencast/tabulator",o)}else{t.Tabulator=o()}})(this,function(){'use strict';if(!Array.prototype.findIndex){Object.defineProperty(Array.prototype,"findIndex",{value:function(t){if(null==this){throw new TypeError("\"this\" is null or not defined")}var l=Object(this),o=l.length>>>0;if("function"!=typeof t){throw new TypeError("predicate must be a function")}var a=arguments[1],n=0;while(n<o){var r=l[n];if(t.call(a,r,n,l)){return n}n++}return-1}})}if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this){throw new TypeError("\"this\" is null or not defined")}var l=Object(this),o=l.length>>>0;if("function"!=typeof t){throw new TypeError("predicate must be a function")}var a=arguments[1],n=0;while(n<o){var r=l[n];if(t.call(a,r,n,l)){return r}n++}}})}if(!String.prototype.includes){String.prototype.includes=function(t,o){if(t instanceof RegExp){throw TypeError("first argument must not be a RegExp")}if(o===void 0){o=0}return-1!==this.indexOf(t,o)}}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function(t,l){if(null==this){throw new TypeError("\"this\" is null or not defined")}var r=Object(this),o=r.length>>>0;if(0===o){return!1}var s=0|l,n=Math.max(0<=s?s:o-Math.abs(s),0);function a(t,o){return t===o||"number"==typeof t&&"number"==typeof o&&isNaN(t)&&isNaN(o)}while(n<o){if(a(r[n],t)){return!0}n++}return!1}})}if("function"!=typeof Object.assign){Object.defineProperty(Object,"assign",{value:function(t){if(null===t||t===void 0){throw new TypeError("Cannot convert undefined or null to object")}for(var o=Object(t),l=1,a;l<arguments.length;l++){a=arguments[l];if(null!==a&&a!==void 0){for(var n in a){if(Object.prototype.hasOwnProperty.call(a,n)){o[n]=a[n]}}}}return o},writable:!0,configurable:!0})}var t=function(t){this.table=t;this.blockHozScrollEvent=!1;this.headersElement=this.createHeadersElement();this.element=this.createHeaderElement();this.rowManager=null;this.columns=[];this.columnsByIndex=[];this.columnsByField={};this.scrollLeft=0;this.element.insertBefore(this.headersElement,this.element.firstChild)};t.prototype.createHeadersElement=function(){var t=document.createElement("div");t.classList.add("tabulator-headers");return t};t.prototype.createHeaderElement=function(){var t=document.createElement("div");t.classList.add("tabulator-header");if(!this.table.options.headerVisible){t.classList.add("tabulator-header-hidden")}return t};t.prototype.initialize=function(){this};t.prototype.setRowManager=function(t){this.rowManager=t};t.prototype.getElement=function(){return this.element};t.prototype.getHeadersElement=function(){return this.headersElement};t.prototype.scrollHorizontal=function(t){var o=0,l=this.element.scrollWidth-this.table.element.clientWidth;this.element.scrollLeft=t;if(t>l){o=t-l;this.element.style.marginLeft=-o+"px"}else{this.element.style.marginLeft=0}this.scrollLeft=t;if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.scrollHorizontal()}};t.prototype.generateColumnsFromRowData=function(t){var o=[],l=this.table.options.autoColumnsDefinitions,a,n;if(t&&t.length){a=t[0];for(var r in a){var s={field:r,title:r},d=a[r];switch("undefined"==typeof d?"undefined":_typeof(d)){case"undefined":n="string";break;case"boolean":n="boolean";break;case"object":if(Array.isArray(d)){n="array"}else{n="string"}break;default:if(!isNaN(d)&&""!==d){n="number"}else{if(d.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)){n="alphanum"}else{n="string"}}break;}s.sorter=n;o.push(s)}if(l){switch("undefined"==typeof l?"undefined":_typeof(l)){case"function":this.table.options.columns=l.call(this.table,o);break;case"object":if(Array.isArray(l)){o.forEach(function(t){var o=l.find(function(o){return o.field===t.field});if(o){Object.assign(t,o)}})}else{o.forEach(function(t){if(l[t.field]){Object.assign(t,l[t.field])}})}this.table.options.columns=o;break;}}else{this.table.options.columns=o}this.setColumns(this.table.options.columns)}};t.prototype.setColumns=function(t){var o=this;while(o.headersElement.firstChild){o.headersElement.removeChild(o.headersElement.firstChild)}o.columns=[];o.columnsByIndex=[];o.columnsByField={};if(o.table.modExists("frozenColumns")){o.table.modules.frozenColumns.reset()}t.forEach(function(t){o._addColumn(t)});o._reIndexColumns();if(o.table.options.responsiveLayout&&o.table.modExists("responsiveLayout",!0)){o.table.modules.responsiveLayout.initialize()}if(this.table.options.virtualDomHoz){this.table.vdomHoz.reinitialize(!1,!0)}o.redraw(!0)};t.prototype._addColumn=function(t,o,a){var n=new l(t,this),r=n.getElement(),s=a?this.findColumnIndex(a):a;if(a&&-1<s){var d=this.columns.indexOf(a.getTopColumn()),p=a.getElement();if(o){this.columns.splice(d,0,n);p.parentNode.insertBefore(r,p)}else{this.columns.splice(d+1,0,n);p.parentNode.insertBefore(r,p.nextSibling)}}else{if(o){this.columns.unshift(n);this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)}else{this.columns.push(n);this.headersElement.appendChild(n.getElement())}n.columnRendered()}return n};t.prototype.registerColumnField=function(t){if(t.definition.field){this.columnsByField[t.definition.field]=t}};t.prototype.registerColumnPosition=function(t){this.columnsByIndex.push(t)};t.prototype._reIndexColumns=function(){this.columnsByIndex=[];this.columns.forEach(function(t){t.reRegisterPosition()})};t.prototype._verticalAlignHeaders=function(){var t=this,o=0;t.columns.forEach(function(t){var l;t.clearVerticalAlign();l=t.getHeight();if(l>o){o=l}});t.columns.forEach(function(l){l.verticalAlign(t.table.options.columnHeaderVertAlign,o)});t.rowManager.adjustTableSize()};t.prototype.findColumn=function(t){var a=this;if("object"==("undefined"==typeof t?"undefined":_typeof(t))){if(t instanceof l){return t}else if(t instanceof o){return t._getSelf()||!1}else if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement){var n=a.columns.find(function(o){return o.element===t});return n||!1}}else{return this.columnsByField[t]||!1}return!1};t.prototype.getColumnByField=function(t){return this.columnsByField[t]};t.prototype.getColumnsByFieldRoot=function(t){var o=this,l=[];Object.keys(this.columnsByField).forEach(function(a){var n=a.split(".")[0];if(n===t){l.push(o.columnsByField[a])}});return l};t.prototype.getColumnByIndex=function(t){return this.columnsByIndex[t]};t.prototype.getFirstVisibileColumn=function(t){var t=this.columnsByIndex.findIndex(function(t){return t.visible});return-1<t?this.columnsByIndex[t]:!1};t.prototype.getColumns=function(){return this.columns};t.prototype.findColumnIndex=function(t){return this.columnsByIndex.findIndex(function(o){return t===o})};t.prototype.getRealColumns=function(){return this.columnsByIndex};t.prototype.traverse=function(t){var o=this;o.columnsByIndex.forEach(function(o,l){t(o,l)})};t.prototype.getDefinitions=function(t){var o=this,l=[];o.columnsByIndex.forEach(function(o){if(!t||t&&o.visible){l.push(o.getDefinition())}});return l};t.prototype.getDefinitionTree=function(){var t=this,o=[];t.columns.forEach(function(t){o.push(t.getDefinition(!0))});return o};t.prototype.getComponents=function(t){var o=this,l=[],a=t?o.columns:o.columnsByIndex;a.forEach(function(t){l.push(t.getComponent())});return l};t.prototype.getWidth=function(){var t=0;this.columnsByIndex.forEach(function(o){if(o.visible){t+=o.getWidth()}});return t};t.prototype.moveColumn=function(t,o,l){this.moveColumnActual(t,o,l);if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.initialize()}if(this.table.modExists("columnCalcs")){this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows)}o.element.parentNode.insertBefore(t.element,o.element);if(l){o.element.parentNode.insertBefore(o.element,t.element)}this._verticalAlignHeaders();this.table.rowManager.reinitialize()};t.prototype.moveColumnActual=function(t,o,l){if(t.parent.isGroup){this._moveColumnInArray(t.parent.columns,t,o,l)}else{this._moveColumnInArray(this.columns,t,o,l)}this._moveColumnInArray(this.columnsByIndex,t,o,l,!0);if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.initialize()}if(this.table.options.virtualDomHoz){this.table.vdomHoz.reinitialize(!0)}if(this.table.options.columnMoved){this.table.options.columnMoved.call(this.table,t.getComponent(),this.table.columnManager.getComponents())}if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.columns){this.table.modules.persistence.save("columns")}};t.prototype._moveColumnInArray=function(t,o,l,a,n){var r=this,s=t.indexOf(o),d,p=[];if(-1<s){t.splice(s,1);d=t.indexOf(l);if(-1<d){if(a){d=d+1}}else{d=s}t.splice(d,0,o);if(n){if(this.table.options.dataTree&&this.table.modExists("dataTree",!0)){this.table.rowManager.rows.forEach(function(t){p=p.concat(r.table.modules.dataTree.getTreeChildren(t,!1,!0))})}p=p.concat(this.table.rowManager.rows);p.forEach(function(t){if(t.cells.length){var o=t.cells.splice(s,1)[0];t.cells.splice(d,0,o)}})}}};t.prototype.scrollToColumn=function(t,o,l){var a=this,n=0,r=0,s=0,d=t.getElement();return new Promise(function(p,c){if("undefined"==typeof o){o=a.table.options.scrollToColumnPosition}if("undefined"==typeof l){l=a.table.options.scrollToColumnIfVisible}if(t.visible){switch(o){case"middle":case"center":s=-a.element.clientWidth/2;break;case"right":s=d.clientWidth-a.headersElement.clientWidth;break;}if(!l){r=d.offsetLeft;if(0<r&&r+d.offsetWidth<a.element.clientWidth){return!1}}n=d.offsetLeft+s;n=Math.max(Math.min(n,a.table.rowManager.element.scrollWidth-a.table.rowManager.element.clientWidth),0);a.table.rowManager.scrollHorizontal(n);a.scrollHorizontal(n);p()}else{console.warn("Scroll Error - Column not visible");c("Scroll Error - Column not visible")}})};t.prototype.generateCells=function(t){var o=this,l=[];o.columnsByIndex.forEach(function(o){l.push(o.generateCell(t))});return l};t.prototype.getFlexBaseWidth=function(){var t=this,o=t.table.element.clientWidth,l=0;if(t.rowManager.element.scrollHeight>t.rowManager.element.clientHeight){o-=t.rowManager.element.offsetWidth-t.rowManager.element.clientWidth}this.columnsByIndex.forEach(function(a){var n,r,s;if(a.visible){n=a.definition.width||0;r="undefined"==typeof a.minWidth?t.table.options.columnMinWidth:parseInt(a.minWidth);if("string"==typeof n){if(-1<n.indexOf("%")){s=o/100*parseInt(n)}else{s=parseInt(n)}}else{s=n}l+=s>r?s:r}});return l};t.prototype.addColumn=function(t,o,l){var a=this;return new Promise(function(n){var r=a._addColumn(t,o,l);a._reIndexColumns();if(a.table.options.responsiveLayout&&a.table.modExists("responsiveLayout",!0)){a.table.modules.responsiveLayout.initialize()}if(a.table.modExists("columnCalcs")){a.table.modules.columnCalcs.recalc(a.table.rowManager.activeRows)}a.redraw(!0);if("fitColumns"!=a.table.modules.layout.getMode()){r.reinitializeWidth()}a._verticalAlignHeaders();a.table.rowManager.reinitialize();if(a.table.options.virtualDomHoz){a.table.vdomHoz.reinitialize()}n(r)})};t.prototype.deregisterColumn=function(t){var o=t.getField(),l;if(o){delete this.columnsByField[o]}l=this.columnsByIndex.indexOf(t);if(-1<l){this.columnsByIndex.splice(l,1)}l=this.columns.indexOf(t);if(-1<l){this.columns.splice(l,1)}if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.initialize()}this._verticalAlignHeaders();this.redraw()};t.prototype.redraw=function(t){if(t){if(u.prototype.helpers.elVisible(this.element)){this._verticalAlignHeaders()}this.table.rowManager.resetScroll();this.table.rowManager.reinitialize()}if(-1<["fitColumns","fitDataStretch"].indexOf(this.table.modules.layout.getMode())){this.table.modules.layout.layout()}else{if(t){this.table.modules.layout.layout()}else{if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}}}if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layout()}if(this.table.modExists("columnCalcs")){this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows)}if(t){if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.columns){this.table.modules.persistence.save("columns")}if(this.table.modExists("columnCalcs")){this.table.modules.columnCalcs.redraw()}}this.table.footerManager.redraw()};var o=function(t){this._column=t;this.type="ColumnComponent"};o.prototype.getElement=function(){return this._column.getElement()};o.prototype.getDefinition=function(){return this._column.getDefinition()};o.prototype.getField=function(){return this._column.getField()};o.prototype.getCells=function(){var t=[];this._column.cells.forEach(function(o){t.push(o.getComponent())});return t};o.prototype.getVisibility=function(){console.warn("getVisibility function is deprecated, you should now use the isVisible function");return this._column.visible};o.prototype.isVisible=function(){return this._column.visible};o.prototype.show=function(){if(this._column.isGroup){this._column.columns.forEach(function(t){t.show()})}else{this._column.show()}};o.prototype.hide=function(){if(this._column.isGroup){this._column.columns.forEach(function(t){t.hide()})}else{this._column.hide()}};o.prototype.toggle=function(){if(this._column.visible){this.hide()}else{this.show()}};o.prototype.delete=function(){return this._column.delete()};o.prototype.getSubColumns=function(){var t=[];if(this._column.columns.length){this._column.columns.forEach(function(o){t.push(o.getComponent())})}return t};o.prototype.getParentColumn=function(){return this._column.parent instanceof l?this._column.parent.getComponent():!1};o.prototype._getSelf=function(){return this._column};o.prototype.scrollTo=function(){return this._column.table.columnManager.scrollToColumn(this._column)};o.prototype.getTable=function(){return this._column.table};o.prototype.headerFilterFocus=function(){if(this._column.table.modExists("filter",!0)){this._column.table.modules.filter.setHeaderFilterFocus(this._column)}};o.prototype.reloadHeaderFilter=function(){if(this._column.table.modExists("filter",!0)){this._column.table.modules.filter.reloadHeaderFilter(this._column)}};o.prototype.getHeaderFilterValue=function(){if(this._column.table.modExists("filter",!0)){return this._column.table.modules.filter.getHeaderFilterValue(this._column)}};o.prototype.setHeaderFilterValue=function(t){if(this._column.table.modExists("filter",!0)){this._column.table.modules.filter.setHeaderFilterValue(this._column,t)}};o.prototype.move=function(t,o){var l=this._column.table.columnManager.findColumn(t);if(l){this._column.table.columnManager.moveColumn(this._column,l,o)}else{console.warn("Move Error - No matching column found:",l)}};o.prototype.getNextColumn=function(){var t=this._column.nextColumn();return t?t.getComponent():!1};o.prototype.getPrevColumn=function(){var t=this._column.prevColumn();return t?t.getComponent():!1};o.prototype.updateDefinition=function(t){return this._column.updateDefinition(t)};o.prototype.getWidth=function(){return this._column.getWidth()};o.prototype.setWidth=function(t){var o;if(!0===t){o=this._column.reinitializeWidth(!0)}else{o=this._column.setWidth(t)}if(this._column.table.options.virtualDomHoz){this._column.table.vdomHoz.reinitialize(!0)}return o};o.prototype.validate=function(){return this._column.validate()};var l=function t(o,l){var a=this;this.table=l.table;this.definition=o;this.parent=l;this.type="column";this.columns=[];this.cells=[];this.element=this.createElement();this.contentElement=!1;this.titleHolderElement=!1;this.titleElement=!1;this.groupElement=this.createGroupElement();this.isGroup=!1;this.tooltip=!1;this.hozAlign="";this.vertAlign="";this.field="";this.fieldStructure="";this.getFieldValue="";this.setFieldValue="";this.titleFormatterRendered=!1;this.setField(this.definition.field);if(this.table.options.invalidOptionWarnings){this.checkDefinition()}this.modules={};this.cellEvents={cellClick:!1,cellDblClick:!1,cellContext:!1,cellTap:!1,cellDblTap:!1,cellTapHold:!1,cellMouseEnter:!1,cellMouseLeave:!1,cellMouseOver:!1,cellMouseOut:!1,cellMouseMove:!1};this.width=null;this.widthStyled="";this.maxWidth=null;this.maxWidthStyled="";this.minWidth=null;this.minWidthStyled="";this.widthFixed=!1;this.visible=!0;this.component=null;this._mapDepricatedFunctionality();if(o.columns){this.isGroup=!0;o.columns.forEach(function(o){var l=new t(o,a);a.attachColumn(l)});a.checkColumnVisibility()}else{l.registerColumnField(this)}if(o.rowHandle&&!1!==this.table.options.movableRows&&this.table.modExists("moveRow")){this.table.modules.moveRow.setHandle(!0)}this._buildHeader();this.bindModuleColumns()};l.prototype.createElement=function(){var t=document.createElement("div");t.classList.add("tabulator-col");t.setAttribute("role","columnheader");t.setAttribute("aria-sort","none");return t};l.prototype.createGroupElement=function(){var t=document.createElement("div");t.classList.add("tabulator-col-group-cols");return t};l.prototype.checkDefinition=function(){var t=this;Object.keys(this.definition).forEach(function(o){if(-1===t.defaultOptionList.indexOf(o)){console.warn("Invalid column definition option in '"+(t.field||t.definition.title)+"' column:",o)}})};l.prototype.setField=function(t){this.field=t;this.fieldStructure=t?this.table.options.nestedFieldSeparator?t.split(this.table.options.nestedFieldSeparator):[t]:[];this.getFieldValue=1<this.fieldStructure.length?this._getNestedData:this._getFlatData;this.setFieldValue=1<this.fieldStructure.length?this._setNestedData:this._setFlatData};l.prototype.registerColumnPosition=function(t){this.parent.registerColumnPosition(t)};l.prototype.registerColumnField=function(t){this.parent.registerColumnField(t)};l.prototype.reRegisterPosition=function(){if(this.isGroup){this.columns.forEach(function(t){t.reRegisterPosition()})}else{this.registerColumnPosition(this)}};l.prototype._mapDepricatedFunctionality=function(){if("undefined"!=typeof this.definition.hideInHtml){this.definition.htmlOutput=!this.definition.hideInHtml;console.warn("hideInHtml column definition property is deprecated, you should now use htmlOutput")}if("undefined"!=typeof this.definition.align){this.definition.hozAlign=this.definition.align;console.warn("align column definition property is deprecated, you should now use hozAlign")}if("undefined"!=typeof this.definition.downloadTitle){this.definition.titleDownload=this.definition.downloadTitle;console.warn("downloadTitle definition property is deprecated, you should now use titleDownload")}};l.prototype.setTooltip=function(){var t=this,o=t.definition,l=o.headerTooltip||!1===o.tooltip?o.headerTooltip:t.table.options.tooltipsHeader;if(l){if(!0===l){if(o.field){t.table.modules.localize.bind("columns|"+o.field,function(l){t.element.setAttribute("title",l||o.title)})}else{t.element.setAttribute("title",o.title)}}else{if("function"==typeof l){l=l(t.getComponent());if(!1===l){l=""}}t.element.setAttribute("title",l)}}else{t.element.setAttribute("title","")}};l.prototype._buildHeader=function(){var t=this,o=t.definition;while(t.element.firstChild){t.element.removeChild(t.element.firstChild)}if(o.headerVertical){t.element.classList.add("tabulator-col-vertical");if("flip"===o.headerVertical){t.element.classList.add("tabulator-col-vertical-flip")}}t.contentElement=t._bindEvents();t.contentElement=t._buildColumnHeaderContent();t.element.appendChild(t.contentElement);if(t.isGroup){t._buildGroupHeader()}else{t._buildColumnHeader()}t.setTooltip();if(t.table.options.resizableColumns&&t.table.modExists("resizeColumns")){t.table.modules.resizeColumns.initializeColumn("header",t,t.element)}if(o.headerFilter&&t.table.modExists("filter")&&t.table.modExists("edit")){if("undefined"!=typeof o.headerFilterPlaceholder&&o.field){t.table.modules.localize.setHeaderFilterColumnPlaceholder(o.field,o.headerFilterPlaceholder)}t.table.modules.filter.initializeColumn(t)}if(t.table.modExists("frozenColumns")){t.table.modules.frozenColumns.initializeColumn(t)}if(t.table.options.movableColumns&&!t.isGroup&&t.table.modExists("moveColumn")){t.table.modules.moveColumn.initializeColumn(t)}if((o.topCalc||o.bottomCalc)&&t.table.modExists("columnCalcs")){t.table.modules.columnCalcs.initializeColumn(t)}if(t.table.modExists("persistence")&&t.table.modules.persistence.config.columns){t.table.modules.persistence.initializeColumn(t)}t.element.addEventListener("mouseenter",function(){t.setTooltip()})};l.prototype._bindEvents=function(){var t=this,o=t.definition,l,a,n;if("function"==typeof o.headerClick){t.element.addEventListener("click",function(l){o.headerClick(l,t.getComponent())})}if("function"==typeof o.headerDblClick){t.element.addEventListener("dblclick",function(l){o.headerDblClick(l,t.getComponent())})}if("function"==typeof o.headerContext){t.element.addEventListener("contextmenu",function(l){o.headerContext(l,t.getComponent())})}if("function"==typeof o.headerTap){n=!1;t.element.addEventListener("touchstart",function(){n=!0},{passive:!0});t.element.addEventListener("touchend",function(l){if(n){o.headerTap(l,t.getComponent())}n=!1})}if("function"==typeof o.headerDblTap){l=null;t.element.addEventListener("touchend",function(a){if(l){clearTimeout(l);l=null;o.headerDblTap(a,t.getComponent())}else{l=setTimeout(function(){clearTimeout(l);l=null},300)}})}if("function"==typeof o.headerTapHold){a=null;t.element.addEventListener("touchstart",function(l){clearTimeout(a);a=setTimeout(function(){clearTimeout(a);a=null;n=!1;o.headerTapHold(l,t.getComponent())},1e3)},{passive:!0});t.element.addEventListener("touchend",function(){clearTimeout(a);a=null})}if("function"==typeof o.cellClick){t.cellEvents.cellClick=o.cellClick}if("function"==typeof o.cellDblClick){t.cellEvents.cellDblClick=o.cellDblClick}if("function"==typeof o.cellContext){t.cellEvents.cellContext=o.cellContext}if("function"==typeof o.cellMouseEnter){t.cellEvents.cellMouseEnter=o.cellMouseEnter}if("function"==typeof o.cellMouseLeave){t.cellEvents.cellMouseLeave=o.cellMouseLeave}if("function"==typeof o.cellMouseOver){t.cellEvents.cellMouseOver=o.cellMouseOver}if("function"==typeof o.cellMouseOut){t.cellEvents.cellMouseOut=o.cellMouseOut}if("function"==typeof o.cellMouseMove){t.cellEvents.cellMouseMove=o.cellMouseMove}if("function"==typeof o.cellTap){t.cellEvents.cellTap=o.cellTap}if("function"==typeof o.cellDblTap){t.cellEvents.cellDblTap=o.cellDblTap}if("function"==typeof o.cellTapHold){t.cellEvents.cellTapHold=o.cellTapHold}if("function"==typeof o.cellEdited){t.cellEvents.cellEdited=o.cellEdited}if("function"==typeof o.cellEditing){t.cellEvents.cellEditing=o.cellEditing}if("function"==typeof o.cellEditCancelled){t.cellEvents.cellEditCancelled=o.cellEditCancelled}};l.prototype._buildColumnHeader=function(){var t=this,o=this.definition,l=this.table;if(l.modExists("sort")){l.modules.sort.initializeColumn(this,this.titleHolderElement)}if((o.headerContextMenu||o.headerClickMenu||o.headerMenu)&&l.modExists("menu")){l.modules.menu.initializeColumnHeader(this)}if(l.modExists("format")){l.modules.format.initializeColumn(this)}if("undefined"!=typeof o.editor&&l.modExists("edit")){l.modules.edit.initializeColumn(this)}if("undefined"!=typeof o.validator&&l.modExists("validate")){l.modules.validate.initializeColumn(this)}if(l.modExists("mutator")){l.modules.mutator.initializeColumn(this)}if(l.modExists("accessor")){l.modules.accessor.initializeColumn(this)}if(_typeof(l.options.responsiveLayout)&&l.modExists("responsiveLayout")){l.modules.responsiveLayout.initializeColumn(this)}if("undefined"!=typeof o.visible){if(o.visible){this.show(!0)}else{this.hide(!0)}}if(o.cssClass){var a=o.cssClass.split(" ");a.forEach(function(o){t.element.classList.add(o)})}if(o.field){this.element.setAttribute("tabulator-field",o.field)}this.setMinWidth("undefined"==typeof o.minWidth?this.table.options.columnMinWidth:parseInt(o.minWidth));if(o.maxWidth||this.table.options.columnMaxWidth){if(!1!==o.maxWidth){this.setMaxWidth("undefined"==typeof o.maxWidth?this.table.options.columnMaxWidth:parseInt(o.maxWidth))}}this.reinitializeWidth();this.tooltip=this.definition.tooltip||!1===this.definition.tooltip?this.definition.tooltip:this.table.options.tooltips;this.hozAlign="undefined"==typeof this.definition.hozAlign?this.table.options.cellHozAlign:this.definition.hozAlign;this.vertAlign="undefined"==typeof this.definition.vertAlign?this.table.options.cellVertAlign:this.definition.vertAlign;this.titleElement.style.textAlign=this.definition.headerHozAlign||this.table.options.headerHozAlign};l.prototype._buildColumnHeaderContent=function(){var t=this.definition,o=this.table,l=document.createElement("div");l.classList.add("tabulator-col-content");this.titleHolderElement=document.createElement("div");this.titleHolderElement.classList.add("tabulator-col-title-holder");l.appendChild(this.titleHolderElement);this.titleElement=this._buildColumnHeaderTitle();this.titleHolderElement.appendChild(this.titleElement);return l};l.prototype._buildColumnHeaderTitle=function(){var t=this,o=t.definition,l=t.table,a=document.createElement("div");a.classList.add("tabulator-col-title");if(o.editableTitle){var n=document.createElement("input");n.classList.add("tabulator-title-editor");n.addEventListener("click",function(t){t.stopPropagation();n.focus()});n.addEventListener("change",function(){o.title=n.value;l.options.columnTitleChanged.call(t.table,t.getComponent())});a.appendChild(n);if(o.field){l.modules.localize.bind("columns|"+o.field,function(t){n.value=t||o.title||"&nbsp;"})}else{n.value=o.title||"&nbsp;"}}else{if(o.field){l.modules.localize.bind("columns|"+o.field,function(l){t._formatColumnHeaderTitle(a,l||o.title||"&nbsp;")})}else{t._formatColumnHeaderTitle(a,o.title||"&nbsp;")}}return a};l.prototype._formatColumnHeaderTitle=function(t,o){var l=this,a,n,r,s,d;if(this.definition.titleFormatter&&this.table.modExists("format")){a=this.table.modules.format.getFormatter(this.definition.titleFormatter);d=function(t){l.titleFormatterRendered=t};s={getValue:function(){return o},getElement:function(){return t}};r=this.definition.titleFormatterParams||{};r="function"==typeof r?r():r;n=a.call(this.table.modules.format,s,r,d);switch("undefined"==typeof n?"undefined":_typeof(n)){case"object":if(n instanceof Node){t.appendChild(n)}else{t.innerHTML="";console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",n)}break;case"undefined":case"null":t.innerHTML="";break;default:t.innerHTML=n;}}else{t.innerHTML=o}};l.prototype._buildGroupHeader=function(){var t=this;this.element.classList.add("tabulator-col-group");this.element.setAttribute("role","columngroup");this.element.setAttribute("aria-title",this.definition.title);if(this.definition.cssClass){var o=this.definition.cssClass.split(" ");o.forEach(function(o){t.element.classList.add(o)})}if((this.definition.headerContextMenu||this.definition.headerMenu)&&this.table.modExists("menu")){this.table.modules.menu.initializeColumnHeader(this)}this.titleElement.style.textAlign=this.definition.headerHozAlign||this.table.options.headerHozAlign;this.element.appendChild(this.groupElement)};l.prototype._getFlatData=function(t){return t[this.field]};l.prototype._getNestedData=function(t){for(var o=t,l=this.fieldStructure,a=l.length,n,r=0;r<a;r++){o=o[l[r]];n=o;if(!o){break}}return n};l.prototype._setFlatData=function(t,o){if(this.field){t[this.field]=o}};l.prototype._setNestedData=function(t,o){for(var l=t,a=this.fieldStructure,n=a.length,r=0;r<n;r++){if(r==n-1){l[a[r]]=o}else{if(!l[a[r]]){if("undefined"!=typeof o){l[a[r]]={}}else{break}}l=l[a[r]]}}};l.prototype.attachColumn=function(t){var o=this;if(o.groupElement){o.columns.push(t);o.groupElement.appendChild(t.getElement())}else{console.warn("Column Warning - Column being attached to another column instead of column group")}};l.prototype.verticalAlign=function(t,o){var l=this.parent.isGroup?this.parent.getGroupElement().clientHeight:o||this.parent.getHeadersElement().clientHeight;this.element.style.height=l+"px";if(this.isGroup){this.groupElement.style.minHeight=l-this.contentElement.offsetHeight+"px"}if(!this.isGroup&&"top"!==t){if("bottom"===t){this.element.style.paddingTop=this.element.clientHeight-this.contentElement.offsetHeight+"px"}else{this.element.style.paddingTop=(this.element.clientHeight-this.contentElement.offsetHeight)/2+"px"}}this.columns.forEach(function(o){o.verticalAlign(t)})};l.prototype.clearVerticalAlign=function(){this.element.style.paddingTop="";this.element.style.height="";this.element.style.minHeight="";this.groupElement.style.minHeight="";this.columns.forEach(function(t){t.clearVerticalAlign()})};l.prototype.bindModuleColumns=function(){if("rownum"==this.definition.formatter){this.table.rowManager.rowNumColumn=this}};l.prototype.getElement=function(){return this.element};l.prototype.getGroupElement=function(){return this.groupElement};l.prototype.getField=function(){return this.field};l.prototype.getFirstColumn=function(){if(!this.isGroup){return this}else{if(this.columns.length){return this.columns[0].getFirstColumn()}else{return!1}}};l.prototype.getLastColumn=function(){if(!this.isGroup){return this}else{if(this.columns.length){return this.columns[this.columns.length-1].getLastColumn()}else{return!1}}};l.prototype.getColumns=function(){return this.columns};l.prototype.getCells=function(){return this.cells};l.prototype.getTopColumn=function(){if(this.parent.isGroup){return this.parent.getTopColumn()}else{return this}};l.prototype.getDefinition=function(t){var o=[];if(this.isGroup&&t){this.columns.forEach(function(t){o.push(t.getDefinition(!0))});this.definition.columns=o}return this.definition};l.prototype.checkColumnVisibility=function(){var t=!1;this.columns.forEach(function(o){if(o.visible){t=!0}});if(t){this.show();this.parent.table.options.columnVisibilityChanged.call(this.table,this.getComponent(),!1)}else{this.hide()}};l.prototype.show=function(t,o){if(!this.visible){this.visible=!0;this.element.style.display="";if(this.parent.isGroup){this.parent.checkColumnVisibility()}this.cells.forEach(function(t){t.show()});if(!this.isGroup&&null===this.width){this.reinitializeWidth()}this.table.columnManager._verticalAlignHeaders();if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.columns){this.table.modules.persistence.save("columns")}if(!o&&this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.updateColumnVisibility(this,this.visible)}if(!t){this.table.options.columnVisibilityChanged.call(this.table,this.getComponent(),!0)}if(this.parent.isGroup){this.parent.matchChildWidths()}if(!this.silent&&this.table.options.virtualDomHoz){this.table.vdomHoz.reinitialize()}}};l.prototype.hide=function(t,o){if(this.visible){this.visible=!1;this.element.style.display="none";this.table.columnManager._verticalAlignHeaders();if(this.parent.isGroup){this.parent.checkColumnVisibility()}this.cells.forEach(function(t){t.hide()});if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.columns){this.table.modules.persistence.save("columns")}if(!o&&this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.updateColumnVisibility(this,this.visible)}if(!t){this.table.options.columnVisibilityChanged.call(this.table,this.getComponent(),!1)}if(this.parent.isGroup){this.parent.matchChildWidths()}if(!this.silent&&this.table.options.virtualDomHoz){this.table.vdomHoz.reinitialize()}}};l.prototype.matchChildWidths=function(){var t=0;if(this.contentElement&&this.columns.length){this.columns.forEach(function(o){if(o.visible){t+=o.getWidth()}});this.contentElement.style.maxWidth=t-1+"px";if(this.parent.isGroup){this.parent.matchChildWidths()}}};l.prototype.removeChild=function(t){var o=this.columns.indexOf(t);if(-1<o){this.columns.splice(o,1)}if(!this.columns.length){this.delete()}};l.prototype.setWidth=function(t){this.widthFixed=!0;this.setWidthActual(t)};l.prototype.setWidthActual=function(t){if(isNaN(t)){t=Math.floor(this.table.element.clientWidth/100*parseInt(t))}t=Math.max(this.minWidth,t);if(this.maxWidth){t=Math.min(this.maxWidth,t)}this.width=t;this.widthStyled=t?t+"px":"";this.element.style.width=this.widthStyled;if(!this.isGroup){this.cells.forEach(function(t){t.setWidth()})}if(this.parent.isGroup){this.parent.matchChildWidths()}if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layout()}};l.prototype.checkCellHeights=function(){var t=[];this.cells.forEach(function(o){if(o.row.heightInitialized){if(null!==o.row.getElement().offsetParent){t.push(o.row);o.row.clearCellHeight()}else{o.row.heightInitialized=!1}}});t.forEach(function(t){t.calcHeight()});t.forEach(function(t){t.setCellHeight()})};l.prototype.getWidth=function(){var t=0;if(this.isGroup){this.columns.forEach(function(o){if(o.visible){t+=o.getWidth()}})}else{t=this.width}return t};l.prototype.getHeight=function(){return this.element.offsetHeight};l.prototype.setMinWidth=function(t){this.minWidth=t;this.minWidthStyled=t?t+"px":"";this.element.style.minWidth=this.minWidthStyled;this.cells.forEach(function(t){t.setMinWidth()})};l.prototype.setMaxWidth=function(t){this.maxWidth=t;this.maxWidthStyled=t?t+"px":"";this.element.style.maxWidth=this.maxWidthStyled;this.cells.forEach(function(t){t.setMaxWidth()})};l.prototype.delete=function(){var t=this;return new Promise(function(o){if(t.isGroup){t.columns.forEach(function(t){t.delete()})}if(t.table.modExists("edit")){if(t.table.modules.edit.currentCell.column===t){t.table.modules.edit.cancelEdit()}}for(var l=t.cells.length,a=0;a<l;a++){t.cells[0].delete()}if(t.element.parentNode){t.element.parentNode.removeChild(t.element)}t.element=!1;t.contentElement=!1;t.titleElement=!1;t.groupElement=!1;if(t.parent.isGroup){t.parent.removeChild(t)}t.table.columnManager.deregisterColumn(t);if(t.table.options.virtualDomHoz){t.table.vdomHoz.reinitialize(!0)}o()})};l.prototype.columnRendered=function(){if(this.titleFormatterRendered){this.titleFormatterRendered()}};l.prototype.validate=function(){var t=[];this.cells.forEach(function(o){if(!o.validate()){t.push(o.getComponent())}});return t.length?t:!0};l.prototype.generateCell=function(t){var o=this,l=new p(o,t);this.cells.push(l);return l};l.prototype.nextColumn=function(){var t=this.table.columnManager.findColumnIndex(this);return-1<t?this._nextVisibleColumn(t+1):!1};l.prototype._nextVisibleColumn=function(t){var o=this.table.columnManager.getColumnByIndex(t);return!o||o.visible?o:this._nextVisibleColumn(t+1)};l.prototype.prevColumn=function(){var t=this.table.columnManager.findColumnIndex(this);return-1<t?this._prevVisibleColumn(t-1):!1};l.prototype._prevVisibleColumn=function(t){var o=this.table.columnManager.getColumnByIndex(t);return!o||o.visible?o:this._prevVisibleColumn(t-1)};l.prototype.reinitializeWidth=function(t){this.widthFixed=!1;if("undefined"!=typeof this.definition.width&&!t){this.setWidth(this.definition.width)}if(this.table.modExists("filter")){this.table.modules.filter.hideHeaderFilterElements()}this.fitToData();if(this.table.modExists("filter")){this.table.modules.filter.showHeaderFilterElements()}};l.prototype.fitToData=function(){var t=this;if(!this.widthFixed){this.element.style.width="";t.cells.forEach(function(t){t.clearWidth()})}var o=this.element.offsetWidth;if(!t.width||!this.widthFixed){t.cells.forEach(function(t){var l=t.getWidth();if(l>o){o=l}});if(o){t.setWidthActual(o+1)}}};l.prototype.updateDefinition=function(t){var o=this;return new Promise(function(l,a){var n;if(!o.isGroup){if(!o.parent.isGroup){n=Object.assign({},o.getDefinition());n=Object.assign(n,t);o.table.columnManager.addColumn(n,!1,o).then(function(t){if(n.field==o.field){o.field=!1}o.delete().then(function(){l(t.getComponent())}).catch(function(t){a(t)})}).catch(function(t){a(t)})}else{console.warn("Column Update Error - The updateDefinition function is only available on ungrouped columns");a("Column Update Error - The updateDefinition function is only available on columns, not column groups")}}else{console.warn("Column Update Error - The updateDefinition function is only available on ungrouped columns");a("Column Update Error - The updateDefinition function is only available on columns, not column groups")}})};l.prototype.deleteCell=function(t){var o=this.cells.indexOf(t);if(-1<o){this.cells.splice(o,1)}};l.prototype.defaultOptionList=["title","field","columns","visible","align","hozAlign","vertAlign","width","minWidth","maxWidth","widthGrow","widthShrink","resizable","frozen","responsive","tooltip","cssClass","rowHandle","hideInHtml","print","htmlOutput","sorter","sorterParams","formatter","formatterParams","variableHeight","editable","editor","editorParams","validator","mutator","mutatorParams","mutatorData","mutatorDataParams","mutatorEdit","mutatorEditParams","mutatorClipboard","mutatorClipboardParams","accessor","accessorParams","accessorData","accessorDataParams","accessorDownload","accessorDownloadParams","accessorClipboard","accessorClipboardParams","accessorPrint","accessorPrintParams","accessorHtmlOutput","accessorHtmlOutputParams","clipboard","download","downloadTitle","topCalc","topCalcParams","topCalcFormatter","topCalcFormatterParams","bottomCalc","bottomCalcParams","bottomCalcFormatter","bottomCalcFormatterParams","cellClick","cellDblClick","cellContext","cellTap","cellDblTap","cellTapHold","cellMouseEnter","cellMouseLeave","cellMouseOver","cellMouseOut","cellMouseMove","cellEditing","cellEdited","cellEditCancelled","headerSort","headerSortStartingDir","headerSortTristate","headerClick","headerDblClick","headerContext","headerTap","headerDblTap","headerTapHold","headerTooltip","headerVertical","headerHozAlign","editableTitle","titleFormatter","titleFormatterParams","headerFilter","headerFilterPlaceholder","headerFilterParams","headerFilterEmptyCheck","headerFilterFunc","headerFilterFuncParams","headerFilterLiveFilter","print","headerContextMenu","headerMenu","contextMenu","clickMenu","formatterPrint","formatterPrintParams","formatterClipboard","formatterClipboardParams","formatterHtmlOutput","formatterHtmlOutputParams","titlePrint","titleClipboard","titleHtmlOutput","titleDownload"];l.prototype.getComponent=function(){if(!this.component){this.component=new o(this)}return this.component};var a=function(t){this.table=t;this.element=this.createHolderElement();this.tableElement=this.createTableElement();this.heightFixer=this.createTableElement();this.columnManager=null;this.height=0;this.firstRender=!1;this.renderMode="virtual";this.fixedHeight=!1;this.rows=[];this.activeRows=[];this.activeRowsCount=0;this.displayRows=[];this.displayRowsCount=0;this.scrollTop=0;this.scrollLeft=0;this.vDomRowHeight=20;this.vDomTop=0;this.vDomBottom=0;this.vDomScrollPosTop=0;this.vDomScrollPosBottom=0;this.vDomTopPad=0;this.vDomBottomPad=0;this.vDomMaxRenderChain=90;this.vDomWindowBuffer=0;this.vDomWindowMinTotalRows=20;this.vDomWindowMinMarginRows=5;this.vDomTopNewRows=[];this.vDomBottomNewRows=[];this.rowNumColumn=!1;this.redrawBlock=!1;this.redrawBlockRestoreConfig=!1;this.redrawBlockRederInPosition=!1};a.prototype.createHolderElement=function(){var t=document.createElement("div");t.classList.add("tabulator-tableHolder");t.setAttribute("tabindex",0);return t};a.prototype.createTableElement=function(){var t=document.createElement("div");t.classList.add("tabulator-table");return t};a.prototype.getElement=function(){return this.element};a.prototype.getTableElement=function(){return this.tableElement};a.prototype.getRowPosition=function(t,o){if(o){return this.activeRows.indexOf(t)}else{return this.rows.indexOf(t)}};a.prototype.setColumnManager=function(t){this.columnManager=t};a.prototype.initialize=function(){var t=this;t.setRenderMode();t.element.appendChild(t.tableElement);t.firstRender=!0;t.element.addEventListener("scroll",function(){var o=t.element.scrollLeft;if(t.scrollLeft!=o){t.columnManager.scrollHorizontal(o);if(t.table.options.groupBy){t.table.modules.groupRows.scrollHeaders(o)}if(t.table.modExists("columnCalcs")){t.table.modules.columnCalcs.scrollHorizontal(o)}t.table.options.scrollHorizontal(o)}t.scrollLeft=o});if("virtual"===this.renderMode){t.element.addEventListener("scroll",function(){var o=t.element.scrollTop,l=t.scrollTop>o;if(t.scrollTop!=o){t.scrollTop=o;t.scrollVertical(l);if("scroll"==t.table.options.ajaxProgressiveLoad){t.table.modules.ajax.nextPage(t.element.scrollHeight-t.element.clientHeight-o)}t.table.options.scrollVertical(o)}else{t.scrollTop=o}})}};a.prototype.findRow=function(t){var o=this;if("object"==("undefined"==typeof t?"undefined":_typeof(t))){if(t instanceof s){return t}else if(t instanceof r){return t._getSelf()||!1}else if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement){var l=o.rows.find(function(o){return o.getElement()===t});return l||!1}}else if("undefined"==typeof t||null===t){return!1}else{var a=o.rows.find(function(l){return l.data[o.table.options.index]==t});return a||!1}return!1};a.prototype.getRowFromDataObject=function(t){var o=this.rows.find(function(o){return o.data===t});return o||!1};a.prototype.getRowFromPosition=function(t,o){if(o){return this.activeRows[t]}else{return this.rows[t]}};a.prototype.scrollToRow=function(t,o,l){var a=this,n=this.getDisplayRows().indexOf(t),r=t.getElement(),s,d=0;return new Promise(function(t,p){if(-1<n){if("undefined"==typeof o){o=a.table.options.scrollToRowPosition}if("undefined"==typeof l){l=a.table.options.scrollToRowIfVisible}if("nearest"===o){switch(a.renderMode){case"classic":s=u.prototype.helpers.elOffset(r).top;o=Math.abs(a.element.scrollTop-s)>Math.abs(a.element.scrollTop+a.element.clientHeight-s)?"bottom":"top";break;case"virtual":o=Math.abs(a.vDomTop-n)>Math.abs(a.vDomBottom-n)?"bottom":"top";break;}}if(!l){if(u.prototype.helpers.elVisible(r)){d=u.prototype.helpers.elOffset(r).top-u.prototype.helpers.elOffset(a.element).top;if(0<d&&d<a.element.clientHeight-r.offsetHeight){return!1}}}switch(a.renderMode){case"classic":a.element.scrollTop=u.prototype.helpers.elOffset(r).top-u.prototype.helpers.elOffset(a.element).top+a.element.scrollTop;break;case"virtual":a._virtualRenderFill(n,!0);break;}switch(o){case"middle":case"center":if(a.element.scrollHeight-a.element.scrollTop==a.element.clientHeight){a.element.scrollTop=a.element.scrollTop+(r.offsetTop-a.element.scrollTop)-(a.element.scrollHeight-r.offsetTop)/2}else{a.element.scrollTop=a.element.scrollTop-a.element.clientHeight/2}break;case"bottom":if(a.element.scrollHeight-a.element.scrollTop==a.element.clientHeight){a.element.scrollTop=a.element.scrollTop-(a.element.scrollHeight-r.offsetTop)+r.offsetHeight}else{a.element.scrollTop=a.element.scrollTop-a.element.clientHeight+r.offsetHeight}break;}t()}else{console.warn("Scroll Error - Row not visible");p("Scroll Error - Row not visible")}})};a.prototype.setData=function(t,o,l){var a=this,n=this;return new Promise(function(r){if(o&&a.getDisplayRows().length){if(n.table.options.pagination){n._setDataActual(t,!0)}else{a.reRenderInPosition(function(){n._setDataActual(t)})}}else{if(a.table.options.autoColumns&&l){a.table.columnManager.generateColumnsFromRowData(t)}a.resetScroll();a._setDataActual(t)}r()})};a.prototype._setDataActual=function(t,o){var l=this;l.table.options.dataLoading.call(this.table,t);this._wipeElements();if(this.table.options.history&&this.table.modExists("history")){this.table.modules.history.clear()}if(Array.isArray(t)){if(this.table.modExists("selectRow")){this.table.modules.selectRow.clearSelectionData()}if(this.table.options.reactiveData&&this.table.modExists("reactiveData",!0)){this.table.modules.reactiveData.watchData(t)}t.forEach(function(t){if(t&&"object"===("undefined"==typeof t?"undefined":_typeof(t))){var o=new s(t,l);l.rows.push(o)}else{console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",t)}});l.refreshActiveData(!1,!1,o);l.table.options.dataLoaded.call(this.table,t)}else{console.error("Data Loading Error - Unable to process data due to invalid data type \nExpecting: array \nReceived: ","undefined"==typeof t?"undefined":_typeof(t),"\nData:     ",t)}};a.prototype._wipeElements=function(){this.rows.forEach(function(t){t.wipe()});if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.wipe()}this.rows=[];this.activeRows=[];this.activeRowsCount=0;this.displayRows=[];this.displayRowsCount=0;this.adjustTableSize()};a.prototype.deleteRow=function(t,o){var l=this.rows.indexOf(t),a=this.activeRows.indexOf(t);if(-1<a){this.activeRows.splice(a,1)}if(-1<l){this.rows.splice(l,1)}this.setActiveRows(this.activeRows);this.displayRowIterator(function(o){var l=o.indexOf(t);if(-1<l){o.splice(l,1)}});if(!o){this.reRenderInPosition()}this.regenerateRowNumbers();this.table.options.rowDeleted.call(this.table,t.getComponent());if(this.table.options.dataChanged){this.table.options.dataChanged.call(this.table,this.getData())}if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.updateGroupRows(!0)}else if(this.table.options.pagination&&this.table.modExists("page")){this.refreshActiveData(!1,!1,!0)}else{if(this.table.options.pagination&&this.table.modExists("page")){this.refreshActiveData("page")}}};a.prototype.addRow=function(t,o,l,a){var n=this.addRowActual(t,o,l,a);if(this.table.options.history&&this.table.modExists("history")){this.table.modules.history.action("rowAdd",n,{data:t,pos:o,index:l})}return n};a.prototype.addRows=function(t,o,l){var a=this,n=this,r=[];return new Promise(function(s){o=a.findAddRowPos(o);if(!Array.isArray(t)){t=[t]}t.length-1;if("undefined"==typeof l&&o||"undefined"!=typeof l&&!o){t.reverse()}t.forEach(function(t){var a=n.addRow(t,o,l,!0);r.push(a)});if(a.table.options.groupBy&&a.table.modExists("groupRows")){a.table.modules.groupRows.updateGroupRows(!0)}else if(a.table.options.pagination&&a.table.modExists("page")){a.refreshActiveData(!1,!1,!0)}else{a.reRenderInPosition()}if(a.table.modExists("columnCalcs")){a.table.modules.columnCalcs.recalc(a.table.rowManager.activeRows)}a.regenerateRowNumbers();s(r)})};a.prototype.findAddRowPos=function(t){if("undefined"==typeof t){t=this.table.options.addRowPos}if("pos"===t){t=!0}if("bottom"===t){t=!1}return t};a.prototype.addRowActual=function(t,o,l,a){var n=t instanceof s?t:new s(t||{},this),r=this.findAddRowPos(o),d=-1,p,c;if(!l&&this.table.options.pagination&&"page"==this.table.options.paginationAddRow){c=this.getDisplayRows();if(r){if(c.length){l=c[0]}else{if(this.activeRows.length){l=this.activeRows[this.activeRows.length-1];r=!1}}}else{if(c.length){l=c[c.length-1];r=c.length<this.table.modules.page.getPageSize()?!1:!0}}}if("undefined"!=typeof l){l=this.findRow(l)}if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.assignRowToGroup(n);var u=n.getGroup().rows;if(1<u.length){if(!l||l&&-1==u.indexOf(l)){if(r){if(u[0]!==n){l=u[0];this._moveRowInArray(n.getGroup().rows,n,l,!r)}}else{if(u[u.length-1]!==n){l=u[u.length-1];this._moveRowInArray(n.getGroup().rows,n,l,!r)}}}else{this._moveRowInArray(n.getGroup().rows,n,l,!r)}}}if(l){d=this.rows.indexOf(l)}if(l&&-1<d){p=this.activeRows.indexOf(l);this.displayRowIterator(function(t){var o=t.indexOf(l);if(-1<o){t.splice(r?o:o+1,0,n)}});if(-1<p){this.activeRows.splice(r?p:p+1,0,n)}this.rows.splice(r?d:d+1,0,n)}else{if(r){this.displayRowIterator(function(t){t.unshift(n)});this.activeRows.unshift(n);this.rows.unshift(n)}else{this.displayRowIterator(function(t){t.push(n)});this.activeRows.push(n);this.rows.push(n)}}this.setActiveRows(this.activeRows);this.table.options.rowAdded.call(this.table,n.getComponent());if(this.table.options.dataChanged){this.table.options.dataChanged.call(this.table,this.getData())}if(!a){this.reRenderInPosition()}return n};a.prototype.moveRow=function(t,o,l){if(this.table.options.history&&this.table.modExists("history")){this.table.modules.history.action("rowMove",t,{posFrom:this.getRowPosition(t),posTo:this.getRowPosition(o),to:o,after:l})}this.moveRowActual(t,o,l);this.regenerateRowNumbers();this.table.options.rowMoved.call(this.table,t.getComponent())};a.prototype.moveRowActual=function(t,o,l){var a=this;this._moveRowInArray(this.rows,t,o,l);this._moveRowInArray(this.activeRows,t,o,l);this.displayRowIterator(function(n){a._moveRowInArray(n,t,o,l)});if(this.table.options.groupBy&&this.table.modExists("groupRows")){if(!l&&o instanceof S){o=this.table.rowManager.prevDisplayRow(t)||o}var n=o.getGroup(),r=t.getGroup();if(n===r){this._moveRowInArray(n.rows,t,o,l)}else{if(r){r.removeRow(t)}n.insertRow(t,o,l)}}};a.prototype._moveRowInArray=function(t,o,l,a){var n,r,s,d;if(o!==l){n=t.indexOf(o);if(-1<n){t.splice(n,1);r=t.indexOf(l);if(-1<r){if(a){t.splice(r+1,0,o)}else{t.splice(r,0,o)}}else{t.splice(n,0,o)}}if(t===this.getDisplayRows()){s=n<r?n:r;d=r>n?r:n+1;for(var p=s;p<=d;p++){if(t[p]){this.styleRow(t[p],p)}}}}};a.prototype.clearData=function(){this.setData([])};a.prototype.getRowIndex=function(t){return this.findRowIndex(t,this.rows)};a.prototype.getDisplayRowIndex=function(t){var o=this.getDisplayRows().indexOf(t);return-1<o?o:!1};a.prototype.nextDisplayRow=function(t,o){var l=this.getDisplayRowIndex(t),a=!1;if(!1!==l&&l<this.displayRowsCount-1){a=this.getDisplayRows()[l+1]}if(a&&(!(a instanceof s)||"row"!=a.type)){return this.nextDisplayRow(a,o)}return a};a.prototype.prevDisplayRow=function(t,o){var l=this.getDisplayRowIndex(t),a=!1;if(l){a=this.getDisplayRows()[l-1]}if(o&&a&&(!(a instanceof s)||"row"!=a.type)){return this.prevDisplayRow(a,o)}return a};a.prototype.findRowIndex=function(t,o){var l;t=this.findRow(t);if(t){l=o.indexOf(t);if(-1<l){return l}}return!1};a.prototype.getData=function(t,o){var l=[],a=this.getRows(t);a.forEach(function(t){if("row"==t.type){l.push(t.getData(o||"data"))}});return l};a.prototype.getComponents=function(t){var o=[],l=this.getRows(t);l.forEach(function(t){o.push(t.getComponent())});return o};a.prototype.getDataCount=function(t){var o=this.getRows(t);return o.length};a.prototype._genRemoteRequest=function(){var t=this,o=this.table,l=o.options,a={};if(o.modExists("page")){if(l.ajaxSorting){var n=this.table.modules.sort.getSort();n.forEach(function(t){delete t.column});a[this.table.modules.page.paginationDataSentNames.sorters]=n}if(l.ajaxFiltering){var r=this.table.modules.filter.getFilters(!0,!0);a[this.table.modules.page.paginationDataSentNames.filters]=r}this.table.modules.ajax.setParams(a,!0)}o.modules.ajax.sendRequest().then(function(o){t._setDataActual(o,!0)}).catch(function(){})};a.prototype.filterRefresh=function(){var t=this.table,o=t.options,l=this.scrollLeft;if(o.ajaxFiltering){if("remote"==o.pagination&&t.modExists("page")){t.modules.page.reset(!0);t.modules.page.setPage(1).then(function(){}).catch(function(){})}else if(o.ajaxProgressiveLoad){t.modules.ajax.loadData().then(function(){}).catch(function(){})}else{this._genRemoteRequest()}}else{this.refreshActiveData("filter")}this.scrollHorizontal(l)};a.prototype.sorterRefresh=function(t){var o=this.table,l=this.table.options,a=this.scrollLeft;if(l.ajaxSorting){if(("remote"==l.pagination||l.progressiveLoad)&&o.modExists("page")){o.modules.page.reset(!0);o.modules.page.setPage(1).then(function(){}).catch(function(){})}else if(l.ajaxProgressiveLoad){o.modules.ajax.loadData().then(function(){}).catch(function(){})}else{this._genRemoteRequest()}}else{this.refreshActiveData(t?"filter":"sort")}this.scrollHorizontal(a)};a.prototype.scrollHorizontal=function(t){this.scrollLeft=t;this.element.scrollLeft=t;if(this.table.options.groupBy){this.table.modules.groupRows.scrollHeaders(t)}if(this.table.modExists("columnCalcs")){this.table.modules.columnCalcs.scrollHorizontal(t)}};a.prototype.refreshActiveData=function(t,o,l){var a=this,n=this.table,r=["all","filter","sort","display","freeze","group","tree","page"],s;if(this.redrawBlock){if(!this.redrawBlockRestoreConfig||r.indexOf(t)<r.indexOf(this.redrawBlockRestoreConfig.stage)){this.redrawBlockRestoreConfig={stage:t,skipStage:o,renderInPosition:l}}}else{if(a.table.modExists("edit")){a.table.modules.edit.cancelEdit()}if(!t){t="all"}if(n.options.selectable&&!n.options.selectablePersistence&&n.modExists("selectRow")){n.modules.selectRow.deselectRows()}switch(t){case"all":case"filter":if(!o){if(n.modExists("filter")){a.setActiveRows(n.modules.filter.filter(a.rows))}else{a.setActiveRows(a.rows.slice(0))}}else{o=!1}case"sort":if(!o){if(n.modExists("sort")){n.modules.sort.sort(this.activeRows)}}else{o=!1}this.regenerateRowNumbers();case"display":this.resetDisplayRows();case"freeze":if(!o){if(this.table.modExists("frozenRows")){if(n.modules.frozenRows.isFrozen()){if(!n.modules.frozenRows.getDisplayIndex()){n.modules.frozenRows.setDisplayIndex(this.getNextDisplayIndex())}s=n.modules.frozenRows.getDisplayIndex();s=a.setDisplayRows(n.modules.frozenRows.getRows(this.getDisplayRows(s-1)),s);if(!0!==s){n.modules.frozenRows.setDisplayIndex(s)}}}}else{o=!1}case"group":if(!o){if(n.options.groupBy&&n.modExists("groupRows")){if(!n.modules.groupRows.getDisplayIndex()){n.modules.groupRows.setDisplayIndex(this.getNextDisplayIndex())}s=n.modules.groupRows.getDisplayIndex();s=a.setDisplayRows(n.modules.groupRows.getRows(this.getDisplayRows(s-1)),s);if(!0!==s){n.modules.groupRows.setDisplayIndex(s)}}}else{o=!1}case"tree":if(!o){if(n.options.dataTree&&n.modExists("dataTree")){if(!n.modules.dataTree.getDisplayIndex()){n.modules.dataTree.setDisplayIndex(this.getNextDisplayIndex())}s=n.modules.dataTree.getDisplayIndex();s=a.setDisplayRows(n.modules.dataTree.getRows(this.getDisplayRows(s-1)),s);if(!0!==s){n.modules.dataTree.setDisplayIndex(s)}}}else{o=!1}if(n.options.pagination&&n.modExists("page")&&!l){if("local"==n.modules.page.getMode()){n.modules.page.reset()}}case"page":if(!o){if(n.options.pagination&&n.modExists("page")){if(!n.modules.page.getDisplayIndex()){n.modules.page.setDisplayIndex(this.getNextDisplayIndex())}s=n.modules.page.getDisplayIndex();if("local"==n.modules.page.getMode()){n.modules.page.setMaxRows(this.getDisplayRows(s-1).length)}s=a.setDisplayRows(n.modules.page.getRows(this.getDisplayRows(s-1)),s);if(!0!==s){n.modules.page.setDisplayIndex(s)}}}else{o=!1}}if(u.prototype.helpers.elVisible(a.element)){if(l){a.reRenderInPosition()}else{if("all"===t&&this.table.options.virtualDomHoz){this.table.vdomHoz.dataChange()}a.renderTable();if(n.options.layoutColumnsOnNewData){a.table.columnManager.redraw(!0)}}}if(n.modExists("columnCalcs")){n.modules.columnCalcs.recalc(this.activeRows)}}};a.prototype.regenerateRowNumbers=function(){var t=this;if(this.rowNumColumn){this.activeRows.forEach(function(o){var l=o.getCell(t.rowNumColumn);if(l){l._generateContents()}})}};a.prototype.setActiveRows=function(t){this.activeRows=t;this.activeRowsCount=this.activeRows.length};a.prototype.resetDisplayRows=function(){this.displayRows=[];this.displayRows.push(this.activeRows.slice(0));this.displayRowsCount=this.displayRows[0].length;if(this.table.modExists("frozenRows")){this.table.modules.frozenRows.setDisplayIndex(0)}if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.setDisplayIndex(0)}if(this.table.options.pagination&&this.table.modExists("page")){this.table.modules.page.setDisplayIndex(0)}};a.prototype.getNextDisplayIndex=function(){return this.displayRows.length};a.prototype.setDisplayRows=function(t,o){var l=!0;if(o&&"undefined"!=typeof this.displayRows[o]){this.displayRows[o]=t;l=!0}else{this.displayRows.push(t);l=o=this.displayRows.length-1}if(o==this.displayRows.length-1){this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}return l};a.prototype.getDisplayRows=function(t){if("undefined"==typeof t){return this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]}else{return this.displayRows[t]||[]}};a.prototype.getVisibleRows=function(t){var o=this.element.scrollTop,l=this.element.clientHeight+o,a=!1,n=0,r=0,s=this.getDisplayRows();if(t){this.getDisplayRows();for(var d=this.vDomTop;d<=this.vDomBottom;d++){if(s[d]){if(!a){if(0<=o-s[d].getElement().offsetTop){n=d}else{a=!0;if(0<=l-s[d].getElement().offsetTop){r=d}else{break}}}else{if(0<=l-s[d].getElement().offsetTop){r=d}else{break}}}}}else{n=this.vDomTop;r=this.vDomBottom}return s.slice(n,r+1)};a.prototype.displayRowIterator=function(t){this.displayRows.forEach(t);this.displayRowsCount=this.displayRows[this.displayRows.length-1].length};a.prototype.getRows=function(t){var o;switch(t){case"active":o=this.activeRows;break;case"display":o=this.table.rowManager.getDisplayRows();break;case"visible":o=this.getVisibleRows(!0);break;case"selected":o=this.table.modules.selectRow.selectedRows;break;default:o=this.rows;}return o};a.prototype.reRenderInPosition=function(t){if("virtual"==this.getRenderMode()){if(this.redrawBlock){if(t){t()}else{this.redrawBlockRederInPosition=!0}}else{for(var o=this.element.scrollTop,l=!1,a=!1,n=this.scrollLeft,r=this.getDisplayRows(),s=this.vDomTop;s<=this.vDomBottom;s++){if(r[s]){var d=o-r[s].getElement().offsetTop;if(!1===a||Math.abs(d)<a){a=d;l=s}else{break}}}if(t){t()}this._virtualRenderFill(!1===l?this.displayRowsCount-1:l,!0,a||0);this.scrollHorizontal(n)}}else{this.renderTable();if(t){t()}}};a.prototype.setRenderMode=function(){if(this.table.options.virtualDom){this.renderMode="virtual";if(this.table.element.clientHeight||this.table.options.height){this.fixedHeight=!0}else{this.fixedHeight=!1}}else{this.renderMode="classic"}};a.prototype.getRenderMode=function(){return this.renderMode};a.prototype.renderTable=function(){this.table.options.renderStarted.call(this.table);this.element.scrollTop=0;switch(this.renderMode){case"classic":this._simpleRender();break;case"virtual":this._virtualRenderFill();break;}if(this.firstRender){if(this.displayRowsCount){this.firstRender=!1;this.table.modules.layout.layout()}else{this.renderEmptyScroll()}}if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layout()}if(!this.displayRowsCount){if(this.table.options.placeholder){this.table.options.placeholder.setAttribute("tabulator-render-mode",this.renderMode);this.getElement().appendChild(this.table.options.placeholder);this.table.options.placeholder.style.width=this.table.columnManager.getWidth()+"px"}}this.table.options.renderComplete.call(this.table)};a.prototype._simpleRender=function(){this._clearVirtualDom();if(this.displayRowsCount){this.checkClassicModeGroupHeaderWidth()}else{this.renderEmptyScroll()}};a.prototype.checkClassicModeGroupHeaderWidth=function(){var t=this,o=this.tableElement,l=!0;t.getDisplayRows().forEach(function(a,n){t.styleRow(a,n);o.appendChild(a.getElement());a.initialize(!0);if("group"!==a.type){l=!1}});if(l){o.style.minWidth=t.table.columnManager.getWidth()+"px"}else{o.style.minWidth=""}};a.prototype.renderEmptyScroll=function(){if(this.table.options.placeholder){this.tableElement.style.display="none"}else{this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}};a.prototype._clearVirtualDom=function(){var t=this.tableElement;if(this.table.options.placeholder&&this.table.options.placeholder.parentNode){this.table.options.placeholder.parentNode.removeChild(this.table.options.placeholder)}while(t.firstChild){t.removeChild(t.firstChild)}t.style.paddingTop="";t.style.paddingBottom="";t.style.minWidth="";t.style.minHeight="";t.style.display="";t.style.visibility="";this.scrollTop=0;this.scrollLeft=0;this.vDomTop=0;this.vDomBottom=0;this.vDomTopPad=0;this.vDomBottomPad=0};a.prototype.styleRow=function(t,o){var l=t.getElement();if(o%2){l.classList.add("tabulator-row-even");l.classList.remove("tabulator-row-odd")}else{l.classList.add("tabulator-row-odd");l.classList.remove("tabulator-row-even")}};a.prototype._virtualRenderFill=function(t,o,l){var a=this,n=a.tableElement,r=a.element,s=0,d=0,p=0,c=0,m=!0,g=a.getDisplayRows();t=t||0;l=l||0;if(!t){a._clearVirtualDom()}else{while(n.firstChild){n.removeChild(n.firstChild)}var h=(a.displayRowsCount-t+1)*a.vDomRowHeight;if(h<a.height){t-=Math.ceil((a.height-h)/a.vDomRowHeight);if(0>t){t=0}}s=Math.min(Math.max(Math.floor(a.vDomWindowBuffer/a.vDomRowHeight),a.vDomWindowMinMarginRows),t);t-=s}if(a.displayRowsCount&&u.prototype.helpers.elVisible(a.element)){a.vDomTop=t;a.vDomBottom=t-1;while((d<=a.height+a.vDomWindowBuffer||c<a.vDomWindowMinTotalRows)&&a.vDomBottom<a.displayRowsCount-1){var b=a.vDomBottom+1,f=g[b],y=0;a.styleRow(f,b);n.appendChild(f.getElement());f.initialize();if(!f.heightInitialized){f.normalizeHeight(!0)}y=f.getHeight();if(c<s){p+=y}else{d+=y}if(y>this.vDomWindowBuffer){this.vDomWindowBuffer=2*y}if("group"!==f.type){m=!1}a.vDomBottom++;c++}if(!t){this.vDomTopPad=0;a.vDomRowHeight=Math.floor((d+p)/c);a.vDomBottomPad=a.vDomRowHeight*(a.displayRowsCount-a.vDomBottom-1);a.vDomScrollHeight=p+d+a.vDomBottomPad-a.height}else{a.vDomTopPad=!o?a.scrollTop-p:a.vDomRowHeight*this.vDomTop+l;a.vDomBottomPad=a.vDomBottom==a.displayRowsCount-1?0:Math.max(a.vDomScrollHeight-a.vDomTopPad-d-p,0)}n.style.paddingTop=a.vDomTopPad+"px";n.style.paddingBottom=a.vDomBottomPad+"px";if(o){this.scrollTop=a.vDomTopPad+p+l-(this.element.scrollWidth>this.element.clientWidth?this.element.offsetHeight-this.element.clientHeight:0)}this.scrollTop=Math.min(this.scrollTop,this.element.scrollHeight-this.height);if(this.element.scrollWidth>this.element.offsetWidth&&o){this.scrollTop+=this.element.offsetHeight-this.element.clientHeight}this.vDomScrollPosTop=this.scrollTop;this.vDomScrollPosBottom=this.scrollTop;r.scrollTop=this.scrollTop;n.style.minWidth=m?a.table.columnManager.getWidth()+"px":"";if(a.table.options.groupBy){if("fitDataFill"!=a.table.modules.layout.getMode()&&a.displayRowsCount==a.table.modules.groupRows.countGroups()){a.tableElement.style.minWidth=a.table.columnManager.getWidth()}}}else{this.renderEmptyScroll()}if(!this.fixedHeight){this.adjustTableSize()}};a.prototype.scrollVertical=function(t){var o=this.scrollTop-this.vDomScrollPosTop,l=this.scrollTop-this.vDomScrollPosBottom,a=2*this.vDomWindowBuffer;if(-o>a||l>a){var n=this.scrollLeft;this._virtualRenderFill(Math.floor(this.element.scrollTop/this.element.scrollHeight*this.displayRowsCount));this.scrollHorizontal(n)}else{if(t){if(0>o){this._addTopRow(-o)}if(0>l){if(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer){this._removeBottomRow(-l)}else{this.vDomScrollPosBottom=this.scrollTop}}}else{if(0<=o){if(this.scrollTop>this.vDomWindowBuffer){this._removeTopRow(o)}else{this.vDomScrollPosTop=this.scrollTop}}if(0<=l){this._addBottomRow(l)}}}};a.prototype._addTopRow=function(t){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,l=this.tableElement,a=this.getDisplayRows();if(this.vDomTop){var n=this.vDomTop-1,r=a[n],s=r.getHeight()||this.vDomRowHeight;if(t>=s){this.styleRow(r,n);l.insertBefore(r.getElement(),l.firstChild);if(!r.initialized||!r.heightInitialized){this.vDomTopNewRows.push(r);if(!r.heightInitialized){r.clearCellHeight()}}r.initialize();this.vDomTopPad-=s;if(0>this.vDomTopPad){this.vDomTopPad=n*this.vDomRowHeight}if(!n){this.vDomTopPad=0}l.style.paddingTop=this.vDomTopPad+"px";this.vDomScrollPosTop-=s;this.vDomTop--}t=-(this.scrollTop-this.vDomScrollPosTop);if(r.getHeight()>this.vDomWindowBuffer){this.vDomWindowBuffer=2*r.getHeight()}if(o<this.vDomMaxRenderChain&&this.vDomTop&&t>=(a[this.vDomTop-1].getHeight()||this.vDomRowHeight)){this._addTopRow(t,o+1)}else{this._quickNormalizeRowHeight(this.vDomTopNewRows)}}};a.prototype._removeTopRow=function(t){var o=this.tableElement,l=this.getDisplayRows()[this.vDomTop],a=l.getHeight()||this.vDomRowHeight;if(t>=a){var n=l.getElement();n.parentNode.removeChild(n);this.vDomTopPad+=a;o.style.paddingTop=this.vDomTopPad+"px";this.vDomScrollPosTop+=this.vDomTop?a:a+this.vDomWindowBuffer;this.vDomTop++;t=this.scrollTop-this.vDomScrollPosTop;this._removeTopRow(t)}};a.prototype._addBottomRow=function(t){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,l=this.tableElement,a=this.getDisplayRows();if(this.vDomBottom<this.displayRowsCount-1){var n=this.vDomBottom+1,r=a[n],s=r.getHeight()||this.vDomRowHeight;if(t>=s){this.styleRow(r,n);l.appendChild(r.getElement());if(!r.initialized||!r.heightInitialized){this.vDomBottomNewRows.push(r);if(!r.heightInitialized){r.clearCellHeight()}}r.initialize();this.vDomBottomPad-=s;if(0>this.vDomBottomPad||n==this.displayRowsCount-1){this.vDomBottomPad=0}l.style.paddingBottom=this.vDomBottomPad+"px";this.vDomScrollPosBottom+=s;this.vDomBottom++}t=this.scrollTop-this.vDomScrollPosBottom;if(r.getHeight()>this.vDomWindowBuffer){this.vDomWindowBuffer=2*r.getHeight()}if(o<this.vDomMaxRenderChain&&this.vDomBottom<this.displayRowsCount-1&&t>=(a[this.vDomBottom+1].getHeight()||this.vDomRowHeight)){this._addBottomRow(t,o+1)}else{this._quickNormalizeRowHeight(this.vDomBottomNewRows)}}};a.prototype._removeBottomRow=function(t){var o=this.tableElement,l=this.getDisplayRows()[this.vDomBottom],a=l.getHeight()||this.vDomRowHeight;if(t>=a){var n=l.getElement();if(n.parentNode){n.parentNode.removeChild(n)}this.vDomBottomPad+=a;if(0>this.vDomBottomPad){this.vDomBottomPad=0}o.style.paddingBottom=this.vDomBottomPad+"px";this.vDomScrollPosBottom-=a;this.vDomBottom--;t=-(this.scrollTop-this.vDomScrollPosBottom);this._removeBottomRow(t)}};a.prototype._quickNormalizeRowHeight=function(t){t.forEach(function(t){t.calcHeight()});t.forEach(function(t){t.setCellHeight()});t.length=0};a.prototype.normalizeHeight=function(){this.activeRows.forEach(function(t){t.normalizeHeight()})};a.prototype.adjustTableSize=function(){var t=this.element.clientHeight,o;if("virtual"===this.renderMode){var l=Math.floor(this.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){this.element.style.minHeight="calc(100% - "+l+"px)";this.element.style.height="calc(100% - "+l+"px)";this.element.style.maxHeight="calc(100% - "+l+"px)"}else{this.element.style.height="";this.element.style.height=this.table.element.clientHeight-l+"px";this.element.scrollTop=this.scrollTop}this.height=this.element.clientHeight;this.vDomWindowBuffer=this.table.options.virtualDomBuffer||this.height;if(!this.fixedHeight&&t!=this.element.clientHeight){o=this.table.modExists("resizeTable");if(o&&!this.table.modules.resizeTable.autoResize||!o){this.redraw()}}}};a.prototype.reinitialize=function(){this.rows.forEach(function(t){t.reinitialize(!0)})};a.prototype.blockRedraw=function(){this.redrawBlock=!0;this.redrawBlockRestoreConfig=!1};a.prototype.restoreRedraw=function(){this.redrawBlock=!1;if(this.redrawBlockRestoreConfig){this.refreshActiveData(this.redrawBlockRestoreConfig.stage,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition);this.redrawBlockRestoreConfig=!1}else{if(this.redrawBlockRederInPosition){this.reRenderInPosition()}}this.redrawBlockRederInPosition=!1};a.prototype.redraw=function(t){var o=this.scrollLeft;this.adjustTableSize();this.table.tableWidth=this.table.element.clientWidth;if(!t){if("classic"==this.renderMode){if(this.table.options.groupBy){this.refreshActiveData("group",!1,!1)}else{this._simpleRender()}}else{this.reRenderInPosition();this.scrollHorizontal(o)}if(!this.displayRowsCount){if(this.table.options.placeholder){this.getElement().appendChild(this.table.options.placeholder)}}}else{this.renderTable()}};a.prototype.resetScroll=function(){this.element.scrollLeft=0;this.element.scrollTop=0;if("ie"===this.table.browser){var t=document.createEvent("Event");t.initEvent("scroll",!1,!0);this.element.dispatchEvent(t)}else{this.element.dispatchEvent(new Event("scroll"))}};var n=function(t){this.table=t;this.element=this.table.rowManager.tableElement;this.holderEl=this.table.rowManager.element;this.leftCol=0;this.rightCol=0;this.scrollLeft=0;this.vDomScrollPosLeft=0;this.vDomScrollPosRight=0;this.vDomPadLeft=0;this.vDomPadRight=0;this.fitDataColAvg=0;this.window=200;this.initialized=!1;this.columns=[];if(this.compatabilityCheck()){this.initialize()}};n.prototype.compatabilityCheck=function(){var t=this.table.options,o=!1,l=!0;if("fitDataTable"==t.layout){console.warn("Horizontal Vitrual DOM is not compatible with fitDataTable layout mode");l=!1}if(t.responsiveLayout){console.warn("Horizontal Vitrual DOM is not compatible with responsive columns");l=!1}if(this.table.rtl){console.warn("Horizontal Vitrual DOM is not currently compatible with RTL text direction");l=!1}if(t.columns){o=t.columns.find(function(t){return t.frozen});if(o){console.warn("Horizontal Vitrual DOM is not compatible with frozen columns");l=!1}}if(!l){t.virtualDomHoz=!1}return l};n.prototype.initialize=function(){var t=this;this.holderEl.addEventListener("scroll",function(){var o=t.holderEl.scrollLeft;if(t.scrollLeft!=o){t.scrollLeft=o;t.scroll(o-(t.vDomScrollPosLeft+t.window))}})};n.prototype.deinitialize=function(){this.initialized=!1};n.prototype.clear=function(){this.columns=[];this.leftCol=-1;this.rightCol=0;this.vDomScrollPosLeft=0;this.vDomScrollPosRight=0;this.vDomPadLeft=0;this.vDomPadRight=0};n.prototype.dataChange=function(){var t=!1,o=0,l=0,a,n,r;if("fitData"===this.table.options.layout){this.table.columnManager.columnsByIndex.forEach(function(o){if(!o.definition.width&&o.visible){t=!0}});if(t){if(t&&this.table.rowManager.getDisplayRows().length){this.vDomScrollPosRight=this.scrollLeft+this.holderEl.clientWidth+this.window;if(this.table.options.groupBy){a=this.table.modules.groupRows.getGroups(!1)[0];n=a.getRows(!1)[0]}else{n=this.table.rowManager.getDisplayRows()[0]}if(n){r=n.getElement();n.generateCells();this.element.appendChild(r);for(var l=0,s;l<n.cells.length;l++){s=n.cells[l];r.appendChild(s.getElement());s.column.reinitializeWidth();o+=s.column.getWidth();if(o>this.vDomScrollPosRight){break}}r.parentNode.removeChild(r);this.fitDataColAvg=Math.floor(o/(l+1));for(l;l<this.table.columnManager.columnsByIndex.length;l++){this.table.columnManager.columnsByIndex[l].setWidth(this.fitDataColAvg)}this.reinitialize(!1,!0)}}}}else{if("fitColumns"===this.table.options.layout){this.table.modules.layout.layout();this.table.vdomHoz.reinitialize(!1,!0)}}};n.prototype.fitDataLayoutOverride=function(){for(var t=this.leftCol;t<=this.rightCol;t++){this.columns[t].reinitializeWidth()}};n.prototype.reinitialize=function(t,o){var l=this,a={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol};if(t&&!this.initialized){return}this.clear();this.scrollLeft=this.holderEl.scrollLeft;this.vDomScrollPosLeft=this.scrollLeft-this.window;this.vDomScrollPosRight=this.scrollLeft+this.holderEl.clientWidth+this.window;var n=0;this.table.columnManager.columnsByIndex.forEach(function(t){var o={};if(t.visible){var a=t.getWidth();o.leftPos=n;o.rightPos=n+a;if(n+a>l.vDomScrollPosLeft&&n<l.vDomScrollPosRight){if(-1==l.leftCol){l.leftCol=l.columns.length;l.vDomPadLeft=n}l.rightCol=l.columns.length}else{if(-1!==l.leftCol){l.vDomPadRight+=a}}l.columns.push(t);t.modules.vdomHoz=o;n+=a}});this.element.style.paddingLeft=this.vDomPadLeft+"px";this.element.style.paddingRight=this.vDomPadRight+"px";this.initialized=!0;if(!o){if(!t||this.reinitChanged(a)){this.renitializeRows()}}this.holderEl.scrollLeft=this.scrollLeft};n.prototype.reinitChanged=function(t){var o=this,l=!0;if(t.cols.length!==this.columns.length||t.leftCol!==this.leftCol||t.rightCol!==this.rightCol){return!0}t.cols.forEach(function(t,a){if(t!==o.columns[a]){l=!1}});return!l};n.prototype.renitializeRows=function(){var t=this,o=this.table.rowManager.getVisibleRows();o.forEach(function(o){t.reinitializeRow(o,!0)})};n.prototype.scroll=function(t){this.vDomScrollPosLeft+=t;this.vDomScrollPosRight+=t;if(t>.8*this.holderEl.clientWidth){this.reinitialize()}else{if(0<t){this.addColRight();this.removeColLeft()}else{this.addColLeft();this.removeColRight()}}};n.prototype.colPositionAdjust=function(t,o,l){for(var a=t,n;a<o;a++){n=this.columns[a];n.modules.vdomHoz.leftPos-=l;n.modules.vdomHoz.rightPos-=l}};n.prototype.addColRight=function(){var t=this.columns[this.rightCol+1],o,l,a;if(t&&t.modules.vdomHoz.leftPos<=this.vDomScrollPosRight){o=this.table.rowManager.getVisibleRows();o.forEach(function(o){if("group"!==o.type){var l=o.getCell(t);o.getElement().appendChild(l.getElement());l.cellRendered()}});if(this.fitDataColAvg){l=t.getWidth();if(l===this.fitDataColAvg){t.reinitializeWidth();a=l-t.getWidth();if(a){t.modules.vdomHoz.rightPos-=a;this.colPositionAdjust(this.rightCol+1,this.columns.length,a)}}}this.rightCol++;if(this.rightCol>=this.columns.length-1){this.vDomPadRight=0}else{this.vDomPadRight-=t.getWidth()}this.element.style.paddingRight=this.vDomPadRight+"px";this.addColRight()}};n.prototype.addColLeft=function(){var t=this.columns[this.leftCol-1],o;if(t&&t.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){var o=this.table.rowManager.getVisibleRows();o.forEach(function(o){if("group"!==o.type){var l=o.getCell(t);o.getElement().prepend(l.getElement());l.cellRendered()}});if(!this.leftCol){this.vDomPadLeft=0}else{this.vDomPadLeft-=t.getWidth()}this.element.style.paddingLeft=this.vDomPadLeft+"px";this.leftCol--;this.addColLeft()}};n.prototype.removeColRight=function(t){var t=this.columns[this.rightCol],o;if(t&&t.modules.vdomHoz.leftPos>this.vDomScrollPosRight){o=this.table.rowManager.getVisibleRows();t.modules.vdomHoz.visible=!1;o.forEach(function(o){if("group"!==o.type){var l=o.getCell(t);o.getElement().removeChild(l.getElement())}});this.vDomPadRight+=t.getWidth();this.element.style.paddingRight=this.vDomPadRight+"px";this.rightCol--;this.removeColRight()}};n.prototype.removeColLeft=function(){var t=this.columns[this.leftCol],o;if(t&&t.modules.vdomHoz.rightPos<this.vDomScrollPosLeft){o=this.table.rowManager.getVisibleRows();o.forEach(function(o){if("group"!==o.type){var l=o.getCell(t);o.getElement().removeChild(l.getElement())}});this.vDomPadLeft+=t.getWidth();this.element.style.paddingLeft=this.vDomPadLeft+"px";this.leftCol++;this.removeColLeft()}};n.prototype.initializeRow=function(t){if("group"!==t.type){t.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol};for(var o=this.leftCol,l;o<=this.rightCol;o++){l=this.columns[o];if(l&&l.visible){var a=t.getCell(l);t.getElement().appendChild(a.getElement());a.cellRendered()}}}};n.prototype.reinitializeRow=function(t,o){if("group"!==t.type){if(o||!t.modules.vdomHoz||t.modules.vdomHoz.leftCol!==this.leftCol||t.modules.vdomHoz.rightCol!==this.rightCol){var l=t.getElement();while(l.firstChild){l.removeChild(l.firstChild)}this.initializeRow(t)}}};var r=function(t){this._row=t};r.prototype.getData=function(t){return this._row.getData(t)};r.prototype.getElement=function(){return this._row.getElement()};r.prototype.getCells=function(){var t=[];this._row.getCells().forEach(function(o){t.push(o.getComponent())});return t};r.prototype.getCell=function(t){var o=this._row.getCell(t);return o?o.getComponent():!1};r.prototype.getIndex=function(){return this._row.getData("data")[this._row.table.options.index]};r.prototype.getPosition=function(t){return this._row.table.rowManager.getRowPosition(this._row,t)};r.prototype.delete=function(){return this._row.delete()};r.prototype.scrollTo=function(){return this._row.table.rowManager.scrollToRow(this._row)};r.prototype.pageTo=function(){if(this._row.table.modExists("page",!0)){return this._row.table.modules.page.setPageToRow(this._row)}};r.prototype.move=function(t,o){this._row.moveToRow(t,o)};r.prototype.update=function(t){return this._row.updateData(t)};r.prototype.normalizeHeight=function(){this._row.normalizeHeight(!0)};r.prototype.select=function(){this._row.table.modules.selectRow.selectRows(this._row)};r.prototype.deselect=function(){this._row.table.modules.selectRow.deselectRows(this._row)};r.prototype.toggleSelect=function(){this._row.table.modules.selectRow.toggleRow(this._row)};r.prototype.isSelected=function(){return this._row.table.modules.selectRow.isRowSelected(this._row)};r.prototype._getSelf=function(){return this._row};r.prototype.validate=function(){return this._row.validate()};r.prototype.freeze=function(){if(this._row.table.modExists("frozenRows",!0)){this._row.table.modules.frozenRows.freezeRow(this._row)}};r.prototype.unfreeze=function(){if(this._row.table.modExists("frozenRows",!0)){this._row.table.modules.frozenRows.unfreezeRow(this._row)}};r.prototype.isFrozen=function(){if(this._row.table.modExists("frozenRows",!0)){var t=this._row.table.modules.frozenRows.rows.indexOf(this._row);return-1<t}return!1};r.prototype.treeCollapse=function(){if(this._row.table.modExists("dataTree",!0)){this._row.table.modules.dataTree.collapseRow(this._row)}};r.prototype.treeExpand=function(){if(this._row.table.modExists("dataTree",!0)){this._row.table.modules.dataTree.expandRow(this._row)}};r.prototype.treeToggle=function(){if(this._row.table.modExists("dataTree",!0)){this._row.table.modules.dataTree.toggleRow(this._row)}};r.prototype.getTreeParent=function(){if(this._row.table.modExists("dataTree",!0)){return this._row.table.modules.dataTree.getTreeParent(this._row)}return!1};r.prototype.getTreeChildren=function(){if(this._row.table.modExists("dataTree",!0)){return this._row.table.modules.dataTree.getTreeChildren(this._row,!0)}return!1};r.prototype.addTreeChild=function(t,o,l){if(this._row.table.modExists("dataTree",!0)){return this._row.table.modules.dataTree.addTreeChildRow(this._row,t,o,l)}return!1};r.prototype.reformat=function(){return this._row.reinitialize()};r.prototype.getGroup=function(){return this._row.getGroup().getComponent()};r.prototype.getTable=function(){return this._row.table};r.prototype.getNextRow=function(){var t=this._row.nextRow();return t?t.getComponent():t};r.prototype.getPrevRow=function(){var t=this._row.prevRow();return t?t.getComponent():t};var s=function(t,o){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"row";this.table=o.table;this.parent=o;this.data={};this.type=l;this.element=!1;this.modules={};this.cells=[];this.height=0;this.heightStyled="";this.manualHeight=!1;this.outerHeight=0;this.initialized=!1;this.heightInitialized=!1;this.component=null;this.created=!1;this.setData(t)};s.prototype.create=function(){if(!this.created){this.created=!0;this.generateElement()}};s.prototype.createElement=function(){var t=document.createElement("div");t.classList.add("tabulator-row");t.setAttribute("role","row");this.element=t};s.prototype.getElement=function(){this.create();return this.element};s.prototype.detachElement=function(){if(this.element&&this.element.parentNode){this.element.parentNode.removeChild(this.element)}};s.prototype.generateElement=function(){var t=this,o,l,a;this.createElement();if(!1!==t.table.options.selectable&&t.table.modExists("selectRow")){t.table.modules.selectRow.initializeRow(this)}if(!1!==t.table.options.movableRows&&t.table.modExists("moveRow")){t.table.modules.moveRow.initializeRow(this)}if(!1!==t.table.options.dataTree&&t.table.modExists("dataTree")){t.table.modules.dataTree.initializeRow(this)}if("collapse"===t.table.options.responsiveLayout&&t.table.modExists("responsiveLayout")){t.table.modules.responsiveLayout.initializeRow(this)}if((t.table.options.rowContextMenu||t.table.options.rowClickMenu)&&this.table.modExists("menu")){t.table.modules.menu.initializeRow(this)}if(t.table.options.rowClick){t.element.addEventListener("click",function(o){t.table.options.rowClick(o,t.getComponent())})}if(t.table.options.rowDblClick){t.element.addEventListener("dblclick",function(o){t.table.options.rowDblClick(o,t.getComponent())})}if(t.table.options.rowContext){t.element.addEventListener("contextmenu",function(o){t.table.options.rowContext(o,t.getComponent())})}if(t.table.options.rowMouseEnter){t.element.addEventListener("mouseenter",function(o){t.table.options.rowMouseEnter(o,t.getComponent())})}if(t.table.options.rowMouseLeave){t.element.addEventListener("mouseleave",function(o){t.table.options.rowMouseLeave(o,t.getComponent())})}if(t.table.options.rowMouseOver){t.element.addEventListener("mouseover",function(o){t.table.options.rowMouseOver(o,t.getComponent())})}if(t.table.options.rowMouseOut){t.element.addEventListener("mouseout",function(o){t.table.options.rowMouseOut(o,t.getComponent())})}if(t.table.options.rowMouseMove){t.element.addEventListener("mousemove",function(o){t.table.options.rowMouseMove(o,t.getComponent())})}if(t.table.options.rowTap){a=!1;t.element.addEventListener("touchstart",function(){a=!0},{passive:!0});t.element.addEventListener("touchend",function(o){if(a){t.table.options.rowTap(o,t.getComponent())}a=!1})}if(t.table.options.rowDblTap){o=null;t.element.addEventListener("touchend",function(l){if(o){clearTimeout(o);o=null;t.table.options.rowDblTap(l,t.getComponent())}else{o=setTimeout(function(){clearTimeout(o);o=null},300)}})}if(t.table.options.rowTapHold){l=null;t.element.addEventListener("touchstart",function(o){clearTimeout(l);l=setTimeout(function(){clearTimeout(l);l=null;a=!1;t.table.options.rowTapHold(o,t.getComponent())},1e3)},{passive:!0});t.element.addEventListener("touchend",function(){clearTimeout(l);l=null})}};s.prototype.generateCells=function(){this.cells=this.table.columnManager.generateCells(this)};s.prototype.initialize=function(t){var o=this;this.create();if(!this.initialized||t){this.deleteCells();while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layoutRow(this)}this.generateCells();if(this.table.options.virtualDomHoz&&this.table.vdomHoz.initialized){this.table.vdomHoz.initializeRow(this)}else{this.cells.forEach(function(t){o.element.appendChild(t.getElement());t.cellRendered()})}if(t){this.normalizeHeight()}if(this.table.options.dataTree&&this.table.modExists("dataTree")){this.table.modules.dataTree.layoutRow(this)}if("collapse"===this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout")){this.table.modules.responsiveLayout.layoutRow(this)}if(this.table.options.rowFormatter){this.table.options.rowFormatter(this.getComponent())}if(this.table.options.resizableRows&&this.table.modExists("resizeRows")){this.table.modules.resizeRows.initializeRow(this)}this.initialized=!0}else{if(this.table.options.virtualDomHoz){this.table.vdomHoz.reinitializeRow(this)}}};s.prototype.reinitializeHeight=function(){this.heightInitialized=!1;if(this.element&&null!==this.element.offsetParent){this.normalizeHeight(!0)}};s.prototype.reinitialize=function(){this.initialized=!1;this.heightInitialized=!1;if(!this.manualHeight){this.height=0;this.heightStyled=""}if(this.element&&null!==this.element.offsetParent){this.initialize(!0)}if(this.table.options.dataTree&&this.table.modExists("dataTree",!0)){this.table.modules.dataTree.getTreeChildren(this,!1,!0).forEach(function(t){t.reinitialize(!0)})}};s.prototype.calcHeight=function(t){var o=0,l=this.table.options.resizableRows?this.element.clientHeight:0;this.cells.forEach(function(t){var l=t.getHeight();if(l>o){o=l}});if(t){this.height=Math.max(o,l)}else{this.height=this.manualHeight?this.height:Math.max(o,l)}this.heightStyled=this.height?this.height+"px":"";this.outerHeight=this.element.offsetHeight};s.prototype.setCellHeight=function(){this.cells.forEach(function(t){t.setHeight()});this.heightInitialized=!0};s.prototype.clearCellHeight=function(){this.cells.forEach(function(t){t.clearHeight()})};s.prototype.normalizeHeight=function(t){if(t){this.clearCellHeight()}this.calcHeight(t);this.setCellHeight()};s.prototype.setHeight=function(t,o){if(this.height!=t||o){this.manualHeight=!0;this.height=t;this.heightStyled=t?t+"px":"";this.setCellHeight();this.outerHeight=this.element.offsetHeight}};s.prototype.getHeight=function(){return this.outerHeight};s.prototype.getWidth=function(){return this.element.offsetWidth};s.prototype.deleteCell=function(t){var o=this.cells.indexOf(t);if(-1<o){this.cells.splice(o,1)}};s.prototype.setData=function(t){if(this.table.modExists("mutator")){t=this.table.modules.mutator.transformRow(t,"data")}this.data=t;if(this.table.options.reactiveData&&this.table.modExists("reactiveData",!0)){this.table.modules.reactiveData.watchRow(this)}};s.prototype.updateData=function(t){var o=this,l=this.element&&u.prototype.helpers.elVisible(this.element),a={},n;return new Promise(function(r){if("string"==typeof t){t=JSON.parse(t)}if(o.table.options.reactiveData&&o.table.modExists("reactiveData",!0)){o.table.modules.reactiveData.block()}if(o.table.modExists("mutator")){a=Object.assign(a,o.data);a=Object.assign(a,t);n=o.table.modules.mutator.transformRow(a,"data",t)}else{n=t}for(var s in n){o.data[s]=n[s]}if(o.table.options.reactiveData&&o.table.modExists("reactiveData",!0)){o.table.modules.reactiveData.unblock()}for(var s in t){var d=o.table.columnManager.getColumnsByFieldRoot(s);d.forEach(function(t){var a=o.getCell(t.getField());if(a){var r=t.getFieldValue(n);if(a.getValue()!=r){a.setValueProcessData(r);if(l){a.cellRendered()}}}})}if(o.table.options.groupUpdateOnCellEdit&&o.table.options.groupBy&&o.table.modExists("groupRows")){o.table.modules.groupRows.reassignRowToGroup(o.row)}if(l){o.normalizeHeight(!0);if(o.table.options.rowFormatter){o.table.options.rowFormatter(o.getComponent())}}else{o.initialized=!1;o.height=0;o.heightStyled=""}if(!1!==o.table.options.dataTree&&o.table.modExists("dataTree")&&o.table.modules.dataTree.redrawNeeded(t)){o.table.modules.dataTree.initializeRow(o);if(l){o.table.modules.dataTree.layoutRow(o);o.table.rowManager.refreshActiveData("tree",!1,!0)}}o.table.options.rowUpdated.call(o.table,o.getComponent());if(o.table.options.dataChanged){o.table.options.dataChanged.call(o.table,o.table.rowManager.getData())}r()})};s.prototype.getData=function(t){if(t){if(this.table.modExists("accessor")){return this.table.modules.accessor.transformRow(this,t)}}return this.data};s.prototype.getCell=function(t){var o=!1;t=this.table.columnManager.findColumn(t);o=this.cells.find(function(o){return o.column===t});return o};s.prototype.getCellIndex=function(t){return this.cells.findIndex(function(o){return o===t})};s.prototype.findNextEditableCell=function(t){var o=!1;if(t<this.cells.length-1){for(var l=t+1,a;l<this.cells.length;l++){a=this.cells[l];if(a.column.modules.edit&&u.prototype.helpers.elVisible(a.getElement())){var n=!0;if("function"==typeof a.column.modules.edit.check){n=a.column.modules.edit.check(a.getComponent())}if(n){o=a;break}}}}return o};s.prototype.findPrevEditableCell=function(t){var o=!1;if(0<t){for(var l=t-1;0<=l;l--){var a=this.cells[l],n=!0;if(a.column.modules.edit&&u.prototype.helpers.elVisible(a.getElement())){if("function"==typeof a.column.modules.edit.check){n=a.column.modules.edit.check(a.getComponent())}if(n){o=a;break}}}}return o};s.prototype.getCells=function(){return this.cells};s.prototype.nextRow=function(){var t=this.table.rowManager.nextDisplayRow(this,!0);return t||!1};s.prototype.prevRow=function(){var t=this.table.rowManager.prevDisplayRow(this,!0);return t||!1};s.prototype.moveToRow=function(t,o){var l=this.table.rowManager.findRow(t);if(l){this.table.rowManager.moveRowActual(this,l,!o);this.table.rowManager.refreshActiveData("display",!1,!0)}else{console.warn("Move Error - No matching row found:",t)}};s.prototype.validate=function(){var t=[];this.cells.forEach(function(o){if(!o.validate()){t.push(o.getComponent())}});return t.length?t:!0};s.prototype.delete=function(){var t=this;return new Promise(function(o){var l,a;if(t.table.options.history&&t.table.modExists("history")){if(t.table.options.groupBy&&t.table.modExists("groupRows")){a=t.getGroup().rows;l=a.indexOf(t);if(l){l=a[l-1]}}else{l=t.table.rowManager.getRowIndex(t);if(l){l=t.table.rowManager.rows[l-1]}}t.table.modules.history.action("rowDelete",t,{data:t.getData(),pos:!l,index:l})}t.deleteActual();o()})};s.prototype.deleteActual=function(t){this.table.rowManager.getRowIndex(this);this.detatchModules();if(this.table.options.reactiveData&&this.table.modExists("reactiveData",!0)){}if(this.modules.group){this.modules.group.removeRow(this)}this.table.rowManager.deleteRow(this,t);this.deleteCells();this.initialized=!1;this.heightInitialized=!1;this.element=!1;if(this.table.options.dataTree&&this.table.modExists("dataTree",!0)){this.table.modules.dataTree.rowDelete(this)}if(this.table.modExists("columnCalcs")){if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.columnCalcs.recalcRowGroup(this)}else{this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows)}}};s.prototype.detatchModules=function(){if(this.table.modExists("selectRow")){this.table.modules.selectRow._deselectRow(this,!0)}if(this.table.modExists("edit")){if(this.table.modules.edit.currentCell.row===this){this.table.modules.edit.cancelEdit()}}if(this.table.modExists("frozenRows")){this.table.modules.frozenRows.detachRow(this)}};s.prototype.deleteCells=function(){for(var t=this.cells.length,o=0;o<t;o++){this.cells[0].delete()}};s.prototype.wipe=function(){this.detatchModules();this.deleteCells();if(this.element){while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}if(this.element.parentNode){this.element.parentNode.removeChild(this.element)}}this.element=!1;this.modules={}};s.prototype.getGroup=function(){return this.modules.group||!1};s.prototype.getComponent=function(){if(!this.component){this.component=new r(this)}return this.component};var d=function(t){this._cell=t};d.prototype.getValue=function(){return this._cell.getValue()};d.prototype.getOldValue=function(){return this._cell.getOldValue()};d.prototype.getInitialValue=function(){return this._cell.initialValue};d.prototype.getElement=function(){return this._cell.getElement()};d.prototype.getRow=function(){return this._cell.row.getComponent()};d.prototype.getData=function(){return this._cell.row.getData()};d.prototype.getField=function(){return this._cell.column.getField()};d.prototype.getColumn=function(){return this._cell.column.getComponent()};d.prototype.setValue=function(t,o){if("undefined"==typeof o){o=!0}this._cell.setValue(t,o)};d.prototype.restoreOldValue=function(){this._cell.setValueActual(this._cell.getOldValue())};d.prototype.restoreInitialValue=function(){this._cell.setValueActual(this._cell.initialValue)};d.prototype.edit=function(t){return this._cell.edit(t)};d.prototype.cancelEdit=function(){this._cell.cancelEdit()};d.prototype.isEdited=function(){return!!this._cell.modules.edit&&this._cell.modules.edit.edited};d.prototype.clearEdited=function(){if(self.table.modExists("edit",!0)){this._cell.table.modules.edit.clearEdited(this._cell)}};d.prototype.isValid=function(){return this._cell.modules.validate?!this._cell.modules.validate.invalid:!0};d.prototype.validate=function(){return this._cell.validate()};d.prototype.clearValidation=function(){if(this._cell.table.modExists("validate",!0)){this._cell.table.modules.validate.clearValidation(this._cell)}};d.prototype.nav=function(){return this._cell.nav()};d.prototype.checkHeight=function(){this._cell.checkHeight()};d.prototype.getTable=function(){return this._cell.table};d.prototype._getSelf=function(){return this._cell};var p=function(t,o){this.table=t.table;this.column=t;this.row=o;this.element=null;this.value=null;this.initialValue;this.oldValue=null;this.modules={};this.height=null;this.width=null;this.minWidth=null;this.component=null;this.loaded=!1;this.build()};p.prototype.build=function(){this.generateElement();this.setWidth();this._configureCell();this.setValueActual(this.column.getFieldValue(this.row.data));this.initialValue=this.value};p.prototype.generateElement=function(){this.element=document.createElement("div");this.element.className="tabulator-cell";this.element.setAttribute("role","gridcell");this.element=this.element};p.prototype._configureCell=function(){var t=this,o=t.column.cellEvents,l=t.element,a=this.column.getField();l.style.textAlign=t.column.hozAlign;if(t.column.vertAlign){l.style.display="inline-flex";l.style.alignItems={top:"flex-start",bottom:"flex-end",middle:"center"}[t.column.vertAlign]||"";if(t.column.hozAlign){l.style.justifyContent={left:"flex-start",right:"flex-end",center:"center"}[t.column.hozAlign]||""}}if(a){l.setAttribute("tabulator-field",a)}if(t.column.definition.cssClass){var n=t.column.definition.cssClass.split(" ");n.forEach(function(t){l.classList.add(t)})}if("hover"===this.table.options.tooltipGenerationMode){l.addEventListener("mouseenter",function(){t._generateTooltip()})}t._bindClickEvents(o);t._bindTouchEvents(o);t._bindMouseEvents(o);if(t.column.modules.edit){t.table.modules.edit.bindEditor(t)}if(t.column.definition.rowHandle&&!1!==t.table.options.movableRows&&t.table.modExists("moveRow")){t.table.modules.moveRow.initializeCell(t)}if(!t.column.visible){t.hide()}};p.prototype._bindClickEvents=function(t){var o=this,l=o.element;if(t.cellClick||o.table.options.cellClick){l.addEventListener("click",function(l){var a=o.getComponent();if(t.cellClick){t.cellClick.call(o.table,l,a)}if(o.table.options.cellClick){o.table.options.cellClick.call(o.table,l,a)}})}if(t.cellDblClick||this.table.options.cellDblClick){l.addEventListener("dblclick",function(l){var a=o.getComponent();if(t.cellDblClick){t.cellDblClick.call(o.table,l,a)}if(o.table.options.cellDblClick){o.table.options.cellDblClick.call(o.table,l,a)}})}else{l.addEventListener("dblclick",function(t){if(o.table.modExists("edit")){if(o.table.modules.edit.currentCell===o){return}}t.preventDefault();try{if(document.selection){var l=document.body.createTextRange();l.moveToElementText(o.element);l.select()}else if(window.getSelection){var l=document.createRange();l.selectNode(o.element);window.getSelection().removeAllRanges();window.getSelection().addRange(l)}}catch(t){}})}if(t.cellContext||this.table.options.cellContext){l.addEventListener("contextmenu",function(l){var a=o.getComponent();if(t.cellContext){t.cellContext.call(o.table,l,a)}if(o.table.options.cellContext){o.table.options.cellContext.call(o.table,l,a)}})}};p.prototype._bindMouseEvents=function(t){var o=this,l=o.element;if(t.cellMouseEnter||o.table.options.cellMouseEnter){l.addEventListener("mouseenter",function(l){var a=o.getComponent();if(t.cellMouseEnter){t.cellMouseEnter.call(o.table,l,a)}if(o.table.options.cellMouseEnter){o.table.options.cellMouseEnter.call(o.table,l,a)}})}if(t.cellMouseLeave||o.table.options.cellMouseLeave){l.addEventListener("mouseleave",function(l){var a=o.getComponent();if(t.cellMouseLeave){t.cellMouseLeave.call(o.table,l,a)}if(o.table.options.cellMouseLeave){o.table.options.cellMouseLeave.call(o.table,l,a)}})}if(t.cellMouseOver||o.table.options.cellMouseOver){l.addEventListener("mouseover",function(l){var a=o.getComponent();if(t.cellMouseOver){t.cellMouseOver.call(o.table,l,a)}if(o.table.options.cellMouseOver){o.table.options.cellMouseOver.call(o.table,l,a)}})}if(t.cellMouseOut||o.table.options.cellMouseOut){l.addEventListener("mouseout",function(l){var a=o.getComponent();if(t.cellMouseOut){t.cellMouseOut.call(o.table,l,a)}if(o.table.options.cellMouseOut){o.table.options.cellMouseOut.call(o.table,l,a)}})}if(t.cellMouseMove||o.table.options.cellMouseMove){l.addEventListener("mousemove",function(l){var a=o.getComponent();if(t.cellMouseMove){t.cellMouseMove.call(o.table,l,a)}if(o.table.options.cellMouseMove){o.table.options.cellMouseMove.call(o.table,l,a)}})}};p.prototype._bindTouchEvents=function(t){var o=this,l=o.element,a,n,r;if(t.cellTap||this.table.options.cellTap){r=!1;l.addEventListener("touchstart",function(){r=!0},{passive:!0});l.addEventListener("touchend",function(l){if(r){var a=o.getComponent();if(t.cellTap){t.cellTap.call(o.table,l,a)}if(o.table.options.cellTap){o.table.options.cellTap.call(o.table,l,a)}}r=!1})}if(t.cellDblTap||this.table.options.cellDblTap){a=null;l.addEventListener("touchend",function(l){if(a){clearTimeout(a);a=null;var n=o.getComponent();if(t.cellDblTap){t.cellDblTap.call(o.table,l,n)}if(o.table.options.cellDblTap){o.table.options.cellDblTap.call(o.table,l,n)}}else{a=setTimeout(function(){clearTimeout(a);a=null},300)}})}if(t.cellTapHold||this.table.options.cellTapHold){n=null;l.addEventListener("touchstart",function(l){clearTimeout(n);n=setTimeout(function(){clearTimeout(n);n=null;r=!1;var a=o.getComponent();if(t.cellTapHold){t.cellTapHold.call(o.table,l,a)}if(o.table.options.cellTapHold){o.table.options.cellTapHold.call(o.table,l,a)}},1e3)},{passive:!0});l.addEventListener("touchend",function(){clearTimeout(n);n=null})}};p.prototype._generateContents=function(){var t;if(this.table.modExists("format")){t=this.table.modules.format.formatValue(this)}else{t=this.element.innerHTML=this.value}switch("undefined"==typeof t?"undefined":_typeof(t)){case"object":if(t instanceof Node){while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}this.element.appendChild(t)}else{this.element.innerHTML="";if(null!=t){console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",t)}}break;case"undefined":case"null":this.element.innerHTML="";break;default:this.element.innerHTML=t;}};p.prototype.cellRendered=function(){if(this.table.modExists("format")&&this.table.modules.format.cellRendered){this.table.modules.format.cellRendered(this)}};p.prototype._generateTooltip=function(){var t=this.column.tooltip;if(t){if(!0===t){t=this.value}else if("function"==typeof t){t=t(this.getComponent());if(!1===t){t=""}}if("undefined"==typeof t){t=""}this.element.setAttribute("title",t)}else{this.element.setAttribute("title","")}};p.prototype.getElement=function(t){if(!this.loaded){this.loaded=!0;if(!t){this.layoutElement()}}return this.element};p.prototype.getValue=function(){return this.value};p.prototype.getOldValue=function(){return this.oldValue};p.prototype.setValue=function(t,o){var l=this.setValueProcessData(t,o),a;if(l){if(this.table.options.history&&this.table.modExists("history")){this.table.modules.history.action("cellEdit",this,{oldValue:this.oldValue,newValue:this.value})}a=this.getComponent();if(this.column.cellEvents.cellEdited){this.column.cellEvents.cellEdited.call(this.table,a)}if(this.table.options.groupUpdateOnCellEdit&&this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.reassignRowToGroup(this.row)}this.cellRendered();this.table.options.cellEdited.call(this.table,a);if(this.table.options.dataChanged){this.table.options.dataChanged.call(this.table,this.table.rowManager.getData())}}};p.prototype.setValueProcessData=function(t,o){var l=!1;if(this.value!=t){l=!0;if(o){if(this.column.modules.mutate){t=this.table.modules.mutator.transformCell(this,t)}}}this.setValueActual(t);if(l&&this.table.modExists("columnCalcs")){if(this.column.definition.topCalc||this.column.definition.bottomCalc){if(this.table.options.groupBy&&this.table.modExists("groupRows")){if("table"==this.table.options.columnCalcs||"both"==this.table.options.columnCalcs){this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows)}if("table"!=this.table.options.columnCalcs){this.table.modules.columnCalcs.recalcRowGroup(this.row)}}else{this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows)}}}return l};p.prototype.setValueActual=function(t){this.oldValue=this.value;this.value=t;if(this.table.options.reactiveData&&this.table.modExists("reactiveData")){this.table.modules.reactiveData.block()}this.column.setFieldValue(this.row.data,t);if(this.table.options.reactiveData&&this.table.modExists("reactiveData")){this.table.modules.reactiveData.unblock()}if(this.loaded){this.layoutElement()}};p.prototype.layoutElement=function(){this._generateContents();this._generateTooltip();if(this.table.options.resizableColumns&&this.table.modExists("resizeColumns")&&"row"===this.row.type){this.table.modules.resizeColumns.initializeColumn("cell",this.column,this.element)}if((this.column.definition.contextMenu||this.column.definition.clickMenu)&&this.table.modExists("menu")){this.table.modules.menu.initializeCell(this)}if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layoutElement(this.element,this.column)}};p.prototype.setWidth=function(){this.width=this.column.width;this.element.style.width=this.column.widthStyled};p.prototype.clearWidth=function(){this.width="";this.element.style.width=""};p.prototype.getWidth=function(){return this.width||this.element.offsetWidth};p.prototype.setMinWidth=function(){this.minWidth=this.column.minWidth;this.element.style.minWidth=this.column.minWidthStyled};p.prototype.setMaxWidth=function(){this.maxWidth=this.column.maxWidth;this.element.style.maxWidth=this.column.maxWidthStyled};p.prototype.checkHeight=function(){this.row.reinitializeHeight()};p.prototype.clearHeight=function(){this.element.style.height="";this.height=null};p.prototype.setHeight=function(){this.height=this.row.height;this.element.style.height=this.row.heightStyled};p.prototype.getHeight=function(){return this.height||this.element.offsetHeight};p.prototype.show=function(){this.element.style.display=this.column.vertAlign?"inline-flex":""};p.prototype.hide=function(){this.element.style.display="none"};p.prototype.edit=function(t){if(this.table.modExists("edit",!0)){return this.table.modules.edit.editCell(this,t)}};p.prototype.cancelEdit=function(){if(this.table.modExists("edit",!0)){var t=this.table.modules.edit.getCurrentCell();if(t&&t._getSelf()===this){this.table.modules.edit.cancelEdit()}else{console.warn("Cancel Editor Error - This cell is not currently being edited ")}}};p.prototype.validate=function(){if(this.column.modules.validate&&this.table.modExists("validate",!0)){var t=this.table.modules.validate.validate(this.column.modules.validate,this,this.getValue());return!0===t}else{return!0}};p.prototype.delete=function(){if(!this.table.rowManager.redrawBlock&&this.element.parentNode){this.element.parentNode.removeChild(this.element)}if(this.modules.validate&&this.modules.validate.invalid){this.table.modules.validate.clearValidation(this)}if(this.modules.edit&&this.modules.edit.edited){this.table.modules.edit.clearEdited(this)}if(this.table.options.history){this.table.modules.history.clearComponentHistory(this)}this.element=!1;this.column.deleteCell(this);this.row.deleteCell(this);this.calcs={}};p.prototype.nav=function(){var t=this,o=!1,l=this.row.getCellIndex(this);return{next:function(){var o=this.right(),l;if(!o){l=t.table.rowManager.nextDisplayRow(t.row,!0);if(l){o=l.findNextEditableCell(-1);if(o){o.edit();return!0}}}else{return!0}return!1},prev:function(){var o=this.left(),l;if(!o){l=t.table.rowManager.prevDisplayRow(t.row,!0);if(l){o=l.findPrevEditableCell(l.cells.length);if(o){o.edit();return!0}}}else{return!0}return!1},left:function(){o=t.row.findPrevEditableCell(l);if(o){o.edit();return!0}else{return!1}},right:function(){o=t.row.findNextEditableCell(l);if(o){o.edit();return!0}else{return!1}},up:function(){var o=t.table.rowManager.prevDisplayRow(t.row,!0);if(o){o.cells[l].edit()}},down:function(){var o=t.table.rowManager.nextDisplayRow(t.row,!0);if(o){o.cells[l].edit()}}}};p.prototype.getIndex=function(){this.row.getCellIndex(this)};p.prototype.getComponent=function(){if(!this.component){this.component=new d(this)}return this.component};var c=function(t){this.table=t;this.active=!1;this.element=this.createElement();this.external=!1;this.links=[];this._initialize()};c.prototype.createElement=function(){var t=document.createElement("div");t.classList.add("tabulator-footer");return t};c.prototype._initialize=function(){if(this.table.options.footerElement){switch(_typeof(this.table.options.footerElement)){case"string":if("<"===this.table.options.footerElement[0]){this.element.innerHTML=this.table.options.footerElement}else{this.external=!0;this.element=document.querySelector(this.table.options.footerElement)}break;default:this.element=this.table.options.footerElement;break;}}};c.prototype.getElement=function(){return this.element};c.prototype.append=function(t,o){this.activate(o);this.element.appendChild(t);this.table.rowManager.adjustTableSize()};c.prototype.prepend=function(t,o){this.activate(o);this.element.insertBefore(t,this.element.firstChild);this.table.rowManager.adjustTableSize()};c.prototype.remove=function(t){t.parentNode.removeChild(t);this.deactivate()};c.prototype.deactivate=function(t){if(!this.element.firstChild||t){if(!this.external){this.element.parentNode.removeChild(this.element)}this.active=!1}};c.prototype.activate=function(t){if(!this.active){this.active=!0;if(!this.external){this.table.element.appendChild(this.getElement());this.table.element.style.display=""}}if(t){this.links.push(t)}};c.prototype.redraw=function(){this.links.forEach(function(t){t.footerRedraw()})};var u=function t(o,l){this.options={};this.columnManager=null;this.rowManager=null;this.footerManager=null;this.vdomHoz=null;this.browser="";this.browserSlow=!1;this.browserMobile=!1;this.rtl=!1;this.modules={};if(this.initializeElement(o)){this.initializeOptions(l||{});this._create()}t.prototype.comms.register(this)};u.prototype.defaultOptions={height:!1,minHeight:!1,maxHeight:!1,layout:"fitData",layoutColumnsOnNewData:!1,columnMinWidth:40,columnMaxWidth:!1,columnHeaderVertAlign:"top",columnVertAlign:!1,resizableColumns:!0,resizableRows:!1,autoResize:!0,columns:[],cellHozAlign:"",cellVertAlign:"",headerHozAlign:"",data:[],autoColumns:!1,autoColumnsDefinitions:!1,reactiveData:!1,nestedFieldSeparator:".",tooltips:!1,tooltipsHeader:!1,tooltipGenerationMode:"load",initialSort:!1,initialFilter:!1,initialHeaderFilter:!1,columnHeaderSortMulti:!0,sortOrderReverse:!1,headerSort:!0,headerSortTristate:!1,headerSortElement:"<div class='tabulator-arrow'></div>",footerElement:!1,index:"id",textDirection:"auto",keybindings:[],tabEndNewRow:!1,invalidOptionWarnings:!0,clipboard:!1,clipboardCopyStyled:!0,clipboardCopyConfig:!1,clipboardCopyFormatter:!1,clipboardCopyRowRange:"active",clipboardPasteParser:"table",clipboardPasteAction:"insert",clipboardCopied:function(){},clipboardPasted:function(){},clipboardPasteError:function(){},downloadDataFormatter:!1,downloadReady:function(t,o){return o},downloadComplete:!1,downloadConfig:{},downloadRowRange:"active",dataTree:!1,dataTreeFilter:!0,dataTreeSort:!0,dataTreeElementColumn:!1,dataTreeBranchElement:!0,dataTreeChildIndent:9,dataTreeChildField:"_children",dataTreeCollapseElement:!1,dataTreeExpandElement:!1,dataTreeStartExpanded:!1,dataTreeRowExpanded:function(){},dataTreeRowCollapsed:function(){},dataTreeChildColumnCalcs:!1,dataTreeSelectPropagate:!1,printAsHtml:!1,printFormatter:!1,printHeader:!1,printFooter:!1,printCopyStyle:!0,printStyled:!0,printVisibleRows:!0,printRowRange:"visible",printConfig:{},addRowPos:"bottom",selectable:"highlight",selectableRangeMode:"drag",selectableRollingSelection:!0,selectablePersistence:!0,selectableCheck:function(){return!0},headerFilterLiveFilterDelay:300,headerFilterPlaceholder:!1,headerVisible:!0,history:!1,locale:!1,langs:{},virtualDom:!0,virtualDomBuffer:0,virtualDomHoz:!1,persistentLayout:!1,persistentSort:!1,persistentFilter:!1,persistenceID:"",persistenceMode:!0,persistenceReaderFunc:!1,persistenceWriterFunc:!1,persistence:!1,responsiveLayout:!1,responsiveLayoutCollapseStartOpen:!0,responsiveLayoutCollapseUseFormatters:!0,responsiveLayoutCollapseFormatter:!1,pagination:!1,paginationSize:!1,paginationInitialPage:1,paginationButtonCount:5,paginationSizeSelector:!1,paginationElement:!1,paginationDataSent:{},paginationDataReceived:{},paginationAddRow:"page",ajaxURL:!1,ajaxURLGenerator:!1,ajaxParams:{},ajaxConfig:"get",ajaxContentType:"form",ajaxRequestFunc:!1,ajaxLoader:!0,ajaxLoaderLoading:!1,ajaxLoaderError:!1,ajaxFiltering:!1,ajaxSorting:!1,ajaxProgressiveLoad:!1,ajaxProgressiveLoadDelay:0,ajaxProgressiveLoadScrollMargin:0,groupBy:!1,groupStartOpen:!0,groupValues:!1,groupUpdateOnCellEdit:!1,groupHeader:!1,groupHeaderPrint:null,groupHeaderClipboard:null,groupHeaderHtmlOutput:null,groupHeaderDownload:null,htmlOutputConfig:!1,movableColumns:!1,movableRows:!1,movableRowsConnectedTables:!1,movableRowsConnectedElements:!1,movableRowsSender:!1,movableRowsReceiver:"insert",movableRowsSendingStart:function(){},movableRowsSent:function(){},movableRowsSentFailed:function(){},movableRowsSendingStop:function(){},movableRowsReceivingStart:function(){},movableRowsReceived:function(){},movableRowsReceivedFailed:function(){},movableRowsReceivingStop:function(){},movableRowsElementDrop:function(){},scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,placeholder:!1,tableBuilding:function(){},tableBuilt:function(){},renderStarted:function(){},renderComplete:function(){},rowClick:!1,rowDblClick:!1,rowContext:!1,rowTap:!1,rowDblTap:!1,rowTapHold:!1,rowMouseEnter:!1,rowMouseLeave:!1,rowMouseOver:!1,rowMouseOut:!1,rowMouseMove:!1,rowContextMenu:!1,rowClickMenu:!1,rowAdded:function(){},rowDeleted:function(){},rowMoved:function(){},rowUpdated:function(){},rowSelectionChanged:function(){},rowSelected:function(){},rowDeselected:function(){},rowResized:function(){},cellClick:!1,cellDblClick:!1,cellContext:!1,cellTap:!1,cellDblTap:!1,cellTapHold:!1,cellMouseEnter:!1,cellMouseLeave:!1,cellMouseOver:!1,cellMouseOut:!1,cellMouseMove:!1,cellEditing:function(){},cellEdited:function(){},cellEditCancelled:function(){},columnMoved:!1,columnResized:function(){},columnTitleChanged:function(){},columnVisibilityChanged:function(){},htmlImporting:function(){},htmlImported:function(){},dataLoading:function(){},dataLoaded:function(){},dataEdited:!1,dataChanged:!1,ajaxRequesting:function(){},ajaxResponse:!1,ajaxError:function(){},dataFiltering:!1,dataFiltered:!1,dataSorting:function(){},dataSorted:function(){},groupToggleElement:"arrow",groupClosedShowCalcs:!1,dataGrouping:function(){},dataGrouped:!1,groupVisibilityChanged:function(){},groupClick:!1,groupDblClick:!1,groupContext:!1,groupContextMenu:!1,groupClickMenu:!1,groupTap:!1,groupDblTap:!1,groupTapHold:!1,columnCalcs:!0,pageLoaded:function(){},localized:function(){},validationMode:"blocking",validationFailed:function(){},historyUndo:function(){},historyRedo:function(){},scrollHorizontal:function(){},scrollVertical:function(){}};u.prototype.initializeOptions=function(t){if(!1!==t.invalidOptionWarnings){for(var o in t){if("undefined"==typeof this.defaultOptions[o]){console.warn("Invalid table constructor option:",o)}}}for(var o in this.defaultOptions){if(o in t){this.options[o]=t[o]}else{if(Array.isArray(this.defaultOptions[o])){this.options[o]=Object.assign([],this.defaultOptions[o])}else if("object"===_typeof(this.defaultOptions[o])&&null!==this.defaultOptions[o]){this.options[o]=Object.assign({},this.defaultOptions[o])}else{this.options[o]=this.defaultOptions[o]}}}};u.prototype.initializeElement=function(t){if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement){this.element=t;return!0}else if("string"==typeof t){this.element=document.querySelector(t);if(this.element){return!0}else{console.error("Tabulator Creation Error - no element found matching selector: ",t);return!1}}else{console.error("Tabulator Creation Error - Invalid element provided:",t);return!1}};u.prototype.rtlCheck=function(){var t=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if("rtl"!==t.direction){break};case"rtl":this.element.classList.add("tabulator-rtl");this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1;}};u.prototype._mapDepricatedFunctionality=function(){if(this.options.persistentLayout||this.options.persistentSort||this.options.persistentFilter){if(!this.options.persistence){this.options.persistence={}}}if(this.options.dataEdited){console.warn("DEPRECATION WARNING - dataEdited option has been deprecated, please use the dataChanged option instead");this.options.dataChanged=this.options.dataEdited}if(this.options.downloadDataFormatter){console.warn("DEPRECATION WARNING - downloadDataFormatter option has been deprecated")}if("undefined"!=typeof this.options.clipboardCopyHeader){this.options.columnHeaders=this.options.clipboardCopyHeader;console.warn("DEPRECATION WARNING - clipboardCopyHeader option has been deprecated, please use the columnHeaders property on the clipboardCopyConfig option")}if(!0!==this.options.printVisibleRows){console.warn("printVisibleRows option is deprecated, you should now use the printRowRange option");this.options.persistence.printRowRange="active"}if(!0!==this.options.printCopyStyle){console.warn("printCopyStyle option is deprecated, you should now use the printStyled option");this.options.persistence.printStyled=this.options.printCopyStyle}if(this.options.persistentLayout){console.warn("persistentLayout option is deprecated, you should now use the persistence option");if(!0!==this.options.persistence&&"undefined"==typeof this.options.persistence.columns){this.options.persistence.columns=!0}}if(this.options.persistentSort){console.warn("persistentSort option is deprecated, you should now use the persistence option");if(!0!==this.options.persistence&&"undefined"==typeof this.options.persistence.sort){this.options.persistence.sort=!0}}if(this.options.persistentFilter){console.warn("persistentFilter option is deprecated, you should now use the persistence option");if(!0!==this.options.persistence&&"undefined"==typeof this.options.persistence.filter){this.options.persistence.filter=!0}}if(this.options.columnVertAlign){console.warn("columnVertAlign option is deprecated, you should now use the columnHeaderVertAlign option");this.options.columnHeaderVertAlign=this.options.columnVertAlign}};u.prototype._clearSelection=function(){this.element.classList.add("tabulator-block-select");if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}else if(document.selection){document.selection.empty()}this.element.classList.remove("tabulator-block-select")};u.prototype._create=function(){this._clearObjectPointers();this._mapDepricatedFunctionality();this.bindModules();this.rtlCheck();if("TABLE"===this.element.tagName){if(this.modExists("htmlTableImport",!0)){this.modules.htmlTableImport.parseTable()}}this.columnManager=new t(this);this.rowManager=new a(this);this.footerManager=new c(this);this.columnManager.setRowManager(this.rowManager);this.rowManager.setColumnManager(this.columnManager);if(this.options.virtualDomHoz){this.vdomHoz=new n(this)}this._buildElement();this._loadInitialData()};u.prototype._clearObjectPointers=function(){this.options.columns=this.options.columns.slice(0);if(!this.options.reactiveData){this.options.data=this.options.data.slice(0)}};u.prototype._buildElement=function(){var t=this,o=this.element,l=this.modules,a=this.options;a.tableBuilding.call(this);o.classList.add("tabulator");o.setAttribute("role","grid");while(o.firstChild){o.removeChild(o.firstChild)}if(a.height){a.height=isNaN(a.height)?a.height:a.height+"px";o.style.height=a.height}if(!1!==a.minHeight){a.minHeight=isNaN(a.minHeight)?a.minHeight:a.minHeight+"px";o.style.minHeight=a.minHeight}if(!1!==a.maxHeight){a.maxHeight=isNaN(a.maxHeight)?a.maxHeight:a.maxHeight+"px";o.style.maxHeight=a.maxHeight}this.columnManager.initialize();this.rowManager.initialize();this._detectBrowser();if(this.modExists("layout",!0)){l.layout.initialize(a.layout)}l.localize.initialize();if(!1!==a.headerFilterPlaceholder){l.localize.setHeaderFilterPlaceholder(a.headerFilterPlaceholder)}for(var n in a.langs){l.localize.installLang(n,a.langs[n])}l.localize.setLocale(a.locale);if("string"==typeof a.placeholder){var r=document.createElement("div");r.classList.add("tabulator-placeholder");var s=document.createElement("span");s.innerHTML=a.placeholder;r.appendChild(s);a.placeholder=r}o.appendChild(this.columnManager.getElement());o.appendChild(this.rowManager.getElement());if(a.footerElement){this.footerManager.activate()}if(a.persistence&&this.modExists("persistence",!0)){l.persistence.initialize()}if(a.movableRows&&this.modExists("moveRow")){l.moveRow.initialize()}if(a.autoColumns&&this.options.data){this.columnManager.generateColumnsFromRowData(this.options.data)}if(this.modExists("columnCalcs")){l.columnCalcs.initialize()}this.columnManager.setColumns(a.columns);if(a.dataTree&&this.modExists("dataTree",!0)){l.dataTree.initialize()}if(this.modExists("frozenRows")){this.modules.frozenRows.initialize()}if((a.persistence&&this.modExists("persistence",!0)&&l.persistence.config.sort||a.initialSort)&&this.modExists("sort",!0)){var d=[];if(a.persistence&&this.modExists("persistence",!0)&&l.persistence.config.sort){d=l.persistence.load("sort");if(!1===d&&a.initialSort){d=a.initialSort}}else if(a.initialSort){d=a.initialSort}l.sort.setSort(d)}if((a.persistence&&this.modExists("persistence",!0)&&l.persistence.config.filter||a.initialFilter)&&this.modExists("filter",!0)){var p=[];if(a.persistence&&this.modExists("persistence",!0)&&l.persistence.config.filter){p=l.persistence.load("filter");if(!1===p&&a.initialFilter){p=a.initialFilter}}else if(a.initialFilter){p=a.initialFilter}l.filter.setFilter(p)}if(a.initialHeaderFilter&&this.modExists("filter",!0)){a.initialHeaderFilter.forEach(function(o){var a=t.columnManager.findColumn(o.field);if(a){l.filter.setHeaderFilterValue(a,o.value)}else{console.warn("Column Filter Error - No matching column found:",o.field);return!1}})}if(this.modExists("ajax")){l.ajax.initialize()}if(a.pagination&&this.modExists("page",!0)){l.page.initialize()}if(a.groupBy&&this.modExists("groupRows",!0)){l.groupRows.initialize()}if(this.modExists("keybindings")){l.keybindings.initialize()}if(this.modExists("selectRow")){l.selectRow.clearSelectionData(!0)}if(a.autoResize&&this.modExists("resizeTable")){l.resizeTable.initialize()}if(this.modExists("clipboard")){l.clipboard.initialize()}if(a.printAsHtml&&this.modExists("print")){l.print.initialize()}a.tableBuilt.call(this)};u.prototype._loadInitialData=function(){var t=this;if(t.options.pagination&&t.modExists("page")){t.modules.page.reset(!0,!0);if("local"==t.options.pagination){if(t.options.data.length){t.rowManager.setData(t.options.data,!1,!0)}else{if((t.options.ajaxURL||t.options.ajaxURLGenerator)&&t.modExists("ajax")){t.modules.ajax.loadData(!1,!0).then(function(){}).catch(function(){if(t.options.paginationInitialPage){t.modules.page.setPage(t.options.paginationInitialPage)}});return}else{t.rowManager.setData(t.options.data,!1,!0)}}if(t.options.paginationInitialPage){t.modules.page.setPage(t.options.paginationInitialPage)}}else{if(t.options.ajaxURL){t.modules.page.setPage(t.options.paginationInitialPage).then(function(){}).catch(function(){})}else{t.rowManager.setData([],!1,!0)}}}else{if(t.options.data.length){t.rowManager.setData(t.options.data)}else{if((t.options.ajaxURL||t.options.ajaxURLGenerator)&&t.modExists("ajax")){t.modules.ajax.loadData(!1,!0).then(function(){}).catch(function(){})}else{t.rowManager.setData(t.options.data,!1,!0)}}}};u.prototype.destroy=function(){var t=this.element;u.prototype.comms.deregister(this);if(this.options.reactiveData&&this.modExists("reactiveData",!0)){this.modules.reactiveData.unwatchData()}this.rowManager.rows.forEach(function(t){t.wipe()});this.rowManager.rows=[];this.rowManager.activeRows=[];this.rowManager.displayRows=[];if(this.options.autoResize&&this.modExists("resizeTable")){this.modules.resizeTable.clearBindings()}if(this.modExists("keybindings")){this.modules.keybindings.clearBindings()}while(t.firstChild){t.removeChild(t.firstChild)}t.classList.remove("tabulator")};u.prototype._detectBrowser=function(){var t=navigator.userAgent||navigator.vendor||window.opera;if(-1<t.indexOf("Trident")){this.browser="ie";this.browserSlow=!0}else if(-1<t.indexOf("Edge")){this.browser="edge";this.browserSlow=!0}else if(-1<t.indexOf("Firefox")){this.browser="firefox";this.browserSlow=!1}else{this.browser="other";this.browserSlow=!1}this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))};u.prototype.blockRedraw=function(){return this.rowManager.blockRedraw()};u.prototype.restoreRedraw=function(){return this.rowManager.restoreRedraw()};u.prototype.setDataFromLocalFile=function(t){var o=this;return new Promise(function(l,a){var n=document.createElement("input");n.type="file";n.accept=t||".json,application/json";n.addEventListener("change",function(){var t=n.files[0],r=new FileReader,s;r.readAsText(t);r.onload=function(){try{s=JSON.parse(r.result)}catch(t){console.warn("File Load Error - File contents is invalid JSON",t);a(t);return}o.setData(s).then(function(t){l(t)}).catch(function(t){l(t)})};r.onerror=function(){console.warn("File Load Error - Unable to read file");a()}});n.click()})};u.prototype.setData=function(t,o,l){if(this.modExists("ajax")){this.modules.ajax.blockActiveRequest()}return this._setData(t,o,l,!1,!0)};u.prototype._setData=function(t,o,l,a,n){var r=this;if("string"==typeof t){if(0==t.indexOf("{")||0==t.indexOf("[")){return r.rowManager.setData(JSON.parse(t),a,n)}else{if(r.modExists("ajax",!0)){if(o){r.modules.ajax.setParams(o)}if(l){r.modules.ajax.setConfig(l)}r.modules.ajax.setUrl(t);if("remote"==r.options.pagination&&r.modExists("page",!0)){r.modules.page.reset(!0,!0);return r.modules.page.setPage(1)}else{return r.modules.ajax.loadData(a,n)}}}}else{if(t){return r.rowManager.setData(t,a,n)}else{if(r.modExists("ajax")&&(r.modules.ajax.getUrl||r.options.ajaxURLGenerator)){if("remote"==r.options.pagination&&r.modExists("page",!0)){r.modules.page.reset(!0,!0);return r.modules.page.setPage(1)}else{return r.modules.ajax.loadData(a,n)}}else{return r.rowManager.setData([],a,n)}}}};u.prototype.clearData=function(){if(this.modExists("ajax")){this.modules.ajax.blockActiveRequest()}this.rowManager.clearData()};u.prototype.getData=function(t){if(!0===t){console.warn("passing a boolean to the getData function is deprecated, you should now pass the string 'active'");t="active"}return this.rowManager.getData(t)};u.prototype.getDataCount=function(t){if(!0===t){console.warn("passing a boolean to the getDataCount function is deprecated, you should now pass the string 'active'");t="active"}return this.rowManager.getDataCount(t)};u.prototype.searchRows=function(t,o,l){if(this.modExists("filter",!0)){return this.modules.filter.search("rows",t,o,l)}};u.prototype.searchData=function(t,o,l){if(this.modExists("filter",!0)){return this.modules.filter.search("data",t,o,l)}};u.prototype.getHtml=function(t,o,l){if(this.modExists("export",!0)){return this.modules.export.getHtml(t,o,l)}};u.prototype.print=function(t,o,l){if(this.modExists("print",!0)){return this.modules.print.printFullscreen(t,o,l)}};u.prototype.getAjaxUrl=function(){if(this.modExists("ajax",!0)){return this.modules.ajax.getUrl()}};u.prototype.replaceData=function(t,o,l){if(this.modExists("ajax")){this.modules.ajax.blockActiveRequest()}return this._setData(t,o,l,!0)};u.prototype.updateData=function(t){var o=this,l=this,a=0;return new Promise(function(n,r){if(o.modExists("ajax")){o.modules.ajax.blockActiveRequest()}if("string"==typeof t){t=JSON.parse(t)}if(t){t.forEach(function(t){var o=l.rowManager.findRow(t[l.options.index]);if(o){a++;o.updateData(t).then(function(){a--;if(!a){n()}})}})}else{console.warn("Update Error - No data provided");r("Update Error - No data provided")}})};u.prototype.addData=function(t,o,l){var a=this;return new Promise(function(n,r){if(a.modExists("ajax")){a.modules.ajax.blockActiveRequest()}if("string"==typeof t){t=JSON.parse(t)}if(t){a.rowManager.addRows(t,o,l).then(function(t){var o=[];t.forEach(function(t){o.push(t.getComponent())});n(o)})}else{console.warn("Update Error - No data provided");r("Update Error - No data provided")}})};u.prototype.updateOrAddData=function(t){var o=this,l=this,a=[],n=0;return new Promise(function(r,s){if(o.modExists("ajax")){o.modules.ajax.blockActiveRequest()}if("string"==typeof t){t=JSON.parse(t)}if(t){t.forEach(function(t){var o=l.rowManager.findRow(t[l.options.index]);n++;if(o){o.updateData(t).then(function(){n--;a.push(o.getComponent());if(!n){r(a)}})}else{l.rowManager.addRows(t).then(function(t){n--;a.push(t[0].getComponent());if(!n){r(a)}})}})}else{console.warn("Update Error - No data provided");s("Update Error - No data provided")}})};u.prototype.getRow=function(t){var o=this.rowManager.findRow(t);if(o){return o.getComponent()}else{console.warn("Find Error - No matching row found:",t);return!1}};u.prototype.getRowFromPosition=function(t,o){var l=this.rowManager.getRowFromPosition(t,o);if(l){return l.getComponent()}else{console.warn("Find Error - No matching row found:",t);return!1}};u.prototype.deleteRow=function(t){var o=this;return new Promise(function(l,a){var r=0,s=0,d=[];function n(){r++;if(r==t.length){if(s){o.rowManager.reRenderInPosition();l()}}}if(!Array.isArray(t)){t=[t]}t.forEach(function(t){var l=o.rowManager.findRow(t,!0);if(l){d.push(l)}else{console.warn("Delete Error - No matching row found:",t);a("Delete Error - No matching row found");n()}});d.sort(function(t,l){return o.rowManager.rows.indexOf(t)>o.rowManager.rows.indexOf(l)?1:-1});d.forEach(function(t){t.delete().then(function(){s++;n()}).catch(function(t){n();a(t)})})})};u.prototype.addRow=function(t,o,l){var a=this;return new Promise(function(n){if("string"==typeof t){t=JSON.parse(t)}a.rowManager.addRows(t,o,l).then(function(t){if(a.modExists("columnCalcs")){a.modules.columnCalcs.recalc(a.rowManager.activeRows)}n(t[0].getComponent())})})};u.prototype.updateOrAddRow=function(t,o){var l=this;return new Promise(function(a,n){var r=l.rowManager.findRow(t);if("string"==typeof o){o=JSON.parse(o)}if(r){r.updateData(o).then(function(){if(l.modExists("columnCalcs")){l.modules.columnCalcs.recalc(l.rowManager.activeRows)}a(r.getComponent())}).catch(function(t){n(t)})}else{r=l.rowManager.addRows(o).then(function(t){if(l.modExists("columnCalcs")){l.modules.columnCalcs.recalc(l.rowManager.activeRows)}a(t[0].getComponent())}).catch(function(t){n(t)})}})};u.prototype.updateRow=function(t,o){var l=this;return new Promise(function(a,n){var r=l.rowManager.findRow(t);if("string"==typeof o){o=JSON.parse(o)}if(r){r.updateData(o).then(function(){a(r.getComponent())}).catch(function(t){n(t)})}else{console.warn("Update Error - No matching row found:",t);n("Update Error - No matching row found")}})};u.prototype.scrollToRow=function(t,o,l){var a=this;return new Promise(function(n,r){var s=a.rowManager.findRow(t);if(s){a.rowManager.scrollToRow(s,o,l).then(function(){n()}).catch(function(t){r(t)})}else{console.warn("Scroll Error - No matching row found:",t);r("Scroll Error - No matching row found")}})};u.prototype.moveRow=function(t,o,l){var a=this.rowManager.findRow(t);if(a){a.moveToRow(o,l)}else{console.warn("Move Error - No matching row found:",t)}};u.prototype.getRows=function(t){if(!0===t){console.warn("passing a boolean to the getRows function is deprecated, you should now pass the string 'active'");t="active"}return this.rowManager.getComponents(t)};u.prototype.getRowPosition=function(t,o){var l=this.rowManager.findRow(t);if(l){return this.rowManager.getRowPosition(l,o)}else{console.warn("Position Error - No matching row found:",t);return!1}};u.prototype.copyToClipboard=function(t){if(this.modExists("clipboard",!0)){this.modules.clipboard.copy(t)}};u.prototype.setColumns=function(t){this.columnManager.setColumns(t)};u.prototype.getColumns=function(t){return this.columnManager.getComponents(t)};u.prototype.getColumn=function(t){var o=this.columnManager.findColumn(t);if(o){return o.getComponent()}else{console.warn("Find Error - No matching column found:",t);return!1}};u.prototype.getColumnDefinitions=function(){return this.columnManager.getDefinitionTree()};u.prototype.getColumnLayout=function(){if(this.modExists("persistence",!0)){return this.modules.persistence.parseColumns(this.columnManager.getColumns())}};u.prototype.setColumnLayout=function(t){if(this.modExists("persistence",!0)){this.columnManager.setColumns(this.modules.persistence.mergeDefinition(this.options.columns,t));return!0}return!1};u.prototype.showColumn=function(t){var o=this.columnManager.findColumn(t);if(o){o.show();if(this.options.responsiveLayout&&this.modExists("responsiveLayout",!0)){this.modules.responsiveLayout.update()}}else{console.warn("Column Show Error - No matching column found:",t);return!1}};u.prototype.hideColumn=function(t){var o=this.columnManager.findColumn(t);if(o){o.hide();if(this.options.responsiveLayout&&this.modExists("responsiveLayout",!0)){this.modules.responsiveLayout.update()}}else{console.warn("Column Hide Error - No matching column found:",t);return!1}};u.prototype.toggleColumn=function(t){var o=this.columnManager.findColumn(t);if(o){if(o.visible){o.hide()}else{o.show()}}else{console.warn("Column Visibility Toggle Error - No matching column found:",t);return!1}};u.prototype.addColumn=function(t,o,l){var a=this;return new Promise(function(n,r){var s=a.columnManager.findColumn(l);a.columnManager.addColumn(t,o,s).then(function(t){n(t.getComponent())}).catch(function(t){r(t)})})};u.prototype.deleteColumn=function(t){var o=this;return new Promise(function(l,a){var n=o.columnManager.findColumn(t);if(n){n.delete().then(function(){l()}).catch(function(t){a(t)})}else{console.warn("Column Delete Error - No matching column found:",t);a()}})};u.prototype.updateColumnDefinition=function(t,o){var l=this;return new Promise(function(a,n){var r=l.columnManager.findColumn(t);if(r){r.updateDefinition(o).then(function(t){a(t)}).catch(function(t){n(t)})}else{console.warn("Column Update Error - No matching column found:",t);n()}})};u.prototype.moveColumn=function(t,o,l){var a=this.columnManager.findColumn(t),n=this.columnManager.findColumn(o);if(a){if(n){this.columnManager.moveColumn(a,n,l)}else{console.warn("Move Error - No matching column found:",n)}}else{console.warn("Move Error - No matching column found:",t)}};u.prototype.scrollToColumn=function(t,o,l){var a=this;return new Promise(function(n,r){var s=a.columnManager.findColumn(t);if(s){a.columnManager.scrollToColumn(s,o,l).then(function(){n()}).catch(function(t){r(t)})}else{console.warn("Scroll Error - No matching column found:",t);r("Scroll Error - No matching column found")}})};u.prototype.setLocale=function(t){this.modules.localize.setLocale(t)};u.prototype.getLocale=function(){return this.modules.localize.getLocale()};u.prototype.getLang=function(t){return this.modules.localize.getLang(t)};u.prototype.redraw=function(t){this.columnManager.redraw(t);this.rowManager.redraw(t)};u.prototype.setHeight=function(t){if("classic"!==this.rowManager.renderMode){this.options.height=isNaN(t)?t:t+"px";this.element.style.height=this.options.height;this.rowManager.setRenderMode();this.rowManager.redraw()}else{console.warn("setHeight function is not available in classic render mode")}};u.prototype.setSort=function(t,o){if(this.modExists("sort",!0)){this.modules.sort.setSort(t,o);this.rowManager.sorterRefresh()}};u.prototype.getSorters=function(){if(this.modExists("sort",!0)){return this.modules.sort.getSort()}};u.prototype.clearSort=function(){if(this.modExists("sort",!0)){this.modules.sort.clear();this.rowManager.sorterRefresh()}};u.prototype.setFilter=function(t,o,l,a){if(this.modExists("filter",!0)){this.modules.filter.setFilter(t,o,l,a);this.rowManager.filterRefresh()}};u.prototype.refreshFilter=function(){if(this.modExists("filter",!0)){this.rowManager.filterRefresh()}};u.prototype.addFilter=function(t,o,l,a){if(this.modExists("filter",!0)){this.modules.filter.addFilter(t,o,l,a);this.rowManager.filterRefresh()}};u.prototype.getFilters=function(t){if(this.modExists("filter",!0)){return this.modules.filter.getFilters(t)}};u.prototype.setHeaderFilterFocus=function(t){if(this.modExists("filter",!0)){var o=this.columnManager.findColumn(t);if(o){this.modules.filter.setHeaderFilterFocus(o)}else{console.warn("Column Filter Focus Error - No matching column found:",t);return!1}}};u.prototype.getHeaderFilterValue=function(t){if(this.modExists("filter",!0)){var o=this.columnManager.findColumn(t);if(o){return this.modules.filter.getHeaderFilterValue(o)}else{console.warn("Column Filter Error - No matching column found:",t)}}};u.prototype.setHeaderFilterValue=function(t,o){if(this.modExists("filter",!0)){var l=this.columnManager.findColumn(t);if(l){this.modules.filter.setHeaderFilterValue(l,o)}else{console.warn("Column Filter Error - No matching column found:",t);return!1}}};u.prototype.getHeaderFilters=function(){if(this.modExists("filter",!0)){return this.modules.filter.getHeaderFilters()}};u.prototype.removeFilter=function(t,o,l){if(this.modExists("filter",!0)){this.modules.filter.removeFilter(t,o,l);this.rowManager.filterRefresh()}};u.prototype.clearFilter=function(t){if(this.modExists("filter",!0)){this.modules.filter.clearFilter(t);this.rowManager.filterRefresh()}};u.prototype.clearHeaderFilter=function(){if(this.modExists("filter",!0)){this.modules.filter.clearHeaderFilter();this.rowManager.filterRefresh()}};u.prototype.selectRow=function(t){if(this.modExists("selectRow",!0)){if(!0===t){console.warn("passing a boolean to the selectRowselectRow function is deprecated, you should now pass the string 'active'");t="active"}this.modules.selectRow.selectRows(t)}};u.prototype.deselectRow=function(t){if(this.modExists("selectRow",!0)){this.modules.selectRow.deselectRows(t)}};u.prototype.toggleSelectRow=function(t){if(this.modExists("selectRow",!0)){this.modules.selectRow.toggleRow(t)}};u.prototype.getSelectedRows=function(){if(this.modExists("selectRow",!0)){return this.modules.selectRow.getSelectedRows()}};u.prototype.getSelectedData=function(){if(this.modExists("selectRow",!0)){return this.modules.selectRow.getSelectedData()}};u.prototype.getInvalidCells=function(){if(this.modExists("validate",!0)){return this.modules.validate.getInvalidCells()}};u.prototype.clearCellValidation=function(t){var o=this;if(this.modExists("validate",!0)){if(!t){t=this.modules.validate.getInvalidCells()}if(!Array.isArray(t)){t=[t]}t.forEach(function(t){o.modules.validate.clearValidation(t._getSelf())})}};u.prototype.validate=function(){var t=[];this.rowManager.rows.forEach(function(o){var l=o.validate();if(!0!==l){t=t.concat(l)}});return t.length?t:!0};u.prototype.setMaxPage=function(t){if(this.options.pagination&&this.modExists("page")){this.modules.page.setMaxPage(t)}else{return!1}};u.prototype.setPage=function(t){if(this.options.pagination&&this.modExists("page")){return this.modules.page.setPage(t)}else{return new Promise(function(t,o){o()})}};u.prototype.setPageToRow=function(t){var o=this;return new Promise(function(l,a){if(o.options.pagination&&o.modExists("page")){t=o.rowManager.findRow(t);if(t){o.modules.page.setPageToRow(t).then(function(){l()}).catch(function(){a()})}else{a()}}else{a()}})};u.prototype.setPageSize=function(t){if(this.options.pagination&&this.modExists("page")){this.modules.page.setPageSize(t);this.modules.page.setPage(1).then(function(){}).catch(function(){})}else{return!1}};u.prototype.getPageSize=function(){if(this.options.pagination&&this.modExists("page",!0)){return this.modules.page.getPageSize()}};u.prototype.previousPage=function(){if(this.options.pagination&&this.modExists("page")){this.modules.page.previousPage()}else{return!1}};u.prototype.nextPage=function(){if(this.options.pagination&&this.modExists("page")){this.modules.page.nextPage()}else{return!1}};u.prototype.getPage=function(){if(this.options.pagination&&this.modExists("page")){return this.modules.page.getPage()}else{return!1}};u.prototype.getPageMax=function(){if(this.options.pagination&&this.modExists("page")){return this.modules.page.getPageMax()}else{return!1}};u.prototype.setGroupBy=function(t){if(this.modExists("groupRows",!0)){this.options.groupBy=t;this.modules.groupRows.initialize();this.rowManager.refreshActiveData("display");if(this.options.persistence&&this.modExists("persistence",!0)&&this.modules.persistence.config.group){this.modules.persistence.save("group")}}else{return!1}};u.prototype.setGroupValues=function(t){if(this.modExists("groupRows",!0)){this.options.groupValues=t;this.modules.groupRows.initialize();this.rowManager.refreshActiveData("display");if(this.options.persistence&&this.modExists("persistence",!0)&&this.modules.persistence.config.group){this.modules.persistence.save("group")}}else{return!1}};u.prototype.setGroupStartOpen=function(t){if(this.modExists("groupRows",!0)){this.options.groupStartOpen=t;this.modules.groupRows.initialize();if(this.options.groupBy){this.rowManager.refreshActiveData("group");if(this.options.persistence&&this.modExists("persistence",!0)&&this.modules.persistence.config.group){this.modules.persistence.save("group")}}else{console.warn("Grouping Update - cant refresh view, no groups have been set")}}else{return!1}};u.prototype.setGroupHeader=function(t){if(this.modExists("groupRows",!0)){this.options.groupHeader=t;this.modules.groupRows.initialize();if(this.options.groupBy){this.rowManager.refreshActiveData("group");if(this.options.persistence&&this.modExists("persistence",!0)&&this.modules.persistence.config.group){this.modules.persistence.save("group")}}else{console.warn("Grouping Update - cant refresh view, no groups have been set")}}else{return!1}};u.prototype.getGroups=function(){if(this.modExists("groupRows",!0)){return this.modules.groupRows.getGroups(!0)}else{return!1}};u.prototype.getGroupedData=function(){if(this.modExists("groupRows",!0)){return this.options.groupBy?this.modules.groupRows.getGroupedData():this.getData()}};u.prototype.getEditedCells=function(){if(this.modExists("edit",!0)){return this.modules.edit.getEditedCells()}};u.prototype.clearCellEdited=function(t){var o=this;if(this.modExists("edit",!0)){if(!t){t=this.modules.edit.getEditedCells()}if(!Array.isArray(t)){t=[t]}t.forEach(function(t){o.modules.edit.clearEdited(t._getSelf())})}};u.prototype.getCalcResults=function(){if(this.modExists("columnCalcs",!0)){return this.modules.columnCalcs.getResults()}else{return!1}};u.prototype.recalc=function(){if(this.modExists("columnCalcs",!0)){this.modules.columnCalcs.recalcAll(this.rowManager.activeRows)}};u.prototype.navigatePrev=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){return t.nav().prev()}}return!1};u.prototype.navigateNext=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){return t.nav().next()}}return!1};u.prototype.navigateLeft=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){e.preventDefault();return t.nav().left()}}return!1};u.prototype.navigateRight=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){e.preventDefault();return t.nav().right()}}return!1};u.prototype.navigateUp=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){e.preventDefault();return t.nav().up()}}return!1};u.prototype.navigateDown=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){e.preventDefault();return t.nav().down()}}return!1};u.prototype.undo=function(){if(this.options.history&&this.modExists("history",!0)){return this.modules.history.undo()}else{return!1}};u.prototype.redo=function(){if(this.options.history&&this.modExists("history",!0)){return this.modules.history.redo()}else{return!1}};u.prototype.getHistoryUndoSize=function(){if(this.options.history&&this.modExists("history",!0)){return this.modules.history.getHistoryUndoSize()}else{return!1}};u.prototype.getHistoryRedoSize=function(){if(this.options.history&&this.modExists("history",!0)){return this.modules.history.getHistoryRedoSize()}else{return!1}};u.prototype.clearHistory=function(){if(this.options.history&&this.modExists("history",!0)){return this.modules.history.clear()}else{return!1}};u.prototype.download=function(t,o,l,a){if(this.modExists("download",!0)){this.modules.download.download(t,o,l,a)}};u.prototype.downloadToTab=function(t,o,l,a){if(this.modExists("download",!0)){this.modules.download.download(t,o,l,a,!0)}};u.prototype.tableComms=function(t,o,l,a){this.modules.comms.receive(t,o,l,a)};u.prototype.moduleBindings={};u.prototype.extendModule=function(t,o,l){if(u.prototype.moduleBindings[t]){var a=u.prototype.moduleBindings[t].prototype[o];if(a){if("object"==("undefined"==typeof l?"undefined":_typeof(l))){for(var n in l){a[n]=l[n]}}else{console.warn("Module Error - Invalid value type, it must be an object")}}else{console.warn("Module Error - property does not exist:",o)}}else{console.warn("Module Error - module does not exist:",t)}};u.prototype.registerModule=function(t,o){this;u.prototype.moduleBindings[t]=o};u.prototype.bindModules=function(){this.modules={};for(var t in u.prototype.moduleBindings){this.modules[t]=new u.prototype.moduleBindings[t](this)}};u.prototype.modExists=function(t,o){if(this.modules[t]){return!0}else{if(o){console.error("Tabulator Module Not Installed: "+t)}return!1}};u.prototype.helpers={elVisible:function(t){return!(0>=t.offsetWidth&&0>=t.offsetHeight)},elOffset:function(t){var o=t.getBoundingClientRect();return{top:o.top+window.pageYOffset-document.documentElement.clientTop,left:o.left+window.pageXOffset-document.documentElement.clientLeft}},deepClone:function(t){var o=Object.assign(Array.isArray(t)?[]:{},t);for(var l in t){if(null!=t[l]&&"object"===_typeof(t[l])){if(t[l]instanceof Date){o[l]=new Date(t[l])}else{o[l]=this.deepClone(t[l])}}}return o}};u.prototype.comms={tables:[],register:function(t){u.prototype.comms.tables.push(t)},deregister:function(t){var o=u.prototype.comms.tables.indexOf(t);if(-1<o){u.prototype.comms.tables.splice(o,1)}},lookupTable:function(t,o){var l=[],a,n;if("string"==typeof t){a=document.querySelectorAll(t);if(a.length){for(var r=0;r<a.length;r++){n=u.prototype.comms.matchElement(a[r]);if(n){l.push(n)}}}}else if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement||t instanceof u){n=u.prototype.comms.matchElement(t);if(n){l.push(n)}}else if(Array.isArray(t)){t.forEach(function(t){l=l.concat(u.prototype.comms.lookupTable(t))})}else{if(!o){console.warn("Table Connection Error - Invalid Selector",t)}}return l},matchElement:function(t){return u.prototype.comms.tables.find(function(o){return t instanceof u?o===t:o.element===t})}};u.prototype.findTable=function(t){var o=u.prototype.comms.lookupTable(t,!0);return Array.isArray(o)&&!o.length?!1:o};var m=function(t){this.table=t;this.mode=null};m.prototype.initialize=function(t){if(this.modes[t]){this.mode=t}else{console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+t);this.mode="fitData"}this.table.element.setAttribute("tabulator-layout",this.mode)};m.prototype.getMode=function(){return this.mode};m.prototype.layout=function(){this.modes[this.mode].call(this,this.table.columnManager.columnsByIndex);if(0===this.mode.indexOf("fitData")&&this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.columns){this.table.modules.persistence.save("columns")}};m.prototype.modes={fitData:function(t){if(this.table.options.virtualDomHoz){this.table.vdomHoz.fitDataLayoutOverride()}else{t.forEach(function(t){t.reinitializeWidth()})}if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}},fitDataFill:function(t){t.forEach(function(t){t.reinitializeWidth()});if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}},fitDataTable:function(t){t.forEach(function(t){t.reinitializeWidth()});if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}},fitDataStretch:function(t){var o=this,l=0,a=this.table.rowManager.element.clientWidth,n=0,r=!1;t.forEach(function(t){if(!t.widthFixed){t.reinitializeWidth()}if(o.table.options.responsiveLayout?t.modules.responsive.visible:t.visible){r=t}if(t.visible){l+=t.getWidth()}});if(r){n=a-l+r.getWidth();if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){r.setWidth(0);this.table.modules.responsiveLayout.update()}if(0<n){r.setWidth(n)}else{r.reinitializeWidth()}}else{if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}}},fitColumns:function(t){var a=this,n=a.table.element.clientWidth,r=0,s=0,d=0,p=0,c=[],u=[],m=0,g=0,h=0;function o(t){var o;if("string"==typeof t){if(-1<t.indexOf("%")){o=n/100*parseInt(t)}else{o=parseInt(t)}}else{o=t}return o}function l(t,a,n,r){var c=[],u=0,m=0,g=0,h=d,b=0,f=0,y=[];function s(t){return n*(t.column.definition.widthGrow||1)}function p(t){return o(t.width)-n*(t.column.definition.widthShrink||0)}t.forEach(function(t){var o=r?p(t):s(t);if(t.column.minWidth>=o){c.push(t)}else{if(t.column.maxWidth&&t.column.maxWidth<o){t.width=t.column.maxWidth;a-=t.column.maxWidth;h-=r?t.column.definition.widthShrink||1:t.column.definition.widthGrow||1;if(h){n=Math.floor(a/h)}}else{y.push(t);f+=r?t.column.definition.widthShrink||1:t.column.definition.widthGrow||1}}});if(c.length){c.forEach(function(t){u+=r?t.width-t.column.minWidth:t.column.minWidth;t.width=t.column.minWidth});m=a-u;g=f?Math.floor(m/f):m;b=m-g*f;b+=l(y,m,g,r)}else{b=f?a-Math.floor(a/f)*f:a;y.forEach(function(t){t.width=r?p(t):s(t)})}return b}if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}if(this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight){n-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth}t.forEach(function(t){var l,a,n;if(t.visible){l=t.definition.width;a=parseInt(t.minWidth);if(l){n=o(l);r+=n>a?n:a;if(t.definition.widthShrink){u.push({column:t,width:n>a?n:a});m+=t.definition.widthShrink}}else{c.push({column:t,width:0});d+=t.definition.widthGrow||1}}});s=n-r;p=Math.floor(s/d);var h=l(c,s,p,!1);if(c.length&&0<h){c[c.length-1].width+=+h}c.forEach(function(t){s-=t.width});g=Math.abs(h)+s;if(0<g&&m){h=l(u,g,Math.floor(g/m),!0)}if(u.length){u[u.length-1].width-=h}c.forEach(function(t){t.column.setWidth(t.width)});u.forEach(function(t){t.column.setWidth(t.width)})}};u.prototype.registerModule("layout",m);var g=function(t){this.table=t;this.locale="default";this.lang=!1;this.bindings={};this.langList={}};g.prototype.initialize=function(){this.langList=u.prototype.helpers.deepClone(this.langs)};g.prototype.setHeaderFilterPlaceholder=function(t){this.langList.default.headerFilters.default=t};g.prototype.setHeaderFilterColumnPlaceholder=function(t,o){this.langList.default.headerFilters.columns[t]=o;if(this.lang&&!this.lang.headerFilters.columns[t]){this.lang.headerFilters.columns[t]=o}};g.prototype.installLang=function(t,o){if(this.langList[t]){this._setLangProp(this.langList[t],o)}else{this.langList[t]=o}};g.prototype._setLangProp=function(t,o){for(var l in o){if(t[l]&&"object"==_typeof(t[l])){this._setLangProp(t[l],o[l])}else{t[l]=o[l]}}};g.prototype.setLocale=function(t){var l=this;t=t||"default";function o(t,l){for(var a in t){if("object"==_typeof(t[a])){if(!l[a]){l[a]={}}o(t[a],l[a])}else{l[a]=t[a]}}}if(!0===t&&navigator.language){t=navigator.language.toLowerCase()}if(t){if(!l.langList[t]){var a=t.split("-")[0];if(l.langList[a]){console.warn("Localization Error - Exact matching locale not found, using closest match: ",t,a);t=a}else{console.warn("Localization Error - Matching locale not found, using default: ",t);t="default"}}}l.locale=t;l.lang=u.prototype.helpers.deepClone(l.langList.default||{});if("default"!=t){o(l.langList[t],l.lang)}l.table.options.localized.call(l.table,l.locale,l.lang);l._executeBindings()};g.prototype.getLocale=function(){return self.locale};g.prototype.getLang=function(t){return t?this.langList[t]:this.lang};g.prototype.getText=function(t,o){var t=o?t+"|"+o:t,l=t.split("|"),a=this._getLangElement(l,this.locale);return a||""};g.prototype._getLangElement=function(t){var o=this,l=o.lang;t.forEach(function(t){var o;if(l){o=l[t];if("undefined"!=typeof o){l=o}else{l=!1}}});return l};g.prototype.bind=function(t,o){if(!this.bindings[t]){this.bindings[t]=[]}this.bindings[t].push(o);o(this.getText(t),this.lang)};g.prototype._executeBindings=function(){var t=this,o=function(o){t.bindings[o].forEach(function(l){l(t.getText(o),t.lang)})};for(var l in t.bindings){o(l)}};g.prototype.langs={default:{groups:{item:"item",items:"items"},columns:{},ajax:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All"},headerFilters:{default:"filter column...",columns:{}}}};u.prototype.registerModule("localize",g);var h=function(t){this.table=t};h.prototype.getConnections=function(t){var o=this,l=[],a;a=u.prototype.comms.lookupTable(t);a.forEach(function(t){if(o.table!==t){l.push(t)}});return l};h.prototype.send=function(t,o,l,a){var n=this,r=this.getConnections(t);r.forEach(function(t){t.tableComms(n.table.element,o,l,a)});if(!r.length&&t){console.warn("Table Connection Error - No tables matching selector found",t)}};h.prototype.receive=function(t,o,l,a){if(this.table.modExists(o)){return this.table.modules[o].commsReceived(t,l,a)}else{console.warn("Inter-table Comms Error - no such module:",o)}};u.prototype.registerModule("comms",h);var b=function(t){this.table=t;this.allowedTypes=["","data","download","clipboard","print","htmlOutput"]};b.prototype.initializeColumn=function(t){var o=this,l=!1,a={};this.allowedTypes.forEach(function(n){var r="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),s;if(t.definition[r]){s=o.lookupAccessor(t.definition[r]);if(s){l=!0;a[r]={accessor:s,params:t.definition[r+"Params"]||{}}}}});if(l){t.modules.accessor=a}};b.prototype.lookupAccessor=function(t){var o=!1;switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":if(this.accessors[t]){o=this.accessors[t]}else{console.warn("Accessor Error - No such accessor found, ignoring: ",t)}break;case"function":o=t;break;}return o};b.prototype.transformRow=function(t,o){var l="accessor"+(o.charAt(0).toUpperCase()+o.slice(1)),a=t.getComponent(),n=u.prototype.helpers.deepClone(t.data||{});this.table.columnManager.traverse(function(t){var r,s,d,p;if(t.modules.accessor){s=t.modules.accessor[l]||t.modules.accessor.accessor||!1;if(s){r=t.getFieldValue(n);if("undefined"!=r){p=t.getComponent();d="function"==typeof s.params?s.params(r,n,o,p,a):s.params;t.setFieldValue(n,s.accessor(r,n,o,d,p,a))}}}});return n},b.prototype.accessors={};u.prototype.registerModule("accessor",b);var f=function(t){this.table=t;this.config=!1;this.url="";this.urlGenerator=!1;this.params=!1;this.loaderElement=this.createLoaderElement();this.msgElement=this.createMsgElement();this.loadingElement=!1;this.errorElement=!1;this.loaderPromise=!1;this.progressiveLoad=!1;this.loading=!1;this.requestOrder=0};f.prototype.initialize=function(){var t;this.loaderElement.appendChild(this.msgElement);if(this.table.options.ajaxLoaderLoading){if("string"==typeof this.table.options.ajaxLoaderLoading){t=document.createElement("template");t.innerHTML=this.table.options.ajaxLoaderLoading.trim();this.loadingElement=t.content.firstChild}else{this.loadingElement=this.table.options.ajaxLoaderLoading}}this.loaderPromise=this.table.options.ajaxRequestFunc||this.defaultLoaderPromise;this.urlGenerator=this.table.options.ajaxURLGenerator||this.defaultURLGenerator;if(this.table.options.ajaxLoaderError){if("string"==typeof this.table.options.ajaxLoaderError){t=document.createElement("template");t.innerHTML=this.table.options.ajaxLoaderError.trim();this.errorElement=t.content.firstChild}else{this.errorElement=this.table.options.ajaxLoaderError}}if(this.table.options.ajaxParams){this.setParams(this.table.options.ajaxParams)}if(this.table.options.ajaxConfig){this.setConfig(this.table.options.ajaxConfig)}if(this.table.options.ajaxURL){this.setUrl(this.table.options.ajaxURL)}if(this.table.options.ajaxProgressiveLoad){if(this.table.options.pagination){this.progressiveLoad=!1;console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time")}else{if(this.table.modExists("page")){this.progressiveLoad=this.table.options.ajaxProgressiveLoad;this.table.modules.page.initializeProgressive(this.progressiveLoad)}else{console.error("Pagination plugin is required for progressive ajax loading")}}}};f.prototype.createLoaderElement=function(){var t=document.createElement("div");t.classList.add("tabulator-loader");return t};f.prototype.createMsgElement=function(){var t=document.createElement("div");t.classList.add("tabulator-loader-msg");t.setAttribute("role","alert");return t};f.prototype.setParams=function(t,o){if(o){this.params=this.params||{};for(var l in t){this.params[l]=t[l]}}else{this.params=t}};f.prototype.getParams=function(){return this.params||{}};f.prototype.setConfig=function(t){this._loadDefaultConfig();if("string"==typeof t){this.config.method=t}else{for(var o in t){this.config[o]=t[o]}}};f.prototype._loadDefaultConfig=function(t){var o=this;if(!o.config||t){o.config={};for(var l in o.defaultConfig){o.config[l]=o.defaultConfig[l]}}};f.prototype.setUrl=function(t){this.url=t};f.prototype.getUrl=function(){return this.url};f.prototype.loadData=function(t,o){this;if(this.progressiveLoad){return this._loadDataProgressive()}else{return this._loadDataStandard(t,o)}};f.prototype.nextPage=function(t){var o;if(!this.loading){o=this.table.options.ajaxProgressiveLoadScrollMargin||2*this.table.rowManager.getElement().clientHeight;if(t<o){this.table.modules.page.nextPage().then(function(){}).catch(function(){})}}};f.prototype.blockActiveRequest=function(){this.requestOrder++};f.prototype._loadDataProgressive=function(){this.table.rowManager.setData([]);return this.table.modules.page.setPage(1)};f.prototype._loadDataStandard=function(t,o){var l=this;return new Promise(function(a,n){l.sendRequest(t).then(function(r){l.table.rowManager.setData(r,t,o).then(function(){a()}).catch(function(t){n(t)})}).catch(function(t){n(t)})})};f.prototype.generateParamsList=function(t,o){var l=this,a=[];o=o||"";if(Array.isArray(t)){t.forEach(function(t,n){a=a.concat(l.generateParamsList(t,o?o+"["+n+"]":n))})}else if("object"===("undefined"==typeof t?"undefined":_typeof(t))){for(var n in t){a=a.concat(l.generateParamsList(t[n],o?o+"["+n+"]":n))}}else{a.push({key:o,value:t})}return a};f.prototype.serializeParams=function(t){var o=this.generateParamsList(t),l=[];o.forEach(function(t){l.push(encodeURIComponent(t.key)+"="+encodeURIComponent(t.value))});return l.join("&")};f.prototype.sendRequest=function(t){var o=this,l=this,a=l.url,n;l.requestOrder++;n=l.requestOrder;l._loadDefaultConfig();return new Promise(function(r,s){if(!1!==l.table.options.ajaxRequesting.call(o.table,l.url,l.params)){l.loading=!0;if(!t){l.showLoader()}o.loaderPromise(a,l.config,l.params).then(function(t){if(n===l.requestOrder){if(l.table.options.ajaxResponse){t=l.table.options.ajaxResponse.call(l.table,l.url,l.params,t)}r(t);l.hideLoader();l.loading=!1}else{console.warn("Ajax Response Blocked - An active ajax request was blocked by an attempt to change table data while the request was being made")}}).catch(function(t){console.error("Ajax Load Error: ",t);l.table.options.ajaxError.call(l.table,t);l.showError();setTimeout(function(){l.hideLoader()},3e3);l.loading=!1;s(t)})}else{s()}})};f.prototype.showLoader=function(){var t="function"==typeof this.table.options.ajaxLoader?this.table.options.ajaxLoader():this.table.options.ajaxLoader;if(t){this.hideLoader();while(this.msgElement.firstChild){this.msgElement.removeChild(this.msgElement.firstChild)}this.msgElement.classList.remove("tabulator-error");this.msgElement.classList.add("tabulator-loading");if(this.loadingElement){this.msgElement.appendChild(this.loadingElement)}else{this.msgElement.innerHTML=this.table.modules.localize.getText("ajax|loading")}this.table.element.appendChild(this.loaderElement)}};f.prototype.showError=function(){this.hideLoader();while(this.msgElement.firstChild){this.msgElement.removeChild(this.msgElement.firstChild)}this.msgElement.classList.remove("tabulator-loading");this.msgElement.classList.add("tabulator-error");if(this.errorElement){this.msgElement.appendChild(this.errorElement)}else{this.msgElement.innerHTML=this.table.modules.localize.getText("ajax|error")}this.table.element.appendChild(this.loaderElement)};f.prototype.hideLoader=function(){if(this.loaderElement.parentNode){this.loaderElement.parentNode.removeChild(this.loaderElement)}};f.prototype.defaultConfig={method:"GET"};f.prototype.defaultURLGenerator=function(t,o,l){if(t){if(l&&Object.keys(l).length){if(!o.method||"get"==o.method.toLowerCase()){o.method="get";t+=(t.includes("?")?"&":"?")+this.modules.ajax.serializeParams(l)}}}return t};f.prototype.defaultLoaderPromise=function(t,o,l){var a=this,n;return new Promise(function(r,s){t=a.urlGenerator.call(a.table,t,o,l);if("GET"!=o.method.toUpperCase()){n="object"===_typeof(a.table.options.ajaxContentType)?a.table.options.ajaxContentType:a.contentTypeFormatters[a.table.options.ajaxContentType];if(n){for(var d in n.headers){if(!o.headers){o.headers={}}if("undefined"==typeof o.headers[d]){o.headers[d]=n.headers[d]}}o.body=n.body.call(a,t,o,l)}else{console.warn("Ajax Error - Invalid ajaxContentType value:",a.table.options.ajaxContentType)}}if(t){if("undefined"==typeof o.headers){o.headers={}}if("undefined"==typeof o.headers.Accept){o.headers.Accept="application/json"}if("undefined"==typeof o.headers["X-Requested-With"]){o.headers["X-Requested-With"]="XMLHttpRequest"}if("undefined"==typeof o.mode){o.mode="cors"}if("cors"==o.mode){if("undefined"==typeof o.headers["Access-Control-Allow-Origin"]){o.headers["Access-Control-Allow-Origin"]=window.location.origin}if("undefined"==typeof o.credentials){o.credentials="same-origin"}}else{if("undefined"==typeof o.credentials){o.credentials="include"}}fetch(t,o).then(function(t){if(t.ok){t.json().then(function(t){r(t)}).catch(function(t){s(t);console.warn("Ajax Load Error - Invalid JSON returned",t)})}else{console.error("Ajax Load Error - Connection Error: "+t.status,t.statusText);s(t)}}).catch(function(t){console.error("Ajax Load Error - Connection Error: ",t);s(t)})}else{console.warn("Ajax Load Error - No URL Set");r([])}})};f.prototype.contentTypeFormatters={json:{headers:{"Content-Type":"application/json"},body:function(t,o,l){return JSON.stringify(l)}},form:{headers:{},body:function(t,o,l){var a=this.generateParamsList(l),n=new FormData;a.forEach(function(t){n.append(t.key,t.value)});return n}}};u.prototype.registerModule("ajax",f);var y=function(t){this._row=t};y.prototype.getData=function(t){return this._row.getData(t)};y.prototype.getElement=function(){return this._row.getElement()};y.prototype.getTable=function(){return this._row.table};y.prototype.getCells=function(){var t=[];this._row.getCells().forEach(function(o){t.push(o.getComponent())});return t};y.prototype.getCell=function(t){var o=this._row.getCell(t);return o?o.getComponent():!1};y.prototype._getSelf=function(){return this._row};var w=function(t){this.table=t;this.topCalcs=[];this.botCalcs=[];this.genColumn=!1;this.topElement=this.createElement();this.botElement=this.createElement();this.topRow=!1;this.botRow=!1;this.topInitialized=!1;this.botInitialized=!1;this.initialize()};w.prototype.createElement=function(){var t=document.createElement("div");t.classList.add("tabulator-calcs-holder");return t};w.prototype.initialize=function(){this.genColumn=new l({field:"value"},this)};w.prototype.registerColumnField=function(){};w.prototype.initializeColumn=function(t){var o=t.definition,l={topCalcParams:o.topCalcParams||{},botCalcParams:o.bottomCalcParams||{}};if(o.topCalc){switch(_typeof(o.topCalc)){case"string":if(this.calculations[o.topCalc]){l.topCalc=this.calculations[o.topCalc]}else{console.warn("Column Calc Error - No such calculation found, ignoring: ",o.topCalc)}break;case"function":l.topCalc=o.topCalc;break;}if(l.topCalc){t.modules.columnCalcs=l;this.topCalcs.push(t);if("group"!=this.table.options.columnCalcs){this.initializeTopRow()}}}if(o.bottomCalc){switch(_typeof(o.bottomCalc)){case"string":if(this.calculations[o.bottomCalc]){l.botCalc=this.calculations[o.bottomCalc]}else{console.warn("Column Calc Error - No such calculation found, ignoring: ",o.bottomCalc)}break;case"function":l.botCalc=o.bottomCalc;break;}if(l.botCalc){t.modules.columnCalcs=l;this.botCalcs.push(t);if("group"!=this.table.options.columnCalcs){this.initializeBottomRow()}}}};w.prototype.removeCalcs=function(){var t=!1;if(this.topInitialized){this.topInitialized=!1;this.topElement.parentNode.removeChild(this.topElement);t=!0}if(this.botInitialized){this.botInitialized=!1;this.table.footerManager.remove(this.botElement);t=!0}if(t){this.table.rowManager.adjustTableSize()}};w.prototype.initializeTopRow=function(){if(!this.topInitialized){this.table.columnManager.getElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling);this.topInitialized=!0}};w.prototype.initializeBottomRow=function(){if(!this.botInitialized){this.table.footerManager.prepend(this.botElement);this.botInitialized=!0}};w.prototype.scrollHorizontal=function(t){if(this.botInitialized&&this.botRow){this.botRow.getElement().style.marginLeft=-t+"px"}};w.prototype.recalc=function(t){var o;if(this.topInitialized||this.botInitialized){this.rowsToData(t);if(this.topInitialized){if(this.topRow){this.topRow.deleteCells()}o=this.generateRow("top",this.rowsToData(t));this.topRow=o;while(this.topElement.firstChild){this.topElement.removeChild(this.topElement.firstChild)}this.topElement.appendChild(o.getElement());o.initialize(!0)}if(this.botInitialized){if(this.botRow){this.botRow.deleteCells()}o=this.generateRow("bottom",this.rowsToData(t));this.botRow=o;while(this.botElement.firstChild){this.botElement.removeChild(this.botElement.firstChild)}this.botElement.appendChild(o.getElement());o.initialize(!0)}this.table.rowManager.adjustTableSize();if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layout()}}};w.prototype.recalcRowGroup=function(t){this.recalcGroup(this.table.modules.groupRows.getRowGroup(t))};w.prototype.recalcAll=function(){var t=this;if(this.topCalcs.length||this.botCalcs.length){if("group"!==this.table.options.columnCalcs){this.recalc(this.table.rowManager.activeRows)}if(this.table.options.groupBy&&"table"!==this.table.options.columnCalcs){var o=table.modules.groupRows.getChildGroups();o.forEach(function(o){t.recalcGroup(o)})}}};w.prototype.recalcGroup=function(t){var o,l;if(t){if(t.calcs){if(t.calcs.bottom){o=this.rowsToData(t.rows);l=this.generateRowData("bottom",o);t.calcs.bottom.updateData(l);t.calcs.bottom.reinitialize()}if(t.calcs.top){o=this.rowsToData(t.rows);l=this.generateRowData("top",o);t.calcs.top.updateData(l);t.calcs.top.reinitialize()}}}};w.prototype.generateTopRow=function(t){return this.generateRow("top",this.rowsToData(t))};w.prototype.generateBottomRow=function(t){return this.generateRow("bottom",this.rowsToData(t))};w.prototype.rowsToData=function(t){var o=this,l=[];t.forEach(function(t){l.push(t.getData());if(o.table.options.dataTree&&o.table.options.dataTreeChildColumnCalcs){if(t.modules.dataTree.open){var a=o.rowsToData(o.table.modules.dataTree.getFilteredTreeChildren(t));l=l.concat(a)}}});return l};w.prototype.generateRow=function(t,o){var l=this,a=this.generateRowData(t,o),n;if(l.table.modExists("mutator")){l.table.modules.mutator.disable()}n=new s(a,this,"calc");if(l.table.modExists("mutator")){l.table.modules.mutator.enable()}n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+t);n.component=!1;n.getComponent=function(){if(!this.component){this.component=new y(this)}return this.component};n.generateCells=function(){var o=[];l.table.columnManager.columnsByIndex.forEach(function(a){l.genColumn.setField(a.getField());l.genColumn.hozAlign=a.hozAlign;if(a.definition[t+"CalcFormatter"]&&l.table.modExists("format")){l.genColumn.modules.format={formatter:l.table.modules.format.getFormatter(a.definition[t+"CalcFormatter"]),params:a.definition[t+"CalcFormatterParams"]||{}}}else{l.genColumn.modules.format={formatter:l.table.modules.format.getFormatter("plaintext"),params:{}}}l.genColumn.definition.cssClass=a.definition.cssClass;var r=new p(l.genColumn,n);r.getElement();r.column=a;r.setWidth();a.cells.push(r);o.push(r);if(!a.visible){r.hide()}});this.cells=o};return n};w.prototype.generateRowData=function(t,o){var l={},a="top"==t?this.topCalcs:this.botCalcs,n="top"==t?"topCalc":"botCalc",r,s;a.forEach(function(t){var a=[];if(t.modules.columnCalcs&&t.modules.columnCalcs[n]){o.forEach(function(o){a.push(t.getFieldValue(o))});s=n+"Params";r="function"==typeof t.modules.columnCalcs[s]?t.modules.columnCalcs[s](a,o):t.modules.columnCalcs[s];t.setFieldValue(l,t.modules.columnCalcs[n](a,o,r))}});return l};w.prototype.hasTopCalcs=function(){return!!this.topCalcs.length};w.prototype.hasBottomCalcs=function(){return!!this.botCalcs.length};w.prototype.redraw=function(){if(this.topRow){this.topRow.normalizeHeight(!0)}if(this.botRow){this.botRow.normalizeHeight(!0)}};w.prototype.getResults=function(){var t=this,o={},l;if(this.table.options.groupBy&&this.table.modExists("groupRows")){l=this.table.modules.groupRows.getGroups(!0);l.forEach(function(l){o[l.getKey()]=t.getGroupResults(l)})}else{o={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}}}return o};w.prototype.getGroupResults=function(t){var o=this,l=t._getSelf(),a=t.getSubGroups(),n={},r={};a.forEach(function(t){n[t.getKey()]=o.getGroupResults(t)});r={top:l.calcs.top?l.calcs.top.getData():{},bottom:l.calcs.bottom?l.calcs.bottom.getData():{},groups:n};return r};w.prototype.calculations={avg:function(t,o,l){var a=0,n="undefined"!=typeof l.precision?l.precision:2;if(t.length){a=t.reduce(function(t,o){return+t+ +o});a=a/t.length;a=!1!==n?a.toFixed(n):a}return parseFloat(a).toString()},max:function(t,o,l){var a=null,n="undefined"!=typeof l.precision?l.precision:!1;t.forEach(function(t){t=+t;if(t>a||null===a){a=t}});return null!==a?!1!==n?a.toFixed(n):a:""},min:function(t,o,l){var a=null,n="undefined"!=typeof l.precision?l.precision:!1;t.forEach(function(t){t=+t;if(t<a||null===a){a=t}});return null!==a?!1!==n?a.toFixed(n):a:""},sum:function(t,o,l){var a=0,n="undefined"!=typeof l.precision?l.precision:!1;if(t.length){t.forEach(function(t){t=+t;a+=!isNaN(t)?+t:0})}return!1!==n?a.toFixed(n):a},concat:function(t){var o=0;if(t.length){o=t.reduce(function(t,o){return t+""+(o+"")})}return o},count:function(t){var o=0;if(t.length){t.forEach(function(t){if(t){o++}})}return o}};u.prototype.registerModule("columnCalcs",w);var v=function(t){this.table=t;this.mode=!0;this.pasteParser=function(){};this.pasteAction=function(){};this.customSelection=!1;this.rowRange=!1;this.blocked=!0};v.prototype.initialize=function(){var t=this;this.mode=this.table.options.clipboard;this.rowRange=this.table.options.clipboardCopyRowRange;if(!0===this.mode||"copy"===this.mode){this.table.element.addEventListener("copy",function(o){var l,a,n;if(!t.blocked){o.preventDefault();if(t.customSelection){l=t.customSelection;if(t.table.options.clipboardCopyFormatter){l=t.table.options.clipboardCopyFormatter("plain",l)}}else{var n=t.table.modules.export.generateExportList(t.table.options.clipboardCopyConfig,t.table.options.clipboardCopyStyled,t.rowRange,"clipboard");a=t.table.modules.export.genereateHTMLTable(n);l=a?t.generatePlainContent(n):"";if(t.table.options.clipboardCopyFormatter){l=t.table.options.clipboardCopyFormatter("plain",l);a=t.table.options.clipboardCopyFormatter("html",a)}}if(window.clipboardData&&window.clipboardData.setData){window.clipboardData.setData("Text",l)}else if(o.clipboardData&&o.clipboardData.setData){o.clipboardData.setData("text/plain",l);if(a){o.clipboardData.setData("text/html",a)}}else if(o.originalEvent&&o.originalEvent.clipboardData.setData){o.originalEvent.clipboardData.setData("text/plain",l);if(a){o.originalEvent.clipboardData.setData("text/html",a)}}t.table.options.clipboardCopied.call(t.table,l,a);t.reset()}})}if(!0===this.mode||"paste"===this.mode){this.table.element.addEventListener("paste",function(o){t.paste(o)})}this.setPasteParser(this.table.options.clipboardPasteParser);this.setPasteAction(this.table.options.clipboardPasteAction)};v.prototype.reset=function(){this.blocked=!0;this.customSelection=!1};v.prototype.generatePlainContent=function(t){var o=[];t.forEach(function(t){var l=[];t.columns.forEach(function(o){var a="";if(o){if("group"===t.type){o.value=o.component.getKey()}if(null===o.value){a=""}else{switch(_typeof(o.value)){case"object":a=JSON.stringify(o.value);break;case"undefined":a="";break;default:a=o.value;}}}l.push(a)});o.push(l.join("\t"))});return o.join("\n")};v.prototype.copy=function(t,o){var t,l,a;this.blocked=!1;this.customSelection=!1;if(!0===this.mode||"copy"===this.mode){this.rowRange=t||this.table.options.clipboardCopyRowRange;if("undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){t=document.createRange();t.selectNodeContents(this.table.element);l=window.getSelection();if(l.toString()&&o){this.customSelection=l.toString()}l.removeAllRanges();l.addRange(t)}else if("undefined"!=typeof document.selection&&"undefined"!=typeof document.body.createTextRange){a=document.body.createTextRange();a.moveToElementText(this.table.element);a.select()}document.execCommand("copy");if(l){l.removeAllRanges()}}};v.prototype.setPasteAction=function(t){switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":this.pasteAction=this.pasteActions[t];if(!this.pasteAction){console.warn("Clipboard Error - No such paste action found:",t)}break;case"function":this.pasteAction=t;break;}};v.prototype.setPasteParser=function(t){switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":this.pasteParser=this.pasteParsers[t];if(!this.pasteParser){console.warn("Clipboard Error - No such paste parser found:",t)}break;case"function":this.pasteParser=t;break;}};v.prototype.paste=function(t){var o,l,a;if(this.checkPaseOrigin(t)){o=this.getPasteData(t);l=this.pasteParser.call(this,o);if(l){t.preventDefault();if(this.table.modExists("mutator")){l=this.mutateData(l)}a=this.pasteAction.call(this,l);this.table.options.clipboardPasted.call(this.table,o,l,a)}else{this.table.options.clipboardPasteError.call(this.table,o)}}};v.prototype.mutateData=function(t){var o=this,l=[];if(Array.isArray(t)){t.forEach(function(t){l.push(o.table.modules.mutator.transformRow(t,"clipboard"))})}else{l=t}return l};v.prototype.checkPaseOrigin=function(t){var o=!0;if("DIV"!=t.target.tagName||this.table.modules.edit.currentCell){o=!1}return o};v.prototype.getPasteData=function(t){var o;if(window.clipboardData&&window.clipboardData.getData){o=window.clipboardData.getData("Text")}else if(t.clipboardData&&t.clipboardData.getData){o=t.clipboardData.getData("text/plain")}else if(t.originalEvent&&t.originalEvent.clipboardData.getData){o=t.originalEvent.clipboardData.getData("text/plain")}return o};v.prototype.pasteParsers={table:function(t){var o=[],l=!0,a=this.table.columnManager.columns,n=[],r=[];t=t.split("\n");t.forEach(function(t){o.push(t.split("\t"))});if(o.length&&!(1===o.length&&2>o[0].length)){o[0].forEach(function(t){var o=a.find(function(o){return t&&o.definition.title&&t.trim()&&o.definition.title.trim()===t.trim()});if(o){n.push(o)}else{l=!1}});if(!l){l=!0;n=[];o[0].forEach(function(t){var o=a.find(function(o){return t&&o.field&&t.trim()&&o.field.trim()===t.trim()});if(o){n.push(o)}else{l=!1}});if(!l){n=this.table.columnManager.columnsByIndex}}if(l){o.shift()}o.forEach(function(t){var o={};t.forEach(function(t,l){if(n[l]){o[n[l].field]=t}});r.push(o)});return r}else{return!1}}};v.prototype.pasteActions={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}};u.prototype.registerModule("clipboard",v);var E=function(t){this.table=t;this.indent=10;this.field="";this.collapseEl=null;this.expandEl=null;this.branchEl=null;this.elementField=!1;this.startOpen=function(){};this.displayIndex=0};E.prototype.initialize=function(){var t=null,o=this.table.columnManager.getFirstVisibileColumn(),l=this.table.options;this.field=l.dataTreeChildField;this.indent=l.dataTreeChildIndent;this.elementField=l.dataTreeElementColumn||(o?o.field:!1);if(l.dataTreeBranchElement){if(!0===l.dataTreeBranchElement){this.branchEl=document.createElement("div");this.branchEl.classList.add("tabulator-data-tree-branch")}else{if("string"==typeof l.dataTreeBranchElement){t=document.createElement("div");t.innerHTML=l.dataTreeBranchElement;this.branchEl=t.firstChild}else{this.branchEl=l.dataTreeBranchElement}}}if(l.dataTreeCollapseElement){if("string"==typeof l.dataTreeCollapseElement){t=document.createElement("div");t.innerHTML=l.dataTreeCollapseElement;this.collapseEl=t.firstChild}else{this.collapseEl=l.dataTreeCollapseElement}}else{this.collapseEl=document.createElement("div");this.collapseEl.classList.add("tabulator-data-tree-control");this.collapseEl.tabIndex=0;this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"}if(l.dataTreeExpandElement){if("string"==typeof l.dataTreeExpandElement){t=document.createElement("div");t.innerHTML=l.dataTreeExpandElement;this.expandEl=t.firstChild}else{this.expandEl=l.dataTreeExpandElement}}else{this.expandEl=document.createElement("div");this.expandEl.classList.add("tabulator-data-tree-control");this.expandEl.tabIndex=0;this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"}switch(_typeof(l.dataTreeStartExpanded)){case"boolean":this.startOpen=function(){return l.dataTreeStartExpanded};break;case"function":this.startOpen=l.dataTreeStartExpanded;break;default:this.startOpen=function(t,o){return l.dataTreeStartExpanded[o]};break;}};E.prototype.initializeRow=function(t){var o=t.getData()[this.field],l=Array.isArray(o),a=l||!l&&"object"===("undefined"==typeof o?"undefined":_typeof(o))&&null!==o;if(!a&&t.modules.dataTree&&t.modules.dataTree.branchEl){t.modules.dataTree.branchEl.parentNode.removeChild(t.modules.dataTree.branchEl)}if(!a&&t.modules.dataTree&&t.modules.dataTree.controlEl){t.modules.dataTree.controlEl.parentNode.removeChild(t.modules.dataTree.controlEl)}t.modules.dataTree={index:t.modules.dataTree?t.modules.dataTree.index:0,open:a?t.modules.dataTree?t.modules.dataTree.open:this.startOpen(t.getComponent(),0):!1,controlEl:t.modules.dataTree&&a?t.modules.dataTree.controlEl:!1,branchEl:t.modules.dataTree&&a?t.modules.dataTree.branchEl:!1,parent:t.modules.dataTree?t.modules.dataTree.parent:!1,children:a}};E.prototype.layoutRow=function(t){var o=this.elementField?t.getCell(this.elementField):t.getCells()[0],l=o.getElement(),a=t.modules.dataTree;if(a.branchEl){if(a.branchEl.parentNode){a.branchEl.parentNode.removeChild(a.branchEl)}a.branchEl=!1}if(a.controlEl){if(a.controlEl.parentNode){a.controlEl.parentNode.removeChild(a.controlEl)}a.controlEl=!1}this.generateControlElement(t,l);t.getElement().classList.add("tabulator-tree-level-"+a.index);if(a.index){if(this.branchEl){a.branchEl=this.branchEl.cloneNode(!0);l.insertBefore(a.branchEl,l.firstChild);if(this.table.rtl){a.branchEl.style.marginRight=(a.branchEl.offsetWidth+a.branchEl.style.marginLeft)*(a.index-1)+a.index*this.indent+"px"}else{a.branchEl.style.marginLeft=(a.branchEl.offsetWidth+a.branchEl.style.marginRight)*(a.index-1)+a.index*this.indent+"px"}}else{if(this.table.rtl){l.style.paddingRight=parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-right"))+a.index*this.indent+"px"}else{l.style.paddingLeft=parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-left"))+a.index*this.indent+"px"}}}};E.prototype.generateControlElement=function(t,o){var l=this,a=t.modules.dataTree,o=o||t.getCells()[0].getElement(),n=a.controlEl;if(!1!==a.children){if(a.open){a.controlEl=this.collapseEl.cloneNode(!0);a.controlEl.addEventListener("click",function(o){o.stopPropagation();l.collapseRow(t)})}else{a.controlEl=this.expandEl.cloneNode(!0);a.controlEl.addEventListener("click",function(o){o.stopPropagation();l.expandRow(t)})}a.controlEl.addEventListener("mousedown",function(t){t.stopPropagation()});if(n&&n.parentNode===o){n.parentNode.replaceChild(a.controlEl,n)}else{o.insertBefore(a.controlEl,o.firstChild)}}};E.prototype.setDisplayIndex=function(t){this.displayIndex=t};E.prototype.getDisplayIndex=function(){return this.displayIndex};E.prototype.getRows=function(t){var o=this,l=[];t.forEach(function(t){var a,n;l.push(t);if(t instanceof s){t.create();a=t.modules.dataTree.children;if(!a.index&&!1!==a.children){n=o.getChildren(t);n.forEach(function(t){t.create();l.push(t)})}}});return l};E.prototype.getChildren=function(t,o){var l=this,a=t.modules.dataTree,n=[],r=[];if(!1!==a.children&&(a.open||o)){if(!Array.isArray(a.children)){a.children=this.generateChildren(t)}if(this.table.modExists("filter")&&this.table.options.dataTreeFilter){n=this.table.modules.filter.filter(a.children)}else{n=a.children}if(this.table.modExists("sort")&&this.table.options.dataTreeSort){this.table.modules.sort.sort(n)}n.forEach(function(t){r.push(t);var o=l.getChildren(t);o.forEach(function(t){r.push(t)})})}return r};E.prototype.generateChildren=function(t){var o=this,l=[],a=t.getData()[this.field];if(!Array.isArray(a)){a=[a]}a.forEach(function(a){var n=new s(a||{},o.table.rowManager);n.create();n.modules.dataTree.index=t.modules.dataTree.index+1;n.modules.dataTree.parent=t;if(n.modules.dataTree.children){n.modules.dataTree.open=o.startOpen(n.getComponent(),n.modules.dataTree.index)}l.push(n)});return l};E.prototype.expandRow=function(t){var o=t.modules.dataTree;if(!1!==o.children){o.open=!0;t.reinitialize();this.table.rowManager.refreshActiveData("tree",!1,!0);this.table.options.dataTreeRowExpanded(t.getComponent(),t.modules.dataTree.index)}};E.prototype.collapseRow=function(t){var o=t.modules.dataTree;if(!1!==o.children){o.open=!1;t.reinitialize();this.table.rowManager.refreshActiveData("tree",!1,!0);this.table.options.dataTreeRowCollapsed(t.getComponent(),t.modules.dataTree.index)}};E.prototype.toggleRow=function(t){var o=t.modules.dataTree;if(!1!==o.children){if(o.open){this.collapseRow(t)}else{this.expandRow(t)}}};E.prototype.getTreeParent=function(t){return t.modules.dataTree.parent?t.modules.dataTree.parent.getComponent():!1};E.prototype.getFilteredTreeChildren=function(t){var o=t.modules.dataTree,l=[],a;if(o.children){if(!Array.isArray(o.children)){o.children=this.generateChildren(t)}if(this.table.modExists("filter")&&this.table.options.dataTreeFilter){a=this.table.modules.filter.filter(o.children)}else{a=o.children}a.forEach(function(t){if(t instanceof s){l.push(t)}})}return l};E.prototype.rowDelete=function(t){var o=t.modules.dataTree.parent,l;if(o){l=this.findChildIndex(t,o);if(!1!==l){o.data[this.field].splice(l,1)}if(!o.data[this.field].length){delete o.data[this.field]}this.initializeRow(o);this.layoutRow(o)}this.table.rowManager.refreshActiveData("tree",!1,!0)};E.prototype.addTreeChildRow=function(t,o,l,a){var n=!1;if("string"==typeof o){o=JSON.parse(o)}if(!Array.isArray(t.data[this.field])){t.data[this.field]=[];t.modules.dataTree.open=this.startOpen(t.getComponent(),t.modules.dataTree.index)}if("undefined"!=typeof a){n=this.findChildIndex(a,t);if(!1!==n){t.data[this.field].splice(l?n:n+1,0,o)}}if(!1===n){if(l){t.data[this.field].unshift(o)}else{t.data[this.field].push(o)}}this.initializeRow(t);this.layoutRow(t);this.table.rowManager.refreshActiveData("tree",!1,!0)};E.prototype.findChildIndex=function(t,o){var l=this,a=!1;if("object"==("undefined"==typeof t?"undefined":_typeof(t))){if(t instanceof s){a=t.data}else if(t instanceof r){a=t._getSelf().data}else if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement){if(o.modules.dataTree){a=o.modules.dataTree.children.find(function(o){return o instanceof s?o.element===t:!1});if(a){a=a.data}}}}else if("undefined"==typeof t||null===t){a=!1}else{a=o.data[this.field].find(function(o){return o.data[l.table.options.index]==t})}if(a){if(Array.isArray(o.data[this.field])){a=o.data[this.field].indexOf(a)}if(-1==a){a=!1}}return a};E.prototype.getTreeChildren=function(t,o,l){var a=this,n=t.modules.dataTree,r=[];if(n.children){if(!Array.isArray(n.children)){n.children=this.generateChildren(t)}n.children.forEach(function(t){if(t instanceof s){r.push(o?t.getComponent():t);if(l){r=r.concat(a.getTreeChildren(t,o,l))}}})}return r};E.prototype.checkForRestyle=function(t){if(!t.row.cells.indexOf(t)){t.row.reinitialize()}};E.prototype.getChildField=function(){return this.field};E.prototype.redrawNeeded=function(t){return(this.field?"undefined"!=typeof t[this.field]:!1)||(this.elementField?"undefined"!=typeof t[this.elementField]:!1)};u.prototype.registerModule("dataTree",E);var C=function(t){this.table=t};C.prototype.download=function(t,o,l,a,n){var s=this,d=!1;function r(l,a){if(n){if(!0===n){s.triggerDownload(l,a,t,o,!0)}else{n(l)}}else{s.triggerDownload(l,a,t,o)}}if("function"==typeof t){d=t}else{if(s.downloaders[t]){d=s.downloaders[t]}else{console.warn("Download Error - No such download type found: ",t)}}if(d){var p=this.generateExportList(a);d.call(this.table,p,l||{},r)}};C.prototype.generateExportList=function(t){var o=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,t||this.table.options.downloadRowRange,"download"),l=this.table.options.groupHeaderDownload;if(l&&!Array.isArray(l)){l=[l]}o.forEach(function(t){var o;if("group"===t.type){o=t.columns[0];if(l&&l[t.indent]){o.value=l[t.indent](o.value,t.component._group.getRowCount(),t.component._group.getData(),t.component)}}});return o};C.prototype.triggerDownload=function(t,o,l,a,n){var r=document.createElement("a"),s=new Blob([t],{type:o}),a=a||"Tabulator."+("function"==typeof l?"txt":l);s=this.table.options.downloadReady.call(this.table,t,s);if(s){if(n){window.open(window.URL.createObjectURL(s))}else{if(navigator.msSaveOrOpenBlob){navigator.msSaveOrOpenBlob(s,a)}else{r.setAttribute("href",window.URL.createObjectURL(s));r.setAttribute("download",a);r.style.display="none";document.body.appendChild(r);r.click();document.body.removeChild(r)}}if(this.table.options.downloadComplete){this.table.options.downloadComplete()}}};C.prototype.commsReceived=function(t,o,l){switch(o){case"intercept":this.download(l.type,"",l.options,l.active,l.intercept);break;}};C.prototype.downloaders={csv:function(t,o,l){var a=o&&o.delimiter?o.delimiter:",",n=[],r=[];t.forEach(function(t){var o=[];switch(t.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":t.columns.forEach(function(t,o){if(t&&1===t.depth){r[o]="undefined"==typeof t.value||null===t.value?"":"\""+(t.value+"").split("\"").join("\"\"")+"\""}});break;case"row":t.columns.forEach(function(t){if(t){switch(_typeof(t.value)){case"object":t.value=JSON.stringify(t.value);break;case"undefined":case"null":t.value="";break;}o.push("\""+(t.value+"").split("\"").join("\"\"")+"\"")}});n.push(o.join(a));break;}});if(r.length){n.unshift(r.join(a))}n=n.join("\n");if(o.bom){n="\uFEFF"+n}l(n,"text/csv")},json:function(t,o,l){var a=[];t.forEach(function(t){var o={};switch(t.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":t.columns.forEach(function(t){if(t){o[t.component.getField()]=t.value}});a.push(o);break;}});a=JSON.stringify(a,null,"\t");l(a,"application/json")},pdf:function(t,o,l){var n=[],r=[],s={},d=o.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},p=o.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},c=o.jsPDF||{},u=o&&o.title?o.title:"";if(!c.orientation){c.orientation=o.orientation||"landscape"}if(!c.unit){c.unit="pt"}t.forEach(function(t){switch(t.type){case"header":n.push(a(t));break;case"group":r.push(a(t,d));break;case"calc":r.push(a(t,p));break;case"row":r.push(a(t));break;}});function a(t,o){var l=[];t.columns.forEach(function(t){var a;if(t){switch(_typeof(t.value)){case"object":t.value=JSON.stringify(t.value);break;case"undefined":case"null":t.value="";break;}a={content:t.value,colSpan:t.width,rowSpan:t.height};if(o){a.styles=o}l.push(a)}else{l.push("")}});return l}var m=new jsPDF(c);if(o&&o.autoTable){if("function"==typeof o.autoTable){s=o.autoTable(m)||{}}else{s=o.autoTable}}if(u){s.addPageContent=function(){m.text(u,40,30)}}s.head=n;s.body=r;m.autoTable(s);if(o&&o.documentProcessing){o.documentProcessing(m)}l(m.output("arraybuffer"),"application/pdf")},xlsx:function(t,o,l){var n=this,r=o.sheetName||"Sheet1",s=XLSX.utils.book_new(),d;s.SheetNames=[];s.Sheets={};function a(){var o=[],l=[],a={},n={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce(function(t,o){return t+(o&&o.width?o.width:1)},0):0,r:t.length}};t.forEach(function(t,a){var n=[];t.columns.forEach(function(t,o){if(t){n.push(!(t.value instanceof Date)&&"object"===_typeof(t.value)?JSON.stringify(t.value):t.value);if(1<t.width||-1<t.height){l.push({s:{r:a,c:o},e:{r:a+t.height-1,c:o+t.width-1}})}}else{n.push("")}});o.push(n)});XLSX.utils.sheet_add_aoa(a,o);a["!ref"]=XLSX.utils.encode_range(n);if(l.length){a["!merges"]=l}return a}if(o.sheetOnly){l(a());return}if(o.sheets){for(var p in o.sheets){if(!0===o.sheets[p]){s.SheetNames.push(p);s.Sheets[p]=a()}else{s.SheetNames.push(p);this.modules.comms.send(o.sheets[p],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:n.active,intercept:function(t){s.Sheets[p]=t}})}}}else{s.SheetNames.push(r);s.Sheets[r]=a()}if(o.documentProcessing){s=o.documentProcessing(s)}d=XLSX.write(s,{bookType:"xlsx",bookSST:!0,type:"binary"});l(function(t){for(var o=new ArrayBuffer(t.length),l=new Uint8Array(o),a=0;a!=t.length;++a){l[a]=255&t.charCodeAt(a)}return o}(d),"application/octet-stream")},html:function(t,o,l){if(this.modExists("export",!0)){l(this.modules.export.genereateHTMLTable(t),"text/html")}}};u.prototype.registerModule("download",C);var x=function(t){this.table=t;this.currentCell=!1;this.mouseClick=!1;this.recursionBlock=!1;this.invalidEdit=!1;this.editedCells=[]};x.prototype.initializeColumn=function(t){var o=this,l={editor:!1,blocked:!1,check:t.definition.editable,params:t.definition.editorParams||{}};switch(_typeof(t.definition.editor)){case"string":if("tick"===t.definition.editor){t.definition.editor="tickCross";console.warn("DEPRECATION WARNING - the tick editor has been deprecated, please use the tickCross editor")}if(o.editors[t.definition.editor]){l.editor=o.editors[t.definition.editor]}else{console.warn("Editor Error - No such editor found: ",t.definition.editor)}break;case"function":l.editor=t.definition.editor;break;case"boolean":if(!0===t.definition.editor){if("function"!=typeof t.definition.formatter){if("tick"===t.definition.formatter){t.definition.formatter="tickCross";console.warn("DEPRECATION WARNING - the tick editor has been deprecated, please use the tickCross editor")}if(o.editors[t.definition.formatter]){l.editor=o.editors[t.definition.formatter]}else{l.editor=o.editors.input}}else{console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",t.definition.formatter)}}break;}if(l.editor){t.modules.edit=l}};x.prototype.getCurrentCell=function(){return this.currentCell?this.currentCell.getComponent():!1};x.prototype.clearEditor=function(t){var o=this.currentCell,l;this.invalidEdit=!1;if(o){this.currentCell=!1;l=o.getElement();if(t){o.validate()}else{l.classList.remove("tabulator-validation-fail")}l.classList.remove("tabulator-editing");while(l.firstChild){l.removeChild(l.firstChild)}o.row.getElement().classList.remove("tabulator-row-editing")}};x.prototype.cancelEdit=function(){if(this.currentCell){var t=this.currentCell,o=this.currentCell.getComponent();this.clearEditor(!0);t.setValueActual(t.getValue());t.cellRendered();if("textarea"==t.column.definition.editor||t.column.definition.variableHeight){t.row.normalizeHeight(!0)}if(t.column.cellEvents.cellEditCancelled){t.column.cellEvents.cellEditCancelled.call(this.table,o)}this.table.options.cellEditCancelled.call(this.table,o)}};x.prototype.bindEditor=function(t){var o=this,l=t.getElement(!0);l.setAttribute("tabindex",0);l.addEventListener("click",function(){if(!l.classList.contains("tabulator-editing")){l.focus({preventScroll:!0})}});l.addEventListener("mousedown",function(t){if(2===t.button){t.preventDefault()}else{o.mouseClick=!0}});l.addEventListener("focus",function(l){if(!o.recursionBlock){o.edit(t,l,!1)}})};x.prototype.focusCellNoEvent=function(t,o){this.recursionBlock=!0;if(!(o&&"ie"===this.table.browser)){t.getElement().focus({preventScroll:!0})}this.recursionBlock=!1};x.prototype.editCell=function(t,o){this.focusCellNoEvent(t);this.edit(t,!1,o)};x.prototype.focusScrollAdjust=function(t){if("virtual"==this.table.rowManager.getRenderMode()){var o=this.table.rowManager.element.scrollTop,l=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,a=t.row.getElement(),n=a.offsetTop;if(a.offsetTop<o){this.table.rowManager.element.scrollTop-=o-a.offsetTop}else{if(a.offsetTop+a.offsetHeight>l){this.table.rowManager.element.scrollTop+=a.offsetTop+a.offsetHeight-l}}var r=this.table.rowManager.element.scrollLeft,s=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,d=t.getElement(),n=d.offsetLeft;if(this.table.modExists("frozenColumns")){r+=parseInt(this.table.modules.frozenColumns.leftMargin);s-=parseInt(this.table.modules.frozenColumns.rightMargin)}if(this.table.options.virtualDomHoz){r-=parseInt(this.table.vdomHoz.vDomPadLeft);s-=parseInt(this.table.vdomHoz.vDomPadLeft)}if(d.offsetLeft<r){this.table.rowManager.element.scrollLeft-=r-d.offsetLeft}else{if(d.offsetLeft+d.offsetWidth>s){this.table.rowManager.element.scrollLeft+=d.offsetLeft+d.offsetWidth-s}}}};x.prototype.edit=function(t,o,l){var s=this,d=!0,p=function(){},c=t.getElement(),u,m,g;if(this.currentCell){if(!this.invalidEdit){this.cancelEdit()}return}function a(o){if(s.currentCell===t){var l=!0;if(t.column.modules.validate&&s.table.modExists("validate")&&"manual"!=s.table.options.validationMode){l=s.table.modules.validate.validate(t.column.modules.validate,t,o)}if(!0===l||"highlight"===s.table.options.validationMode){s.clearEditor();if(!t.modules.edit){t.modules.edit={}}t.modules.edit.edited=!0;if(-1==s.editedCells.indexOf(t)){s.editedCells.push(t)}t.setValue(o,!0);if(s.table.options.dataTree&&s.table.modExists("dataTree")){s.table.modules.dataTree.checkForRestyle(t)}if(!0!==l){c.classList.add("tabulator-validation-fail");s.table.options.validationFailed.call(s.table,t.getComponent(),o,l);return!1}return!0}else{s.invalidEdit=!0;c.classList.add("tabulator-validation-fail");s.focusCellNoEvent(t,!0);p();s.table.options.validationFailed.call(s.table,t.getComponent(),o,l);return!1}}}function n(){if(s.currentCell===t){s.cancelEdit();if(s.table.options.dataTree&&s.table.modExists("dataTree")){s.table.modules.dataTree.checkForRestyle(t)}}}function r(t){p=t}if(!t.column.modules.edit.blocked){if(o){o.stopPropagation()}switch(_typeof(t.column.modules.edit.check)){case"function":d=t.column.modules.edit.check(t.getComponent());break;case"boolean":d=t.column.modules.edit.check;break;}if(d||l){s.cancelEdit();s.currentCell=t;this.focusScrollAdjust(t);m=t.getComponent();if(this.mouseClick){this.mouseClick=!1;if(t.column.cellEvents.cellClick){t.column.cellEvents.cellClick.call(this.table,o,m)}}if(t.column.cellEvents.cellEditing){t.column.cellEvents.cellEditing.call(this.table,m)}s.table.options.cellEditing.call(this.table,m);g="function"==typeof t.column.modules.edit.params?t.column.modules.edit.params(m):t.column.modules.edit.params;u=t.column.modules.edit.editor.call(s,m,r,a,n,g);if(!1!==u){if(u instanceof Node){c.classList.add("tabulator-editing");t.row.getElement().classList.add("tabulator-row-editing");while(c.firstChild){c.removeChild(c.firstChild)}c.appendChild(u);p();for(var h=c.children,b=0;b<h.length;b++){h[b].addEventListener("click",function(t){t.stopPropagation()})}}else{console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",u);c.blur();return!1}}else{c.blur();return!1}return!0}else{this.mouseClick=!1;c.blur();return!1}}else{this.mouseClick=!1;c.blur();return!1}};x.prototype.maskInput=function(t,o){var a=o.mask,n="undefined"!=typeof o.maskLetterChar?o.maskLetterChar:"A",r="undefined"!=typeof o.maskNumberChar?o.maskNumberChar:"9",s="undefined"!=typeof o.maskWildcardChar?o.maskWildcardChar:"*";function l(o){var d=a[o];if("undefined"!=typeof d&&d!==s&&d!==n&&d!==r){t.value=t.value+""+d;l(o+1)}}t.addEventListener("keydown",function(o){var l=t.value.length,d=o.key;if(46<o.keyCode){if(l>=a.length){o.preventDefault();o.stopPropagation();return!1}else{switch(a[l]){case n:if(d.toUpperCase()==d.toLowerCase()){o.preventDefault();o.stopPropagation();return!1}break;case r:if(isNaN(d)){o.preventDefault();o.stopPropagation();return!1}break;case s:break;default:if(d!==a[l]){o.preventDefault();o.stopPropagation();return!1}}}}});t.addEventListener("keyup",function(a){if(46<a.keyCode){if(o.maskAutoFill){l(t.value.length)}}});if(!t.placeholder){t.placeholder=a}if(o.maskAutoFill){l(t.value.length)}};x.prototype.getEditedCells=function(){var t=[];this.editedCells.forEach(function(o){t.push(o.getComponent())});return t};x.prototype.clearEdited=function(t){var o;if(t.modules.edit&&t.modules.edit.edited){t.modules.edit.edited=!1;if(t.modules.validate){t.modules.validate.invalid=!1}}o=this.editedCells.indexOf(t);if(-1<o){this.editedCells.splice(o,1)}};x.prototype.editors={input:function t(o,l,a,n,r){var d=o.getValue(),t=document.createElement("input");t.setAttribute("type",r.search?"search":"text");t.style.padding="4px";t.style.width="100%";t.style.boxSizing="border-box";if(r.elementAttributes&&"object"==_typeof(r.elementAttributes)){for(var p in r.elementAttributes){if("+"==p.charAt(0)){p=p.slice(1);t.setAttribute(p,t.getAttribute(p)+r.elementAttributes["+"+p])}else{t.setAttribute(p,r.elementAttributes[p])}}}t.value="undefined"!=typeof d?d:"";l(function(){t.focus({preventScroll:!0});t.style.height="100%"});function s(){if((null===d||"undefined"==typeof d)&&""!==t.value||t.value!==d){if(a(t.value)){d=t.value}}else{n()}}t.addEventListener("change",s);t.addEventListener("blur",s);t.addEventListener("keydown",function(t){switch(t.keyCode){case 13:s(t);break;case 27:n();break;case 35:case 36:t.stopPropagation();break;}});if(r.mask){this.table.modules.edit.maskInput(t,r)}return t},textarea:function(t,o,l,a,n){var s=this,d=t.getValue(),p=n.verticalNavigation||"hybrid",c=(null!==d&&"undefined"!=typeof d?d:"")+"",u=(c.match(/(?:\r\n|\r|\n)/g)||[]).length+1,m=document.createElement("textarea"),g=0;m.style.display="block";m.style.padding="2px";m.style.height="100%";m.style.width="100%";m.style.boxSizing="border-box";m.style.whiteSpace="pre-wrap";m.style.resize="none";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var h in n.elementAttributes){if("+"==h.charAt(0)){h=h.slice(1);m.setAttribute(h,m.getAttribute(h)+n.elementAttributes["+"+h])}else{m.setAttribute(h,n.elementAttributes[h])}}}m.value=c;o(function(){m.focus({preventScroll:!0});m.style.height="100%";m.scrollHeight;m.style.height=m.scrollHeight+"px";t.getRow().normalizeHeight()});function r(){if((null===d||"undefined"==typeof d)&&""!==m.value||m.value!==d){if(l(m.value)){d=m.value}setTimeout(function(){t.getRow().normalizeHeight()},300)}else{a()}}m.addEventListener("change",r);m.addEventListener("blur",r);m.addEventListener("keyup",function(){m.style.height="";var o=m.scrollHeight;m.style.height=o+"px";if(o!=g){g=o;t.getRow().normalizeHeight()}});m.addEventListener("keydown",function(t){switch(t.keyCode){case 27:a();break;case 38:if("editor"==p||"hybrid"==p&&m.selectionStart){t.stopImmediatePropagation();t.stopPropagation()}break;case 40:if("editor"==p||"hybrid"==p&&m.selectionStart!==m.value.length){t.stopImmediatePropagation();t.stopPropagation()}break;case 35:case 36:t.stopPropagation();break;}});if(n.mask){this.table.modules.edit.maskInput(m,n)}return m},number:function(t,o,l,a,n){var s=t.getValue(),d=n.verticalNavigation||"editor",p=document.createElement("input");p.setAttribute("type","number");if("undefined"!=typeof n.max){p.setAttribute("max",n.max)}if("undefined"!=typeof n.min){p.setAttribute("min",n.min)}if("undefined"!=typeof n.step){p.setAttribute("step",n.step)}p.style.padding="4px";p.style.width="100%";p.style.boxSizing="border-box";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var c in n.elementAttributes){if("+"==c.charAt(0)){c=c.slice(1);p.setAttribute(c,p.getAttribute(c)+n.elementAttributes["+"+c])}else{p.setAttribute(c,n.elementAttributes[c])}}}p.value=s;var u=function(){r()};o(function(){p.removeEventListener("blur",u);p.focus({preventScroll:!0});p.style.height="100%";p.addEventListener("blur",u)});function r(){var t=p.value;if(!isNaN(t)&&""!==t){t=+t}if(t!==s){if(l(t)){s=t}}else{a()}}p.addEventListener("keydown",function(t){switch(t.keyCode){case 13:r();break;case 27:a();break;case 38:case 40:if("editor"==d){t.stopImmediatePropagation();t.stopPropagation()}break;case 35:case 36:t.stopPropagation();break;}});if(n.mask){this.table.modules.edit.maskInput(p,n)}return p},range:function(t,o,l,a,n){var s=t.getValue(),d=document.createElement("input");d.setAttribute("type","range");if("undefined"!=typeof n.max){d.setAttribute("max",n.max)}if("undefined"!=typeof n.min){d.setAttribute("min",n.min)}if("undefined"!=typeof n.step){d.setAttribute("step",n.step)}d.style.padding="4px";d.style.width="100%";d.style.boxSizing="border-box";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var p in n.elementAttributes){if("+"==p.charAt(0)){p=p.slice(1);d.setAttribute(p,d.getAttribute(p)+n.elementAttributes["+"+p])}else{d.setAttribute(p,n.elementAttributes[p])}}}d.value=s;o(function(){d.focus({preventScroll:!0});d.style.height="100%"});function r(){var t=d.value;if(!isNaN(t)&&""!==t){t=+t}if(t!=s){if(l(t)){s=t}}else{a()}}d.addEventListener("blur",function(){r()});d.addEventListener("keydown",function(t){switch(t.keyCode){case 13:r();break;case 27:a();break;}});return d},select:function(t,o,l,a,n){var R=this,M=this,L=t.getElement(),D=t.getValue(),T=n.verticalNavigation||"editor",z="undefined"!=typeof D||null===D?Array.isArray(D)?D:[D]:"undefined"!=typeof n.defaultValue?n.defaultValue:[],H=document.createElement("input"),k=document.createElement("div"),S=n.multiselect,P=[],A={},F=[],_=[],B=!0,I=!1,N="",V=null;if(Array.isArray(n)||!Array.isArray(n)&&"object"===("undefined"==typeof n?"undefined":_typeof(n))&&!n.values){console.warn("DEPRECATION WARNING - values for the select editor must now be passed into the values property of the editorParams object, not as the editorParams object");n={values:n}}function r(o){var l={},a=M.table.getData(),n;if(o){n=M.table.columnManager.getColumnByField(o)}else{n=t.getColumn()._getSelf()}if(n){a.forEach(function(t){var o=n.getFieldValue(t);if(null!==o&&"undefined"!=typeof o&&""!==o){l[o]=!0}})}else{console.warn("unable to find matching column to create select lookup list:",o)}return Object.keys(l)}function s(o,l){var r=[],s=[];function a(t){var t={label:t.label,value:t.value,itemParams:t.itemParams,elementAttributes:t.elementAttributes,element:!1};if(-1<l.indexOf(t.value)){c(t)}r.push(t);s.push(t);return t}if("function"==typeof o){o=o(t)}if(Array.isArray(o)){o.forEach(function(t){var o;if("object"===("undefined"==typeof t?"undefined":_typeof(t))){if(t.options){o={label:t.label,group:!0,itemParams:t.itemParams,elementAttributes:t.elementAttributes,element:!1};s.push(o);t.options.forEach(function(t){a(t)})}else{a(t)}}else{o={label:t,value:t,element:!1};if(-1<l.indexOf(o.value)){c(o)}r.push(o);s.push(o)}})}else{for(var p in o){var u={label:o[p],value:p,element:!1};if(-1<l.indexOf(u.value)){c(u)}r.push(u);s.push(u)}}if(n.sortValuesList){r.sort(function(t,o){return t.label<o.label?-1:t.label>o.label?1:0});s.sort(function(t,o){return t.label<o.label?-1:t.label>o.label?1:0});if("asc"!==n.sortValuesList){r.reverse();s.reverse()}}P=r;F=s;d()}function d(){while(k.firstChild){k.removeChild(k.firstChild)}F.forEach(function(o){var l=o.element;if(!l){l=document.createElement("div");o.label=n.listItemFormatter?n.listItemFormatter(o.value,o.label,t,l,o.itemParams):o.label;if(o.group){l.classList.add("tabulator-edit-select-list-group");l.tabIndex=0;l.innerHTML=""===o.label?"&nbsp;":o.label}else{l.classList.add("tabulator-edit-select-list-item");l.tabIndex=0;l.innerHTML=""===o.label?"&nbsp;":o.label;l.addEventListener("click",function(){I=!0;setTimeout(function(){I=!1},10);if(S){g(o);H.focus()}else{h(o)}});if(-1<_.indexOf(o)){l.classList.add("active")}}if(o.elementAttributes&&"object"==_typeof(o.elementAttributes)){for(var a in o.elementAttributes){if("+"==a.charAt(0)){a=a.slice(1);l.setAttribute(a,H.getAttribute(a)+o.elementAttributes["+"+a])}else{l.setAttribute(a,o.elementAttributes[a])}}}l.addEventListener("mousedown",function(){B=!1;setTimeout(function(){B=!0},10)});o.element=l}k.appendChild(l)})}function p(t,o){if(!S&&A&&A.element){A.element.classList.remove("active")}if(A&&A.element){A.element.classList.remove("focused")}A=t;if(t.element){t.element.classList.add("focused");if(o){t.element.classList.add("active")}}if(t&&t.element&&t.element.scrollIntoView){t.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}}function c(t){var o=_.indexOf(t);if(-1==o){_.push(t);p(t,!0)}f()}function m(t){var o=_[t];if(-1<t){_.splice(t,1);if(o.element){o.element.classList.remove("active")}}}function g(t){if(!t){t=A}var o=_.indexOf(t);if(-1<o){m(o)}else{if(!0!==S&&_.length>=S){m(0)}c(t)}f()}function h(t){E();if(!t){t=A}if(t){H.value=t.label;l(t.value)}z=[t.value]}function b(t){if(!t){E()}var o=[];_.forEach(function(t){o.push(t.value)});z=o;l(o)}function f(){var t=[];_.forEach(function(o){t.push(o.label)});H.value=t.join(", ");if(!1===M.currentCell){b(!0)}}function y(){for(var t=_.length,o=0;o<t;o++){m(0)}}function w(){E();a()}function v(){_=[];if(!k.parentNode){if(!0===n.values){s(r(),z)}else if("string"==typeof n.values){s(r(n.values),z)}else{s(n.values||[],z)}var t=u.prototype.helpers.elOffset(L);k.style.minWidth=L.offsetWidth+"px";k.style.top=t.top+L.offsetHeight+"px";k.style.left=t.left+"px";k.addEventListener("mousedown",function(){B=!1;setTimeout(function(){B=!0},10)});document.body.appendChild(k)}}function E(){if(k.parentNode){k.parentNode.removeChild(k)}C()}function C(){M.table.rowManager.element.removeEventListener("scroll",w)}function x(){clearTimeout(V);var t=String.fromCharCode(event.keyCode).toLowerCase();N+=t.toLowerCase();var o=P.find(function(t){return"undefined"!=typeof t.label&&t.label.toLowerCase().startsWith(N)});if(o){p(o,!S)}V=setTimeout(function(){N=""},800)}H.setAttribute("type","text");H.style.padding="4px";H.style.width="100%";H.style.boxSizing="border-box";H.style.cursor="default";H.readOnly=!1!=this.currentCell;if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var W in n.elementAttributes){if("+"==W.charAt(0)){W=W.slice(1);H.setAttribute(W,H.getAttribute(W)+n.elementAttributes["+"+W])}else{H.setAttribute(W,n.elementAttributes[W])}}}H.value="undefined"!=typeof D||null===D?D:"";H.addEventListener("search",function(){if(!H.value){y();b()}});H.addEventListener("keydown",function(t){var o;switch(t.keyCode){case 38:o=P.indexOf(A);if("editor"==T||"hybrid"==T&&o){t.stopImmediatePropagation();t.stopPropagation();t.preventDefault();if(0<o){p(P[o-1],!S)}}break;case 40:o=P.indexOf(A);if("editor"==T||"hybrid"==T&&o<P.length-1){t.stopImmediatePropagation();t.stopPropagation();t.preventDefault();if(o<P.length-1){if(-1==o){p(P[0],!S)}else{p(P[o+1],!S)}}}break;case 37:case 39:t.stopImmediatePropagation();t.stopPropagation();t.preventDefault();break;case 13:if(S){g()}else{h()}break;case 27:w();break;case 9:break;default:if(!1===M.currentCell){t.preventDefault()}if(38<=t.keyCode&&90>=t.keyCode){x(t.keyCode)}}});H.addEventListener("blur",function(){if(B){if(S){b()}else{w()}}});H.addEventListener("focus",function(){if(!I){v()}});k=document.createElement("div");k.classList.add("tabulator-edit-select-list");o(function(){H.style.height="100%";H.focus({preventScroll:!0})});setTimeout(function(){R.table.rowManager.element.addEventListener("scroll",w)},10);return H},autocomplete:function(t,o,l,a,n){var C=this,x=this,R=t.getElement(),M=t.getValue(),L=n.verticalNavigation||"editor",D="undefined"!=typeof M||null===M?M:"undefined"!=typeof n.defaultValue?n.defaultValue:"",T=document.createElement("input"),z=document.createElement("div"),H=[],k=!1,S=!0,P=!1;T.setAttribute("type","search");T.style.padding="4px";T.style.width="100%";T.style.boxSizing="border-box";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var A in n.elementAttributes){if("+"==A.charAt(0)){A=A.slice(1);T.setAttribute(A,T.getAttribute(A)+n.elementAttributes["+"+A])}else{T.setAttribute(A,n.elementAttributes[A])}}}z.classList.add("tabulator-edit-select-list");z.addEventListener("mousedown",function(){S=!1;setTimeout(function(){S=!0},10)});function r(){if(!0===n.values){P=s()}else if("string"==typeof n.values){P=s(n.values)}}function s(o){var l={},a=x.table.getData(),r;if(o){r=x.table.columnManager.getColumnByField(o)}else{r=t.getColumn()._getSelf()}if(r){a.forEach(function(t){var o=r.getFieldValue(t);if(null!==o&&"undefined"!=typeof o&&""!==o){l[o]=!0}});if(n.sortValuesList){if("asc"==n.sortValuesList){l=Object.keys(l).sort()}else{l=Object.keys(l).sort().reverse()}}else{l=Object.keys(l)}}else{console.warn("unable to find matching column to create autocomplete lookup list:",o)}return l}function d(t,o){var l=[],a,r;if(P){a=P}else{a=n.values||[]}if(n.searchFunc){l=n.searchFunc(t,a);if(l instanceof Promise){p("undefined"!=typeof n.searchingPlaceholder?n.searchingPlaceholder:"Searching...");l.then(function(t){g(c(t),o)}).catch(function(t){console.err("error in autocomplete search promise:",t)})}else{g(c(l),o)}}else{r=c(a);if(""===t){if(n.showListOnEmpty){l=r}}else{r.forEach(function(o){if(null!==o.value||"undefined"!=typeof o.value){if(-1<(o.value+"").toLowerCase().indexOf((t+"").toLowerCase())||-1<(o.title+"").toLowerCase().indexOf((t+"").toLowerCase())){l.push(o)}}})}g(l,o)}}function p(t){var o=document.createElement("div");m();if(!1!==t){o.classList.add("tabulator-edit-select-list-notice");o.tabIndex=0;if(t instanceof Node){o.appendChild(t)}else{o.innerHTML=t}z.appendChild(o)}}function c(t){var o=[];if(Array.isArray(t)){t.forEach(function(t){var l={};if("object"===("undefined"==typeof t?"undefined":_typeof(t))){l.title=n.listItemFormatter?n.listItemFormatter(t.value,t.label):t.label;l.value=t.value}else{l.title=n.listItemFormatter?n.listItemFormatter(t,t):t;l.value=t}o.push(l)})}else{for(var l in t){var a={title:n.listItemFormatter?n.listItemFormatter(l,t[l]):t[l],value:l};o.push(a)}}return o}function m(){while(z.firstChild){z.removeChild(z.firstChild)}}function g(t,o){if(t.length){h(t,o)}else{if(n.emptyPlaceholder){p(n.emptyPlaceholder)}}}function h(t,o){var l=!1;m();H=t;H.forEach(function(t){var a=t.element;if(!a){a=document.createElement("div");a.classList.add("tabulator-edit-select-list-item");a.tabIndex=0;a.innerHTML=t.title;a.addEventListener("click",function(){y(t);b()});a.addEventListener("mousedown",function(){S=!1;setTimeout(function(){S=!0},10)});t.element=a;if(o&&t.value==M){T.value=t.title;t.element.classList.add("active");l=!0}if(t===k){t.element.classList.add("active");l=!0}}z.appendChild(a)});if(!l){y(!1)}}function b(){w();if(k){if(M!==k.value){M=k.value;T.value=k.title;l(k.value)}else{a()}}else{if(n.freetext){M=T.value;l(T.value)}else{if(n.allowEmpty&&""===T.value){M=T.value;l(T.value)}else{a()}}}}function f(){if(!z.parentNode){console.log("show",D);while(z.firstChild){z.removeChild(z.firstChild)}var t=u.prototype.helpers.elOffset(R);z.style.minWidth=R.offsetWidth+"px";z.style.top=t.top+R.offsetHeight+"px";z.style.left=t.left+"px";document.body.appendChild(z)}}function y(t){if(k&&k.element){k.element.classList.remove("active")}k=t;if(t&&t.element){t.element.classList.add("active")}if(t&&t.element&&t.element.scrollIntoView){t.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}}function w(){if(z.parentNode){z.parentNode.removeChild(z)}E()}function v(){w();a()}function E(){x.table.rowManager.element.removeEventListener("scroll",v)}T.addEventListener("keydown",function(t){var o;switch(t.keyCode){case 38:o=H.indexOf(k);if("editor"==L||"hybrid"==L&&o){t.stopImmediatePropagation();t.stopPropagation();t.preventDefault();if(0<o){y(H[o-1])}else{y(!1)}}break;case 40:o=H.indexOf(k);if("editor"==L||"hybrid"==L&&o<H.length-1){t.stopImmediatePropagation();t.stopPropagation();t.preventDefault();if(o<H.length-1){if(-1==o){y(H[0])}else{y(H[o+1])}}}break;case 37:case 39:t.stopImmediatePropagation();t.stopPropagation();break;case 13:b();break;case 27:v();break;case 36:case 35:t.stopImmediatePropagation();break;}});T.addEventListener("keyup",function(t){switch(t.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:d(T.value);}});T.addEventListener("search",function(){d(T.value)});T.addEventListener("blur",function(){if(S){b()}});T.addEventListener("focus",function(){var t=D;r();f();T.value=t;d(t,!0)});o(function(){T.style.height="100%";T.focus({preventScroll:!0})});if(n.mask){this.table.modules.edit.maskInput(T,n)}setTimeout(function(){C.table.rowManager.element.addEventListener("scroll",v)},10);r();T.value=D;d(D,!0);return T},star:function t(o,l,a,n,r){var c=this,u=o.getElement(),m=o.getValue(),g=u.getElementsByTagName("svg").length||5,h=u.getElementsByTagName("svg")[0]?u.getElementsByTagName("svg")[0].getAttribute("width"):14,b=[],f=document.createElement("div"),t=document.createElementNS("http://www.w3.org/2000/svg","svg");function s(t){b.forEach(function(o,l){if(l<t){if("ie"==c.table.browser){o.setAttribute("class","tabulator-star-active")}else{o.classList.replace("tabulator-star-inactive","tabulator-star-active")}o.innerHTML="<polygon fill=\"#488CE9\" stroke=\"#014AAE\" stroke-width=\"37.6152\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"10\" points=\"259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 \"/>"}else{if("ie"==c.table.browser){o.setAttribute("class","tabulator-star-inactive")}else{o.classList.replace("tabulator-star-active","tabulator-star-inactive")}o.innerHTML="<polygon fill=\"#010155\" stroke=\"#686868\" stroke-width=\"37.6152\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"10\" points=\"259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 \"/>"}})}function d(o){var l=document.createElement("span"),n=t.cloneNode(!0);b.push(n);l.addEventListener("mouseenter",function(t){t.stopPropagation();t.stopImmediatePropagation();s(o)});l.addEventListener("mousemove",function(t){t.stopPropagation();t.stopImmediatePropagation()});l.addEventListener("click",function(t){t.stopPropagation();t.stopImmediatePropagation();a(o);u.blur()});l.appendChild(n);f.appendChild(l)}function p(t){m=t;s(t)}u.style.whiteSpace="nowrap";u.style.overflow="hidden";u.style.textOverflow="ellipsis";f.style.verticalAlign="middle";f.style.display="inline-block";f.style.padding="4px";t.setAttribute("width",h);t.setAttribute("height",h);t.setAttribute("viewBox","0 0 512 512");t.setAttribute("xml:space","preserve");t.style.padding="0 1px";if(r.elementAttributes&&"object"==_typeof(r.elementAttributes)){for(var y in r.elementAttributes){if("+"==y.charAt(0)){y=y.slice(1);f.setAttribute(y,f.getAttribute(y)+r.elementAttributes["+"+y])}else{f.setAttribute(y,r.elementAttributes[y])}}}for(var w=1;w<=g;w++){d(w)}m=Math.min(parseInt(m),g);s(m);f.addEventListener("mousemove",function(){s(0)});f.addEventListener("click",function(){a(0)});u.addEventListener("blur",function(){n()});u.addEventListener("keydown",function(t){switch(t.keyCode){case 39:p(m+1);break;case 37:p(m-1);break;case 13:a(m);break;case 27:n();break;}});return f},progress:function(t,o,l,a,n){var s=t.getElement(),d="undefined"==typeof n.max?s.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,p="undefined"==typeof n.min?s.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,c=(d-p)/100,u=t.getValue()||0,m=document.createElement("div"),g=document.createElement("div"),h,b;function r(){var t=window.getComputedStyle(s,null),o=c*Math.round(g.offsetWidth/((s.clientWidth-parseInt(t.getPropertyValue("padding-left"))-parseInt(t.getPropertyValue("padding-right")))/100))+p;l(o);s.setAttribute("aria-valuenow",o);s.setAttribute("aria-label",u)}m.style.position="absolute";m.style.right="0";m.style.top="0";m.style.bottom="0";m.style.width="5px";m.classList.add("tabulator-progress-handle");g.style.display="inline-block";g.style.position="relative";g.style.height="100%";g.style.backgroundColor="#488CE9";g.style.maxWidth="100%";g.style.minWidth="0%";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var f in n.elementAttributes){if("+"==f.charAt(0)){f=f.slice(1);g.setAttribute(f,g.getAttribute(f)+n.elementAttributes["+"+f])}else{g.setAttribute(f,n.elementAttributes[f])}}}s.style.padding="4px 4px";u=Math.min(parseFloat(u),d);u=Math.max(parseFloat(u),p);u=Math.round((u-p)/c);g.style.width=u+"%";s.setAttribute("aria-valuemin",p);s.setAttribute("aria-valuemax",d);g.appendChild(m);m.addEventListener("mousedown",function(t){h=t.screenX;b=g.offsetWidth});m.addEventListener("mouseover",function(){m.style.cursor="ew-resize"});s.addEventListener("mousemove",function(t){if(h){g.style.width=b+t.screenX-h+"px"}});s.addEventListener("mouseup",function(t){if(h){t.stopPropagation();t.stopImmediatePropagation();h=!1;b=!1;r()}});s.addEventListener("keydown",function(t){switch(t.keyCode){case 39:t.preventDefault();g.style.width=g.clientWidth+s.clientWidth/100+"px";break;case 37:t.preventDefault();g.style.width=g.clientWidth-s.clientWidth/100+"px";break;case 9:case 13:r();break;case 27:a();break;}});s.addEventListener("blur",function(){a()});return g},tickCross:function(t,o,l,a,n){var s=t.getValue(),d=document.createElement("input"),p=n.tristate,c="undefined"==typeof n.indeterminateValue?null:n.indeterminateValue,u=!1;d.setAttribute("type","checkbox");d.style.marginTop="5px";d.style.boxSizing="border-box";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var m in n.elementAttributes){if("+"==m.charAt(0)){m=m.slice(1);d.setAttribute(m,d.getAttribute(m)+n.elementAttributes["+"+m])}else{d.setAttribute(m,n.elementAttributes[m])}}}d.value=s;if(p&&("undefined"==typeof s||s===c||""===s)){u=!0;d.indeterminate=!0}if("firefox"!=this.table.browser){o(function(){d.focus({preventScroll:!0})})}d.checked=!0===s||"true"===s||"True"===s||1===s;o(function(){d.focus()});function r(t){if(p){if(!t){if(d.checked&&!u){d.checked=!1;d.indeterminate=!0;u=!0;return c}else{u=!1;return d.checked}}else{if(u){return c}else{return d.checked}}}else{return d.checked}}d.addEventListener("change",function(){l(r())});d.addEventListener("blur",function(){l(r(!0))});d.addEventListener("keydown",function(t){if(13==t.keyCode){l(r())}if(27==t.keyCode){a()}});return d}};u.prototype.registerModule("edit",x);var R=function(t,o,l,a){this.type=t;this.columns=o;this.component=l||!1;this.indent=a||0},M=function(t,o,l,a,n){this.value=t;this.component=o||!1;this.width=l;this.height=a;this.depth=n},L=function(t){this.table=t;this.config={};this.cloneTableStyle=!0;this.colVisProp=""};L.prototype.generateExportList=function(t,o,l,a){this.cloneTableStyle=o;this.config=t||{};this.colVisProp=a;var n=!1!==this.config.columnHeaders?this.headersToExportRows(this.generateColumnGroupHeaders()):[],r=this.bodyToExportRows(this.rowLookup(l));return n.concat(r)};L.prototype.genereateTable=function(t,o,l,a){var n=this.generateExportList(t,o,l,a);return this.genereateTableElement(n)};L.prototype.rowLookup=function(t){var o=this,l=[];if("function"==typeof t){t.call(this.table).forEach(function(t){t=o.table.rowManager.findRow(t);if(t){l.push(t)}})}else{switch(t){case!0:case"visible":l=this.table.rowManager.getVisibleRows(!0);break;case"all":l=this.table.rowManager.rows;break;case"selected":l=this.table.modules.selectRow.selectedRows;break;case"active":default:if(this.table.options.pagination){l=this.table.rowManager.getDisplayRows(this.table.rowManager.displayRows.length-2)}else{l=this.table.rowManager.getDisplayRows()}}}return Object.assign([],l)};L.prototype.generateColumnGroupHeaders=function(){var t=this,o=[],l=!1!==this.config.columnGroups?this.table.columnManager.columns:this.table.columnManager.columnsByIndex;l.forEach(function(l){var a=t.processColumnGroup(l);if(a){o.push(a)}});return o};L.prototype.processColumnGroup=function(t){var o=this,l=t.columns,a=0,n=t.definition["title"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))]||t.definition.title,r={title:n,column:t,depth:1};if(l.length){r.subGroups=[];r.width=0;l.forEach(function(t){var l=o.processColumnGroup(t);if(l){r.width+=l.width;r.subGroups.push(l);if(l.depth>a){a=l.depth}}});r.depth+=a;if(!r.width){return!1}}else{if(this.columnVisCheck(t)){r.width=1}else{return!1}}return r};L.prototype.columnVisCheck=function(t){return!1!==t.definition[this.colVisProp]&&(t.visible||!t.visible&&t.definition[this.colVisProp])};L.prototype.headersToExportRows=function(t){var l=[],a=0,n=[];function o(t,n){var r=a-n;if("undefined"==typeof l[n]){l[n]=[]}t.height=t.subGroups?1:r-t.depth+1;l[n].push(t);if(1<t.height){for(var s=1;s<t.height;s++){if("undefined"==typeof l[n+s]){l[n+s]=[]}l[n+s].push(!1)}}if(1<t.width){for(var d=1;d<t.width;d++){l[n].push(!1)}}if(t.subGroups){t.subGroups.forEach(function(t){o(t,n+1)})}}t.forEach(function(t){if(t.depth>a){a=t.depth}});t.forEach(function(t){o(t,0)});l.forEach(function(t){var o=[];t.forEach(function(t){if(t){o.push(new M(t.title,t.column.getComponent(),t.width,t.height,t.depth))}else{o.push(null)}});n.push(new R("header",o))});return n};L.prototype.bodyToExportRows=function(t){var o=this,l=[],a=[];this.table.columnManager.columnsByIndex.forEach(function(t){if(o.columnVisCheck(t)){l.push(t.getComponent())}});if(!1!==this.config.columnCalcs&&this.table.modExists("columnCalcs")){if(this.table.modules.columnCalcs.topInitialized){t.unshift(this.table.modules.columnCalcs.topRow)}if(this.table.modules.columnCalcs.botInitialized){t.push(this.table.modules.columnCalcs.botRow)}}t=t.filter(function(t){switch(t.type){case"group":return!1!==o.config.rowGroups;break;case"calc":return!1!==o.config.columnCalcs;break;case"row":return!(o.table.options.dataTree&&!1===o.config.dataTree&&t.modules.dataTree.parent);break;}return!0});t.forEach(function(t){var n=t.getData(o.colVisProp),r=[],s=0;switch(t.type){case"group":s=t.level;r.push(new M(t.key,t.getComponent(),l.length,1));break;case"calc":case"row":l.forEach(function(t){r.push(new M(t._column.getFieldValue(n),t,1,1))});if(o.table.options.dataTree&&!1!==o.config.dataTree){s=t.modules.dataTree.index}break;}a.push(new R(t.type,r,t.getComponent(),s))});return a};L.prototype.genereateTableElement=function(t){var o=this,l=document.createElement("table"),a=document.createElement("thead"),n=document.createElement("tbody"),r=this.lookupTableStyles(),s=this.table.options["rowFormatter"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],d={};d.rowFormatter=null!==s?s:this.table.options.rowFormatter;if(this.table.options.dataTree&&!1!==this.config.dataTree&&this.table.modExists("columnCalcs")){d.treeElementField=this.table.modules.dataTree.elementField}d.groupHeader=this.table.options["groupHeader"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))];if(d.groupHeader&&!Array.isArray(d.groupHeader)){d.groupHeader=[d.groupHeader]}l.classList.add("tabulator-print-table");this.mapElementStyles(this.table.columnManager.getHeadersElement(),a,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]);if(1e3<t.length){console.warn("It may take a long time to render an HTML table with more than 1000 rows")}t.forEach(function(t,l){switch(t.type){case"header":a.appendChild(o.genereateHeaderElement(t,d,r));break;case"group":n.appendChild(o.genereateGroupElement(t,d,r));break;case"calc":n.appendChild(o.genereateCalcElement(t,d,r));break;case"row":var s=o.genereateRowElement(t,d,r);o.mapElementStyles(l%2&&r.evenRow?r.evenRow:r.oddRow,s,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]);n.appendChild(s);break;}});if(a.innerHTML){l.appendChild(a)}l.appendChild(n);this.mapElementStyles(this.table.element,l,["border-top","border-left","border-right","border-bottom"]);return l};L.prototype.lookupTableStyles=function(){var t={};if(this.cloneTableStyle&&window.getComputedStyle){t.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)");t.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)");t.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs");t.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)");t.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0];if(t.firstRow){t.styleCells=t.firstRow.getElementsByClassName("tabulator-cell");t.firstCell=t.styleCells[0];t.lastCell=t.styleCells[t.styleCells.length-1]}}return t};L.prototype.genereateHeaderElement=function(t){var o=this,l=document.createElement("tr");t.columns.forEach(function(t){if(t){var a=document.createElement("th"),n=t.component._column.definition.cssClass?t.component._column.definition.cssClass.split(" "):[];a.colSpan=t.width;a.rowSpan=t.height;a.innerHTML=t.value;if(o.cloneTableStyle){a.style.boxSizing="border-box"}n.forEach(function(t){a.classList.add(t)});o.mapElementStyles(t.component.getElement(),a,["text-align","border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]);o.mapElementStyles(t.component._column.contentElement,a,["padding-top","padding-left","padding-right","padding-bottom"]);if(t.component._column.visible){o.mapElementStyles(t.component.getElement(),a,["width"])}else{if(t.component._column.definition.width){a.style.width=t.component._column.definition.width+"px"}}if(t.component._column.parent){o.mapElementStyles(t.component._column.parent.groupElement,a,["border-top"])}l.appendChild(a)}});return l};L.prototype.genereateGroupElement=function(t,o,l){var a=document.createElement("tr"),n=document.createElement("td"),r=t.columns[0];a.classList.add("tabulator-print-table-row");if(o.groupHeader&&o.groupHeader[t.indent]){r.value=o.groupHeader[t.indent](r.value,t.component._group.getRowCount(),t.component._group.getData(),t.component)}else{if(!1===o.groupHeader){r.value=r.value}else{r.value=t.component._group.generator(r.value,t.component._group.getRowCount(),t.component._group.getData(),t.component)}}n.colSpan=r.width;n.innerHTML=r.value;a.classList.add("tabulator-print-table-group");a.classList.add("tabulator-group-level-"+t.indent);if(r.component.isVisible()){a.classList.add("tabulator-group-visible")}this.mapElementStyles(l.firstGroup,a,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]);this.mapElementStyles(l.firstGroup,n,["padding-top","padding-left","padding-right","padding-bottom"]);a.appendChild(n);return a};L.prototype.genereateCalcElement=function(t,o,l){var a=this.genereateRowElement(t,o,l);a.classList.add("tabulator-print-table-calcs");this.mapElementStyles(l.calcRow,a,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]);return a};L.prototype.genereateRowElement=function(t,o,l){var a=this,n=document.createElement("tr");n.classList.add("tabulator-print-table-row");t.columns.forEach(function(r){if(r){var s=document.createElement("td"),d=r.component._column,p=r.value,c={modules:{},getValue:function(){return p},getField:function(){return d.definition.field},getElement:function(){return s},getColumn:function(){return d.getComponent()},getData:function(){return t.component.getData()},getRow:function(){return t.component},getComponent:function(){return c},column:d},u=d.definition.cssClass?d.definition.cssClass.split(" "):[];u.forEach(function(t){s.classList.add(t)});if(a.table.modExists("format")&&!1!==a.config.formatCells){p=a.table.modules.format.formatExportValue(c,a.colVisProp)}else{switch("undefined"==typeof p?"undefined":_typeof(p)){case"object":p=JSON.stringify(p);break;case"undefined":case"null":p="";break;default:p=p;}}if(p instanceof Node){s.appendChild(p)}else{s.innerHTML=p}if(l.firstCell){a.mapElementStyles(l.firstCell,s,["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size"]);if(d.definition.align){s.style.textAlign=d.definition.align}}if(a.table.options.dataTree&&!1!==a.config.dataTree){if(o.treeElementField&&o.treeElementField==d.field||!o.treeElementField&&0==i){if(t.component._row.modules.dataTree.controlEl){s.insertBefore(t.component._row.modules.dataTree.controlEl.cloneNode(!0),s.firstChild)}if(t.component._row.modules.dataTree.branchEl){s.insertBefore(t.component._row.modules.dataTree.branchEl.cloneNode(!0),s.firstChild)}}}n.appendChild(s);if(c.modules.format&&c.modules.format.renderedCallback){c.modules.format.renderedCallback()}if(o.rowFormatter&&!1!==a.config.formatCells){o.rowFormatter(t.component)}}});return n};L.prototype.genereateHTMLTable=function(t){var o=document.createElement("div");o.appendChild(this.genereateTableElement(t));return o.innerHTML};L.prototype.getHtml=function(t,o,l,a){var n=this.generateExportList(l||this.table.options.htmlOutputConfig,o,t,a||"htmlOutput");return this.genereateHTMLTable(n)};L.prototype.mapElementStyles=function(t,o,l){if(this.cloneTableStyle&&t&&o){var a={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var n=window.getComputedStyle(t);l.forEach(function(t){o.style[a[t]]=n.getPropertyValue(t)})}}};u.prototype.registerModule("export",L);var D=function(t){this.table=t;this.filterList=[];this.headerFilters={};this.headerFilterColumns=[];this.prevHeaderFilterChangeCheck="";this.prevHeaderFilterChangeCheck="{}";this.changed=!1};D.prototype.initializeColumn=function(t){var o=this,l=t.getField(),a;t.modules.filter={success:function(n){var r="input"==t.modules.filter.tagType&&"text"==t.modules.filter.attrType||"textarea"==t.modules.filter.tagType?"partial":"match",s="",d="",p;if("undefined"==typeof t.modules.filter.prevSuccess||t.modules.filter.prevSuccess!==n){t.modules.filter.prevSuccess=n;if(!t.modules.filter.emptyFunc(n)){t.modules.filter.value=n;switch(_typeof(t.definition.headerFilterFunc)){case"string":if(o.filters[t.definition.headerFilterFunc]){s=t.definition.headerFilterFunc;p=function(l){var a=t.definition.headerFilterFuncParams||{},r=t.getFieldValue(l);a="function"==typeof a?a(n,r,l):a;return o.filters[t.definition.headerFilterFunc](n,r,l,a)}}else{console.warn("Header Filter Error - Matching filter function not found: ",t.definition.headerFilterFunc)}break;case"function":p=function(o){var l=t.definition.headerFilterFuncParams||{},a=t.getFieldValue(o);l="function"==typeof l?l(n,a,o):l;return t.definition.headerFilterFunc(n,a,o,l)};s=p;break;}if(!p){switch(r){case"partial":p=function(o){var l=t.getFieldValue(o);if("undefined"!=typeof l&&null!==l){return-1<(l+"").toLowerCase().indexOf((n+"").toLowerCase())}else{return!1}};s="like";break;default:p=function(o){return t.getFieldValue(o)==n};s="=";}}o.headerFilters[l]={value:n,func:p,type:s,params:a||{}}}else{delete o.headerFilters[l]}d=JSON.stringify(o.headerFilters);if(o.prevHeaderFilterChangeCheck!==d){o.prevHeaderFilterChangeCheck=d;o.changed=!0;o.table.rowManager.filterRefresh()}}return!0},attrType:!1,tagType:!1,emptyFunc:!1};this.generateHeaderFilterElement(t)};D.prototype.generateHeaderFilterElement=function(t,o,l){var n=this,r=this,s=t.modules.filter.success,d=t.getField(),p,c,u,m,g,h,b;function a(){}if(t.modules.filter.headerElement&&t.modules.filter.headerElement.parentNode){t.contentElement.removeChild(t.modules.filter.headerElement.parentNode)}if(d){t.modules.filter.emptyFunc=t.definition.headerFilterEmptyCheck||function(t){return!t&&"0"!==t&&0!==t};p=document.createElement("div");p.classList.add("tabulator-header-filter");switch(_typeof(t.definition.headerFilter)){case"string":if(r.table.modules.edit.editors[t.definition.headerFilter]){c=r.table.modules.edit.editors[t.definition.headerFilter];if(("tick"===t.definition.headerFilter||"tickCross"===t.definition.headerFilter)&&!t.definition.headerFilterEmptyCheck){t.modules.filter.emptyFunc=function(t){return!0!==t&&!1!==t}}}else{console.warn("Filter Error - Cannot build header filter, No such editor found: ",t.definition.editor)}break;case"function":c=t.definition.headerFilter;break;case"boolean":if(t.modules.edit&&t.modules.edit.editor){c=t.modules.edit.editor}else{if(t.definition.formatter&&r.table.modules.edit.editors[t.definition.formatter]){c=r.table.modules.edit.editors[t.definition.formatter];if(("tick"===t.definition.formatter||"tickCross"===t.definition.formatter)&&!t.definition.headerFilterEmptyCheck){t.modules.filter.emptyFunc=function(t){return!0!==t&&!1!==t}}}else{c=r.table.modules.edit.editors.input}}break;}if(c){m={getValue:function(){return"undefined"!=typeof o?o:""},getField:function(){return t.definition.field},getElement:function(){return p},getColumn:function(){return t.getComponent()},getRow:function(){return{normalizeHeight:function(){}}}};b=t.definition.headerFilterParams||{};b="function"==typeof b?b.call(r.table):b;u=c.call(this.table.modules.edit,m,function(){},s,a,b);if(!u){console.warn("Filter Error - Cannot add filter to "+d+" column, editor returned a value of false");return}if(!(u instanceof Node)){console.warn("Filter Error - Cannot add filter to "+d+" column, editor should return an instance of Node, the editor returned:",u);return}if(d){r.table.modules.localize.bind("headerFilters|columns|"+t.definition.field,function(t){u.setAttribute("placeholder","undefined"!=typeof t&&t?t:r.table.modules.localize.getText("headerFilters|default"))})}else{r.table.modules.localize.bind("headerFilters|default",function(t){u.setAttribute("placeholder","undefined"!=typeof r.column.definition.headerFilterPlaceholder&&r.column.definition.headerFilterPlaceholder?r.column.definition.headerFilterPlaceholder:t)})}u.addEventListener("click",function(t){t.stopPropagation();u.focus()});u.addEventListener("focus",function(){var t=n.table.columnManager.element.scrollLeft;if(t!==n.table.rowManager.element.scrollLeft){n.table.rowManager.scrollHorizontal(t);n.table.columnManager.scrollHorizontal(t)}});g=!1;h=function(){if(g){clearTimeout(g)}g=setTimeout(function(){s(u.value)},r.table.options.headerFilterLiveFilterDelay)};t.modules.filter.headerElement=u;t.modules.filter.attrType=u.hasAttribute("type")?u.getAttribute("type").toLowerCase():"";t.modules.filter.tagType=u.tagName.toLowerCase();if(!1!==t.definition.headerFilterLiveFilter){if(!("autocomplete"===t.definition.headerFilter||"tickCross"===t.definition.headerFilter||("autocomplete"===t.definition.editor||"tickCross"===t.definition.editor)&&!0===t.definition.headerFilter)){u.addEventListener("keyup",h);u.addEventListener("search",h);if("number"==t.modules.filter.attrType){u.addEventListener("change",function(){s(u.value)})}if("text"==t.modules.filter.attrType&&"ie"!==this.table.browser){u.setAttribute("type","search")}}if("input"==t.modules.filter.tagType||"select"==t.modules.filter.tagType||"textarea"==t.modules.filter.tagType){u.addEventListener("mousedown",function(t){t.stopPropagation()})}}p.appendChild(u);t.contentElement.appendChild(p);if(!l){r.headerFilterColumns.push(t)}}}else{console.warn("Filter Error - Cannot add header filter, column has no field set:",t.definition.title)}};D.prototype.hideHeaderFilterElements=function(){this.headerFilterColumns.forEach(function(t){if(t.modules.filter&&t.modules.filter.headerElement){t.modules.filter.headerElement.style.display="none"}})};D.prototype.showHeaderFilterElements=function(){this.headerFilterColumns.forEach(function(t){if(t.modules.filter&&t.modules.filter.headerElement){t.modules.filter.headerElement.style.display=""}})};D.prototype.setHeaderFilterFocus=function(t){if(t.modules.filter&&t.modules.filter.headerElement){t.modules.filter.headerElement.focus()}else{console.warn("Column Filter Focus Error - No header filter set on column:",t.getField())}};D.prototype.getHeaderFilterValue=function(t){if(t.modules.filter&&t.modules.filter.headerElement){return t.modules.filter.headerElement.value}else{console.warn("Column Filter Error - No header filter set on column:",t.getField())}};D.prototype.setHeaderFilterValue=function(t,o){if(t){if(t.modules.filter&&t.modules.filter.headerElement){this.generateHeaderFilterElement(t,o,!0);t.modules.filter.success(o)}else{console.warn("Column Filter Error - No header filter set on column:",t.getField())}}};D.prototype.reloadHeaderFilter=function(t){if(t){if(t.modules.filter&&t.modules.filter.headerElement){this.generateHeaderFilterElement(t,t.modules.filter.value,!0)}else{console.warn("Column Filter Error - No header filter set on column:",t.getField())}}};D.prototype.hasChanged=function(){var t=this.changed;this.changed=!1;return t};D.prototype.setFilter=function(t,o,l,a){var n=this;n.filterList=[];if(!Array.isArray(t)){t=[{field:t,type:o,value:l,params:a}]}n.addFilter(t)};D.prototype.addFilter=function(t,o,l,a){var n=this;if(!Array.isArray(t)){t=[{field:t,type:o,value:l,params:a}]}t.forEach(function(t){t=n.findFilter(t);if(t){n.filterList.push(t);n.changed=!0}});if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.filter){this.table.modules.persistence.save("filter")}};D.prototype.findFilter=function(t){var o=this,l;if(Array.isArray(t)){return this.findSubFilters(t)}var a=!1;if("function"==typeof t.field){a=function(o){return t.field(o,t.type||{})}}else{if(o.filters[t.type]){l=o.table.columnManager.getColumnByField(t.field);if(l){a=function(a){return o.filters[t.type](t.value,l.getFieldValue(a),a,t.params||{})}}else{a=function(l){return o.filters[t.type](t.value,l[t.field],l,t.params||{})}}}else{console.warn("Filter Error - No such filter type found, ignoring: ",t.type)}}t.func=a;return t.func?t:!1};D.prototype.findSubFilters=function(t){var o=this,l=[];t.forEach(function(t){t=o.findFilter(t);if(t){l.push(t)}});return l.length?l:!1};D.prototype.getFilters=function(t,o){var l=[];if(t){l=this.getHeaderFilters()}if(o){l.forEach(function(t){if("function"==typeof t.type){t.type="function"}})}l=l.concat(this.filtersToArray(this.filterList,o));return l};D.prototype.filtersToArray=function(t,o){var l=this,a=[];t.forEach(function(t){var n;if(Array.isArray(t)){a.push(l.filtersToArray(t,o))}else{n={field:t.field,type:t.type,value:t.value};if(o){if("function"==typeof n.type){n.type="function"}}a.push(n)}});return a};D.prototype.getHeaderFilters=function(){var t=this,o=[];for(var l in this.headerFilters){o.push({field:l,type:this.headerFilters[l].type,value:this.headerFilters[l].value})}return o};D.prototype.removeFilter=function(t,o,l){var a=this;if(!Array.isArray(t)){t=[{field:t,type:o,value:l}]}t.forEach(function(t){var o=-1;if("object"==_typeof(t.field)){o=a.filterList.findIndex(function(o){return t===o})}else{o=a.filterList.findIndex(function(o){return t.field===o.field&&t.type===o.type&&t.value===o.value})}if(-1<o){a.filterList.splice(o,1);a.changed=!0}else{console.warn("Filter Error - No matching filter type found, ignoring: ",t.type)}});if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.filter){this.table.modules.persistence.save("filter")}};D.prototype.clearFilter=function(t){this.filterList=[];if(t){this.clearHeaderFilter()}this.changed=!0;if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.filter){this.table.modules.persistence.save("filter")}};D.prototype.clearHeaderFilter=function(){var t=this;this.headerFilters={};t.prevHeaderFilterChangeCheck="{}";this.headerFilterColumns.forEach(function(o){if("undefined"!=typeof o.modules.filter.value){delete o.modules.filter.value}o.modules.filter.prevSuccess=void 0;t.reloadHeaderFilter(o)});this.changed=!0};D.prototype.search=function(t,o,l,a){var n=this,r=[],s=[];if(!Array.isArray(o)){o=[{field:o,type:l,value:a}]}o.forEach(function(t){t=n.findFilter(t);if(t){s.push(t)}});this.table.rowManager.rows.forEach(function(o){var l=!0;s.forEach(function(t){if(!n.filterRecurse(t,o.getData())){l=!1}});if(l){r.push("data"===t?o.getData("data"):o.getComponent())}});return r};D.prototype.filter=function(t){var o=this,l=[],a=[];if(o.table.options.dataFiltering){o.table.options.dataFiltering.call(o.table,o.getFilters())}if(!o.table.options.ajaxFiltering&&(o.filterList.length||Object.keys(o.headerFilters).length)){t.forEach(function(t){if(o.filterRow(t)){l.push(t)}})}else{l=t.slice(0)}if(o.table.options.dataFiltered){l.forEach(function(t){a.push(t.getComponent())});o.table.options.dataFiltered.call(o.table,o.getFilters(),a)}return l};D.prototype.filterRow=function(t){var o=this,l=!0,a=t.getData();o.filterList.forEach(function(t){if(!o.filterRecurse(t,a)){l=!1}});for(var n in o.headerFilters){if(!o.headerFilters[n].func(a)){l=!1}}return l};D.prototype.filterRecurse=function(t,o){var l=this,a=!1;if(Array.isArray(t)){t.forEach(function(t){if(l.filterRecurse(t,o)){a=!0}})}else{a=t.func(o)}return a};D.prototype.filters={"=":function(t,o){return o==t?!0:!1},"<":function(t,o){return o<t?!0:!1},"<=":function(t,o){return o<=t?!0:!1},">":function(t,o){return o>t?!0:!1},">=":function(t,o){return o>=t?!0:!1},"!=":function(t,o){return o!=t?!0:!1},regex:function(t,o){if("string"==typeof t){t=new RegExp(t)}return t.test(o)},like:function(t,o){if(null===t||"undefined"==typeof t){return o===t?!0:!1}else{if("undefined"!=typeof o&&null!==o){return-1<(o+"").toLowerCase().indexOf(t.toLowerCase())}else{return!1}}},keywords:function t(o,l,a,n){var t=o.toLowerCase().split("undefined"==typeof n.separator?" ":n.separator),r=((null===l||"undefined"==typeof l?"":l)+"").toLowerCase(),s=[];t.forEach(function(t){if(r.includes(t)){s.push(!0)}});return n.matchAll?s.length===t.length:!!s.length},starts:function(t,o){if(null===t||"undefined"==typeof t){return o===t?!0:!1}else{if("undefined"!=typeof o&&null!==o){return(o+"").toLowerCase().startsWith(t.toLowerCase())}else{return!1}}},ends:function(t,o){if(null===t||"undefined"==typeof t){return o===t?!0:!1}else{if("undefined"!=typeof o&&null!==o){return(o+"").toLowerCase().endsWith(t.toLowerCase())}else{return!1}}},in:function(t,o){if(Array.isArray(t)){return t.length?-1<t.indexOf(o):!0}else{console.warn("Filter Error - filter value is not an array:",t);return!1}}};u.prototype.registerModule("filter",D);var T=function(t){this.table=t};T.prototype.initializeColumn=function(t){t.modules.format=this.lookupFormatter(t,"");if("undefined"!=typeof t.definition.formatterPrint){t.modules.format.print=this.lookupFormatter(t,"Print")}if("undefined"!=typeof t.definition.formatterClipboard){t.modules.format.clipboard=this.lookupFormatter(t,"Clipboard")}if("undefined"!=typeof t.definition.formatterHtmlOutput){t.modules.format.htmlOutput=this.lookupFormatter(t,"HtmlOutput")}};T.prototype.lookupFormatter=function(t,o){var l={params:t.definition["formatter"+o+"Params"]||{}},a=t.definition["formatter"+o];switch("undefined"==typeof a?"undefined":_typeof(a)){case"string":if("tick"===a){a="tickCross";if("undefined"==typeof l.params.crossElement){l.params.crossElement=!1}console.warn("DEPRECATION WARNING - the tick formatter has been deprecated, please use the tickCross formatter with the crossElement param set to false")}if(this.formatters[a]){l.formatter=this.formatters[a]}else{console.warn("Formatter Error - No such formatter found: ",a);l.formatter=this.formatters.plaintext}break;case"function":l.formatter=a;break;default:l.formatter=this.formatters.plaintext;break;}return l};T.prototype.cellRendered=function(t){if(t.modules.format&&t.modules.format.renderedCallback&&!t.modules.format.rendered){t.modules.format.renderedCallback();t.modules.format.rendered=!0}};T.prototype.formatValue=function(t){var o=t.getComponent(),l="function"==typeof t.column.modules.format.params?t.column.modules.format.params(o):t.column.modules.format.params;return t.column.modules.format.formatter.call(this,o,l,function(o){if(!t.modules.format){t.modules.format={}}t.modules.format.renderedCallback=o;t.modules.format.rendered=!1})};T.prototype.formatExportValue=function(t,o){var l=t.column.modules.format[o],a;if(l){var n=function(o){if(!t.modules.format){t.modules.format={}}t.modules.format.renderedCallback=o;t.modules.format.rendered=!1};a="function"==typeof l.params?l.params(component):l.params;return l.formatter.call(this,t.getComponent(),a,n)}else{return this.formatValue(t)}};T.prototype.sanitizeHTML=function(t){if(t){var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return(t+"").replace(/[&<>"'`=\/]/g,function(t){return o[t]})}else{return t}};T.prototype.emptyToSpace=function(t){return null===t||"undefined"==typeof t||""===t?"&nbsp;":t};T.prototype.getFormatter=function(t){var t;switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":if(this.formatters[t]){t=this.formatters[t]}else{console.warn("Formatter Error - No such formatter found: ",t);t=this.formatters.plaintext}break;case"function":t=t;break;default:t=this.formatters.plaintext;break;}return t};T.prototype.formatters={plaintext:function(t){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))},html:function(t){return t.getValue()},textarea:function(t){t.getElement().style.whiteSpace="pre-wrap";return this.emptyToSpace(this.sanitizeHTML(t.getValue()))},money:function(t,o){var l=parseFloat(t.getValue()),a,n,r,s,d=o.decimal||".",p=o.thousand||",",c=o.symbol||"",u=!!o.symbolAfter,m="undefined"!=typeof o.precision?o.precision:2;if(isNaN(l)){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}a=!1!==m?l.toFixed(m):l;a=(a+"").split(".");n=a[0];r=1<a.length?d+a[1]:"";s=/(\d+)(\d{3})/;while(s.test(n)){n=n.replace(s,"$1"+p+"$2")}return u?n+r+c:c+n+r},link:function(t,o){var l=t.getValue(),a=o.urlPrefix||"",n=o.download,r=l,s=document.createElement("a"),d;if(o.labelField){d=t.getData();r=d[o.labelField]}if(o.label){switch(_typeof(o.label)){case"string":r=o.label;break;case"function":r=o.label(t);break;}}if(r){if(o.urlField){d=t.getData();l=d[o.urlField]}if(o.url){switch(_typeof(o.url)){case"string":l=o.url;break;case"function":l=o.url(t);break;}}s.setAttribute("href",a+l);if(o.target){s.setAttribute("target",o.target)}if(o.download){if("function"==typeof n){n=n(t)}else{n=!0===n?"":n}s.setAttribute("download",n)}s.innerHTML=this.emptyToSpace(this.sanitizeHTML(r));return s}else{return"&nbsp;"}},image:function(t,o){var l=document.createElement("img"),a=t.getValue();if(o.urlPrefix){a=o.urlPrefix+t.getValue()}if(o.urlSuffix){a=a+o.urlSuffix}l.setAttribute("src",a);switch(_typeof(o.height)){case"number":l.style.height=o.height+"px";break;case"string":l.style.height=o.height;break;}switch(_typeof(o.width)){case"number":l.style.width=o.width+"px";break;case"string":l.style.width=o.width;break;}l.addEventListener("load",function(){t.getRow().normalizeHeight()});return l},tickCross:function(t,o){var l=t.getValue(),a=t.getElement(),n=o.allowEmpty,r=o.allowTruthy,s="undefined"!=typeof o.tickElement?o.tickElement:"<svg enable-background=\"new 0 0 24 24\" height=\"14\" width=\"14\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" ><path fill=\"#2DC214\" clip-rule=\"evenodd\" d=\"M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z\" fill-rule=\"evenodd\"/></svg>",d="undefined"!=typeof o.crossElement?o.crossElement:"<svg enable-background=\"new 0 0 24 24\" height=\"14\" width=\"14\"  viewBox=\"0 0 24 24\" xml:space=\"preserve\" ><path fill=\"#CE1515\" d=\"M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z\"/></svg>";if(r&&l||!0===l||"true"===l||"True"===l||1===l||"1"===l){a.setAttribute("aria-checked",!0);return s||""}else{if(n&&("null"===l||""===l||null===l||"undefined"==typeof l)){a.setAttribute("aria-checked","mixed");return""}else{a.setAttribute("aria-checked",!1);return d||""}}},datetime:function(t,o){var l=o.inputFormat||"YYYY-MM-DD hh:mm:ss",a=o.outputFormat||"DD/MM/YYYY hh:mm:ss",n="undefined"!=typeof o.invalidPlaceholder?o.invalidPlaceholder:"",r=t.getValue(),s=moment(r,l);if(s.isValid()){return o.timezone?s.tz(o.timezone).format(a):s.format(a)}else{if(!0===n){return r}else if("function"==typeof n){return n(r)}else{return n}}},datetimediff:function(t,o){var l=o.inputFormat||"YYYY-MM-DD hh:mm:ss",a="undefined"!=typeof o.invalidPlaceholder?o.invalidPlaceholder:"",n="undefined"!=typeof o.suffix?o.suffix:!1,r="undefined"!=typeof o.unit?o.unit:void 0,s="undefined"!=typeof o.humanize?o.humanize:!1,d="undefined"!=typeof o.date?o.date:moment(),p=t.getValue(),c=moment(p,l);if(c.isValid()){if(s){return moment.duration(c.diff(d)).humanize(n)}else{return c.diff(d,r)+(n?" "+n:"")}}else{if(!0===a){return p}else if("function"==typeof a){return a(p)}else{return a}}},lookup:function(t,o){var l=t.getValue();if("undefined"==typeof o[l]){console.warn("Missing display value for "+l);return l}return o[l]},star:function t(o,l){var a=o.getValue(),n=o.getElement(),r=l&&l.stars?l.stars:5,s=document.createElement("span"),t=document.createElementNS("http://www.w3.org/2000/svg","svg");s.style.verticalAlign="middle";t.setAttribute("width","14");t.setAttribute("height","14");t.setAttribute("viewBox","0 0 512 512");t.setAttribute("xml:space","preserve");t.style.padding="0 1px";a=a&&!isNaN(a)?parseInt(a):0;a=Math.max(0,Math.min(a,r));for(var d=1,p;d<=r;d++){p=t.cloneNode(!0);p.innerHTML=d<=a?"<polygon fill=\"#FFEA00\" stroke=\"#C1AB60\" stroke-width=\"37.6152\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"10\" points=\"259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 \"/>":"<polygon fill=\"#D2D2D2\" stroke=\"#686868\" stroke-width=\"37.6152\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"10\" points=\"259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 \"/>";s.appendChild(p)}n.style.whiteSpace="nowrap";n.style.overflow="hidden";n.style.textOverflow="ellipsis";n.setAttribute("aria-label",a);return s},traffic:function(t,o){var l=this.sanitizeHTML(t.getValue())||0,a=document.createElement("span"),n=o&&o.max?o.max:100,r=o&&o.min?o.min:0,s=o&&"undefined"!=typeof o.color?o.color:["red","orange","green"],d="#666666",p,c;if(isNaN(l)||"undefined"==typeof t.getValue()){return}a.classList.add("tabulator-traffic-light");c=parseFloat(l)<=n?parseFloat(l):n;c=parseFloat(c)>=r?parseFloat(c):r;p=(n-r)/100;c=Math.round((c-r)/p);switch("undefined"==typeof s?"undefined":_typeof(s)){case"string":d=s;break;case"function":d=s(l);break;case"object":if(Array.isArray(s)){var u=100/s.length,m=Math.floor(c/u);m=Math.min(m,s.length-1);m=Math.max(m,0);d=s[m];break}}a.style.backgroundColor=d;return a},progress:function(t,o,l){var a=this.sanitizeHTML(t.getValue())||0,n=t.getElement(),r=o&&o.max?o.max:100,s=o&&o.min?o.min:0,p=o&&o.legendAlign?o.legendAlign:"center",c,u,m,g,h;u=parseFloat(a)<=r?parseFloat(a):r;u=parseFloat(u)>=s?parseFloat(u):s;c=(r-s)/100;u=Math.round((u-s)/c);switch(_typeof(o.color)){case"string":m=o.color;break;case"function":m=o.color(a);break;case"object":if(Array.isArray(o.color)){var b=100/o.color.length,f=Math.floor(u/b);f=Math.min(f,o.color.length-1);f=Math.max(f,0);m=o.color[f];break}default:m="#2DC214";}switch(_typeof(o.legend)){case"string":g=o.legend;break;case"function":g=o.legend(a);break;case"boolean":g=a;break;default:g=!1;}switch(_typeof(o.legendColor)){case"string":h=o.legendColor;break;case"function":h=o.legendColor(a);break;case"object":if(Array.isArray(o.legendColor)){var b=100/o.legendColor.length,f=Math.floor(u/b);f=Math.min(f,o.legendColor.length-1);f=Math.max(f,0);h=o.legendColor[f]}break;default:h="#000";}n.style.minWidth="30px";n.style.position="relative";n.setAttribute("aria-label",u);var y=document.createElement("div");y.style.display="inline-block";y.style.position="relative";y.style.width=u+"%";y.style.backgroundColor=m;y.style.height="100%";y.setAttribute("data-max",r);y.setAttribute("data-min",s);if(g){var w=document.createElement("div");w.style.position="absolute";w.style.top="4px";w.style.left=0;w.style.textAlign=p;w.style.width="100%";w.style.color=h;w.innerHTML=g}l(function(){if(!(t instanceof d)){var o=document.createElement("div");o.style.position="absolute";o.style.top="4px";o.style.bottom="4px";o.style.left="4px";o.style.right="4px";n.appendChild(o);n=o}n.appendChild(y);if(g){n.appendChild(w)}});return""},color:function(t){t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue());return""},buttonTick:function(){return"<svg enable-background=\"new 0 0 24 24\" height=\"14\" width=\"14\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" ><path fill=\"#2DC214\" clip-rule=\"evenodd\" d=\"M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z\" fill-rule=\"evenodd\"/></svg>"},buttonCross:function(){return"<svg enable-background=\"new 0 0 24 24\" height=\"14\" width=\"14\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" ><path fill=\"#CE1515\" d=\"M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z\"/></svg>"},rownum:function(t){return this.table.rowManager.activeRows.indexOf(t.getRow()._getSelf())+1},handle:function(t){t.getElement().classList.add("tabulator-row-handle");return"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"},responsiveCollapse:function(t){var l=this,a=document.createElement("div"),n=t.getRow()._row.modules.responsiveLayout;a.classList.add("tabulator-responsive-collapse-toggle");a.innerHTML="<span class='tabulator-responsive-collapse-toggle-open'>+</span><span class='tabulator-responsive-collapse-toggle-close'>-</span>";t.getElement().classList.add("tabulator-row-handle");function o(t){var o=n.element;n.open=t;if(o){if(n.open){a.classList.add("open");o.style.display=""}else{a.classList.remove("open");o.style.display="none"}}}a.addEventListener("click",function(t){t.stopImmediatePropagation();o(!n.open)});o(n.open);return a},rowSelection:function(t,o){var l=this,a=document.createElement("input");a.type="checkbox";if(this.table.modExists("selectRow",!0)){a.addEventListener("click",function(t){t.stopPropagation()});if("function"==typeof t.getRow){var n=t.getRow();if(n instanceof r){a.addEventListener("change",function(){n.toggleSelect()});a.checked=n.isSelected&&n.isSelected();this.table.modules.selectRow.registerRowSelectCheckbox(n,a)}else{a=""}}else{a.addEventListener("change",function(){if(l.table.modules.selectRow.selectedRows.length){l.table.deselectRow()}else{l.table.selectRow(o.rowRange)}});this.table.modules.selectRow.registerHeaderSelectCheckbox(a)}}return a}};u.prototype.registerModule("format",T);var z=function(t){this.table=t;this.leftColumns=[];this.rightColumns=[];this.leftMargin=0;this.rightMargin=0;this.rightPadding=0;this.initializationMode="left";this.active=!1;this.scrollEndTimer=!1};z.prototype.reset=function(){this.initializationMode="left";this.leftColumns=[];this.rightColumns=[];this.leftMargin=0;this.rightMargin=0;this.rightMargin=0;this.active=!1;this.table.columnManager.headersElement.style.marginLeft=0;this.table.columnManager.element.style.paddingRight=0};z.prototype.initializeColumn=function(t){var o={margin:0,edge:!1};if(!t.isGroup){if(this.frozenCheck(t)){o.position=this.initializationMode;if("left"==this.initializationMode){this.leftColumns.push(t)}else{this.rightColumns.unshift(t)}this.active=!0;t.modules.frozen=o}else{this.initializationMode="right"}}};z.prototype.frozenCheck=function(t){if(t.parent.isGroup&&t.definition.frozen){console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups")}if(t.parent.isGroup){return this.frozenCheck(t.parent)}else{return t.definition.frozen}return!1};z.prototype.scrollHorizontal=function(){var t=this,o;if(this.active){clearTimeout(this.scrollEndTimer);this.scrollEndTimer=setTimeout(function(){t.layout()},100);o=this.table.rowManager.getVisibleRows();this.calcMargins();this.layoutColumnPosition();this.layoutCalcRows();o.forEach(function(o){if("row"===o.type){t.layoutRow(o)}});this.table.rowManager.tableElement.style.marginRight=this.rightMargin}};z.prototype.calcMargins=function(){this.leftMargin=this._calcSpace(this.leftColumns,this.leftColumns.length)+"px";this.table.columnManager.headersElement.style.marginLeft=this.leftMargin;this.rightMargin=this._calcSpace(this.rightColumns,this.rightColumns.length)+"px";this.table.columnManager.element.style.paddingRight=this.rightMargin;this.rightPadding=this.table.rowManager.element.clientWidth+this.table.columnManager.scrollLeft};z.prototype.layoutCalcRows=function(){if(this.table.modExists("columnCalcs")){if(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow){this.layoutRow(this.table.modules.columnCalcs.topRow)}if(this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow){this.layoutRow(this.table.modules.columnCalcs.botRow)}}};z.prototype.layoutColumnPosition=function(t){var o=this,l=[];this.leftColumns.forEach(function(a,n){a.modules.frozen.margin=o._calcSpace(o.leftColumns,n)+o.table.columnManager.scrollLeft+"px";if(n==o.leftColumns.length-1){a.modules.frozen.edge=!0}else{a.modules.frozen.edge=!1}if(a.parent.isGroup){var r=o.getColGroupParentElement(a);if(!l.includes(r)){o.layoutElement(r,a);l.push(r)}if(a.modules.frozen.edge){r.classList.add("tabulator-frozen-"+a.modules.frozen.position)}}else{o.layoutElement(a.getElement(),a)}if(t){a.cells.forEach(function(t){o.layoutElement(t.getElement(!0),a)})}});this.rightColumns.forEach(function(l,a){l.modules.frozen.margin=o.rightPadding-o._calcSpace(o.rightColumns,a+1)+"px";if(a==o.rightColumns.length-1){l.modules.frozen.edge=!0}else{l.modules.frozen.edge=!1}if(l.parent.isGroup){o.layoutElement(o.getColGroupParentElement(l),l)}else{o.layoutElement(l.getElement(),l)}if(t){l.cells.forEach(function(t){o.layoutElement(t.getElement(!0),l)})}})};z.prototype.getColGroupParentElement=function(t){return t.parent.isGroup?this.getColGroupParentElement(t.parent):t.getElement()};z.prototype.layout=function(){var t=this;if(t.active){this.calcMargins();t.table.rowManager.getDisplayRows().forEach(function(o){if("row"===o.type){t.layoutRow(o)}});this.layoutCalcRows();this.layoutColumnPosition(!0);this.table.rowManager.tableElement.style.marginRight=this.rightMargin}};z.prototype.layoutRow=function(t){var o=this,l=t.getElement();l.style.paddingLeft=this.leftMargin;this.leftColumns.forEach(function(l){var a=t.getCell(l);if(a){o.layoutElement(a.getElement(!0),l)}});this.rightColumns.forEach(function(l){var a=t.getCell(l);if(a){o.layoutElement(a.getElement(!0),l)}})};z.prototype.layoutElement=function(t,o){if(o.modules.frozen){t.style.position="absolute";t.style.left=o.modules.frozen.margin;t.classList.add("tabulator-frozen");if(o.modules.frozen.edge){t.classList.add("tabulator-frozen-"+o.modules.frozen.position)}}};z.prototype._calcSpace=function(t,o){for(var l=0,a=0;a<o;a++){if(t[a].visible){l+=t[a].getWidth()}}return l};u.prototype.registerModule("frozenColumns",z);var H=function(t){this.table=t;this.topElement=document.createElement("div");this.rows=[];this.displayIndex=0};H.prototype.initialize=function(){this.rows=[];this.topElement.classList.add("tabulator-frozen-rows-holder");this.table.columnManager.getElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling)};H.prototype.setDisplayIndex=function(t){this.displayIndex=t};H.prototype.getDisplayIndex=function(){return this.displayIndex};H.prototype.isFrozen=function(){return!!this.rows.length};H.prototype.getRows=function(t){var o=this,l=t.slice(0);this.rows.forEach(function(t){var o=l.indexOf(t);if(-1<o){l.splice(o,1)}});return l};H.prototype.freezeRow=function(t){if(!t.modules.frozen){t.modules.frozen=!0;this.topElement.appendChild(t.getElement());t.initialize();t.normalizeHeight();this.table.rowManager.adjustTableSize();this.rows.push(t);this.table.rowManager.refreshActiveData("display");this.styleRows()}else{console.warn("Freeze Error - Row is already frozen")}};H.prototype.unfreezeRow=function(t){this.rows.indexOf(t);if(t.modules.frozen){t.modules.frozen=!1;this.detachRow(t);this.table.rowManager.adjustTableSize();this.table.rowManager.refreshActiveData("display");if(this.rows.length){this.styleRows()}}else{console.warn("Freeze Error - Row is already unfrozen")}};H.prototype.detachRow=function(t){var o=this.rows.indexOf(t);if(-1<o){var l=t.getElement();l.parentNode.removeChild(l);this.rows.splice(o,1)}};H.prototype.styleRows=function(){var t=this;this.rows.forEach(function(o,l){t.table.rowManager.styleRow(o,l)})};u.prototype.registerModule("frozenRows",H);var k=function(t){this._group=t;this.type="GroupComponent"};k.prototype.getKey=function(){return this._group.key};k.prototype.getField=function(){return this._group.field};k.prototype.getElement=function(){return this._group.element};k.prototype.getRows=function(){return this._group.getRows(!0)};k.prototype.getSubGroups=function(){return this._group.getSubGroups(!0)};k.prototype.getParentGroup=function(){return this._group.parent?this._group.parent.getComponent():!1};k.prototype.getVisibility=function(){console.warn("getVisibility function is deprecated, you should now use the isVisible function");return this._group.visible};k.prototype.isVisible=function(){return this._group.visible};k.prototype.show=function(){this._group.show()};k.prototype.hide=function(){this._group.hide()};k.prototype.toggle=function(){this._group.toggleVisibility()};k.prototype._getSelf=function(){return this._group};k.prototype.getTable=function(){return this._group.groupManager.table};var S=function(t,o,l,a,n,r,s){this.groupManager=t;this.parent=o;this.key=a;this.level=l;this.field=n;this.hasSubGroups=l<t.groupIDLookups.length-1;this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow;this.type="group";this.old=s;this.rows=[];this.groups=[];this.groupList=[];this.generator=r;this.elementContents=!1;this.height=0;this.outerHeight=0;this.initialized=!1;this.calcs={};this.initialized=!1;this.modules={};this.arrowElement=!1;this.visible=s?s.visible:"undefined"!=typeof t.startOpen[l]?t.startOpen[l]:t.startOpen[0];this.component=null;this.createElements();this.addBindings();this.createValueGroups()};S.prototype.wipe=function(){if(this.groupList.length){this.groupList.forEach(function(t){t.wipe()})}else{this.element=!1;this.arrowElement=!1;this.elementContents=!1}};S.prototype.createElements=function(){var t=document.createElement("div");t.classList.add("tabulator-arrow");this.element=document.createElement("div");this.element.classList.add("tabulator-row");this.element.classList.add("tabulator-group");this.element.classList.add("tabulator-group-level-"+this.level);this.element.setAttribute("role","rowgroup");this.arrowElement=document.createElement("div");this.arrowElement.classList.add("tabulator-group-toggle");this.arrowElement.appendChild(t);if(!1!==this.groupManager.table.options.movableRows&&this.groupManager.table.modExists("moveRow")){this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}};S.prototype.createValueGroups=function(){var t=this,o=this.level+1;if(this.groupManager.allowedValues&&this.groupManager.allowedValues[o]){this.groupManager.allowedValues[o].forEach(function(l){t._createGroup(l,o)})}};S.prototype.addBindings=function(){var t=this,o,l,a,n;if(t.groupManager.table.options.groupClick){t.element.addEventListener("click",function(o){t.groupManager.table.options.groupClick.call(t.groupManager.table,o,t.getComponent())})}if(t.groupManager.table.options.groupDblClick){t.element.addEventListener("dblclick",function(o){t.groupManager.table.options.groupDblClick.call(t.groupManager.table,o,t.getComponent())})}if(t.groupManager.table.options.groupContext){t.element.addEventListener("contextmenu",function(o){t.groupManager.table.options.groupContext.call(t.groupManager.table,o,t.getComponent())})}if((t.groupManager.table.options.groupContextMenu||t.groupManager.table.options.groupClickMenu)&&t.groupManager.table.modExists("menu")){t.groupManager.table.modules.menu.initializeGroup.call(t.groupManager.table.modules.menu,t)}if(t.groupManager.table.options.groupTap){a=!1;t.element.addEventListener("touchstart",function(){a=!0},{passive:!0});t.element.addEventListener("touchend",function(o){if(a){t.groupManager.table.options.groupTap(o,t.getComponent())}a=!1})}if(t.groupManager.table.options.groupDblTap){o=null;t.element.addEventListener("touchend",function(l){if(o){clearTimeout(o);o=null;t.groupManager.table.options.groupDblTap(l,t.getComponent())}else{o=setTimeout(function(){clearTimeout(o);o=null},300)}})}if(t.groupManager.table.options.groupTapHold){l=null;t.element.addEventListener("touchstart",function(o){clearTimeout(l);l=setTimeout(function(){clearTimeout(l);l=null;a=!1;t.groupManager.table.options.groupTapHold(o,t.getComponent())},1e3)},{passive:!0});t.element.addEventListener("touchend",function(){clearTimeout(l);l=null})}if(t.groupManager.table.options.groupToggleElement){n="arrow"==t.groupManager.table.options.groupToggleElement?t.arrowElement:t.element;n.addEventListener("click",function(o){o.stopPropagation();o.stopImmediatePropagation();t.toggleVisibility()})}};S.prototype._createGroup=function(t,o){var l=o+"_"+t,a=new S(this.groupManager,this,o,t,this.groupManager.groupIDLookups[o].field,this.groupManager.headerGenerator[o]||this.groupManager.headerGenerator[0],this.old?this.old.groups[l]:!1);this.groups[l]=a;this.groupList.push(a)};S.prototype._addRowToGroup=function(t){var o=this.level+1;if(this.hasSubGroups){var l=this.groupManager.groupIDLookups[o].func(t.getData()),a=o+"_"+l;if(this.groupManager.allowedValues&&this.groupManager.allowedValues[o]){if(this.groups[a]){this.groups[a].addRow(t)}}else{if(!this.groups[a]){this._createGroup(l,o)}this.groups[a].addRow(t)}}};S.prototype._addRow=function(t){this.rows.push(t);t.modules.group=this};S.prototype.insertRow=function(t,o,l){var a=this.conformRowData({});t.updateData(a);var n=this.rows.indexOf(o);if(-1<n){if(l){this.rows.splice(n+1,0,t)}else{this.rows.splice(n,0,t)}}else{if(l){this.rows.push(t)}else{this.rows.unshift(t)}}t.modules.group=this;this.generateGroupHeaderContents();if(this.groupManager.table.modExists("columnCalcs")&&"table"!=this.groupManager.table.options.columnCalcs){this.groupManager.table.modules.columnCalcs.recalcGroup(this)}this.groupManager.updateGroupRows(!0)};S.prototype.scrollHeader=function(t){this.arrowElement.style.marginLeft=t;this.groupList.forEach(function(o){o.scrollHeader(t)})};S.prototype.getRowIndex=function(){};S.prototype.conformRowData=function(t){if(this.field){t[this.field]=this.key}else{console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function")}if(this.parent){t=this.parent.conformRowData(t)}return t};S.prototype.removeRow=function(t){var o=this.rows.indexOf(t),l=t.getElement();if(-1<o){this.rows.splice(o,1)}if(!this.groupManager.table.options.groupValues&&!this.rows.length){if(this.parent){this.parent.removeGroup(this)}else{this.groupManager.removeGroup(this)}this.groupManager.updateGroupRows(!0)}else{if(l.parentNode){l.parentNode.removeChild(l)}this.generateGroupHeaderContents();if(this.groupManager.table.modExists("columnCalcs")&&"table"!=this.groupManager.table.options.columnCalcs){this.groupManager.table.modules.columnCalcs.recalcGroup(this)}}};S.prototype.removeGroup=function(t){var o=t.level+"_"+t.key,l;if(this.groups[o]){delete this.groups[o];l=this.groupList.indexOf(t);if(-1<l){this.groupList.splice(l,1)}if(!this.groupList.length){if(this.parent){this.parent.removeGroup(this)}else{this.groupManager.removeGroup(this)}}}};S.prototype.getHeadersAndRows=function(t){var o=[this];this._visSet();if(this.visible){if(this.groupList.length){this.groupList.forEach(function(l){o=o.concat(l.getHeadersAndRows(t))})}else{if(!t&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()){if(this.calcs.top){this.calcs.top.detachElement();this.calcs.top.deleteCells()}this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows);o.push(this.calcs.top)}o=o.concat(this.rows);if(!t&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()){if(this.calcs.bottom){this.calcs.bottom.detachElement();this.calcs.bottom.deleteCells()}this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows);o.push(this.calcs.bottom)}}}else{if(!this.groupList.length&&"table"!=this.groupManager.table.options.columnCalcs){if(this.groupManager.table.modExists("columnCalcs")){if(!t&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()){if(this.calcs.top){this.calcs.top.detachElement();this.calcs.top.deleteCells()}if(this.groupManager.table.options.groupClosedShowCalcs){this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows);o.push(this.calcs.top)}}if(!t&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()){if(this.calcs.bottom){this.calcs.bottom.detachElement();this.calcs.bottom.deleteCells()}if(this.groupManager.table.options.groupClosedShowCalcs){this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows);o.push(this.calcs.bottom)}}}}}return o};S.prototype.getData=function(t,o){var l=this,a=[];this._visSet();if(!t||t&&this.visible){this.rows.forEach(function(t){a.push(t.getData(o||"data"))})}return a};S.prototype.getRowCount=function(){var t=0;if(this.groupList.length){this.groupList.forEach(function(o){t+=o.getRowCount()})}else{t=this.rows.length}return t};S.prototype.toggleVisibility=function(){if(this.visible){this.hide()}else{this.show()}};S.prototype.hide=function(){this.visible=!1;if("classic"==this.groupManager.table.rowManager.getRenderMode()&&!this.groupManager.table.options.pagination){this.element.classList.remove("tabulator-group-visible");if(this.groupList.length){this.groupList.forEach(function(t){var o=t.getHeadersAndRows();o.forEach(function(t){t.detachElement()})})}else{this.rows.forEach(function(t){var o=t.getElement();o.parentNode.removeChild(o)})}this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(),this.groupManager.getDisplayIndex());this.groupManager.table.rowManager.checkClassicModeGroupHeaderWidth()}else{this.groupManager.updateGroupRows(!0)}this.groupManager.table.options.groupVisibilityChanged.call(this.table,this.getComponent(),!1)};S.prototype.show=function(){var t=this;t.visible=!0;if("classic"==this.groupManager.table.rowManager.getRenderMode()&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var o=t.getElement();if(this.groupList.length){this.groupList.forEach(function(t){var l=t.getHeadersAndRows();l.forEach(function(t){var l=t.getElement();o.parentNode.insertBefore(l,o.nextSibling);t.initialize();o=l})})}else{t.rows.forEach(function(t){var l=t.getElement();o.parentNode.insertBefore(l,o.nextSibling);t.initialize();o=l})}this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(),this.groupManager.getDisplayIndex());this.groupManager.table.rowManager.checkClassicModeGroupHeaderWidth()}else{this.groupManager.updateGroupRows(!0)}this.groupManager.table.options.groupVisibilityChanged.call(this.table,this.getComponent(),!0)};S.prototype._visSet=function(){var t=[];if("function"==typeof this.visible){this.rows.forEach(function(o){t.push(o.getData())});this.visible=this.visible(this.key,this.getRowCount(),t,this.getComponent())}};S.prototype.getRowGroup=function(t){var o=!1;if(this.groupList.length){this.groupList.forEach(function(l){var a=l.getRowGroup(t);if(a){o=a}})}else{if(this.rows.find(function(o){return o===t})){o=this}}return o};S.prototype.getSubGroups=function(t){var o=[];this.groupList.forEach(function(l){o.push(t?l.getComponent():l)});return o};S.prototype.getRows=function(t){var o=[];this.rows.forEach(function(l){o.push(t?l.getComponent():l)});return o};S.prototype.generateGroupHeaderContents=function(){var t=[];this.rows.forEach(function(o){t.push(o.getData())});this.elementContents=this.generator(this.key,this.getRowCount(),t,this.getComponent());while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}if("string"==typeof this.elementContents){this.element.innerHTML=this.elementContents}else{this.element.appendChild(this.elementContents)}this.element.insertBefore(this.arrowElement,this.element.firstChild)};S.prototype.getPath=function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];t.unshift(this.key);if(this.parent){this.parent.getPath(t)}return t};S.prototype.getElement=function(){this.addBindingsd=!1;this._visSet();if(this.visible){this.element.classList.add("tabulator-group-visible")}else{this.element.classList.remove("tabulator-group-visible")}for(var t=0;t<this.element.childNodes.length;++t){this.element.childNodes[t].parentNode.removeChild(this.element.childNodes[t])}this.generateGroupHeaderContents();return this.element};S.prototype.detachElement=function(){if(this.element&&this.element.parentNode){this.element.parentNode.removeChild(this.element)}};S.prototype.normalizeHeight=function(){this.setHeight(this.element.clientHeight)};S.prototype.initialize=function(t){if(!this.initialized||t){this.normalizeHeight();this.initialized=!0}};S.prototype.reinitialize=function(){this.initialized=!1;this.height=0;if(u.prototype.helpers.elVisible(this.element)){this.initialize(!0)}};S.prototype.setHeight=function(t){if(this.height!=t){this.height=t;this.outerHeight=this.element.offsetHeight}};S.prototype.getHeight=function(){return this.outerHeight};S.prototype.getGroup=function(){return this};S.prototype.reinitializeHeight=function(){};S.prototype.calcHeight=function(){};S.prototype.setCellHeight=function(){};S.prototype.clearCellHeight=function(){};S.prototype.getComponent=function(){if(!this.component){this.component=new k(this)}return this.component};var P=function(t){this.table=t;this.groupIDLookups=!1;this.startOpen=[function(){return!1}];this.headerGenerator=[function(){return""}];this.groupList=[];this.allowedValues=!1;this.groups={};this.displayIndex=0};P.prototype.initialize=function(){var t=this,o=t.table.options.groupBy,l=t.table.options.groupStartOpen,a=t.table.options.groupHeader;this.allowedValues=t.table.options.groupValues;if(Array.isArray(o)&&Array.isArray(a)&&o.length>a.length){console.warn("Error creating group headers, groupHeader array is shorter than groupBy array")}t.headerGenerator=[function(){return""}];this.startOpen=[function(){return!1}];t.table.modules.localize.bind("groups|item",function(o,l){t.headerGenerator[0]=function(t,a){return("undefined"==typeof t?"":t)+"<span>("+a+" "+(1===a?o:l.groups.items)+")</span>"}});this.groupIDLookups=[];if(Array.isArray(o)||o){if(this.table.modExists("columnCalcs")&&"table"!=this.table.options.columnCalcs&&"both"!=this.table.options.columnCalcs){this.table.modules.columnCalcs.removeCalcs()}}else{if(this.table.modExists("columnCalcs")&&"group"!=this.table.options.columnCalcs){var n=this.table.columnManager.getRealColumns();n.forEach(function(o){if(o.definition.topCalc){t.table.modules.columnCalcs.initializeTopRow()}if(o.definition.bottomCalc){t.table.modules.columnCalcs.initializeBottomRow()}})}}if(!Array.isArray(o)){o=[o]}o.forEach(function(o,l){var a,n;if("function"==typeof o){a=o}else{n=t.table.columnManager.getColumnByField(o);if(n){a=function(t){return n.getFieldValue(t)}}else{a=function(t){return t[o]}}}t.groupIDLookups.push({field:"function"==typeof o?!1:o,func:a,values:t.allowedValues?t.allowedValues[l]:!1})});if(l){if(!Array.isArray(l)){l=[l]}l.forEach(function(t){t="function"==typeof t?t:function(){return!0}});t.startOpen=l}if(a){t.headerGenerator=Array.isArray(a)?a:[a]}this.initialized=!0};P.prototype.setDisplayIndex=function(t){this.displayIndex=t};P.prototype.getDisplayIndex=function(){return this.displayIndex};P.prototype.getRows=function(t){if(this.groupIDLookups.length){this.table.options.dataGrouping.call(this.table);this.generateGroups(t);if(this.table.options.dataGrouped){this.table.options.dataGrouped.call(this.table,this.getGroups(!0))}return this.updateGroupRows()}else{return t.slice(0)}};P.prototype.getGroups=function(t){var o=[];this.groupList.forEach(function(l){o.push(t?l.getComponent():l)});return o};P.prototype.getChildGroups=function(t){var o=this,l=[];if(!t){t=this}t.groupList.forEach(function(t){if(t.groupList.length){l=l.concat(o.getChildGroups(t))}else{l.push(t)}});return l};P.prototype.wipe=function(){this.groupList.forEach(function(t){t.wipe()})};P.prototype.pullGroupListData=function(t){var o=this,l=[];t.forEach(function(t){var a={level:0,rowCount:0,headerContent:""},n=[];if(t.hasSubGroups){n=o.pullGroupListData(t.groupList);a.level=t.level;a.rowCount=n.length-t.groupList.length;a.headerContent=t.generator(t.key,a.rowCount,t.rows,t);l.push(a);l=l.concat(n)}else{a.level=t.level;a.headerContent=t.generator(t.key,t.rows.length,t.rows,t);a.rowCount=t.getRows().length;l.push(a);t.getRows().forEach(function(t){l.push(t.getData("data"))})}});return l};P.prototype.getGroupedData=function(){return this.pullGroupListData(this.groupList)};P.prototype.getRowGroup=function(t){var o=!1;this.groupList.forEach(function(l){var a=l.getRowGroup(t);if(a){o=a}});return o};P.prototype.countGroups=function(){return this.groupList.length};P.prototype.generateGroups=function(t){var o=this,l=o.groups;o.groups={};o.groupList=[];if(this.allowedValues&&this.allowedValues[0]){this.allowedValues[0].forEach(function(t){o.createGroup(t,0,l)});t.forEach(function(t){o.assignRowToExistingGroup(t,l)})}else{t.forEach(function(t){o.assignRowToGroup(t,l)})}};P.prototype.createGroup=function(t,o,l){var a=o+"_"+t,n;l=l||[];n=new S(this,!1,o,t,this.groupIDLookups[0].field,this.headerGenerator[0],l[a]);this.groups[a]=n;this.groupList.push(n)};P.prototype.assignRowToExistingGroup=function(t){var o=this.groupIDLookups[0].func(t.getData()),l="0_"+o;if(this.groups[l]){this.groups[l].addRow(t)}};P.prototype.assignRowToGroup=function(t,o){var l=this.groupIDLookups[0].func(t.getData()),a=!this.groups["0_"+l];if(a){this.createGroup(l,0,o)}this.groups["0_"+l].addRow(t);return!a};P.prototype.reassignRowToGroup=function(t){var o=t.getGroup(),l=o.getPath(),a=this.getExpectedPath(t),n=!0,n=l.length==a.length&&l.every(function(t,o){return t===a[o]});if(!n){o.removeRow(t);this.assignRowToGroup(t,self.groups);this.table.rowManager.refreshActiveData("group",!1,!0)}};P.prototype.getExpectedPath=function(t){var o=[],l=t.getData();this.groupIDLookups.forEach(function(t){o.push(t.func(l))});return o};P.prototype.updateGroupRows=function(t){var o=this,l=[];o.groupList.forEach(function(t){l=l.concat(t.getHeadersAndRows())});if(t){var a=o.table.rowManager.setDisplayRows(l,this.getDisplayIndex());if(!0!==a){this.setDisplayIndex(a)}o.table.rowManager.refreshActiveData("group",!0,!0)}return l};P.prototype.scrollHeaders=function(t){if(this.table.options.virtualDomHoz){t-=this.table.vdomHoz.vDomPadLeft}t=t+"px";this.groupList.forEach(function(o){o.scrollHeader(t)})};P.prototype.removeGroup=function(t){var o=t.level+"_"+t.key,l;if(this.groups[o]){delete this.groups[o];l=this.groupList.indexOf(t);if(-1<l){this.groupList.splice(l,1)}}};u.prototype.registerModule("groupRows",P);var A=function(t){this.table=t;this.history=[];this.index=-1};A.prototype.clear=function(){this.history=[];this.index=-1};A.prototype.action=function(t,o,l){this.history=this.history.slice(0,this.index+1);this.history.push({type:t,component:o,data:l});this.index++};A.prototype.getHistoryUndoSize=function(){return this.index+1};A.prototype.getHistoryRedoSize=function(){return this.history.length-(this.index+1)};A.prototype.clearComponentHistory=function(t){var o=this.history.findIndex(function(o){return o.component===t});if(-1<o){this.history.splice(o,1);if(o<=this.index){this.index--}this.clearComponentHistory(t)}};A.prototype.undo=function(){if(-1<this.index){var t=this.history[this.index];this.undoers[t.type].call(this,t);this.index--;this.table.options.historyUndo.call(this.table,t.type,t.component.getComponent(),t.data);return!0}else{console.warn("History Undo Error - No more history to undo");return!1}};A.prototype.redo=function(){if(this.history.length-1>this.index){this.index++;var t=this.history[this.index];this.redoers[t.type].call(this,t);this.table.options.historyRedo.call(this.table,t.type,t.component.getComponent(),t.data);return!0}else{console.warn("History Redo Error - No more history to redo");return!1}};A.prototype.undoers={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue)},rowAdd:function(t){t.component.deleteActual()},rowDelete:function(t){var o=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.updateGroupRows(!0)}this._rebindRow(t.component,o)},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.rows[t.data.posFrom],!t.data.after);this.table.rowManager.redraw()}};A.prototype.redoers={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue)},rowAdd:function(t){var o=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.updateGroupRows(!0)}this._rebindRow(t.component,o)},rowDelete:function(t){t.component.deleteActual()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.rows[t.data.posTo],t.data.after);this.table.rowManager.redraw()}};A.prototype._rebindRow=function(t,o){this.history.forEach(function(l){if(l.component instanceof s){if(l.component===t){l.component=o}}else if(l.component instanceof p){if(l.component.row===t){var a=l.component.column.getField();if(a){l.component=o.getCell(a)}}}})};u.prototype.registerModule("history",A);var F=function(t){this.table=t;this.fieldIndex=[];this.hasIndex=!1};F.prototype.parseTable=function(){var t=this,o=t.table.element,l=t.table.options,a=l.columns,n=o.getElementsByTagName("th"),r=o.getElementsByTagName("tbody")[0],s=[];t.hasIndex=!1;t.table.options.htmlImporting.call(this.table);r=r?r.getElementsByTagName("tr"):[];t._extractOptions(o,l);if(n.length){t._extractHeaders(n,r)}else{t._generateBlankHeaders(n,r)}for(var d=0;d<r.length;d++){var p=r[d],c=p.getElementsByTagName("td"),u={};if(!t.hasIndex){u[l.index]=d}for(var m=0,g;m<c.length;m++){g=c[m];if("undefined"!=typeof this.fieldIndex[m]){u[this.fieldIndex[m]]=g.innerHTML}}s.push(u)}var h=document.createElement("div"),b=o.attributes;for(var m in b){if("object"==_typeof(b[m])){h.setAttribute(b[m].name,b[m].value)}}o.parentNode.replaceChild(h,o);l.data=s;t.table.options.htmlImported.call(this.table);this.table.element=h};F.prototype._extractOptions=function(t,o,l){var a=t.attributes,n=l?Object.assign([],l):Object.keys(o),r={};n.forEach(function(t){r[t.toLowerCase()]=t});for(var s in a){var d=a[s],p;if(d&&"object"==("undefined"==typeof d?"undefined":_typeof(d))&&d.name&&0===d.name.indexOf("tabulator-")){p=d.name.replace("tabulator-","");if("undefined"!=typeof r[p]){o[r[p]]=this._attribValue(d.value)}}}};F.prototype._attribValue=function(t){if("true"===t){return!0}if("false"===t){return!1}return t};F.prototype._findCol=function(t){var o=this.table.options.columns.find(function(o){return o.title===t});return o||!1};F.prototype._extractHeaders=function(t){for(var o=0;o<t.length;o++){var a=t[o],n=!1,r=this._findCol(a.textContent),s;if(r){n=!0}else{r={title:a.textContent.trim()}}if(!r.field){r.field=a.textContent.trim().toLowerCase().replace(" ","_")}s=a.getAttribute("width");if(s&&!r.width){r.width=s}a.attributes;this._extractOptions(a,r,l.prototype.defaultOptionList);this.fieldIndex[o]=r.field;if(r.field==this.table.options.index){this.hasIndex=!0}if(!n){this.table.options.columns.push(r)}}};F.prototype._generateBlankHeaders=function(t){for(var o=0;o<t.length;o++){var l=t[o],a={title:"",field:"col"+o};this.fieldIndex[o]=a.field;var n=l.getAttribute("width");if(n){a.width=n}this.table.options.columns.push(a)}};u.prototype.registerModule("htmlTableImport",F);var _=function(t){this.table=t;this.watchKeys=null;this.pressedKeys=null;this.keyupBinding=!1;this.keydownBinding=!1};_.prototype.initialize=function(){var t=this.table.options.keybindings,o={};this.watchKeys={};this.pressedKeys=[];if(!1!==t){for(var l in this.bindings){o[l]=this.bindings[l]}if(Object.keys(t).length){for(var a in t){o[a]=t[a]}}this.mapBindings(o);this.bindEvents()}};_.prototype.mapBindings=function(t){var o=this,l=this,a=function(a){if(o.actions[a]){if(t[a]){if("object"!==_typeof(t[a])){t[a]=[t[a]]}t[a].forEach(function(t){l.mapBinding(a,t)})}}else{console.warn("Key Binding Error - no such action:",a)}};for(var n in t){a(n)}};_.prototype.mapBinding=function(t,o){var l=this,a={action:this.actions[t],keys:[],ctrl:!1,shift:!1,meta:!1},n=o.toString().toLowerCase().split(" ").join("").split("+");n.forEach(function(t){switch(t){case"ctrl":a.ctrl=!0;break;case"shift":a.shift=!0;break;case"meta":a.meta=!0;break;default:t=parseInt(t);a.keys.push(t);if(!l.watchKeys[t]){l.watchKeys[t]=[]}l.watchKeys[t].push(a);}})};_.prototype.bindEvents=function(){var t=this;this.keyupBinding=function(o){var l=o.keyCode,a=t.watchKeys[l];if(a){t.pressedKeys.push(l);a.forEach(function(l){t.checkBinding(o,l)})}};this.keydownBinding=function(o){var l=o.keyCode,a=t.watchKeys[l];if(a){var n=t.pressedKeys.indexOf(l);if(-1<n){t.pressedKeys.splice(n,1)}}};this.table.element.addEventListener("keydown",this.keyupBinding);this.table.element.addEventListener("keyup",this.keydownBinding)};_.prototype.clearBindings=function(){if(this.keyupBinding){this.table.element.removeEventListener("keydown",this.keyupBinding)}if(this.keydownBinding){this.table.element.removeEventListener("keyup",this.keydownBinding)}};_.prototype.checkBinding=function(t,o){var l=this,a=!0;if(t.ctrlKey==o.ctrl&&t.shiftKey==o.shift&&t.metaKey==o.meta){o.keys.forEach(function(t){var o=l.pressedKeys.indexOf(t);if(-1==o){a=!1}});if(a){o.action.call(l,t)}return!0}return!1};_.prototype.bindings={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35,undo:"ctrl + 90",redo:"ctrl + 89",copyToClipboard:"ctrl + 67"};_.prototype.actions={keyBlock:function(t){t.stopPropagation();t.preventDefault()},scrollPageUp:function(t){var o=this.table.rowManager,l=o.scrollTop-o.height,a=o.element.scrollHeight;t.preventDefault();if(o.displayRowsCount){if(0<=l){o.element.scrollTop=l}else{o.scrollToRow(o.getDisplayRows()[0])}}this.table.element.focus()},scrollPageDown:function(t){var o=this.table.rowManager,l=o.scrollTop+o.height,a=o.element.scrollHeight;t.preventDefault();if(o.displayRowsCount){if(l<=a){o.element.scrollTop=l}else{o.scrollToRow(o.getDisplayRows()[o.displayRowsCount-1])}}this.table.element.focus()},scrollToStart:function(t){var o=this.table.rowManager;t.preventDefault();if(o.displayRowsCount){o.scrollToRow(o.getDisplayRows()[0])}this.table.element.focus()},scrollToEnd:function(t){var o=this.table.rowManager;t.preventDefault();if(o.displayRowsCount){o.scrollToRow(o.getDisplayRows()[o.displayRowsCount-1])}this.table.element.focus()},navPrev:function(t){var o=!1;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();o.nav().prev()}}},navNext:function(t){var o=!1,l=this.table.options.tabEndNewRow,a;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();a=o.nav();if(!a.next()){if(l){o.getElement().firstChild.blur();if(!0===l){l=this.table.addRow({})}else{if("function"==typeof l){l=this.table.addRow(l(o.row.getComponent()))}else{l=this.table.addRow(Object.assign({},l))}}l.then(function(){setTimeout(function(){a.next()})})}}}}},navLeft:function(t){var o=!1;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();o.nav().left()}}},navRight:function(t){var o=!1;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();o.nav().right()}}},navUp:function(t){var o=!1;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();o.nav().up()}}},navDown:function(t){var o=!1;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();o.nav().down()}}},undo:function(t){var o=!1;if(this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(!o){t.preventDefault();this.table.modules.history.undo()}}},redo:function(t){var o=!1;if(this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(!o){t.preventDefault();this.table.modules.history.redo()}}},copyToClipboard:function(){if(!this.table.modules.edit.currentCell){if(this.table.modExists("clipboard",!0)){this.table.modules.clipboard.copy(!1,!0)}}}};u.prototype.registerModule("keybindings",_);var B=function(t){this.table=t;this.menuElements=[];this.blurEvent=this.hideMenu.bind(this);this.escEvent=this.escMenu.bind(this);this.nestedMenuBlock=!1;this.positionReversedX=!1};B.prototype.initializeColumnHeader=function(t){var o=this,l;if(t.definition.headerContextMenu){t.getElement().addEventListener("contextmenu",this.LoadMenuEvent.bind(this,t,t.definition.headerContextMenu));this.tapHold(t,t.definition.headerContextMenu)}if(t.definition.headerMenu){l=document.createElement("span");l.classList.add("tabulator-header-menu-button");l.innerHTML="&vellip;";l.addEventListener("click",function(l){l.stopPropagation();l.preventDefault();o.LoadMenuEvent(t,t.definition.headerMenu,l)});t.titleElement.insertBefore(l,t.titleElement.firstChild)}};B.prototype.LoadMenuEvent=function(t,o,l){o="function"==typeof o?o.call(this.table,t.getComponent(),l):o;this.loadMenu(l,t,o)};B.prototype.tapHold=function(t,o){var l=this,a=t.getElement(),n=null,r=!1;a.addEventListener("touchstart",function(a){clearTimeout(n);r=!1;n=setTimeout(function(){clearTimeout(n);n=null;r=!0;l.LoadMenuEvent(t,o,a)},1e3)},{passive:!0});a.addEventListener("touchend",function(t){clearTimeout(n);n=null;if(r){t.preventDefault()}})};B.prototype.initializeCell=function(t){if(t.column.definition.contextMenu){t.getElement(!0).addEventListener("contextmenu",this.LoadMenuEvent.bind(this,t,t.column.definition.contextMenu));this.tapHold(t,t.column.definition.contextMenu)}if(t.column.definition.clickMenu){t.getElement(!0).addEventListener("click",this.LoadMenuEvent.bind(this,t,t.column.definition.clickMenu))}};B.prototype.initializeRow=function(t){if(this.table.options.rowContextMenu){t.getElement().addEventListener("contextmenu",this.LoadMenuEvent.bind(this,t,this.table.options.rowContextMenu));this.tapHold(t,this.table.options.rowContextMenu)}if(this.table.options.rowClickMenu){t.getElement().addEventListener("click",this.LoadMenuEvent.bind(this,t,this.table.options.rowClickMenu))}};B.prototype.initializeGroup=function(t){if(this.table.options.groupContextMenu){t.getElement().addEventListener("contextmenu",this.LoadMenuEvent.bind(this,t,this.table.options.groupContextMenu));this.tapHold(t,this.table.options.groupContextMenu)}if(this.table.options.groupClickMenu){t.getElement().addEventListener("click",this.LoadMenuEvent.bind(this,t,this.table.options.groupClickMenu))}};B.prototype.loadMenu=function(t,o,l,a){var n=this,r=!(t instanceof MouseEvent),s=document.createElement("div");s.classList.add("tabulator-menu");if(!r){t.preventDefault()}if(!l||!l.length){return}if(!a){if(this.nestedMenuBlock){if(this.isOpen()){return}}else{this.nestedMenuBlock=setTimeout(function(){n.nestedMenuBlock=!1},100)}this.hideMenu();this.menuElements=[]}l.forEach(function(t){var l=document.createElement("div"),a=t.label,r=t.disabled;if(t.separator){l.classList.add("tabulator-menu-separator")}else{l.classList.add("tabulator-menu-item");if("function"==typeof a){a=a.call(n.table,o.getComponent())}if(a instanceof Node){l.appendChild(a)}else{l.innerHTML=a}if("function"==typeof r){r=r.call(n.table,o.getComponent())}if(r){l.classList.add("tabulator-menu-item-disabled");l.addEventListener("click",function(t){t.stopPropagation()})}else{if(t.menu&&t.menu.length){l.addEventListener("click",function(a){a.stopPropagation();n.hideOldSubMenus(s);n.loadMenu(a,o,t.menu,l)})}else{if(t.action){l.addEventListener("click",function(l){t.action(l,o.getComponent())})}}}if(t.menu&&t.menu.length){l.classList.add("tabulator-menu-item-submenu")}}s.appendChild(l)});s.addEventListener("click",function(){n.hideMenu()});this.menuElements.push(s);this.positionMenu(s,a,r,t)};B.prototype.hideOldSubMenus=function(t){var o=this.menuElements.indexOf(t);if(-1<o){for(var l=this.menuElements.length-1,a;l>o;l--){a=this.menuElements[l];if(a.parentNode){a.parentNode.removeChild(a)}this.menuElements.pop()}}};B.prototype.positionMenu=function(t,o,l,a){var n=this,r=Math.max(document.body.offsetHeight,window.innerHeight),s,d,p;if(!o){s=l?a.touches[0].pageX:a.pageX;d=l?a.touches[0].pageY:a.pageY;this.positionReversedX=!1}else{p=u.prototype.helpers.elOffset(o);s=p.left+o.offsetWidth;d=p.top-1}t.style.top=d+"px";t.style.left=s+"px";setTimeout(function(){n.table.rowManager.element.addEventListener("scroll",n.blurEvent);document.body.addEventListener("click",n.blurEvent);document.body.addEventListener("contextmenu",n.blurEvent);window.addEventListener("resize",n.blurEvent);document.body.addEventListener("keydown",n.escEvent)},100);document.body.appendChild(t);if(d+t.offsetHeight>=r){t.style.top="";if(o){t.style.bottom=r-p.top-o.offsetHeight-1+"px"}else{t.style.bottom=r-d+"px"}}if(s+t.offsetWidth>=document.body.offsetWidth||this.positionReversedX){t.style.left="";if(o){t.style.right=document.documentElement.offsetWidth-p.left+"px"}else{t.style.right=document.documentElement.offsetWidth-s+"px"}this.positionReversedX=!0}};B.prototype.isOpen=function(){return!!this.menuElements.length};B.prototype.escMenu=function(t){if(27==t.keyCode){this.hideMenu()}};B.prototype.hideMenu=function(){this.menuElements.forEach(function(t){if(t.parentNode){t.parentNode.removeChild(t)}});document.body.removeEventListener("keydown",this.escEvent);document.body.removeEventListener("click",this.blurEvent);document.body.removeEventListener("contextmenu",this.blurEvent);window.removeEventListener("resize",this.blurEvent);this.table.rowManager.element.removeEventListener("scroll",this.blurEvent)};B.prototype.menus={};u.prototype.registerModule("menu",B);var I=function(t){this.table=t;this.placeholderElement=this.createPlaceholderElement();this.hoverElement=!1;this.checkTimeout=!1;this.checkPeriod=250;this.moving=!1;this.toCol=!1;this.toColAfter=!1;this.startX=0;this.autoScrollMargin=40;this.autoScrollStep=5;this.autoScrollTimeout=!1;this.touchMove=!1;this.moveHover=this.moveHover.bind(this);this.endMove=this.endMove.bind(this)};I.prototype.createPlaceholderElement=function(){var t=document.createElement("div");t.classList.add("tabulator-col");t.classList.add("tabulator-col-placeholder");return t};I.prototype.initializeColumn=function(t){var o=this,l={},a;if(!t.modules.frozen){a=t.getElement();l.mousemove=function(l){if(t.parent===o.moving.parent){if((o.touchMove?l.touches[0].pageX:l.pageX)-u.prototype.helpers.elOffset(a).left+o.table.columnManager.element.scrollLeft>t.getWidth()/2){if(o.toCol!==t||!o.toColAfter){a.parentNode.insertBefore(o.placeholderElement,a.nextSibling);o.moveColumn(t,!0)}}else{if(o.toCol!==t||o.toColAfter){a.parentNode.insertBefore(o.placeholderElement,a);o.moveColumn(t,!1)}}}}.bind(o);a.addEventListener("mousedown",function(l){o.touchMove=!1;if(1===l.which){o.checkTimeout=setTimeout(function(){o.startMove(l,t)},o.checkPeriod)}});a.addEventListener("mouseup",function(t){if(1===t.which){if(o.checkTimeout){clearTimeout(o.checkTimeout)}}});o.bindTouchEvents(t)}t.modules.moveColumn=l};I.prototype.bindTouchEvents=function(t){var o=this,l=t.getElement(),a=!1,n,r,s,d,p,c;l.addEventListener("touchstart",function(l){o.checkTimeout=setTimeout(function(){o.touchMove=!0;n=t.nextColumn();s=n?n.getWidth()/2:0;r=t.prevColumn();d=r?r.getWidth()/2:0;p=0;c=0;a=!1;o.startMove(l,t)},o.checkPeriod)},{passive:!0});l.addEventListener("touchmove",function(l){var u,m;if(o.moving){o.moveHover(l);if(!a){a=l.touches[0].pageX}u=l.touches[0].pageX-a;if(0<u){if(n&&u-p>s){m=n;if(m!==t){a=l.touches[0].pageX;m.getElement().parentNode.insertBefore(o.placeholderElement,m.getElement().nextSibling);o.moveColumn(m,!0)}}}else{if(r&&-u-c>d){m=r;if(m!==t){a=l.touches[0].pageX;m.getElement().parentNode.insertBefore(o.placeholderElement,m.getElement());o.moveColumn(m,!1)}}}if(m){n=m.nextColumn();p=s;s=n?n.getWidth()/2:0;r=m.prevColumn();c=d;d=r?r.getWidth()/2:0}}},{passive:!0});l.addEventListener("touchend",function(t){if(o.checkTimeout){clearTimeout(o.checkTimeout)}if(o.moving){o.endMove(t)}})};I.prototype.startMove=function(t,o){var l=o.getElement();this.moving=o;this.startX=(this.touchMove?t.touches[0].pageX:t.pageX)-u.prototype.helpers.elOffset(l).left;this.table.element.classList.add("tabulator-block-select");this.placeholderElement.style.width=o.getWidth()+"px";this.placeholderElement.style.height=o.getHeight()+"px";l.parentNode.insertBefore(this.placeholderElement,l);l.parentNode.removeChild(l);this.hoverElement=l.cloneNode(!0);this.hoverElement.classList.add("tabulator-moving");this.table.columnManager.getElement().appendChild(this.hoverElement);this.hoverElement.style.left="0";this.hoverElement.style.bottom="0";if(!this.touchMove){this._bindMouseMove();document.body.addEventListener("mousemove",this.moveHover);document.body.addEventListener("mouseup",this.endMove)}this.moveHover(t)};I.prototype._bindMouseMove=function(){this.table.columnManager.columnsByIndex.forEach(function(t){if(t.modules.moveColumn.mousemove){t.getElement().addEventListener("mousemove",t.modules.moveColumn.mousemove)}})};I.prototype._unbindMouseMove=function(){this.table.columnManager.columnsByIndex.forEach(function(t){if(t.modules.moveColumn.mousemove){t.getElement().removeEventListener("mousemove",t.modules.moveColumn.mousemove)}})};I.prototype.moveColumn=function(t,o){var l=this.moving.getCells();this.toCol=t;this.toColAfter=o;if(o){t.getCells().forEach(function(t,o){var a=t.getElement(!0);a.parentNode.insertBefore(l[o].getElement(),a.nextSibling)})}else{t.getCells().forEach(function(t,o){var a=t.getElement(!0);a.parentNode.insertBefore(l[o].getElement(),a)})}};I.prototype.endMove=function(t){if(1===t.which||this.touchMove){this._unbindMouseMove();this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling);this.placeholderElement.parentNode.removeChild(this.placeholderElement);this.hoverElement.parentNode.removeChild(this.hoverElement);this.table.element.classList.remove("tabulator-block-select");if(this.toCol){this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter)}this.moving=!1;this.toCol=!1;this.toColAfter=!1;if(!this.touchMove){document.body.removeEventListener("mousemove",this.moveHover);document.body.removeEventListener("mouseup",this.endMove)}}};I.prototype.moveHover=function(t){var o=this,l=o.table.columnManager.getElement(),a=l.scrollLeft,n=(o.touchMove?t.touches[0].pageX:t.pageX)-u.prototype.helpers.elOffset(l).left+a,r;o.hoverElement.style.left=n-o.startX+"px";if(n-a<o.autoScrollMargin){if(!o.autoScrollTimeout){o.autoScrollTimeout=setTimeout(function(){r=Math.max(0,a-5);o.table.rowManager.getElement().scrollLeft=r;o.autoScrollTimeout=!1},1)}}if(a+l.clientWidth-n<o.autoScrollMargin){if(!o.autoScrollTimeout){o.autoScrollTimeout=setTimeout(function(){r=Math.min(l.clientWidth,a+5);o.table.rowManager.getElement().scrollLeft=r;o.autoScrollTimeout=!1},1)}}};u.prototype.registerModule("moveColumn",I);var N=function(t){this.table=t;this.placeholderElement=this.createPlaceholderElement();this.hoverElement=!1;this.checkTimeout=!1;this.checkPeriod=150;this.moving=!1;this.toRow=!1;this.toRowAfter=!1;this.hasHandle=!1;this.startY=0;this.startX=0;this.moveHover=this.moveHover.bind(this);this.endMove=this.endMove.bind(this);this.tableRowDropEvent=!1;this.touchMove=!1;this.connection=!1;this.connectionSelectorsTables=!1;this.connectionSelectorsElements=!1;this.connectionElements=[];this.connections=[];this.connectedTable=!1;this.connectedRow=!1};N.prototype.createPlaceholderElement=function(){var t=document.createElement("div");t.classList.add("tabulator-row");t.classList.add("tabulator-row-placeholder");return t};N.prototype.initialize=function(){this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables;this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements;this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements};N.prototype.setHandle=function(t){this.hasHandle=t};N.prototype.initializeGroupHeader=function(t){var o=this,l={};l.mouseup=function(t){o.tableRowDrop(t,row)}.bind(o);l.mousemove=function(l){if(l.pageY-u.prototype.helpers.elOffset(t.element).top+o.table.rowManager.element.scrollTop>t.getHeight()/2){if(o.toRow!==t||!o.toRowAfter){var a=t.getElement();a.parentNode.insertBefore(o.placeholderElement,a.nextSibling);o.moveRow(t,!0)}}else{if(o.toRow!==t||o.toRowAfter){var a=t.getElement();if(a.previousSibling){a.parentNode.insertBefore(o.placeholderElement,a);o.moveRow(t,!1)}}}}.bind(o);t.modules.moveRow=l};N.prototype.initializeRow=function(t){var o=this,l={},a;l.mouseup=function(l){o.tableRowDrop(l,t)}.bind(o);l.mousemove=function(l){var a=t.getElement();if(l.pageY-u.prototype.helpers.elOffset(a).top+o.table.rowManager.element.scrollTop>t.getHeight()/2){if(o.toRow!==t||!o.toRowAfter){a.parentNode.insertBefore(o.placeholderElement,a.nextSibling);o.moveRow(t,!0)}}else{if(o.toRow!==t||o.toRowAfter){a.parentNode.insertBefore(o.placeholderElement,a);o.moveRow(t,!1)}}}.bind(o);if(!this.hasHandle){a=t.getElement();a.addEventListener("mousedown",function(l){if(1===l.which){o.checkTimeout=setTimeout(function(){o.startMove(l,t)},o.checkPeriod)}});a.addEventListener("mouseup",function(t){if(1===t.which){if(o.checkTimeout){clearTimeout(o.checkTimeout)}}});this.bindTouchEvents(t,t.getElement())}t.modules.moveRow=l};N.prototype.initializeCell=function(t){var o=this,l=t.getElement(!0);l.addEventListener("mousedown",function(l){if(1===l.which){o.checkTimeout=setTimeout(function(){o.startMove(l,t.row)},o.checkPeriod)}});l.addEventListener("mouseup",function(t){if(1===t.which){if(o.checkTimeout){clearTimeout(o.checkTimeout)}}});this.bindTouchEvents(t.row,l)};N.prototype.bindTouchEvents=function(t,o){var l=this,a=!1,n,r,s,d,p,c;o.addEventListener("touchstart",function(o){l.checkTimeout=setTimeout(function(){l.touchMove=!0;n=t.nextRow();s=n?n.getHeight()/2:0;r=t.prevRow();d=r?r.getHeight()/2:0;p=0;c=0;a=!1;l.startMove(o,t)},l.checkPeriod)},{passive:!0});this.moving,this.toRow,this.toRowAfter;o.addEventListener("touchmove",function(o){var u,m;if(l.moving){o.preventDefault();l.moveHover(o);if(!a){a=o.touches[0].pageY}u=o.touches[0].pageY-a;if(0<u){if(n&&u-p>s){m=n;if(m!==t){a=o.touches[0].pageY;m.getElement().parentNode.insertBefore(l.placeholderElement,m.getElement().nextSibling);l.moveRow(m,!0)}}}else{if(r&&-u-c>d){m=r;if(m!==t){a=o.touches[0].pageY;m.getElement().parentNode.insertBefore(l.placeholderElement,m.getElement());l.moveRow(m,!1)}}}if(m){n=m.nextRow();p=s;s=n?n.getHeight()/2:0;r=m.prevRow();c=d;d=r?r.getHeight()/2:0}}});o.addEventListener("touchend",function(t){if(l.checkTimeout){clearTimeout(l.checkTimeout)}if(l.moving){l.endMove(t);l.touchMove=!1}})};N.prototype._bindMouseMove=function(){var t=this;t.table.rowManager.getDisplayRows().forEach(function(t){if(("row"===t.type||"group"===t.type)&&t.modules.moveRow.mousemove){t.getElement().addEventListener("mousemove",t.modules.moveRow.mousemove)}})};N.prototype._unbindMouseMove=function(){var t=this;t.table.rowManager.getDisplayRows().forEach(function(t){if(("row"===t.type||"group"===t.type)&&t.modules.moveRow.mousemove){t.getElement().removeEventListener("mousemove",t.modules.moveRow.mousemove)}})};N.prototype.startMove=function(t,o){var l=o.getElement();this.setStartPosition(t,o);this.moving=o;this.table.element.classList.add("tabulator-block-select");this.placeholderElement.style.width=o.getWidth()+"px";this.placeholderElement.style.height=o.getHeight()+"px";if(!this.connection){l.parentNode.insertBefore(this.placeholderElement,l);l.parentNode.removeChild(l)}else{this.table.element.classList.add("tabulator-movingrow-sending");this.connectToTables(o)}this.hoverElement=l.cloneNode(!0);this.hoverElement.classList.add("tabulator-moving");if(this.connection){document.body.appendChild(this.hoverElement);this.hoverElement.style.left="0";this.hoverElement.style.top="0";this.hoverElement.style.width=this.table.element.clientWidth+"px";this.hoverElement.style.whiteSpace="nowrap";this.hoverElement.style.overflow="hidden";this.hoverElement.style.pointerEvents="none"}else{this.table.rowManager.getTableElement().appendChild(this.hoverElement);this.hoverElement.style.left="0";this.hoverElement.style.top="0";this._bindMouseMove()}document.body.addEventListener("mousemove",this.moveHover);document.body.addEventListener("mouseup",this.endMove);this.moveHover(t)};N.prototype.setStartPosition=function(t,o){var l=this.touchMove?t.touches[0].pageX:t.pageX,a=this.touchMove?t.touches[0].pageY:t.pageY,n,r;n=o.getElement();if(this.connection){r=n.getBoundingClientRect();this.startX=r.left-l+window.pageXOffset;this.startY=r.top-a+window.pageYOffset}else{this.startY=a-n.getBoundingClientRect().top}};N.prototype.endMove=function(t){if(!t||1===t.which||this.touchMove){this._unbindMouseMove();if(!this.connection){this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling);this.placeholderElement.parentNode.removeChild(this.placeholderElement)}this.hoverElement.parentNode.removeChild(this.hoverElement);this.table.element.classList.remove("tabulator-block-select");if(this.toRow){this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter)}this.moving=!1;this.toRow=!1;this.toRowAfter=!1;document.body.removeEventListener("mousemove",this.moveHover);document.body.removeEventListener("mouseup",this.endMove);if(this.connection){this.table.element.classList.remove("tabulator-movingrow-sending");this.disconnectFromTables()}}};N.prototype.moveRow=function(t,o){this.toRow=t;this.toRowAfter=o};N.prototype.moveHover=function(t){if(this.connection){this.moveHoverConnections.call(this,t)}else{this.moveHoverTable.call(this,t)}};N.prototype.moveHoverTable=function(t){var o=this.table.rowManager.getElement(),l=o.scrollTop,a=(this.touchMove?t.touches[0].pageY:t.pageY)-o.getBoundingClientRect().top+l;this.hoverElement.style.top=a-this.startY+"px"};N.prototype.moveHoverConnections=function(t){this.hoverElement.style.left=this.startX+(this.touchMove?t.touches[0].pageX:t.pageX)+"px";this.hoverElement.style.top=this.startY+(this.touchMove?t.touches[0].pageY:t.pageY)+"px"};N.prototype.elementRowDrop=function(t,o,l){if(this.table.options.movableRowsElementDrop){this.table.options.movableRowsElementDrop(t,o,l?l.getComponent():!1)}};N.prototype.connectToTables=function(t){var o=this,l;if(this.connectionSelectorsTables){l=this.table.modules.comms.getConnections(this.connectionSelectorsTables);this.table.options.movableRowsSendingStart.call(this.table,l);this.table.modules.comms.send(this.connectionSelectorsTables,"moveRow","connect",{row:t})}if(this.connectionSelectorsElements){this.connectionElements=[];if(!Array.isArray(this.connectionSelectorsElements)){this.connectionSelectorsElements=[this.connectionSelectorsElements]}this.connectionSelectorsElements.forEach(function(t){if("string"==typeof t){o.connectionElements=o.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(t)))}else{o.connectionElements.push(t)}});this.connectionElements.forEach(function(t){var l=function(l){o.elementRowDrop(l,t,o.moving)};t.addEventListener("mouseup",l);t.tabulatorElementDropEvent=l;t.classList.add("tabulator-movingrow-receiving")})}};N.prototype.disconnectFromTables=function(){var t;if(this.connectionSelectorsTables){t=this.table.modules.comms.getConnections(this.connectionSelectorsTables);this.table.options.movableRowsSendingStop.call(this.table,t);this.table.modules.comms.send(this.connectionSelectorsTables,"moveRow","disconnect")}this.connectionElements.forEach(function(t){t.classList.remove("tabulator-movingrow-receiving");t.removeEventListener("mouseup",t.tabulatorElementDropEvent);delete t.tabulatorElementDropEvent})};N.prototype.connect=function(t,o){var l=this;if(!this.connectedTable){this.connectedTable=t;this.connectedRow=o;this.table.element.classList.add("tabulator-movingrow-receiving");l.table.rowManager.getDisplayRows().forEach(function(t){if("row"===t.type&&t.modules.moveRow&&t.modules.moveRow.mouseup){t.getElement().addEventListener("mouseup",t.modules.moveRow.mouseup)}});l.tableRowDropEvent=l.tableRowDrop.bind(l);l.table.element.addEventListener("mouseup",l.tableRowDropEvent);this.table.options.movableRowsReceivingStart.call(this.table,o,t);return!0}else{console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable);return!1}};N.prototype.disconnect=function(t){var o=this;if(t===this.connectedTable){this.connectedTable=!1;this.connectedRow=!1;this.table.element.classList.remove("tabulator-movingrow-receiving");o.table.rowManager.getDisplayRows().forEach(function(t){if("row"===t.type&&t.modules.moveRow&&t.modules.moveRow.mouseup){t.getElement().removeEventListener("mouseup",t.modules.moveRow.mouseup)}});o.table.element.removeEventListener("mouseup",o.tableRowDropEvent);this.table.options.movableRowsReceivingStop.call(this.table,t)}else{console.warn("Move Row Error - trying to disconnect from non connected table")}};N.prototype.dropComplete=function(t,o,l){var a=!1;if(l){switch(_typeof(this.table.options.movableRowsSender)){case"string":a=this.senders[this.table.options.movableRowsSender];break;case"function":a=this.table.options.movableRowsSender;break;}if(a){a.call(this,this.moving.getComponent(),o?o.getComponent():void 0,t)}else{if(this.table.options.movableRowsSender){console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender)}}this.table.options.movableRowsSent.call(this.table,this.moving.getComponent(),o?o.getComponent():void 0,t)}else{this.table.options.movableRowsSentFailed.call(this.table,this.moving.getComponent(),o?o.getComponent():void 0,t)}this.endMove()};N.prototype.tableRowDrop=function(t,o){var l=!1,a=!1;t.stopImmediatePropagation();switch(_typeof(this.table.options.movableRowsReceiver)){case"string":l=this.receivers[this.table.options.movableRowsReceiver];break;case"function":l=this.table.options.movableRowsReceiver;break;}if(l){a=l.call(this,this.connectedRow.getComponent(),o?o.getComponent():void 0,this.connectedTable)}else{console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver)}if(a){this.table.options.movableRowsReceived.call(this.table,this.connectedRow.getComponent(),o?o.getComponent():void 0,this.connectedTable)}else{this.table.options.movableRowsReceivedFailed.call(this.table,this.connectedRow.getComponent(),o?o.getComponent():void 0,this.connectedTable)}this.table.modules.comms.send(this.connectedTable,"moveRow","dropcomplete",{row:o,success:a})};N.prototype.receivers={insert:function(t,o){this.table.addRow(t.getData(),void 0,o);return!0},add:function(t){this.table.addRow(t.getData());return!0},update:function(t,o){if(o){o.update(t.getData());return!0}return!1},replace:function(t,o){if(o){this.table.addRow(t.getData(),void 0,o);o.delete();return!0}return!1}};N.prototype.senders={delete:function(t){t.delete()}};N.prototype.commsReceived=function(t,o,l){switch(o){case"connect":return this.connect(t,l.row);break;case"disconnect":return this.disconnect(t);break;case"dropcomplete":return this.dropComplete(t,l.row,l.success);break;}};u.prototype.registerModule("moveRow",N);var V=function(t){this.table=t;this.allowedTypes=["","data","edit","clipboard"];this.enabled=!0};V.prototype.initializeColumn=function(t){var o=this,l=!1,a={};this.allowedTypes.forEach(function(n){var r="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),s;if(t.definition[r]){s=o.lookupMutator(t.definition[r]);if(s){l=!0;a[r]={mutator:s,params:t.definition[r+"Params"]||{}}}}});if(l){t.modules.mutate=a}};V.prototype.lookupMutator=function(t){var o=!1;switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":if(this.mutators[t]){o=this.mutators[t]}else{console.warn("Mutator Error - No such mutator found, ignoring: ",t)}break;case"function":o=t;break;}return o};V.prototype.transformRow=function(t,o,l){var a=this,n="mutator"+(o.charAt(0).toUpperCase()+o.slice(1)),r;if(this.enabled){a.table.columnManager.traverse(function(a){var s,d,p;if(a.modules.mutate){s=a.modules.mutate[n]||a.modules.mutate.mutator||!1;if(s){r=a.getFieldValue("undefined"!=typeof l?l:t);if("data"==o||"undefined"!=typeof r){p=a.getComponent();d="function"==typeof s.params?s.params(r,t,o,p):s.params;a.setFieldValue(t,s.mutator(r,t,o,d,p))}}}})}return t};V.prototype.transformCell=function(t,o){var l=t.column.modules.mutate.mutatorEdit||t.column.modules.mutate.mutator||!1,a={};if(l){a=Object.assign(a,t.row.getData());t.column.setFieldValue(a,o);return l.mutator(o,a,"edit",l.params,t.getComponent())}else{return o}};V.prototype.enable=function(){this.enabled=!0};V.prototype.disable=function(){this.enabled=!1};V.prototype.mutators={};u.prototype.registerModule("mutator",V);var W=function(t){this.table=t;this.mode="local";this.progressiveLoad=!1;this.size=0;this.page=1;this.count=5;this.max=1;this.displayIndex=0;this.initialLoad=!0;this.pageSizes=[];this.dataReceivedNames={};this.dataSentNames={};this.createElements()};W.prototype.createElements=function(){var t;this.element=document.createElement("span");this.element.classList.add("tabulator-paginator");this.pagesElement=document.createElement("span");this.pagesElement.classList.add("tabulator-pages");t=document.createElement("button");t.classList.add("tabulator-page");t.setAttribute("type","button");t.setAttribute("role","button");t.setAttribute("aria-label","");t.setAttribute("title","");this.firstBut=t.cloneNode(!0);this.firstBut.setAttribute("data-page","first");this.prevBut=t.cloneNode(!0);this.prevBut.setAttribute("data-page","prev");this.nextBut=t.cloneNode(!0);this.nextBut.setAttribute("data-page","next");this.lastBut=t.cloneNode(!0);this.lastBut.setAttribute("data-page","last");if(this.table.options.paginationSizeSelector){this.pageSizeSelect=document.createElement("select");this.pageSizeSelect.classList.add("tabulator-page-size")}};W.prototype.generatePageSizeSelectList=function(){var t=this,o=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector)){o=this.table.options.paginationSizeSelector;this.pageSizes=o;if(-1==this.pageSizes.indexOf(this.size)){o.unshift(this.size)}}else{if(-1==this.pageSizes.indexOf(this.size)){o=[];for(var l=1;5>l;l++){o.push(this.size*l)}this.pageSizes=o}else{o=this.pageSizes}}while(this.pageSizeSelect.firstChild){this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild)}o.forEach(function(o){var l=document.createElement("option");l.value=o;if(!0===o){t.table.modules.localize.bind("pagination|all",function(t){l.innerHTML=t})}else{l.innerHTML=o}t.pageSizeSelect.appendChild(l)});this.pageSizeSelect.value=this.size}};W.prototype.initialize=function(t){var o=this,l,a,n;this.dataSentNames=Object.assign({},this.paginationDataSentNames);this.dataSentNames=Object.assign(this.dataSentNames,this.table.options.paginationDataSent);this.dataReceivedNames=Object.assign({},this.paginationDataReceivedNames);this.dataReceivedNames=Object.assign(this.dataReceivedNames,this.table.options.paginationDataReceived);o.table.modules.localize.bind("pagination|first",function(t){o.firstBut.innerHTML=t});o.table.modules.localize.bind("pagination|first_title",function(t){o.firstBut.setAttribute("aria-label",t);o.firstBut.setAttribute("title",t)});o.table.modules.localize.bind("pagination|prev",function(t){o.prevBut.innerHTML=t});o.table.modules.localize.bind("pagination|prev_title",function(t){o.prevBut.setAttribute("aria-label",t);o.prevBut.setAttribute("title",t)});o.table.modules.localize.bind("pagination|next",function(t){o.nextBut.innerHTML=t});o.table.modules.localize.bind("pagination|next_title",function(t){o.nextBut.setAttribute("aria-label",t);o.nextBut.setAttribute("title",t)});o.table.modules.localize.bind("pagination|last",function(t){o.lastBut.innerHTML=t});o.table.modules.localize.bind("pagination|last_title",function(t){o.lastBut.setAttribute("aria-label",t);o.lastBut.setAttribute("title",t)});o.firstBut.addEventListener("click",function(){o.setPage(1).then(function(){}).catch(function(){})});o.prevBut.addEventListener("click",function(){o.previousPage().then(function(){}).catch(function(){})});o.nextBut.addEventListener("click",function(){o.nextPage().then(function(){}).catch(function(){})});o.lastBut.addEventListener("click",function(){o.setPage(o.max).then(function(){}).catch(function(){})});if(o.table.options.paginationElement){o.element=o.table.options.paginationElement}if(this.pageSizeSelect){l=document.createElement("label");o.table.modules.localize.bind("pagination|page_size",function(t){o.pageSizeSelect.setAttribute("aria-label",t);o.pageSizeSelect.setAttribute("title",t);l.innerHTML=t});o.element.appendChild(l);o.element.appendChild(o.pageSizeSelect);o.pageSizeSelect.addEventListener("change",function(){o.setPageSize("true"==o.pageSizeSelect.value?!0:o.pageSizeSelect.value);o.setPage(1).then(function(){}).catch(function(){})})}o.element.appendChild(o.firstBut);o.element.appendChild(o.prevBut);o.element.appendChild(o.pagesElement);o.element.appendChild(o.nextBut);o.element.appendChild(o.lastBut);if(!o.table.options.paginationElement&&!t){o.table.footerManager.append(o.element,o)}o.mode=o.table.options.pagination;if(o.table.options.paginationSize){o.size=o.table.options.paginationSize}else{a=document.createElement("div");a.classList.add("tabulator-row");a.style.visibility=t;n=document.createElement("div");n.classList.add("tabulator-cell");n.innerHTML="Page Row Test";a.appendChild(n);o.table.rowManager.getTableElement().appendChild(a);o.size=Math.floor(o.table.rowManager.getElement().clientHeight/a.offsetHeight);o.table.rowManager.getTableElement().removeChild(a)}o.count=o.table.options.paginationButtonCount;o.generatePageSizeSelectList()};W.prototype.initializeProgressive=function(t){this.initialize(!0);this.mode="progressive_"+t;this.progressiveLoad=!0};W.prototype.setDisplayIndex=function(t){this.displayIndex=t};W.prototype.getDisplayIndex=function(){return this.displayIndex};W.prototype.setMaxRows=function(t){if(!t){this.max=1}else{this.max=!0===this.size?1:Math.ceil(t/this.size)}if(this.page>this.max){this.page=this.max}};W.prototype.reset=function(t,o){if("local"==this.mode||t){this.page=1}if(o){this.initialLoad=!0}return!0};W.prototype.setMaxPage=function(t){t=parseInt(t);this.max=t||1;if(this.page>this.max){this.page=this.max;this.trigger()}};W.prototype.setPage=function(t){var o=this,l=this;switch(t){case"first":return this.setPage(1);break;case"prev":return this.previousPage();break;case"next":return this.nextPage();break;case"last":return this.setPage(this.max);break;}return new Promise(function(a,n){t=parseInt(t);if(0<t&&t<=o.max||"local"!==o.mode){o.page=t;o.trigger().then(function(){a()}).catch(function(){n()});if(l.table.options.persistence&&l.table.modExists("persistence",!0)&&l.table.modules.persistence.config.page){l.table.modules.persistence.save("page")}}else{console.warn("Pagination Error - Requested page is out of range of 1 - "+o.max+":",t);n()}})};W.prototype.setPageToRow=function(t){var o=this;return new Promise(function(l,a){var n=o.table.rowManager.getDisplayRows(o.displayIndex-1),r=n.indexOf(t);if(-1<r){var s=!0===o.size?1:Math.ceil((r+1)/o.size);o.setPage(s).then(function(){l()}).catch(function(){a()})}else{console.warn("Pagination Error - Requested row is not visible");a()}})};W.prototype.setPageSize=function(t){if(!0!==t){t=parseInt(t)}if(0<t){this.size=t}if(this.pageSizeSelect){this.generatePageSizeSelectList()}if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.page){this.table.modules.persistence.save("page")}};W.prototype._setPageButtons=function(){var t=this,o=Math.floor((this.count-1)/2),l=Math.ceil((this.count-1)/2),a=this.max-this.page+o+1<this.count?this.max-this.count+1:Math.max(this.page-o,1),n=this.page<=l?Math.min(this.count,this.max):Math.min(this.page+l,this.max);while(t.pagesElement.firstChild){t.pagesElement.removeChild(t.pagesElement.firstChild)}if(1==t.page){t.firstBut.disabled=!0;t.prevBut.disabled=!0}else{t.firstBut.disabled=!1;t.prevBut.disabled=!1}if(t.page==t.max){t.lastBut.disabled=!0;t.nextBut.disabled=!0}else{t.lastBut.disabled=!1;t.nextBut.disabled=!1}for(var r=a;r<=n;r++){if(0<r&&r<=t.max){t.pagesElement.appendChild(t._generatePageButton(r))}}this.footerRedraw()};W.prototype._generatePageButton=function(t){var o=this,l=document.createElement("button");l.classList.add("tabulator-page");if(t==o.page){l.classList.add("active")}l.setAttribute("type","button");l.setAttribute("role","button");o.table.modules.localize.bind("pagination|page_title",function(o){l.setAttribute("aria-label",o+" "+t);l.setAttribute("title",o+" "+t)});l.setAttribute("data-page",t);l.textContent=t;l.addEventListener("click",function(){o.setPage(t).then(function(){}).catch(function(){})});return l};W.prototype.previousPage=function(){var t=this;return new Promise(function(o,l){if(1<t.page){t.page--;t.trigger().then(function(){o()}).catch(function(){l()});if(t.table.options.persistence&&t.table.modExists("persistence",!0)&&t.table.modules.persistence.config.page){t.table.modules.persistence.save("page")}}else{console.warn("Pagination Error - Previous page would be less than page 1:",0);l()}})};W.prototype.nextPage=function(){var t=this;return new Promise(function(o,l){if(t.page<t.max){t.page++;t.trigger().then(function(){o()}).catch(function(){l()});if(t.table.options.persistence&&t.table.modExists("persistence",!0)&&t.table.modules.persistence.config.page){t.table.modules.persistence.save("page")}}else{if(!t.progressiveLoad){console.warn("Pagination Error - Next page would be greater than maximum page of "+t.max+":",t.max+1)}l()}})};W.prototype.getPage=function(){return this.page};W.prototype.getPageMax=function(){return this.max};W.prototype.getPageSize=function(){return this.size};W.prototype.getMode=function(){return this.mode};W.prototype.getRows=function(t){var o,l,a;if("local"==this.mode){o=[];if(!0===this.size){l=0;a=t.length}else{l=this.size*(this.page-1);a=l+parseInt(this.size)}this._setPageButtons();for(var n=l;n<a;n++){if(t[n]){o.push(t[n])}}return o}else{this._setPageButtons();return t.slice(0)}};W.prototype.trigger=function(){var t=this,o;return new Promise(function(l,a){switch(t.mode){case"local":o=t.table.rowManager.scrollLeft;t.table.rowManager.refreshActiveData("page");t.table.rowManager.scrollHorizontal(o);t.table.options.pageLoaded.call(t.table,t.getPage());l();break;case"remote":case"progressive_load":case"progressive_scroll":t.table.modules.ajax.blockActiveRequest();t._getRemotePage().then(function(){l()}).catch(function(){a()});break;default:console.warn("Pagination Error - no such pagination mode:",t.mode);a();}})};W.prototype._getRemotePage=function(){var t=this,o=this,l,a;return new Promise(function(n,r){if(!o.table.modExists("ajax",!0)){r()}l=u.prototype.helpers.deepClone(o.table.modules.ajax.getParams()||{});a=o.table.modules.ajax.getParams();a[t.dataSentNames.page]=o.page;if(t.size){a[t.dataSentNames.size]=t.size}if(t.table.options.ajaxSorting&&t.table.modExists("sort")){var s=o.table.modules.sort.getSort();s.forEach(function(t){delete t.column});a[t.dataSentNames.sorters]=s}if(t.table.options.ajaxFiltering&&t.table.modExists("filter")){var d=o.table.modules.filter.getFilters(!0,!0);a[t.dataSentNames.filters]=d}o.table.modules.ajax.setParams(a);o.table.modules.ajax.sendRequest(t.progressiveLoad).then(function(t){o._parseRemoteData(t);n()}).catch(function(){r()});o.table.modules.ajax.setParams(l)})};W.prototype._parseRemoteData=function(t){var o=this,l,t,a;if("undefined"==typeof t[this.dataReceivedNames.last_page]){console.warn("Remote Pagination Error - Server response missing '"+this.dataReceivedNames.last_page+"' property")}if(t[this.dataReceivedNames.data]){this.max=parseInt(t[this.dataReceivedNames.last_page])||1;if(this.progressiveLoad){switch(this.mode){case"progressive_load":if(1==this.page){this.table.rowManager.setData(t[this.dataReceivedNames.data],!1,this.initialLoad&&1==this.page)}else{this.table.rowManager.addRows(t[this.dataReceivedNames.data])}if(this.page<this.max){setTimeout(function(){o.nextPage().then(function(){}).catch(function(){})},o.table.options.ajaxProgressiveLoadDelay)}break;case"progressive_scroll":t=this.table.rowManager.getData().concat(t[this.dataReceivedNames.data]);this.table.rowManager.setData(t,!0,this.initialLoad&&1==this.page);a=this.table.options.ajaxProgressiveLoadScrollMargin||2*this.table.rowManager.element.clientHeight;if(o.table.rowManager.element.scrollHeight<=o.table.rowManager.element.clientHeight+a){o.nextPage().then(function(){}).catch(function(){})}break;}}else{l=this.table.rowManager.scrollLeft;this.table.rowManager.setData(t[this.dataReceivedNames.data],!1,this.initialLoad&&1==this.page);this.table.rowManager.scrollHorizontal(l);this.table.columnManager.scrollHorizontal(l);this.table.options.pageLoaded.call(this.table,this.getPage())}this.initialLoad=!1}else{console.warn("Remote Pagination Error - Server response missing '"+this.dataReceivedNames.data+"' property")}};W.prototype.footerRedraw=function(){var t=this.table.footerManager.element;if(0>Math.ceil(t.clientWidth)-t.scrollWidth){this.pagesElement.style.display="none"}else{this.pagesElement.style.display="";if(0>Math.ceil(t.clientWidth)-t.scrollWidth){this.pagesElement.style.display="none"}}};W.prototype.paginationDataSentNames={page:"page",size:"size",sorters:"sorters",filters:"filters"};W.prototype.paginationDataReceivedNames={current_page:"current_page",last_page:"last_page",data:"data"};u.prototype.registerModule("page",W);var O=function(t){this.table=t;this.mode="";this.id="";this.defWatcherBlock=!1;this.config={};this.readFunc=!1;this.writeFunc=!1};O.prototype.localStorageTest=function(){try{window.localStorage.setItem("_tabulator_test","_tabulator_test");window.localStorage.removeItem("_tabulator_test");return!0}catch(t){return!1}};O.prototype.initialize=function(){var t=this.table.options.persistenceMode,o=this.table.options.persistenceID,l;this.mode=!0!==t?t:this.localStorageTest()?"local":"cookie";if(this.table.options.persistenceReaderFunc){if("function"==typeof this.table.options.persistenceReaderFunc){this.readFunc=this.table.options.persistenceReaderFunc}else{if(this.readers[this.table.options.persistenceReaderFunc]){this.readFunc=this.readers[this.table.options.persistenceReaderFunc]}else{console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc)}}}else{if(this.readers[this.mode]){this.readFunc=this.readers[this.mode]}else{console.warn("Persistence Read Error - invalid reader set",this.mode)}}if(this.table.options.persistenceWriterFunc){if("function"==typeof this.table.options.persistenceWriterFunc){this.writeFunc=this.table.options.persistenceWriterFunc}else{if(this.readers[this.table.options.persistenceWriterFunc]){this.writeFunc=this.readers[this.table.options.persistenceWriterFunc]}else{console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc)}}}else{if(this.writers[this.mode]){this.writeFunc=this.writers[this.mode]}else{console.warn("Persistence Write Error - invalid writer set",this.mode)}}this.id="tabulator-"+(o||this.table.element.getAttribute("id")||"");this.config={sort:!0===this.table.options.persistence||this.table.options.persistence.sort,filter:!0===this.table.options.persistence||this.table.options.persistence.filter,group:!0===this.table.options.persistence||this.table.options.persistence.group,page:!0===this.table.options.persistence||this.table.options.persistence.page,columns:!0===this.table.options.persistence?["title","width","visible"]:this.table.options.persistence.columns};if(this.config.page){l=this.retreiveData("page");if(l){if("undefined"!=typeof l.paginationSize&&(!0===this.config.page||this.config.page.size)){this.table.options.paginationSize=l.paginationSize}if("undefined"!=typeof l.paginationInitialPage&&(!0===this.config.page||this.config.page.page)){this.table.options.paginationInitialPage=l.paginationInitialPage}}}if(this.config.group){l=this.retreiveData("group");if(l){if("undefined"!=typeof l.groupBy&&(!0===this.config.group||this.config.group.groupBy)){this.table.options.groupBy=l.groupBy}if("undefined"!=typeof l.groupStartOpen&&(!0===this.config.group||this.config.group.groupStartOpen)){this.table.options.groupStartOpen=l.groupStartOpen}if("undefined"!=typeof l.groupHeader&&(!0===this.config.group||this.config.group.groupHeader)){this.table.options.groupHeader=l.groupHeader}}}if(this.config.columns){this.table.options.columns=this.load("columns",this.table.options.columns)}};O.prototype.initializeColumn=function(t){var o=this,l,a;if(this.config.columns){this.defWatcherBlock=!0;l=t.getDefinition();a=!0===this.config.columns?Object.keys(l):this.config.columns;a.forEach(function(t){var a=Object.getOwnPropertyDescriptor(l,t),n=l[t];if(a){Object.defineProperty(l,t,{set:function(t){n=t;if(!o.defWatcherBlock){o.save("columns")}if(a.set){a.set(t)}},get:function(){if(a.get){a.get()}return n}})}});this.defWatcherBlock=!1}};O.prototype.load=function(t,o){var l=this.retreiveData(t);if(o){l=l?this.mergeDefinition(o,l):o}return l};O.prototype.retreiveData=function(t){return this.readFunc?this.readFunc(this.id,t):!1};O.prototype.mergeDefinition=function(t,o){var l=this,a=[];o=o||[];o.forEach(function(o){var n=l._findColumn(t,o),r;if(n){if(!0===l.config.columns||l.config.columns==void 0){r=Object.keys(n);r.push("width")}else{r=l.config.columns}r.forEach(function(t){if("columns"!==t&&"undefined"!=typeof o[t]){n[t]=o[t]}});if(n.columns){n.columns=l.mergeDefinition(n.columns,o.columns)}a.push(n)}});t.forEach(function(t,n){var r=l._findColumn(o,t);if(!r){if(a.length>n){a.splice(n,0,t)}else{a.push(t)}}});return a};O.prototype._findColumn=function(t,o){var l=o.columns?"group":o.field?"field":"object";return t.find(function(t){switch(l){case"group":return t.title===o.title&&t.columns.length===o.columns.length;break;case"field":return t.field===o.field;break;case"object":return t===o;break;}})};O.prototype.save=function(t){var o={};switch(t){case"columns":o=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":o=this.table.modules.filter.getFilters();break;case"sort":o=this.validateSorters(this.table.modules.sort.getSort());break;case"group":o=this.getGroupConfig();break;case"page":o=this.getPageConfig();break;}if(this.writeFunc){this.writeFunc(this.id,t,o)}};O.prototype.validateSorters=function(t){t.forEach(function(t){t.column=t.field;delete t.field});return t};O.prototype.getGroupConfig=function(){var t={};if(this.config.group){if(!0===this.config.group||this.config.group.groupBy){t.groupBy=this.table.options.groupBy}if(!0===this.config.group||this.config.group.groupStartOpen){t.groupStartOpen=this.table.options.groupStartOpen}if(!0===this.config.group||this.config.group.groupHeader){t.groupHeader=this.table.options.groupHeader}}return t};O.prototype.getPageConfig=function(){var t={};if(this.config.page){if(!0===this.config.page||this.config.page.size){t.paginationSize=this.table.modules.page.getPageSize()}if(!0===this.config.page||this.config.page.page){t.paginationInitialPage=this.table.modules.page.getPage()}}return t};O.prototype.parseColumns=function(t){var o=this,l=[],a=["headerContextMenu","headerMenu","contextMenu","clickMenu"];t.forEach(function(t){var n={},r=t.getDefinition(),s;if(t.isGroup){n.title=r.title;n.columns=o.parseColumns(t.getColumns())}else{n.field=t.getField();if(!0===o.config.columns||o.config.columns==void 0){s=Object.keys(r);s.push("width")}else{s=o.config.columns}s.forEach(function(o){switch(o){case"width":n.width=t.getWidth();break;case"visible":n.visible=t.visible;break;default:if("function"!=typeof r[o]&&-1===a.indexOf(o)){n[o]=r[o]}}})}l.push(n)});return l};O.prototype.readers={local:function(t,o){var l=localStorage.getItem(t+"-"+o);return l?JSON.parse(l):!1},cookie:function t(o,l){var t=document.cookie,a=o+"-"+l,n=t.indexOf(a+"="),r,s;if(-1<n){t=t.substr(n);r=t.indexOf(";");if(-1<r){t=t.substr(0,r)}s=t.replace(a+"=","")}return s?JSON.parse(s):!1}};O.prototype.writers={local:function(t,o,l){localStorage.setItem(t+"-"+o,JSON.stringify(l))},cookie:function(t,o,l){var a=new Date;a.setDate(a.getDate()+1e4);document.cookie=t+"-"+o+"="+JSON.stringify(l)+"; expires="+a.toUTCString()}};u.prototype.registerModule("persistence",O);var j=function(t){this.table=t;this.element=!1;this.manualBlock=!1};j.prototype.initialize=function(){window.addEventListener("beforeprint",this.replaceTable.bind(this));window.addEventListener("afterprint",this.cleanup.bind(this))};j.prototype.replaceTable=function(){if(!this.manualBlock){this.element=document.createElement("div");this.element.classList.add("tabulator-print-table");this.element.appendChild(this.table.modules.export.genereateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print"));this.table.element.style.display="none";this.table.element.parentNode.insertBefore(this.element,this.table.element)}};j.prototype.cleanup=function(){document.body.classList.remove("tabulator-print-fullscreen-hide");if(this.element&&this.element.parentNode){this.element.parentNode.removeChild(this.element);this.table.element.style.display=""}};j.prototype.printFullscreen=function(t,o,l){var a=window.scrollX,n=window.scrollY,r=document.createElement("div"),s=document.createElement("div"),d=this.table.modules.export.genereateTable("undefined"!=typeof l?l:this.table.options.printConfig,"undefined"!=typeof o?o:this.table.options.printStyled,t,"print"),p,c;this.manualBlock=!0;this.element=document.createElement("div");this.element.classList.add("tabulator-print-fullscreen");if(this.table.options.printHeader){r.classList.add("tabulator-print-header");p="function"==typeof this.table.options.printHeader?this.table.options.printHeader.call(this.table):this.table.options.printHeader;if("string"==typeof p){r.innerHTML=p}else{r.appendChild(p)}this.element.appendChild(r)}this.element.appendChild(d);if(this.table.options.printFooter){s.classList.add("tabulator-print-footer");c="function"==typeof this.table.options.printFooter?this.table.options.printFooter.call(this.table):this.table.options.printFooter;if("string"==typeof c){s.innerHTML=c}else{s.appendChild(c)}this.element.appendChild(s)}document.body.classList.add("tabulator-print-fullscreen-hide");document.body.appendChild(this.element);if(this.table.options.printFormatter){this.table.options.printFormatter(this.element,d)}window.print();this.cleanup();window.scrollTo(a,n);this.manualBlock=!1};u.prototype.registerModule("print",j);var G=function(t){this.table=t;this.data=!1;this.blocked=!1;this.origFuncs={};this.currentVersion=0};G.prototype.watchData=function(t){var o=this,l;this.currentVersion++;l=this.currentVersion;o.unwatchData();o.data=t;o.origFuncs.push=t.push;Object.defineProperty(o.data,"push",{enumerable:!1,configurable:!0,value:function(){var a=Array.from(arguments);if(!o.blocked&&l===o.currentVersion){a.forEach(function(t){o.table.rowManager.addRowActual(t,!1)})}return o.origFuncs.push.apply(t,arguments)}});o.origFuncs.unshift=t.unshift;Object.defineProperty(o.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var a=Array.from(arguments);if(!o.blocked&&l===o.currentVersion){a.forEach(function(t){o.table.rowManager.addRowActual(t,!0)})}return o.origFuncs.unshift.apply(t,arguments)}});o.origFuncs.shift=t.shift;Object.defineProperty(o.data,"shift",{enumerable:!1,configurable:!0,value:function(){var a;if(!o.blocked&&l===o.currentVersion){if(o.data.length){a=o.table.rowManager.getRowFromDataObject(o.data[0]);if(a){a.deleteActual()}}}return o.origFuncs.shift.call(t)}});o.origFuncs.pop=t.pop;Object.defineProperty(o.data,"pop",{enumerable:!1,configurable:!0,value:function(){var a;if(!o.blocked&&l===o.currentVersion){if(o.data.length){a=o.table.rowManager.getRowFromDataObject(o.data[o.data.length-1]);if(a){a.deleteActual()}}}return o.origFuncs.pop.call(t)}});o.origFuncs.splice=t.splice;Object.defineProperty(o.data,"splice",{enumerable:!1,configurable:!0,value:function(){var a=Array.from(arguments),n=0>a[0]?t.length+a[0]:a[0],r=a[1],s=a[2]?a.slice(2):!1,d;if(!o.blocked&&l===o.currentVersion){if(s){d=t[n]?o.table.rowManager.getRowFromDataObject(t[n]):!1;if(d){s.forEach(function(t){o.table.rowManager.addRowActual(t,!0,d,!0)})}else{s=s.slice().reverse();s.forEach(function(t){o.table.rowManager.addRowActual(t,!0,!1,!0)})}}if(0!==r){var p=t.slice(n,"undefined"==typeof a[1]?a[1]:n+r);p.forEach(function(t,l){var a=o.table.rowManager.getRowFromDataObject(t);if(a){a.deleteActual(l!==p.length-1)}})}if(s||0!==r){o.table.rowManager.reRenderInPosition()}}return o.origFuncs.splice.apply(t,arguments)}})};G.prototype.unwatchData=function(){if(!1!==this.data){for(var t in this.origFuncs){Object.defineProperty(this.data,t,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}}};G.prototype.watchRow=function(t){var o=t.getData();this.blocked=!0;for(var l in o){this.watchKey(t,o,l)}if(this.table.options.dataTree){this.watchTreeChildren(t)}this.blocked=!1};G.prototype.watchTreeChildren=function(t){var l=this,a=t.getData()[this.table.options.dataTreeChildField],n={};function o(){l.table.modules.dataTree.initializeRow(t);l.table.modules.dataTree.layoutRow(t);l.table.rowManager.refreshActiveData("tree",!1,!0)}if(a){n.push=a.push;Object.defineProperty(a,"push",{enumerable:!1,configurable:!0,value:function(){var t=n.push.apply(a,arguments);o();return t}});n.unshift=a.unshift;Object.defineProperty(a,"unshift",{enumerable:!1,configurable:!0,value:function(){var t=n.unshift.apply(a,arguments);o();return t}});n.shift=a.shift;Object.defineProperty(a,"shift",{enumerable:!1,configurable:!0,value:function(){var t=n.shift.call(a);o();return t}});n.pop=a.pop;Object.defineProperty(a,"pop",{enumerable:!1,configurable:!0,value:function(){var t=n.pop.call(a);o();return t}});n.splice=a.splice;Object.defineProperty(a,"splice",{enumerable:!1,configurable:!0,value:function(){var t=n.splice.apply(a,arguments);o();return t}})}};G.prototype.watchKey=function(t,o,l){var a=this,n=Object.getOwnPropertyDescriptor(o,l),r=o[l],s=this.currentVersion;Object.defineProperty(o,l,{set:function(o){r=o;if(!a.blocked&&s===a.currentVersion){var d={};d[l]=o;t.updateData(d)}if(n.set){n.set(o)}},get:function(){if(n.get){n.get()}return r}})};G.prototype.unwatchRow=function(t){var o=t.getData();for(var l in o){Object.defineProperty(o,l,{value:o[l]})}};G.prototype.block=function(){this.blocked=!0};G.prototype.unblock=function(){this.blocked=!1};u.prototype.registerModule("reactiveData",G);var U=function(t){this.table=t;this.startColumn=!1;this.startX=!1;this.startWidth=!1;this.handle=null;this.prevHandle=null};U.prototype.initializeColumn=function(t,o,l){var a=this,n=!1,r=this.table.options.resizableColumns;if("header"===t){n="textarea"==o.definition.formatter||o.definition.variableHeight;o.modules.resize={variableHeight:n}}if(!0===r||r==t){var s=document.createElement("div");s.className="tabulator-col-resize-handle";var d=document.createElement("div");d.className="tabulator-col-resize-handle prev";s.addEventListener("click",function(t){t.stopPropagation()});var p=function(t){var l=o.getLastColumn();if(l&&a._checkResizability(l)){a.startColumn=o;a._mouseDown(t,l,s)}};s.addEventListener("mousedown",p);s.addEventListener("touchstart",p,{passive:!0});s.addEventListener("dblclick",function(t){var l=o.getLastColumn();if(l&&a._checkResizability(l)){t.stopPropagation();l.reinitializeWidth(!0)}});d.addEventListener("click",function(t){t.stopPropagation()});var c=function(t){var l,n,r;l=o.getFirstColumn();if(l){n=a.table.columnManager.findColumnIndex(l);r=0<n?a.table.columnManager.getColumnByIndex(n-1):!1;if(r&&a._checkResizability(r)){a.startColumn=o;a._mouseDown(t,r,d)}}};d.addEventListener("mousedown",c);d.addEventListener("touchstart",c,{passive:!0});d.addEventListener("dblclick",function(t){var l,n,r;l=o.getFirstColumn();if(l){n=a.table.columnManager.findColumnIndex(l);r=0<n?a.table.columnManager.getColumnByIndex(n-1):!1;if(r&&a._checkResizability(r)){t.stopPropagation();r.reinitializeWidth(!0)}}});l.appendChild(s);l.appendChild(d)}};U.prototype._checkResizability=function(t){return"undefined"!=typeof t.definition.resizable?t.definition.resizable:this.table.options.resizableColumns};U.prototype._mouseDown=function(t,o,l){var r=this;r.table.element.classList.add("tabulator-block-select");function a(t){if(r.table.rtl){o.setWidth(r.startWidth-(("undefined"==typeof t.screenX?t.touches[0].screenX:t.screenX)-r.startX))}else{o.setWidth(r.startWidth+(("undefined"==typeof t.screenX?t.touches[0].screenX:t.screenX)-r.startX))}if(r.table.options.virtualDomHoz){r.table.vdomHoz.reinitialize(!0)}if(!r.table.browserSlow&&o.modules.resize&&o.modules.resize.variableHeight){o.checkCellHeights()}}function n(){if(r.startColumn.modules.edit){r.startColumn.modules.edit.blocked=!1}if(r.table.browserSlow&&o.modules.resize&&o.modules.resize.variableHeight){o.checkCellHeights()}document.body.removeEventListener("mouseup",n);document.body.removeEventListener("mousemove",a);l.removeEventListener("touchmove",a);l.removeEventListener("touchend",n);r.table.element.classList.remove("tabulator-block-select");if(r.table.options.persistence&&r.table.modExists("persistence",!0)&&r.table.modules.persistence.config.columns){r.table.modules.persistence.save("columns")}r.table.options.columnResized.call(r.table,o.getComponent())}t.stopPropagation();if(r.startColumn.modules.edit){r.startColumn.modules.edit.blocked=!0}r.startX="undefined"==typeof t.screenX?t.touches[0].screenX:t.screenX;r.startWidth=o.getWidth();document.body.addEventListener("mousemove",a);document.body.addEventListener("mouseup",n);l.addEventListener("touchmove",a,{passive:!0});l.addEventListener("touchend",n)};u.prototype.registerModule("resizeColumns",U);var Y=function(t){this.table=t;this.startColumn=!1;this.startY=!1;this.startHeight=!1;this.handle=null;this.prevHandle=null};Y.prototype.initializeRow=function(t){var o=this,l=t.getElement(),a=document.createElement("div");a.className="tabulator-row-resize-handle";var n=document.createElement("div");n.className="tabulator-row-resize-handle prev";a.addEventListener("click",function(t){t.stopPropagation()});var r=function(l){o.startRow=t;o._mouseDown(l,t,a)};a.addEventListener("mousedown",r);a.addEventListener("touchstart",r,{passive:!0});n.addEventListener("click",function(t){t.stopPropagation()});var s=function(l){var a=o.table.rowManager.prevDisplayRow(t);if(a){o.startRow=a;o._mouseDown(l,a,n)}};n.addEventListener("mousedown",s);n.addEventListener("touchstart",s,{passive:!0});l.appendChild(a);l.appendChild(n)};Y.prototype._mouseDown=function(t,o,l){var r=this;r.table.element.classList.add("tabulator-block-select");function a(t){o.setHeight(r.startHeight+(("undefined"==typeof t.screenY?t.touches[0].screenY:t.screenY)-r.startY))}function n(){document.body.removeEventListener("mouseup",a);document.body.removeEventListener("mousemove",a);l.removeEventListener("touchmove",a);l.removeEventListener("touchend",n);r.table.element.classList.remove("tabulator-block-select");r.table.options.rowResized.call(this.table,o.getComponent())}t.stopPropagation();r.startY="undefined"==typeof t.screenY?t.touches[0].screenY:t.screenY;r.startHeight=o.getHeight();document.body.addEventListener("mousemove",a);document.body.addEventListener("mouseup",n);l.addEventListener("touchmove",a,{passive:!0});l.addEventListener("touchend",n)};u.prototype.registerModule("resizeRows",Y);var K=function(t){this.table=t;this.binding=!1;this.observer=!1;this.containerObserver=!1;this.tableHeight=0;this.tableWidth=0;this.containerHeight=0;this.containerWidth=0;this.autoResize=!1};K.prototype.initialize=function(){var t=this,o=this.table,l;this.tableHeight=o.element.clientHeight;this.tableWidth=o.element.clientWidth;if(o.element.parentNode){this.containerHeight=o.element.parentNode.clientHeight;this.containerWidth=o.element.parentNode.clientWidth}if("undefined"!=typeof ResizeObserver&&"virtual"===o.rowManager.getRenderMode()){this.autoResize=!0;this.observer=new ResizeObserver(function(l){if(!o.browserMobile||o.browserMobile&&!o.modules.edit.currentCell){var a=Math.floor(l[0].contentRect.height),n=Math.floor(l[0].contentRect.width);if(t.tableHeight!=a||t.tableWidth!=n){t.tableHeight=a;t.tableWidth=n;if(o.element.parentNode){t.containerHeight=o.element.parentNode.clientHeight;t.containerWidth=o.element.parentNode.clientWidth}if(o.options.virtualDomHoz){o.vdomHoz.reinitialize(!0)}o.redraw()}}});this.observer.observe(o.element);l=window.getComputedStyle(o.element);if(this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(l.getPropertyValue("max-height")||l.getPropertyValue("min-height"))){this.containerObserver=new ResizeObserver(function(l){if(!o.browserMobile||o.browserMobile&&!o.modules.edit.currentCell){var a=Math.floor(l[0].contentRect.height),n=Math.floor(l[0].contentRect.width);if(t.containerHeight!=a||t.containerWidth!=n){t.containerHeight=a;t.containerWidth=n;t.tableHeight=o.element.clientHeight;t.tableWidth=o.element.clientWidth}if(o.options.virtualDomHoz){o.vdomHoz.reinitialize(!0)}o.redraw()}});this.containerObserver.observe(this.table.element.parentNode)}}else{this.binding=function(){if(!o.browserMobile||o.browserMobile&&!o.modules.edit.currentCell){if(o.options.virtualDomHoz){o.vdomHoz.reinitialize(!0)}o.redraw()}};window.addEventListener("resize",this.binding)}};K.prototype.clearBindings=function(){if(this.binding){window.removeEventListener("resize",this.binding)}if(this.observer){this.observer.unobserve(this.table.element)}if(this.containerObserver){this.containerObserver.unobserve(this.table.element.parentNode)}};u.prototype.registerModule("resizeTable",K);var X=function(t){this.table=t;this.columns=[];this.hiddenColumns=[];this.mode="";this.index=0;this.collapseFormatter=[];this.collapseStartOpen=!0;this.collapseHandleColumn=!1};X.prototype.initialize=function(){var t=this,o=[];this.mode=this.table.options.responsiveLayout;this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData;this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen;this.hiddenColumns=[];this.table.columnManager.columnsByIndex.forEach(function(l,a){if(l.modules.responsive){if(l.modules.responsive.order&&l.modules.responsive.visible){l.modules.responsive.index=a;o.push(l);if(!l.visible&&"collapse"===t.mode){t.hiddenColumns.push(l)}}}});o=o.reverse();o=o.sort(function(t,o){var l=o.modules.responsive.order-t.modules.responsive.order;return l||o.modules.responsive.index-t.modules.responsive.index});this.columns=o;if("collapse"===this.mode){this.generateCollapsedContent()}for(var l=this.table.columnManager.columnsByIndex,a=Array.isArray(l),n=0,l=a?l:l[Symbol.iterator]();;){var r;if(a){if(n>=l.length)break;r=l[n++]}else{n=l.next();if(n.done)break;r=n.value}var s=r;if("responsiveCollapse"==s.definition.formatter){this.collapseHandleColumn=s;break}}if(this.collapseHandleColumn){if(this.hiddenColumns.length){this.collapseHandleColumn.show()}else{this.collapseHandleColumn.hide()}}};X.prototype.initializeColumn=function(t){var o=t.getDefinition();t.modules.responsive={order:"undefined"==typeof o.responsive?1:o.responsive,visible:!1===o.visible?!1:!0}};X.prototype.initializeRow=function(t){var o;if("calc"!==t.type){o=document.createElement("div");o.classList.add("tabulator-responsive-collapse");t.modules.responsiveLayout={element:o,open:this.collapseStartOpen};if(!this.collapseStartOpen){o.style.display="none"}}};X.prototype.layoutRow=function(t){var o=t.getElement();if(t.modules.responsiveLayout){o.appendChild(t.modules.responsiveLayout.element);this.generateCollapsedRowContent(t)}};X.prototype.updateColumnVisibility=function(t,o){if(t.modules.responsive){t.modules.responsive.visible=o;this.initialize()}};X.prototype.hideColumn=function(t){var o=this.hiddenColumns.length;t.hide(!1,!0);if("collapse"===this.mode){this.hiddenColumns.unshift(t);this.generateCollapsedContent();if(this.collapseHandleColumn&&!o){this.collapseHandleColumn.show()}}};X.prototype.showColumn=function(t){var o;t.show(!1,!0);t.setWidth(t.getWidth());if("collapse"===this.mode){o=this.hiddenColumns.indexOf(t);if(-1<o){this.hiddenColumns.splice(o,1)}this.generateCollapsedContent();if(this.collapseHandleColumn&&!this.hiddenColumns.length){this.collapseHandleColumn.hide()}}};X.prototype.update=function(){var t=this,o=!0;while(o){var l="fitColumns"==t.table.modules.layout.getMode()?t.table.columnManager.getFlexBaseWidth():t.table.columnManager.getWidth(),a=(t.table.options.headerVisible?t.table.columnManager.element.clientWidth:t.table.element.clientWidth)-l;if(0>a){var n=t.columns[t.index];if(n){t.hideColumn(n);t.index++}else{o=!1}}else{var r=t.columns[t.index-1];if(r){if(0<a){if(a>=r.getWidth()){t.showColumn(r);t.index--}else{o=!1}}else{o=!1}}else{o=!1}}if(!t.table.rowManager.activeRowsCount){t.table.rowManager.renderEmptyScroll()}}};X.prototype.generateCollapsedContent=function(){var t=this,o=this.table.rowManager.getDisplayRows();o.forEach(function(o){t.generateCollapsedRowContent(o)})};X.prototype.generateCollapsedRowContent=function(t){var o,l;if(t.modules.responsiveLayout){o=t.modules.responsiveLayout.element;while(o.firstChild){o.removeChild(o.firstChild)}l=this.collapseFormatter(this.generateCollapsedRowData(t));if(l){o.appendChild(l)}}};X.prototype.generateCollapsedRowData=function(t){var o=this,l=t.getData(),a=[],n;this.hiddenColumns.forEach(function(r){var s=r.getFieldValue(l);if(r.definition.title&&r.field){if(r.modules.format&&o.table.options.responsiveLayoutCollapseUseFormatters){n={value:!1,data:{},getValue:function(){return s},getData:function(){return l},getElement:function(){return document.createElement("div")},getRow:function(){return t.getComponent()},getColumn:function(){return r.getComponent()}};a.push({field:r.field,title:r.definition.title,value:r.modules.format.formatter.call(o.table.modules.format,n,r.modules.format.params)})}else{a.push({field:r.field,title:r.definition.title,value:s})}}});return a};X.prototype.formatCollapsedData=function(t){var o=document.createElement("table");t.forEach(function(t){var l=document.createElement("tr"),a=document.createElement("td"),n=document.createElement("td"),r,s=document.createElement("strong");a.appendChild(s);this.table.modules.localize.bind("columns|"+t.field,function(o){s.innerText=o||t.title});if(t.value instanceof Node){r=document.createElement("div");r.appendChild(t.value);n.appendChild(r)}else{n.innerHTML=t.value}l.appendChild(a);l.appendChild(n);o.appendChild(l)},this);return Object.keys(t).length?o:""};u.prototype.registerModule("responsiveLayout",X);var q=function(t){this.table=t;this.selecting=!1;this.lastClickedRow=!1;this.selectPrev=[];this.selectedRows=[];this.headerCheckboxElement=null};q.prototype.clearSelectionData=function(t){this.selecting=!1;this.lastClickedRow=!1;this.selectPrev=[];this.selectedRows=[];if(!t){this._rowSelectionChanged()}};q.prototype.initializeRow=function(t){var o=this,l=t.getElement(),a=function t(){setTimeout(function(){o.selecting=!1},50);document.body.removeEventListener("mouseup",t)};t.modules.select={selected:!1};if(o.table.options.selectableCheck.call(this.table,t.getComponent())){l.classList.add("tabulator-selectable");l.classList.remove("tabulator-unselectable");if(o.table.options.selectable&&"highlight"!=o.table.options.selectable){if("click"===o.table.options.selectableRangeMode){l.addEventListener("click",function(l){if(l.shiftKey){o.table._clearSelection();o.lastClickedRow=o.lastClickedRow||t;var a=o.table.rowManager.getDisplayRowIndex(o.lastClickedRow),n=o.table.rowManager.getDisplayRowIndex(t),r=a<=n?a:n,s=a>=n?a:n,d=o.table.rowManager.getDisplayRows().slice(0),p=d.splice(r,s-r+1);if(l.ctrlKey||l.metaKey){p.forEach(function(l){if(l!==o.lastClickedRow){if(!0!==o.table.options.selectable&&!o.isRowSelected(t)){if(o.selectedRows.length<o.table.options.selectable){o.toggleRow(l)}}else{o.toggleRow(l)}}});o.lastClickedRow=t}else{o.deselectRows(void 0,!0);if(!0!==o.table.options.selectable){if(p.length>o.table.options.selectable){p=p.slice(0,o.table.options.selectable)}}o.selectRows(p)}o.table._clearSelection()}else if(l.ctrlKey||l.metaKey){o.toggleRow(t);o.lastClickedRow=t}else{o.deselectRows(void 0,!0);o.selectRows(t);o.lastClickedRow=t}})}else{l.addEventListener("click",function(){if(!o.table.modExists("edit")||!o.table.modules.edit.getCurrentCell()){o.table._clearSelection()}if(!o.selecting){o.toggleRow(t)}});l.addEventListener("mousedown",function(l){if(l.shiftKey){o.table._clearSelection();o.selecting=!0;o.selectPrev=[];document.body.addEventListener("mouseup",a);document.body.addEventListener("keyup",a);o.toggleRow(t);return!1}});l.addEventListener("mouseenter",function(){if(o.selecting){o.table._clearSelection();o.toggleRow(t);if(o.selectPrev[1]==t){o.toggleRow(o.selectPrev[0])}}});l.addEventListener("mouseout",function(){if(o.selecting){o.table._clearSelection();o.selectPrev.unshift(t)}})}}}else{l.classList.add("tabulator-unselectable");l.classList.remove("tabulator-selectable")}};q.prototype.toggleRow=function(t){if(this.table.options.selectableCheck.call(this.table,t.getComponent())){if(t.modules.select&&t.modules.select.selected){this._deselectRow(t)}else{this._selectRow(t)}}};q.prototype.selectRows=function(t){var o=this,l;switch("undefined"==typeof t?"undefined":_typeof(t)){case"undefined":this.table.rowManager.rows.forEach(function(t){o._selectRow(t,!0,!0)});this._rowSelectionChanged();break;case"string":l=this.table.rowManager.findRow(t);if(l){this._selectRow(l,!0,!0)}else{this.table.rowManager.getRows(t).forEach(function(t){o._selectRow(t,!0,!0)})}this._rowSelectionChanged();break;default:if(Array.isArray(t)){t.forEach(function(t){o._selectRow(t,!0,!0)});this._rowSelectionChanged()}else{this._selectRow(t,!1,!0)}break;}};q.prototype._selectRow=function(t,o,l){if(!isNaN(this.table.options.selectable)&&!0!==this.table.options.selectable&&!l){if(this.selectedRows.length>=this.table.options.selectable){if(this.table.options.selectableRollingSelection){this._deselectRow(this.selectedRows[0])}else{return!1}}}var a=this.table.rowManager.findRow(t);if(a){if(-1==this.selectedRows.indexOf(a)){a.getElement().classList.add("tabulator-selected");if(!a.modules.select){a.modules.select={}}a.modules.select.selected=!0;if(a.modules.select.checkboxEl){a.modules.select.checkboxEl.checked=!0}this.selectedRows.push(a);if(this.table.options.dataTreeSelectPropagate){this.childRowSelection(a,!0)}if(!o){this.table.options.rowSelected.call(this.table,a.getComponent())}this._rowSelectionChanged(o)}}else{if(!o){console.warn("Selection Error - No such row found, ignoring selection:"+t)}}};q.prototype.isRowSelected=function(t){return-1!==this.selectedRows.indexOf(t)};q.prototype.deselectRows=function(t,o){var l=this,a;if("undefined"==typeof t){a=l.selectedRows.length;for(var n=0;n<a;n++){l._deselectRow(l.selectedRows[0],!0)}l._rowSelectionChanged(o)}else{if(Array.isArray(t)){t.forEach(function(t){l._deselectRow(t,!0)});l._rowSelectionChanged(o)}else{l._deselectRow(t,o)}}};q.prototype._deselectRow=function(t,o){var l=this,a=l.table.rowManager.findRow(t),n;if(a){n=l.selectedRows.findIndex(function(t){return t==a});if(-1<n){a.getElement().classList.remove("tabulator-selected");if(!a.modules.select){a.modules.select={}}a.modules.select.selected=!1;if(a.modules.select.checkboxEl){a.modules.select.checkboxEl.checked=!1}l.selectedRows.splice(n,1);if(this.table.options.dataTreeSelectPropagate){this.childRowSelection(a,!1)}if(!o){l.table.options.rowDeselected.call(this.table,a.getComponent())}l._rowSelectionChanged(o)}}else{if(!o){console.warn("Deselection Error - No such row found, ignoring selection:"+t)}}};q.prototype.getSelectedData=function(){var t=[];this.selectedRows.forEach(function(o){t.push(o.getData())});return t};q.prototype.getSelectedRows=function(){var t=[];this.selectedRows.forEach(function(o){t.push(o.getComponent())});return t};q.prototype._rowSelectionChanged=function(t){if(this.headerCheckboxElement){if(0===this.selectedRows.length){this.headerCheckboxElement.checked=!1;this.headerCheckboxElement.indeterminate=!1}else if(this.table.rowManager.rows.length===this.selectedRows.length){this.headerCheckboxElement.checked=!0;this.headerCheckboxElement.indeterminate=!1}else{this.headerCheckboxElement.indeterminate=!0;this.headerCheckboxElement.checked=!1}}if(!t){this.table.options.rowSelectionChanged.call(this.table,this.getSelectedData(),this.getSelectedRows())}};q.prototype.registerRowSelectCheckbox=function(t,o){if(!t._row.modules.select){t._row.modules.select={}}t._row.modules.select.checkboxEl=o};q.prototype.registerHeaderSelectCheckbox=function(t){this.headerCheckboxElement=t};q.prototype.childRowSelection=function(t,o){var l=this.table.modules.dataTree.getChildren(t,!0);if(o){for(var a=l,n=Array.isArray(a),r=0,a=n?a:a[Symbol.iterator]();;){var s;if(n){if(r>=a.length)break;s=a[r++]}else{r=a.next();if(r.done)break;s=r.value}var d=s;this._selectRow(d,!0)}}else{for(var p=l,c=Array.isArray(p),u=0,p=c?p:p[Symbol.iterator]();;){var m;if(c){if(u>=p.length)break;m=p[u++]}else{u=p.next();if(u.done)break;m=u.value}var g=m;this._deselectRow(g,!0)}}};u.prototype.registerModule("selectRow",q);var J=function(t){this.table=t;this.sortList=[];this.changed=!1};J.prototype.initializeColumn=function(t,o){var l=this,a=!1,n,r;switch(_typeof(t.definition.sorter)){case"string":if(l.sorters[t.definition.sorter]){a=l.sorters[t.definition.sorter]}else{console.warn("Sort Error - No such sorter found: ",t.definition.sorter)}break;case"function":a=t.definition.sorter;break;}t.modules.sort={sorter:a,dir:"none",params:t.definition.sorterParams||{},startingDir:t.definition.headerSortStartingDir||"asc",tristate:"undefined"!=typeof t.definition.headerSortTristate?t.definition.headerSortTristate:this.table.options.headerSortTristate};if("undefined"==typeof t.definition.headerSort?!1!==this.table.options.headerSort:!1!==t.definition.headerSort){n=t.getElement();n.classList.add("tabulator-sortable");r=document.createElement("div");r.classList.add("tabulator-col-sorter");if("object"==_typeof(this.table.options.headerSortElement)){r.appendChild(this.table.options.headerSortElement)}else{r.innerHTML=this.table.options.headerSortElement}o.appendChild(r);t.modules.sort.element=r;n.addEventListener("click",function(o){var a="",n=[],r=!1;if(t.modules.sort){if(t.modules.sort.tristate){if("none"==t.modules.sort.dir){a=t.modules.sort.startingDir}else{if(t.modules.sort.dir==t.modules.sort.startingDir){a="asc"==t.modules.sort.dir?"desc":"asc"}else{a="none"}}}else{switch(t.modules.sort.dir){case"asc":a="desc";break;case"desc":a="asc";break;default:a=t.modules.sort.startingDir;}}if(l.table.options.columnHeaderSortMulti&&(o.shiftKey||o.ctrlKey)){n=l.getSort();r=n.findIndex(function(o){return o.field===t.getField()});if(-1<r){n[r].dir=a;if(r!=n.length-1){r=n.splice(r,1)[0];if("none"!=a){n.push(r)}}}else{if("none"!=a){n.push({column:t,dir:a})}}l.setSort(n)}else{if("none"==a){l.clear()}else{l.setSort(t,a)}}l.table.rowManager.sorterRefresh(!l.sortList.length)}})}};J.prototype.hasChanged=function(){var t=this.changed;this.changed=!1;return t};J.prototype.getSort=function(){var t=this,o=[];t.sortList.forEach(function(t){if(t.column){o.push({column:t.column.getComponent(),field:t.column.getField(),dir:t.dir})}});return o};J.prototype.setSort=function(t,o){var l=this,a=[];if(!Array.isArray(t)){t=[{column:t,dir:o}]}t.forEach(function(t){var o=l.table.columnManager.findColumn(t.column);if(o){t.column=o;a.push(t);l.changed=!0}else{console.warn("Sort Warning - Sort field does not exist and is being ignored: ",t.column)}});l.sortList=a;if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.sort){this.table.modules.persistence.save("sort")}};J.prototype.clear=function(){this.setSort([])};J.prototype.findSorter=function(t){var o=this.table.rowManager.activeRows[0],l="string",a,n;if(o){o=o.getData();a=t.getField();if(a){n=t.getFieldValue(o);switch("undefined"==typeof n?"undefined":_typeof(n)){case"undefined":l="string";break;case"boolean":l="boolean";break;default:if(!isNaN(n)&&""!==n){l="number"}else{if(n.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)){l="alphanum"}}break;}}}return this.sorters[l]};J.prototype.sort=function(t){var o=this,l=this.table.options.sortOrderReverse?o.sortList.slice().reverse():o.sortList,a=[],n=[];if(o.table.options.dataSorting){o.table.options.dataSorting.call(o.table,o.getSort())}o.clearColumnHeaders();if(!o.table.options.ajaxSorting){l.forEach(function(t){var l=t.column.modules.sort;if(t.column&&l){if(!l.sorter){l.sorter=o.findSorter(t.column)}t.params="function"==typeof l.params?l.params(t.column.getComponent(),t.dir):l.params;a.push(t)}o.setColumnHeader(t.column,t.dir)});if(a.length){o._sortItems(t,a)}}else{l.forEach(function(t){o.setColumnHeader(t.column,t.dir)})}if(o.table.options.dataSorted){t.forEach(function(t){n.push(t.getComponent())});o.table.options.dataSorted.call(o.table,o.getSort(),n)}};J.prototype.clearColumnHeaders=function(){this.table.columnManager.getRealColumns().forEach(function(t){if(t.modules.sort){t.modules.sort.dir="none";t.getElement().setAttribute("aria-sort","none")}})};J.prototype.setColumnHeader=function(t,o){t.modules.sort.dir=o;t.getElement().setAttribute("aria-sort",o)};J.prototype._sortItems=function(t,o){var l=this,n=o.length-1;t.sort(function(t,a){for(var r,s=n,d;0<=s;s--){d=o[s];r=l._sortRow(t,a,d.column,d.dir,d.params);if(0!==r){break}}return r})};J.prototype._sortRow=function(t,o,l,n,r){var s,d,p="asc"==n?t:o,c="asc"==n?o:t;t=l.getFieldValue(p.getData());o=l.getFieldValue(c.getData());t="undefined"!=typeof t?t:"";o="undefined"!=typeof o?o:"";s=p.getComponent();d=c.getComponent();return l.modules.sort.sorter.call(this,t,o,s,d,l.getComponent(),n,r)};J.prototype.sorters={number:function(t,o,l,n,r,s,d){var p=d.alignEmptyValues,c=d.decimalSeparator,u=d.thousandSeparator,m=0;t=t+"";o=o+"";if(u){t=t.split(u).join("");o=o.split(u).join("")}if(c){t=t.split(c).join(".");o=o.split(c).join(".")}t=parseFloat(t);o=parseFloat(o);if(isNaN(t)){m=isNaN(o)?0:-1}else if(isNaN(o)){m=1}else{return t-o}if("top"===p&&"desc"===s||"bottom"===p&&"asc"===s){m*=-1}return m},string:function(t,o,l,a,n,r,s){var d=s.alignEmptyValues,p=0,c;if(!t){p=!o?0:-1}else if(!o){p=1}else{switch(_typeof(s.locale)){case"boolean":if(s.locale){c=this.table.modules.localize.getLocale()}break;case"string":c=s.locale;break;}return(t+"").toLowerCase().localeCompare((o+"").toLowerCase(),c)}if("top"===d&&"desc"===r||"bottom"===d&&"asc"===r){p*=-1}return p},date:function(t,o,l,a,n,r,s){if(!s.format){s.format="DD/MM/YYYY"}return this.sorters.datetime.call(this,t,o,l,a,n,r,s)},time:function(t,o,l,a,n,r,s){if(!s.format){s.format="HH:mm"}return this.sorters.datetime.call(this,t,o,l,a,n,r,s)},datetime:function(t,o,l,n,r,s,d){var p=d.format||"DD/MM/YYYY HH:mm:ss",c=d.alignEmptyValues,u=0;if("undefined"!=typeof moment){t=moment(t,p);o=moment(o,p);if(!t.isValid()){u=!o.isValid()?0:-1}else if(!o.isValid()){u=1}else{return t-o}if("top"===c&&"desc"===s||"bottom"===c&&"asc"===s){u*=-1}return u}else{console.error("Sort Error - 'datetime' sorter is dependant on moment.js")}},boolean:function(t,o){var l=!0===t||"true"===t||"True"===t||1===t?1:0,a=!0===o||"true"===o||"True"===o||1===o?1:0;return l-a},array:function(t,o,l,a,n,r,s){var p=0,c=0,u=s.type||"length",m=s.alignEmptyValues,g=0;function d(t){switch(u){case"length":return t.length;break;case"sum":return t.reduce(function(t,o){return t+o});break;case"max":return Math.max.apply(null,t);break;case"min":return Math.min.apply(null,t);break;case"avg":return t.reduce(function(t,o){return t+o})/t.length;break;}}if(!Array.isArray(t)){m=!Array.isArray(o)?0:-1}else if(!Array.isArray(o)){m=1}else{p=t?d(t):0;c=o?d(o):0;return p-c}if("top"===m&&"desc"===r||"bottom"===m&&"asc"===r){g*=-1}return g},exists:function(t,o){var l="undefined"==typeof t?0:1,a="undefined"==typeof o?0:1;return l-a},alphanum:function(t,o,l,n,r,s,d){var p,c,u,m,g=0,h,f=/(\d+)|(\D+)/g,y=/\d/,w=d.alignEmptyValues,v=0;if(!t&&0!==t){v=!o&&0!==o?0:-1}else if(!o&&0!==o){v=1}else{if(isFinite(t)&&isFinite(o))return t-o;p=(t+"").toLowerCase();c=(o+"").toLowerCase();if(p===c)return 0;if(!(y.test(p)&&y.test(c)))return p>c?1:-1;p=p.match(f);c=c.match(f);h=p.length>c.length?c.length:p.length;while(g<h){u=p[g];m=c[g++];if(u!==m){if(isFinite(u)&&isFinite(m)){if("0"===u.charAt(0))u="."+u;if("0"===m.charAt(0))m="."+m;return u-m}else return u>m?1:-1}}return p.length>c.length}if("top"===w&&"desc"===s||"bottom"===w&&"asc"===s){v*=-1}return v}};u.prototype.registerModule("sort",J);var $=function(t){this.table=t;this.invalidCells=[]};$.prototype.initializeColumn=function(t){var o=this,l=[],a;if(t.definition.validator){if(Array.isArray(t.definition.validator)){t.definition.validator.forEach(function(t){a=o._extractValidator(t);if(a){l.push(a)}})}else{a=this._extractValidator(t.definition.validator);if(a){l.push(a)}}t.modules.validate=l.length?l:!1}};$.prototype._extractValidator=function(t){var o,l,a;switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":a=t.indexOf(":");if(-1<a){o=t.substring(0,a);l=t.substring(a+1)}else{o=t}return this._buildValidator(o,l);break;case"function":return this._buildValidator(t);break;case"object":return this._buildValidator(t.type,t.parameters);break;}};$.prototype._buildValidator=function(t,o){var l="function"==typeof t?t:this.validators[t];if(!l){console.warn("Validator Setup Error - No matching validator found:",t);return!1}else{return{type:"function"==typeof t?"function":t,func:l,params:o}}};$.prototype.validate=function(t,o,l){var a=this,n=[],r=this.invalidCells.indexOf(o);if(t){t.forEach(function(t){if(!t.func.call(a,o.getComponent(),l,t.params)){n.push({type:t.type,parameters:t.params})}})}n=n.length?n:!0;if(!o.modules.validate){o.modules.validate={}}if(!0===n){o.modules.validate.invalid=!1;o.getElement().classList.remove("tabulator-validation-fail");if(-1<r){this.invalidCells.splice(r,1)}}else{o.modules.validate.invalid=!0;if("manual"!==this.table.options.validationMode){o.getElement().classList.add("tabulator-validation-fail")}if(-1==r){this.invalidCells.push(o)}}return n};$.prototype.getInvalidCells=function(){var t=[];this.invalidCells.forEach(function(o){t.push(o.getComponent())});return t};$.prototype.clearValidation=function(t){var o;if(t.modules.validate&&t.modules.validate.invalid){t.getElement().classList.remove("tabulator-validation-fail");t.modules.validate.invalid=!1;o=this.invalidCells.indexOf(t);if(-1<o){this.invalidCells.splice(o,1)}}};$.prototype.validators={integer:function(t,o){if(""===o||null===o||"undefined"==typeof o){return!0}o=+o;return"number"==typeof o&&isFinite(o)&&Math.floor(o)===o},float:function(t,o){if(""===o||null===o||"undefined"==typeof o){return!0}o=+o;return"number"==typeof o&&isFinite(o)&&0!=o%1},numeric:function(t,o){if(""===o||null===o||"undefined"==typeof o){return!0}return!isNaN(o)},string:function(t,o){if(""===o||null===o||"undefined"==typeof o){return!0}return isNaN(o)},max:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return parseFloat(o)<=l},min:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return parseFloat(o)>=l},starts:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return(o+"").toLowerCase().startsWith((l+"").toLowerCase())},ends:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return(o+"").toLowerCase().endsWith((l+"").toLowerCase())},minLength:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return(o+"").length>=l},maxLength:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return(o+"").length<=l},in:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}if("string"==typeof l){l=l.split("|")}return""===o||-1<l.indexOf(o)},regex:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}var a=new RegExp(l);return a.test(o)},unique:function t(o,l){if(""===l||null===l||"undefined"==typeof l){return!0}var t=!0,a=o.getData(),n=o.getColumn()._getSelf();this.table.rowManager.rows.forEach(function(o){var r=o.getData();if(r!==a){if(l==n.getFieldValue(r)){t=!1}}});return t},required:function(t,o){return""!==o&&null!==o&&"undefined"!=typeof o}};u.prototype.registerModule("validate",$);return u});
function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("block_opencast/block_manage_series",["exports","block_opencast/tabulator","jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/templates","core/notification"],function(a,b,c,d,f,g,h,i,j,k){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=n(b);c=n(c);d=m(d);f=n(f);g=n(g);h=n(h);i=n(i);j=n(j);k=n(k);function l(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;l=function(){return a};return a}function m(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=l();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function n(a){return a&&a.__esModule?a:{default:a}}function o(a,b,c,d){if("undefined"==typeof d){d=""}var e={ocinstanceid:b,seriesid:c,jsonformdata:d};return h.default.loadFragment("block_opencast","series_form",a,e)}function p(a){a.preventDefault();var b=a.data.modal,d=a.data.contextid,e=window.seriestable,f=a.data.edited,g=a.data.numseriesallowed,h=document.createEvent("HTMLEvents");h.initEvent("change",!0,!0);b.getRoot().find(":input").each(function(a,b){b.dispatchEvent(h)});var j=c.default.merge(b.getRoot().find("[aria-invalid=\"true\"]"),b.getRoot().find(".error"));if(j.length){j.first().focus();return}var k=b.getRoot().find("form").serialize(),l=(0,c.default)(".modal #id_title").val();i.default.call([{methodname:"block_opencast_submit_series_form",args:{contextid:d,ocinstanceid:a.data.ocinstanceid,seriesid:a.data.seriesid,jsonformdata:k},done:function done(d){b.destroy();if(f){var i=e.getRows().find(function(b){return b.getData().series===a.data.seriesid});i.update({seriesname:l})}else{var h=JSON.parse(d);e.addRow({seriesname:h.seriestitle,series:h.series,isdefault:h.isdefault});if(e.getRows().length>=g){(0,c.default)("#createseries").hide();(0,c.default)("#importseries").hide()}}},fail:function fail(c){if("metadataseriesupdatefailed"===c.errorcode){b.destroy();q(c.message)}else{b.setBody(o(d,a.data.ocinstanceid,a.data.seriesid,k))}}}])}function q(a){j.default.render("core/notification_error",{announce:!0,closebutton:!0,extraclasses:"",message:a}).then(function(a){(0,c.default)("#user-notifications").append(a)}).fail(function(){k.default.alert(a,a)})}function r(a,b,c,d,e){i.default.call([{methodname:"block_opencast_get_series_titles",args:{contextid:a,ocinstanceid:b,series:JSON.stringify(c)},done:function done(a){var b=JSON.parse(a);if(null!==d){d.getRows().forEach(function(a){a.update({seriesname:b[a.getData().series]})})}else{e.update({seriesname:b[e.getData().series]})}},fail:function fail(a){if(null!==d){d.getRows().forEach(function(b){b.update({seriesname:a.message})})}else{e.update({seriesname:a.message})}}}])}var s=function(a,h){d.get_strings([{key:"seriesname",component:"block_opencast"},{key:"form_seriesid",component:"block_opencast"},{key:"default",component:"block_opencast"},{key:"noconnectedseries",component:"block_opencast"},{key:"createseriesforcourse",component:"block_opencast"},{key:"delete_series",component:"block_opencast"},{key:"delete_confirm_series",component:"block_opencast"},{key:"editseries",component:"block_opencast"},{key:"delete",component:"moodle"},{key:"loading",component:"block_opencast"},{key:"importseries",component:"block_opencast"},{key:"importfailed",component:"block_opencast"},{key:"form_seriesid",component:"block_opencast"},{key:"setdefaultseries_heading",component:"block_opencast"},{key:"setdefaultseries",component:"block_opencast"}]).then(function(d){var e=(0,c.default)("#seriesinput"),k=(0,c.default)("#numseriesallowed").val(),l=new b.default("#seriestable",{data:JSON.parse(e.val()),layout:"fitColumns",placeholder:d[3],headerSort:!1,dataChanged:function dataChanged(a){a=a.filter(function(a){return a.series});a=a.reduce(function(a,b){a[b.series]=b.isdefault;return a},{});e.val(JSON.stringify(a))},dataLoaded:function dataLoaded(b){r(a,h,b.map(function(a){return a.series}),this)},columns:[{title:d[0],field:"seriesname",editable:!1},{title:d[1],field:"series",editable:!1},{title:d[2],field:"isdefault",hozAlign:"center",widthGrow:0,formatter:function formatter(b){var c=document.createElement("input");c.type="radio";c.name="defaultseries";c.checked=b.getValue();c.classList.add("ignoredirty");c.addEventListener("click",function(c){c.preventDefault();f.default.create({type:f.default.types.SAVE_CANCEL,title:d[13],body:d[14]}).then(function(c){c.getRoot().on(g.default.hidden,function(){c.destroy()}).bind(this);c.getRoot().on(g.default.save,function(){i.default.call([{methodname:"block_opencast_set_default_series",args:{contextid:a,ocinstanceid:h,seriesid:b.getRow().getData().series},done:function done(){c.destroy();b.getTable().getRows().forEach(function(a){if(a===b.getRow()){a.update({isdefault:1})}else{a.update({isdefault:0})}})},fail:function fail(a){c.destroy();q(a.message)}}])});c.show()})});return c}},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function formatter(){return"<i class=\"icon fa fa-edit fa-fw\"></i>"},cellClick:function cellClick(b,c){f.default.create({type:f.default.types.SAVE_CANCEL,title:d[7],body:o(a,h,c.getRow().getCell("series").getValue())}).then(function(b){b.setSaveButtonText(d[7]);b.setLarge();b.getRoot().on(g.default.hidden,function(){b.destroy()}).bind(this);b.getRoot().on(g.default.shown,function(){b.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>")}.bind(this));b.getRoot().on(g.default.save,function(a){a.preventDefault();b.getRoot().find("form").submit()});b.getRoot().on("submit","form",{modal:b,contextid:a,ocinstanceid:h,seriesid:c.getRow().getCell("series").getValue(),numseriesallowed:k,edited:!0},p);b.show()})}},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function formatter(){return"<i class=\"icon fa fa-trash fa-fw\"></i>"},cellClick:function cellClick(b,e){f.default.create({type:f.default.types.SAVE_CANCEL,title:d[5],body:d[6]}).then(function(b){b.setSaveButtonText(d[8]);b.getRoot().on(g.default.save,function(){i.default.call([{methodname:"block_opencast_unlink_series",args:{contextid:a,ocinstanceid:h,seriesid:e.getRow().getData().series},done:function done(a){b.destroy();var d=JSON.parse(a);if(d.error){q(d.message)}else{e.getRow().delete();(0,c.default)("#createseries").show();(0,c.default)("#createseries").removeClass("d-none");(0,c.default)("#importseries").show();(0,c.default)("#importseries").removeClass("d-none")}},fail:function fail(a){b.destroy();q(a.message)}}])});b.show()})}}]});window.seriestable=l;(0,c.default)("#createseries").click(function(){f.default.create({type:f.default.types.SAVE_CANCEL,title:d[4],body:o(a,h,"")}).then(function(b){b.setSaveButtonText(d[4]);b.setLarge();b.getRoot().on(g.default.hidden,function(){b.destroy()}).bind(this);b.getRoot().on(g.default.shown,function(){b.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>")}.bind(this));b.getRoot().on(g.default.save,function(a){a.preventDefault();b.getRoot().find("form").submit()});b.getRoot().on("submit","form",{modal:b,contextid:a,ocinstanceid:h,seriesid:"",numseriesallowed:k,edited:!1},p);b.show()})});(0,c.default)("#importseries").click(function(){var b={label:d[12],required:!1,advanced:!1,element:{wrapperid:"importseriesid_wrapper",name:"importseriesid",id:"importseriesid",type:"text",size:40,value:""}};f.default.create({type:f.default.types.SAVE_CANCEL,title:d[10],body:j.default.render("core_form/element-text",b)}).then(function(b){b.setSaveButtonText(d[10]);b.setLarge();b.getRoot().on(g.default.hidden,function(){b.destroy()}).bind(this);b.getRoot().on(g.default.save,function(f){f.preventDefault();var e=(0,c.default)("#importseriesid").val();i.default.call([{methodname:"block_opencast_import_series",args:{contextid:a,ocinstanceid:h,seriesid:e},done:function done(a){b.destroy();if(l!==void 0){var d=JSON.parse(a);l.addRow({seriesname:d.title,series:d.id,isdefault:d.isdefault});if(l.getRows().length>=k){(0,c.default)("#createseries").hide();(0,c.default)("#importseries").hide()}}},fail:function fail(){b.destroy();q(d[11])}}])});b.show()})})})};a.init=s});
/**
 * Javascript to initialise the Recently accessed courses block.
 *
 * @module     block_recentlyaccessedcourses/main.js
 * @package    block_recentlyaccessedcourses
 * @copyright  2018 Victor Deniz <victor@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_recentlyaccessedcourses/main",["jquery","core/custom_interaction_events","core/notification","core/pubsub","core/paged_content_paging_bar","core/templates","core_course/events","core_course/repository"],(function($,CustomEvents,Notification,PubSub,PagedContentPagingBar,Templates,CourseEvents,CoursesRepository){var SELECTORS_BLOCK_CONTAINER='[data-region="recentlyaccessedcourses"]',SELECTORS_CARD_CONTAINER='[data-region="card-deck"]',SELECTORS_COURSE_IS_FAVOURITE='[data-region="is-favourite"]',SELECTORS_CONTENT='[data-region="view-content"]',SELECTORS_EMPTY_MESSAGE='[data-region="empty-message"]',SELECTORS_LOADING_PLACEHOLDER='[data-region="loading-placeholder"]',SELECTORS_PAGING_BAR='[data-region="paging-bar"]',SELECTORS_PAGING_BAR_NEXT='[data-control="next"]',SELECTORS_PAGING_BAR_PREVIOUS='[data-control="previous"]',contentLoaded=!1,allCourses=[],visibleCoursesId=null,cardWidth=null,viewIndex=0,availableVisibleCards=1,loadContent=function(userid){return CoursesRepository.getLastAccessedCourses(userid,10).then((function(courses){return function(courses){var showcoursecategory=$(SELECTORS_BLOCK_CONTAINER).data("displaycoursecategory"),promises=courses.map((function(course){return course.showcoursecategory=showcoursecategory,Templates.render("block_recentlyaccessedcourses/course-card",course)}));return $.when.apply(null,promises).then((function(){var renderedCourses=[];return promises.forEach((function(promise){promise.then((function(html){renderedCourses.push($(html))})).catch(Notification.exception)})),renderedCourses}))}(courses)}))},recalculateVisibleCourses=function(root){var container=root.find(SELECTORS_CONTENT).find(SELECTORS_CARD_CONTAINER),availableWidth=parseFloat(root.css("width")),numberOfCourses=allCourses.length,start=0;(cardWidth||(container.html(allCourses[0]),cardWidth=allCourses[0].outerWidth(!0)),availableVisibleCards=Math.floor(availableWidth/cardWidth),viewIndex+availableVisibleCards<numberOfCourses)?start=viewIndex:start=(start=viewIndex-(viewIndex+availableVisibleCards-numberOfCourses))>=0?start:0;0===availableVisibleCards&&(availableVisibleCards=1);var coursesToShow=allCourses.slice(start,start+availableVisibleCards),newVisibleCoursesId=coursesToShow.reduce((function(carry,course){return carry+course.attr("data-course-id")}),"");if(allCourses.length>coursesToShow.length?(container.addClass("justify-content-center"),container.removeClass("justify-content-start")):(container.removeClass("justify-content-center"),container.addClass("justify-content-start")),visibleCoursesId!=newVisibleCoursesId){var pagingBar=root.find(PagedContentPagingBar.rootSelector);container.html(coursesToShow),visibleCoursesId=newVisibleCoursesId,availableVisibleCards>=allCourses.length?function(root){var pagingBar=root.find(SELECTORS_PAGING_BAR);pagingBar.css("opacity",0),pagingBar.css("visibility","hidden"),pagingBar.attr("aria-hidden","true")}(root):(!function(root){var pagingBar=root.find(SELECTORS_PAGING_BAR);pagingBar.css("opacity",1),pagingBar.css("visibility","visible"),pagingBar.attr("aria-hidden","false")}(root),0===viewIndex?PagedContentPagingBar.disablePreviousControlButtons(pagingBar):PagedContentPagingBar.enablePreviousControlButtons(pagingBar),viewIndex+availableVisibleCards>=allCourses.length?PagedContentPagingBar.disableNextControlButtons(pagingBar):PagedContentPagingBar.enableNextControlButtons(pagingBar))}},registerEventListeners=function(root){var resizeTimeout=null,drawerToggling=!1;PubSub.subscribe(CourseEvents.favourited,(function(courseId){!function(root,courseId){allCourses.forEach((function(course){course.attr("data-course-id")==courseId&&course.find(SELECTORS_COURSE_IS_FAVOURITE).removeClass("hidden")}))}(0,courseId)})),PubSub.subscribe(CourseEvents.unfavorited,(function(courseId){!function(root,courseId){allCourses.forEach((function(course){course.attr("data-course-id")==courseId&&course.find(SELECTORS_COURSE_IS_FAVOURITE).addClass("hidden")}))}(0,courseId)})),PubSub.subscribe("nav-drawer-toggle-start",(function(){if(contentLoaded&&allCourses.length&&!drawerToggling){drawerToggling=!0;var recalculationCount=0;!function doRecalculation(){setTimeout((function(){recalculateVisibleCourses(root),++recalculationCount<5&&drawerToggling&&doRecalculation()}),100)}()}})),PubSub.subscribe("nav-drawer-toggle-end",(function(){drawerToggling=!1})),$(window).on("resize",(function(){contentLoaded&&allCourses.length&&(resizeTimeout||(resizeTimeout=setTimeout((function(){resizeTimeout=null,recalculateVisibleCourses(root)}),66)))})),CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_PAGING_BAR_NEXT,(function(e,data){$(e.target).closest(SELECTORS_PAGING_BAR_NEXT).hasClass("disabled")||(viewIndex+=availableVisibleCards,recalculateVisibleCourses(root)),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_PAGING_BAR_PREVIOUS,(function(e,data){$(e.target).closest(SELECTORS_PAGING_BAR_PREVIOUS).hasClass("disabled")||(viewIndex=(viewIndex-=availableVisibleCards)<0?0:viewIndex,recalculateVisibleCourses(root)),data.originalEvent.preventDefault()}))};return{init:function(userid,root){root=$(root),registerEventListeners(root),loadContent(userid).then((function(renderedCourses){contentLoaded=!0,(allCourses=renderedCourses).length?(!function(root){root.find(SELECTORS_CONTENT).removeClass("hidden"),root.find(SELECTORS_EMPTY_MESSAGE).addClass("hidden"),root.find(SELECTORS_LOADING_PLACEHOLDER).addClass("hidden")}(root),recalculateVisibleCourses(root)):function(root){root.find(SELECTORS_EMPTY_MESSAGE).removeClass("hidden"),root.find(SELECTORS_LOADING_PLACEHOLDER).addClass("hidden"),root.find(SELECTORS_CONTENT).addClass("hidden")}(root)})).catch(Notification.exception)}}}));
/**
 * A javascript module to handle user ajax actions.
 *
 * @module     block_recentlyaccesseditems/repository
 * @package    block_recentlyaccesseditems
 * @copyright  2018 Victor Deniz <victor@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_recentlyaccesseditems/repository",["core/ajax"],(function(Ajax){return{getRecentItems:function(limit){var args={};void 0!==limit&&(args.limit=limit);var request={methodname:"block_recentlyaccesseditems_get_recent_items",args:args};return Ajax.call([request])[0]}}}));
/**
 * Javascript to initialise the Recently accessed items block.
 *
 * @module     block_recentlyaccesseditems/main
 * @package    block_recentlyaccesseditems
 * @copyright  2018 Victor Deniz <victor@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_recentlyaccesseditems/main",["jquery","block_recentlyaccesseditems/repository","core/templates","core/notification"],(function($,Repository,Templates,Notification){var SELECTORS_CARDDECK_CONTAINER='[data-region="recentlyaccesseditems-view"]',SELECTORS_CARDDECK='[data-region="recentlyaccesseditems-view-content"]';return{init:function(root){var limit,itemsContainer=(root=$(root)).find(SELECTORS_CARDDECK_CONTAINER),itemsContent=root.find(SELECTORS_CARDDECK),itemsPromise=(limit=9,Repository.getRecentItems(limit));itemsPromise.then((function(items){var pageContentPromise=function(root,items){if(items.length>0)return Templates.render("block_recentlyaccesseditems/view-cards",{items:items});var noitemsimgurl=root.attr("data-noitemsimgurl");return Templates.render("block_recentlyaccesseditems/no-items",{noitemsimgurl:noitemsimgurl})}(itemsContainer,items);return pageContentPromise.then((function(html,js){return Templates.replaceNodeContents(itemsContent,html,js)})).catch(Notification.exception),itemsPromise})).catch(Notification.exception)}}}));
/**
 * Load the settings block tree javscript
 *
 * @module     block_settings/settingsblock
 * @package    core
 * @copyright  2015 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_settings/settingsblock",["jquery","core/tree"],(function($,Tree){return{init:function(instanceid,siteAdminNodeId){var adminTree=new Tree(".block_settings .block_tree");if(siteAdminNodeId){var siteAdminLink=adminTree.treeRoot.find("#"+siteAdminNodeId).children("a").first();siteAdminLink.replaceWith('<span tabindex="0">'+siteAdminLink.html()+"</span>")}adminTree.finishExpandingGroup=function(item){Tree.prototype.finishExpandingGroup.call(this,item),Y.use("moodle-core-event",(function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:instanceid})}))},adminTree.collapseGroup=function(item){Tree.prototype.collapseGroup.call(this,item),Y.use("moodle-core-event",(function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:instanceid})}))}}}}));
/**
 * A javascript module to retrieve user's starred courses.
 *
 * @package    block_starredcourses
 * @copyright  2018 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_starredcourses/repository",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{getStarredCourses:function(args){var request={methodname:"block_starredcourses_get_starred_courses",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise}}}));
/**
 * Javascript to initialise the starred courses block.
 *
 * @copyright   2018 Simey Lameze <simey@moodle.com>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_starredcourses/main",["jquery","core/notification","block_starredcourses/repository","core/pubsub","core/templates","core_course/events"],(function($,Notification,Repository,PubSub,Templates,CourseEvents){var SELECTORS_BLOCK_CONTAINER='[data-region="starred-courses"]',SELECTORS_STARRED_COURSES_REGION_VIEW='[data-region="starred-courses-view"]',SELECTORS_STARRED_COURSES_REGION='[data-region="starred-courses-view-content"]',reloadContent=function(root){var content=root.find(SELECTORS_STARRED_COURSES_REGION);return Repository.getStarredCourses({limit:0,offset:0}).then((function(courses){var showcoursecategory=$(SELECTORS_BLOCK_CONTAINER).data("displaycoursecategory");return courses=courses.map((function(course){return course.showcoursecategory=showcoursecategory,course})),function(root,courses){if(courses.length>0)return Templates.render("core_course/view-cards",{courses:courses});var nocoursesimg=root.find(SELECTORS_STARRED_COURSES_REGION_VIEW).attr("data-nocoursesimg");return Templates.render("block_starredcourses/no-courses",{nocoursesimg:nocoursesimg})}(root,courses)})).then((function(html,js){return Templates.replaceNodeContents(content,html,js)})).catch(Notification.exception)};return{init:function(root){(function(root){PubSub.subscribe(CourseEvents.favourited,(function(){reloadContent(root)})),PubSub.subscribe(CourseEvents.unfavorited,(function(){reloadContent(root)}))})(root=$(root)),reloadContent(root)}}}));
/**
 * A javascript module to retrieve calendar events from the server.
 *
 * @module     block_timeline/calendar_events_repository
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/calendar_events_repository",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{queryByTime:function(args){args.hasOwnProperty("limit")||(args.limit=20),args.limitnum=args.limit,delete args.limit,args.hasOwnProperty("starttime")&&(args.timesortfrom=args.starttime,delete args.starttime),args.hasOwnProperty("endtime")&&(args.timesortto=args.endtime,delete args.endtime),args.limittononsuspendedevents=!0;var request={methodname:"core_calendar_get_action_events_by_timesort",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},queryByCourse:function(args){args.hasOwnProperty("limit")||(args.limit=20),args.limitnum=args.limit,delete args.limit,args.hasOwnProperty("starttime")&&(args.timesortfrom=args.starttime,delete args.starttime),args.hasOwnProperty("endtime")&&(args.timesortto=args.endtime,delete args.endtime);var request={methodname:"core_calendar_get_action_events_by_course",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},queryByCourses:function(args){args.hasOwnProperty("limit")||(args.limit=10),args.limitnum=args.limit,delete args.limit,args.hasOwnProperty("starttime")&&(args.timesortfrom=args.starttime,delete args.starttime),args.hasOwnProperty("endtime")&&(args.timesortto=args.endtime,delete args.endtime);var request={methodname:"core_calendar_get_action_events_by_courses",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise}}}));
/**
 * Javascript to load and render the list of calendar events for a
 * given day range.
 *
 * @module     block_timeline/event_list
 * @package    block_timeline
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/event_list",["jquery","core/notification","core/templates","core/paged_content_factory","core/str","core/user_date","block_timeline/calendar_events_repository"],(function($,Notification,Templates,PagedContentFactory,Str,UserDate,CalendarEventsRepository){var SELECTORS_EMPTY_MESSAGE='[data-region="empty-message"]',SELECTORS_EVENT_LIST_CONTENT='[data-region="event-list-content"]',SELECTORS_EVENT_LIST_LOADING_PLACEHOLDER='[data-region="event-list-loading-placeholder"]',TEMPLATES_EVENT_LIST_CONTENT="block_timeline/event-list-content",DEFAULT_PAGED_CONTENT_CONFIG={ignoreControlWhileLoading:!0,controlPlacementBottom:!0,ariaLabels:{itemsperpagecomponents:"ariaeventlistpagelimit, block_timeline"}},render=function(calendarEvents,midnight){var templateContext=function(calendarEvents,midnight){var eventsByDay={},templateContext={eventsbyday:[]};return calendarEvents.forEach((function(calendarEvent){var dayTimestamp=UserDate.getUserMidnightForTimestamp(calendarEvent.timesort,midnight);eventsByDay[dayTimestamp]?eventsByDay[dayTimestamp].push(calendarEvent):eventsByDay[dayTimestamp]=[calendarEvent]})),Object.keys(eventsByDay).forEach((function(dayTimestamp){var events=eventsByDay[dayTimestamp];templateContext.eventsbyday.push({past:dayTimestamp<midnight,dayTimestamp:dayTimestamp,events:events})})),templateContext}(calendarEvents,midnight),templateName=TEMPLATES_EVENT_LIST_CONTENT;return Templates.render(templateName,templateContext)},loadEventsFromPageData=function(pageData,actions,midnight,lastIds,preloadedPages,courseId,daysOffset,daysLimit){for(var pageNumber=pageData.pageNumber,limit=pageData.limit,lastPageNumber=pageNumber;!lastIds.hasOwnProperty(lastPageNumber);)lastPageNumber--;var lastId=lastIds[lastPageNumber],eventsPromise=null;return eventsPromise=preloadedPages&&preloadedPages.hasOwnProperty(pageNumber)?preloadedPages[pageNumber]:function(midnight,limit,daysOffset,daysLimit,lastId,courseId){var endTime=null!=daysLimit&&midnight+86400*daysLimit,args={starttime:midnight+86400*daysOffset,limit:limit};return lastId&&(args.aftereventid=lastId),endTime&&(args.endtime=endTime),courseId?(args.courseid=courseId,CalendarEventsRepository.queryByCourse(args)):CalendarEventsRepository.queryByTime(args)}(midnight,limit+1,daysOffset,daysLimit,lastId,courseId),eventsPromise.then((function(result){if(!result.events.length)return actions.allItemsLoaded(pageNumber),[];var calendarEvents=result.events.filter((function(event){return"open"!=event.eventtype&&"opensubmission"!=event.eventtype||UserDate.getUserMidnightForTimestamp(event.timesort,midnight)>midnight}));return calendarEvents.length<=limit?actions.allItemsLoaded(pageNumber):calendarEvents.pop(),calendarEvents}))};return{init:function(root,pageLimit,preloadedPages,paginationAriaLabel,additionalConfig){root=$(root);var firstLoad=$.Deferred(),eventListContent=root.find(SELECTORS_EVENT_LIST_CONTENT),loadingPlaceholder=root.find(SELECTORS_EVENT_LIST_LOADING_PLACEHOLDER),courseId=root.attr("data-course-id"),daysOffset=parseInt(root.attr("data-days-offset"),10),daysLimit=root.attr("data-days-limit"),midnight=parseInt(root.attr("data-midnight"),10);return function(root){root.find(SELECTORS_EVENT_LIST_CONTENT).empty()}(root),function(root){root.find(SELECTORS_EVENT_LIST_CONTENT).removeClass("hidden"),root.find(SELECTORS_EMPTY_MESSAGE).addClass("hidden")}(root),loadingPlaceholder.removeClass("hidden"),null!=daysLimit&&(daysLimit=parseInt(daysLimit,10)),function(pageLimit,preloadedPages,midnight,firstLoad,courseId,daysOffset,daysLimit,paginationAriaLabel,additionalConfig){var lastIds={1:0},hasContent=!1,config=$.extend({},DEFAULT_PAGED_CONTENT_CONFIG,additionalConfig);return Str.get_string("ariaeventlistpagelimit","block_timeline",$.isArray(pageLimit)?pageLimit[0].value:pageLimit).then((function(string){return config.ariaLabels.itemsperpage=string,config.ariaLabels.paginationnav=paginationAriaLabel,string})).then((function(){return PagedContentFactory.createWithLimit(pageLimit,(function(pagesData,actions){var promises=[];return pagesData.forEach((function(pageData){var pageNumber=pageData.pageNumber,pagePromise=loadEventsFromPageData(pageData,actions,midnight,lastIds,preloadedPages,courseId,daysOffset,daysLimit).then((function(calendarEvents){if(calendarEvents.length){hasContent=!0;var lastEventId=calendarEvents[calendarEvents.length-1].id;return lastIds[pageNumber+1]=lastEventId,render(calendarEvents,midnight)}return calendarEvents})).catch(Notification.exception);promises.push(pagePromise)})),$.when.apply($,promises).then((function(){firstLoad.resolve(hasContent)})).catch((function(){firstLoad.resolve(hasContent)})),promises}),config)}))}(pageLimit,preloadedPages,midnight,firstLoad,courseId,daysOffset,daysLimit,paginationAriaLabel,additionalConfig).then((function(html,js){return(html=$(html)).addClass("hidden"),Templates.replaceNodeContents(eventListContent,html,js),firstLoad.then((function(hasContent){return html.removeClass("hidden"),loadingPlaceholder.addClass("hidden"),hasContent||function(root){root.find(SELECTORS_EVENT_LIST_CONTENT).addClass("hidden"),root.find(SELECTORS_EMPTY_MESSAGE).removeClass("hidden")}(root),hasContent})).catch((function(){return!1})),html})).catch(Notification.exception)},rootSelector:'[data-region="event-list-container"]'}}));
/**
 * Manage the timeline dates view for the timeline block.
 *
 * @package    block_timeline
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/view_dates",["jquery","core/str","block_timeline/event_list","core/pubsub","core/paged_content_events"],(function($,Str,EventList,PubSub,PagedContentEvents){var SELECTORS_EVENT_LIST_CONTAINER='[data-region="event-list-container"]',DEFAULT_PAGE_LIMIT=[5,10,25],load=function(root){var eventListContainer=root.find(SELECTORS_EVENT_LIST_CONTAINER),namespace=$(eventListContainer).attr("id")+"user_block_timeline"+Math.random();!function(root,namespace){var event=namespace+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;PubSub.subscribe(event,(function(limit){$(root).data("limit",limit)}))}(root,namespace);var limits=function(root){var limitPref=parseInt(root.data("limit"),10),isDefaultSet=!1,limits=DEFAULT_PAGE_LIMIT.map((function(value){return limitPref==value&&(isDefaultSet=!0),{value:value,active:limitPref==value}}));return isDefaultSet||(limits[0].active=!0),limits}(root),config={persistentLimitKey:"block_timeline_user_limit_preference",eventNamespace:namespace};Str.get_string("ariaeventlistpaginationnavdates","block_timeline").then((function(string){return EventList.init(eventListContainer,limits,{},string,config),string})).catch((function(){EventList.init(eventListContainer,limits,{},"",config)}))};return{init:function(root){(root=$(root)).hasClass("active")&&(load(root),root.data("seen",!0))},reset:function(root){root.removeAttr("data-seen"),root.hasClass("active")&&(load(root),root.data("seen",!0))},shown:function(root){root.data("seen")||(load(root),root.data("seen",!0))}}}));
/**
 * Manage the timeline view for the timeline block.
 *
 * @package    block_timeline
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/view",["jquery","block_timeline/view_dates","block_timeline/view_courses"],(function($,ViewDates,ViewCourses){var SELECTORS_TIMELINE_DATES_VIEW='[data-region="view-dates"]',SELECTORS_TIMELINE_COURSES_VIEW='[data-region="view-courses"]';return{init:function(root){var datesViewRoot=(root=$(root)).find(SELECTORS_TIMELINE_DATES_VIEW),coursesViewRoot=root.find(SELECTORS_TIMELINE_COURSES_VIEW);ViewDates.init(datesViewRoot),ViewCourses.init(coursesViewRoot)},reset:function(root){var datesViewRoot=root.find(SELECTORS_TIMELINE_DATES_VIEW),coursesViewRoot=root.find(SELECTORS_TIMELINE_COURSES_VIEW);ViewDates.reset(datesViewRoot),ViewCourses.reset(coursesViewRoot)},shown:function(root){var datesViewRoot=root.find(SELECTORS_TIMELINE_DATES_VIEW),coursesViewRoot=root.find(SELECTORS_TIMELINE_COURSES_VIEW);datesViewRoot.hasClass("active")?ViewDates.shown(datesViewRoot):ViewCourses.shown(coursesViewRoot)}}}));
/**
 * Javascript to initialise the timeline block.
 *
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/main",["jquery","block_timeline/view_nav","block_timeline/view"],(function($,ViewNav,View){var SELECTORS_TIMELINE_VIEW='[data-region="timeline-view"]';return{init:function(root){var viewRoot=(root=$(root)).find(SELECTORS_TIMELINE_VIEW);ViewNav.init(root,viewRoot),View.init(viewRoot)}}}));
/**
 * Manage the timeline courses view for the timeline block.
 *
 * @package    block_timeline
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/view_courses",["jquery","core/notification","core/custom_interaction_events","core/str","core/templates","block_timeline/event_list","core_course/repository","block_timeline/calendar_events_repository"],(function($,Notification,CustomEvents,Str,Templates,EventList,CourseRepository,EventsRepository){var SELECTORS_MORE_COURSES_BUTTON='[data-action="more-courses"]',SELECTORS_MORE_COURSES_BUTTON_CONTAINER='[data-region="more-courses-button-container"]',SELECTORS_NO_COURSES_EMPTY_MESSAGE='[data-region="no-courses-empty-message"]',SELECTORS_COURSES_LIST='[data-region="courses-list"]',SELECTORS_COURSE_ITEMS_LOADING_PLACEHOLDER='[data-region="course-items-loading-placeholder"]',SELECTORS_COURSE_EVENTS_CONTAINER='[data-region="course-events-container"]',SELECTORS_COURSE_NAME='[data-region="course-name"]',SELECTORS_LOADING_ICON=".loading-icon",TEMPLATES_COURSE_ITEMS="block_timeline/course-items",TEMPLATES_LOADING_ICON="core/loading",hideLoadingPlaceholder=function(root){root.find(SELECTORS_COURSE_ITEMS_LOADING_PLACEHOLDER).addClass("hidden")},disableMoreCoursesButtonLoading=function(root){var button=root.find(SELECTORS_MORE_COURSES_BUTTON);button.prop("disabled",!1),button.find(SELECTORS_LOADING_ICON).remove()},hasLoadedCourses=function(root){return root.find(SELECTORS_COURSE_EVENTS_CONTAINER).length>0},getDaysOffset=function(root){return parseInt(root.attr("data-days-offset"),10)},getDaysLimit=function(root){var daysLimit=root.attr("data-days-limit");return null!=daysLimit?parseInt(daysLimit,10):void 0},getMidnight=function(root){return parseInt(root.attr("data-midnight"),10)},getStartTime=function(root){return getMidnight(root)+86400*getDaysOffset(root)},getEndTime=function(root){var midnight=getMidnight(root),daysLimit=getDaysLimit(root);return null!=daysLimit&&midnight+86400*daysLimit},getEventsForCourseIds=function(courseIds,startTime,limit,endTime){var args={courseids:courseIds,starttime:startTime,limit:limit};return endTime&&(args.endtime=endTime),EventsRepository.queryByCourses(args)},setEventReloadTime=function(root,time){root.data("last-event-load-time",time)},hasReloadedEventsSince=function(root,time){return function(root){return root.data("last-event-load-time")}(root)>time},updateDisplayFromCourses=function(courses,root,midnight,daysOffset,daysLimit,noEventsURL){return Templates.render(TEMPLATES_COURSE_ITEMS,{courses:courses,midnight:midnight,hasdaysoffset:!0,hasdayslimit:null!=daysLimit,daysoffset:daysOffset,dayslimit:daysLimit,nodayslimit:null==daysLimit,urls:{noevents:noEventsURL}}).then((function(html){return hideLoadingPlaceholder(root),html?function(root,html){var container=root.find(SELECTORS_COURSES_LIST);Templates.appendNodeContents(container,html,"")}(root,html):hasLoadedCourses(root)||function(root){root.find(SELECTORS_NO_COURSES_EMPTY_MESSAGE).removeClass("hidden")}(root),html})).then((function(html){return courses.length<2?function(root){root.find(SELECTORS_MORE_COURSES_BUTTON_CONTAINER).addClass("hidden")}(root):function(root){root.find(SELECTORS_MORE_COURSES_BUTTON_CONTAINER).removeClass("hidden")}(root),html})).catch((function(){hideLoadingPlaceholder(root)}))},loadMoreCourses=function(root){var offset=function(root){return parseInt(root.attr("data-offset"),10)}(root),limit=function(root){return parseInt(root.attr("data-limit"),10)}(root);return CourseRepository.getEnrolledCoursesByTimelineClassification("inprogress",limit,offset,"fullname asc").then((function(result){var startEventLoadingTime=Date.now(),courses=result.courses,nextOffset=result.nextoffset,daysOffset=getDaysOffset(root),daysLimit=getDaysLimit(root),midnight=getMidnight(root),startTime=getStartTime(root),endTime=getEndTime(root),noEventsURL=root.attr("data-no-events-url");!function(root,offset){root.attr("data-offset",offset)}(root,nextOffset);var eventsPromise=function(courses,startTime,endTime){var courseIds=courses.map((function(course){return course.id}));return getEventsForCourseIds(courseIds,startTime,6,endTime)}(courses,startTime,endTime),renderPromise=updateDisplayFromCourses(courses,root,midnight,daysOffset,daysLimit,noEventsURL);return $.when(eventsPromise,renderPromise).then((function(eventsByCourse){return hasReloadedEventsSince(root,startEventLoadingTime)||courses.forEach((function(course){var courseId=course.id,events=[],containerSelector='[data-region="course-events-container"][data-course-id="'+courseId+'"]',eventListRoot=root.find(containerSelector).find(EventList.rootSelector),courseGroups=eventsByCourse.groupedbycourse.filter((function(group){return group.courseid==courseId}));courseGroups.length&&(events=courseGroups[0].events);var pageOnePreload=$.Deferred().resolve({events:events}).promise();Str.get_string("ariaeventlistpaginationnavcourses","block_timeline",course.fullnamedisplay).then((function(string){return EventList.init(eventListRoot,5,{1:pageOnePreload},string),string})).catch((function(){EventList.init(eventListRoot,5,{1:pageOnePreload})}))})),eventsByCourse}))})).catch(Notification.exception)},registerEventListeners=function(root){CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_MORE_COURSES_BUTTON,(function(e,data){!function(root){var button=root.find(SELECTORS_MORE_COURSES_BUTTON);button.prop("disabled",!0),Templates.render(TEMPLATES_LOADING_ICON,{}).then((function(html){return button.append(html),html})).catch((function(){return!1}))}(root),loadMoreCourses(root).then((function(){disableMoreCoursesButtonLoading(root)})).catch((function(){disableMoreCoursesButtonLoading(root)})),data&&(data.originalEvent.preventDefault(),data.originalEvent.stopPropagation()),e.stopPropagation()}))},shown=function(root){root.attr("data-seen")||(hasLoadedCourses(root)?function(root){var startReloadTime=Date.now(),startTime=getStartTime(root),endTime=getEndTime(root),courseEventsContainers=root.find(SELECTORS_COURSE_EVENTS_CONTAINER),courseIds=courseEventsContainers.map((function(){return $(this).attr("data-course-id")})).get();setEventReloadTime(root,startReloadTime),getEventsForCourseIds(courseIds,startTime,6,endTime).then((function(eventsByCourse){return hasReloadedEventsSince(root,startReloadTime)||courseEventsContainers.each((function(index,container){var courseId=(container=$(container)).attr("data-course-id"),courseName=container.find(SELECTORS_COURSE_NAME).text(),eventListContainer=container.find(EventList.rootSelector),pageDeferred=$.Deferred(),events=[],courseGroups=eventsByCourse.groupedbycourse.filter((function(group){return group.courseid==courseId}));courseGroups.length&&(events=courseGroups[0].events),pageDeferred.resolve({events:events}),Str.get_string("ariaeventlistpaginationnavcourses","block_timeline",courseName).then((function(string){return EventList.init(eventListContainer,5,{1:pageDeferred.promise()},string),string})).catch((function(){EventList.init(eventListContainer,5,{1:pageDeferred.promise()})}))})),eventsByCourse})).catch(Notification.exception)}(root):loadMoreCourses(root),root.attr("data-seen",!0))};return{init:function(root){root=$(root),setEventReloadTime(root,Date.now()),root.hasClass("active")&&(loadMoreCourses(root),root.attr("data-seen",!0)),registerEventListeners(root)},reset:function(root){root.removeAttr("data-seen"),root.hasClass("active")&&shown(root)},shown:shown}}));
/**
 * Manage the timeline view navigation for the timeline block.
 *
 * @package    block_timeline
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/view_nav",["jquery","core/custom_interaction_events","block_timeline/view","core/ajax","core/notification"],(function($,CustomEvents,View,Ajax,Notification){var SELECTORS_TIMELINE_DAY_FILTER='[data-region="day-filter"]',SELECTORS_TIMELINE_DAY_FILTER_OPTION="[data-from]",SELECTORS_TIMELINE_VIEW_SELECTOR='[data-region="view-selector"]',SELECTORS_DATA_DAYS_OFFSET="[data-days-offset]",updateUserPreferences=function(type,value){var request={methodname:"core_user_update_user_preferences",args:{preferences:[{type:type,value:value}]}};Ajax.call([request])[0].fail(Notification.exception)};return{init:function(root,timelineViewRoot){(function(root,timelineViewRoot){var timelineDaySelectorContainer=root.find(SELECTORS_TIMELINE_DAY_FILTER);CustomEvents.define(timelineDaySelectorContainer,[CustomEvents.events.activate]),timelineDaySelectorContainer.on(CustomEvents.events.activate,SELECTORS_TIMELINE_DAY_FILTER_OPTION,(function(e,data){var filtername=$(e.currentTarget).data("filtername");updateUserPreferences("block_timeline_user_filter_preference",filtername);var option=$(e.target).closest(SELECTORS_TIMELINE_DAY_FILTER_OPTION);if("true"!=option.attr("aria-current")){var daysOffset=option.attr("data-from"),daysLimit=option.attr("data-to"),elementsWithDaysOffset=root.find(SELECTORS_DATA_DAYS_OFFSET);elementsWithDaysOffset.attr("data-days-offset",daysOffset),null!=daysLimit?elementsWithDaysOffset.attr("data-days-limit",daysLimit):elementsWithDaysOffset.removeAttr("data-days-limit"),View.reset(timelineViewRoot),data.originalEvent.preventDefault()}}))})(root=$(root),timelineViewRoot),function(root,timelineViewRoot){var viewSelector=root.find(SELECTORS_TIMELINE_VIEW_SELECTOR);viewSelector.on("shown shown.bs.tab",(function(e){View.shown(timelineViewRoot),$(e.target).removeClass("active")})),CustomEvents.define(viewSelector,[CustomEvents.events.activate]),viewSelector.on(CustomEvents.events.activate,"[data-toggle='tab']",(function(e){var filtername=$(e.currentTarget).data("filtername");updateUserPreferences("block_timeline_user_sort_preference",filtername)}))}(root,timelineViewRoot)}}}));
/**
 * AMD module to access the DOM global document object.
 *
 * @package    media_videojs
 * @copyright  2019 Tom Dickman <tomdickman@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("media_videojs/document",[],(function(){return document}));
/**
 * AMD module to access the DOM global window object.
 *
 * @package    media_videojs
 * @copyright  2019 Tom Dickman <tomdickman@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("media_videojs/window",[],(function(){return window}));
/**
 * Video JS loader.
 *
 * This takes care of applying the filter on content which was dynamically loaded.
 *
 * @package    media_videojs
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("media_videojs/loader",["jquery","core/event"],(function($,Event){var onload,notifyVideoJS=function(e,nodes){nodes.find(".mediaplugin_videojs").addBack(".mediaplugin_videojs").find("audio, video").each((function(){var id=$(this).attr("id"),config=$(this).data("setup-lazy"),modules=["media_videojs/video-lazy"];config.techOrder&&-1!==config.techOrder.indexOf("youtube")&&modules.push("media_videojs/Youtube-lazy"),config.techOrder&&-1!==config.techOrder.indexOf("flash")&&modules.push("media_videojs/videojs-flash-lazy"),require(modules,(function(videojs){onload&&(onload(videojs),onload=null),videojs(id,config)}))}))};return{setUp:function(executeonload){onload=executeonload,notifyVideoJS(null,$("body")),Event.getLegacyEvents().done((function(events){$(document).on(events.FILTER_CONTENT_UPDATED,notifyVideoJS)}))}}}));
define('filter_opencast/form', ["jquery"],function(a){var b={init:function(){a("#ltiLaunchForm").submit(function(b){b.preventDefault();var c=decodeURIComponent(a(this).attr("action"));a.ajax({url:c,crossDomain:!0,type:"post",xhrFields:{withCredentials:!0},data:a("#ltiLaunchForm").serialize(),complete:function(){a(".ocplayer").each(function(){a(this).attr("src",a(this).data("framesrc"))})}})}),a("#ltiLaunchForm").submit()}};return b});
/**
 * Module to enable inline editing of a comptency grade.
 *
 * @package    report_competency
 * @copyright  2015 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_competency/grading_popup",["jquery","core/notification","core/str","core/ajax","core/log","core/templates","tool_lp/dialogue"],(function($,notification,str,ajax,log,templates,Dialogue){var GradingPopup=function(regionSelector,userCompetencySelector){this._regionSelector=regionSelector,this._userCompetencySelector=userCompetencySelector,$(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};return GradingPopup.prototype._handleClick=function(e){var cell=$(e.target).closest(this._userCompetencySelector),competencyId=$(cell).data("competencyid"),courseId=$(cell).data("courseid"),userId=$(cell).data("userid");log.debug("Clicked on cell: competencyId="+competencyId+", courseId="+courseId+", userId="+userId);var requests=ajax.call([{methodname:"tool_lp_data_for_user_competency_summary_in_course",args:{userid:userId,competencyid:competencyId,courseid:courseId}},{methodname:"core_competency_user_competency_viewed_in_course",args:{userid:userId,competencyid:competencyId,courseid:courseId}}]);$.when(requests[0],requests[1]).then(this._contextLoaded.bind(this)).catch(notification.exception)},GradingPopup.prototype._contextLoaded=function(context){return context.displayuser=!0,M.util.js_pending("report_competency/grading_popup:_contextLoaded"),$.when(str.get_string("usercompetencysummary","report_competency"),templates.render("tool_lp/user_competency_summary_in_course",context)).then(function(title,templateData){return new Dialogue(title,templateData[0],(function(){templates.runTemplateJS(templateData[1]),M.util.js_complete("report_competency/grading_popup:_contextLoaded")}),this._refresh.bind(this),!0)}.bind(this))},GradingPopup.prototype._refresh=function(){var region=$(this._regionSelector),courseId=region.data("courseid"),moduleId=region.data("moduleid"),userId=region.data("userid");return""===moduleId&&(moduleId=0),ajax.call([{methodname:"report_competency_data_for_report",args:{courseid:courseId,userid:userId,moduleid:moduleId},done:this._pageContextLoaded.bind(this),fail:notification.exception}])},GradingPopup.prototype._pageContextLoaded=function(context){templates.render("report_competency/report",context).then(function(html,js){templates.replaceNode(this._regionSelector,html,js)}.bind(this)).catch(notification.exception)},GradingPopup.prototype._regionSelector=null,GradingPopup.prototype._userCompetencySelector=null,GradingPopup}));
/**
 * Module to navigation between users in a course.
 *
 * @package    report_competency
 * @copyright  2015 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_competency/user_course_navigation",["jquery"],(function($){var UserCourseNavigation=function(userSelector,moduleSelector,baseUrl,userId,courseId,moduleId){this._baseUrl=baseUrl,this._userId=userId+"",this._courseId=courseId,this._moduleId=moduleId,$(userSelector).on("change",this._userChanged.bind(this)),$(moduleSelector).on("change",this._moduleChanged.bind(this))};return UserCourseNavigation.prototype._userChanged=function(e){M.util.js_pending("report_competency/user_course_navigation:_userChanged");var queryStr="?user="+$(e.target).val()+"&id="+this._courseId+"&mod="+this._moduleId;document.location=this._baseUrl+queryStr},UserCourseNavigation.prototype._moduleChanged=function(e){M.util.js_pending("report_competency/user_course_navigation:_moduleChanged");var queryStr="?mod="+$(e.target).val()+"&id="+this._courseId+"&user="+this._userId;document.location=this._baseUrl+queryStr},UserCourseNavigation.prototype._userId=null,UserCourseNavigation.prototype._moduleId=null,UserCourseNavigation.prototype._courseId=null,UserCourseNavigation.prototype._baseUrl=null,UserCourseNavigation}));
/**
 * Message users.
 *
 * @module     report_insights/message_users
 * @package    report_insights
 * @copyright  2019 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_insights/message_users",["jquery","core/str","core/log","core/modal_factory","core/modal_events","core/templates","core/notification","core/ajax"],(function($,Str,Log,ModalFactory,ModalEvents,Templates,Notification,Ajax){var SELECTORS_BULKACTIONSELECT="#formactionid",MessageUsers=function(rootNode,actionName){this.actionName=actionName,this.attachEventListeners(rootNode)};return MessageUsers.prototype.actionName=null,MessageUsers.prototype.modal=null,MessageUsers.prototype.attachEventListeners=function(rootNode){$(rootNode+" button[data-bulk-sendmessage]").on("click",function(e){e.preventDefault();var cTarget=$(e.currentTarget),users={},predictionToUserMapping=cTarget.data("prediction-to-user-id");return $('.insights-list input[data-togglegroup^="insight-bulk-action"][data-toggle="slave"]:checked').each((function(index,value){var predictionId=$(value).closest("tr[data-prediction-id]").data("prediction-id");if(void 0!==predictionToUserMapping[predictionId]){var userId=predictionToUserMapping[predictionId];users[predictionId]=userId}else Log.error("Unknown user for prediction "+predictionId)})),0===Object.keys(users).length||this.showSendMessage(users),this}.bind(this))},MessageUsers.prototype.showSendMessage=function(users){var userIds=new Set(Object.values(users));if(0==userIds.length)return $.Deferred().resolve().promise();var titlePromise=null;return titlePromise=1==userIds.size?Str.get_string("sendbulkmessagesingle","core_message"):Str.get_string("sendbulkmessage","core_message",userIds.size),$.when(ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,body:Templates.render("core_user/send_bulk_message",{})}),titlePromise).then(function(modal,title){return this.modal=modal,this.modal.setTitle(title),this.modal.setSaveButtonText(title),this.modal.getRoot().on(ModalEvents.hidden,function(){$(SELECTORS_BULKACTIONSELECT).focus(),this.modal.getRoot().remove()}.bind(this)),this.modal.getRoot().on(ModalEvents.save,this.submitSendMessage.bind(this,users)),this.modal.show(),this.modal}.bind(this))},MessageUsers.prototype.submitSendMessage=function(users){var messageText=this.modal.getRoot().find("form textarea").val(),messages=[];new Set(Object.values(users)).forEach((function(userId){messages.push({touserid:userId,text:messageText})}));var actionName=this.actionName,message=null;return Ajax.call([{methodname:"core_message_send_instant_messages",args:{messages:messages}}])[0].then((function(messageIds){return 1==messageIds.length?Str.get_string("sendbulkmessagesentsingle","core_message"):Str.get_string("sendbulkmessagesent","core_message",messageIds.length)})).then((function(msg){return message=msg,Ajax.call([{methodname:"report_insights_action_executed",args:{actionname:actionName,predictionids:Object.keys(users)}}])[0]})).then((function(){return Notification.addNotification({message:message,type:"success"}),!0})).catch(Notification.exception)},{init:function(rootNode,actionName){return new MessageUsers(rootNode,actionName)}}}));
/**
 * Module to manage report insights actions that are executed using AJAX.
 *
 * @package    report_insights
 * @copyright  2017 David Monllao {@link http://www.davidmonllao.com}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_insights/actions",["jquery","core/str","core/ajax","core/notification","core/url","core/modal_factory","core/modal_events"],(function($,Str,Ajax,Notification,Url,ModalFactory,ModalEvents){return{initBulk:function(rootNode){$(rootNode+" [data-bulk-actionname]").on("click",(function(e){e.preventDefault();var action=$(e.currentTarget),actionName=action.data("bulk-actionname"),actionVisibleName=action.text().trim(),predictionIds=[],predictionContainers=[];if($('.insights-list input[data-togglegroup^="insight-bulk-action-"][data-toggle="slave"]:checked').each((function(){var container=$(this).closest("tr[data-prediction-id]");predictionContainers.push(container),predictionIds.push(container.data("prediction-id"))})),0===predictionIds.length)return this;var strings=[];return Str.get_strings([{key:"confirmbulkaction",component:"report_insights",param:{action:actionVisibleName,nitems:predictionIds.length}},{key:"confirm",component:"moodle"}]).then((function(strs){return strings=strs,ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:actionVisibleName,body:strings[0]})})).then((function(modal){return modal.setSaveButtonText(strings[1]),modal.show(),modal.getRoot().on(ModalEvents.save,(function(){return function(predictionIds,predictionContainers,actionName){return Ajax.call([{methodname:"report_insights_action_executed",args:{predictionids:predictionIds,actionname:actionName}}])[0].then((function(){var tableNode=!1;if(predictionContainers.forEach((function(el){!1===tableNode&&(tableNode=el.closest("table")),el.remove()})),0===tableNode.find("tbody > tr").length){var params={contextid:tableNode.closest("div.insight-container").data("context-id"),modelid:tableNode.closest("div.insight-container").data("model-id")};window.location.assign(Url.relativeUrl("report/insights/insights.php",params,!1))}})).catch(Notification.exception)}(predictionIds,predictionContainers,actionName)})),modal})).catch(Notification.exception),this}))}}}));
define("report_participation/participants",["exports","jquery","core/custom_interaction_events","core/modal_events","core/notification","core_user/local/participants/bulkactions"],(function(_exports,_jquery,_custom_interaction_events,_modal_events,_notification,_bulkactions){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Some UI stuff for participants page.
   * This is also used by the report/participants/index.php because it has the same functionality.
   *
   * @module     core_user/participants
   * @package    core_user
   * @copyright  2017 Damyon Wiese
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification);var Selectors_bulkActionSelect="#formactionid",Selectors_bulkUserSelectedCheckBoxes="input[data-togglegroup^='participants-table'][data-toggle='slave']:checked",Selectors_participantsForm="#participantsform";_exports.init=function(){var root=document.querySelector(Selectors_participantsForm),resetBulkAction=function(bulkActionSelect){bulkActionSelect.value=""};_custom_interaction_events.default.define(Selectors_bulkActionSelect,[_custom_interaction_events.default.events.accessibleChange]),(0,_jquery.default)(Selectors_bulkActionSelect).on(_custom_interaction_events.default.events.accessibleChange,(function(e){var action=e.target.value,checkboxes=root.querySelectorAll(Selectors_bulkUserSelectedCheckBoxes);if(-1!==action.indexOf("#")){e.preventDefault();var ids=[];checkboxes.forEach((function(checkbox){ids.push(checkbox.getAttribute("name").replace("user",""))})),"#messageselect"===action&&(0,_bulkactions.showSendMessage)(ids).then((function(modal){return modal.getRoot().on(_modal_events.default.hidden,(function(){var bulkActionSelector=root.querySelector(Selectors_bulkActionSelect);resetBulkAction(bulkActionSelector),bulkActionSelector.focus()})),modal})).catch(_notification.default.exception)}else""!==action&&checkboxes.length&&e.target.form().submit();resetBulkAction(e.target)}))}}));
/**
 * AMD module to handle overriding activity completion status.
 *
 * @module     report_progress/completion_override
 * @package    report_progress
 * @copyright  2016 onwards Eiz Eddin Al Katrib <eiz@barasoft.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("report_progress/completion_override",["jquery","core/ajax","core/str","core/modal_factory","core/modal_events","core/notification","core/custom_interaction_events","core/templates"],(function($,Ajax,Str,ModalFactory,ModalEvents,Notification,CustomEvents,Templates){var userFullName,triggerElement,userConfirm=function(e,data){data.originalEvent.preventDefault(),data.originalEvent.stopPropagation(),e.preventDefault(),e.stopPropagation();var elemData=(triggerElement=$(e.currentTarget)).data("changecompl").split("-"),override={userid:elemData[0],cmid:elemData[1],newstate:elemData[2]},newStateStr=1==override.newstate?"completion-y":"completion-n";Str.get_strings([{key:newStateStr,component:"completion"}]).then((function(strings){return Str.get_strings([{key:"confirm",component:"moodle"},{key:"areyousureoverridecompletion",component:"completion",param:strings[0]}])})).then((function(strings){return ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:strings[0],body:strings[1]})})).then((function(modal){modal.getRoot().on(ModalEvents.save,(function(){!function(override){Templates.render("core/loading",{}).then((function(html){return triggerElement.append(html),Ajax.call([{methodname:"core_completion_override_activity_completion_status",args:override}])[0]})).then((function(results){var completionState=results.state>0?1:0,tooltipKey=completionState?"completion-y-override":"completion-n-override";Str.get_string(tooltipKey,"completion",userFullName).then((function(stateString){var params={state:stateString,date:"",user:triggerElement.attr("data-userfullname"),activity:triggerElement.attr("data-activityname")};return Str.get_string("progress-title","completion",params)})).then((function(titleString){var tracking,completionTracking=triggerElement.attr("data-completiontracking");return Templates.renderPix((tracking=completionTracking,completionState>0?"i/completion-"+tracking+"-y-override":"i/completion-"+tracking+"-n-override"),"core",titleString)})).then((function(html){var oppositeState=completionState>0?0:1;triggerElement.find(".loading-icon").remove(),triggerElement.data("changecompl",override.userid+"-"+override.cmid+"-"+oppositeState),triggerElement.attr("data-changecompl",override.userid+"-"+override.cmid+"-"+oppositeState),triggerElement.children("img").replaceWith(html)})).catch(Notification.exception)})).catch(Notification.exception)}(override)})),modal.getRoot().on(ModalEvents.hidden,(function(){triggerElement.focus(),modal.destroy()})),modal.show()})).catch(Notification.exception)};return{init:function(fullName){userFullName=fullName,$("#completion-progress a.changecompl").each((function(index,element){CustomEvents.define(element,[CustomEvents.events.activate])})),$("#completion-progress").on(CustomEvents.events.activate,"a.changecompl",(function(e,data){userConfirm(e,data)}))}}}));
/**
 * AMD code for the frequently used comments chooser for the marking guide grading form.
 *
 * @module     gradingform_guide/comment_chooser
 * @class      comment_chooser
 * @package    core
 * @copyright  2015 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
  */
define("gradingform_guide/comment_chooser",["jquery","core/templates","core/notification","core/yui"],(function($,templates,notification){return{initialise:function(criterionId,buttonId,remarkId,commentOptions){function generateCommentsChooser(){var context={criterionId:criterionId,comments:commentOptions};templates.render("gradingform_guide/comment_chooser",context).done((function(compiledSource){!function(compiledSource,comments){var titleLabel="<label>"+M.util.get_string("insertcomment","gradingform_guide")+"</label>",cancelButtonId="comment-chooser-"+criterionId+"-cancel",cancelButton='<button id="'+cancelButtonId+'">'+M.util.get_string("cancel","moodle")+"</button>",chooserDialog=new M.core.dialogue({modal:!0,headerContent:titleLabel,bodyContent:compiledSource,footerContent:cancelButton,focusAfterHide:"#"+remarkId,id:"comments-chooser-dialog-"+criterionId});$("#"+cancelButtonId).click((function(){chooserDialog.hide()})),$.each(comments,(function(index,comment){var commentOptionId="#comment-option-"+criterionId+"-"+comment.id;$(commentOptionId).click((function(){var remarkTextArea=$("#"+remarkId),remarkText=remarkTextArea.val();""!==remarkText.trim()&&(remarkText+="\n"),remarkText+=comment.description,remarkTextArea.val(remarkText),chooserDialog.hide()})),$(document).off("keypress",commentOptionId).on("keypress",commentOptionId,(function(){var keyCode=event.which||event.keyCode;13!=keyCode&&32!=keyCode||$(commentOptionId).click()}))})),chooserDialog.after("visibleChange",(function(e){e.prevVal&&!e.newVal&&this.destroy()}),chooserDialog),chooserDialog.show()}(compiledSource,commentOptions)})).fail(notification.exception)}$("#"+buttonId).click((function(e){e.preventDefault(),generateCommentsChooser()}))}}}));
define("gradingform_guide/grades/grader/gradingpanel/comments/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={frequentComment:'[data-gradingform_guide-role="frequent-comment"]',criterion:'[data-gradingform-guide-role="criterion"]',remark:'[data-gradingform-guide-role="remark"]'},_exports.default}));
define("gradingform_guide/grades/grader/gradingpanel/comments",["exports","./comments/selectors"],(function(_exports,_selectors){var obj;
/**
   * Grading panel frequently used comments selector.
   *
   * @module     gradingform_guide/grades/grader/gradingpanel/comments
   * @package    gradingform_guide
   * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_selectors=(obj=_selectors)&&obj.__esModule?obj:{default:obj};_exports.init=function(rootId){document.querySelector("#".concat(rootId)).addEventListener("click",(function(e){if(e.target.matches(_selectors.default.frequentComment)){e.preventDefault();var clicked=e.target.closest(_selectors.default.frequentComment),remark=clicked.closest(_selectors.default.criterion).querySelector(_selectors.default.remark);remark&&(remark.value.trim()?remark.value+="\n".concat(clicked.innerHTML):remark.value+=clicked.innerHTML)}}))}}));
define("gradingform_guide/grades/grader/gradingpanel",["exports","core/ajax","core_grades/grades/grader/gradingpanel/normalise","core_grades/grades/grader/gradingpanel/comparison","jquery"],(function(_exports,_ajax,_normalise,_comparison,_jquery){var obj;function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.storeCurrentGrade=_exports.fetchCurrentGrade=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.fetchCurrentGrade=function(component,contextid,itemname,gradeduserid){return(0,_ajax.call)([{methodname:"gradingform_guide_grader_gradingpanel_fetch",args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid}}])[0]};var fn,_ref,storeCurrentGrade=(fn=regeneratorRuntime.mark((function _callee(component,contextid,itemname,gradeduserid,notifyUser,rootNode){var form;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(form=rootNode.querySelector("form"),!0!==(0,_comparison.compareData)(form)){_context.next=9;break}return _context.t0=_normalise.normaliseResult,_context.next=5,(0,_ajax.call)([{methodname:"gradingform_guide_grader_gradingpanel_store",args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid,notifyuser:notifyUser,formdata:(0,_jquery.default)(form).serialize()}}])[0];case 5:return _context.t1=_context.sent,_context.abrupt("return",(0,_context.t0)(_context.t1));case 9:return _context.abrupt("return","");case 10:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4,_x5,_x6){return _ref.apply(this,arguments)});_exports.storeCurrentGrade=storeCurrentGrade}));
define("gradingform_rubric/grades/grader/gradingpanel",["exports","core/ajax","core_grades/grades/grader/gradingpanel/normalise","core_grades/grades/grader/gradingpanel/comparison","jquery"],(function(_exports,_ajax,_normalise,_comparison,_jquery){var obj;function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.storeCurrentGrade=_exports.fetchCurrentGrade=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.fetchCurrentGrade=function(component,contextid,itemname,gradeduserid){return(0,_ajax.call)([{methodname:"gradingform_rubric_grader_gradingpanel_fetch",args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid}}])[0]};var fn,_ref,storeCurrentGrade=(fn=regeneratorRuntime.mark((function _callee(component,contextid,itemname,gradeduserid,notifyUser,rootNode){var form;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(form=rootNode.querySelector("form"),!0!==(0,_comparison.compareData)(form)){_context.next=9;break}return _context.t0=_normalise.normaliseResult,_context.next=5,(0,_ajax.call)([{methodname:"gradingform_rubric_grader_gradingpanel_store",args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid,notifyuser:notifyUser,formdata:(0,_jquery.default)(form).serialize()}}])[0];case 5:return _context.t1=_context.sent,_context.abrupt("return",(0,_context.t0)(_context.t1));case 9:return _context.abrupt("return","");case 10:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4,_x5,_x6){return _ref.apply(this,arguments)});_exports.storeCurrentGrade=storeCurrentGrade}));
/**
 * Shows a dialogue with info about this logs.
 *
 * @module     tool_analytics/log_info
 * @class      log_info
 * @package    tool_analytics
 * @copyright  2017 David Monllao {@link http://www.davidmonllao.com}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_analytics/log_info",["jquery","core/str","core/modal_factory","core/notification"],(function($,str,ModalFactory,Notification){return{loadInfo:function(id,info){var link=$('[data-model-log-id="'+id+'"]');str.get_string("loginfo","tool_analytics").then((function(langString){var bodyInfo=$("<ul>");return info.forEach((function(item){bodyInfo.append("<li>"+item+"</li>")})),bodyInfo.append("</ul>"),ModalFactory.create({title:langString,body:bodyInfo.html(),large:!0},link)})).catch(Notification.exception)}}}));
/**
 * AMD module for model actions confirmation.
 *
 * @module     tool_analytics/model
 * @copyright  2017 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_analytics/model",["jquery","core/str","core/log","core/notification","core/modal_factory","core/modal_events","core/templates"],(function($,Str,log,Notification,ModalFactory,ModalEvents,Templates){var actionsList={clear:{title:{key:"clearpredictions",component:"tool_analytics"},body:{key:"clearmodelpredictions",component:"tool_analytics"}},delete:{title:{key:"delete",component:"tool_analytics"},body:{key:"deletemodelconfirmation",component:"tool_analytics"}}};return{confirmAction:function(actionId,actionType){$('[data-action-id="'+actionId+'"]').on("click",(function(ev){ev.preventDefault();var a=$(ev.currentTarget);if(void 0!==actionsList[actionType]){var wrap,reqStrings=[actionsList[actionType].title,actionsList[actionType].body];reqStrings[1].param=(wrap=$(a).closest("[data-model-name]")).length?wrap.attr("data-model-name"):(log.error("Unexpected DOM error - unable to obtain the model name"),"");var stringsPromise=Str.get_strings(reqStrings),modalPromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL});$.when(stringsPromise,modalPromise).then((function(strings,modal){return modal.setTitle(strings[0]),modal.setBody(strings[1]),modal.setSaveButtonText(strings[0]),modal.getRoot().on(ModalEvents.save,(function(){window.location.href=a.attr("href")})),modal.show(),modal})).fail(Notification.exception)}else log.error('Action "'+actionType+'" is not allowed.')}))},selectEvaluationOptions:function(actionId,trainedOnlyExternally){$('[data-action-id="'+actionId+'"]').on("click",(function(ev){ev.preventDefault();var a=$(ev.currentTarget),timeSplittingMethods=$(this).attr("data-timesplitting-methods"),stringsPromise=Str.get_strings([{key:"evaluatemodel",component:"tool_analytics"},{key:"evaluate",component:"tool_analytics"}]),modalPromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL}),bodyPromise=Templates.render("tool_analytics/evaluation_options",{trainedexternally:trainedOnlyExternally,timesplittingmethods:JSON.parse(timeSplittingMethods)});$.when(stringsPromise,modalPromise).then((function(strings,modal){return modal.getRoot().on(ModalEvents.hidden,modal.destroy.bind(modal)),modal.setTitle(strings[0]),modal.setSaveButtonText(strings[1]),modal.setBody(bodyPromise),modal.getRoot().on(ModalEvents.save,(function(){"trainedmodel"==$("input[name='evaluationmode']:checked").val()&&a.attr("href",a.attr("href")+"&mode=trainedmodel");var timeSplittingMethod=$("#id-evaluation-timesplitting").val();a.attr("href",a.attr("href")+"&timesplitting="+timeSplittingMethod),window.location.href=a.attr("href")})),modal.show(),modal})).fail(Notification.exception)}))},selectExportOptions:function(actionId,isTrained){$('[data-action-id="'+actionId+'"]').on("click",(function(ev){ev.preventDefault();var a=$(ev.currentTarget);if(!isTrained)return a.attr("href",a.attr("href")+"&action=exportmodel&includeweights=0"),void(window.location.href=a.attr("href"));var stringsPromise=Str.get_strings([{key:"export",component:"tool_analytics"}]),modalPromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL}),bodyPromise=Templates.render("tool_analytics/export_options",{});$.when(stringsPromise,modalPromise).then((function(strings,modal){return modal.getRoot().on(ModalEvents.hidden,modal.destroy.bind(modal)),modal.setTitle(strings[0]),modal.setSaveButtonText(strings[0]),modal.setBody(bodyPromise),modal.getRoot().on(ModalEvents.save,(function(){"exportdata"==$("input[name='exportoption']:checked").val()?a.attr("href",a.attr("href")+"&action=exportdata"):(a.attr("href",a.attr("href")+"&action=exportmodel"),$("#id-includeweights").is(":checked")?a.attr("href",a.attr("href")+"&includeweights=1"):a.attr("href",a.attr("href")+"&includeweights=0")),window.location.href=a.attr("href")})),modal.show(),modal})).fail(Notification.exception)}))}}}));
/**
 * Potential contexts selector module.
 *
 * @module     tool_analytics/potential-contexts
 * @class      potential-contexts
 * @package    tool_analytics
 * @copyright  2019 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_analytics/potential-contexts",["jquery","core/ajax"],(function($,Ajax){return{processResults:function(selector,results){var contexts=[];return $.isArray(results)?($.each(results,(function(index,context){contexts.push({value:context.id,label:context.name})})),contexts):results},transport:function(selector,query,success,failure){var modelid=$(selector).attr("modelid")||null;Ajax.call([{methodname:"tool_analytics_potential_contexts",args:{query:query,modelid:modelid}}])[0].then(success).fail(failure)}}}));
/**
 * Request actions.
 *
 * @module     tool_dataprivacy/data_registry
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/data_registry",["jquery","core/str","core/ajax","core/notification","core/templates","core/modal_factory","core/modal_events","core/fragment","tool_dataprivacy/add_purpose","tool_dataprivacy/add_category"],(function($,Str,Ajax,Notification,Templates,ModalFactory,ModalEvents,Fragment,AddPurpose,AddCategory){var SELECTORS_TREE_NODES="[data-context-tree-node=1]",SELECTORS_FORM_CONTAINER="#context-form-container",DataRegistry=function(systemContextId,initContextLevel,initContextId){this.systemContextId=systemContextId,this.currentContextLevel=initContextLevel,this.currentContextId=initContextId,this.init()};return DataRegistry.prototype.systemContextId=0,DataRegistry.prototype.currentContextLevel=0,DataRegistry.prototype.currentContextId=0,DataRegistry.prototype.addpurpose=null,DataRegistry.prototype.addcategory=null,DataRegistry.prototype.init=function(){this.addpurpose=AddPurpose.getInstance(this.systemContextId),this.addcategory=AddCategory.getInstance(this.systemContextId);this.strings=Str.get_strings([{key:"changessaved",component:"moodle"},{key:"contextpurposecategorysaved",component:"tool_dataprivacy"},{key:"noblockstoload",component:"tool_dataprivacy"},{key:"noactivitiestoload",component:"tool_dataprivacy"},{key:"nocoursestoload",component:"tool_dataprivacy"}]),this.registerEventListeners(),this.currentContextId?this.loadForm("context_form",[this.currentContextId],this.submitContextFormAjax.bind(this)):this.loadForm("contextlevel_form",[this.currentContextLevel],this.submitContextLevelFormAjax.bind(this))},DataRegistry.prototype.registerEventListeners=function(){$(SELECTORS_TREE_NODES).on("click",function(ev){ev.preventDefault();var trigger=$(ev.currentTarget);$(SELECTORS_TREE_NODES).removeClass("active"),trigger.addClass("active");var contextLevel=trigger.data("contextlevel"),contextId=trigger.data("contextid");if(contextLevel)window.history.pushState({},null,"?contextlevel="+contextLevel),this.addpurpose.removeListeners(),this.addcategory.removeListeners(),this.currentContextLevel=contextLevel,this.loadForm("contextlevel_form",[this.currentContextLevel],this.submitContextLevelFormAjax.bind(this));else if(contextId)window.history.pushState({},null,"?contextid="+contextId),this.addpurpose.removeListeners(),this.addcategory.removeListeners(),this.currentContextId=contextId,this.loadForm("context_form",[this.currentContextId],this.submitContextFormAjax.bind(this));else{var expandContextId=trigger.data("expandcontextid"),expandElement=trigger.data("expandelement"),expanded=trigger.data("expanded");expandElement&&(expanded?this.collapse(trigger):!trigger.data("loaded")&&expandContextId&&expandElement?(trigger.find("> i").removeClass("fa-plus"),trigger.find("> i").addClass("fa-circle-o-notch fa-spin"),this.loadExtra(trigger,expandContextId,expandElement)):this.expand(trigger))}}.bind(this))},DataRegistry.prototype.removeListeners=function(){$(SELECTORS_TREE_NODES).off("click")},DataRegistry.prototype.loadForm=function(fragmentName,fragmentArgs,formSubmitCallback){this.clearForm(),Fragment.loadFragment("tool_dataprivacy",fragmentName,this.systemContextId,fragmentArgs).done(function(html,js){$(SELECTORS_FORM_CONTAINER).html(html),Templates.runTemplateJS(js),this.addpurpose.registerEventListeners(),this.addcategory.registerEventListeners(),$(SELECTORS_FORM_CONTAINER).on("submit","form",formSubmitCallback)}.bind(this)).fail(Notification.exception)},DataRegistry.prototype.clearForm=function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),$(SELECTORS_FORM_CONTAINER).off("submit","form")},DataRegistry.prototype.submitForm=function(e){e.preventDefault(),$(SELECTORS_FORM_CONTAINER).find("form").submit()},DataRegistry.prototype.submitContextLevelFormAjax=function(e){this.submitFormAjax(e,"tool_dataprivacy_set_contextlevel_form")},DataRegistry.prototype.submitContextFormAjax=function(e){this.submitFormAjax(e,"tool_dataprivacy_set_context_form")},DataRegistry.prototype.submitFormAjax=function(e,saveMethodName){e.preventDefault();var formData=$(SELECTORS_FORM_CONTAINER).find("form").serialize();return this.strings.then((function(strings){Ajax.call([{methodname:saveMethodName,args:{jsonformdata:JSON.stringify(formData)},done:function(){Notification.alert(strings[0],strings[1])},fail:Notification.exception}])})).catch(Notification.exception)},DataRegistry.prototype.loadExtra=function(parentNode,expandContextId,expandElement){Ajax.call([{methodname:"tool_dataprivacy_tree_extra_branches",args:{contextid:expandContextId,element:expandElement},done:function(data){0!=data.branches.length?Templates.render("tool_dataprivacy/context_tree_branches",data).then(function(html){parentNode.after(html),this.removeListeners(),this.registerEventListeners(),this.expand(parentNode),parentNode.data("loaded",1)}.bind(this)).fail(Notification.exception):this.noElements(parentNode,expandElement)}.bind(this),fail:Notification.exception}])},DataRegistry.prototype.noElements=function(node,expandElement){node.data("expandcontextid",""),node.data("expandelement",""),this.strings.then((function(strings){var key=2;"module"==expandElement?key=3:"course"==expandElement&&(key=4),node.text(strings[key])})).fail(Notification.exception)},DataRegistry.prototype.collapse=function(node){node.data("expanded",0),node.siblings("nav").addClass("hidden"),node.find("> i").removeClass("fa-minus"),node.find("> i").addClass("fa-plus")},DataRegistry.prototype.expand=function(node){node.data("expanded",1),node.siblings("nav").removeClass("hidden"),node.find("> i").removeClass("fa-plus"),node.find("> i").removeClass("fa-circle-o-notch fa-spin"),node.find("> i").addClass("fa-minus")},{init:function(systemContextId,initContextLevel,initContextId){return new DataRegistry(systemContextId,initContextLevel,initContextId)}}}));
/**
 * Request actions.
 *
 * @module     tool_dataprivacy/data_request_modal
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/data_request_modal",["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","tool_dataprivacy/events"],(function($,Notification,CustomEvents,Modal,ModalRegistry,DataPrivacyEvents){var registered=!1,SELECTORS_APPROVE_BUTTON='[data-action="approve"]',SELECTORS_DENY_BUTTON='[data-action="deny"]',SELECTORS_COMPLETE_BUTTON='[data-action="complete"]',ModalDataRequest=function(root){Modal.call(this,root)};return ModalDataRequest.TYPE="tool_dataprivacy-data_request",(ModalDataRequest.prototype=Object.create(Modal.prototype)).constructor=ModalDataRequest,ModalDataRequest.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_APPROVE_BUTTON,function(e,data){var approveEvent=$.Event(DataPrivacyEvents.approve);this.getRoot().trigger(approveEvent,this),approveEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this)),this.getModal().on(CustomEvents.events.activate,SELECTORS_DENY_BUTTON,function(e,data){var denyEvent=$.Event(DataPrivacyEvents.deny);this.getRoot().trigger(denyEvent,this),denyEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this)),this.getModal().on(CustomEvents.events.activate,SELECTORS_COMPLETE_BUTTON,function(e,data){var completeEvent=$.Event(DataPrivacyEvents.complete);this.getRoot().trigger(completeEvent,this),completeEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalDataRequest.TYPE,ModalDataRequest,"tool_dataprivacy/data_request_modal"),registered=!0),ModalDataRequest}));
/**
 * Module to update the displayed retention period.
 *
 * @module     tool_dataprivacy/effective_retention_period
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/effective_retention_period",["jquery"],(function($){var SELECTORS_PURPOSE_SELECT="#id_purposeid",SELECTORS_RETENTION_FIELD="#fitem_id_retention_current [data-fieldtype=static]",EffectiveRetentionPeriod=function(purposeRetentionPeriods){this.purposeRetentionPeriods=purposeRetentionPeriods,this.registerEventListeners()};return EffectiveRetentionPeriod.prototype.purposeRetentionPeriods=[],EffectiveRetentionPeriod.prototype.registerEventListeners=function(){$(SELECTORS_PURPOSE_SELECT).on("change",function(ev){var selected=$(ev.currentTarget).val(),selectedPurpose=this.purposeRetentionPeriods[selected];$(SELECTORS_RETENTION_FIELD).text(selectedPurpose)}.bind(this))},{init:function(purposeRetentionPeriods){return $(SELECTORS_PURPOSE_SELECT).off("change"),new EffectiveRetentionPeriod(purposeRetentionPeriods)}}}));
/**
 * JS module for the data requests filter.
 *
 * @module     tool_dataprivacy/request_filter
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/request_filter",["jquery","core/form-autocomplete","core/str","core/notification"],(function($,Autocomplete,Str,Notification){var SELECTORS_REQUEST_FILTERS="#request-filters";return{init:function(){!function(){Str.get_strings([{key:"filter",component:"moodle"},{key:"nofiltersapplied",component:"moodle"}]).then((function(langstrings){var placeholder=langstrings[0],noSelectionString=langstrings[1];return Autocomplete.enhance(SELECTORS_REQUEST_FILTERS,!1,"",placeholder,!1,!0,noSelectionString,!0)})).fail(Notification.exception);var last=$(SELECTORS_REQUEST_FILTERS).val();$(SELECTORS_REQUEST_FILTERS).on("change",(function(){var current=$(this).val();last.join(",")!==current.join(",")&&(0===current.length&&$("#filters-cleared").val(1),$(this.form).submit())}))}()}}}));
/**
 * Potential user selector module.
 *
 * @module     tool_dataprivacy/form-user-selector
 * @class      form-user-selector
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/form-user-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var users=[];return $.each(results,(function(index,user){users.push({value:user.id,label:user._label})})),users},transport:function(selector,query,success,failure){Ajax.call([{methodname:"tool_dataprivacy_get_users",args:{query:query}}])[0].then((function(results){var promises=[],i=0;return $.each(results,(function(index,user){promises.push(Templates.render("tool_dataprivacy/form-user-selector-suggestion",user))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results,(function(index,user){user._label=args[i],i++})),success(results)}))})).fail(failure)}}}));
/**
 * AMD module for categories actions.
 *
 * @module     tool_dataprivacy/categoriesactions
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/categoriesactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents){var ACTIONS_DELETE='[data-action="deletecategory"]',CategoriesActions=function(){this.registerEvents()};return CategoriesActions.prototype.registerEvents=function(){$(ACTIONS_DELETE).click((function(e){e.preventDefault();var id=$(this).data("id"),stringkeys=[{key:"deletecategory",component:"tool_dataprivacy"},{key:"deletecategorytext",component:"tool_dataprivacy",param:$(this).data("name")},{key:"delete"}];Str.get_strings(stringkeys).then((function(langStrings){var title=langStrings[0],confirmMessage=langStrings[1],buttonText=langStrings[2];return ModalFactory.create({title:title,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(buttonText),modal.getRoot().on(ModalEvents.save,(function(){var request={methodname:"tool_dataprivacy_delete_category",args:{id:id}};Ajax.call([request])[0].done((function(data){data.result?$('tr[data-categoryid="'+id+'"]').remove():Notification.addNotification({message:data.warnings[0].message,type:"error"})})).fail(Notification.exception)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(Notification.exception)}))},{init:function(){return new CategoriesActions}}}));
/**
 * Request actions.
 *
 * @module     tool_dataprivacy/requestactions
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/requestactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates","tool_dataprivacy/data_request_modal","tool_dataprivacy/events"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents,Templates,ModalDataRequest,DataPrivacyEvents){var ACTIONS_APPROVE_REQUEST='[data-action="approve"]',ACTIONS_DENY_REQUEST='[data-action="deny"]',ACTIONS_VIEW_REQUEST='[data-action="view"]',ACTIONS_MARK_COMPLETE='[data-action="complete"]',ACTIONS_CONFIRM_BULK_ACTION='[id="confirm-bulk-action"]',ACTIONS_SELECT_ALL='[data-action="selectall"]',BULK_ACTIONS_APPROVE=1,BULK_ACTIONS_DENY=2,SELECTORS_SELECT_REQUEST=".selectrequests",RequestActions=function(){this.registerEvents()};function approveEventWsData(requestId){return{wsfunction:"tool_dataprivacy_approve_data_request",wsparams:{requestid:requestId}}}function denyEventWsData(requestId){return{wsfunction:"tool_dataprivacy_deny_data_request",wsparams:{requestid:requestId}}}function showConfirmation(action,wsdata){var keys=[];switch(action){case DataPrivacyEvents.approve:keys=[{key:"approverequest",component:"tool_dataprivacy"},{key:"confirmapproval",component:"tool_dataprivacy"}];break;case DataPrivacyEvents.bulkApprove:keys=[{key:"bulkapproverequests",component:"tool_dataprivacy"},{key:"confirmbulkapproval",component:"tool_dataprivacy"}];break;case DataPrivacyEvents.deny:keys=[{key:"denyrequest",component:"tool_dataprivacy"},{key:"confirmdenial",component:"tool_dataprivacy"}];break;case DataPrivacyEvents.bulkDeny:keys=[{key:"bulkdenyrequests",component:"tool_dataprivacy"},{key:"confirmbulkdenial",component:"tool_dataprivacy"}];break;case DataPrivacyEvents.complete:keys=[{key:"markcomplete",component:"tool_dataprivacy"},{key:"confirmcompletion",component:"tool_dataprivacy"}]}var modalTitle="";Str.get_strings(keys).then((function(langStrings){modalTitle=langStrings[0];var confirmMessage=langStrings[1];return ModalFactory.create({title:modalTitle,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){modal.setSaveButtonText(modalTitle),modal.getRoot().on(ModalEvents.save,(function(){handleSave(wsdata.wsfunction,wsdata.wsparams)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()})).catch(Notification.exception)}function handleSave(wsfunction,params){var request={methodname:wsfunction,args:params};Ajax.call([request])[0].done((function(data){data.result?window.location.reload():Notification.addNotification({message:data.warnings[0].message,type:"error"})})).fail(Notification.exception)}return RequestActions.prototype.registerEvents=function(){$(ACTIONS_VIEW_REQUEST).click((function(e){e.preventDefault();var requestId=$(this).data("requestid"),request={methodname:"tool_dataprivacy_get_data_request",args:{requestid:requestId}},promises=Ajax.call([request]);$.when(promises[0]).then((function(data){return data.result?data.result:(Notification.addNotification({message:data.warnings[0].message,type:"error"}),!1)})).then((function(data){var body=Templates.render("tool_dataprivacy/request_details",data),templateContext={approvedeny:data.approvedeny,canmarkcomplete:data.canmarkcomplete};return ModalFactory.create({title:data.typename,body:body,type:ModalDataRequest.TYPE,large:!0,templateContext:templateContext})})).then((function(modal){modal.getRoot().on(DataPrivacyEvents.approve,(function(){showConfirmation(DataPrivacyEvents.approve,approveEventWsData(requestId))})),modal.getRoot().on(DataPrivacyEvents.deny,(function(){showConfirmation(DataPrivacyEvents.deny,denyEventWsData(requestId))})),modal.getRoot().on(DataPrivacyEvents.complete,(function(){handleSave("tool_dataprivacy_mark_complete",{requestid:requestId})})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()})).catch(Notification.exception)})),$(ACTIONS_APPROVE_REQUEST).click((function(e){e.preventDefault();var requestId=$(this).data("requestid");showConfirmation(DataPrivacyEvents.approve,approveEventWsData(requestId))})),$(ACTIONS_DENY_REQUEST).click((function(e){e.preventDefault();var requestId=$(this).data("requestid");showConfirmation(DataPrivacyEvents.deny,denyEventWsData(requestId))})),$(ACTIONS_MARK_COMPLETE).click((function(e){e.preventDefault();var requestId=$(this).data("requestid");showConfirmation(DataPrivacyEvents.complete,function(requestId){return{wsfunction:"tool_dataprivacy_mark_complete",wsparams:{requestid:requestId}}}(requestId))})),$(ACTIONS_CONFIRM_BULK_ACTION).click((function(){var requestIds=[],actionEvent="",wsdata={},bulkActionKeys=[{key:"selectbulkaction",component:"tool_dataprivacy"},{key:"selectdatarequests",component:"tool_dataprivacy"},{key:"ok"}],bulkaction=parseInt($("#bulk-action").val());if(bulkaction==BULK_ACTIONS_APPROVE||bulkaction==BULK_ACTIONS_DENY)if($(".selectrequests:checked").each((function(){requestIds.push($(this).val())})),requestIds.length<1)Str.get_strings(bulkActionKeys).done((function(langStrings){Notification.alert("",langStrings[1],langStrings[2])})).fail(Notification.exception);else{switch(bulkaction){case BULK_ACTIONS_APPROVE:actionEvent=DataPrivacyEvents.bulkApprove,wsdata=function(requestIds){return{wsfunction:"tool_dataprivacy_bulk_approve_data_requests",wsparams:{requestids:requestIds}}}(requestIds);break;case BULK_ACTIONS_DENY:actionEvent=DataPrivacyEvents.bulkDeny,wsdata=function(requestIds){return{wsfunction:"tool_dataprivacy_bulk_deny_data_requests",wsparams:{requestids:requestIds}}}(requestIds)}showConfirmation(actionEvent,wsdata)}else Str.get_strings(bulkActionKeys).done((function(langStrings){Notification.alert("",langStrings[0],langStrings[2])})).fail(Notification.exception)})),$(ACTIONS_SELECT_ALL).change((function(e){e.preventDefault();var selectAll=$(this).is(":checked");$(SELECTORS_SELECT_REQUEST).prop("checked",selectAll)}))},RequestActions}));
/**
 * AMD module for data registry defaults actions.
 *
 * @module     tool_dataprivacy/defaultsactions
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/defaultsactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents,Templates){var ACTIONS_EDIT_LEVEL_DEFAULTS='[data-action="edit-level-defaults"]',ACTIONS_NEW_ACTIVITY_DEFAULTS='[data-action="new-activity-defaults"]',ACTIONS_EDIT_ACTIVITY_DEFAULTS='[data-action="edit-activity-defaults"]',ACTIONS_DELETE_ACTIVITY_DEFAULTS='[data-action="delete-activity-defaults"]',DefaultsActions=function(){this.registerEvents()};function showDefaultsFormModal(title,contextLevel,category,purpose,activity,categoryOptions,purposeOptions,activityOptions){null!==category&&categoryOptions.forEach((function(currentValue){currentValue.id===category&&(currentValue.selected=!0)})),null!==purpose&&purposeOptions.forEach((function(currentValue){currentValue.id===purpose&&(currentValue.selected=!0)}));var templateContext={contextlevel:contextLevel,categoryoptions:categoryOptions,purposeoptions:purposeOptions};null!==activityOptions&&activityOptions.length&&(null===activity?templateContext.newactivitydefaults=!0:activityOptions.forEach((function(currentValue){activity===currentValue.name&&(currentValue.selected=!0)})),templateContext.modemodule=!0,templateContext.activityoptions=activityOptions),ModalFactory.create({title:title,body:Templates.render("tool_dataprivacy/category_purpose_form",templateContext),type:ModalFactory.types.SAVE_CANCEL,large:!0}).then((function(modal){return modal.getRoot().on(ModalEvents.save,(function(){var activity=$("#activity"),activityVal=void 0!==activity?activity.val():null,override=$("#override"),overrideVal=void 0!==override&&override.is(":checked");setContextDefaults($("#contextlevel").val(),$("#category").val(),$("#purpose").val(),activityVal,overrideVal)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),modal})).catch(Notification.exception)}function setContextDefaults(contextLevel,category,purpose,activity,override){var request={methodname:"tool_dataprivacy_set_context_defaults",args:{contextlevel:contextLevel,category:category,purpose:purpose,override:override,activity:activity}};Ajax.call([request])[0].done((function(data){data.result&&window.location.reload()}))}return DefaultsActions.prototype.registerEvents=function(){$(ACTIONS_EDIT_LEVEL_DEFAULTS).click((function(e){e.preventDefault();var button=$(this),contextLevel=button.data("contextlevel"),category=button.data("category"),purpose=button.data("purpose"),promises=Ajax.call([{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}}]),titlePromise=Str.get_string("editdefaults","tool_dataprivacy",$("#defaults-header").text());$.when(promises[0],promises[1],titlePromise).then((function(categoryResponse,purposeResponse,title){var categories=categoryResponse.options,purposes=purposeResponse.options;return showDefaultsFormModal(title,contextLevel,category,purpose,null,categories,purposes,null),!0})).catch(Notification.exception)})),$(ACTIONS_NEW_ACTIVITY_DEFAULTS).click((function(e){e.preventDefault();var contextLevel=$(this).data("contextlevel"),promises=Ajax.call([{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}},{methodname:"tool_dataprivacy_get_activity_options",args:{nodefaults:!0}}]),titlePromise=Str.get_string("addnewdefaults","tool_dataprivacy");$.when(promises[0],promises[1],promises[2],titlePromise).then((function(categoryResponse,purposeResponse,activityResponse,title){var categories=categoryResponse.options,purposes=purposeResponse.options,activities=activityResponse.options;return showDefaultsFormModal(title,contextLevel,null,null,null,categories,purposes,activities),!0})).catch(Notification.exception)})),$(ACTIONS_EDIT_ACTIVITY_DEFAULTS).click((function(e){e.preventDefault();var button=$(this),contextLevel=button.data("contextlevel"),category=button.data("category"),purpose=button.data("purpose"),activity=button.data("activityname"),promises=Ajax.call([{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}},{methodname:"tool_dataprivacy_get_activity_options",args:{}}]),titlePromise=Str.get_string("editmoduledefaults","tool_dataprivacy");$.when(promises[0],promises[1],promises[2],titlePromise).then((function(categoryResponse,purposeResponse,activityResponse,title){var categories=categoryResponse.options,purposes=purposeResponse.options,activities=activityResponse.options;return showDefaultsFormModal(title,contextLevel,category,purpose,activity,categories,purposes,activities),!0})).catch(Notification.exception)})),$(ACTIONS_DELETE_ACTIVITY_DEFAULTS).click((function(e){e.preventDefault();var button=$(this),contextLevel=button.data("contextlevel"),activity=button.data("activityname"),activityDisplayName=button.data("activitydisplayname");ModalFactory.create({title:Str.get_string("deletedefaults","tool_dataprivacy",activityDisplayName),body:Templates.render("tool_dataprivacy/delete_activity_defaults",{activityname:activityDisplayName}),type:ModalFactory.types.SAVE_CANCEL,large:!0}).then((function(modal){return modal.setSaveButtonText(Str.get_string("delete")),modal.getRoot().on(ModalEvents.save,(function(){setContextDefaults(contextLevel,-1,-1,activity,!1)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),!0})).catch(Notification.exception)}))},{init:function(){return new DefaultsActions}}}));
/**
 * Contain the events the data privacy tool can fire.
 *
 * @module     tool_dataprivacy/events
 * @class      events
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/events",[],(function(){return{approve:"tool_dataprivacy-data_request:approve",bulkApprove:"tool_dataprivacy-data_request:bulk_approve",deny:"tool_dataprivacy-data_request:deny",bulkDeny:"tool_dataprivacy-data_request:bulk_deny",complete:"tool_dataprivacy-data_request:complete"}}));
/**
 * Potential user selector module.
 *
 * @module     tool_dataprivacy/expand_contract
 * @class      page-expand-contract
 * @package    tool_dataprivacy
 * @copyright  2018 Adrian Greeve
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/expand_contract",["jquery","core/url","core/str"],(function($,url,str){var expandedImage=$('<img alt="" src="'+url.imageUrl("t/expanded")+'"/>'),collapsedImage=$('<img alt="" src="'+url.imageUrl("t/collapsed")+'"/>'),CLASSES_EXPAND="fa-caret-right",CLASSES_COLLAPSE="fa-caret-down";return{expandCollapse:function(targetnode,thisnode){targetnode.hasClass("hide")?(targetnode.removeClass("hide"),targetnode.addClass("visible"),targetnode.attr("aria-expanded",!0),thisnode.find(":header i.fa").removeClass(CLASSES_EXPAND),thisnode.find(":header i.fa").addClass(CLASSES_COLLAPSE),thisnode.find(":header img.icon").attr("src",expandedImage.attr("src"))):(targetnode.removeClass("visible"),targetnode.addClass("hide"),targetnode.attr("aria-expanded",!1),thisnode.find(":header i.fa").removeClass(CLASSES_COLLAPSE),thisnode.find(":header i.fa").addClass(CLASSES_EXPAND),thisnode.find(":header img.icon").attr("src",collapsedImage.attr("src")))},expandCollapseAll:function(nextstate){var currentstate="visible"==nextstate?"hide":"visible",ariaexpandedstate="visible"==nextstate,iconclassnow="visible"==nextstate?CLASSES_EXPAND:CLASSES_COLLAPSE,iconclassnext="visible"==nextstate?CLASSES_COLLAPSE:CLASSES_EXPAND,imagenow="visible"==nextstate?expandedImage.attr("src"):collapsedImage.attr("src");$("."+currentstate).each((function(){$(this).removeClass(currentstate),$(this).addClass(nextstate),$(this).attr("aria-expanded",ariaexpandedstate)})),$(".tool_dataprivacy-expand-all").data("visibilityState",currentstate),str.get_string(currentstate,"tool_dataprivacy").then((function(langString){$(".tool_dataprivacy-expand-all").html(langString)})).catch(Notification.exception),$(":header i.fa").each((function(){$(this).removeClass(iconclassnow),$(this).addClass(iconclassnext)})),$(":header img.icon").each((function(){$(this).attr("src",imagenow)}))}}}));
/**
 * AMD module to enable users to manage their own data requests.
 *
 * @module     tool_dataprivacy/myrequestactions
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/myrequestactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates","core/pending"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents,Templates,Pending){var ACTIONS_CANCEL_REQUEST='[data-action="cancel"]',ACTIONS_CONTACT_DPO='[data-action="contactdpo"]',MyRequestActions=function(){this.registerEvents()};return MyRequestActions.prototype.registerEvents=function(){$(ACTIONS_CANCEL_REQUEST).click((function(e){e.preventDefault();var requestId=$(this).data("requestid");Str.get_strings([{key:"cancelrequest",component:"tool_dataprivacy"},{key:"cancelrequestconfirmation",component:"tool_dataprivacy"}]).then((function(langStrings){var title=langStrings[0],confirmMessage=langStrings[1];return ModalFactory.create({title:title,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(title),modal.getRoot().on(ModalEvents.save,(function(){var request={methodname:"tool_dataprivacy_cancel_data_request",args:{requestid:requestId}};Ajax.call([request])[0].done((function(data){data.result?window.location.reload():Notification.addNotification({message:data.warnings[0].message,type:"error"})})).fail(Notification.exception)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(Notification.exception)})),$(ACTIONS_CONTACT_DPO).click((function(e){var pendingPromise=new Pending("dataprivacy/crud:initModal:contactdpo");e.preventDefault();var replyToEmail=$(this).data("replytoemail"),sendButtonText="";Str.get_strings([{key:"contactdataprotectionofficer",component:"tool_dataprivacy"},{key:"send",component:"tool_dataprivacy"}]).then((function(langStrings){var modalTitle=langStrings[0];sendButtonText=langStrings[1];var context={replytoemail:replyToEmail};return ModalFactory.create({title:modalTitle,body:Templates.render("tool_dataprivacy/contact_dpo",context),type:ModalFactory.types.SAVE_CANCEL,large:!0})})).then((function(modal){modal.setSaveButtonText(sendButtonText),modal.show(),modal.getRoot().on(ModalEvents.save,(function(e){var message=$("#message").val().trim();0===message.length?(e.preventDefault(),$('[data-region="messageinput"]').addClass("has-danger notifyproblem"),$("#id_error_message").removeAttr("hidden")):function(message){var request={methodname:"tool_dataprivacy_contact_dpo",args:{message:message}},requestType="success";Ajax.call([request])[0].then((function(data){return data.result?Str.get_string("requestsubmitted","tool_dataprivacy"):(requestType="error",data.warnings.join("<br>"))})).done((function(message){Notification.addNotification({message:message,type:requestType})})).fail(Notification.exception)}(message)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()}))})).then(pendingPromise.resolve).catch(Notification.exception)}))},{init:function(){return new MyRequestActions}}}));
/**
 * Module to add purposes.
 *
 * @module     tool_dataprivacy/add_purpose
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/add_purpose",["jquery","core/str","core/ajax","core/notification","core/modal_factory","core/modal_events","core/fragment"],(function($,Str,Ajax,Notification,ModalFactory,ModalEvents,Fragment){var SELECTORS_PURPOSE_LINK='[data-add-element="purpose"]',AddPurpose=function(contextId){this.contextId=contextId;this.strings=Str.get_strings([{key:"addpurpose",component:"tool_dataprivacy"},{key:"save",component:"admin"}]),this.registerEventListeners()};return AddPurpose.prototype.contextId=0,AddPurpose.prototype.strings=0,AddPurpose.prototype.registerEventListeners=function(){var trigger=$(SELECTORS_PURPOSE_LINK);trigger.on("click",function(){return this.strings.then(function(strings){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:strings[0],body:""},trigger).done(function(modal){this.setupFormModal(modal,strings[1])}.bind(this))}.bind(this)).fail(Notification.exception)}.bind(this))},AddPurpose.prototype.getBody=function(formdata){var params=null;return void 0!==formdata&&(params={jsonformdata:JSON.stringify(formdata)}),Fragment.loadFragment("tool_dataprivacy","addpurpose_form",this.contextId,params)},AddPurpose.prototype.setupFormModal=function(modal,saveText){modal.setLarge(),modal.setSaveButtonText(saveText),modal.getRoot().on(ModalEvents.hidden,this.destroy.bind(this)),modal.setBody(this.getBody()),modal.getRoot().on(ModalEvents.save,this.submitForm.bind(this)),modal.getRoot().on("submit","form",this.submitFormAjax.bind(this)),this.modal=modal,modal.show()},AddPurpose.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find("form").submit()},AddPurpose.prototype.submitFormAjax=function(e){e.preventDefault();var formData=this.modal.getRoot().find("form").serialize();Ajax.call([{methodname:"tool_dataprivacy_create_purpose_form",args:{jsonformdata:JSON.stringify(formData)},done:function(data){data.validationerrors?this.modal.setBody(this.getBody(formData)):this.close()}.bind(this),fail:Notification.exception}])},AddPurpose.prototype.close=function(){this.destroy(),document.location.reload()},AddPurpose.prototype.destroy=function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),this.modal.destroy()},AddPurpose.prototype.removeListeners=function(){$(SELECTORS_PURPOSE_LINK).off("click")},{getInstance:function(contextId){return new AddPurpose(contextId)}}}));
/**
 * Request actions.
 *
 * @module     tool_dataprivacy/data_deletion
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/data_deletion",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents){var ACTIONS_MARK_FOR_DELETION='[data-action="markfordeletion"]',ACTIONS_SELECT_ALL='[data-action="selectall"]',SELECTORS_SELECTCONTEXT=".selectcontext",DataDeletionActions=function(){this.registerEvents()};return DataDeletionActions.prototype.registerEvents=function(){$(ACTIONS_MARK_FOR_DELETION).click((function(e){e.preventDefault();var ids,keys,wsfunction,modalTitle,selectedIds=[];$(SELECTORS_SELECTCONTEXT).each((function(){var checkbox=$(this);checkbox.is(":checked")&&selectedIds.push(checkbox.val())})),ids=selectedIds,keys=[{key:"confirm",component:"moodle"},{key:"confirmcontextdeletion",component:"tool_dataprivacy"}],wsfunction="tool_dataprivacy_confirm_contexts_for_deletion",modalTitle="",Str.get_strings(keys).then((function(langStrings){modalTitle=langStrings[0];var confirmMessage=langStrings[1];return ModalFactory.create({title:modalTitle,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){return modal.setSaveButtonText(modalTitle),modal.getRoot().on(ModalEvents.save,(function(){var request={methodname:wsfunction,args:{ids:ids}};Ajax.call([request])[0].done((function(data){data.result?window.location.reload():Notification.addNotification({message:data.warnings[0].message,type:"error"})})).fail(Notification.exception)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal})).done((function(modal){modal.show()})).fail(Notification.exception)})),$(ACTIONS_SELECT_ALL).change((function(e){e.preventDefault(),$(this).is(":checked")?$(SELECTORS_SELECTCONTEXT).attr("checked","checked"):$(SELECTORS_SELECTCONTEXT).removeAttr("checked")}))},DataDeletionActions}));
/**
 * AMD module for purposes actions.
 *
 * @module     tool_dataprivacy/purposesactions
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/purposesactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents){var ACTIONS_DELETE='[data-action="deletepurpose"]',PurposesActions=function(){this.registerEvents()};return PurposesActions.prototype.registerEvents=function(){$(ACTIONS_DELETE).click((function(e){e.preventDefault();var id=$(this).data("id"),stringkeys=[{key:"deletepurpose",component:"tool_dataprivacy"},{key:"deletepurposetext",component:"tool_dataprivacy",param:$(this).data("name")},{key:"delete"}];Str.get_strings(stringkeys).then((function(langStrings){var title=langStrings[0],confirmMessage=langStrings[1],buttonText=langStrings[2];return ModalFactory.create({title:title,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(buttonText),modal.getRoot().on(ModalEvents.save,(function(){var request={methodname:"tool_dataprivacy_delete_purpose",args:{id:id}};Ajax.call([request])[0].done((function(data){data.result?$('tr[data-purposeid="'+id+'"]').remove():Notification.addNotification({message:data.warnings[0].message,type:"error"})})).fail(Notification.exception)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(Notification.exception)}))},{init:function(){return new PurposesActions}}}));
/**
 * Module to add categories.
 *
 * @module     tool_dataprivacy/add_category
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/add_category",["jquery","core/str","core/ajax","core/notification","core/modal_factory","core/modal_events","core/fragment"],(function($,Str,Ajax,Notification,ModalFactory,ModalEvents,Fragment){var SELECTORS_CATEGORY_LINK='[data-add-element="category"]',AddCategory=function(contextId){this.contextId=contextId;this.strings=Str.get_strings([{key:"addcategory",component:"tool_dataprivacy"},{key:"save",component:"admin"}]),this.registerEventListeners()};return AddCategory.prototype.contextId=0,AddCategory.prototype.strings=0,AddCategory.prototype.registerEventListeners=function(){var trigger=$(SELECTORS_CATEGORY_LINK);trigger.on("click",function(){return this.strings.then(function(strings){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:strings[0],body:""},trigger).done(function(modal){this.setupFormModal(modal,strings[1])}.bind(this))}.bind(this)).fail(Notification.exception)}.bind(this))},AddCategory.prototype.getBody=function(formdata){var params=null;return void 0!==formdata&&(params={jsonformdata:JSON.stringify(formdata)}),Fragment.loadFragment("tool_dataprivacy","addcategory_form",this.contextId,params)},AddCategory.prototype.setupFormModal=function(modal,saveText){modal.setLarge(),modal.setSaveButtonText(saveText),modal.getRoot().on(ModalEvents.hidden,this.destroy.bind(this)),modal.setBody(this.getBody()),modal.getRoot().on(ModalEvents.save,this.submitForm.bind(this)),modal.getRoot().on("submit","form",this.submitFormAjax.bind(this)),this.modal=modal,modal.show()},AddCategory.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find("form").submit()},AddCategory.prototype.submitFormAjax=function(e){e.preventDefault();var formData=this.modal.getRoot().find("form").serialize();Ajax.call([{methodname:"tool_dataprivacy_create_category_form",args:{jsonformdata:JSON.stringify(formData)},done:function(data){data.validationerrors?this.modal.setBody(this.getBody(formData)):this.close()}.bind(this),fail:Notification.exception}])},AddCategory.prototype.close=function(){this.destroy(),document.location.reload()},AddCategory.prototype.destroy=function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),this.modal.destroy()},AddCategory.prototype.removeListeners=function(){$(SELECTORS_CATEGORY_LINK).off("click")},{getInstance:function(contextId){return new AddCategory(contextId)}}}));
/**
 * Modal for confirming deletion of a custom license.
 *
 * @module     tool_licensemanager/delete_license
 * @class      delete_license
 * @package    tool_licensemanager
 * @copyright  2019 Tom Dickman <tomdickman@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_licensemanager/delete_license",["jquery","core/modal_factory","core/modal_events","core/url","core/str"],(function($,ModalFactory,ModalEvents,Url,String){var trigger=$(".delete-license");ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:String.get_string("deletelicense","tool_licensemanager"),body:String.get_string("deletelicenseconfirmmessage","tool_licensemanager"),preShowCallback:function(triggerElement,modal){var params={action:"delete",license:(triggerElement=$(triggerElement)).data("license")};modal.deleteURL=Url.relativeUrl("/admin/tool/licensemanager/index.php",params,!0)},large:!0},trigger).done((function(modal){modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),window.location.href=modal.deleteURL}))}))}));
/**
 * Module to open user competency plan in popup
 *
 * @package    report_competency
 * @copyright  2016 Issam Taboubi <issam.taboubi@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/user_competency_plan_popup",["jquery","core/notification","core/str","core/ajax","core/templates","tool_lp/dialogue"],(function($,notification,str,ajax,templates,Dialogue){var UserCompetencyPopup=function(regionSelector,userCompetencySelector,planId){this._regionSelector=regionSelector,this._userCompetencySelector=userCompetencySelector,this._planId=planId,$(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};return UserCompetencyPopup.prototype._handleClick=function(e){e.preventDefault();var tr=$(e.target).closest("tr"),competencyId=$(tr).data("competencyid"),userId=$(tr).data("userid"),planId=this._planId;ajax.call([{methodname:"tool_lp_data_for_user_competency_summary_in_plan",args:{competencyid:competencyId,planid:planId},done:this._contextLoaded.bind(this),fail:notification.exception}])[0].then((function(result){var eventMethodName="core_competency_user_competency_viewed_in_plan";return result.plan.iscompleted&&(eventMethodName="core_competency_user_competency_plan_viewed"),ajax.call([{methodname:eventMethodName,args:{competencyid:competencyId,userid:userId,planid:planId}}])[0]})).catch(notification.exception)},UserCompetencyPopup.prototype._contextLoaded=function(context){var self=this;templates.render("tool_lp/user_competency_summary_in_plan",context).done((function(html,js){str.get_string("usercompetencysummary","report_competency").done((function(title){new Dialogue(title,html,templates.runTemplateJS.bind(templates,js),self._refresh.bind(self),!0)})).fail(notification.exception)})).fail(notification.exception)},UserCompetencyPopup.prototype._refresh=function(){var planId=this._planId;ajax.call([{methodname:"tool_lp_data_for_plan_page",args:{planid:planId},done:this._pageContextLoaded.bind(this),fail:notification.exception}])},UserCompetencyPopup.prototype._pageContextLoaded=function(context){var self=this;templates.render("tool_lp/plan_page",context).done((function(html,js){templates.replaceNode(self._regionSelector,html,js)})).fail(notification.exception)},UserCompetencyPopup.prototype._regionSelector=null,UserCompetencyPopup.prototype._userCompetencySelector=null,UserCompetencyPopup.prototype._planId=null,UserCompetencyPopup}));
/**
 * Plan actions via ajax.
 *
 * @module     tool_lp/planactions
 * @package    tool_lp
 * @copyright  2015 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/planactions",["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/dialogue"],(function($,templates,ajax,notification,str,Menubar,Dialogue){var PlanActions=function(type){if(this._type=type,"plan"===type)this._region='[data-region="plan-page"]',this._planNode='[data-region="plan-page"]',this._template="tool_lp/plan_page",this._contextMethod="tool_lp_data_for_plan_page";else{if("plans"!==type)throw new TypeError("Unexpected type.");this._region='[data-region="plans"]',this._planNode='[data-region="plan-node"]',this._template="tool_lp/plans_page",this._contextMethod="tool_lp_data_for_plans_page"}};return PlanActions.prototype._contextMethod=null,PlanActions.prototype._planNode=null,PlanActions.prototype._region=null,PlanActions.prototype._template=null,PlanActions.prototype._type=null,PlanActions.prototype._getContextArgs=function(planData){var args={};return"plan"===this._type?args={planid:planData.id}:"plans"===this._type&&(args={userid:planData.userid}),args},PlanActions.prototype.refresh=function(selector){var planData=this._findPlanData($(selector));this._callAndRefresh([],planData)},PlanActions.prototype._renderView=function(context){var self=this;return templates.render(self._template,context).then((function(newhtml,newjs){$(self._region).replaceWith(newhtml),templates.runTemplateJS(newjs)}))},PlanActions.prototype._callAndRefresh=function(calls,planData){var callKey="tool_lp/planactions:_callAndRefresh-"+Math.floor(Math.random()*Math.floor(1e3));M.util.js_pending(callKey);var self=this;return calls.push({methodname:self._contextMethod,args:self._getContextArgs(planData)}),$.when.apply($,ajax.call(calls)).then((function(){return self._renderView(arguments[arguments.length-1])})).fail(notification.exception).always((function(){return M.util.js_complete(callKey)}))},PlanActions.prototype._doDelete=function(planData){var calls=[{methodname:"core_competency_delete_plan",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.deletePlan=function(planData){var self=this;ajax.call([{methodname:"core_competency_read_plan",args:{id:planData.id}}])[0].done((function(plan){str.get_strings([{key:"confirm",component:"moodle"},{key:"deleteplan",component:"tool_lp",param:plan.name},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doDelete(planData)}))})).fail(notification.exception)})).fail(notification.exception)},PlanActions.prototype._doReopenPlan=function(planData){var calls=[{methodname:"core_competency_reopen_plan",args:{planid:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.reopenPlan=function(planData){var self=this;ajax.call([{methodname:"core_competency_read_plan",args:{id:planData.id}}])[0].done((function(plan){str.get_strings([{key:"confirm",component:"moodle"},{key:"reopenplanconfirm",component:"tool_lp",param:plan.name},{key:"reopenplan",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doReopenPlan(planData)}))})).fail(notification.exception)})).fail(notification.exception)},PlanActions.prototype._doCompletePlan=function(planData){var calls=[{methodname:"core_competency_complete_plan",args:{planid:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.completePlan=function(planData){var self=this;ajax.call([{methodname:"core_competency_read_plan",args:{id:planData.id}}])[0].done((function(plan){str.get_strings([{key:"confirm",component:"moodle"},{key:"completeplanconfirm",component:"tool_lp",param:plan.name},{key:"completeplan",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doCompletePlan(planData)}))})).fail(notification.exception)})).fail(notification.exception)},PlanActions.prototype._doUnlinkPlan=function(planData){var calls=[{methodname:"core_competency_unlink_plan_from_template",args:{planid:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.unlinkPlan=function(planData){var self=this;ajax.call([{methodname:"core_competency_read_plan",args:{id:planData.id}}])[0].done((function(plan){str.get_strings([{key:"confirm",component:"moodle"},{key:"unlinkplantemplateconfirm",component:"tool_lp",param:plan.name},{key:"unlinkplantemplate",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doUnlinkPlan(planData)}))})).fail(notification.exception)})).fail(notification.exception)},PlanActions.prototype._doRequestReview=function(planData){var calls=[{methodname:"core_competency_plan_request_review",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.requestReview=function(planData){this._doRequestReview(planData)},PlanActions.prototype._doCancelReviewRequest=function(planData){var calls=[{methodname:"core_competency_plan_cancel_review_request",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.cancelReviewRequest=function(planData){this._doCancelReviewRequest(planData)},PlanActions.prototype._doStartReview=function(planData){var calls=[{methodname:"core_competency_plan_start_review",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.startReview=function(planData){this._doStartReview(planData)},PlanActions.prototype._doStopReview=function(planData){var calls=[{methodname:"core_competency_plan_stop_review",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.stopReview=function(planData){this._doStopReview(planData)},PlanActions.prototype._doApprove=function(planData){var calls=[{methodname:"core_competency_approve_plan",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.approve=function(planData){this._doApprove(planData)},PlanActions.prototype._doUnapprove=function(planData){var calls=[{methodname:"core_competency_unapprove_plan",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.unapprove=function(planData){this._doUnapprove(planData)},PlanActions.prototype._showLinkedCoursesHandler=function(e){e.preventDefault();var competencyid=$(e.target).data("id");ajax.call([{methodname:"tool_lp_list_courses_using_competency",args:{id:competencyid}}])[0].done((function(courses){var context={courses:courses};templates.render("tool_lp/linked_courses_summary",context).done((function(html){str.get_string("linkedcourses","tool_lp").done((function(linkedcourses){new Dialogue(linkedcourses,html)})).fail(notification.exception)})).fail(notification.exception)})).fail(notification.exception)},PlanActions.prototype._eventHandler=function(method,e){e.preventDefault();var data=this._findPlanData($(e.target));this[method](data)},PlanActions.prototype._findPlanData=function(node){var data,parent=node.parentsUntil($(this._region).parent(),this._planNode);if(1!=parent.length)throw new Error("The plan node was not located.");if(void 0===(data=parent.data())||void 0===data.id)throw new Error("Plan data could not be found.");return data},PlanActions.prototype.enhanceMenubar=function(selector){Menubar.enhance(selector,{'[data-action="plan-delete"]':this._eventHandler.bind(this,"deletePlan"),'[data-action="plan-complete"]':this._eventHandler.bind(this,"completePlan"),'[data-action="plan-reopen"]':this._eventHandler.bind(this,"reopenPlan"),'[data-action="plan-unlink"]':this._eventHandler.bind(this,"unlinkPlan"),'[data-action="plan-request-review"]':this._eventHandler.bind(this,"requestReview"),'[data-action="plan-cancel-review-request"]':this._eventHandler.bind(this,"cancelReviewRequest"),'[data-action="plan-start-review"]':this._eventHandler.bind(this,"startReview"),'[data-action="plan-stop-review"]':this._eventHandler.bind(this,"stopReview"),'[data-action="plan-approve"]':this._eventHandler.bind(this,"approve"),'[data-action="plan-unapprove"]':this._eventHandler.bind(this,"unapprove")})},PlanActions.prototype.registerEvents=function(){var wrapper=$(this._region);wrapper.find('[data-action="plan-delete"]').click(this._eventHandler.bind(this,"deletePlan")),wrapper.find('[data-action="plan-complete"]').click(this._eventHandler.bind(this,"completePlan")),wrapper.find('[data-action="plan-reopen"]').click(this._eventHandler.bind(this,"reopenPlan")),wrapper.find('[data-action="plan-unlink"]').click(this._eventHandler.bind(this,"unlinkPlan")),wrapper.find('[data-action="plan-request-review"]').click(this._eventHandler.bind(this,"requestReview")),wrapper.find('[data-action="plan-cancel-review-request"]').click(this._eventHandler.bind(this,"cancelReviewRequest")),wrapper.find('[data-action="plan-start-review"]').click(this._eventHandler.bind(this,"startReview")),wrapper.find('[data-action="plan-stop-review"]').click(this._eventHandler.bind(this,"stopReview")),wrapper.find('[data-action="plan-approve"]').click(this._eventHandler.bind(this,"approve")),wrapper.find('[data-action="plan-unapprove"]').click(this._eventHandler.bind(this,"unapprove")),wrapper.find('[data-action="find-courses-link"]').click(this._showLinkedCoursesHandler.bind(this))},PlanActions}));
/**
 * User evidence actions.
 *
 * @module     tool_lp/user_evidence_actions
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/user_evidence_actions",["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/competencypicker_user_plans"],(function($,templates,ajax,notification,str,Menubar,PickerUserPlans){var UserEvidenceActions=function(type){if(this._type=type,"evidence"===type)this._region='[data-region="user-evidence-page"]',this._evidenceNode='[data-region="user-evidence-page"]',this._template="tool_lp/user_evidence_page",this._contextMethod="tool_lp_data_for_user_evidence_page";else{if("list"!==type)throw new TypeError("Unexpected type.");this._region='[data-region="user-evidence-list"]',this._evidenceNode='[data-region="user-evidence-node"]',this._template="tool_lp/user_evidence_list_page",this._contextMethod="tool_lp_data_for_user_evidence_list_page"}};return UserEvidenceActions.prototype._contextMethod=null,UserEvidenceActions.prototype._evidenceNode=null,UserEvidenceActions.prototype._region=null,UserEvidenceActions.prototype._template=null,UserEvidenceActions.prototype._type=null,UserEvidenceActions.prototype._getContextArgs=function(evidenceData){var args={};return"evidence"===this._type?args={id:evidenceData.id}:"list"===this._type&&(args={userid:evidenceData.userid}),args},UserEvidenceActions.prototype._renderView=function(context){var self=this;return templates.render(self._template,context).then((function(newhtml,newjs){templates.replaceNode($(self._region),newhtml,newjs)}))},UserEvidenceActions.prototype._callAndRefresh=function(calls,evidenceData){var self=this;return calls.push({methodname:self._contextMethod,args:self._getContextArgs(evidenceData)}),$.when.apply($.when,ajax.call(calls)).then((function(){return self._renderView(arguments[arguments.length-1])})).fail(notification.exception)},UserEvidenceActions.prototype._doDelete=function(evidenceData){var calls=[{methodname:"core_competency_delete_user_evidence",args:{id:evidenceData.id}}];this._callAndRefresh(calls,evidenceData)},UserEvidenceActions.prototype.deleteEvidence=function(evidenceData){var self=this;ajax.call([{methodname:"core_competency_read_user_evidence",args:{id:evidenceData.id}}])[0].done((function(evidence){str.get_strings([{key:"confirm",component:"moodle"},{key:"deleteuserevidence",component:"tool_lp",param:evidence.name},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doDelete(evidenceData)}))})).fail(notification.exception)})).fail(notification.exception)},UserEvidenceActions.prototype._deleteEvidenceHandler=function(e){e.preventDefault();var data=this._findEvidenceData($(e.target));this.deleteEvidence(data)},UserEvidenceActions.prototype._doCreateUserEvidenceCompetency=function(evidenceData,competencyIds){var calls=[];$.each(competencyIds,(function(index,competencyId){calls.push({methodname:"core_competency_create_user_evidence_competency",args:{userevidenceid:evidenceData.id,competencyid:competencyId}})})),this._callAndRefresh(calls,evidenceData)},UserEvidenceActions.prototype.createUserEvidenceCompetency=function(evidenceData){var self=this,picker=new PickerUserPlans(evidenceData.userid);picker.on("save",(function(e,data){var competencyIds=data.competencyIds;self._doCreateUserEvidenceCompetency(evidenceData,competencyIds,data.requestReview)})),picker.display()},UserEvidenceActions.prototype._createUserEvidenceCompetencyHandler=function(e){e.preventDefault();var data=this._findEvidenceData($(e.target));this.createUserEvidenceCompetency(data)},UserEvidenceActions.prototype._doDeleteUserEvidenceCompetency=function(evidenceData,competencyId){var calls=[];calls.push({methodname:"core_competency_delete_user_evidence_competency",args:{userevidenceid:evidenceData.id,competencyid:competencyId}}),this._callAndRefresh(calls,evidenceData)},UserEvidenceActions.prototype.deleteUserEvidenceCompetency=function(evidenceData,competencyId){this._doDeleteUserEvidenceCompetency(evidenceData,competencyId)},UserEvidenceActions.prototype._deleteUserEvidenceCompetencyHandler=function(e){var data=this._findEvidenceData($(e.currentTarget)),competencyId=$(e.currentTarget).data("id");e.preventDefault(),this.deleteUserEvidenceCompetency(data,competencyId)},UserEvidenceActions.prototype._doReviewUserEvidenceCompetencies=function(evidenceData){var calls=[{methodname:"core_competency_request_review_of_user_evidence_linked_competencies",args:{id:evidenceData.id}}];this._callAndRefresh(calls,evidenceData)},UserEvidenceActions.prototype.reviewUserEvidenceCompetencies=function(evidenceData){var self=this;ajax.call([{methodname:"core_competency_read_user_evidence",args:{id:evidenceData.id}}])[0].done((function(evidence){str.get_strings([{key:"confirm",component:"moodle"},{key:"sendallcompetenciestoreview",component:"tool_lp",param:evidence.name},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doReviewUserEvidenceCompetencies(evidenceData)}))})).fail(notification.exception)})).fail(notification.exception)},UserEvidenceActions.prototype._reviewUserEvidenceCompetenciesHandler=function(e){e.preventDefault();var data=this._findEvidenceData($(e.target));this.reviewUserEvidenceCompetencies(data)},UserEvidenceActions.prototype._findEvidenceData=function(node){var data,parent=node.parentsUntil($(this._region).parent(),this._evidenceNode);if(1!=parent.length)throw new Error("The evidence node was not located.");if(void 0===(data=parent.data())||void 0===data.id)throw new Error("Evidence data could not be found.");return data},UserEvidenceActions.prototype.enhanceMenubar=function(selector){Menubar.enhance(selector,{'[data-action="user-evidence-delete"]':this._deleteEvidenceHandler.bind(this),'[data-action="link-competency"]':this._createUserEvidenceCompetencyHandler.bind(this),'[data-action="send-competencies-review"]':this._reviewUserEvidenceCompetenciesHandler.bind(this)})},UserEvidenceActions.prototype.registerEvents=function(){var wrapper=$(this._region);wrapper.find('[data-action="user-evidence-delete"]').click(this._deleteEvidenceHandler.bind(this)),wrapper.find('[data-action="link-competency"]').click(this._createUserEvidenceCompetencyHandler.bind(this)),wrapper.find('[data-action="delete-competency-link"]').click(this._deleteUserEvidenceCompetencyHandler.bind(this)),wrapper.find('[data-action="send-competencies-review"]').click(this._reviewUserEvidenceCompetenciesHandler.bind(this))},UserEvidenceActions}));
/**
 * Handle add/remove competency links.
 *
 * @module     tool_lp/competencies
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencies",["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/competencypicker","tool_lp/dragdrop-reorder","core/pending"],(function($,notification,ajax,templates,str,Picker,dragdrop,Pending){var competencies=function(itemid,itemtype,pagectxid){this.itemid=itemid,this.itemtype=itemtype,this.pageContextId=pagectxid,this.pickerInstance=null,$('[data-region="actions"] button').prop("disabled",!1),this.registerEvents(),this.registerDragDrop()};return competencies.prototype.registerDragDrop=function(){var localthis=this;str.get_string("movecompetency","tool_lp").done((function(movestring){dragdrop.dragdrop("movecompetency",movestring,{identifier:"movecompetency",component:"tool_lp"},{identifier:"movecompetencyafter",component:"tool_lp"},"drag-samenode","drag-parentnode","drag-handlecontainer",(function(drag,drop){localthis.handleDrop(drag,drop)}))})).fail(notification.exception)},competencies.prototype.handleDrop=function(drag,drop){var fromid=$(drag).data("id"),toid=$(drop).data("id"),requests=[];if("course"==this.itemtype)requests=ajax.call([{methodname:"core_competency_reorder_course_competency",args:{courseid:this.itemid,competencyidfrom:fromid,competencyidto:toid}}]);else if("template"==this.itemtype)requests=ajax.call([{methodname:"core_competency_reorder_template_competency",args:{templateid:this.itemid,competencyidfrom:fromid,competencyidto:toid}}]);else{if("plan"!=this.itemtype)return;requests=ajax.call([{methodname:"core_competency_reorder_plan_competency",args:{planid:this.itemid,competencyidfrom:fromid,competencyidto:toid}}])}requests[0].fail(notification.exception)},competencies.prototype.pickCompetency=function(){var requests,pagerender,pageregion,pageContextIncludes,self=this;return self.pickerInstance||("template"!==self.itemtype&&"course"!==self.itemtype||(pageContextIncludes="parents"),self.pickerInstance=new Picker(self.pageContextId,!1,pageContextIncludes),self.pickerInstance.on("save",(function(e,data){var compIds=data.competencyIds,pendingPromise=new Pending;"course"===self.itemtype?(requests=[],$.each(compIds,(function(index,compId){requests.push({methodname:"core_competency_add_competency_to_course",args:{courseid:self.itemid,competencyid:compId}})})),requests.push({methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:self.itemid,moduleid:0}}),pagerender="tool_lp/course_competencies_page",pageregion="coursecompetenciespage"):"template"===self.itemtype?(requests=[],$.each(compIds,(function(index,compId){requests.push({methodname:"core_competency_add_competency_to_template",args:{templateid:self.itemid,competencyid:compId}})})),requests.push({methodname:"tool_lp_data_for_template_competencies_page",args:{templateid:self.itemid,pagecontext:{contextid:self.pageContextId}}}),pagerender="tool_lp/template_competencies_page",pageregion="templatecompetenciespage"):"plan"===self.itemtype&&(requests=[],$.each(compIds,(function(index,compId){requests.push({methodname:"core_competency_add_competency_to_plan",args:{planid:self.itemid,competencyid:compId}})})),requests.push({methodname:"tool_lp_data_for_plan_page",args:{planid:self.itemid}}),pagerender="tool_lp/plan_page",pageregion="plan-page"),ajax.call(requests)[requests.length-1].then((function(context){return templates.render(pagerender,context)})).then((function(html,js){templates.replaceNode($('[data-region="'+pageregion+'"]'),html,js)})).then(pendingPromise.resolve).catch(notification.exception)}))),self.pickerInstance.display()},competencies.prototype.doDelete=function(deleteid){var requests=[],pagerender="",pageregion="";"course"==this.itemtype?(requests=ajax.call([{methodname:"core_competency_remove_competency_from_course",args:{courseid:this.itemid,competencyid:deleteid}},{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:this.itemid,moduleid:0}}]),pagerender="tool_lp/course_competencies_page",pageregion="coursecompetenciespage"):"template"==this.itemtype?(requests=ajax.call([{methodname:"core_competency_remove_competency_from_template",args:{templateid:this.itemid,competencyid:deleteid}},{methodname:"tool_lp_data_for_template_competencies_page",args:{templateid:this.itemid,pagecontext:{contextid:this.pageContextId}}}]),pagerender="tool_lp/template_competencies_page",pageregion="templatecompetenciespage"):"plan"==this.itemtype&&(requests=ajax.call([{methodname:"core_competency_remove_competency_from_plan",args:{planid:this.itemid,competencyid:deleteid}},{methodname:"tool_lp_data_for_plan_page",args:{planid:this.itemid}}]),pagerender="tool_lp/plan_page",pageregion="plan-page"),requests[1].done((function(context){templates.render(pagerender,context).done((function(html,js){$('[data-region="'+pageregion+'"]').replaceWith(html),templates.runTemplateJS(js)})).fail(notification.exception)})).fail(notification.exception)},competencies.prototype.deleteHandler=function(deleteid){var message,localthis=this;if("course"==localthis.itemtype)message="unlinkcompetencycourse";else if("template"==localthis.itemtype)message="unlinkcompetencytemplate";else{if("plan"!=localthis.itemtype)return;message="unlinkcompetencyplan"}ajax.call([{methodname:"core_competency_read_competency",args:{id:deleteid}}])[0].done((function(competency){str.get_strings([{key:"confirm",component:"moodle"},{key:message,component:"tool_lp",param:competency.shortname},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){localthis.doDelete(deleteid)}))})).fail(notification.exception)})).fail(notification.exception)},competencies.prototype.registerEvents=function(){var localthis=this;"course"==localthis.itemtype&&$('[data-region="coursecompetenciespage"]').on("change",'select[data-field="ruleoutcome"]',(function(e){var pendingPromise=new Pending,coursecompetencyid=$(e.target).data("id"),ruleoutcome=$(e.target).val();ajax.call([{methodname:"core_competency_set_course_competency_ruleoutcome",args:{coursecompetencyid:coursecompetencyid,ruleoutcome:ruleoutcome}},{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:localthis.itemid,moduleid:0}}])[1].then((function(context){return templates.render("tool_lp/course_competencies_page",context)})).then((function(html,js){return templates.replaceNode($('[data-region="coursecompetenciespage"]'),html,js)})).then(pendingPromise.resolve).catch(notification.exception)})),$('[data-region="actions"] button').click((function(e){var pendingPromise=new Pending;e.preventDefault(),localthis.pickCompetency().then(pendingPromise.resolve).catch()})),$('[data-action="delete-competency-link"]').click((function(e){e.preventDefault();var deleteid=$(e.target).closest("[data-id]").data("id");localthis.deleteHandler(deleteid)}))},competencies}));
/**
 * Module to enable inline editing of a comptency grade.
 *
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/user_competency_course_navigation",["jquery"],(function($){var UserCompetencyCourseNavigation=function(userSelector,competencySelector,baseUrl,userId,competencyId,courseId){this._baseUrl=baseUrl,this._userId=userId+"",this._competencyId=competencyId+"",this._courseId=courseId,$(userSelector).on("change",this._userChanged.bind(this)),$(competencySelector).on("change",this._competencyChanged.bind(this))};return UserCompetencyCourseNavigation.prototype._userChanged=function(e){var queryStr="?userid="+$(e.target).val()+"&courseid="+this._courseId+"&competencyid="+this._competencyId;document.location=this._baseUrl+queryStr},UserCompetencyCourseNavigation.prototype._competencyChanged=function(e){var newCompetencyId=$(e.target).val(),queryStr="?userid="+this._userId+"&courseid="+this._courseId+"&competencyid="+newCompetencyId;document.location=this._baseUrl+queryStr},UserCompetencyCourseNavigation.prototype._competencyId=null,UserCompetencyCourseNavigation.prototype._userId=null,UserCompetencyCourseNavigation.prototype._courseId=null,UserCompetencyCourseNavigation.prototype._baseUrl=null,UserCompetencyCourseNavigation.prototype._ignoreFirstCompetency=null,UserCompetencyCourseNavigation}));
/**
 * User selector module.
 *
 * @module     tool_lp/form-user-selector
 * @class      form-user-selector
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/form-user-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var users=[];return $.each(results,(function(index,user){users.push({value:user.id,label:user._label})})),users},transport:function(selector,query,success,failure){var capability=$(selector).data("capability");void 0===capability&&(capability=""),Ajax.call([{methodname:"tool_lp_search_users",args:{query:query,capability:capability}}])[0].then((function(results){var promises=[],i=0;return $.each(results.users,(function(index,user){var ctx=user,identity=[];$.each(["idnumber","email","phone1","phone2","department","institution"],(function(i,k){void 0!==user[k]&&""!==user[k]&&(ctx.hasidentity=!0,identity.push(user[k]))})),ctx.identity=identity.join(", "),promises.push(Templates.render("tool_lp/form-user-selector-suggestion",ctx))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results.users,(function(index,user){user._label=args[i],i++})),success(results.users)}))})).catch(failure)}}}));
/**
 * Competency rule all module.
 *
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competency_rule_all",["jquery","core/str","tool_lp/competency_rule"],(function($,Str,RuleBase){var Rule=function(){RuleBase.apply(this,arguments)};return(Rule.prototype=Object.create(RuleBase.prototype)).getType=function(){return"core_competency\\competency_rule_all"},Rule.prototype.isValid=function(){return!0},Rule}));
/**
 * Implement an accessible aria tree widget, from a nested unordered list.
 * Based on http://oaa-accessibility.org/example/41/
 *
 * To respond to selection changed events - use tree.on("selectionchanged", handler).
 * The handler will receive an array of nodes, which are the list items that are currently
 * selected. (Or a single node if multiselect is disabled).
 *
 * @module     tool_lp/tree
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/tree",["jquery","core/url","core/log"],(function($,url,log){var expandedImage=$('<img alt="" src="'+url.imageUrl("t/expanded")+'"/>'),collapsedImage=$('<img alt="" src="'+url.imageUrl("t/collapsed")+'"/>'),Tree=function(selector,multiSelect){this.treeRoot=$(selector),this.multiSelect=void 0===multiSelect||!0===multiSelect,this.items=this.treeRoot.find("li"),this.expandAll=this.items.length<20,this.parents=this.treeRoot.find("li:has(ul)"),multiSelect&&this.treeRoot.attr("aria-multiselectable","true"),this.items.attr("aria-selected","false"),this.visibleItems=null,this.activeItem=null,this.lastActiveItem=null,this.keys={tab:9,enter:13,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,eight:56,asterisk:106},this.init(),this.bindEventHandlers()};return Tree.prototype.init=function(){this.parents.attr("aria-expanded","true"),this.parents.prepend(expandedImage.clone()),this.items.attr("role","tree-item"),this.items.attr("tabindex","-1"),this.parents.attr("role","group"),this.treeRoot.attr("role","tree"),this.visibleItems=this.treeRoot.find("li");var thisObj=this;this.expandAll||(this.parents.each((function(){thisObj.collapseGroup($(this))})),this.expandGroup(this.parents.first()))},Tree.prototype.expandGroup=function(item){item.children("ul").show().attr("aria-hidden","false"),item.attr("aria-expanded","true"),item.children("img").attr("src",expandedImage.attr("src")),this.visibleItems=this.treeRoot.find("li:visible")},Tree.prototype.collapseGroup=function(item){item.children("ul").hide().attr("aria-hidden","true"),item.attr("aria-expanded","false"),item.children("img").attr("src",collapsedImage.attr("src")),this.visibleItems=this.treeRoot.find("li:visible")},Tree.prototype.toggleGroup=function(item){"true"==item.attr("aria-expanded")?this.collapseGroup(item):this.expandGroup(item)},Tree.prototype.triggerChange=function(){var allSelected=this.items.filter("[aria-selected=true]");this.multiSelect||(allSelected=allSelected.first()),this.treeRoot.trigger("selectionchanged",{selected:allSelected})},Tree.prototype.multiSelectItem=function(item){if(this.multiSelect){if(null!==this.lastActiveItem){for(var lastIndex=this.visibleItems.index(this.lastActiveItem),currentIndex=this.visibleItems.index(this.activeItem);lastIndex<currentIndex;)$(this.visibleItems.get(lastIndex)).attr("aria-selected","true"),lastIndex++;for(;lastIndex>currentIndex;)$(this.visibleItems.get(lastIndex)).attr("aria-selected","true"),lastIndex--}}else this.items.attr("aria-selected","false");item.attr("aria-selected","true"),this.triggerChange()},Tree.prototype.selectItem=function(item){for(var walk=item.parent();"tree"!=walk.attr("role");)"false"==(walk=walk.parent()).attr("aria-expanded")&&this.expandGroup(walk),walk=walk.parent();this.items.attr("aria-selected","false"),item.attr("aria-selected","true"),this.triggerChange()},Tree.prototype.toggleItem=function(item){if(this.multiSelect){var current=item.attr("aria-selected");current="true"===current?"false":"true",item.attr("aria-selected",current),this.triggerChange()}else this.selectItem(item)},Tree.prototype.updateFocus=function(item){this.lastActiveItem=this.activeItem,this.activeItem=item;for(var walk=item.parent();"tree"!=walk.attr("role");)"false"==(walk=walk.parent()).attr("aria-expanded")&&this.expandGroup(walk),walk=walk.parent();this.items.attr("tabindex","-1"),item.attr("tabindex",0)},Tree.prototype.handleKeyDown=function(item,e){var currentIndex=this.visibleItems.index(item),newItem=null,hasKeyModifier=e.shiftKey||e.ctrlKey||e.metaKey||e.altKey,thisObj=this;switch(e.keyCode){case this.keys.home:return(newItem=this.parents.first()).focus(),e.shiftKey?this.multiSelectItem(newItem):hasKeyModifier||this.selectItem(newItem),e.stopPropagation(),!1;case this.keys.end:return(newItem=this.visibleItems.last()).focus(),e.shiftKey?this.multiSelectItem(newItem):hasKeyModifier||this.selectItem(newItem),e.stopPropagation(),!1;case this.keys.enter:case this.keys.space:return e.shiftKey?this.multiSelectItem(item):e.metaKey||e.ctrlKey?this.toggleItem(item):this.selectItem(item),e.stopPropagation(),!1;case this.keys.left:if(item.has("ul")&&"true"==item.attr("aria-expanded"))this.collapseGroup(item);else{var itemParent=item.parent().parent();itemParent.is("li")&&(itemParent.focus(),e.shiftKey?this.multiSelectItem(itemParent):hasKeyModifier||this.selectItem(itemParent))}return e.stopPropagation(),!1;case this.keys.right:return item.has("ul")&&"false"==item.attr("aria-expanded")?this.expandGroup(item):(newItem=item.children("ul").children("li").first()).length>0&&(newItem.focus(),e.shiftKey?this.multiSelectItem(newItem):hasKeyModifier||this.selectItem(newItem)),e.stopPropagation(),!1;case this.keys.up:if(currentIndex>0){var prev=this.visibleItems.eq(currentIndex-1);prev.focus(),e.shiftKey?this.multiSelectItem(prev):hasKeyModifier||this.selectItem(prev)}return e.stopPropagation(),!1;case this.keys.down:if(currentIndex<this.visibleItems.length-1){var next=this.visibleItems.eq(currentIndex+1);next.focus(),e.shiftKey?this.multiSelectItem(next):hasKeyModifier||this.selectItem(next)}return e.stopPropagation(),!1;case this.keys.asterisk:return this.parents.each((function(){thisObj.expandGroup($(this))})),e.stopPropagation(),!1;case this.keys.eight:return e.shiftKey&&(this.parents.each((function(){thisObj.expandGroup($(this))})),e.stopPropagation()),!1}return!0},Tree.prototype.handleKeyPress=function(item,e){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return!0;switch(e.keyCode){case this.keys.tab:return!0;case this.keys.enter:case this.keys.home:case this.keys.end:case this.keys.left:case this.keys.right:case this.keys.up:case this.keys.down:return e.stopPropagation(),!1;default:var chr=String.fromCharCode(e.which),match=!1,itemIndex=this.visibleItems.index(item),itemCount=this.visibleItems.length,currentIndex=itemIndex+1;for(currentIndex==itemCount&&(currentIndex=0);currentIndex!=itemIndex;){var currentItem=this.visibleItems.eq(currentIndex),titleChr=currentItem.text().charAt(0);if(currentItem.has("ul")&&(titleChr=currentItem.find("span").text().charAt(0)),titleChr.toLowerCase()==chr){match=!0;break}(currentIndex+=1)==itemCount&&(currentIndex=0)}return!0===match&&this.updateFocus(this.visibleItems.eq(currentIndex)),e.stopPropagation(),!1}return!0},Tree.prototype.on=function(eventname,handler){"selectionchanged"!==eventname?log.warning('Invalid custom event name for tree. Only "selectionchanged" is supported.'):this.treeRoot.on(eventname,handler)},Tree.prototype.handleDblClick=function(item,e){return!!(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)||(this.updateFocus(item),this.toggleGroup(item),e.stopPropagation(),!1)},Tree.prototype.handleExpandCollapseClick=function(item,e){return this.toggleGroup(item),e.stopPropagation(),!1},Tree.prototype.handleClick=function(item,e){return e.shiftKey?this.multiSelectItem(item):e.metaKey||e.ctrlKey?this.toggleItem(item):this.selectItem(item),this.updateFocus(item),e.stopPropagation(),!1},Tree.prototype.handleBlur=function(){return!0},Tree.prototype.handleFocus=function(item){return this.updateFocus(item),!0},Tree.prototype.bindEventHandlers=function(){var thisObj=this;this.parents.dblclick((function(e){return thisObj.handleDblClick($(this),e)})),this.items.click((function(e){return thisObj.handleClick($(this),e)})),this.items.children("img").click((function(e){return thisObj.handleExpandCollapseClick($(this).parent(),e)})),this.items.keydown((function(e){return thisObj.handleKeyDown($(this),e)})),this.items.keypress((function(e){return thisObj.handleKeyPress($(this),e)})),this.items.focus((function(e){return thisObj.handleFocus($(this),e)})),this.items.blur((function(e){return thisObj.handleBlur($(this),e)}))},Tree}));
/**
 * Handle opening a dialogue to configure scale data.
 *
 * @module     tool_lp/scaleconfig
 * @package    tool_lp
 * @copyright  2015 Adrian Greeve <adrian@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/scaleconfig",["jquery","core/notification","core/templates","core/ajax","tool_lp/dialogue","tool_lp/scalevalues"],(function($,notification,templates,ajax,Dialogue,ModScaleValues){var ScaleConfig=function(selectSelector,inputSelector,triggerSelector){this.selectSelector=selectSelector,this.inputSelector=inputSelector,this.triggerSelector=triggerSelector,this.originalscaleid=$(selectSelector).val(),$(selectSelector).on("change",this.scaleChangeHandler.bind(this)).change(),$(triggerSelector).click(this.showConfig.bind(this))};return ScaleConfig.prototype.selectSelector=null,ScaleConfig.prototype.inputSelector=null,ScaleConfig.prototype.triggerSelector=null,ScaleConfig.prototype.scalevalues=null,ScaleConfig.prototype.originalscaleid=0,ScaleConfig.prototype.scaleid=0,ScaleConfig.prototype.popup=null,ScaleConfig.prototype.showConfig=function(){var self=this;if(this.scaleid=$(this.selectSelector).val(),!(this.scaleid<=0)){var scalename=$(this.selectSelector).find("option:selected").text();this.getScaleValues(this.scaleid).done((function(){var context={scalename:scalename,scales:self.scalevalues};templates.render("tool_lp/scale_configuration_page",context).done((function(html){new Dialogue(scalename,html,self.initScaleConfig.bind(self))})).fail(notification.exception)})).fail(notification.exception)}},ScaleConfig.prototype.retrieveOriginalScaleConfig=function(){var jsonstring=$(this.inputSelector).val();if(""!==jsonstring){var scaleconfiguration=$.parseJSON(jsonstring);if(scaleconfiguration.shift().scaleid===this.originalscaleid)return scaleconfiguration}return""},ScaleConfig.prototype.initScaleConfig=function(popup){this.popup=popup;var body=$(popup.getContent());if(this.originalscaleid===this.scaleid){var currentconfig=this.retrieveOriginalScaleConfig();""!==currentconfig&&currentconfig.forEach((function(value){1===value.scaledefault&&body.find('[data-field="tool_lp_scale_default_'+value.id+'"]').attr("checked",!0),1===value.proficient&&body.find('[data-field="tool_lp_scale_proficient_'+value.id+'"]').attr("checked",!0)}))}body.on("click",'[data-action="close"]',function(){this.setScaleConfig(),popup.close()}.bind(this)),body.on("click",'[data-action="cancel"]',(function(){popup.close()}))},ScaleConfig.prototype.setScaleConfig=function(){var body=$(this.popup.getContent()),data=[{scaleid:this.scaleid}];this.scalevalues.forEach((function(value){var scaledefault=0,proficient=0;body.find('[data-field="tool_lp_scale_default_'+value.id+'"]').is(":checked")&&(scaledefault=1),body.find('[data-field="tool_lp_scale_proficient_'+value.id+'"]').is(":checked")&&(proficient=1),(scaledefault||proficient)&&data.push({id:value.id,scaledefault:scaledefault,proficient:proficient})}));var datastring=JSON.stringify(data);$(this.inputSelector).val(datastring),this.originalscaleid=this.scaleid},ScaleConfig.prototype.getScaleValues=function(scaleid){return ModScaleValues.get_values(scaleid).then(function(values){return this.scalevalues=values,values}.bind(this))},ScaleConfig.prototype.scaleChangeHandler=function(e){$(e.target).val()<=0?$(this.triggerSelector).prop("disabled",!0):$(this.triggerSelector).prop("disabled",!1)},{init:function(selectSelector,inputSelector,triggerSelector){return new ScaleConfig(selectSelector,inputSelector,triggerSelector)}}}));
/**
 * Grade dialogue.
 *
 * @package    tool_lp
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/grade_dialogue",["jquery","core/notification","core/templates","tool_lp/dialogue","tool_lp/event_base","core/str"],(function($,Notification,Templates,Dialogue,EventBase,Str){var Grade=function(ratingOptions){EventBase.prototype.constructor.apply(this,[]),this._ratingOptions=ratingOptions};return(Grade.prototype=Object.create(EventBase.prototype))._popup=null,Grade.prototype._ratingOptions=null,Grade.prototype._afterRender=function(){var btnRate=this._find('[data-action="rate"]'),lstRating=this._find('[name="rating"]'),txtComment=this._find('[name="comment"]');this._find('[data-action="cancel"]').click(function(e){e.preventDefault(),this._trigger("cancelled"),this.close()}.bind(this)),lstRating.change((function(){$(this).val()?btnRate.prop("disabled",!1):btnRate.prop("disabled",!0)})).change(),btnRate.click(function(e){e.preventDefault();var val=lstRating.val();val&&(this._trigger("rated",{rating:val,note:txtComment.val()}),this.close())}.bind(this))},Grade.prototype.close=function(){this._popup.close(),this._popup=null},Grade.prototype.display=function(){return M.util.js_pending("tool_lp/grade_dialogue:display"),$.when(Str.get_string("rate","tool_lp"),this._render()).then(function(title,templateResult){return this._popup=new Dialogue(title,templateResult[0],function(){this._afterRender(),M.util.js_complete("tool_lp/grade_dialogue:display")}.bind(this)),this._popup}.bind(this)).catch(Notification.exception)},Grade.prototype._find=function(selector){return $(this._popup.getContent()).find(selector)},Grade.prototype._render=function(){var context={cangrade:this._canGrade,ratings:this._ratingOptions};return Templates.render("tool_lp/competency_grader",context)},Grade}));
/**
 * Module to refresh a user competency summary in a page.
 *
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/user_competency_info",["jquery","core/notification","core/ajax","core/templates"],(function($,notification,ajax,templates){var Info=function(rootElement,competencyId,userId,planId,courseId,displayuser){this._rootElement=rootElement,this._competencyId=competencyId,this._userId=userId,this._planId=planId,this._courseId=courseId,this._valid=!0,this._displayuser=void 0!==displayuser&&displayuser,this._planId?(this._methodName="tool_lp_data_for_user_competency_summary_in_plan",this._args={competencyid:this._competencyId,planid:this._planId},this._templateName="tool_lp/user_competency_summary_in_plan"):this._courseId?(this._methodName="tool_lp_data_for_user_competency_summary_in_course",this._args={userid:this._userId,competencyid:this._competencyId,courseid:this._courseId},this._templateName="tool_lp/user_competency_summary_in_course"):(this._methodName="tool_lp_data_for_user_competency_summary",this._args={userid:this._userId,competencyid:this._competencyId},this._templateName="tool_lp/user_competency_summary")};return Info.prototype.reload=function(){var self=this;this._valid&&ajax.call([{methodname:this._methodName,args:this._args}])[0].done((function(context){self._displayuser&&(context.displayuser=!0),templates.render(self._templateName,context).done((function(html,js){templates.replaceNode(self._rootElement,html,js)})).fail(notification.exception)})).fail(notification.exception)},Info.prototype._rootElement=null,Info.prototype._courseId=null,Info.prototype._valid=null,Info.prototype._planId=null,Info.prototype._competencyId=null,Info.prototype._userId=null,Info.prototype._methodName=null,Info.prototype._args=null,Info.prototype._templateName=null,Info.prototype._displayuser=!1,Info}));
/**
 * Competency rule config.
 *
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competency_outcomes",["jquery","core/str"],(function($,Str){return{NONE:0,EVIDENCE:1,COMPLETE:2,RECOMMEND:3,getAll:function(){var self=this;return Str.get_strings([{key:"competencyoutcome_none",component:"tool_lp"},{key:"competencyoutcome_evidence",component:"tool_lp"},{key:"competencyoutcome_recommend",component:"tool_lp"},{key:"competencyoutcome_complete",component:"tool_lp"}]).then((function(strings){var outcomes={};return outcomes[self.NONE]={code:self.NONE,name:strings[0]},outcomes[self.EVIDENCE]={code:self.EVIDENCE,name:strings[1]},outcomes[self.RECOMMEND]={code:self.RECOMMEND,name:strings[2]},outcomes[self.COMPLETE]={code:self.COMPLETE,name:strings[3]},outcomes}))},getString:function(id){return this.getAll().then((function(outcomes){return void 0===outcomes[id]?$.Deferred().reject().promise():outcomes[id].name}))}}}));
/**
 * Handle actions on learning plan templates via ajax.
 *
 * @module     tool_lp/templateactions
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/templateactions",["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/actionselector"],(function($,templates,ajax,notification,str,Actionselector){var pagecontextid=0,templateid=0,deleteplans=!0,updatePage=function(newhtml,newjs){$('[data-region="managetemplates"]').replaceWith(newhtml),templates.runTemplateJS(newjs)},reloadList=function(context){templates.render("tool_lp/manage_templates_page",context).done(updatePage).fail(notification.exception)},doDelete=function(){ajax.call([{methodname:"core_competency_delete_template",args:{id:templateid,deleteplans:deleteplans}},{methodname:"tool_lp_data_for_templates_manage_page",args:{pagecontext:{contextid:pagecontextid}}}])[1].done(reloadList).fail(notification.exception)};return{deleteHandler:function(e){e.preventDefault();var id=$(this).attr("data-templateid");templateid=id,deleteplans=!0;var requests=ajax.call([{methodname:"core_competency_read_template",args:{id:templateid}},{methodname:"core_competency_template_has_related_data",args:{id:templateid}}]);requests[0].done((function(template){requests[1].done((function(templatehasrelateddata){templatehasrelateddata?str.get_strings([{key:"deletetemplate",component:"tool_lp",param:template.shortname},{key:"deletetemplatewithplans",component:"tool_lp"},{key:"deleteplans",component:"tool_lp"},{key:"unlinkplanstemplate",component:"tool_lp"},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){var actions=[{text:strings[2],value:"delete"},{text:strings[3],value:"unlink"}],actionselector=new Actionselector(strings[0],strings[1],actions,strings[4],strings[5]);actionselector.display(),actionselector.on("save",(function(e,data){"delete"!=data.action&&(deleteplans=!1),doDelete()}))})).fail(notification.exception):str.get_strings([{key:"confirm",component:"moodle"},{key:"deletetemplate",component:"tool_lp",param:template.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],doDelete)})).fail(notification.exception)})).fail(notification.exception)})).fail(notification.exception)},duplicateHandler:function(e){e.preventDefault(),templateid=$(this).attr("data-templateid"),ajax.call([{methodname:"core_competency_duplicate_template",args:{id:templateid}},{methodname:"tool_lp_data_for_templates_manage_page",args:{pagecontext:{contextid:pagecontextid}}}])[1].done(reloadList).fail(notification.exception)},init:function(contextid){pagecontextid=contextid}}}));
/**
 * Competency rule points module.
 *
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competency_rule_points",["jquery","core/str","core/templates","tool_lp/competency_rule"],(function($,Str,Templates,RuleBase){var Rule=function(){RuleBase.apply(this,arguments)};return(Rule.prototype=Object.create(RuleBase.prototype))._container=null,Rule.prototype._templateLoaded=!1,Rule.prototype.getConfig=function(){return JSON.stringify({base:{points:this._getRequiredPoints()},competencies:this._getCompetenciesConfig()})},Rule.prototype._getCompetenciesConfig=function(){var competencies=[];return this._container.find("[data-competency]").each((function(){var node=$(this),id=node.data("competency"),points=parseInt(node.find('[name="points"]').val(),10),required=node.find('[name="required"]').prop("checked");competencies.push({id:id,points:points,required:required?1:0})})),competencies},Rule.prototype._getRequiredPoints=function(){return parseInt(this._container.find('[name="requiredpoints"]').val()||1,10)},Rule.prototype.getType=function(){return"core_competency\\competency_rule_points"},Rule.prototype.injectTemplate=function(container){var context,self=this,children=this._tree.getChildren(this._competency.id),config={base:{points:2},competencies:[]};if(this._templateLoaded=!1,self._competency.ruletype==self.getType())try{config=JSON.parse(self._competency.ruleconfig)}catch(e){}return context={requiredpoints:config&&config.base?config.base.points:2,competency:self._competency,children:[]},$.each(children,(function(index,child){var competency={id:child.id,shortname:child.shortname,required:!1,points:0};config&&$.each(config.competencies,(function(index,comp){comp.id==competency.id&&(competency.required=!!comp.required,competency.points=comp.points)})),context.children.push(competency)})),Templates.render("tool_lp/competency_rule_points",context).then((function(html){self._container=container,container.html(html),container.find("input").change((function(){self._triggerChange()})),self._templateLoaded=!0,self._triggerChange()}))},Rule.prototype.isValid=function(){if(!this._templateLoaded)return!1;var required=this._getRequiredPoints(),max=0,valid=!0;return $.each(this._getCompetenciesConfig(),(function(index,competency){competency.points<0&&(valid=!1),max+=competency.points})),valid=valid&&max>=required},Rule}));
/**
 * Evidence delete.
 *
 * @package    tool_lp
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/evidence_delete",["jquery","core/notification","core/ajax","core/str","core/log"],(function($,Notification,Ajax,Str,Log){var selectors={};return{register:function(triggerSelector,containerSelector){void 0===selectors[triggerSelector]&&(selectors[triggerSelector]=$("body").delegate(triggerSelector,"click",(function(e){var parent=$(e.currentTarget).parents(containerSelector);if(!parent.length||parent.length>1)Log.error("None or too many evidence container were found.");else{var evidenceId=parent.data("id");evidenceId?(e.preventDefault(),e.stopPropagation(),Str.get_strings([{key:"confirm",component:"moodle"},{key:"areyousure",component:"moodle"},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){Notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){Ajax.call([{methodname:"core_competency_delete_evidence",args:{id:evidenceId}}])[0].then((function(){parent.remove()})).fail(Notification.exception)}))})).fail(Notification.exception)):Log.error("Evidence ID was not found.")}})))}}}));
/**
 * Competency picker.
 *
 * To handle 'save' events use: picker.on('save')
 * This will receive a object with either a single 'competencyId', or an array in 'competencyIds'
 * depending on the value of multiSelect.
 *
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencypicker",["jquery","core/notification","core/ajax","core/templates","tool_lp/dialogue","core/str","tool_lp/tree","core/pending"],(function($,Notification,Ajax,Templates,Dialogue,Str,Tree,Pending){var Picker=function(pageContextId,singleFramework,pageContextIncludes,multiSelect){this._eventNode=$("<div></div>"),this._frameworks=[],this._reset(),this._pageContextId=pageContextId,this._pageContextIncludes=pageContextIncludes||"children",this._multiSelect=void 0===multiSelect||!0===multiSelect,singleFramework&&(this._frameworkId=singleFramework,this._singleFramework=!0)};return Picker.prototype._competencies=null,Picker.prototype._disallowedCompetencyIDs=null,Picker.prototype._eventNode=null,Picker.prototype._frameworks=null,Picker.prototype._frameworkId=null,Picker.prototype._pageContextId=null,Picker.prototype._pageContextIncludes=null,Picker.prototype._popup=null,Picker.prototype._searchText="",Picker.prototype._selectedCompetencies=null,Picker.prototype._singleFramework=!1,Picker.prototype._multiSelect=!0,Picker.prototype._onlyVisible=!0,Picker.prototype._afterRender=function(){var self=this,tree=new Tree(self._find("[data-enhance=linktree]"),self._multiSelect);self._find("[data-enhance=linktree]").show(),tree.on("selectionchanged",(function(evt,params){var selected=params.selected;evt.preventDefault();var validIds=[];$.each(selected,(function(index,item){var compId=$(item).data("id"),valid=!0;void 0===compId?valid=!1:$.each(self._disallowedCompetencyIDs,(function(i,id){id==compId&&(valid=!1)})),valid&&validIds.push(compId)})),self._selectedCompetencies=validIds,self._selectedCompetencies.length?self._find('[data-region="competencylinktree"] [data-action="add"]').removeAttr("disabled"):self._find('[data-region="competencylinktree"] [data-action="add"]').attr("disabled","disabled")})),self._singleFramework||self._find('[data-action="chooseframework"]').change((function(e){self._frameworkId=$(e.target).val(),self._loadCompetencies().then(self._refresh.bind(self)).catch(Notification.exception)})),self._find('[data-region="filtercompetencies"] button').click((function(e){return e.preventDefault(),$(e.target).attr("disabled","disabled"),self._searchText=self._find('[data-region="filtercompetencies"] input').val()||"",self._refresh().always((function(){$(e.target).removeAttr("disabled")}))})),self._find('[data-region="competencylinktree"] [data-action="cancel"]').click((function(e){e.preventDefault(),self.close()})),self._find('[data-region="competencylinktree"] [data-action="add"]').click((function(e){e.preventDefault();var pendingPromise=new Pending;self._selectedCompetencies.length&&(self._multiSelect?self._trigger("save",{competencyIds:self._selectedCompetencies}):self._trigger("save",{competencyId:self._selectedCompetencies[0]}),self.close(),pendingPromise.resolve())}));var currentItems=self._selectedCompetencies.slice(0);$.each(currentItems,(function(index,id){var node=self._find("[data-id="+id+"]");node.length&&(tree.toggleItem(node),tree.updateFocus(node))}))},Picker.prototype.close=function(){this._popup.close(),this._reset()},Picker.prototype.display=function(){var self=this;return $.when(Str.get_string("competencypicker","tool_lp"),self._render()).then((function(title,render){self._popup=new Dialogue(title,render[0],self._afterRender.bind(self))})).catch(Notification.exception)},Picker.prototype._fetchCompetencies=function(frameworkId,searchText){var self=this;return Ajax.call([{methodname:"core_competency_search_competencies",args:{searchtext:searchText,competencyframeworkid:frameworkId}}])[0].done((function(competencies){function addCompetencyChildren(parent,competencies){for(var i=0;i<competencies.length;i++)competencies[i].parentid==parent.id&&(parent.haschildren=!0,competencies[i].children=[],competencies[i].haschildren=!1,parent.children[parent.children.length]=competencies[i],addCompetencyChildren(competencies[i],competencies))}var i,comp,tree=[];for(i=0;i<competencies.length;i++)"0"==(comp=competencies[i]).parentid&&(comp.children=[],comp.haschildren=0,tree[tree.length]=comp,addCompetencyChildren(comp,competencies));self._competencies=tree})).fail(Notification.exception)},Picker.prototype._find=function(selector){return $(this._popup.getContent()).find(selector)},Picker.prototype._getFramework=function(fid){var frm;return $.each(this._frameworks,(function(i,f){f.id!=fid||(frm=f)})),frm},Picker.prototype._loadCompetencies=function(){return this._fetchCompetencies(this._frameworkId,this._searchText)},Picker.prototype._loadFrameworks=function(){var self=this;return self._frameworks.length>0?$.when():(self._singleFramework?Ajax.call([{methodname:"core_competency_read_competency_framework",args:{id:this._frameworkId}}])[0].then((function(framework){return[framework]})):Ajax.call([{methodname:"core_competency_list_competency_frameworks",args:{sort:"shortname",context:{contextid:self._pageContextId},includes:self._pageContextIncludes,onlyvisible:self._onlyVisible}}])[0]).done((function(frameworks){self._frameworks=frameworks})).fail(Notification.exception)},Picker.prototype.on=function(type,handler){this._eventNode.on(type,handler)},Picker.prototype._preRender=function(){var self=this;return self._loadFrameworks().then((function(){return!self._frameworkId&&self._frameworks.length>0&&(self._frameworkId=self._frameworks[0].id),self._frameworkId?self._loadCompetencies():(self._frameworks=[],$.when())}))},Picker.prototype._refresh=function(){var self=this;return self._render().then((function(html){self._find('[data-region="competencylinktree"]').replaceWith(html),self._afterRender()}))},Picker.prototype._render=function(){var self=this;return self._preRender().then((function(){self._singleFramework||$.each(self._frameworks,(function(i,framework){framework.id==self._frameworkId?framework.selected=!0:framework.selected=!1}));var context={competencies:self._competencies,framework:self._getFramework(self._frameworkId),frameworks:self._frameworks,search:self._searchText,singleFramework:self._singleFramework};return Templates.render("tool_lp/competency_picker",context)}))},Picker.prototype._reset=function(){this._competencies=[],this._disallowedCompetencyIDs=[],this._popup=null,this._searchText="",this._selectedCompetencies=[]},Picker.prototype.setDisallowedCompetencyIDs=function(ids){this._disallowedCompetencyIDs=ids},Picker.prototype._trigger=function(type,data){this._eventNode.trigger(type,[data])},Picker}));
/**
 * Event click on selecting competency in the competency autocomplete.
 *
 * @package    tool_lp
 * @copyright  2016 Issam Taboubi <issam.taboubi@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competency_plan_navigation",["jquery"],(function($){var CompetencyPlanNavigation=function(competencySelector,baseUrl,userId,competencyId,planId){this._baseUrl=baseUrl,this._userId=userId+"",this._competencyId=competencyId+"",this._planId=planId,this._ignoreFirstCompetency=!0,$(competencySelector).on("change",this._competencyChanged.bind(this))};return CompetencyPlanNavigation.prototype._competencyChanged=function(e){if(this._ignoreFirstCompetency)this._ignoreFirstCompetency=!1;else{var newCompetencyId=$(e.target).val(),queryStr="?userid="+this._userId+"&planid="+this._planId+"&competencyid="+newCompetencyId;document.location=this._baseUrl+queryStr}},CompetencyPlanNavigation.prototype._competencyId=null,CompetencyPlanNavigation.prototype._userId=null,CompetencyPlanNavigation.prototype._planId=null,CompetencyPlanNavigation.prototype._baseUrl=null,CompetencyPlanNavigation.prototype._ignoreFirstCompetency=null,CompetencyPlanNavigation}));
/**
 * Handle selection changes and actions on the competency tree.
 *
 * @module     tool_lp/competencyactions
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencyactions",["jquery","core/url","core/templates","core/notification","core/str","core/ajax","tool_lp/dragdrop-reorder","tool_lp/tree","tool_lp/dialogue","tool_lp/menubar","tool_lp/competencypicker","tool_lp/competency_outcomes","tool_lp/competencyruleconfig","core/pending"],(function($,url,templates,notification,str,ajax,dragdrop,Ariatree,Dialogue,menubar,Picker,Outcomes,RuleConfig,Pending){var pageContextId,pickerInstance,ruleConfigInstance,relatedTarget,taxonomiesConstants,rulesModules,treeModel=null,moveSource=null,moveTarget=null,selectedCompetencyId=null,addHandler=function(){var parent=$('[data-region="competencyactions"]').data("competency"),params={competencyframeworkid:treeModel.getCompetencyFrameworkId(),pagecontextid:pageContextId};null!==parent&&(params.parentid=parent.id);var relocate=function(){var queryparams=$.param(params);window.location=url.relativeUrl("/admin/tool/lp/editcompetency.php?"+queryparams)};null!==parent&&treeModel.hasRule(parent.id)?str.get_strings([{key:"confirm",component:"moodle"},{key:"addingcompetencywillresetparentrule",component:"tool_lp",param:parent.shortname},{key:"yes",component:"core"},{key:"no",component:"core"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],relocate)})).fail(notification.exception):relocate()},doMove=function(){var frameworkid=$('[data-region="filtercompetencies"]').data("frameworkid");ajax.call([{methodname:"core_competency_set_parent_competency",args:{competencyid:moveSource,parentid:moveTarget}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:frameworkid,search:$('[data-region="filtercompetencies"] input').val()}}])[1].done(reloadPage).fail(notification.exception)},confirmMove=function(){if((moveTarget=void 0===moveTarget?0:moveTarget)!=moveSource){var targetComp=treeModel.getCompetency(moveTarget)||{},sourceComp=treeModel.getCompetency(moveSource)||{},confirmMessage="movecompetencywillresetrules",showConfirm=!1;sourceComp.parentid!=moveTarget&&(targetComp.path&&targetComp.path.indexOf("/"+sourceComp.id+"/")>=0&&(confirmMessage="movecompetencytochildofselfwillresetrules",showConfirm=showConfirm||treeModel.hasRule(sourceComp.id)),(showConfirm=showConfirm||treeModel.hasRule(targetComp.id)||treeModel.hasRule(sourceComp.parentid))?str.get_strings([{key:"confirm",component:"moodle"},{key:confirmMessage,component:"tool_lp"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],doMove)})).fail(notification.exception):doMove())}},initMovePopup=function(popup){var body=$(popup.getContent()),treeRoot=body.find("[data-enhance=movetree]");new Ariatree(treeRoot,!1).on("selectionchanged",(function(evt,params){var target=params.selected;moveTarget=$(target).data("id")})),treeRoot.show(),body.on("click",'[data-action="move"]',(function(){popup.close(),confirmMove()})),body.on("click",'[data-action="cancel"]',(function(){popup.close()}))},addCompetencyChildren=function addCompetencyChildren(parent,competencies){var i;for(i=0;i<competencies.length;i++)competencies[i].parentid==parent.id&&(parent.haschildren=!0,competencies[i].children=[],competencies[i].haschildren=!1,parent.children[parent.children.length]=competencies[i],addCompetencyChildren(competencies[i],competencies))},moveHandler=function(e){e.preventDefault();var competency=$('[data-region="competencyactions"]').data("competency");moveSource=competency.id;var requests=ajax.call([{methodname:"core_competency_search_competencies",args:{competencyframeworkid:competency.competencyframeworkid,searchtext:""}},{methodname:"core_competency_read_competency_framework",args:{id:competency.competencyframeworkid}}]);$.when.apply(null,requests).done((function(competencies,framework){var i,competenciestree=[];for(i=0;i<competencies.length;i++){var onecompetency=competencies[i];"0"==onecompetency.parentid&&(onecompetency.children=[],onecompetency.haschildren=0,competenciestree[competenciestree.length]=onecompetency,addCompetencyChildren(onecompetency,competencies))}str.get_strings([{key:"movecompetency",component:"tool_lp",param:competency.shortname},{key:"move",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done((function(strings){var context={framework:framework,competencies:competenciestree};templates.render("tool_lp/competencies_move_tree",context).done((function(tree){new Dialogue(strings[0],tree,initMovePopup)})).fail(notification.exception)})).fail(notification.exception)})).fail(notification.exception)},editHandler=function(){var competency=$('[data-region="competencyactions"]').data("competency"),params={competencyframeworkid:treeModel.getCompetencyFrameworkId(),id:competency.id,parentid:competency.parentid,pagecontextid:pageContextId},queryparams=$.param(params);window.location=url.relativeUrl("/admin/tool/lp/editcompetency.php?"+queryparams)},reloadPage=function(context){templates.render("tool_lp/manage_competencies_page",context).done((function(newhtml,newjs){$('[data-region="managecompetencies"]').replaceWith(newhtml),templates.runTemplateJS(newjs)})).fail(notification.exception)},updateSearchHandler=function(e){e.preventDefault();var frameworkid=$('[data-region="filtercompetencies"]').data("frameworkid");ajax.call([{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:frameworkid,search:$('[data-region="filtercompetencies"] input').val()}}])[0].done(reloadPage).fail(notification.exception)},moveUpHandler=function(){var competency=$('[data-region="competencyactions"]').data("competency");ajax.call([{methodname:"core_competency_move_up_competency",args:{id:competency.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:competency.competencyframeworkid,search:$('[data-region="filtercompetencies"] input').val()}}])[1].done(reloadPage).fail(notification.exception)},moveDownHandler=function(){var competency=$('[data-region="competencyactions"]').data("competency");ajax.call([{methodname:"core_competency_move_down_competency",args:{id:competency.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:competency.competencyframeworkid,search:$('[data-region="filtercompetencies"] input').val()}}])[1].done(reloadPage).fail(notification.exception)},seeCoursesHandler=function(){var competency=$('[data-region="competencyactions"]').data("competency");ajax.call([{methodname:"tool_lp_list_courses_using_competency",args:{id:competency.id}}])[0].done((function(courses){var context={courses:courses};templates.render("tool_lp/linked_courses_summary",context).done((function(html){str.get_string("linkedcourses","tool_lp").done((function(linkedcourses){new Dialogue(linkedcourses,html,initMovePopup)})).fail(notification.exception)})).fail(notification.exception)})).fail(notification.exception)},relateCompetenciesHandler=function(){relatedTarget=$('[data-region="competencyactions"]').data("competency"),pickerInstance||(pickerInstance=new Picker(pageContextId,relatedTarget.competencyframeworkid)).on("save",(function(e,data){var pendingPromise=new Pending,compIds=data.competencyIds,calls=[];$.each(compIds,(function(index,value){calls.push({methodname:"core_competency_add_related_competency",args:{competencyid:value,relatedcompetencyid:relatedTarget.id}})})),calls.push({methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:relatedTarget.id}}),ajax.call(calls)[calls.length-1].then((function(context){return templates.render("tool_lp/related_competencies",context)})).then((function(html,js){$('[data-region="relatedcompetencies"]').replaceWith(html),templates.runTemplateJS(js),updatedRelatedCompetencies()})).then(pendingPromise.resolve).catch(notification.exception)})),pickerInstance.setDisallowedCompetencyIDs([relatedTarget.id]),pickerInstance.display()},ruleConfigHandler=function(e){e.preventDefault(),relatedTarget=$('[data-region="competencyactions"]').data("competency"),ruleConfigInstance.setTargetCompetencyId(relatedTarget.id),ruleConfigInstance.display()},ruleConfigSaveHandler=function(e,config){var update={id:relatedTarget.id,shortname:relatedTarget.shortname,idnumber:relatedTarget.idnumber,description:relatedTarget.description,descriptionformat:relatedTarget.descriptionformat,ruletype:config.ruletype,ruleoutcome:config.ruleoutcome,ruleconfig:config.ruleconfig};ajax.call([{methodname:"core_competency_update_competency",args:{competency:update}}])[0].then((function(result){result&&(relatedTarget.ruletype=config.ruletype,relatedTarget.ruleoutcome=config.ruleoutcome,relatedTarget.ruleconfig=config.ruleconfig,renderCompetencySummary(relatedTarget))})).catch(notification.exception)},doDelete=function(){var competency=$('[data-region="competencyactions"]').data("competency"),requests=ajax.call([{methodname:"core_competency_delete_competency",args:{id:competency.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:competency.competencyframeworkid,search:$('[data-region="filtercompetencies"] input').val()}}]);requests[0].done((function(success){!1===success&&str.get_strings([{key:"competencycannotbedeleted",component:"tool_lp",param:competency.shortname},{key:"cancel",component:"moodle"}]).done((function(strings){notification.alert(null,strings[0])})).fail(notification.exception)})).fail(notification.exception),requests[1].done(reloadPage).fail(notification.exception)},deleteCompetencyHandler=function(){var competency=$('[data-region="competencyactions"]').data("competency"),confirmMessage="deletecompetency";treeModel.hasRule(competency.parentid)&&(confirmMessage="deletecompetencyparenthasrule"),str.get_strings([{key:"confirm",component:"moodle"},{key:confirmMessage,component:"tool_lp",param:competency.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],doDelete)})).fail(notification.exception)},dragStart=function(e){e.originalEvent.dataTransfer.setData("text",$(e.target).parent().data("id"))},allowDrop=function(e){e.originalEvent.dataTransfer.dropEffect="move",e.preventDefault()},dragEnter=function(e){e.preventDefault(),$(this).addClass("currentdragtarget")},dragLeave=function(e){e.preventDefault(),$(this).removeClass("currentdragtarget")},dropOver=function(e){e.preventDefault(),moveSource=e.originalEvent.dataTransfer.getData("text"),moveTarget=$(e.target).parent().data("id"),$(this).removeClass("currentdragtarget"),confirmMove()},deleteRelatedHandler=function(e){e.preventDefault();var relatedid=this.id.substr(11),competency=$('[data-region="competencyactions"]').data("competency");ajax.call([{methodname:"core_competency_remove_related_competency",args:{relatedcompetencyid:relatedid,competencyid:competency.id}},{methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:competency.id}}])[1].done((function(context){templates.render("tool_lp/related_competencies",context).done((function(html){$('[data-region="relatedcompetencies"]').replaceWith(html),updatedRelatedCompetencies()})).fail(notification.exception)})).fail(notification.exception)},updatedRelatedCompetencies=function(){$('[data-action="deleterelation"]').on("click",deleteRelatedHandler)},getTaxonomyAtLevel=function(level){var constant=taxonomiesConstants[level];return constant||(constant="competency"),constant},renderCompetencySummary=function(competency){var promise=$.Deferred().resolve().promise(),context={};context.competency=competency,context.showdeleterelatedaction=!0,context.showrelatedcompetencies=!0,context.showrule=!1,context.pluginbaseurl=url.relativeUrl("/admin/tool/lp"),competency.ruleoutcome!=Outcomes.NONE&&(promise=Outcomes.getString(competency.ruleoutcome).then((function(str){var name;return $.each(rulesModules,(function(index,modInfo){modInfo.type==competency.ruletype&&(name=modInfo.name)})),[str,name]}))),promise.then((function(strs){return void 0!==strs&&(context.showrule=!0,context.rule={outcome:strs[0],type:strs[1]}),context})).then((function(context){return templates.render("tool_lp/competency_summary",context)})).then((function(html){return $('[data-region="competencyinfo"]').html(html),$('[data-action="deleterelation"]').on("click",deleteRelatedHandler),templates.render("tool_lp/loading",{})})).then((function(html,js){return templates.replaceNodeContents('[data-region="relatedcompetencies"]',html,js),ajax.call([{methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:competency.id}}])[0]})).then((function(context){return templates.render("tool_lp/related_competencies",context)})).then((function(html,js){$('[data-region="relatedcompetencies"]').replaceWith(html),templates.runTemplateJS(js),updatedRelatedCompetencies()})).catch(notification.exception)},selectionChanged=function(evt,params){var node=params.selected,id=$(node).data("id"),btn=$('[data-region="competencyactions"] [data-action="add"]'),actionMenu=$('[data-region="competencyactionsmenu"]'),selectedTitle=$('[data-region="selected-competency"]'),level=0,sublevel=1;if(menubar.closeAll(),void 0===id)$('[data-region="competencyinfo"]').html(node.clone().children().remove().end().text()),$('[data-region="competencyactions"]').data("competency",null),actionMenu.hide();else{var competency=treeModel.getCompetency(id);sublevel=(level=treeModel.getCompetencyLevel(id))+1,actionMenu.show(),$('[data-region="competencyactions"]').data("competency",competency),renderCompetencySummary(competency),function(competency){competency.id!==selectedCompetencyId&&(selectedCompetencyId=competency.id,ajax.call([{methodname:"core_competency_competency_viewed",args:{id:competency.id}}]))}(competency)}return function(level){return str.get_string("taxonomy_selected_"+getTaxonomyAtLevel(level),"tool_lp")}(level).then((function(str){selectedTitle.text(str)})).catch(notification.exception),function(level){return str.get_string("taxonomy_add_"+getTaxonomyAtLevel(level),"tool_lp")}(sublevel).then((function(str){btn.show().find('[data-region="term"]').text(str)})).catch(notification.exception),evt.preventDefault(),!1};return{init:function(model,pagectxid,taxonomies,rulesMods){var all;treeModel=model,pageContextId=pagectxid,(all=taxonomies.split(",")).unshift(""),delete all[0],taxonomiesConstants=all,rulesModules=rulesMods,$('[data-region="competencyactions"] [data-action="add"]').on("click",addHandler),menubar.enhance(".competencyactionsmenu",{'[data-action="edit"]':editHandler,'[data-action="delete"]':deleteCompetencyHandler,'[data-action="move"]':moveHandler,'[data-action="moveup"]':moveUpHandler,'[data-action="movedown"]':moveDownHandler,'[data-action="linkedcourses"]':seeCoursesHandler,'[data-action="relatedcompetencies"]':relateCompetenciesHandler.bind(this),'[data-action="competencyrules"]':ruleConfigHandler.bind(this)}),$('[data-region="competencyactionsmenu"]').hide(),$('[data-region="competencyactions"] [data-action="add"]').hide(),$('[data-region="filtercompetencies"]').on("submit",updateSearchHandler),$('[data-region="managecompetencies"] [data-enhance="tree"]').on("dragstart","li>span",dragStart).on("dragover","li>span",allowDrop).on("dragenter","li>span",dragEnter).on("dragleave","li>span",dragLeave).on("drop","li>span",dropOver),model.on("selectionchanged",selectionChanged),(ruleConfigInstance=new RuleConfig(treeModel,rulesModules)).on("save",ruleConfigSaveHandler.bind(this))}}}));
/**
 * Competency rule base module.
 *
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competency_rule",["jquery"],(function($){var Rule=function(tree){this._eventNode=$("<div>"),this._ready=$.Deferred(),this._tree=tree};return Rule.prototype._competency=null,Rule.prototype._eventNode=null,Rule.prototype._ready=null,Rule.prototype._tree=null,Rule.prototype.canConfig=function(){return this._tree.hasChildren(this._competency.id)},Rule.prototype.getConfig=function(){return null},Rule.prototype.getType=function(){throw new Error("Not implemented")},Rule.prototype.init=function(){return this._load()},Rule.prototype.injectTemplate=function(){return $.Deferred().reject().promise()},Rule.prototype.isValid=function(){return!1},Rule.prototype._load=function(){return $.when()},Rule.prototype.on=function(type,handler){this._eventNode.on(type,handler)},Rule.prototype.setTargetCompetency=function(competency){this._competency=competency},Rule.prototype._trigger=function(type,data){this._eventNode.trigger(type,[data])},Rule.prototype._triggerChange=function(){this._trigger("change",this)},Rule}));
/**
 * Handle selecting parent competency in competency form.
 *
 * @module     tool_lp/parentcompetency_form
 * @package    tool_lp
 * @copyright  2015 Issam Taboubi <issam.taboubi@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/parentcompetency_form",["jquery","core/ajax","core/str","tool_lp/competencypicker","core/templates","core/notification"],(function($,ajax,Str,Picker,Templates,Notification){var ParentCompetencyForm=function(buttonSelector,inputHiddenSelector,staticElementSelector,frameworkId,pageContextId){this.buttonSelector=buttonSelector,this.inputHiddenSelector=inputHiddenSelector,this.staticElementSelector=staticElementSelector,this.frameworkId=frameworkId,this.pageContextId=pageContextId,this.registerEvents()};return ParentCompetencyForm.prototype.buttonSelector=null,ParentCompetencyForm.prototype.inputHiddenSelector=null,ParentCompetencyForm.prototype.staticElementSelector=null,ParentCompetencyForm.prototype.frameworkId=null,ParentCompetencyForm.prototype.pageContextId=null,ParentCompetencyForm.prototype.setParent=function(data){var self=this;0!==data.competencyId?ajax.call([{methodname:"core_competency_read_competency",args:{id:data.competencyId}}])[0].done((function(competency){$(self.staticElementSelector).html(competency.shortname),$(self.inputHiddenSelector).val(competency.id)})).fail(Notification.exception):Str.get_string("competencyframeworkroot","tool_lp").then((function(rootframework){$(self.staticElementSelector).html(rootframework),$(self.inputHiddenSelector).val(data.competencyId)})).fail(Notification.exception)},ParentCompetencyForm.prototype.registerEvents=function(){var self=this;$(self.buttonSelector).on("click",(function(e){e.preventDefault();var picker=new Picker(self.pageContextId,self.frameworkId,"self",!1);picker._render=function(){var self=this;return self._preRender().then((function(){var context={competencies:self._competencies,framework:self._getFramework(self._frameworkId),frameworks:self._frameworks,search:self._searchText,singleFramework:self._singleFramework};return Templates.render("tool_lp/competency_picker_competencyform",context)}))},picker.on("save",(function(e,data){self.setParent(data)})),picker.display()}))},{init:function(buttonSelector,inputSelector,staticElementSelector,frameworkId,pageContextId){new ParentCompetencyForm(buttonSelector,inputSelector,staticElementSelector,frameworkId,pageContextId)}}}));
/**
 * Competency picker from user plans.
 *
 * To handle 'save' events use: picker.on('save').
 *
 * This will receive a object with either a single 'competencyId', or an array in 'competencyIds'
 * depending on the value of multiSelect.
 *
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencypicker_user_plans",["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/tree","tool_lp/competencypicker"],(function($,Notification,Ajax,Templates,Str,Tree,PickerBase){var Picker=function(userId,singlePlan,multiSelect){PickerBase.prototype.constructor.apply(this,[1,!1,"self",multiSelect]),this._userId=userId,this._plans=[],singlePlan&&(this._planId=singlePlan,this._singlePlan=!0)};return(Picker.prototype=Object.create(PickerBase.prototype))._plans=null,Picker.prototype._planId=null,Picker.prototype._singlePlan=!1,Picker.prototype._userId=null,Picker.prototype._afterRender=function(){var self=this;PickerBase.prototype._afterRender.apply(self,arguments),self._singlePlan||self._find('[data-action="chooseplan"]').change((function(e){self._planId=$(e.target).val(),self._loadCompetencies().then(self._refresh.bind(self)).catch(Notification.exception)}))},Picker.prototype._fetchCompetencies=function(planId,searchText){var self=this;return Ajax.call([{methodname:"core_competency_list_plan_competencies",args:{id:planId}}])[0].done((function(competencies){var i,comp,tree=[];for(i=0;i<competencies.length;i++)(comp=competencies[i].competency).shortname.toLowerCase().indexOf(searchText.toLowerCase())<0||(comp.children=[],comp.haschildren=0,tree.push(comp));self._competencies=tree})).fail(Notification.exception)},Picker.prototype._getPlan=function(id){var plan;return $.each(this._plans,(function(i,f){f.id!=id||(plan=f)})),plan},Picker.prototype._loadCompetencies=function(){return this._fetchCompetencies(this._planId,this._searchText)},Picker.prototype._loadPlans=function(){var self=this;return self._plans.length>0?$.when():(self._singlePlan?Ajax.call([{methodname:"core_competency_read_plan",args:{id:this._planId}}])[0].then((function(plan){return[plan]})):Ajax.call([{methodname:"core_competency_list_user_plans",args:{userid:self._userId}}])[0]).done((function(plans){self._plans=plans})).fail(Notification.exception)},Picker.prototype._preRender=function(){var self=this;return self._loadPlans().then((function(){return!self._planId&&self._plans.length>0&&(self._planId=self._plans[0].id),self._planId?self._loadCompetencies():(self._plans=[],$.when())}))},Picker.prototype._render=function(){var self=this;return self._preRender().then((function(){self._singlePlan||$.each(self._plans,(function(i,plan){plan.id==self._planId?plan.selected=!0:plan.selected=!1}));var context={competencies:self._competencies,plan:self._getPlan(self._planId),plans:self._plans,search:self._searchText,singlePlan:self._singlePlan};return Templates.render("tool_lp/competency_picker_user_plans",context)}))},Picker}));
/**
 * Drag and drop reorder via HTML5.
 *
 * @module     tool_lp/dragdrop-reorder
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/dragdrop-reorder",["core/str","core/yui"],(function(str,Y){var dragDropInstance=null,proxyCallback=function(e){var dragNode=e.drag.get("node"),dropNode=e.drop.get("node");this.callback(dragNode.getDOMNode(),dropNode.getDOMNode())};return{dragdrop:function(group,dragHandleText,sameNodeText,parentNodeText,sameNodeClass,parentNodeClass,dragHandleInsertClass,callback){str.get_strings([{key:"emptydragdropregion",component:"moodle"},{key:"movecontent",component:"moodle"},{key:"tocontent",component:"moodle"}]).done((function(){Y.use("moodle-tool_lp-dragdrop-reorder",(function(){var context={callback:callback};dragDropInstance&&dragDropInstance.destroy(),dragDropInstance=M.tool_lp.dragdrop_reorder({group:group,dragHandleText:dragHandleText,sameNodeText:sameNodeText,parentNodeText:parentNodeText,sameNodeClass:sameNodeClass,parentNodeClass:parentNodeClass,dragHandleInsertClass:dragHandleInsertClass,callback:Y.bind(proxyCallback,context)})}))}))}}}));
/**
 * Change the course competency settings in a popup.
 *
 * @module     tool_lp/configurecoursecompetencysettings
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/course_competency_settings",["jquery","core/notification","tool_lp/dialogue","core/str","core/ajax","core/templates","core/pending"],(function($,notification,Dialogue,str,ajax,templates,Pending){var settingsMod=function(selector){$(selector).on("click",this.configureSettings.bind(this))};return settingsMod.prototype._dialogue=null,settingsMod.prototype.configureSettings=function(e){var pendingPromise=new Pending,context={courseid:$(e.target).closest("a").data("courseid"),settings:{pushratingstouserplans:$(e.target).closest("a").data("pushratingstouserplans")}};e.preventDefault(),$.when(str.get_string("configurecoursecompetencysettings","tool_lp"),templates.render("tool_lp/course_competency_settings",context)).then(function(title,templateResult){return this._dialogue=new Dialogue(title,templateResult[0],this.addListeners.bind(this)),this._dialogue}.bind(this)).then(pendingPromise.resolve).catch(notification.exception)},settingsMod.prototype.addListeners=function(){this._find('[data-action="save"]').on("click",this.saveSettings.bind(this)),this._find('[data-action="cancel"]').on("click",this.cancelChanges.bind(this))},settingsMod.prototype.cancelChanges=function(e){e.preventDefault(),this._dialogue.close()},settingsMod.prototype._find=function(selector){return $('[data-region="coursecompetencysettings"]').find(selector)},settingsMod.prototype.saveSettings=function(e){var pendingPromise=new Pending;e.preventDefault();var newValue=this._find('input[name="pushratingstouserplans"]:checked').val(),courseId=this._find('input[name="courseid"]').val(),settings={pushratingstouserplans:newValue};ajax.call([{methodname:"core_competency_update_course_competency_settings",args:{courseid:courseId,settings:settings}}])[0].then(function(){return this.refreshCourseCompetenciesPage()}.bind(this)).then(pendingPromise.resolve).catch(notification.exception)},settingsMod.prototype.refreshCourseCompetenciesPage=function(){var courseId=this._find('input[name="courseid"]').val(),pendingPromise=new Pending;ajax.call([{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:courseId,moduleid:0}}])[0].then((function(context){return templates.render("tool_lp/course_competencies_page",context)})).then(function(html,js){templates.replaceNode($('[data-region="coursecompetenciespage"]'),html,js),this._dialogue.close()}.bind(this)).then(pendingPromise.resolve).catch(notification.exception)},settingsMod}));
/**
 * Handle selection changes on the competency tree.
 *
 * @module     tool_lp/competencyselect
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencytree",["core/ajax","core/notification","core/templates","tool_lp/tree","tool_lp/competency_outcomes","jquery"],(function(ajax,notification,templates,Ariatree,CompOutcomes,$){var competencies={},competencyFrameworkId=0,competencyFrameworkShortName="",treeSelector="",currentNodeId="",competencyFramworkCanManage=!1,addChildren=function addChildren(parent,all){var i=0,current=!1;for(parent.haschildren=!1,parent.children=[],i=0;i<all.length;i++)(current=all[i]).parentid==parent.id&&(parent.haschildren=!0,parent.children.push(current),addChildren(current,all))},loadCompetencies=function(searchtext){var deferred=$.Deferred();return templates.render("tool_lp/loading",{}).done((function(loadinghtml,loadingjs){templates.replaceNodeContents($(treeSelector),loadinghtml,loadingjs),ajax.call([{methodname:"core_competency_search_competencies",args:{searchtext:searchtext,competencyframeworkid:competencyFrameworkId}}])[0].done((function(result){competencies={};var i=0;for(i=0;i<result.length;i++)competencies[result[i].id]=result[i];var children=[],competency=!1;for(i=0;i<result.length;i++)competency=result[i],0===parseInt(competency.parentid,10)&&(children.push(competency),addChildren(competency,result));var context={shortname:competencyFrameworkShortName,canmanage:competencyFramworkCanManage,competencies:children};templates.render("tool_lp/competencies_tree_root",context).done((function(html,js){templates.replaceNodeContents($(treeSelector),$(html).html(),js);var tree=new Ariatree(treeSelector,!1);if(currentNodeId){var node=$(treeSelector).find("[data-id="+currentNodeId+"]");node.length&&(tree.selectItem(node),tree.updateFocus(node))}deferred.resolve(competencies)})).fail(deferred.reject)})).fail(deferred.reject)})),deferred.promise()},rememberCurrent=function(evt,params){var node=params.selected;currentNodeId=node.attr("data-id")};return{init:function(id,shortname,search,selector,canmanage,competencyid){competencyFrameworkId=id,competencyFrameworkShortName=shortname,competencyFramworkCanManage=canmanage,treeSelector=selector,loadCompetencies(search).fail(notification.exception),competencyid>0&&(currentNodeId=competencyid),this.on("selectionchanged",rememberCurrent)},on:function(eventname,handler){$(treeSelector).on(eventname,handler)},getChildren:function(id){var children=[];return $.each(competencies,(function(index,competency){competency.parentid==id&&children.push(competency)})),children},getCompetencyFrameworkId:function(){return competencyFrameworkId},getCompetency:function(id){return competencies[id]},getCompetencyLevel:function(id){return this.getCompetency(id).path.replace(/^\/|\/$/g,"").split("/").length},hasChildren:function(id){return this.getChildren(id).length>0},hasRule:function(id){var comp=this.getCompetency(id);return!!comp&&(comp.ruleoutcome!=CompOutcomes.OUTCOME_NONE&&comp.ruletype)},reloadCompetencies:function(){return loadCompetencies("").fail(notification.exception)},listCompetencies:function(){return competencies}}}));
/**
 * Frameworks datasource.
 *
 * This module is compatible with core/form-autocomplete.
 *
 * @package    tool_lpmigrate
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/frameworks_datasource",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{list:function(contextId,options){var args={context:{contextid:contextId}};return $.extend(args,void 0===options?{}:options),Ajax.call([{methodname:"core_competency_list_competency_frameworks",args:args}])[0]},processResults:function(selector,results){var options=[];return $.each(results,(function(index,data){options.push({value:data.id,label:data.shortname+" "+data.idnumber})})),options},transport:function(selector,query,callback){var el=$(selector),contextId=el.data("contextid"),onlyVisible=el.data("onlyvisible");if(!contextId)throw new Error("The attribute data-contextid is required on "+selector);this.list(contextId,{query:query,onlyvisible:onlyVisible}).then(callback).catch(Notification.exception)}}}));
/**
 * Badge select competency actions
 *
 * @module     tool_lp/form_competency_element
 * @package    tool_lp
 * @copyright  2019 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/form_competency_element",["jquery","tool_lp/competencypicker","core/ajax","core/notification","core/templates"],(function($,Picker,Ajax,Notification,Templates){var pickerInstance=null,pageContextId=1,renderCompetencies=function(){var currentCompetencies=$('[data-action="competencies"]').val(),requests=[],i=0;if(""!=currentCompetencies)for(currentCompetencies=currentCompetencies.split(","),i=0;i<currentCompetencies.length;i++)requests[requests.length]={methodname:"core_competency_read_competency",args:{id:currentCompetencies[i]}};return $.when.apply($,Ajax.call(requests,!1)).then((function(){var i=0,competencies=[];for(i=0;i<arguments.length;i++)competencies[i]=arguments[i];var context={competencies:competencies};return Templates.render("tool_lp/form_competency_list",context)})).then((function(html,js){return Templates.replaceNode($('[data-region="competencies"]'),html,js),!0})).fail(Notification.exception),!0},unpickCompetenciesHandler=function(e){var i,currentCompetencies=$('[data-action="competencies"]').val().split(","),newCompetencies=[],toRemove=$(e.currentTarget).data("id");for(i=0;i<currentCompetencies.length;i++)currentCompetencies[i]!=toRemove&&(newCompetencies[newCompetencies.length]=currentCompetencies[i]);return $('[data-action="competencies"]').val(newCompetencies.join(",")),renderCompetencies()},pickCompetenciesHandler=function(){var currentCompetencies=$('[data-action="competencies"]').val().split(",");pickerInstance||(pickerInstance=new Picker(pageContextId,!1,"parents",!0)).on("save",(function(e,data){var before=$('[data-action="competencies"]').val(),compIds=data.competencyIds;""!=before&&(compIds=compIds.concat(before.split(",")));var value=compIds.join(",");return $('[data-action="competencies"]').val(value),renderCompetencies()})),pickerInstance.setDisallowedCompetencyIDs(currentCompetencies),pickerInstance.display()};return{init:function(contextId){pageContextId=contextId,renderCompetencies(),$('[data-action="select-competencies"]').on("click",pickCompetenciesHandler),$("body").on("click",'[data-action="deselect-competency"]',unpickCompetenciesHandler)}}}));
/**
 * Module to get the scale values.
 *
 * @package    tool_lp
 * @copyright  2016 Serge Gauthier
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/scalevalues",["jquery","core/ajax"],(function($,ajax){var localCache=[];return{get_values:function(scaleid){var deferred=$.Deferred();return void 0===localCache[scaleid]?ajax.call([{methodname:"core_competency_get_scale_values",args:{scaleid:scaleid},done:function(scaleinfo){localCache[scaleid]=scaleinfo,deferred.resolve(scaleinfo)},fail:deferred.reject}]):deferred.resolve(localCache[scaleid]),deferred.promise()}}}));
/**
 * Display Competency in dialogue box.
 *
 * @module     tool_lp/Competencydialogue
 * @package    tool_lp
 * @copyright  2015 Issam Taboubi <issam.taboubi@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencydialogue",["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/dialogue"],(function($,notification,ajax,templates,str,Dialogue){var instance,Competencydialogue=function(){};return Competencydialogue.prototype.triggerCompetencyViewedEvent=function(competencyId){ajax.call([{methodname:"core_competency_competency_viewed",args:{id:competencyId}}])},Competencydialogue.prototype.showDialogue=function(competencyid,options){var datapromise=this.getCompetencyDataPromise(competencyid,options),localthis=this;datapromise.done((function(data){templates.render("tool_lp/competency_summary",data).done((function(html){localthis.triggerCompetencyViewedEvent(competencyid),new Dialogue(data.competency.shortname,html)})).fail(notification.exception)})).fail(notification.exception)},Competencydialogue.prototype.showDialogueFromData=function(dataSource){var localthis=this;templates.render("tool_lp/competency_summary",dataSource).done((function(html){localthis.triggerCompetencyViewedEvent(dataSource.id),new Dialogue(dataSource.shortname,html,localthis.enhanceDialogue)})).fail(notification.exception)},Competencydialogue.prototype.clickEventHandler=function(e){var compdialogue=e.data.compdialogue,currentTarget=$(e.currentTarget),competencyid=currentTarget.data("id"),includerelated=!currentTarget.data("excluderelated"),includecourses=currentTarget.data("includecourses");compdialogue.showDialogue(competencyid,{includerelated:includerelated,includecourses:includecourses}),e.preventDefault()},Competencydialogue.prototype.getCompetencyDataPromise=function(competencyid,options){return ajax.call([{methodname:"tool_lp_data_for_competency_summary",args:{competencyid:competencyid,includerelated:options.includerelated||!1,includecourses:options.includecourses||!1}}])[0].then((function(context){return context})).fail(notification.exception)},{init:function(){void 0===instance&&(instance=new Competencydialogue,$("body").delegate('[data-action="competency-dialogue"]',"click",{compdialogue:instance},instance.clickEventHandler.bind(instance)))}}}));
/**
 * Competency frameworks actions via ajax.
 *
 * @module     tool_lp/frameworkactions
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/frameworkactions",["jquery","core/templates","core/ajax","core/notification","core/str"],(function($,templates,ajax,notification,str){var pagecontextid=0,frameworkid=0,updatePage=function(newhtml,newjs){$('[data-region="managecompetencies"]').replaceWith(newhtml),templates.runTemplateJS(newjs)},reloadList=function(context){templates.render("tool_lp/manage_competency_frameworks_page",context).done(updatePage).fail(notification.exception)},doDelete=function(){var requests=ajax.call([{methodname:"core_competency_delete_competency_framework",args:{id:frameworkid}},{methodname:"tool_lp_data_for_competency_frameworks_manage_page",args:{pagecontext:{contextid:pagecontextid}}}]);requests[0].done((function(success){!1===success&&ajax.call([{methodname:"core_competency_read_competency_framework",args:{id:frameworkid}}])[0].done((function(framework){str.get_strings([{key:"frameworkcannotbedeleted",component:"tool_lp",param:framework.shortname},{key:"cancel",component:"moodle"}]).done((function(strings){notification.alert(null,strings[0])})).fail(notification.exception)}))})).fail(notification.exception),requests[1].done(reloadList).fail(notification.exception)};return{deleteHandler:function(e){e.preventDefault();var id=$(this).attr("data-frameworkid");frameworkid=id,ajax.call([{methodname:"core_competency_read_competency_framework",args:{id:frameworkid}}])[0].done((function(framework){str.get_strings([{key:"confirm",component:"moodle"},{key:"deletecompetencyframework",component:"tool_lp",param:framework.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],doDelete)})).fail(notification.exception)})).fail(notification.exception)},duplicateHandler:function(e){e.preventDefault(),frameworkid=$(this).attr("data-frameworkid"),ajax.call([{methodname:"core_competency_duplicate_competency_framework",args:{id:frameworkid}},{methodname:"tool_lp_data_for_competency_frameworks_manage_page",args:{pagecontext:{contextid:pagecontextid}}}])[1].done(reloadList).fail(notification.exception)},init:function(contextid){pagecontextid=contextid}}}));
/**
 * Cohort selector module.
 *
 * @module     tool_lp/form-cohort-selector
 * @class      form-cohort-selector
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/form-cohort-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var cohorts=[];return $.each(results,(function(index,cohort){cohorts.push({value:cohort.id,label:cohort._label})})),cohorts},transport:function(selector,query,success,failure){var contextid=parseInt($(selector).data("contextid"),10),includes=$(selector).data("includes");Ajax.call([{methodname:"tool_lp_search_cohorts",args:{query:query,context:{contextid:contextid},includes:includes}}])[0].then((function(results){var promises=[],i=0;return $.each(results.cohorts,(function(index,cohort){promises.push(Templates.render("tool_lp/form-cohort-selector-suggestion",cohort))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results.cohorts,(function(index,cohort){cohort._label=args[i],i++})),success(results.cohorts)}))})).catch(failure)}}}));
/**
 * Module to navigation between users in a course.
 *
 * @package    tool_lp
 * @copyright  2019 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/module_navigation",["jquery"],(function($){var ModuleNavigation=function(moduleSelector,baseUrl,courseId,moduleId){this._baseUrl=baseUrl,this._moduleId=moduleId,this._courseId=courseId,$(moduleSelector).on("change",this._moduleChanged.bind(this))};return ModuleNavigation.prototype._moduleChanged=function(e){var queryStr="?mod="+$(e.target).val()+"&courseid="+this._courseId;document.location=this._baseUrl+queryStr},ModuleNavigation.prototype._courseId=null,ModuleNavigation.prototype._moduleId=null,ModuleNavigation.prototype._baseUrl=null,ModuleNavigation}));
/**
 * Action selector.
 *
 * To handle 'save' events use: actionselector.on('save')
 * This will receive the information to display in popup.
 * The actions have the format [{'text': sometext, 'value' : somevalue}].
 *
 * @package    tool_lp
 * @copyright  2016 Serge Gauthier - <serge.gauthier.2@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/actionselector",["jquery","core/notification","core/ajax","core/templates","tool_lp/dialogue","tool_lp/event_base"],(function($,Notification,Ajax,Templates,Dialogue,EventBase){var ActionSelector=function(title,message,actions,confirm,cancel){EventBase.prototype.constructor.apply(this,[]),this._title=title,this._message=message,this._actions=actions,this._confirm=confirm,this._cancel=cancel,this._selectedValue=null,this._reset()};return(ActionSelector.prototype=Object.create(EventBase.prototype))._selectedValue=null,ActionSelector.prototype._popup=null,ActionSelector.prototype._title=null,ActionSelector.prototype._message=null,ActionSelector.prototype._actions=null,ActionSelector.prototype._confirm=null,ActionSelector.prototype._cancel=null,ActionSelector.prototype._afterRender=function(){var self=this;self._find('[data-action="action-selector-confirm"]').attr("disabled","disabled"),self._find('[data-region="action-selector-radio-buttons"]').change((function(){self._selectedValue=$("input[type='radio']:checked").val(),self._find('[data-action="action-selector-confirm"]').removeAttr("disabled"),self._refresh.bind(self)})),self._find('[data-action="action-selector-cancel"]').click((function(e){e.preventDefault(),self.close()})),self._find('[data-action="action-selector-confirm"]').click((function(e){e.preventDefault(),self._selectedValue.length&&(self._trigger("save",{action:self._selectedValue}),self.close())}))},ActionSelector.prototype.close=function(){this._popup.close(),this._reset()},ActionSelector.prototype.display=function(){var self=this;return self._render().then((function(html){self._popup=new Dialogue(self._title,html,self._afterRender.bind(self))})).fail(Notification.exception)},ActionSelector.prototype._find=function(selector){return $(this._popup.getContent()).find(selector)},ActionSelector.prototype._refresh=function(){var self=this;return self._render().then((function(html){self._find('[data-region="action-selector"]').replaceWith(html),self._afterRender()}))},ActionSelector.prototype._render=function(){var choices=[];for(var i in this._actions)choices.push(this._actions[i]);var content={message:this._message,choices:choices,confirm:this._confirm,cancel:this._cancel};return Templates.render("tool_lp/action_selector",content)},ActionSelector.prototype._reset=function(){this._popup=null,this._selectedValue=""},ActionSelector}));
/**
 * Competency rule config.
 *
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencyruleconfig",["jquery","core/notification","core/templates","tool_lp/dialogue","tool_lp/competency_outcomes","core/str"],(function($,Notification,Templates,Dialogue,Outcomes,Str){var RuleConfig=function(tree,rulesModules){this._eventNode=$("<div></div>"),this._tree=tree,this._rulesModules=rulesModules,this._setUp()};return RuleConfig.prototype._competency=null,RuleConfig.prototype._eventNode=null,RuleConfig.prototype._outcomesOption=null,RuleConfig.prototype._popup=null,RuleConfig.prototype._ready=null,RuleConfig.prototype._rules=null,RuleConfig.prototype._rulesModules=null,RuleConfig.prototype._tree=null,RuleConfig.prototype._afterChange=function(){this._isValid()?this._find('[data-action="save"]').prop("disabled",!1):this._find('[data-action="save"]').prop("disabled",!0)},RuleConfig.prototype._afterRuleConfigChange=function(e,rule){rule==this._getRule()&&this._afterChange()},RuleConfig.prototype._afterRender=function(){var self=this;self._find('[name="outcome"]').on("change",(function(){self._switchedOutcome()})).trigger("change"),self._find('[name="rule"]').on("change",(function(){self._switchedRule()})).trigger("change"),self._find('[data-action="save"]').on("click",(function(){self._trigger("save",self._getConfig()),self.close()})),self._find('[data-action="cancel"]').on("click",(function(){self.close()}))},RuleConfig.prototype.canBeConfigured=function(){var can=!1;return $.each(this._rules,(function(index,rule){rule.canConfig()&&(can=!0)})),can},RuleConfig.prototype.close=function(){this._popup.close(),this._popup=null},RuleConfig.prototype.display=function(){var self=this;return!!self._competency&&$.when(Str.get_string("competencyrule","tool_lp"),self._render()).then((function(title,render){self._popup=new Dialogue(title,render[0],self._afterRender.bind(self))})).fail(Notification.exception)},RuleConfig.prototype._find=function(selector){return $(this._popup.getContent()).find(selector)},RuleConfig.prototype._getApplicableOutcomesOptions=function(){var self=this,options=[];return $.each(self._outcomesOption,(function(index,outcome){options.push({code:outcome.code,name:outcome.name,selected:outcome.code==self._competency.ruleoutcome})})),options},RuleConfig.prototype._getApplicableRulesOptions=function(){var self=this,options=[];return $.each(self._rules,(function(index,rule){rule.canConfig()&&options.push({name:self._getRuleName(rule.getType()),type:rule.getType(),selected:rule.getType()==self._competency.ruletype})})),options},RuleConfig.prototype._getConfig=function(){var rule=this._getRule();return{ruletype:rule?rule.getType():null,ruleconfig:rule?rule.getConfig():null,ruleoutcome:this._getOutcome()}},RuleConfig.prototype._getOutcome=function(){return this._find('[name="outcome"]').val()},RuleConfig.prototype._getRule=function(){var result,type=this._find('[name="rule"]').val();return $.each(this._rules,(function(index,rule){rule.getType()!=type||(result=rule)})),result},RuleConfig.prototype._getRuleName=function(type){var name;return $.each(this._rulesModules,(function(index,modInfo){modInfo.type!=type||(name=modInfo.name)})),name},RuleConfig.prototype._initOutcomes=function(){var self=this;return Outcomes.getAll().then((function(outcomes){self._outcomesOption=outcomes}))},RuleConfig.prototype._initRules=function(){var self=this,promises=[];return $.each(self._rules,(function(index,rule){var promise=rule.init().then((function(){rule.setTargetCompetency(self._competency),rule.on("change",self._afterRuleConfigChange.bind(self))}),(function(){return self._rules.splice(index,1),$.when()}));promises.push(promise)})),$.when.apply($.when,promises)},RuleConfig.prototype._isValid=function(){var outcome=this._getOutcome(),rule=this._getRule();return outcome==Outcomes.NONE||!!rule&&rule.isValid()},RuleConfig.prototype.on=function(type,handler){this._eventNode.on(type,handler)},RuleConfig.prototype._preRender=function(){return this.ready()},RuleConfig.prototype.ready=function(){return this._ready.promise()},RuleConfig.prototype._render=function(){var self=this;return this._preRender().then((function(){var config;self.canBeConfigured()?((config={}).outcomes=self._getApplicableOutcomesOptions(),config.rules=self._getApplicableRulesOptions()):config=!1;var context={competencyshortname:self._competency.shortname,config:config};return Templates.render("tool_lp/competency_rule_config",context)}))},RuleConfig.prototype.setTargetCompetencyId=function(competencyId){var self=this;self._competency=self._tree.getCompetency(competencyId),$.each(self._rules,(function(index,rule){rule.setTargetCompetency(self._competency)}))},RuleConfig.prototype._setUp=function(){var self=this,promises=[],modules=[];self._ready=$.Deferred(),self._rules=[],$.each(self._rulesModules,(function(index,rule){modules.push(rule.amd)})),require(modules,(function(){$.each(arguments,(function(index,Module){var rule=new Module(self._tree);self._rules.push(rule)})),promises.push(self._initRules()),promises.push(self._initOutcomes()),$.when.apply($.when,promises).always((function(){self._ready.resolve()}))}))},RuleConfig.prototype._switchedOutcome=function(){if(this._getOutcome()==Outcomes.NONE)return this._find('[data-region="rule-type"]').hide().find('[name="rule"]').val(-1),this._find('[data-region="rule-config"]').empty().hide(),void this._afterChange();this._find('[data-region="rule-type"]').show(),this._find('[data-region="rule-config"]').show(),this._afterChange()},RuleConfig.prototype._switchedRule=function(){var self=this,container=self._find('[data-region="rule-config"]'),rule=self._getRule();if(!rule)return container.empty().hide(),void self._afterChange();rule.injectTemplate(container).then((function(){container.show()})).always((function(){self._afterChange()})).catch((function(){container.empty().hide()}))},RuleConfig.prototype._trigger=function(type,data){this._eventNode.trigger(type,[data])},RuleConfig}));
/**
 * Event base javascript module.
 *
 * @module     tool_lp/event_base
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/event_base",["jquery"],(function($){var Base=function(){this._eventNode=$("<div></div>")};return Base.prototype._eventNode=null,Base.prototype.on=function(type,handler){this._eventNode.on(type,handler)},Base.prototype._trigger=function(type,data){this._eventNode.trigger(type,[data])},Base}));
/**
 * User competency workflow.
 *
 * @module     tool_lp/user_competency_workflow
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/user_competency_workflow",["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/event_base"],(function($,Templates,Ajax,Notification,Str,Menubar,EventBase){var UserCompetencyWorkflow=function(){EventBase.prototype.constructor.apply(this,[])};return(UserCompetencyWorkflow.prototype=Object.create(EventBase.prototype))._nodeSelector='[data-node="user-competency"]',UserCompetencyWorkflow.prototype._cancelReviewRequest=function(data){var call={methodname:"core_competency_user_competency_cancel_review_request",args:{userid:data.userid,competencyid:data.competencyid}};Ajax.call([call])[0].then(function(){this._trigger("review-request-cancelled",data),this._trigger("status-changed",data)}.bind(this)).catch(function(){this._trigger("error-occured",data)}.bind(this))},UserCompetencyWorkflow.prototype.cancelReviewRequest=function(data){this._cancelReviewRequest(data)},UserCompetencyWorkflow.prototype._cancelReviewRequestHandler=function(e){e.preventDefault();var data=this._findUserCompetencyData($(e.target));this.cancelReviewRequest(data)},UserCompetencyWorkflow.prototype._requestReview=function(data){var call={methodname:"core_competency_user_competency_request_review",args:{userid:data.userid,competencyid:data.competencyid}};Ajax.call([call])[0].then(function(){this._trigger("review-requested",data),this._trigger("status-changed",data)}.bind(this)).catch(function(){this._trigger("error-occured",data)}.bind(this))},UserCompetencyWorkflow.prototype.requestReview=function(data){this._requestReview(data)},UserCompetencyWorkflow.prototype._requestReviewHandler=function(e){e.preventDefault();var data=this._findUserCompetencyData($(e.target));this.requestReview(data)},UserCompetencyWorkflow.prototype._startReview=function(data){var call={methodname:"core_competency_user_competency_start_review",args:{userid:data.userid,competencyid:data.competencyid}};Ajax.call([call])[0].then(function(){this._trigger("review-started",data),this._trigger("status-changed",data)}.bind(this)).catch(function(){this._trigger("error-occured",data)}.bind(this))},UserCompetencyWorkflow.prototype.startReview=function(data){this._startReview(data)},UserCompetencyWorkflow.prototype._startReviewHandler=function(e){e.preventDefault();var data=this._findUserCompetencyData($(e.target));this.startReview(data)},UserCompetencyWorkflow.prototype._stopReview=function(data){var call={methodname:"core_competency_user_competency_stop_review",args:{userid:data.userid,competencyid:data.competencyid}};Ajax.call([call])[0].then(function(){this._trigger("review-stopped",data),this._trigger("status-changed",data)}.bind(this)).catch(function(){this._trigger("error-occured",data)}.bind(this))},UserCompetencyWorkflow.prototype.stopReview=function(data){this._stopReview(data)},UserCompetencyWorkflow.prototype._stopReviewHandler=function(e){e.preventDefault();var data=this._findUserCompetencyData($(e.target));this.stopReview(data)},UserCompetencyWorkflow.prototype.enhanceMenubar=function(selector){Menubar.enhance(selector,{'[data-action="request-review"]':this._requestReviewHandler.bind(this),'[data-action="cancel-review-request"]':this._cancelReviewRequestHandler.bind(this)})},UserCompetencyWorkflow.prototype._findUserCompetencyData=function(node){var data,parent=node.parents(this._nodeSelector);if(1!=parent.length)throw new Error("The evidence node was not located.");if(void 0===(data=parent.data())||void 0===data.userid||void 0===data.competencyid)throw new Error("User competency data could not be found.");return data},UserCompetencyWorkflow.prototype.enhanceMenubar=function(selector){Menubar.enhance(selector,{'[data-action="request-review"]':this._requestReviewHandler.bind(this),'[data-action="cancel-review-request"]':this._cancelReviewRequestHandler.bind(this),'[data-action="start-review"]':this._startReviewHandler.bind(this),'[data-action="stop-review"]':this._stopReviewHandler.bind(this)})},UserCompetencyWorkflow.prototype.registerEvents=function(selector){var wrapper=$(selector);wrapper.find('[data-action="request-review"]').click(this._requestReviewHandler.bind(this)),wrapper.find('[data-action="cancel-review-request"]').click(this._cancelReviewRequestHandler.bind(this)),wrapper.find('[data-action="start-review"]').click(this._startReviewHandler.bind(this)),wrapper.find('[data-action="stop-review"]').click(this._stopReviewHandler.bind(this))},UserCompetencyWorkflow}));
/**
 * Aria menubar functionality. Enhances a simple nested list structure into a full aria widget.
 * Based on the open ajax example: http://oaa-accessibility.org/example/26/
 *
 * @module     tool_lp/menubar
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/menubar",["jquery"],(function($){var documentClickHandlerRegistered=!1,menuActive=!1,closeAllSubMenus=function(){$(".tool-lp-menu .tool-lp-sub-menu").attr("aria-hidden","true"),menuActive=!1},Menubar=function(menuRoot,handlers){this.menuRoot=menuRoot,this.handlers=handlers,this.rootMenus=this.menuRoot.children("li"),this.subMenus=this.rootMenus.children("ul"),this.subMenuItems=this.subMenus.children("li"),this.allItems=this.rootMenus.add(this.subMenuItems),this.activeItem=null,this.isChildOpen=!1,this.keys={tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40},this.addAriaAttributes(),this.addEventListeners()};return Menubar.prototype.openSubMenu=function(menu){this.setOpenDirection(),closeAllSubMenus(),menu.attr("aria-hidden","false"),menuActive=!0},Menubar.prototype.addEventListeners=function(){var currentThis=this;!1===documentClickHandlerRegistered&&($(document).click((function(){menuActive&&closeAllSubMenus()})),documentClickHandlerRegistered=!0),this.subMenuItems.mouseenter((function(){return $(this).addClass("menu-hover"),!0})),this.subMenuItems.mouseout((function(){return $(this).removeClass("menu-hover"),!0})),this.allItems.click((function(e){return currentThis.handleClick($(this),e)})),this.allItems.keydown((function(e){return currentThis.handleKeyDown($(this),e)})),this.allItems.focus((function(){return currentThis.handleFocus($(this))})),this.allItems.blur((function(){return currentThis.handleBlur($(this))}))},Menubar.prototype.handleClick=function(item,e){if(e.stopPropagation(),item.parent().is(".tool-lp-menu"))"true"==item.children("ul").first().attr("aria-hidden")?this.openSubMenu(item.children("ul").first()):item.children("ul").first().attr("aria-hidden","true");else{this.allItems.removeClass("menu-hover menu-focus"),this.activeItem=null,this.menuRoot.find("ul").not(".root-level").attr("aria-hidden","true");var anchor=item.find("a").first(),clickEvent=new $.Event("click");clickEvent.target=anchor;var eventHandled=!1;this.handlers&&$.each(this.handlers,(function(selector,handler){if(!eventHandled&&item.find(selector).length>0){var callable=$.proxy(handler,anchor);eventHandled=!1===callable(clickEvent)||clickEvent.isDefaultPrevented()}})),eventHandled||"#"===anchor.attr("href")||(window.location.href=anchor.attr("href"))}return!1},Menubar.prototype.handleFocus=function(item){if(null===this.activeItem)this.activeItem=item;else if(item[0]!=this.activeItem[0])return!0;var parentItems=this.activeItem.parentsUntil("ul.tool-lp-menu").filter("li");(this.allItems.removeClass("menu-focus"),this.activeItem.addClass("menu-focus"),parentItems.addClass("menu-focus"),!0===this.isChildOpen)&&(item.parent().is(".tool-lp-menu")&&"true"==item.attr("aria-haspopup")&&this.openSubMenu(item.children("ul").first()));return!0},Menubar.prototype.handleBlur=function(item){return item.removeClass("menu-focus"),!0},Menubar.prototype.setOpenDirection=function(){var pos=this.menuRoot.offset(),isRTL=$(document.body).hasClass("dir-rtl"),heightmenuRoot=this.rootMenus.outerHeight(),widthmenuRoot=this.rootMenus.outerWidth(),subMenuContainer=this.rootMenus.find("ul.tool-lp-sub-menu");subMenuContainer.css("margin-right",""),subMenuContainer.css("margin-left",""),subMenuContainer.css("margin-top",""),subMenuContainer.attr("aria-hidden",!1);var menuRealWidth=subMenuContainer.outerWidth(),menuRealHeight=subMenuContainer.outerHeight(),margintop=null,marginright=null,marginleft=null;pos.top-$(window).scrollTop()+menuRealHeight>$(window).height()&&(margintop=menuRealHeight+heightmenuRoot,subMenuContainer.css("margin-top","-"+margintop+"px")),isRTL?pos.left-menuRealWidth<0&&(marginright=menuRealWidth-widthmenuRoot,subMenuContainer.css("margin-right","-"+marginright+"px")):pos.left+menuRealWidth>$(window).width()&&(marginleft=menuRealWidth-widthmenuRoot,subMenuContainer.css("margin-left","-"+marginleft+"px")),this.menuRoot.addClass("tool-lp-menu-open-left")},Menubar.prototype.handleKeyDown=function(item,e){if(e.altKey||e.ctrlKey)return!0;switch(e.keyCode){case this.keys.tab:this.menuRoot.find("ul").attr("aria-hidden","true"),this.allItems.removeClass("menu-focus"),this.activeItem=null,this.isChildOpen=!1;break;case this.keys.esc:var itemUL=item.parent();return itemUL.is(".tool-lp-menu")?item.children("ul").first().attr("aria-hidden","true"):(this.activeItem=itemUL.parent(),this.isChildOpen=!1,this.activeItem.focus(),itemUL.attr("aria-hidden","true")),e.stopPropagation(),!1;case this.keys.enter:case this.keys.space:return this.handleClick(item,e);case this.keys.left:return this.activeItem=this.moveToPrevious(item),this.activeItem.focus(),e.stopPropagation(),!1;case this.keys.right:return this.activeItem=this.moveToNext(item),this.activeItem.focus(),e.stopPropagation(),!1;case this.keys.up:return this.activeItem=this.moveUp(item),this.activeItem.focus(),e.stopPropagation(),!1;case this.keys.down:return this.activeItem=this.moveDown(item),this.activeItem.focus(),e.stopPropagation(),!1}return!0},Menubar.prototype.moveToNext=function(item){var itemUL=item.parent(),menuItems=itemUL.children("li"),menuNum=menuItems.length,menuIndex=menuItems.index(item),newItem=null,childMenu=null;if(itemUL.is(".tool-lp-menu"))newItem=menuIndex<menuNum-1?item.next():menuItems.first(),"true"==item.attr("aria-haspopup")&&"false"==(childMenu=item.children("ul").first()).attr("aria-hidden")&&(childMenu.attr("aria-hidden","true"),this.isChildOpen=!0),item.removeClass("menu-focus"),"true"===newItem.attr("aria-haspopup")&&!0===this.isChildOpen&&(childMenu=newItem.children("ul").first(),this.openSubMenu(childMenu));else if("true"==item.attr("aria-haspopup"))newItem=(childMenu=item.children("ul").first()).children("li").first(),this.openSubMenu(childMenu);else{var parentMenus=null,rootItem=null;(parentMenus=item.parentsUntil("ul.tool-lp-menu").filter("ul").not(".tool-lp-menu")).attr("aria-hidden","true"),parentMenus.find("li").removeClass("menu-focus"),parentMenus.last().parent().removeClass("menu-focus"),rootItem=parentMenus.last().parent(),(newItem=(menuIndex=this.rootMenus.index(rootItem))<this.rootMenus.length-1?rootItem.next():this.rootMenus.first()).addClass("menu-focus"),"true"==newItem.attr("aria-haspopup")&&(childMenu=newItem.children("ul").first(),newItem=childMenu.children("li").first(),this.openSubMenu(childMenu),this.isChildOpen=!0)}return newItem},Menubar.prototype.moveToPrevious=function(item){var itemUL=item.parent(),menuItems=itemUL.children("li"),menuIndex=menuItems.index(item),newItem=null,childMenu=null;if(itemUL.is(".tool-lp-menu"))newItem=menuIndex>0?item.prev():menuItems.last(),"true"==item.attr("aria-haspopup")&&"false"==(childMenu=item.children("ul").first()).attr("aria-hidden")&&(childMenu.attr("aria-hidden","true"),this.isChildOpen=!0),item.removeClass("menu-focus"),"true"===newItem.attr("aria-haspopup")&&!0===this.isChildOpen&&(childMenu=newItem.children("ul").first(),this.openSubMenu(childMenu));else{var parentLI=itemUL.parent();parentLI.parent().is(".tool-lp-menu")?(itemUL.attr("aria-hidden","true"),item.removeClass("menu-focus"),parentLI.removeClass("menu-focus"),(newItem=(menuIndex=this.rootMenus.index(parentLI))>0?parentLI.prev():this.rootMenus.last()).addClass("menu-focus"),"true"==newItem.attr("aria-haspopup")&&(childMenu=newItem.children("ul").first(),this.openSubMenu(childMenu),this.isChildOpen=!0,newItem=childMenu.children("li").first())):(newItem=itemUL.parent(),itemUL.attr("aria-hidden","true"),item.removeClass("menu-focus"))}return newItem},Menubar.prototype.moveDown=function(item,startChr){var itemUL=item.parent(),menuItems=itemUL.children("li").not(".separator"),menuNum=menuItems.length,menuIndex=menuItems.index(item),newItem=null,newItemUL=null;if(itemUL.is(".tool-lp-menu"))return"true"!=item.attr("aria-haspopup")?item:(newItem=(newItemUL=item.children("ul").first()).children("li").first(),this.openSubMenu(newItemUL),newItem);if(startChr){var match=!1,curNdx=menuIndex+1;for(curNdx==menuNum&&(curNdx=0);curNdx!=menuIndex;){if(menuItems.eq(curNdx).html().charAt(0).toLowerCase()==startChr){match=!0;break}(curNdx+=1)==menuNum&&(curNdx=0)}return!0===match?(newItem=menuItems.eq(curNdx),item.removeClass("menu-focus"),newItem):item}return newItem=menuIndex<menuNum-1?menuItems.eq(menuIndex+1):menuItems.first(),item.removeClass("menu-focus"),newItem},Menubar.prototype.moveUp=function(item){var itemUL=item.parent(),menuItems=itemUL.children("li").not(".separator"),menuIndex=menuItems.index(item),newItem=null;return itemUL.is(".tool-lp-menu")?item:(newItem=menuIndex>0?menuItems.eq(menuIndex-1):menuItems.last(),item.removeClass("menu-focus"),newItem)},Menubar.prototype.addAriaAttributes=function(){this.menuRoot.attr("role","menubar"),this.rootMenus.attr("role","menuitem"),this.rootMenus.attr("tabindex","0"),this.rootMenus.attr("aria-haspopup","true"),this.subMenus.attr("role","menu"),this.subMenus.attr("aria-hidden","true"),this.subMenuItems.attr("role","menuitem"),this.subMenuItems.attr("tabindex","-1"),this.menuRoot.addClass("tool-lp-menu"),this.allItems.addClass("tool-lp-menu-item"),this.rootMenus.addClass("tool-lp-root-menu"),this.subMenus.addClass("tool-lp-sub-menu"),this.subMenuItems.addClass("dropdown-item")},{enhance:function(selector,handler){$(selector).each((function(index,element){var menuRoot=$(element);!0!==menuRoot.data("menubarEnhanced")&&(new Menubar(menuRoot,handler),menuRoot.data("menubarEnhanced",!0))}))},closeAll:closeAllSubMenus}}));
/**
 * Wrapper for the YUI M.core.notification class. Allows us to
 * use the YUI version in AMD code until it is replaced.
 *
 * @module     tool_lp/dialogue
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/dialogue",["core/yui"],(function(Y){var dialogue=function(title,content,afterShow,afterHide,wide){M.util.js_pending("tool_lp/dialogue:dialogue"),this.yuiDialogue=null;var parent=this;void 0===wide&&(wide=!1),Y.use("moodle-core-notification","timers",(function(){var width="480px";wide&&(width="800px"),parent.yuiDialogue=new M.core.dialogue({headerContent:title,bodyContent:content,draggable:!0,visible:!1,center:!0,modal:!0,width:width}),parent.yuiDialogue.before("visibleChange",(function(){M.util.js_pending("tool_lp/dialogue:before:visibleChange")})),parent.yuiDialogue.after("visibleChange",(function(e){e.newVal?void 0!==afterShow?Y.soon((function(){afterShow(parent),parent.yuiDialogue.centerDialogue(),M.util.js_complete("tool_lp/dialogue:before:visibleChange")})):M.util.js_complete("tool_lp/dialogue:before:visibleChange"):void 0!==afterHide?Y.soon((function(){afterHide(parent),M.util.js_complete("tool_lp/dialogue:before:visibleChange")})):M.util.js_complete("tool_lp/dialogue:before:visibleChange")})),parent.yuiDialogue.show(),M.util.js_complete("tool_lp/dialogue:dialogue")}))};return dialogue.prototype.close=function(){this.yuiDialogue.hide(),this.yuiDialogue.destroy()},dialogue.prototype.getContent=function(){return this.yuiDialogue.bodyNode.getDOMNode()},dialogue}));
/**
 * Module to enable inline editing of a comptency grade.
 *
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/grade_user_competency_inline",["jquery","core/notification","core/ajax","core/log","tool_lp/grade_dialogue","tool_lp/event_base","tool_lp/scalevalues"],(function($,notification,ajax,log,GradeDialogue,EventBase,ScaleValues){var InlineEditor=function(selector,scaleId,competencyId,userId,planId,courseId,chooseStr){EventBase.prototype.constructor.apply(this,[]);var trigger=$(selector);if(!trigger.length)throw new Error("Could not find the trigger");this._scaleId=scaleId,this._competencyId=competencyId,this._userId=userId,this._planId=planId,this._courseId=courseId,this._chooseStr=chooseStr,this._setUp(),trigger.click(function(e){e.preventDefault(),this._dialogue.display()}.bind(this)),this._planId?(this._methodName="core_competency_grade_competency_in_plan",this._args={competencyid:this._competencyId,planid:this._planId}):this._courseId?(this._methodName="core_competency_grade_competency_in_course",this._args={competencyid:this._competencyId,courseid:this._courseId,userid:this._userId}):(this._methodName="core_competency_grade_competency",this._args={userid:this._userId,competencyid:this._competencyId})};return(InlineEditor.prototype=Object.create(EventBase.prototype))._setUp=function(){var options=[],self=this;M.util.js_pending("tool_lp/grade_user_competency_inline:_setUp"),ScaleValues.get_values(self._scaleId).then((function(scalevalues){options.push({value:"",name:self._chooseStr});for(var i=0;i<scalevalues.length;i++){var optionConfig=scalevalues[i];options.push({value:optionConfig.id,name:optionConfig.name})}return options})).then((function(options){return new GradeDialogue(options)})).then((function(dialogue){return dialogue.on("rated",(function(e,data){var args=self._args;args.grade=data.rating,args.note=data.note,ajax.call([{methodname:self._methodName,args:args,done:function(evidence){self._trigger("competencyupdated",{args:args,evidence:evidence})},fail:notification.exception}])})),dialogue})).then((function(dialogue){self._dialogue=dialogue,M.util.js_complete("tool_lp/grade_user_competency_inline:_setUp")})).fail(notification.exception)},InlineEditor.prototype._scaleId=null,InlineEditor.prototype._competencyId=null,InlineEditor.prototype._userId=null,InlineEditor.prototype._planId=null,InlineEditor.prototype._courseId=null,InlineEditor.prototype._chooseStr=null,InlineEditor.prototype._dialogue=null,InlineEditor}));
/**
 * When returning to Moodle let the user select which course to add the resource to.
 *
 * @module     tool_moodlenet/select_page
 * @package    tool_moodlenet
 * @copyright  2020 Mathew May <mathew.solutions>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_moodlenet/select_page",["core/ajax","core/templates","tool_moodlenet/selectors","core/notification"],(function(Ajax,Templates,Selectors,Notification){var importId,searchCourses=function(inputValue,page,areaReplace){var searchIcon=page.querySelector(Selectors.region.searchIcon),clearIcon=page.querySelector(Selectors.region.clearIcon);""!==inputValue?(searchIcon.classList.add("d-none"),clearIcon.parentElement.classList.remove("d-none")):(searchIcon.classList.remove("d-none"),clearIcon.parentElement.classList.add("d-none"));var args={searchvalue:inputValue};Ajax.call([{methodname:"tool_moodlenet_search_courses",args:args}])[0].then((function(result){return 0===result.courses.length?function(areaReplace){return Templates.renderPix("courses","tool_moodlenet").then((function(img){return img})).then((function(img){var temp=document.createElement("div");return temp.innerHTML=img.trim(),Templates.render("core_course/no-courses",{nocoursesimg:temp.firstChild.src})})).then((function(html,js){Templates.replaceNodeContents(areaReplace,html,js),areaReplace.classList.add("mx-auto"),areaReplace.classList.add("w-25")}))}(areaReplace):(result.courses.forEach((function(course){course.viewurl+="&id="+importId})),function(areaReplace,courses){return Templates.render("tool_moodlenet/view-cards",{courses:courses}).then((function(html,js){Templates.replaceNodeContents(areaReplace,html,js),areaReplace.classList.remove("mx-auto"),areaReplace.classList.remove("w-25")}))}(areaReplace,result.courses))})).catch(Notification.exception)},registerListenerEvents=function(page){var input=page.querySelector(Selectors.region.searchInput),courseArea=page.querySelector(Selectors.region.courses);page.querySelector(Selectors.region.clearIcon).addEventListener("click",(function(){input.value="",searchCourses("",page,courseArea)})),input.addEventListener("input",debounce((function(){searchCourses(input.value,page,courseArea)}),300))},addCourses=function(page){var courseArea=page.querySelector(Selectors.region.courses);searchCourses("",page,courseArea)},debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}};return{init:function(importIdString){importId=importIdString;var page=document.querySelector(Selectors.region.selectPage);registerListenerEvents(page),addCourses(page)}}}));
/**
 * Our validator that splits the user's input then fires off to a webservice
 *
 * @module     tool_moodlenet/validator
 * @package    tool_moodlenet
 * @copyright  2020 Mathew May <mathew.solutions>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_moodlenet/validator",["jquery","core/ajax","core/str","core/notification"],(function($,Ajax,Str,Notification){return{validation:function(inputElement){var inputValue=inputElement.value;return""!==inputValue&&inputValue.includes("@")||$.when(Str.get_string("profilevalidationerror","tool_moodlenet")).then((function(strings){return Promise.reject().catch((function(){return{result:!1,message:strings[0]}}))})).fail(Notification.exception),Ajax.call([{methodname:"tool_moodlenet_verify_webfinger",args:{profileurl:inputValue,course:inputElement.dataset.courseid,section:inputElement.dataset.sectionid}}])[0].then((function(result){return result})).catch()}}}));
/**
 * Our basic form manager for when a user either enters
 * their profile url or just wants to browse.
 *
 * This file is a mishmash of JS functions we need for both the standalone (M3.7, M3.8)
 * plugin & Moodle 3.9 functions. The 3.9 Functions have a base understanding that certain
 * things exist i.e. directory structures for templates. When this feature goes 3.9+ only
 * The goal is that we can quickly gut all AMD modules into bare JS files and use ES6 guidelines.
 * Till then this will have to do.
 *
 * @module     tool_moodlenet/instance_form
 * @package    tool_moodlenet
 * @copyright  2020 Mathew May <mathew.solutions>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_moodlenet/instance_form",["tool_moodlenet/validator","tool_moodlenet/selectors","core/loadingicon","core/templates","core/notification","jquery"],(function(Validator,Selectors,LoadingIcon,Templates,Notification,$){var chooserNavigateToMnet=function(showMoodleNet,footerData,carousel,modal){showMoodleNet.innerHTML="";var page,spinnerPromise=LoadingIcon.addIconToContainer(showMoodleNet),transitionPromiseResolver=null,transitionPromise=new Promise((function(resolve){transitionPromiseResolver=resolve}));$.when(spinnerPromise,transitionPromise).then((function(){Templates.replaceNodeContents(showMoodleNet,footerData.customcarouseltemplate,"")})).catch(Notification.exception),(page=showMoodleNet).addEventListener("click",(function(e){if(e.target.matches(Selectors.action.submit)){var input=page.querySelector('[data-var="mnet-link"]'),overlay=page.querySelector(Selectors.region.spinner),validationArea=document.querySelector(Selectors.region.validationArea);overlay.classList.remove("d-none");var spinner=LoadingIcon.addIconToContainerWithPromise(overlay);Validator.validation(input).then((function(result){spinner.resolve(),overlay.classList.add("d-none"),result.result?(input.classList.remove("is-invalid"),input.classList.add("is-valid"),validationArea.innerText=result.message,validationArea.classList.remove("text-error"),validationArea.classList.add("text-success"),setTimeout((function(){window.location=result.domain}),1e3)):(input.classList.add("is-invalid"),validationArea.innerText=result.message,validationArea.classList.add("text-error"))})).catch()}})),carousel.one("slid.bs.carousel",(function(){transitionPromiseResolver()})),carousel.carousel(2),modal.setFooter(Templates.render("tool_moodlenet/chooser_footer_close_mnet",{}))};return{footerClickListener:function(e,footerData,modal){if(e.target.matches(Selectors.action.showMoodleNet)||e.target.closest(Selectors.action.showMoodleNet)){e.preventDefault();var carousel=$(modal.getBody()[0].querySelector(Selectors.region.carousel)),showMoodleNet=carousel.find(Selectors.region.moodleNet)[0];chooserNavigateToMnet(showMoodleNet,footerData,carousel,modal)}e.target.matches(Selectors.action.closeOption)&&function(carousel,modal,footerData){carousel.carousel(0),modal.setFooter(footerData.customfootertemplate)}($(modal.getBody()[0].querySelector(Selectors.region.carousel)),modal,footerData)}}}));
/**
 * Define all of the selectors we will be using within MoodleNet plugin.
 *
 * @module     tool_moodlenet/selectors
 * @package    tool_moodlenet
 * @copyright  2020 Mathew May <mathew.solutions>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_moodlenet/selectors",[],(function(){return{action:{browse:'[data-action="browse"]',submit:'[data-action="submit"]',showMoodleNet:'[data-action="show-moodlenet"]',closeOption:'[data-action="close-chooser-option-summary"]'},region:{clearIcon:'[data-region="clear-icon"]',courses:'[data-region="mnet-courses"]',instancePage:'[data-region="moodle-net"]',searchInput:'[data-region="search-input"]',searchIcon:'[data-region="search-icon"]',selectPage:'[data-region="moodle-net-select"]',spinner:'[data-region="spinner"]',validationArea:'[data-region="validation-area"]',carousel:'[data-region="carousel"]',moodleNet:'[data-region="pluginCarousel"]'}}}));
function _typeof2(t){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof2=function(t){return typeof t}}else{_typeof2=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return _typeof2(t)}var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(t){return _typeof2(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof2(t)};(function(t,o){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module){module.exports=o()}else if("function"==typeof define&&define.amd){define ("tool_opencast/tabulator",o)}else{t.Tabulator=o()}})(this,function(){'use strict';if(!Array.prototype.findIndex){Object.defineProperty(Array.prototype,"findIndex",{value:function(t){if(null==this){throw new TypeError("\"this\" is null or not defined")}var l=Object(this),o=l.length>>>0;if("function"!=typeof t){throw new TypeError("predicate must be a function")}var a=arguments[1],n=0;while(n<o){var r=l[n];if(t.call(a,r,n,l)){return n}n++}return-1}})}if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this){throw new TypeError("\"this\" is null or not defined")}var l=Object(this),o=l.length>>>0;if("function"!=typeof t){throw new TypeError("predicate must be a function")}var a=arguments[1],n=0;while(n<o){var r=l[n];if(t.call(a,r,n,l)){return r}n++}}})}if(!String.prototype.includes){String.prototype.includes=function(t,o){if(t instanceof RegExp){throw TypeError("first argument must not be a RegExp")}if(o===void 0){o=0}return-1!==this.indexOf(t,o)}}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function(t,l){if(null==this){throw new TypeError("\"this\" is null or not defined")}var r=Object(this),o=r.length>>>0;if(0===o){return!1}var s=0|l,n=Math.max(0<=s?s:o-Math.abs(s),0);function a(t,o){return t===o||"number"==typeof t&&"number"==typeof o&&isNaN(t)&&isNaN(o)}while(n<o){if(a(r[n],t)){return!0}n++}return!1}})}if("function"!=typeof Object.assign){Object.defineProperty(Object,"assign",{value:function(t){if(null===t||t===void 0){throw new TypeError("Cannot convert undefined or null to object")}for(var o=Object(t),l=1,a;l<arguments.length;l++){a=arguments[l];if(null!==a&&a!==void 0){for(var n in a){if(Object.prototype.hasOwnProperty.call(a,n)){o[n]=a[n]}}}}return o},writable:!0,configurable:!0})}var t=function(t){this.table=t;this.blockHozScrollEvent=!1;this.headersElement=this.createHeadersElement();this.element=this.createHeaderElement();this.rowManager=null;this.columns=[];this.columnsByIndex=[];this.columnsByField={};this.scrollLeft=0;this.element.insertBefore(this.headersElement,this.element.firstChild)};t.prototype.createHeadersElement=function(){var t=document.createElement("div");t.classList.add("tabulator-headers");return t};t.prototype.createHeaderElement=function(){var t=document.createElement("div");t.classList.add("tabulator-header");if(!this.table.options.headerVisible){t.classList.add("tabulator-header-hidden")}return t};t.prototype.initialize=function(){this};t.prototype.setRowManager=function(t){this.rowManager=t};t.prototype.getElement=function(){return this.element};t.prototype.getHeadersElement=function(){return this.headersElement};t.prototype.scrollHorizontal=function(t){var o=0,l=this.element.scrollWidth-this.table.element.clientWidth;this.element.scrollLeft=t;if(t>l){o=t-l;this.element.style.marginLeft=-o+"px"}else{this.element.style.marginLeft=0}this.scrollLeft=t;if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.scrollHorizontal()}};t.prototype.generateColumnsFromRowData=function(t){var o=[],l=this.table.options.autoColumnsDefinitions,a,n;if(t&&t.length){a=t[0];for(var r in a){var s={field:r,title:r},d=a[r];switch("undefined"==typeof d?"undefined":_typeof(d)){case"undefined":n="string";break;case"boolean":n="boolean";break;case"object":if(Array.isArray(d)){n="array"}else{n="string"}break;default:if(!isNaN(d)&&""!==d){n="number"}else{if(d.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)){n="alphanum"}else{n="string"}}break;}s.sorter=n;o.push(s)}if(l){switch("undefined"==typeof l?"undefined":_typeof(l)){case"function":this.table.options.columns=l.call(this.table,o);break;case"object":if(Array.isArray(l)){o.forEach(function(t){var o=l.find(function(o){return o.field===t.field});if(o){Object.assign(t,o)}})}else{o.forEach(function(t){if(l[t.field]){Object.assign(t,l[t.field])}})}this.table.options.columns=o;break;}}else{this.table.options.columns=o}this.setColumns(this.table.options.columns)}};t.prototype.setColumns=function(t){var o=this;while(o.headersElement.firstChild){o.headersElement.removeChild(o.headersElement.firstChild)}o.columns=[];o.columnsByIndex=[];o.columnsByField={};if(o.table.modExists("frozenColumns")){o.table.modules.frozenColumns.reset()}t.forEach(function(t){o._addColumn(t)});o._reIndexColumns();if(o.table.options.responsiveLayout&&o.table.modExists("responsiveLayout",!0)){o.table.modules.responsiveLayout.initialize()}if(this.table.options.virtualDomHoz){this.table.vdomHoz.reinitialize(!1,!0)}o.redraw(!0)};t.prototype._addColumn=function(t,o,a){var n=new l(t,this),r=n.getElement(),s=a?this.findColumnIndex(a):a;if(a&&-1<s){var d=this.columns.indexOf(a.getTopColumn()),p=a.getElement();if(o){this.columns.splice(d,0,n);p.parentNode.insertBefore(r,p)}else{this.columns.splice(d+1,0,n);p.parentNode.insertBefore(r,p.nextSibling)}}else{if(o){this.columns.unshift(n);this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)}else{this.columns.push(n);this.headersElement.appendChild(n.getElement())}n.columnRendered()}return n};t.prototype.registerColumnField=function(t){if(t.definition.field){this.columnsByField[t.definition.field]=t}};t.prototype.registerColumnPosition=function(t){this.columnsByIndex.push(t)};t.prototype._reIndexColumns=function(){this.columnsByIndex=[];this.columns.forEach(function(t){t.reRegisterPosition()})};t.prototype._verticalAlignHeaders=function(){var t=this,o=0;t.columns.forEach(function(t){var l;t.clearVerticalAlign();l=t.getHeight();if(l>o){o=l}});t.columns.forEach(function(l){l.verticalAlign(t.table.options.columnHeaderVertAlign,o)});t.rowManager.adjustTableSize()};t.prototype.findColumn=function(t){var a=this;if("object"==("undefined"==typeof t?"undefined":_typeof(t))){if(t instanceof l){return t}else if(t instanceof o){return t._getSelf()||!1}else if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement){var n=a.columns.find(function(o){return o.element===t});return n||!1}}else{return this.columnsByField[t]||!1}return!1};t.prototype.getColumnByField=function(t){return this.columnsByField[t]};t.prototype.getColumnsByFieldRoot=function(t){var o=this,l=[];Object.keys(this.columnsByField).forEach(function(a){var n=a.split(".")[0];if(n===t){l.push(o.columnsByField[a])}});return l};t.prototype.getColumnByIndex=function(t){return this.columnsByIndex[t]};t.prototype.getFirstVisibileColumn=function(t){var t=this.columnsByIndex.findIndex(function(t){return t.visible});return-1<t?this.columnsByIndex[t]:!1};t.prototype.getColumns=function(){return this.columns};t.prototype.findColumnIndex=function(t){return this.columnsByIndex.findIndex(function(o){return t===o})};t.prototype.getRealColumns=function(){return this.columnsByIndex};t.prototype.traverse=function(t){var o=this;o.columnsByIndex.forEach(function(o,l){t(o,l)})};t.prototype.getDefinitions=function(t){var o=this,l=[];o.columnsByIndex.forEach(function(o){if(!t||t&&o.visible){l.push(o.getDefinition())}});return l};t.prototype.getDefinitionTree=function(){var t=this,o=[];t.columns.forEach(function(t){o.push(t.getDefinition(!0))});return o};t.prototype.getComponents=function(t){var o=this,l=[],a=t?o.columns:o.columnsByIndex;a.forEach(function(t){l.push(t.getComponent())});return l};t.prototype.getWidth=function(){var t=0;this.columnsByIndex.forEach(function(o){if(o.visible){t+=o.getWidth()}});return t};t.prototype.moveColumn=function(t,o,l){this.moveColumnActual(t,o,l);if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.initialize()}if(this.table.modExists("columnCalcs")){this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows)}o.element.parentNode.insertBefore(t.element,o.element);if(l){o.element.parentNode.insertBefore(o.element,t.element)}this._verticalAlignHeaders();this.table.rowManager.reinitialize()};t.prototype.moveColumnActual=function(t,o,l){if(t.parent.isGroup){this._moveColumnInArray(t.parent.columns,t,o,l)}else{this._moveColumnInArray(this.columns,t,o,l)}this._moveColumnInArray(this.columnsByIndex,t,o,l,!0);if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.initialize()}if(this.table.options.virtualDomHoz){this.table.vdomHoz.reinitialize(!0)}if(this.table.options.columnMoved){this.table.options.columnMoved.call(this.table,t.getComponent(),this.table.columnManager.getComponents())}if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.columns){this.table.modules.persistence.save("columns")}};t.prototype._moveColumnInArray=function(t,o,l,a,n){var r=this,s=t.indexOf(o),d,p=[];if(-1<s){t.splice(s,1);d=t.indexOf(l);if(-1<d){if(a){d=d+1}}else{d=s}t.splice(d,0,o);if(n){if(this.table.options.dataTree&&this.table.modExists("dataTree",!0)){this.table.rowManager.rows.forEach(function(t){p=p.concat(r.table.modules.dataTree.getTreeChildren(t,!1,!0))})}p=p.concat(this.table.rowManager.rows);p.forEach(function(t){if(t.cells.length){var o=t.cells.splice(s,1)[0];t.cells.splice(d,0,o)}})}}};t.prototype.scrollToColumn=function(t,o,l){var a=this,n=0,r=0,s=0,d=t.getElement();return new Promise(function(p,c){if("undefined"==typeof o){o=a.table.options.scrollToColumnPosition}if("undefined"==typeof l){l=a.table.options.scrollToColumnIfVisible}if(t.visible){switch(o){case"middle":case"center":s=-a.element.clientWidth/2;break;case"right":s=d.clientWidth-a.headersElement.clientWidth;break;}if(!l){r=d.offsetLeft;if(0<r&&r+d.offsetWidth<a.element.clientWidth){return!1}}n=d.offsetLeft+s;n=Math.max(Math.min(n,a.table.rowManager.element.scrollWidth-a.table.rowManager.element.clientWidth),0);a.table.rowManager.scrollHorizontal(n);a.scrollHorizontal(n);p()}else{console.warn("Scroll Error - Column not visible");c("Scroll Error - Column not visible")}})};t.prototype.generateCells=function(t){var o=this,l=[];o.columnsByIndex.forEach(function(o){l.push(o.generateCell(t))});return l};t.prototype.getFlexBaseWidth=function(){var t=this,o=t.table.element.clientWidth,l=0;if(t.rowManager.element.scrollHeight>t.rowManager.element.clientHeight){o-=t.rowManager.element.offsetWidth-t.rowManager.element.clientWidth}this.columnsByIndex.forEach(function(a){var n,r,s;if(a.visible){n=a.definition.width||0;r="undefined"==typeof a.minWidth?t.table.options.columnMinWidth:parseInt(a.minWidth);if("string"==typeof n){if(-1<n.indexOf("%")){s=o/100*parseInt(n)}else{s=parseInt(n)}}else{s=n}l+=s>r?s:r}});return l};t.prototype.addColumn=function(t,o,l){var a=this;return new Promise(function(n){var r=a._addColumn(t,o,l);a._reIndexColumns();if(a.table.options.responsiveLayout&&a.table.modExists("responsiveLayout",!0)){a.table.modules.responsiveLayout.initialize()}if(a.table.modExists("columnCalcs")){a.table.modules.columnCalcs.recalc(a.table.rowManager.activeRows)}a.redraw(!0);if("fitColumns"!=a.table.modules.layout.getMode()){r.reinitializeWidth()}a._verticalAlignHeaders();a.table.rowManager.reinitialize();if(a.table.options.virtualDomHoz){a.table.vdomHoz.reinitialize()}n(r)})};t.prototype.deregisterColumn=function(t){var o=t.getField(),l;if(o){delete this.columnsByField[o]}l=this.columnsByIndex.indexOf(t);if(-1<l){this.columnsByIndex.splice(l,1)}l=this.columns.indexOf(t);if(-1<l){this.columns.splice(l,1)}if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.initialize()}this._verticalAlignHeaders();this.redraw()};t.prototype.redraw=function(t){if(t){if(u.prototype.helpers.elVisible(this.element)){this._verticalAlignHeaders()}this.table.rowManager.resetScroll();this.table.rowManager.reinitialize()}if(-1<["fitColumns","fitDataStretch"].indexOf(this.table.modules.layout.getMode())){this.table.modules.layout.layout()}else{if(t){this.table.modules.layout.layout()}else{if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}}}if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layout()}if(this.table.modExists("columnCalcs")){this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows)}if(t){if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.columns){this.table.modules.persistence.save("columns")}if(this.table.modExists("columnCalcs")){this.table.modules.columnCalcs.redraw()}}this.table.footerManager.redraw()};var o=function(t){this._column=t;this.type="ColumnComponent"};o.prototype.getElement=function(){return this._column.getElement()};o.prototype.getDefinition=function(){return this._column.getDefinition()};o.prototype.getField=function(){return this._column.getField()};o.prototype.getCells=function(){var t=[];this._column.cells.forEach(function(o){t.push(o.getComponent())});return t};o.prototype.getVisibility=function(){console.warn("getVisibility function is deprecated, you should now use the isVisible function");return this._column.visible};o.prototype.isVisible=function(){return this._column.visible};o.prototype.show=function(){if(this._column.isGroup){this._column.columns.forEach(function(t){t.show()})}else{this._column.show()}};o.prototype.hide=function(){if(this._column.isGroup){this._column.columns.forEach(function(t){t.hide()})}else{this._column.hide()}};o.prototype.toggle=function(){if(this._column.visible){this.hide()}else{this.show()}};o.prototype.delete=function(){return this._column.delete()};o.prototype.getSubColumns=function(){var t=[];if(this._column.columns.length){this._column.columns.forEach(function(o){t.push(o.getComponent())})}return t};o.prototype.getParentColumn=function(){return this._column.parent instanceof l?this._column.parent.getComponent():!1};o.prototype._getSelf=function(){return this._column};o.prototype.scrollTo=function(){return this._column.table.columnManager.scrollToColumn(this._column)};o.prototype.getTable=function(){return this._column.table};o.prototype.headerFilterFocus=function(){if(this._column.table.modExists("filter",!0)){this._column.table.modules.filter.setHeaderFilterFocus(this._column)}};o.prototype.reloadHeaderFilter=function(){if(this._column.table.modExists("filter",!0)){this._column.table.modules.filter.reloadHeaderFilter(this._column)}};o.prototype.getHeaderFilterValue=function(){if(this._column.table.modExists("filter",!0)){return this._column.table.modules.filter.getHeaderFilterValue(this._column)}};o.prototype.setHeaderFilterValue=function(t){if(this._column.table.modExists("filter",!0)){this._column.table.modules.filter.setHeaderFilterValue(this._column,t)}};o.prototype.move=function(t,o){var l=this._column.table.columnManager.findColumn(t);if(l){this._column.table.columnManager.moveColumn(this._column,l,o)}else{console.warn("Move Error - No matching column found:",l)}};o.prototype.getNextColumn=function(){var t=this._column.nextColumn();return t?t.getComponent():!1};o.prototype.getPrevColumn=function(){var t=this._column.prevColumn();return t?t.getComponent():!1};o.prototype.updateDefinition=function(t){return this._column.updateDefinition(t)};o.prototype.getWidth=function(){return this._column.getWidth()};o.prototype.setWidth=function(t){var o;if(!0===t){o=this._column.reinitializeWidth(!0)}else{o=this._column.setWidth(t)}if(this._column.table.options.virtualDomHoz){this._column.table.vdomHoz.reinitialize(!0)}return o};o.prototype.validate=function(){return this._column.validate()};var l=function t(o,l){var a=this;this.table=l.table;this.definition=o;this.parent=l;this.type="column";this.columns=[];this.cells=[];this.element=this.createElement();this.contentElement=!1;this.titleHolderElement=!1;this.titleElement=!1;this.groupElement=this.createGroupElement();this.isGroup=!1;this.tooltip=!1;this.hozAlign="";this.vertAlign="";this.field="";this.fieldStructure="";this.getFieldValue="";this.setFieldValue="";this.titleFormatterRendered=!1;this.setField(this.definition.field);if(this.table.options.invalidOptionWarnings){this.checkDefinition()}this.modules={};this.cellEvents={cellClick:!1,cellDblClick:!1,cellContext:!1,cellTap:!1,cellDblTap:!1,cellTapHold:!1,cellMouseEnter:!1,cellMouseLeave:!1,cellMouseOver:!1,cellMouseOut:!1,cellMouseMove:!1};this.width=null;this.widthStyled="";this.maxWidth=null;this.maxWidthStyled="";this.minWidth=null;this.minWidthStyled="";this.widthFixed=!1;this.visible=!0;this.component=null;this._mapDepricatedFunctionality();if(o.columns){this.isGroup=!0;o.columns.forEach(function(o){var l=new t(o,a);a.attachColumn(l)});a.checkColumnVisibility()}else{l.registerColumnField(this)}if(o.rowHandle&&!1!==this.table.options.movableRows&&this.table.modExists("moveRow")){this.table.modules.moveRow.setHandle(!0)}this._buildHeader();this.bindModuleColumns()};l.prototype.createElement=function(){var t=document.createElement("div");t.classList.add("tabulator-col");t.setAttribute("role","columnheader");t.setAttribute("aria-sort","none");return t};l.prototype.createGroupElement=function(){var t=document.createElement("div");t.classList.add("tabulator-col-group-cols");return t};l.prototype.checkDefinition=function(){var t=this;Object.keys(this.definition).forEach(function(o){if(-1===t.defaultOptionList.indexOf(o)){console.warn("Invalid column definition option in '"+(t.field||t.definition.title)+"' column:",o)}})};l.prototype.setField=function(t){this.field=t;this.fieldStructure=t?this.table.options.nestedFieldSeparator?t.split(this.table.options.nestedFieldSeparator):[t]:[];this.getFieldValue=1<this.fieldStructure.length?this._getNestedData:this._getFlatData;this.setFieldValue=1<this.fieldStructure.length?this._setNestedData:this._setFlatData};l.prototype.registerColumnPosition=function(t){this.parent.registerColumnPosition(t)};l.prototype.registerColumnField=function(t){this.parent.registerColumnField(t)};l.prototype.reRegisterPosition=function(){if(this.isGroup){this.columns.forEach(function(t){t.reRegisterPosition()})}else{this.registerColumnPosition(this)}};l.prototype._mapDepricatedFunctionality=function(){if("undefined"!=typeof this.definition.hideInHtml){this.definition.htmlOutput=!this.definition.hideInHtml;console.warn("hideInHtml column definition property is deprecated, you should now use htmlOutput")}if("undefined"!=typeof this.definition.align){this.definition.hozAlign=this.definition.align;console.warn("align column definition property is deprecated, you should now use hozAlign")}if("undefined"!=typeof this.definition.downloadTitle){this.definition.titleDownload=this.definition.downloadTitle;console.warn("downloadTitle definition property is deprecated, you should now use titleDownload")}};l.prototype.setTooltip=function(){var t=this,o=t.definition,l=o.headerTooltip||!1===o.tooltip?o.headerTooltip:t.table.options.tooltipsHeader;if(l){if(!0===l){if(o.field){t.table.modules.localize.bind("columns|"+o.field,function(l){t.element.setAttribute("title",l||o.title)})}else{t.element.setAttribute("title",o.title)}}else{if("function"==typeof l){l=l(t.getComponent());if(!1===l){l=""}}t.element.setAttribute("title",l)}}else{t.element.setAttribute("title","")}};l.prototype._buildHeader=function(){var t=this,o=t.definition;while(t.element.firstChild){t.element.removeChild(t.element.firstChild)}if(o.headerVertical){t.element.classList.add("tabulator-col-vertical");if("flip"===o.headerVertical){t.element.classList.add("tabulator-col-vertical-flip")}}t.contentElement=t._bindEvents();t.contentElement=t._buildColumnHeaderContent();t.element.appendChild(t.contentElement);if(t.isGroup){t._buildGroupHeader()}else{t._buildColumnHeader()}t.setTooltip();if(t.table.options.resizableColumns&&t.table.modExists("resizeColumns")){t.table.modules.resizeColumns.initializeColumn("header",t,t.element)}if(o.headerFilter&&t.table.modExists("filter")&&t.table.modExists("edit")){if("undefined"!=typeof o.headerFilterPlaceholder&&o.field){t.table.modules.localize.setHeaderFilterColumnPlaceholder(o.field,o.headerFilterPlaceholder)}t.table.modules.filter.initializeColumn(t)}if(t.table.modExists("frozenColumns")){t.table.modules.frozenColumns.initializeColumn(t)}if(t.table.options.movableColumns&&!t.isGroup&&t.table.modExists("moveColumn")){t.table.modules.moveColumn.initializeColumn(t)}if((o.topCalc||o.bottomCalc)&&t.table.modExists("columnCalcs")){t.table.modules.columnCalcs.initializeColumn(t)}if(t.table.modExists("persistence")&&t.table.modules.persistence.config.columns){t.table.modules.persistence.initializeColumn(t)}t.element.addEventListener("mouseenter",function(){t.setTooltip()})};l.prototype._bindEvents=function(){var t=this,o=t.definition,l,a,n;if("function"==typeof o.headerClick){t.element.addEventListener("click",function(l){o.headerClick(l,t.getComponent())})}if("function"==typeof o.headerDblClick){t.element.addEventListener("dblclick",function(l){o.headerDblClick(l,t.getComponent())})}if("function"==typeof o.headerContext){t.element.addEventListener("contextmenu",function(l){o.headerContext(l,t.getComponent())})}if("function"==typeof o.headerTap){n=!1;t.element.addEventListener("touchstart",function(){n=!0},{passive:!0});t.element.addEventListener("touchend",function(l){if(n){o.headerTap(l,t.getComponent())}n=!1})}if("function"==typeof o.headerDblTap){l=null;t.element.addEventListener("touchend",function(a){if(l){clearTimeout(l);l=null;o.headerDblTap(a,t.getComponent())}else{l=setTimeout(function(){clearTimeout(l);l=null},300)}})}if("function"==typeof o.headerTapHold){a=null;t.element.addEventListener("touchstart",function(l){clearTimeout(a);a=setTimeout(function(){clearTimeout(a);a=null;n=!1;o.headerTapHold(l,t.getComponent())},1e3)},{passive:!0});t.element.addEventListener("touchend",function(){clearTimeout(a);a=null})}if("function"==typeof o.cellClick){t.cellEvents.cellClick=o.cellClick}if("function"==typeof o.cellDblClick){t.cellEvents.cellDblClick=o.cellDblClick}if("function"==typeof o.cellContext){t.cellEvents.cellContext=o.cellContext}if("function"==typeof o.cellMouseEnter){t.cellEvents.cellMouseEnter=o.cellMouseEnter}if("function"==typeof o.cellMouseLeave){t.cellEvents.cellMouseLeave=o.cellMouseLeave}if("function"==typeof o.cellMouseOver){t.cellEvents.cellMouseOver=o.cellMouseOver}if("function"==typeof o.cellMouseOut){t.cellEvents.cellMouseOut=o.cellMouseOut}if("function"==typeof o.cellMouseMove){t.cellEvents.cellMouseMove=o.cellMouseMove}if("function"==typeof o.cellTap){t.cellEvents.cellTap=o.cellTap}if("function"==typeof o.cellDblTap){t.cellEvents.cellDblTap=o.cellDblTap}if("function"==typeof o.cellTapHold){t.cellEvents.cellTapHold=o.cellTapHold}if("function"==typeof o.cellEdited){t.cellEvents.cellEdited=o.cellEdited}if("function"==typeof o.cellEditing){t.cellEvents.cellEditing=o.cellEditing}if("function"==typeof o.cellEditCancelled){t.cellEvents.cellEditCancelled=o.cellEditCancelled}};l.prototype._buildColumnHeader=function(){var t=this,o=this.definition,l=this.table;if(l.modExists("sort")){l.modules.sort.initializeColumn(this,this.titleHolderElement)}if((o.headerContextMenu||o.headerClickMenu||o.headerMenu)&&l.modExists("menu")){l.modules.menu.initializeColumnHeader(this)}if(l.modExists("format")){l.modules.format.initializeColumn(this)}if("undefined"!=typeof o.editor&&l.modExists("edit")){l.modules.edit.initializeColumn(this)}if("undefined"!=typeof o.validator&&l.modExists("validate")){l.modules.validate.initializeColumn(this)}if(l.modExists("mutator")){l.modules.mutator.initializeColumn(this)}if(l.modExists("accessor")){l.modules.accessor.initializeColumn(this)}if(_typeof(l.options.responsiveLayout)&&l.modExists("responsiveLayout")){l.modules.responsiveLayout.initializeColumn(this)}if("undefined"!=typeof o.visible){if(o.visible){this.show(!0)}else{this.hide(!0)}}if(o.cssClass){var a=o.cssClass.split(" ");a.forEach(function(o){t.element.classList.add(o)})}if(o.field){this.element.setAttribute("tabulator-field",o.field)}this.setMinWidth("undefined"==typeof o.minWidth?this.table.options.columnMinWidth:parseInt(o.minWidth));if(o.maxWidth||this.table.options.columnMaxWidth){if(!1!==o.maxWidth){this.setMaxWidth("undefined"==typeof o.maxWidth?this.table.options.columnMaxWidth:parseInt(o.maxWidth))}}this.reinitializeWidth();this.tooltip=this.definition.tooltip||!1===this.definition.tooltip?this.definition.tooltip:this.table.options.tooltips;this.hozAlign="undefined"==typeof this.definition.hozAlign?this.table.options.cellHozAlign:this.definition.hozAlign;this.vertAlign="undefined"==typeof this.definition.vertAlign?this.table.options.cellVertAlign:this.definition.vertAlign;this.titleElement.style.textAlign=this.definition.headerHozAlign||this.table.options.headerHozAlign};l.prototype._buildColumnHeaderContent=function(){var t=this.definition,o=this.table,l=document.createElement("div");l.classList.add("tabulator-col-content");this.titleHolderElement=document.createElement("div");this.titleHolderElement.classList.add("tabulator-col-title-holder");l.appendChild(this.titleHolderElement);this.titleElement=this._buildColumnHeaderTitle();this.titleHolderElement.appendChild(this.titleElement);return l};l.prototype._buildColumnHeaderTitle=function(){var t=this,o=t.definition,l=t.table,a=document.createElement("div");a.classList.add("tabulator-col-title");if(o.editableTitle){var n=document.createElement("input");n.classList.add("tabulator-title-editor");n.addEventListener("click",function(t){t.stopPropagation();n.focus()});n.addEventListener("change",function(){o.title=n.value;l.options.columnTitleChanged.call(t.table,t.getComponent())});a.appendChild(n);if(o.field){l.modules.localize.bind("columns|"+o.field,function(t){n.value=t||o.title||"&nbsp;"})}else{n.value=o.title||"&nbsp;"}}else{if(o.field){l.modules.localize.bind("columns|"+o.field,function(l){t._formatColumnHeaderTitle(a,l||o.title||"&nbsp;")})}else{t._formatColumnHeaderTitle(a,o.title||"&nbsp;")}}return a};l.prototype._formatColumnHeaderTitle=function(t,o){var l=this,a,n,r,s,d;if(this.definition.titleFormatter&&this.table.modExists("format")){a=this.table.modules.format.getFormatter(this.definition.titleFormatter);d=function(t){l.titleFormatterRendered=t};s={getValue:function(){return o},getElement:function(){return t}};r=this.definition.titleFormatterParams||{};r="function"==typeof r?r():r;n=a.call(this.table.modules.format,s,r,d);switch("undefined"==typeof n?"undefined":_typeof(n)){case"object":if(n instanceof Node){t.appendChild(n)}else{t.innerHTML="";console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",n)}break;case"undefined":case"null":t.innerHTML="";break;default:t.innerHTML=n;}}else{t.innerHTML=o}};l.prototype._buildGroupHeader=function(){var t=this;this.element.classList.add("tabulator-col-group");this.element.setAttribute("role","columngroup");this.element.setAttribute("aria-title",this.definition.title);if(this.definition.cssClass){var o=this.definition.cssClass.split(" ");o.forEach(function(o){t.element.classList.add(o)})}if((this.definition.headerContextMenu||this.definition.headerMenu)&&this.table.modExists("menu")){this.table.modules.menu.initializeColumnHeader(this)}this.titleElement.style.textAlign=this.definition.headerHozAlign||this.table.options.headerHozAlign;this.element.appendChild(this.groupElement)};l.prototype._getFlatData=function(t){return t[this.field]};l.prototype._getNestedData=function(t){for(var o=t,l=this.fieldStructure,a=l.length,n,r=0;r<a;r++){o=o[l[r]];n=o;if(!o){break}}return n};l.prototype._setFlatData=function(t,o){if(this.field){t[this.field]=o}};l.prototype._setNestedData=function(t,o){for(var l=t,a=this.fieldStructure,n=a.length,r=0;r<n;r++){if(r==n-1){l[a[r]]=o}else{if(!l[a[r]]){if("undefined"!=typeof o){l[a[r]]={}}else{break}}l=l[a[r]]}}};l.prototype.attachColumn=function(t){var o=this;if(o.groupElement){o.columns.push(t);o.groupElement.appendChild(t.getElement())}else{console.warn("Column Warning - Column being attached to another column instead of column group")}};l.prototype.verticalAlign=function(t,o){var l=this.parent.isGroup?this.parent.getGroupElement().clientHeight:o||this.parent.getHeadersElement().clientHeight;this.element.style.height=l+"px";if(this.isGroup){this.groupElement.style.minHeight=l-this.contentElement.offsetHeight+"px"}if(!this.isGroup&&"top"!==t){if("bottom"===t){this.element.style.paddingTop=this.element.clientHeight-this.contentElement.offsetHeight+"px"}else{this.element.style.paddingTop=(this.element.clientHeight-this.contentElement.offsetHeight)/2+"px"}}this.columns.forEach(function(o){o.verticalAlign(t)})};l.prototype.clearVerticalAlign=function(){this.element.style.paddingTop="";this.element.style.height="";this.element.style.minHeight="";this.groupElement.style.minHeight="";this.columns.forEach(function(t){t.clearVerticalAlign()})};l.prototype.bindModuleColumns=function(){if("rownum"==this.definition.formatter){this.table.rowManager.rowNumColumn=this}};l.prototype.getElement=function(){return this.element};l.prototype.getGroupElement=function(){return this.groupElement};l.prototype.getField=function(){return this.field};l.prototype.getFirstColumn=function(){if(!this.isGroup){return this}else{if(this.columns.length){return this.columns[0].getFirstColumn()}else{return!1}}};l.prototype.getLastColumn=function(){if(!this.isGroup){return this}else{if(this.columns.length){return this.columns[this.columns.length-1].getLastColumn()}else{return!1}}};l.prototype.getColumns=function(){return this.columns};l.prototype.getCells=function(){return this.cells};l.prototype.getTopColumn=function(){if(this.parent.isGroup){return this.parent.getTopColumn()}else{return this}};l.prototype.getDefinition=function(t){var o=[];if(this.isGroup&&t){this.columns.forEach(function(t){o.push(t.getDefinition(!0))});this.definition.columns=o}return this.definition};l.prototype.checkColumnVisibility=function(){var t=!1;this.columns.forEach(function(o){if(o.visible){t=!0}});if(t){this.show();this.parent.table.options.columnVisibilityChanged.call(this.table,this.getComponent(),!1)}else{this.hide()}};l.prototype.show=function(t,o){if(!this.visible){this.visible=!0;this.element.style.display="";if(this.parent.isGroup){this.parent.checkColumnVisibility()}this.cells.forEach(function(t){t.show()});if(!this.isGroup&&null===this.width){this.reinitializeWidth()}this.table.columnManager._verticalAlignHeaders();if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.columns){this.table.modules.persistence.save("columns")}if(!o&&this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.updateColumnVisibility(this,this.visible)}if(!t){this.table.options.columnVisibilityChanged.call(this.table,this.getComponent(),!0)}if(this.parent.isGroup){this.parent.matchChildWidths()}if(!this.silent&&this.table.options.virtualDomHoz){this.table.vdomHoz.reinitialize()}}};l.prototype.hide=function(t,o){if(this.visible){this.visible=!1;this.element.style.display="none";this.table.columnManager._verticalAlignHeaders();if(this.parent.isGroup){this.parent.checkColumnVisibility()}this.cells.forEach(function(t){t.hide()});if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.columns){this.table.modules.persistence.save("columns")}if(!o&&this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.updateColumnVisibility(this,this.visible)}if(!t){this.table.options.columnVisibilityChanged.call(this.table,this.getComponent(),!1)}if(this.parent.isGroup){this.parent.matchChildWidths()}if(!this.silent&&this.table.options.virtualDomHoz){this.table.vdomHoz.reinitialize()}}};l.prototype.matchChildWidths=function(){var t=0;if(this.contentElement&&this.columns.length){this.columns.forEach(function(o){if(o.visible){t+=o.getWidth()}});this.contentElement.style.maxWidth=t-1+"px";if(this.parent.isGroup){this.parent.matchChildWidths()}}};l.prototype.removeChild=function(t){var o=this.columns.indexOf(t);if(-1<o){this.columns.splice(o,1)}if(!this.columns.length){this.delete()}};l.prototype.setWidth=function(t){this.widthFixed=!0;this.setWidthActual(t)};l.prototype.setWidthActual=function(t){if(isNaN(t)){t=Math.floor(this.table.element.clientWidth/100*parseInt(t))}t=Math.max(this.minWidth,t);if(this.maxWidth){t=Math.min(this.maxWidth,t)}this.width=t;this.widthStyled=t?t+"px":"";this.element.style.width=this.widthStyled;if(!this.isGroup){this.cells.forEach(function(t){t.setWidth()})}if(this.parent.isGroup){this.parent.matchChildWidths()}if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layout()}};l.prototype.checkCellHeights=function(){var t=[];this.cells.forEach(function(o){if(o.row.heightInitialized){if(null!==o.row.getElement().offsetParent){t.push(o.row);o.row.clearCellHeight()}else{o.row.heightInitialized=!1}}});t.forEach(function(t){t.calcHeight()});t.forEach(function(t){t.setCellHeight()})};l.prototype.getWidth=function(){var t=0;if(this.isGroup){this.columns.forEach(function(o){if(o.visible){t+=o.getWidth()}})}else{t=this.width}return t};l.prototype.getHeight=function(){return this.element.offsetHeight};l.prototype.setMinWidth=function(t){this.minWidth=t;this.minWidthStyled=t?t+"px":"";this.element.style.minWidth=this.minWidthStyled;this.cells.forEach(function(t){t.setMinWidth()})};l.prototype.setMaxWidth=function(t){this.maxWidth=t;this.maxWidthStyled=t?t+"px":"";this.element.style.maxWidth=this.maxWidthStyled;this.cells.forEach(function(t){t.setMaxWidth()})};l.prototype.delete=function(){var t=this;return new Promise(function(o){if(t.isGroup){t.columns.forEach(function(t){t.delete()})}if(t.table.modExists("edit")){if(t.table.modules.edit.currentCell.column===t){t.table.modules.edit.cancelEdit()}}for(var l=t.cells.length,a=0;a<l;a++){t.cells[0].delete()}if(t.element.parentNode){t.element.parentNode.removeChild(t.element)}t.element=!1;t.contentElement=!1;t.titleElement=!1;t.groupElement=!1;if(t.parent.isGroup){t.parent.removeChild(t)}t.table.columnManager.deregisterColumn(t);if(t.table.options.virtualDomHoz){t.table.vdomHoz.reinitialize(!0)}o()})};l.prototype.columnRendered=function(){if(this.titleFormatterRendered){this.titleFormatterRendered()}};l.prototype.validate=function(){var t=[];this.cells.forEach(function(o){if(!o.validate()){t.push(o.getComponent())}});return t.length?t:!0};l.prototype.generateCell=function(t){var o=this,l=new p(o,t);this.cells.push(l);return l};l.prototype.nextColumn=function(){var t=this.table.columnManager.findColumnIndex(this);return-1<t?this._nextVisibleColumn(t+1):!1};l.prototype._nextVisibleColumn=function(t){var o=this.table.columnManager.getColumnByIndex(t);return!o||o.visible?o:this._nextVisibleColumn(t+1)};l.prototype.prevColumn=function(){var t=this.table.columnManager.findColumnIndex(this);return-1<t?this._prevVisibleColumn(t-1):!1};l.prototype._prevVisibleColumn=function(t){var o=this.table.columnManager.getColumnByIndex(t);return!o||o.visible?o:this._prevVisibleColumn(t-1)};l.prototype.reinitializeWidth=function(t){this.widthFixed=!1;if("undefined"!=typeof this.definition.width&&!t){this.setWidth(this.definition.width)}if(this.table.modExists("filter")){this.table.modules.filter.hideHeaderFilterElements()}this.fitToData();if(this.table.modExists("filter")){this.table.modules.filter.showHeaderFilterElements()}};l.prototype.fitToData=function(){var t=this;if(!this.widthFixed){this.element.style.width="";t.cells.forEach(function(t){t.clearWidth()})}var o=this.element.offsetWidth;if(!t.width||!this.widthFixed){t.cells.forEach(function(t){var l=t.getWidth();if(l>o){o=l}});if(o){t.setWidthActual(o+1)}}};l.prototype.updateDefinition=function(t){var o=this;return new Promise(function(l,a){var n;if(!o.isGroup){if(!o.parent.isGroup){n=Object.assign({},o.getDefinition());n=Object.assign(n,t);o.table.columnManager.addColumn(n,!1,o).then(function(t){if(n.field==o.field){o.field=!1}o.delete().then(function(){l(t.getComponent())}).catch(function(t){a(t)})}).catch(function(t){a(t)})}else{console.warn("Column Update Error - The updateDefinition function is only available on ungrouped columns");a("Column Update Error - The updateDefinition function is only available on columns, not column groups")}}else{console.warn("Column Update Error - The updateDefinition function is only available on ungrouped columns");a("Column Update Error - The updateDefinition function is only available on columns, not column groups")}})};l.prototype.deleteCell=function(t){var o=this.cells.indexOf(t);if(-1<o){this.cells.splice(o,1)}};l.prototype.defaultOptionList=["title","field","columns","visible","align","hozAlign","vertAlign","width","minWidth","maxWidth","widthGrow","widthShrink","resizable","frozen","responsive","tooltip","cssClass","rowHandle","hideInHtml","print","htmlOutput","sorter","sorterParams","formatter","formatterParams","variableHeight","editable","editor","editorParams","validator","mutator","mutatorParams","mutatorData","mutatorDataParams","mutatorEdit","mutatorEditParams","mutatorClipboard","mutatorClipboardParams","accessor","accessorParams","accessorData","accessorDataParams","accessorDownload","accessorDownloadParams","accessorClipboard","accessorClipboardParams","accessorPrint","accessorPrintParams","accessorHtmlOutput","accessorHtmlOutputParams","clipboard","download","downloadTitle","topCalc","topCalcParams","topCalcFormatter","topCalcFormatterParams","bottomCalc","bottomCalcParams","bottomCalcFormatter","bottomCalcFormatterParams","cellClick","cellDblClick","cellContext","cellTap","cellDblTap","cellTapHold","cellMouseEnter","cellMouseLeave","cellMouseOver","cellMouseOut","cellMouseMove","cellEditing","cellEdited","cellEditCancelled","headerSort","headerSortStartingDir","headerSortTristate","headerClick","headerDblClick","headerContext","headerTap","headerDblTap","headerTapHold","headerTooltip","headerVertical","headerHozAlign","editableTitle","titleFormatter","titleFormatterParams","headerFilter","headerFilterPlaceholder","headerFilterParams","headerFilterEmptyCheck","headerFilterFunc","headerFilterFuncParams","headerFilterLiveFilter","print","headerContextMenu","headerMenu","contextMenu","clickMenu","formatterPrint","formatterPrintParams","formatterClipboard","formatterClipboardParams","formatterHtmlOutput","formatterHtmlOutputParams","titlePrint","titleClipboard","titleHtmlOutput","titleDownload"];l.prototype.getComponent=function(){if(!this.component){this.component=new o(this)}return this.component};var a=function(t){this.table=t;this.element=this.createHolderElement();this.tableElement=this.createTableElement();this.heightFixer=this.createTableElement();this.columnManager=null;this.height=0;this.firstRender=!1;this.renderMode="virtual";this.fixedHeight=!1;this.rows=[];this.activeRows=[];this.activeRowsCount=0;this.displayRows=[];this.displayRowsCount=0;this.scrollTop=0;this.scrollLeft=0;this.vDomRowHeight=20;this.vDomTop=0;this.vDomBottom=0;this.vDomScrollPosTop=0;this.vDomScrollPosBottom=0;this.vDomTopPad=0;this.vDomBottomPad=0;this.vDomMaxRenderChain=90;this.vDomWindowBuffer=0;this.vDomWindowMinTotalRows=20;this.vDomWindowMinMarginRows=5;this.vDomTopNewRows=[];this.vDomBottomNewRows=[];this.rowNumColumn=!1;this.redrawBlock=!1;this.redrawBlockRestoreConfig=!1;this.redrawBlockRederInPosition=!1};a.prototype.createHolderElement=function(){var t=document.createElement("div");t.classList.add("tabulator-tableHolder");t.setAttribute("tabindex",0);return t};a.prototype.createTableElement=function(){var t=document.createElement("div");t.classList.add("tabulator-table");return t};a.prototype.getElement=function(){return this.element};a.prototype.getTableElement=function(){return this.tableElement};a.prototype.getRowPosition=function(t,o){if(o){return this.activeRows.indexOf(t)}else{return this.rows.indexOf(t)}};a.prototype.setColumnManager=function(t){this.columnManager=t};a.prototype.initialize=function(){var t=this;t.setRenderMode();t.element.appendChild(t.tableElement);t.firstRender=!0;t.element.addEventListener("scroll",function(){var o=t.element.scrollLeft;if(t.scrollLeft!=o){t.columnManager.scrollHorizontal(o);if(t.table.options.groupBy){t.table.modules.groupRows.scrollHeaders(o)}if(t.table.modExists("columnCalcs")){t.table.modules.columnCalcs.scrollHorizontal(o)}t.table.options.scrollHorizontal(o)}t.scrollLeft=o});if("virtual"===this.renderMode){t.element.addEventListener("scroll",function(){var o=t.element.scrollTop,l=t.scrollTop>o;if(t.scrollTop!=o){t.scrollTop=o;t.scrollVertical(l);if("scroll"==t.table.options.ajaxProgressiveLoad){t.table.modules.ajax.nextPage(t.element.scrollHeight-t.element.clientHeight-o)}t.table.options.scrollVertical(o)}else{t.scrollTop=o}})}};a.prototype.findRow=function(t){var o=this;if("object"==("undefined"==typeof t?"undefined":_typeof(t))){if(t instanceof s){return t}else if(t instanceof r){return t._getSelf()||!1}else if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement){var l=o.rows.find(function(o){return o.getElement()===t});return l||!1}}else if("undefined"==typeof t||null===t){return!1}else{var a=o.rows.find(function(l){return l.data[o.table.options.index]==t});return a||!1}return!1};a.prototype.getRowFromDataObject=function(t){var o=this.rows.find(function(o){return o.data===t});return o||!1};a.prototype.getRowFromPosition=function(t,o){if(o){return this.activeRows[t]}else{return this.rows[t]}};a.prototype.scrollToRow=function(t,o,l){var a=this,n=this.getDisplayRows().indexOf(t),r=t.getElement(),s,d=0;return new Promise(function(t,p){if(-1<n){if("undefined"==typeof o){o=a.table.options.scrollToRowPosition}if("undefined"==typeof l){l=a.table.options.scrollToRowIfVisible}if("nearest"===o){switch(a.renderMode){case"classic":s=u.prototype.helpers.elOffset(r).top;o=Math.abs(a.element.scrollTop-s)>Math.abs(a.element.scrollTop+a.element.clientHeight-s)?"bottom":"top";break;case"virtual":o=Math.abs(a.vDomTop-n)>Math.abs(a.vDomBottom-n)?"bottom":"top";break;}}if(!l){if(u.prototype.helpers.elVisible(r)){d=u.prototype.helpers.elOffset(r).top-u.prototype.helpers.elOffset(a.element).top;if(0<d&&d<a.element.clientHeight-r.offsetHeight){return!1}}}switch(a.renderMode){case"classic":a.element.scrollTop=u.prototype.helpers.elOffset(r).top-u.prototype.helpers.elOffset(a.element).top+a.element.scrollTop;break;case"virtual":a._virtualRenderFill(n,!0);break;}switch(o){case"middle":case"center":if(a.element.scrollHeight-a.element.scrollTop==a.element.clientHeight){a.element.scrollTop=a.element.scrollTop+(r.offsetTop-a.element.scrollTop)-(a.element.scrollHeight-r.offsetTop)/2}else{a.element.scrollTop=a.element.scrollTop-a.element.clientHeight/2}break;case"bottom":if(a.element.scrollHeight-a.element.scrollTop==a.element.clientHeight){a.element.scrollTop=a.element.scrollTop-(a.element.scrollHeight-r.offsetTop)+r.offsetHeight}else{a.element.scrollTop=a.element.scrollTop-a.element.clientHeight+r.offsetHeight}break;}t()}else{console.warn("Scroll Error - Row not visible");p("Scroll Error - Row not visible")}})};a.prototype.setData=function(t,o,l){var a=this,n=this;return new Promise(function(r){if(o&&a.getDisplayRows().length){if(n.table.options.pagination){n._setDataActual(t,!0)}else{a.reRenderInPosition(function(){n._setDataActual(t)})}}else{if(a.table.options.autoColumns&&l){a.table.columnManager.generateColumnsFromRowData(t)}a.resetScroll();a._setDataActual(t)}r()})};a.prototype._setDataActual=function(t,o){var l=this;l.table.options.dataLoading.call(this.table,t);this._wipeElements();if(this.table.options.history&&this.table.modExists("history")){this.table.modules.history.clear()}if(Array.isArray(t)){if(this.table.modExists("selectRow")){this.table.modules.selectRow.clearSelectionData()}if(this.table.options.reactiveData&&this.table.modExists("reactiveData",!0)){this.table.modules.reactiveData.watchData(t)}t.forEach(function(t){if(t&&"object"===("undefined"==typeof t?"undefined":_typeof(t))){var o=new s(t,l);l.rows.push(o)}else{console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",t)}});l.refreshActiveData(!1,!1,o);l.table.options.dataLoaded.call(this.table,t)}else{console.error("Data Loading Error - Unable to process data due to invalid data type \nExpecting: array \nReceived: ","undefined"==typeof t?"undefined":_typeof(t),"\nData:     ",t)}};a.prototype._wipeElements=function(){this.rows.forEach(function(t){t.wipe()});if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.wipe()}this.rows=[];this.activeRows=[];this.activeRowsCount=0;this.displayRows=[];this.displayRowsCount=0;this.adjustTableSize()};a.prototype.deleteRow=function(t,o){var l=this.rows.indexOf(t),a=this.activeRows.indexOf(t);if(-1<a){this.activeRows.splice(a,1)}if(-1<l){this.rows.splice(l,1)}this.setActiveRows(this.activeRows);this.displayRowIterator(function(o){var l=o.indexOf(t);if(-1<l){o.splice(l,1)}});if(!o){this.reRenderInPosition()}this.regenerateRowNumbers();this.table.options.rowDeleted.call(this.table,t.getComponent());if(this.table.options.dataChanged){this.table.options.dataChanged.call(this.table,this.getData())}if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.updateGroupRows(!0)}else if(this.table.options.pagination&&this.table.modExists("page")){this.refreshActiveData(!1,!1,!0)}else{if(this.table.options.pagination&&this.table.modExists("page")){this.refreshActiveData("page")}}};a.prototype.addRow=function(t,o,l,a){var n=this.addRowActual(t,o,l,a);if(this.table.options.history&&this.table.modExists("history")){this.table.modules.history.action("rowAdd",n,{data:t,pos:o,index:l})}return n};a.prototype.addRows=function(t,o,l){var a=this,n=this,r=[];return new Promise(function(s){o=a.findAddRowPos(o);if(!Array.isArray(t)){t=[t]}t.length-1;if("undefined"==typeof l&&o||"undefined"!=typeof l&&!o){t.reverse()}t.forEach(function(t){var a=n.addRow(t,o,l,!0);r.push(a)});if(a.table.options.groupBy&&a.table.modExists("groupRows")){a.table.modules.groupRows.updateGroupRows(!0)}else if(a.table.options.pagination&&a.table.modExists("page")){a.refreshActiveData(!1,!1,!0)}else{a.reRenderInPosition()}if(a.table.modExists("columnCalcs")){a.table.modules.columnCalcs.recalc(a.table.rowManager.activeRows)}a.regenerateRowNumbers();s(r)})};a.prototype.findAddRowPos=function(t){if("undefined"==typeof t){t=this.table.options.addRowPos}if("pos"===t){t=!0}if("bottom"===t){t=!1}return t};a.prototype.addRowActual=function(t,o,l,a){var n=t instanceof s?t:new s(t||{},this),r=this.findAddRowPos(o),d=-1,p,c;if(!l&&this.table.options.pagination&&"page"==this.table.options.paginationAddRow){c=this.getDisplayRows();if(r){if(c.length){l=c[0]}else{if(this.activeRows.length){l=this.activeRows[this.activeRows.length-1];r=!1}}}else{if(c.length){l=c[c.length-1];r=c.length<this.table.modules.page.getPageSize()?!1:!0}}}if("undefined"!=typeof l){l=this.findRow(l)}if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.assignRowToGroup(n);var u=n.getGroup().rows;if(1<u.length){if(!l||l&&-1==u.indexOf(l)){if(r){if(u[0]!==n){l=u[0];this._moveRowInArray(n.getGroup().rows,n,l,!r)}}else{if(u[u.length-1]!==n){l=u[u.length-1];this._moveRowInArray(n.getGroup().rows,n,l,!r)}}}else{this._moveRowInArray(n.getGroup().rows,n,l,!r)}}}if(l){d=this.rows.indexOf(l)}if(l&&-1<d){p=this.activeRows.indexOf(l);this.displayRowIterator(function(t){var o=t.indexOf(l);if(-1<o){t.splice(r?o:o+1,0,n)}});if(-1<p){this.activeRows.splice(r?p:p+1,0,n)}this.rows.splice(r?d:d+1,0,n)}else{if(r){this.displayRowIterator(function(t){t.unshift(n)});this.activeRows.unshift(n);this.rows.unshift(n)}else{this.displayRowIterator(function(t){t.push(n)});this.activeRows.push(n);this.rows.push(n)}}this.setActiveRows(this.activeRows);this.table.options.rowAdded.call(this.table,n.getComponent());if(this.table.options.dataChanged){this.table.options.dataChanged.call(this.table,this.getData())}if(!a){this.reRenderInPosition()}return n};a.prototype.moveRow=function(t,o,l){if(this.table.options.history&&this.table.modExists("history")){this.table.modules.history.action("rowMove",t,{posFrom:this.getRowPosition(t),posTo:this.getRowPosition(o),to:o,after:l})}this.moveRowActual(t,o,l);this.regenerateRowNumbers();this.table.options.rowMoved.call(this.table,t.getComponent())};a.prototype.moveRowActual=function(t,o,l){var a=this;this._moveRowInArray(this.rows,t,o,l);this._moveRowInArray(this.activeRows,t,o,l);this.displayRowIterator(function(n){a._moveRowInArray(n,t,o,l)});if(this.table.options.groupBy&&this.table.modExists("groupRows")){if(!l&&o instanceof S){o=this.table.rowManager.prevDisplayRow(t)||o}var n=o.getGroup(),r=t.getGroup();if(n===r){this._moveRowInArray(n.rows,t,o,l)}else{if(r){r.removeRow(t)}n.insertRow(t,o,l)}}};a.prototype._moveRowInArray=function(t,o,l,a){var n,r,s,d;if(o!==l){n=t.indexOf(o);if(-1<n){t.splice(n,1);r=t.indexOf(l);if(-1<r){if(a){t.splice(r+1,0,o)}else{t.splice(r,0,o)}}else{t.splice(n,0,o)}}if(t===this.getDisplayRows()){s=n<r?n:r;d=r>n?r:n+1;for(var p=s;p<=d;p++){if(t[p]){this.styleRow(t[p],p)}}}}};a.prototype.clearData=function(){this.setData([])};a.prototype.getRowIndex=function(t){return this.findRowIndex(t,this.rows)};a.prototype.getDisplayRowIndex=function(t){var o=this.getDisplayRows().indexOf(t);return-1<o?o:!1};a.prototype.nextDisplayRow=function(t,o){var l=this.getDisplayRowIndex(t),a=!1;if(!1!==l&&l<this.displayRowsCount-1){a=this.getDisplayRows()[l+1]}if(a&&(!(a instanceof s)||"row"!=a.type)){return this.nextDisplayRow(a,o)}return a};a.prototype.prevDisplayRow=function(t,o){var l=this.getDisplayRowIndex(t),a=!1;if(l){a=this.getDisplayRows()[l-1]}if(o&&a&&(!(a instanceof s)||"row"!=a.type)){return this.prevDisplayRow(a,o)}return a};a.prototype.findRowIndex=function(t,o){var l;t=this.findRow(t);if(t){l=o.indexOf(t);if(-1<l){return l}}return!1};a.prototype.getData=function(t,o){var l=[],a=this.getRows(t);a.forEach(function(t){if("row"==t.type){l.push(t.getData(o||"data"))}});return l};a.prototype.getComponents=function(t){var o=[],l=this.getRows(t);l.forEach(function(t){o.push(t.getComponent())});return o};a.prototype.getDataCount=function(t){var o=this.getRows(t);return o.length};a.prototype._genRemoteRequest=function(){var t=this,o=this.table,l=o.options,a={};if(o.modExists("page")){if(l.ajaxSorting){var n=this.table.modules.sort.getSort();n.forEach(function(t){delete t.column});a[this.table.modules.page.paginationDataSentNames.sorters]=n}if(l.ajaxFiltering){var r=this.table.modules.filter.getFilters(!0,!0);a[this.table.modules.page.paginationDataSentNames.filters]=r}this.table.modules.ajax.setParams(a,!0)}o.modules.ajax.sendRequest().then(function(o){t._setDataActual(o,!0)}).catch(function(){})};a.prototype.filterRefresh=function(){var t=this.table,o=t.options,l=this.scrollLeft;if(o.ajaxFiltering){if("remote"==o.pagination&&t.modExists("page")){t.modules.page.reset(!0);t.modules.page.setPage(1).then(function(){}).catch(function(){})}else if(o.ajaxProgressiveLoad){t.modules.ajax.loadData().then(function(){}).catch(function(){})}else{this._genRemoteRequest()}}else{this.refreshActiveData("filter")}this.scrollHorizontal(l)};a.prototype.sorterRefresh=function(t){var o=this.table,l=this.table.options,a=this.scrollLeft;if(l.ajaxSorting){if(("remote"==l.pagination||l.progressiveLoad)&&o.modExists("page")){o.modules.page.reset(!0);o.modules.page.setPage(1).then(function(){}).catch(function(){})}else if(l.ajaxProgressiveLoad){o.modules.ajax.loadData().then(function(){}).catch(function(){})}else{this._genRemoteRequest()}}else{this.refreshActiveData(t?"filter":"sort")}this.scrollHorizontal(a)};a.prototype.scrollHorizontal=function(t){this.scrollLeft=t;this.element.scrollLeft=t;if(this.table.options.groupBy){this.table.modules.groupRows.scrollHeaders(t)}if(this.table.modExists("columnCalcs")){this.table.modules.columnCalcs.scrollHorizontal(t)}};a.prototype.refreshActiveData=function(t,o,l){var a=this,n=this.table,r=["all","filter","sort","display","freeze","group","tree","page"],s;if(this.redrawBlock){if(!this.redrawBlockRestoreConfig||r.indexOf(t)<r.indexOf(this.redrawBlockRestoreConfig.stage)){this.redrawBlockRestoreConfig={stage:t,skipStage:o,renderInPosition:l}}}else{if(a.table.modExists("edit")){a.table.modules.edit.cancelEdit()}if(!t){t="all"}if(n.options.selectable&&!n.options.selectablePersistence&&n.modExists("selectRow")){n.modules.selectRow.deselectRows()}switch(t){case"all":case"filter":if(!o){if(n.modExists("filter")){a.setActiveRows(n.modules.filter.filter(a.rows))}else{a.setActiveRows(a.rows.slice(0))}}else{o=!1}case"sort":if(!o){if(n.modExists("sort")){n.modules.sort.sort(this.activeRows)}}else{o=!1}this.regenerateRowNumbers();case"display":this.resetDisplayRows();case"freeze":if(!o){if(this.table.modExists("frozenRows")){if(n.modules.frozenRows.isFrozen()){if(!n.modules.frozenRows.getDisplayIndex()){n.modules.frozenRows.setDisplayIndex(this.getNextDisplayIndex())}s=n.modules.frozenRows.getDisplayIndex();s=a.setDisplayRows(n.modules.frozenRows.getRows(this.getDisplayRows(s-1)),s);if(!0!==s){n.modules.frozenRows.setDisplayIndex(s)}}}}else{o=!1}case"group":if(!o){if(n.options.groupBy&&n.modExists("groupRows")){if(!n.modules.groupRows.getDisplayIndex()){n.modules.groupRows.setDisplayIndex(this.getNextDisplayIndex())}s=n.modules.groupRows.getDisplayIndex();s=a.setDisplayRows(n.modules.groupRows.getRows(this.getDisplayRows(s-1)),s);if(!0!==s){n.modules.groupRows.setDisplayIndex(s)}}}else{o=!1}case"tree":if(!o){if(n.options.dataTree&&n.modExists("dataTree")){if(!n.modules.dataTree.getDisplayIndex()){n.modules.dataTree.setDisplayIndex(this.getNextDisplayIndex())}s=n.modules.dataTree.getDisplayIndex();s=a.setDisplayRows(n.modules.dataTree.getRows(this.getDisplayRows(s-1)),s);if(!0!==s){n.modules.dataTree.setDisplayIndex(s)}}}else{o=!1}if(n.options.pagination&&n.modExists("page")&&!l){if("local"==n.modules.page.getMode()){n.modules.page.reset()}}case"page":if(!o){if(n.options.pagination&&n.modExists("page")){if(!n.modules.page.getDisplayIndex()){n.modules.page.setDisplayIndex(this.getNextDisplayIndex())}s=n.modules.page.getDisplayIndex();if("local"==n.modules.page.getMode()){n.modules.page.setMaxRows(this.getDisplayRows(s-1).length)}s=a.setDisplayRows(n.modules.page.getRows(this.getDisplayRows(s-1)),s);if(!0!==s){n.modules.page.setDisplayIndex(s)}}}else{o=!1}}if(u.prototype.helpers.elVisible(a.element)){if(l){a.reRenderInPosition()}else{if("all"===t&&this.table.options.virtualDomHoz){this.table.vdomHoz.dataChange()}a.renderTable();if(n.options.layoutColumnsOnNewData){a.table.columnManager.redraw(!0)}}}if(n.modExists("columnCalcs")){n.modules.columnCalcs.recalc(this.activeRows)}}};a.prototype.regenerateRowNumbers=function(){var t=this;if(this.rowNumColumn){this.activeRows.forEach(function(o){var l=o.getCell(t.rowNumColumn);if(l){l._generateContents()}})}};a.prototype.setActiveRows=function(t){this.activeRows=t;this.activeRowsCount=this.activeRows.length};a.prototype.resetDisplayRows=function(){this.displayRows=[];this.displayRows.push(this.activeRows.slice(0));this.displayRowsCount=this.displayRows[0].length;if(this.table.modExists("frozenRows")){this.table.modules.frozenRows.setDisplayIndex(0)}if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.setDisplayIndex(0)}if(this.table.options.pagination&&this.table.modExists("page")){this.table.modules.page.setDisplayIndex(0)}};a.prototype.getNextDisplayIndex=function(){return this.displayRows.length};a.prototype.setDisplayRows=function(t,o){var l=!0;if(o&&"undefined"!=typeof this.displayRows[o]){this.displayRows[o]=t;l=!0}else{this.displayRows.push(t);l=o=this.displayRows.length-1}if(o==this.displayRows.length-1){this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}return l};a.prototype.getDisplayRows=function(t){if("undefined"==typeof t){return this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]}else{return this.displayRows[t]||[]}};a.prototype.getVisibleRows=function(t){var o=this.element.scrollTop,l=this.element.clientHeight+o,a=!1,n=0,r=0,s=this.getDisplayRows();if(t){this.getDisplayRows();for(var d=this.vDomTop;d<=this.vDomBottom;d++){if(s[d]){if(!a){if(0<=o-s[d].getElement().offsetTop){n=d}else{a=!0;if(0<=l-s[d].getElement().offsetTop){r=d}else{break}}}else{if(0<=l-s[d].getElement().offsetTop){r=d}else{break}}}}}else{n=this.vDomTop;r=this.vDomBottom}return s.slice(n,r+1)};a.prototype.displayRowIterator=function(t){this.displayRows.forEach(t);this.displayRowsCount=this.displayRows[this.displayRows.length-1].length};a.prototype.getRows=function(t){var o;switch(t){case"active":o=this.activeRows;break;case"display":o=this.table.rowManager.getDisplayRows();break;case"visible":o=this.getVisibleRows(!0);break;case"selected":o=this.table.modules.selectRow.selectedRows;break;default:o=this.rows;}return o};a.prototype.reRenderInPosition=function(t){if("virtual"==this.getRenderMode()){if(this.redrawBlock){if(t){t()}else{this.redrawBlockRederInPosition=!0}}else{for(var o=this.element.scrollTop,l=!1,a=!1,n=this.scrollLeft,r=this.getDisplayRows(),s=this.vDomTop;s<=this.vDomBottom;s++){if(r[s]){var d=o-r[s].getElement().offsetTop;if(!1===a||Math.abs(d)<a){a=d;l=s}else{break}}}if(t){t()}this._virtualRenderFill(!1===l?this.displayRowsCount-1:l,!0,a||0);this.scrollHorizontal(n)}}else{this.renderTable();if(t){t()}}};a.prototype.setRenderMode=function(){if(this.table.options.virtualDom){this.renderMode="virtual";if(this.table.element.clientHeight||this.table.options.height){this.fixedHeight=!0}else{this.fixedHeight=!1}}else{this.renderMode="classic"}};a.prototype.getRenderMode=function(){return this.renderMode};a.prototype.renderTable=function(){this.table.options.renderStarted.call(this.table);this.element.scrollTop=0;switch(this.renderMode){case"classic":this._simpleRender();break;case"virtual":this._virtualRenderFill();break;}if(this.firstRender){if(this.displayRowsCount){this.firstRender=!1;this.table.modules.layout.layout()}else{this.renderEmptyScroll()}}if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layout()}if(!this.displayRowsCount){if(this.table.options.placeholder){this.table.options.placeholder.setAttribute("tabulator-render-mode",this.renderMode);this.getElement().appendChild(this.table.options.placeholder);this.table.options.placeholder.style.width=this.table.columnManager.getWidth()+"px"}}this.table.options.renderComplete.call(this.table)};a.prototype._simpleRender=function(){this._clearVirtualDom();if(this.displayRowsCount){this.checkClassicModeGroupHeaderWidth()}else{this.renderEmptyScroll()}};a.prototype.checkClassicModeGroupHeaderWidth=function(){var t=this,o=this.tableElement,l=!0;t.getDisplayRows().forEach(function(a,n){t.styleRow(a,n);o.appendChild(a.getElement());a.initialize(!0);if("group"!==a.type){l=!1}});if(l){o.style.minWidth=t.table.columnManager.getWidth()+"px"}else{o.style.minWidth=""}};a.prototype.renderEmptyScroll=function(){if(this.table.options.placeholder){this.tableElement.style.display="none"}else{this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}};a.prototype._clearVirtualDom=function(){var t=this.tableElement;if(this.table.options.placeholder&&this.table.options.placeholder.parentNode){this.table.options.placeholder.parentNode.removeChild(this.table.options.placeholder)}while(t.firstChild){t.removeChild(t.firstChild)}t.style.paddingTop="";t.style.paddingBottom="";t.style.minWidth="";t.style.minHeight="";t.style.display="";t.style.visibility="";this.scrollTop=0;this.scrollLeft=0;this.vDomTop=0;this.vDomBottom=0;this.vDomTopPad=0;this.vDomBottomPad=0};a.prototype.styleRow=function(t,o){var l=t.getElement();if(o%2){l.classList.add("tabulator-row-even");l.classList.remove("tabulator-row-odd")}else{l.classList.add("tabulator-row-odd");l.classList.remove("tabulator-row-even")}};a.prototype._virtualRenderFill=function(t,o,l){var a=this,n=a.tableElement,r=a.element,s=0,d=0,p=0,c=0,m=!0,g=a.getDisplayRows();t=t||0;l=l||0;if(!t){a._clearVirtualDom()}else{while(n.firstChild){n.removeChild(n.firstChild)}var h=(a.displayRowsCount-t+1)*a.vDomRowHeight;if(h<a.height){t-=Math.ceil((a.height-h)/a.vDomRowHeight);if(0>t){t=0}}s=Math.min(Math.max(Math.floor(a.vDomWindowBuffer/a.vDomRowHeight),a.vDomWindowMinMarginRows),t);t-=s}if(a.displayRowsCount&&u.prototype.helpers.elVisible(a.element)){a.vDomTop=t;a.vDomBottom=t-1;while((d<=a.height+a.vDomWindowBuffer||c<a.vDomWindowMinTotalRows)&&a.vDomBottom<a.displayRowsCount-1){var b=a.vDomBottom+1,f=g[b],y=0;a.styleRow(f,b);n.appendChild(f.getElement());f.initialize();if(!f.heightInitialized){f.normalizeHeight(!0)}y=f.getHeight();if(c<s){p+=y}else{d+=y}if(y>this.vDomWindowBuffer){this.vDomWindowBuffer=2*y}if("group"!==f.type){m=!1}a.vDomBottom++;c++}if(!t){this.vDomTopPad=0;a.vDomRowHeight=Math.floor((d+p)/c);a.vDomBottomPad=a.vDomRowHeight*(a.displayRowsCount-a.vDomBottom-1);a.vDomScrollHeight=p+d+a.vDomBottomPad-a.height}else{a.vDomTopPad=!o?a.scrollTop-p:a.vDomRowHeight*this.vDomTop+l;a.vDomBottomPad=a.vDomBottom==a.displayRowsCount-1?0:Math.max(a.vDomScrollHeight-a.vDomTopPad-d-p,0)}n.style.paddingTop=a.vDomTopPad+"px";n.style.paddingBottom=a.vDomBottomPad+"px";if(o){this.scrollTop=a.vDomTopPad+p+l-(this.element.scrollWidth>this.element.clientWidth?this.element.offsetHeight-this.element.clientHeight:0)}this.scrollTop=Math.min(this.scrollTop,this.element.scrollHeight-this.height);if(this.element.scrollWidth>this.element.offsetWidth&&o){this.scrollTop+=this.element.offsetHeight-this.element.clientHeight}this.vDomScrollPosTop=this.scrollTop;this.vDomScrollPosBottom=this.scrollTop;r.scrollTop=this.scrollTop;n.style.minWidth=m?a.table.columnManager.getWidth()+"px":"";if(a.table.options.groupBy){if("fitDataFill"!=a.table.modules.layout.getMode()&&a.displayRowsCount==a.table.modules.groupRows.countGroups()){a.tableElement.style.minWidth=a.table.columnManager.getWidth()}}}else{this.renderEmptyScroll()}if(!this.fixedHeight){this.adjustTableSize()}};a.prototype.scrollVertical=function(t){var o=this.scrollTop-this.vDomScrollPosTop,l=this.scrollTop-this.vDomScrollPosBottom,a=2*this.vDomWindowBuffer;if(-o>a||l>a){var n=this.scrollLeft;this._virtualRenderFill(Math.floor(this.element.scrollTop/this.element.scrollHeight*this.displayRowsCount));this.scrollHorizontal(n)}else{if(t){if(0>o){this._addTopRow(-o)}if(0>l){if(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer){this._removeBottomRow(-l)}else{this.vDomScrollPosBottom=this.scrollTop}}}else{if(0<=o){if(this.scrollTop>this.vDomWindowBuffer){this._removeTopRow(o)}else{this.vDomScrollPosTop=this.scrollTop}}if(0<=l){this._addBottomRow(l)}}}};a.prototype._addTopRow=function(t){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,l=this.tableElement,a=this.getDisplayRows();if(this.vDomTop){var n=this.vDomTop-1,r=a[n],s=r.getHeight()||this.vDomRowHeight;if(t>=s){this.styleRow(r,n);l.insertBefore(r.getElement(),l.firstChild);if(!r.initialized||!r.heightInitialized){this.vDomTopNewRows.push(r);if(!r.heightInitialized){r.clearCellHeight()}}r.initialize();this.vDomTopPad-=s;if(0>this.vDomTopPad){this.vDomTopPad=n*this.vDomRowHeight}if(!n){this.vDomTopPad=0}l.style.paddingTop=this.vDomTopPad+"px";this.vDomScrollPosTop-=s;this.vDomTop--}t=-(this.scrollTop-this.vDomScrollPosTop);if(r.getHeight()>this.vDomWindowBuffer){this.vDomWindowBuffer=2*r.getHeight()}if(o<this.vDomMaxRenderChain&&this.vDomTop&&t>=(a[this.vDomTop-1].getHeight()||this.vDomRowHeight)){this._addTopRow(t,o+1)}else{this._quickNormalizeRowHeight(this.vDomTopNewRows)}}};a.prototype._removeTopRow=function(t){var o=this.tableElement,l=this.getDisplayRows()[this.vDomTop],a=l.getHeight()||this.vDomRowHeight;if(t>=a){var n=l.getElement();n.parentNode.removeChild(n);this.vDomTopPad+=a;o.style.paddingTop=this.vDomTopPad+"px";this.vDomScrollPosTop+=this.vDomTop?a:a+this.vDomWindowBuffer;this.vDomTop++;t=this.scrollTop-this.vDomScrollPosTop;this._removeTopRow(t)}};a.prototype._addBottomRow=function(t){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,l=this.tableElement,a=this.getDisplayRows();if(this.vDomBottom<this.displayRowsCount-1){var n=this.vDomBottom+1,r=a[n],s=r.getHeight()||this.vDomRowHeight;if(t>=s){this.styleRow(r,n);l.appendChild(r.getElement());if(!r.initialized||!r.heightInitialized){this.vDomBottomNewRows.push(r);if(!r.heightInitialized){r.clearCellHeight()}}r.initialize();this.vDomBottomPad-=s;if(0>this.vDomBottomPad||n==this.displayRowsCount-1){this.vDomBottomPad=0}l.style.paddingBottom=this.vDomBottomPad+"px";this.vDomScrollPosBottom+=s;this.vDomBottom++}t=this.scrollTop-this.vDomScrollPosBottom;if(r.getHeight()>this.vDomWindowBuffer){this.vDomWindowBuffer=2*r.getHeight()}if(o<this.vDomMaxRenderChain&&this.vDomBottom<this.displayRowsCount-1&&t>=(a[this.vDomBottom+1].getHeight()||this.vDomRowHeight)){this._addBottomRow(t,o+1)}else{this._quickNormalizeRowHeight(this.vDomBottomNewRows)}}};a.prototype._removeBottomRow=function(t){var o=this.tableElement,l=this.getDisplayRows()[this.vDomBottom],a=l.getHeight()||this.vDomRowHeight;if(t>=a){var n=l.getElement();if(n.parentNode){n.parentNode.removeChild(n)}this.vDomBottomPad+=a;if(0>this.vDomBottomPad){this.vDomBottomPad=0}o.style.paddingBottom=this.vDomBottomPad+"px";this.vDomScrollPosBottom-=a;this.vDomBottom--;t=-(this.scrollTop-this.vDomScrollPosBottom);this._removeBottomRow(t)}};a.prototype._quickNormalizeRowHeight=function(t){t.forEach(function(t){t.calcHeight()});t.forEach(function(t){t.setCellHeight()});t.length=0};a.prototype.normalizeHeight=function(){this.activeRows.forEach(function(t){t.normalizeHeight()})};a.prototype.adjustTableSize=function(){var t=this.element.clientHeight,o;if("virtual"===this.renderMode){var l=Math.floor(this.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){this.element.style.minHeight="calc(100% - "+l+"px)";this.element.style.height="calc(100% - "+l+"px)";this.element.style.maxHeight="calc(100% - "+l+"px)"}else{this.element.style.height="";this.element.style.height=this.table.element.clientHeight-l+"px";this.element.scrollTop=this.scrollTop}this.height=this.element.clientHeight;this.vDomWindowBuffer=this.table.options.virtualDomBuffer||this.height;if(!this.fixedHeight&&t!=this.element.clientHeight){o=this.table.modExists("resizeTable");if(o&&!this.table.modules.resizeTable.autoResize||!o){this.redraw()}}}};a.prototype.reinitialize=function(){this.rows.forEach(function(t){t.reinitialize(!0)})};a.prototype.blockRedraw=function(){this.redrawBlock=!0;this.redrawBlockRestoreConfig=!1};a.prototype.restoreRedraw=function(){this.redrawBlock=!1;if(this.redrawBlockRestoreConfig){this.refreshActiveData(this.redrawBlockRestoreConfig.stage,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition);this.redrawBlockRestoreConfig=!1}else{if(this.redrawBlockRederInPosition){this.reRenderInPosition()}}this.redrawBlockRederInPosition=!1};a.prototype.redraw=function(t){var o=this.scrollLeft;this.adjustTableSize();this.table.tableWidth=this.table.element.clientWidth;if(!t){if("classic"==this.renderMode){if(this.table.options.groupBy){this.refreshActiveData("group",!1,!1)}else{this._simpleRender()}}else{this.reRenderInPosition();this.scrollHorizontal(o)}if(!this.displayRowsCount){if(this.table.options.placeholder){this.getElement().appendChild(this.table.options.placeholder)}}}else{this.renderTable()}};a.prototype.resetScroll=function(){this.element.scrollLeft=0;this.element.scrollTop=0;if("ie"===this.table.browser){var t=document.createEvent("Event");t.initEvent("scroll",!1,!0);this.element.dispatchEvent(t)}else{this.element.dispatchEvent(new Event("scroll"))}};var n=function(t){this.table=t;this.element=this.table.rowManager.tableElement;this.holderEl=this.table.rowManager.element;this.leftCol=0;this.rightCol=0;this.scrollLeft=0;this.vDomScrollPosLeft=0;this.vDomScrollPosRight=0;this.vDomPadLeft=0;this.vDomPadRight=0;this.fitDataColAvg=0;this.window=200;this.initialized=!1;this.columns=[];if(this.compatabilityCheck()){this.initialize()}};n.prototype.compatabilityCheck=function(){var t=this.table.options,o=!1,l=!0;if("fitDataTable"==t.layout){console.warn("Horizontal Vitrual DOM is not compatible with fitDataTable layout mode");l=!1}if(t.responsiveLayout){console.warn("Horizontal Vitrual DOM is not compatible with responsive columns");l=!1}if(this.table.rtl){console.warn("Horizontal Vitrual DOM is not currently compatible with RTL text direction");l=!1}if(t.columns){o=t.columns.find(function(t){return t.frozen});if(o){console.warn("Horizontal Vitrual DOM is not compatible with frozen columns");l=!1}}if(!l){t.virtualDomHoz=!1}return l};n.prototype.initialize=function(){var t=this;this.holderEl.addEventListener("scroll",function(){var o=t.holderEl.scrollLeft;if(t.scrollLeft!=o){t.scrollLeft=o;t.scroll(o-(t.vDomScrollPosLeft+t.window))}})};n.prototype.deinitialize=function(){this.initialized=!1};n.prototype.clear=function(){this.columns=[];this.leftCol=-1;this.rightCol=0;this.vDomScrollPosLeft=0;this.vDomScrollPosRight=0;this.vDomPadLeft=0;this.vDomPadRight=0};n.prototype.dataChange=function(){var t=!1,o=0,l=0,a,n,r;if("fitData"===this.table.options.layout){this.table.columnManager.columnsByIndex.forEach(function(o){if(!o.definition.width&&o.visible){t=!0}});if(t){if(t&&this.table.rowManager.getDisplayRows().length){this.vDomScrollPosRight=this.scrollLeft+this.holderEl.clientWidth+this.window;if(this.table.options.groupBy){a=this.table.modules.groupRows.getGroups(!1)[0];n=a.getRows(!1)[0]}else{n=this.table.rowManager.getDisplayRows()[0]}if(n){r=n.getElement();n.generateCells();this.element.appendChild(r);for(var l=0,s;l<n.cells.length;l++){s=n.cells[l];r.appendChild(s.getElement());s.column.reinitializeWidth();o+=s.column.getWidth();if(o>this.vDomScrollPosRight){break}}r.parentNode.removeChild(r);this.fitDataColAvg=Math.floor(o/(l+1));for(l;l<this.table.columnManager.columnsByIndex.length;l++){this.table.columnManager.columnsByIndex[l].setWidth(this.fitDataColAvg)}this.reinitialize(!1,!0)}}}}else{if("fitColumns"===this.table.options.layout){this.table.modules.layout.layout();this.table.vdomHoz.reinitialize(!1,!0)}}};n.prototype.fitDataLayoutOverride=function(){for(var t=this.leftCol;t<=this.rightCol;t++){this.columns[t].reinitializeWidth()}};n.prototype.reinitialize=function(t,o){var l=this,a={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol};if(t&&!this.initialized){return}this.clear();this.scrollLeft=this.holderEl.scrollLeft;this.vDomScrollPosLeft=this.scrollLeft-this.window;this.vDomScrollPosRight=this.scrollLeft+this.holderEl.clientWidth+this.window;var n=0;this.table.columnManager.columnsByIndex.forEach(function(t){var o={};if(t.visible){var a=t.getWidth();o.leftPos=n;o.rightPos=n+a;if(n+a>l.vDomScrollPosLeft&&n<l.vDomScrollPosRight){if(-1==l.leftCol){l.leftCol=l.columns.length;l.vDomPadLeft=n}l.rightCol=l.columns.length}else{if(-1!==l.leftCol){l.vDomPadRight+=a}}l.columns.push(t);t.modules.vdomHoz=o;n+=a}});this.element.style.paddingLeft=this.vDomPadLeft+"px";this.element.style.paddingRight=this.vDomPadRight+"px";this.initialized=!0;if(!o){if(!t||this.reinitChanged(a)){this.renitializeRows()}}this.holderEl.scrollLeft=this.scrollLeft};n.prototype.reinitChanged=function(t){var o=this,l=!0;if(t.cols.length!==this.columns.length||t.leftCol!==this.leftCol||t.rightCol!==this.rightCol){return!0}t.cols.forEach(function(t,a){if(t!==o.columns[a]){l=!1}});return!l};n.prototype.renitializeRows=function(){var t=this,o=this.table.rowManager.getVisibleRows();o.forEach(function(o){t.reinitializeRow(o,!0)})};n.prototype.scroll=function(t){this.vDomScrollPosLeft+=t;this.vDomScrollPosRight+=t;if(t>.8*this.holderEl.clientWidth){this.reinitialize()}else{if(0<t){this.addColRight();this.removeColLeft()}else{this.addColLeft();this.removeColRight()}}};n.prototype.colPositionAdjust=function(t,o,l){for(var a=t,n;a<o;a++){n=this.columns[a];n.modules.vdomHoz.leftPos-=l;n.modules.vdomHoz.rightPos-=l}};n.prototype.addColRight=function(){var t=this.columns[this.rightCol+1],o,l,a;if(t&&t.modules.vdomHoz.leftPos<=this.vDomScrollPosRight){o=this.table.rowManager.getVisibleRows();o.forEach(function(o){if("group"!==o.type){var l=o.getCell(t);o.getElement().appendChild(l.getElement());l.cellRendered()}});if(this.fitDataColAvg){l=t.getWidth();if(l===this.fitDataColAvg){t.reinitializeWidth();a=l-t.getWidth();if(a){t.modules.vdomHoz.rightPos-=a;this.colPositionAdjust(this.rightCol+1,this.columns.length,a)}}}this.rightCol++;if(this.rightCol>=this.columns.length-1){this.vDomPadRight=0}else{this.vDomPadRight-=t.getWidth()}this.element.style.paddingRight=this.vDomPadRight+"px";this.addColRight()}};n.prototype.addColLeft=function(){var t=this.columns[this.leftCol-1],o;if(t&&t.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){var o=this.table.rowManager.getVisibleRows();o.forEach(function(o){if("group"!==o.type){var l=o.getCell(t);o.getElement().prepend(l.getElement());l.cellRendered()}});if(!this.leftCol){this.vDomPadLeft=0}else{this.vDomPadLeft-=t.getWidth()}this.element.style.paddingLeft=this.vDomPadLeft+"px";this.leftCol--;this.addColLeft()}};n.prototype.removeColRight=function(t){var t=this.columns[this.rightCol],o;if(t&&t.modules.vdomHoz.leftPos>this.vDomScrollPosRight){o=this.table.rowManager.getVisibleRows();t.modules.vdomHoz.visible=!1;o.forEach(function(o){if("group"!==o.type){var l=o.getCell(t);o.getElement().removeChild(l.getElement())}});this.vDomPadRight+=t.getWidth();this.element.style.paddingRight=this.vDomPadRight+"px";this.rightCol--;this.removeColRight()}};n.prototype.removeColLeft=function(){var t=this.columns[this.leftCol],o;if(t&&t.modules.vdomHoz.rightPos<this.vDomScrollPosLeft){o=this.table.rowManager.getVisibleRows();o.forEach(function(o){if("group"!==o.type){var l=o.getCell(t);o.getElement().removeChild(l.getElement())}});this.vDomPadLeft+=t.getWidth();this.element.style.paddingLeft=this.vDomPadLeft+"px";this.leftCol++;this.removeColLeft()}};n.prototype.initializeRow=function(t){if("group"!==t.type){t.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol};for(var o=this.leftCol,l;o<=this.rightCol;o++){l=this.columns[o];if(l&&l.visible){var a=t.getCell(l);t.getElement().appendChild(a.getElement());a.cellRendered()}}}};n.prototype.reinitializeRow=function(t,o){if("group"!==t.type){if(o||!t.modules.vdomHoz||t.modules.vdomHoz.leftCol!==this.leftCol||t.modules.vdomHoz.rightCol!==this.rightCol){var l=t.getElement();while(l.firstChild){l.removeChild(l.firstChild)}this.initializeRow(t)}}};var r=function(t){this._row=t};r.prototype.getData=function(t){return this._row.getData(t)};r.prototype.getElement=function(){return this._row.getElement()};r.prototype.getCells=function(){var t=[];this._row.getCells().forEach(function(o){t.push(o.getComponent())});return t};r.prototype.getCell=function(t){var o=this._row.getCell(t);return o?o.getComponent():!1};r.prototype.getIndex=function(){return this._row.getData("data")[this._row.table.options.index]};r.prototype.getPosition=function(t){return this._row.table.rowManager.getRowPosition(this._row,t)};r.prototype.delete=function(){return this._row.delete()};r.prototype.scrollTo=function(){return this._row.table.rowManager.scrollToRow(this._row)};r.prototype.pageTo=function(){if(this._row.table.modExists("page",!0)){return this._row.table.modules.page.setPageToRow(this._row)}};r.prototype.move=function(t,o){this._row.moveToRow(t,o)};r.prototype.update=function(t){return this._row.updateData(t)};r.prototype.normalizeHeight=function(){this._row.normalizeHeight(!0)};r.prototype.select=function(){this._row.table.modules.selectRow.selectRows(this._row)};r.prototype.deselect=function(){this._row.table.modules.selectRow.deselectRows(this._row)};r.prototype.toggleSelect=function(){this._row.table.modules.selectRow.toggleRow(this._row)};r.prototype.isSelected=function(){return this._row.table.modules.selectRow.isRowSelected(this._row)};r.prototype._getSelf=function(){return this._row};r.prototype.validate=function(){return this._row.validate()};r.prototype.freeze=function(){if(this._row.table.modExists("frozenRows",!0)){this._row.table.modules.frozenRows.freezeRow(this._row)}};r.prototype.unfreeze=function(){if(this._row.table.modExists("frozenRows",!0)){this._row.table.modules.frozenRows.unfreezeRow(this._row)}};r.prototype.isFrozen=function(){if(this._row.table.modExists("frozenRows",!0)){var t=this._row.table.modules.frozenRows.rows.indexOf(this._row);return-1<t}return!1};r.prototype.treeCollapse=function(){if(this._row.table.modExists("dataTree",!0)){this._row.table.modules.dataTree.collapseRow(this._row)}};r.prototype.treeExpand=function(){if(this._row.table.modExists("dataTree",!0)){this._row.table.modules.dataTree.expandRow(this._row)}};r.prototype.treeToggle=function(){if(this._row.table.modExists("dataTree",!0)){this._row.table.modules.dataTree.toggleRow(this._row)}};r.prototype.getTreeParent=function(){if(this._row.table.modExists("dataTree",!0)){return this._row.table.modules.dataTree.getTreeParent(this._row)}return!1};r.prototype.getTreeChildren=function(){if(this._row.table.modExists("dataTree",!0)){return this._row.table.modules.dataTree.getTreeChildren(this._row,!0)}return!1};r.prototype.addTreeChild=function(t,o,l){if(this._row.table.modExists("dataTree",!0)){return this._row.table.modules.dataTree.addTreeChildRow(this._row,t,o,l)}return!1};r.prototype.reformat=function(){return this._row.reinitialize()};r.prototype.getGroup=function(){return this._row.getGroup().getComponent()};r.prototype.getTable=function(){return this._row.table};r.prototype.getNextRow=function(){var t=this._row.nextRow();return t?t.getComponent():t};r.prototype.getPrevRow=function(){var t=this._row.prevRow();return t?t.getComponent():t};var s=function(t,o){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"row";this.table=o.table;this.parent=o;this.data={};this.type=l;this.element=!1;this.modules={};this.cells=[];this.height=0;this.heightStyled="";this.manualHeight=!1;this.outerHeight=0;this.initialized=!1;this.heightInitialized=!1;this.component=null;this.created=!1;this.setData(t)};s.prototype.create=function(){if(!this.created){this.created=!0;this.generateElement()}};s.prototype.createElement=function(){var t=document.createElement("div");t.classList.add("tabulator-row");t.setAttribute("role","row");this.element=t};s.prototype.getElement=function(){this.create();return this.element};s.prototype.detachElement=function(){if(this.element&&this.element.parentNode){this.element.parentNode.removeChild(this.element)}};s.prototype.generateElement=function(){var t=this,o,l,a;this.createElement();if(!1!==t.table.options.selectable&&t.table.modExists("selectRow")){t.table.modules.selectRow.initializeRow(this)}if(!1!==t.table.options.movableRows&&t.table.modExists("moveRow")){t.table.modules.moveRow.initializeRow(this)}if(!1!==t.table.options.dataTree&&t.table.modExists("dataTree")){t.table.modules.dataTree.initializeRow(this)}if("collapse"===t.table.options.responsiveLayout&&t.table.modExists("responsiveLayout")){t.table.modules.responsiveLayout.initializeRow(this)}if((t.table.options.rowContextMenu||t.table.options.rowClickMenu)&&this.table.modExists("menu")){t.table.modules.menu.initializeRow(this)}if(t.table.options.rowClick){t.element.addEventListener("click",function(o){t.table.options.rowClick(o,t.getComponent())})}if(t.table.options.rowDblClick){t.element.addEventListener("dblclick",function(o){t.table.options.rowDblClick(o,t.getComponent())})}if(t.table.options.rowContext){t.element.addEventListener("contextmenu",function(o){t.table.options.rowContext(o,t.getComponent())})}if(t.table.options.rowMouseEnter){t.element.addEventListener("mouseenter",function(o){t.table.options.rowMouseEnter(o,t.getComponent())})}if(t.table.options.rowMouseLeave){t.element.addEventListener("mouseleave",function(o){t.table.options.rowMouseLeave(o,t.getComponent())})}if(t.table.options.rowMouseOver){t.element.addEventListener("mouseover",function(o){t.table.options.rowMouseOver(o,t.getComponent())})}if(t.table.options.rowMouseOut){t.element.addEventListener("mouseout",function(o){t.table.options.rowMouseOut(o,t.getComponent())})}if(t.table.options.rowMouseMove){t.element.addEventListener("mousemove",function(o){t.table.options.rowMouseMove(o,t.getComponent())})}if(t.table.options.rowTap){a=!1;t.element.addEventListener("touchstart",function(){a=!0},{passive:!0});t.element.addEventListener("touchend",function(o){if(a){t.table.options.rowTap(o,t.getComponent())}a=!1})}if(t.table.options.rowDblTap){o=null;t.element.addEventListener("touchend",function(l){if(o){clearTimeout(o);o=null;t.table.options.rowDblTap(l,t.getComponent())}else{o=setTimeout(function(){clearTimeout(o);o=null},300)}})}if(t.table.options.rowTapHold){l=null;t.element.addEventListener("touchstart",function(o){clearTimeout(l);l=setTimeout(function(){clearTimeout(l);l=null;a=!1;t.table.options.rowTapHold(o,t.getComponent())},1e3)},{passive:!0});t.element.addEventListener("touchend",function(){clearTimeout(l);l=null})}};s.prototype.generateCells=function(){this.cells=this.table.columnManager.generateCells(this)};s.prototype.initialize=function(t){var o=this;this.create();if(!this.initialized||t){this.deleteCells();while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layoutRow(this)}this.generateCells();if(this.table.options.virtualDomHoz&&this.table.vdomHoz.initialized){this.table.vdomHoz.initializeRow(this)}else{this.cells.forEach(function(t){o.element.appendChild(t.getElement());t.cellRendered()})}if(t){this.normalizeHeight()}if(this.table.options.dataTree&&this.table.modExists("dataTree")){this.table.modules.dataTree.layoutRow(this)}if("collapse"===this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout")){this.table.modules.responsiveLayout.layoutRow(this)}if(this.table.options.rowFormatter){this.table.options.rowFormatter(this.getComponent())}if(this.table.options.resizableRows&&this.table.modExists("resizeRows")){this.table.modules.resizeRows.initializeRow(this)}this.initialized=!0}else{if(this.table.options.virtualDomHoz){this.table.vdomHoz.reinitializeRow(this)}}};s.prototype.reinitializeHeight=function(){this.heightInitialized=!1;if(this.element&&null!==this.element.offsetParent){this.normalizeHeight(!0)}};s.prototype.reinitialize=function(){this.initialized=!1;this.heightInitialized=!1;if(!this.manualHeight){this.height=0;this.heightStyled=""}if(this.element&&null!==this.element.offsetParent){this.initialize(!0)}if(this.table.options.dataTree&&this.table.modExists("dataTree",!0)){this.table.modules.dataTree.getTreeChildren(this,!1,!0).forEach(function(t){t.reinitialize(!0)})}};s.prototype.calcHeight=function(t){var o=0,l=this.table.options.resizableRows?this.element.clientHeight:0;this.cells.forEach(function(t){var l=t.getHeight();if(l>o){o=l}});if(t){this.height=Math.max(o,l)}else{this.height=this.manualHeight?this.height:Math.max(o,l)}this.heightStyled=this.height?this.height+"px":"";this.outerHeight=this.element.offsetHeight};s.prototype.setCellHeight=function(){this.cells.forEach(function(t){t.setHeight()});this.heightInitialized=!0};s.prototype.clearCellHeight=function(){this.cells.forEach(function(t){t.clearHeight()})};s.prototype.normalizeHeight=function(t){if(t){this.clearCellHeight()}this.calcHeight(t);this.setCellHeight()};s.prototype.setHeight=function(t,o){if(this.height!=t||o){this.manualHeight=!0;this.height=t;this.heightStyled=t?t+"px":"";this.setCellHeight();this.outerHeight=this.element.offsetHeight}};s.prototype.getHeight=function(){return this.outerHeight};s.prototype.getWidth=function(){return this.element.offsetWidth};s.prototype.deleteCell=function(t){var o=this.cells.indexOf(t);if(-1<o){this.cells.splice(o,1)}};s.prototype.setData=function(t){if(this.table.modExists("mutator")){t=this.table.modules.mutator.transformRow(t,"data")}this.data=t;if(this.table.options.reactiveData&&this.table.modExists("reactiveData",!0)){this.table.modules.reactiveData.watchRow(this)}};s.prototype.updateData=function(t){var o=this,l=this.element&&u.prototype.helpers.elVisible(this.element),a={},n;return new Promise(function(r){if("string"==typeof t){t=JSON.parse(t)}if(o.table.options.reactiveData&&o.table.modExists("reactiveData",!0)){o.table.modules.reactiveData.block()}if(o.table.modExists("mutator")){a=Object.assign(a,o.data);a=Object.assign(a,t);n=o.table.modules.mutator.transformRow(a,"data",t)}else{n=t}for(var s in n){o.data[s]=n[s]}if(o.table.options.reactiveData&&o.table.modExists("reactiveData",!0)){o.table.modules.reactiveData.unblock()}for(var s in t){var d=o.table.columnManager.getColumnsByFieldRoot(s);d.forEach(function(t){var a=o.getCell(t.getField());if(a){var r=t.getFieldValue(n);if(a.getValue()!=r){a.setValueProcessData(r);if(l){a.cellRendered()}}}})}if(o.table.options.groupUpdateOnCellEdit&&o.table.options.groupBy&&o.table.modExists("groupRows")){o.table.modules.groupRows.reassignRowToGroup(o.row)}if(l){o.normalizeHeight(!0);if(o.table.options.rowFormatter){o.table.options.rowFormatter(o.getComponent())}}else{o.initialized=!1;o.height=0;o.heightStyled=""}if(!1!==o.table.options.dataTree&&o.table.modExists("dataTree")&&o.table.modules.dataTree.redrawNeeded(t)){o.table.modules.dataTree.initializeRow(o);if(l){o.table.modules.dataTree.layoutRow(o);o.table.rowManager.refreshActiveData("tree",!1,!0)}}o.table.options.rowUpdated.call(o.table,o.getComponent());if(o.table.options.dataChanged){o.table.options.dataChanged.call(o.table,o.table.rowManager.getData())}r()})};s.prototype.getData=function(t){if(t){if(this.table.modExists("accessor")){return this.table.modules.accessor.transformRow(this,t)}}return this.data};s.prototype.getCell=function(t){var o=!1;t=this.table.columnManager.findColumn(t);o=this.cells.find(function(o){return o.column===t});return o};s.prototype.getCellIndex=function(t){return this.cells.findIndex(function(o){return o===t})};s.prototype.findNextEditableCell=function(t){var o=!1;if(t<this.cells.length-1){for(var l=t+1,a;l<this.cells.length;l++){a=this.cells[l];if(a.column.modules.edit&&u.prototype.helpers.elVisible(a.getElement())){var n=!0;if("function"==typeof a.column.modules.edit.check){n=a.column.modules.edit.check(a.getComponent())}if(n){o=a;break}}}}return o};s.prototype.findPrevEditableCell=function(t){var o=!1;if(0<t){for(var l=t-1;0<=l;l--){var a=this.cells[l],n=!0;if(a.column.modules.edit&&u.prototype.helpers.elVisible(a.getElement())){if("function"==typeof a.column.modules.edit.check){n=a.column.modules.edit.check(a.getComponent())}if(n){o=a;break}}}}return o};s.prototype.getCells=function(){return this.cells};s.prototype.nextRow=function(){var t=this.table.rowManager.nextDisplayRow(this,!0);return t||!1};s.prototype.prevRow=function(){var t=this.table.rowManager.prevDisplayRow(this,!0);return t||!1};s.prototype.moveToRow=function(t,o){var l=this.table.rowManager.findRow(t);if(l){this.table.rowManager.moveRowActual(this,l,!o);this.table.rowManager.refreshActiveData("display",!1,!0)}else{console.warn("Move Error - No matching row found:",t)}};s.prototype.validate=function(){var t=[];this.cells.forEach(function(o){if(!o.validate()){t.push(o.getComponent())}});return t.length?t:!0};s.prototype.delete=function(){var t=this;return new Promise(function(o){var l,a;if(t.table.options.history&&t.table.modExists("history")){if(t.table.options.groupBy&&t.table.modExists("groupRows")){a=t.getGroup().rows;l=a.indexOf(t);if(l){l=a[l-1]}}else{l=t.table.rowManager.getRowIndex(t);if(l){l=t.table.rowManager.rows[l-1]}}t.table.modules.history.action("rowDelete",t,{data:t.getData(),pos:!l,index:l})}t.deleteActual();o()})};s.prototype.deleteActual=function(t){this.table.rowManager.getRowIndex(this);this.detatchModules();if(this.table.options.reactiveData&&this.table.modExists("reactiveData",!0)){}if(this.modules.group){this.modules.group.removeRow(this)}this.table.rowManager.deleteRow(this,t);this.deleteCells();this.initialized=!1;this.heightInitialized=!1;this.element=!1;if(this.table.options.dataTree&&this.table.modExists("dataTree",!0)){this.table.modules.dataTree.rowDelete(this)}if(this.table.modExists("columnCalcs")){if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.columnCalcs.recalcRowGroup(this)}else{this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows)}}};s.prototype.detatchModules=function(){if(this.table.modExists("selectRow")){this.table.modules.selectRow._deselectRow(this,!0)}if(this.table.modExists("edit")){if(this.table.modules.edit.currentCell.row===this){this.table.modules.edit.cancelEdit()}}if(this.table.modExists("frozenRows")){this.table.modules.frozenRows.detachRow(this)}};s.prototype.deleteCells=function(){for(var t=this.cells.length,o=0;o<t;o++){this.cells[0].delete()}};s.prototype.wipe=function(){this.detatchModules();this.deleteCells();if(this.element){while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}if(this.element.parentNode){this.element.parentNode.removeChild(this.element)}}this.element=!1;this.modules={}};s.prototype.getGroup=function(){return this.modules.group||!1};s.prototype.getComponent=function(){if(!this.component){this.component=new r(this)}return this.component};var d=function(t){this._cell=t};d.prototype.getValue=function(){return this._cell.getValue()};d.prototype.getOldValue=function(){return this._cell.getOldValue()};d.prototype.getInitialValue=function(){return this._cell.initialValue};d.prototype.getElement=function(){return this._cell.getElement()};d.prototype.getRow=function(){return this._cell.row.getComponent()};d.prototype.getData=function(){return this._cell.row.getData()};d.prototype.getField=function(){return this._cell.column.getField()};d.prototype.getColumn=function(){return this._cell.column.getComponent()};d.prototype.setValue=function(t,o){if("undefined"==typeof o){o=!0}this._cell.setValue(t,o)};d.prototype.restoreOldValue=function(){this._cell.setValueActual(this._cell.getOldValue())};d.prototype.restoreInitialValue=function(){this._cell.setValueActual(this._cell.initialValue)};d.prototype.edit=function(t){return this._cell.edit(t)};d.prototype.cancelEdit=function(){this._cell.cancelEdit()};d.prototype.isEdited=function(){return!!this._cell.modules.edit&&this._cell.modules.edit.edited};d.prototype.clearEdited=function(){if(self.table.modExists("edit",!0)){this._cell.table.modules.edit.clearEdited(this._cell)}};d.prototype.isValid=function(){return this._cell.modules.validate?!this._cell.modules.validate.invalid:!0};d.prototype.validate=function(){return this._cell.validate()};d.prototype.clearValidation=function(){if(this._cell.table.modExists("validate",!0)){this._cell.table.modules.validate.clearValidation(this._cell)}};d.prototype.nav=function(){return this._cell.nav()};d.prototype.checkHeight=function(){this._cell.checkHeight()};d.prototype.getTable=function(){return this._cell.table};d.prototype._getSelf=function(){return this._cell};var p=function(t,o){this.table=t.table;this.column=t;this.row=o;this.element=null;this.value=null;this.initialValue;this.oldValue=null;this.modules={};this.height=null;this.width=null;this.minWidth=null;this.component=null;this.loaded=!1;this.build()};p.prototype.build=function(){this.generateElement();this.setWidth();this._configureCell();this.setValueActual(this.column.getFieldValue(this.row.data));this.initialValue=this.value};p.prototype.generateElement=function(){this.element=document.createElement("div");this.element.className="tabulator-cell";this.element.setAttribute("role","gridcell");this.element=this.element};p.prototype._configureCell=function(){var t=this,o=t.column.cellEvents,l=t.element,a=this.column.getField();l.style.textAlign=t.column.hozAlign;if(t.column.vertAlign){l.style.display="inline-flex";l.style.alignItems={top:"flex-start",bottom:"flex-end",middle:"center"}[t.column.vertAlign]||"";if(t.column.hozAlign){l.style.justifyContent={left:"flex-start",right:"flex-end",center:"center"}[t.column.hozAlign]||""}}if(a){l.setAttribute("tabulator-field",a)}if(t.column.definition.cssClass){var n=t.column.definition.cssClass.split(" ");n.forEach(function(t){l.classList.add(t)})}if("hover"===this.table.options.tooltipGenerationMode){l.addEventListener("mouseenter",function(){t._generateTooltip()})}t._bindClickEvents(o);t._bindTouchEvents(o);t._bindMouseEvents(o);if(t.column.modules.edit){t.table.modules.edit.bindEditor(t)}if(t.column.definition.rowHandle&&!1!==t.table.options.movableRows&&t.table.modExists("moveRow")){t.table.modules.moveRow.initializeCell(t)}if(!t.column.visible){t.hide()}};p.prototype._bindClickEvents=function(t){var o=this,l=o.element;if(t.cellClick||o.table.options.cellClick){l.addEventListener("click",function(l){var a=o.getComponent();if(t.cellClick){t.cellClick.call(o.table,l,a)}if(o.table.options.cellClick){o.table.options.cellClick.call(o.table,l,a)}})}if(t.cellDblClick||this.table.options.cellDblClick){l.addEventListener("dblclick",function(l){var a=o.getComponent();if(t.cellDblClick){t.cellDblClick.call(o.table,l,a)}if(o.table.options.cellDblClick){o.table.options.cellDblClick.call(o.table,l,a)}})}else{l.addEventListener("dblclick",function(t){if(o.table.modExists("edit")){if(o.table.modules.edit.currentCell===o){return}}t.preventDefault();try{if(document.selection){var l=document.body.createTextRange();l.moveToElementText(o.element);l.select()}else if(window.getSelection){var l=document.createRange();l.selectNode(o.element);window.getSelection().removeAllRanges();window.getSelection().addRange(l)}}catch(t){}})}if(t.cellContext||this.table.options.cellContext){l.addEventListener("contextmenu",function(l){var a=o.getComponent();if(t.cellContext){t.cellContext.call(o.table,l,a)}if(o.table.options.cellContext){o.table.options.cellContext.call(o.table,l,a)}})}};p.prototype._bindMouseEvents=function(t){var o=this,l=o.element;if(t.cellMouseEnter||o.table.options.cellMouseEnter){l.addEventListener("mouseenter",function(l){var a=o.getComponent();if(t.cellMouseEnter){t.cellMouseEnter.call(o.table,l,a)}if(o.table.options.cellMouseEnter){o.table.options.cellMouseEnter.call(o.table,l,a)}})}if(t.cellMouseLeave||o.table.options.cellMouseLeave){l.addEventListener("mouseleave",function(l){var a=o.getComponent();if(t.cellMouseLeave){t.cellMouseLeave.call(o.table,l,a)}if(o.table.options.cellMouseLeave){o.table.options.cellMouseLeave.call(o.table,l,a)}})}if(t.cellMouseOver||o.table.options.cellMouseOver){l.addEventListener("mouseover",function(l){var a=o.getComponent();if(t.cellMouseOver){t.cellMouseOver.call(o.table,l,a)}if(o.table.options.cellMouseOver){o.table.options.cellMouseOver.call(o.table,l,a)}})}if(t.cellMouseOut||o.table.options.cellMouseOut){l.addEventListener("mouseout",function(l){var a=o.getComponent();if(t.cellMouseOut){t.cellMouseOut.call(o.table,l,a)}if(o.table.options.cellMouseOut){o.table.options.cellMouseOut.call(o.table,l,a)}})}if(t.cellMouseMove||o.table.options.cellMouseMove){l.addEventListener("mousemove",function(l){var a=o.getComponent();if(t.cellMouseMove){t.cellMouseMove.call(o.table,l,a)}if(o.table.options.cellMouseMove){o.table.options.cellMouseMove.call(o.table,l,a)}})}};p.prototype._bindTouchEvents=function(t){var o=this,l=o.element,a,n,r;if(t.cellTap||this.table.options.cellTap){r=!1;l.addEventListener("touchstart",function(){r=!0},{passive:!0});l.addEventListener("touchend",function(l){if(r){var a=o.getComponent();if(t.cellTap){t.cellTap.call(o.table,l,a)}if(o.table.options.cellTap){o.table.options.cellTap.call(o.table,l,a)}}r=!1})}if(t.cellDblTap||this.table.options.cellDblTap){a=null;l.addEventListener("touchend",function(l){if(a){clearTimeout(a);a=null;var n=o.getComponent();if(t.cellDblTap){t.cellDblTap.call(o.table,l,n)}if(o.table.options.cellDblTap){o.table.options.cellDblTap.call(o.table,l,n)}}else{a=setTimeout(function(){clearTimeout(a);a=null},300)}})}if(t.cellTapHold||this.table.options.cellTapHold){n=null;l.addEventListener("touchstart",function(l){clearTimeout(n);n=setTimeout(function(){clearTimeout(n);n=null;r=!1;var a=o.getComponent();if(t.cellTapHold){t.cellTapHold.call(o.table,l,a)}if(o.table.options.cellTapHold){o.table.options.cellTapHold.call(o.table,l,a)}},1e3)},{passive:!0});l.addEventListener("touchend",function(){clearTimeout(n);n=null})}};p.prototype._generateContents=function(){var t;if(this.table.modExists("format")){t=this.table.modules.format.formatValue(this)}else{t=this.element.innerHTML=this.value}switch("undefined"==typeof t?"undefined":_typeof(t)){case"object":if(t instanceof Node){while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}this.element.appendChild(t)}else{this.element.innerHTML="";if(null!=t){console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",t)}}break;case"undefined":case"null":this.element.innerHTML="";break;default:this.element.innerHTML=t;}};p.prototype.cellRendered=function(){if(this.table.modExists("format")&&this.table.modules.format.cellRendered){this.table.modules.format.cellRendered(this)}};p.prototype._generateTooltip=function(){var t=this.column.tooltip;if(t){if(!0===t){t=this.value}else if("function"==typeof t){t=t(this.getComponent());if(!1===t){t=""}}if("undefined"==typeof t){t=""}this.element.setAttribute("title",t)}else{this.element.setAttribute("title","")}};p.prototype.getElement=function(t){if(!this.loaded){this.loaded=!0;if(!t){this.layoutElement()}}return this.element};p.prototype.getValue=function(){return this.value};p.prototype.getOldValue=function(){return this.oldValue};p.prototype.setValue=function(t,o){var l=this.setValueProcessData(t,o),a;if(l){if(this.table.options.history&&this.table.modExists("history")){this.table.modules.history.action("cellEdit",this,{oldValue:this.oldValue,newValue:this.value})}a=this.getComponent();if(this.column.cellEvents.cellEdited){this.column.cellEvents.cellEdited.call(this.table,a)}if(this.table.options.groupUpdateOnCellEdit&&this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.reassignRowToGroup(this.row)}this.cellRendered();this.table.options.cellEdited.call(this.table,a);if(this.table.options.dataChanged){this.table.options.dataChanged.call(this.table,this.table.rowManager.getData())}}};p.prototype.setValueProcessData=function(t,o){var l=!1;if(this.value!=t){l=!0;if(o){if(this.column.modules.mutate){t=this.table.modules.mutator.transformCell(this,t)}}}this.setValueActual(t);if(l&&this.table.modExists("columnCalcs")){if(this.column.definition.topCalc||this.column.definition.bottomCalc){if(this.table.options.groupBy&&this.table.modExists("groupRows")){if("table"==this.table.options.columnCalcs||"both"==this.table.options.columnCalcs){this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows)}if("table"!=this.table.options.columnCalcs){this.table.modules.columnCalcs.recalcRowGroup(this.row)}}else{this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows)}}}return l};p.prototype.setValueActual=function(t){this.oldValue=this.value;this.value=t;if(this.table.options.reactiveData&&this.table.modExists("reactiveData")){this.table.modules.reactiveData.block()}this.column.setFieldValue(this.row.data,t);if(this.table.options.reactiveData&&this.table.modExists("reactiveData")){this.table.modules.reactiveData.unblock()}if(this.loaded){this.layoutElement()}};p.prototype.layoutElement=function(){this._generateContents();this._generateTooltip();if(this.table.options.resizableColumns&&this.table.modExists("resizeColumns")&&"row"===this.row.type){this.table.modules.resizeColumns.initializeColumn("cell",this.column,this.element)}if((this.column.definition.contextMenu||this.column.definition.clickMenu)&&this.table.modExists("menu")){this.table.modules.menu.initializeCell(this)}if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layoutElement(this.element,this.column)}};p.prototype.setWidth=function(){this.width=this.column.width;this.element.style.width=this.column.widthStyled};p.prototype.clearWidth=function(){this.width="";this.element.style.width=""};p.prototype.getWidth=function(){return this.width||this.element.offsetWidth};p.prototype.setMinWidth=function(){this.minWidth=this.column.minWidth;this.element.style.minWidth=this.column.minWidthStyled};p.prototype.setMaxWidth=function(){this.maxWidth=this.column.maxWidth;this.element.style.maxWidth=this.column.maxWidthStyled};p.prototype.checkHeight=function(){this.row.reinitializeHeight()};p.prototype.clearHeight=function(){this.element.style.height="";this.height=null};p.prototype.setHeight=function(){this.height=this.row.height;this.element.style.height=this.row.heightStyled};p.prototype.getHeight=function(){return this.height||this.element.offsetHeight};p.prototype.show=function(){this.element.style.display=this.column.vertAlign?"inline-flex":""};p.prototype.hide=function(){this.element.style.display="none"};p.prototype.edit=function(t){if(this.table.modExists("edit",!0)){return this.table.modules.edit.editCell(this,t)}};p.prototype.cancelEdit=function(){if(this.table.modExists("edit",!0)){var t=this.table.modules.edit.getCurrentCell();if(t&&t._getSelf()===this){this.table.modules.edit.cancelEdit()}else{console.warn("Cancel Editor Error - This cell is not currently being edited ")}}};p.prototype.validate=function(){if(this.column.modules.validate&&this.table.modExists("validate",!0)){var t=this.table.modules.validate.validate(this.column.modules.validate,this,this.getValue());return!0===t}else{return!0}};p.prototype.delete=function(){if(!this.table.rowManager.redrawBlock&&this.element.parentNode){this.element.parentNode.removeChild(this.element)}if(this.modules.validate&&this.modules.validate.invalid){this.table.modules.validate.clearValidation(this)}if(this.modules.edit&&this.modules.edit.edited){this.table.modules.edit.clearEdited(this)}if(this.table.options.history){this.table.modules.history.clearComponentHistory(this)}this.element=!1;this.column.deleteCell(this);this.row.deleteCell(this);this.calcs={}};p.prototype.nav=function(){var t=this,o=!1,l=this.row.getCellIndex(this);return{next:function(){var o=this.right(),l;if(!o){l=t.table.rowManager.nextDisplayRow(t.row,!0);if(l){o=l.findNextEditableCell(-1);if(o){o.edit();return!0}}}else{return!0}return!1},prev:function(){var o=this.left(),l;if(!o){l=t.table.rowManager.prevDisplayRow(t.row,!0);if(l){o=l.findPrevEditableCell(l.cells.length);if(o){o.edit();return!0}}}else{return!0}return!1},left:function(){o=t.row.findPrevEditableCell(l);if(o){o.edit();return!0}else{return!1}},right:function(){o=t.row.findNextEditableCell(l);if(o){o.edit();return!0}else{return!1}},up:function(){var o=t.table.rowManager.prevDisplayRow(t.row,!0);if(o){o.cells[l].edit()}},down:function(){var o=t.table.rowManager.nextDisplayRow(t.row,!0);if(o){o.cells[l].edit()}}}};p.prototype.getIndex=function(){this.row.getCellIndex(this)};p.prototype.getComponent=function(){if(!this.component){this.component=new d(this)}return this.component};var c=function(t){this.table=t;this.active=!1;this.element=this.createElement();this.external=!1;this.links=[];this._initialize()};c.prototype.createElement=function(){var t=document.createElement("div");t.classList.add("tabulator-footer");return t};c.prototype._initialize=function(){if(this.table.options.footerElement){switch(_typeof(this.table.options.footerElement)){case"string":if("<"===this.table.options.footerElement[0]){this.element.innerHTML=this.table.options.footerElement}else{this.external=!0;this.element=document.querySelector(this.table.options.footerElement)}break;default:this.element=this.table.options.footerElement;break;}}};c.prototype.getElement=function(){return this.element};c.prototype.append=function(t,o){this.activate(o);this.element.appendChild(t);this.table.rowManager.adjustTableSize()};c.prototype.prepend=function(t,o){this.activate(o);this.element.insertBefore(t,this.element.firstChild);this.table.rowManager.adjustTableSize()};c.prototype.remove=function(t){t.parentNode.removeChild(t);this.deactivate()};c.prototype.deactivate=function(t){if(!this.element.firstChild||t){if(!this.external){this.element.parentNode.removeChild(this.element)}this.active=!1}};c.prototype.activate=function(t){if(!this.active){this.active=!0;if(!this.external){this.table.element.appendChild(this.getElement());this.table.element.style.display=""}}if(t){this.links.push(t)}};c.prototype.redraw=function(){this.links.forEach(function(t){t.footerRedraw()})};var u=function t(o,l){this.options={};this.columnManager=null;this.rowManager=null;this.footerManager=null;this.vdomHoz=null;this.browser="";this.browserSlow=!1;this.browserMobile=!1;this.rtl=!1;this.modules={};if(this.initializeElement(o)){this.initializeOptions(l||{});this._create()}t.prototype.comms.register(this)};u.prototype.defaultOptions={height:!1,minHeight:!1,maxHeight:!1,layout:"fitData",layoutColumnsOnNewData:!1,columnMinWidth:40,columnMaxWidth:!1,columnHeaderVertAlign:"top",columnVertAlign:!1,resizableColumns:!0,resizableRows:!1,autoResize:!0,columns:[],cellHozAlign:"",cellVertAlign:"",headerHozAlign:"",data:[],autoColumns:!1,autoColumnsDefinitions:!1,reactiveData:!1,nestedFieldSeparator:".",tooltips:!1,tooltipsHeader:!1,tooltipGenerationMode:"load",initialSort:!1,initialFilter:!1,initialHeaderFilter:!1,columnHeaderSortMulti:!0,sortOrderReverse:!1,headerSort:!0,headerSortTristate:!1,headerSortElement:"<div class='tabulator-arrow'></div>",footerElement:!1,index:"id",textDirection:"auto",keybindings:[],tabEndNewRow:!1,invalidOptionWarnings:!0,clipboard:!1,clipboardCopyStyled:!0,clipboardCopyConfig:!1,clipboardCopyFormatter:!1,clipboardCopyRowRange:"active",clipboardPasteParser:"table",clipboardPasteAction:"insert",clipboardCopied:function(){},clipboardPasted:function(){},clipboardPasteError:function(){},downloadDataFormatter:!1,downloadReady:function(t,o){return o},downloadComplete:!1,downloadConfig:{},downloadRowRange:"active",dataTree:!1,dataTreeFilter:!0,dataTreeSort:!0,dataTreeElementColumn:!1,dataTreeBranchElement:!0,dataTreeChildIndent:9,dataTreeChildField:"_children",dataTreeCollapseElement:!1,dataTreeExpandElement:!1,dataTreeStartExpanded:!1,dataTreeRowExpanded:function(){},dataTreeRowCollapsed:function(){},dataTreeChildColumnCalcs:!1,dataTreeSelectPropagate:!1,printAsHtml:!1,printFormatter:!1,printHeader:!1,printFooter:!1,printCopyStyle:!0,printStyled:!0,printVisibleRows:!0,printRowRange:"visible",printConfig:{},addRowPos:"bottom",selectable:"highlight",selectableRangeMode:"drag",selectableRollingSelection:!0,selectablePersistence:!0,selectableCheck:function(){return!0},headerFilterLiveFilterDelay:300,headerFilterPlaceholder:!1,headerVisible:!0,history:!1,locale:!1,langs:{},virtualDom:!0,virtualDomBuffer:0,virtualDomHoz:!1,persistentLayout:!1,persistentSort:!1,persistentFilter:!1,persistenceID:"",persistenceMode:!0,persistenceReaderFunc:!1,persistenceWriterFunc:!1,persistence:!1,responsiveLayout:!1,responsiveLayoutCollapseStartOpen:!0,responsiveLayoutCollapseUseFormatters:!0,responsiveLayoutCollapseFormatter:!1,pagination:!1,paginationSize:!1,paginationInitialPage:1,paginationButtonCount:5,paginationSizeSelector:!1,paginationElement:!1,paginationDataSent:{},paginationDataReceived:{},paginationAddRow:"page",ajaxURL:!1,ajaxURLGenerator:!1,ajaxParams:{},ajaxConfig:"get",ajaxContentType:"form",ajaxRequestFunc:!1,ajaxLoader:!0,ajaxLoaderLoading:!1,ajaxLoaderError:!1,ajaxFiltering:!1,ajaxSorting:!1,ajaxProgressiveLoad:!1,ajaxProgressiveLoadDelay:0,ajaxProgressiveLoadScrollMargin:0,groupBy:!1,groupStartOpen:!0,groupValues:!1,groupUpdateOnCellEdit:!1,groupHeader:!1,groupHeaderPrint:null,groupHeaderClipboard:null,groupHeaderHtmlOutput:null,groupHeaderDownload:null,htmlOutputConfig:!1,movableColumns:!1,movableRows:!1,movableRowsConnectedTables:!1,movableRowsConnectedElements:!1,movableRowsSender:!1,movableRowsReceiver:"insert",movableRowsSendingStart:function(){},movableRowsSent:function(){},movableRowsSentFailed:function(){},movableRowsSendingStop:function(){},movableRowsReceivingStart:function(){},movableRowsReceived:function(){},movableRowsReceivedFailed:function(){},movableRowsReceivingStop:function(){},movableRowsElementDrop:function(){},scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,placeholder:!1,tableBuilding:function(){},tableBuilt:function(){},renderStarted:function(){},renderComplete:function(){},rowClick:!1,rowDblClick:!1,rowContext:!1,rowTap:!1,rowDblTap:!1,rowTapHold:!1,rowMouseEnter:!1,rowMouseLeave:!1,rowMouseOver:!1,rowMouseOut:!1,rowMouseMove:!1,rowContextMenu:!1,rowClickMenu:!1,rowAdded:function(){},rowDeleted:function(){},rowMoved:function(){},rowUpdated:function(){},rowSelectionChanged:function(){},rowSelected:function(){},rowDeselected:function(){},rowResized:function(){},cellClick:!1,cellDblClick:!1,cellContext:!1,cellTap:!1,cellDblTap:!1,cellTapHold:!1,cellMouseEnter:!1,cellMouseLeave:!1,cellMouseOver:!1,cellMouseOut:!1,cellMouseMove:!1,cellEditing:function(){},cellEdited:function(){},cellEditCancelled:function(){},columnMoved:!1,columnResized:function(){},columnTitleChanged:function(){},columnVisibilityChanged:function(){},htmlImporting:function(){},htmlImported:function(){},dataLoading:function(){},dataLoaded:function(){},dataEdited:!1,dataChanged:!1,ajaxRequesting:function(){},ajaxResponse:!1,ajaxError:function(){},dataFiltering:!1,dataFiltered:!1,dataSorting:function(){},dataSorted:function(){},groupToggleElement:"arrow",groupClosedShowCalcs:!1,dataGrouping:function(){},dataGrouped:!1,groupVisibilityChanged:function(){},groupClick:!1,groupDblClick:!1,groupContext:!1,groupContextMenu:!1,groupClickMenu:!1,groupTap:!1,groupDblTap:!1,groupTapHold:!1,columnCalcs:!0,pageLoaded:function(){},localized:function(){},validationMode:"blocking",validationFailed:function(){},historyUndo:function(){},historyRedo:function(){},scrollHorizontal:function(){},scrollVertical:function(){}};u.prototype.initializeOptions=function(t){if(!1!==t.invalidOptionWarnings){for(var o in t){if("undefined"==typeof this.defaultOptions[o]){console.warn("Invalid table constructor option:",o)}}}for(var o in this.defaultOptions){if(o in t){this.options[o]=t[o]}else{if(Array.isArray(this.defaultOptions[o])){this.options[o]=Object.assign([],this.defaultOptions[o])}else if("object"===_typeof(this.defaultOptions[o])&&null!==this.defaultOptions[o]){this.options[o]=Object.assign({},this.defaultOptions[o])}else{this.options[o]=this.defaultOptions[o]}}}};u.prototype.initializeElement=function(t){if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement){this.element=t;return!0}else if("string"==typeof t){this.element=document.querySelector(t);if(this.element){return!0}else{console.error("Tabulator Creation Error - no element found matching selector: ",t);return!1}}else{console.error("Tabulator Creation Error - Invalid element provided:",t);return!1}};u.prototype.rtlCheck=function(){var t=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if("rtl"!==t.direction){break};case"rtl":this.element.classList.add("tabulator-rtl");this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1;}};u.prototype._mapDepricatedFunctionality=function(){if(this.options.persistentLayout||this.options.persistentSort||this.options.persistentFilter){if(!this.options.persistence){this.options.persistence={}}}if(this.options.dataEdited){console.warn("DEPRECATION WARNING - dataEdited option has been deprecated, please use the dataChanged option instead");this.options.dataChanged=this.options.dataEdited}if(this.options.downloadDataFormatter){console.warn("DEPRECATION WARNING - downloadDataFormatter option has been deprecated")}if("undefined"!=typeof this.options.clipboardCopyHeader){this.options.columnHeaders=this.options.clipboardCopyHeader;console.warn("DEPRECATION WARNING - clipboardCopyHeader option has been deprecated, please use the columnHeaders property on the clipboardCopyConfig option")}if(!0!==this.options.printVisibleRows){console.warn("printVisibleRows option is deprecated, you should now use the printRowRange option");this.options.persistence.printRowRange="active"}if(!0!==this.options.printCopyStyle){console.warn("printCopyStyle option is deprecated, you should now use the printStyled option");this.options.persistence.printStyled=this.options.printCopyStyle}if(this.options.persistentLayout){console.warn("persistentLayout option is deprecated, you should now use the persistence option");if(!0!==this.options.persistence&&"undefined"==typeof this.options.persistence.columns){this.options.persistence.columns=!0}}if(this.options.persistentSort){console.warn("persistentSort option is deprecated, you should now use the persistence option");if(!0!==this.options.persistence&&"undefined"==typeof this.options.persistence.sort){this.options.persistence.sort=!0}}if(this.options.persistentFilter){console.warn("persistentFilter option is deprecated, you should now use the persistence option");if(!0!==this.options.persistence&&"undefined"==typeof this.options.persistence.filter){this.options.persistence.filter=!0}}if(this.options.columnVertAlign){console.warn("columnVertAlign option is deprecated, you should now use the columnHeaderVertAlign option");this.options.columnHeaderVertAlign=this.options.columnVertAlign}};u.prototype._clearSelection=function(){this.element.classList.add("tabulator-block-select");if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}else if(document.selection){document.selection.empty()}this.element.classList.remove("tabulator-block-select")};u.prototype._create=function(){this._clearObjectPointers();this._mapDepricatedFunctionality();this.bindModules();this.rtlCheck();if("TABLE"===this.element.tagName){if(this.modExists("htmlTableImport",!0)){this.modules.htmlTableImport.parseTable()}}this.columnManager=new t(this);this.rowManager=new a(this);this.footerManager=new c(this);this.columnManager.setRowManager(this.rowManager);this.rowManager.setColumnManager(this.columnManager);if(this.options.virtualDomHoz){this.vdomHoz=new n(this)}this._buildElement();this._loadInitialData()};u.prototype._clearObjectPointers=function(){this.options.columns=this.options.columns.slice(0);if(!this.options.reactiveData){this.options.data=this.options.data.slice(0)}};u.prototype._buildElement=function(){var t=this,o=this.element,l=this.modules,a=this.options;a.tableBuilding.call(this);o.classList.add("tabulator");o.setAttribute("role","grid");while(o.firstChild){o.removeChild(o.firstChild)}if(a.height){a.height=isNaN(a.height)?a.height:a.height+"px";o.style.height=a.height}if(!1!==a.minHeight){a.minHeight=isNaN(a.minHeight)?a.minHeight:a.minHeight+"px";o.style.minHeight=a.minHeight}if(!1!==a.maxHeight){a.maxHeight=isNaN(a.maxHeight)?a.maxHeight:a.maxHeight+"px";o.style.maxHeight=a.maxHeight}this.columnManager.initialize();this.rowManager.initialize();this._detectBrowser();if(this.modExists("layout",!0)){l.layout.initialize(a.layout)}l.localize.initialize();if(!1!==a.headerFilterPlaceholder){l.localize.setHeaderFilterPlaceholder(a.headerFilterPlaceholder)}for(var n in a.langs){l.localize.installLang(n,a.langs[n])}l.localize.setLocale(a.locale);if("string"==typeof a.placeholder){var r=document.createElement("div");r.classList.add("tabulator-placeholder");var s=document.createElement("span");s.innerHTML=a.placeholder;r.appendChild(s);a.placeholder=r}o.appendChild(this.columnManager.getElement());o.appendChild(this.rowManager.getElement());if(a.footerElement){this.footerManager.activate()}if(a.persistence&&this.modExists("persistence",!0)){l.persistence.initialize()}if(a.movableRows&&this.modExists("moveRow")){l.moveRow.initialize()}if(a.autoColumns&&this.options.data){this.columnManager.generateColumnsFromRowData(this.options.data)}if(this.modExists("columnCalcs")){l.columnCalcs.initialize()}this.columnManager.setColumns(a.columns);if(a.dataTree&&this.modExists("dataTree",!0)){l.dataTree.initialize()}if(this.modExists("frozenRows")){this.modules.frozenRows.initialize()}if((a.persistence&&this.modExists("persistence",!0)&&l.persistence.config.sort||a.initialSort)&&this.modExists("sort",!0)){var d=[];if(a.persistence&&this.modExists("persistence",!0)&&l.persistence.config.sort){d=l.persistence.load("sort");if(!1===d&&a.initialSort){d=a.initialSort}}else if(a.initialSort){d=a.initialSort}l.sort.setSort(d)}if((a.persistence&&this.modExists("persistence",!0)&&l.persistence.config.filter||a.initialFilter)&&this.modExists("filter",!0)){var p=[];if(a.persistence&&this.modExists("persistence",!0)&&l.persistence.config.filter){p=l.persistence.load("filter");if(!1===p&&a.initialFilter){p=a.initialFilter}}else if(a.initialFilter){p=a.initialFilter}l.filter.setFilter(p)}if(a.initialHeaderFilter&&this.modExists("filter",!0)){a.initialHeaderFilter.forEach(function(o){var a=t.columnManager.findColumn(o.field);if(a){l.filter.setHeaderFilterValue(a,o.value)}else{console.warn("Column Filter Error - No matching column found:",o.field);return!1}})}if(this.modExists("ajax")){l.ajax.initialize()}if(a.pagination&&this.modExists("page",!0)){l.page.initialize()}if(a.groupBy&&this.modExists("groupRows",!0)){l.groupRows.initialize()}if(this.modExists("keybindings")){l.keybindings.initialize()}if(this.modExists("selectRow")){l.selectRow.clearSelectionData(!0)}if(a.autoResize&&this.modExists("resizeTable")){l.resizeTable.initialize()}if(this.modExists("clipboard")){l.clipboard.initialize()}if(a.printAsHtml&&this.modExists("print")){l.print.initialize()}a.tableBuilt.call(this)};u.prototype._loadInitialData=function(){var t=this;if(t.options.pagination&&t.modExists("page")){t.modules.page.reset(!0,!0);if("local"==t.options.pagination){if(t.options.data.length){t.rowManager.setData(t.options.data,!1,!0)}else{if((t.options.ajaxURL||t.options.ajaxURLGenerator)&&t.modExists("ajax")){t.modules.ajax.loadData(!1,!0).then(function(){}).catch(function(){if(t.options.paginationInitialPage){t.modules.page.setPage(t.options.paginationInitialPage)}});return}else{t.rowManager.setData(t.options.data,!1,!0)}}if(t.options.paginationInitialPage){t.modules.page.setPage(t.options.paginationInitialPage)}}else{if(t.options.ajaxURL){t.modules.page.setPage(t.options.paginationInitialPage).then(function(){}).catch(function(){})}else{t.rowManager.setData([],!1,!0)}}}else{if(t.options.data.length){t.rowManager.setData(t.options.data)}else{if((t.options.ajaxURL||t.options.ajaxURLGenerator)&&t.modExists("ajax")){t.modules.ajax.loadData(!1,!0).then(function(){}).catch(function(){})}else{t.rowManager.setData(t.options.data,!1,!0)}}}};u.prototype.destroy=function(){var t=this.element;u.prototype.comms.deregister(this);if(this.options.reactiveData&&this.modExists("reactiveData",!0)){this.modules.reactiveData.unwatchData()}this.rowManager.rows.forEach(function(t){t.wipe()});this.rowManager.rows=[];this.rowManager.activeRows=[];this.rowManager.displayRows=[];if(this.options.autoResize&&this.modExists("resizeTable")){this.modules.resizeTable.clearBindings()}if(this.modExists("keybindings")){this.modules.keybindings.clearBindings()}while(t.firstChild){t.removeChild(t.firstChild)}t.classList.remove("tabulator")};u.prototype._detectBrowser=function(){var t=navigator.userAgent||navigator.vendor||window.opera;if(-1<t.indexOf("Trident")){this.browser="ie";this.browserSlow=!0}else if(-1<t.indexOf("Edge")){this.browser="edge";this.browserSlow=!0}else if(-1<t.indexOf("Firefox")){this.browser="firefox";this.browserSlow=!1}else{this.browser="other";this.browserSlow=!1}this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))};u.prototype.blockRedraw=function(){return this.rowManager.blockRedraw()};u.prototype.restoreRedraw=function(){return this.rowManager.restoreRedraw()};u.prototype.setDataFromLocalFile=function(t){var o=this;return new Promise(function(l,a){var n=document.createElement("input");n.type="file";n.accept=t||".json,application/json";n.addEventListener("change",function(){var t=n.files[0],r=new FileReader,s;r.readAsText(t);r.onload=function(){try{s=JSON.parse(r.result)}catch(t){console.warn("File Load Error - File contents is invalid JSON",t);a(t);return}o.setData(s).then(function(t){l(t)}).catch(function(t){l(t)})};r.onerror=function(){console.warn("File Load Error - Unable to read file");a()}});n.click()})};u.prototype.setData=function(t,o,l){if(this.modExists("ajax")){this.modules.ajax.blockActiveRequest()}return this._setData(t,o,l,!1,!0)};u.prototype._setData=function(t,o,l,a,n){var r=this;if("string"==typeof t){if(0==t.indexOf("{")||0==t.indexOf("[")){return r.rowManager.setData(JSON.parse(t),a,n)}else{if(r.modExists("ajax",!0)){if(o){r.modules.ajax.setParams(o)}if(l){r.modules.ajax.setConfig(l)}r.modules.ajax.setUrl(t);if("remote"==r.options.pagination&&r.modExists("page",!0)){r.modules.page.reset(!0,!0);return r.modules.page.setPage(1)}else{return r.modules.ajax.loadData(a,n)}}}}else{if(t){return r.rowManager.setData(t,a,n)}else{if(r.modExists("ajax")&&(r.modules.ajax.getUrl||r.options.ajaxURLGenerator)){if("remote"==r.options.pagination&&r.modExists("page",!0)){r.modules.page.reset(!0,!0);return r.modules.page.setPage(1)}else{return r.modules.ajax.loadData(a,n)}}else{return r.rowManager.setData([],a,n)}}}};u.prototype.clearData=function(){if(this.modExists("ajax")){this.modules.ajax.blockActiveRequest()}this.rowManager.clearData()};u.prototype.getData=function(t){if(!0===t){console.warn("passing a boolean to the getData function is deprecated, you should now pass the string 'active'");t="active"}return this.rowManager.getData(t)};u.prototype.getDataCount=function(t){if(!0===t){console.warn("passing a boolean to the getDataCount function is deprecated, you should now pass the string 'active'");t="active"}return this.rowManager.getDataCount(t)};u.prototype.searchRows=function(t,o,l){if(this.modExists("filter",!0)){return this.modules.filter.search("rows",t,o,l)}};u.prototype.searchData=function(t,o,l){if(this.modExists("filter",!0)){return this.modules.filter.search("data",t,o,l)}};u.prototype.getHtml=function(t,o,l){if(this.modExists("export",!0)){return this.modules.export.getHtml(t,o,l)}};u.prototype.print=function(t,o,l){if(this.modExists("print",!0)){return this.modules.print.printFullscreen(t,o,l)}};u.prototype.getAjaxUrl=function(){if(this.modExists("ajax",!0)){return this.modules.ajax.getUrl()}};u.prototype.replaceData=function(t,o,l){if(this.modExists("ajax")){this.modules.ajax.blockActiveRequest()}return this._setData(t,o,l,!0)};u.prototype.updateData=function(t){var o=this,l=this,a=0;return new Promise(function(n,r){if(o.modExists("ajax")){o.modules.ajax.blockActiveRequest()}if("string"==typeof t){t=JSON.parse(t)}if(t){t.forEach(function(t){var o=l.rowManager.findRow(t[l.options.index]);if(o){a++;o.updateData(t).then(function(){a--;if(!a){n()}})}})}else{console.warn("Update Error - No data provided");r("Update Error - No data provided")}})};u.prototype.addData=function(t,o,l){var a=this;return new Promise(function(n,r){if(a.modExists("ajax")){a.modules.ajax.blockActiveRequest()}if("string"==typeof t){t=JSON.parse(t)}if(t){a.rowManager.addRows(t,o,l).then(function(t){var o=[];t.forEach(function(t){o.push(t.getComponent())});n(o)})}else{console.warn("Update Error - No data provided");r("Update Error - No data provided")}})};u.prototype.updateOrAddData=function(t){var o=this,l=this,a=[],n=0;return new Promise(function(r,s){if(o.modExists("ajax")){o.modules.ajax.blockActiveRequest()}if("string"==typeof t){t=JSON.parse(t)}if(t){t.forEach(function(t){var o=l.rowManager.findRow(t[l.options.index]);n++;if(o){o.updateData(t).then(function(){n--;a.push(o.getComponent());if(!n){r(a)}})}else{l.rowManager.addRows(t).then(function(t){n--;a.push(t[0].getComponent());if(!n){r(a)}})}})}else{console.warn("Update Error - No data provided");s("Update Error - No data provided")}})};u.prototype.getRow=function(t){var o=this.rowManager.findRow(t);if(o){return o.getComponent()}else{console.warn("Find Error - No matching row found:",t);return!1}};u.prototype.getRowFromPosition=function(t,o){var l=this.rowManager.getRowFromPosition(t,o);if(l){return l.getComponent()}else{console.warn("Find Error - No matching row found:",t);return!1}};u.prototype.deleteRow=function(t){var o=this;return new Promise(function(l,a){var r=0,s=0,d=[];function n(){r++;if(r==t.length){if(s){o.rowManager.reRenderInPosition();l()}}}if(!Array.isArray(t)){t=[t]}t.forEach(function(t){var l=o.rowManager.findRow(t,!0);if(l){d.push(l)}else{console.warn("Delete Error - No matching row found:",t);a("Delete Error - No matching row found");n()}});d.sort(function(t,l){return o.rowManager.rows.indexOf(t)>o.rowManager.rows.indexOf(l)?1:-1});d.forEach(function(t){t.delete().then(function(){s++;n()}).catch(function(t){n();a(t)})})})};u.prototype.addRow=function(t,o,l){var a=this;return new Promise(function(n){if("string"==typeof t){t=JSON.parse(t)}a.rowManager.addRows(t,o,l).then(function(t){if(a.modExists("columnCalcs")){a.modules.columnCalcs.recalc(a.rowManager.activeRows)}n(t[0].getComponent())})})};u.prototype.updateOrAddRow=function(t,o){var l=this;return new Promise(function(a,n){var r=l.rowManager.findRow(t);if("string"==typeof o){o=JSON.parse(o)}if(r){r.updateData(o).then(function(){if(l.modExists("columnCalcs")){l.modules.columnCalcs.recalc(l.rowManager.activeRows)}a(r.getComponent())}).catch(function(t){n(t)})}else{r=l.rowManager.addRows(o).then(function(t){if(l.modExists("columnCalcs")){l.modules.columnCalcs.recalc(l.rowManager.activeRows)}a(t[0].getComponent())}).catch(function(t){n(t)})}})};u.prototype.updateRow=function(t,o){var l=this;return new Promise(function(a,n){var r=l.rowManager.findRow(t);if("string"==typeof o){o=JSON.parse(o)}if(r){r.updateData(o).then(function(){a(r.getComponent())}).catch(function(t){n(t)})}else{console.warn("Update Error - No matching row found:",t);n("Update Error - No matching row found")}})};u.prototype.scrollToRow=function(t,o,l){var a=this;return new Promise(function(n,r){var s=a.rowManager.findRow(t);if(s){a.rowManager.scrollToRow(s,o,l).then(function(){n()}).catch(function(t){r(t)})}else{console.warn("Scroll Error - No matching row found:",t);r("Scroll Error - No matching row found")}})};u.prototype.moveRow=function(t,o,l){var a=this.rowManager.findRow(t);if(a){a.moveToRow(o,l)}else{console.warn("Move Error - No matching row found:",t)}};u.prototype.getRows=function(t){if(!0===t){console.warn("passing a boolean to the getRows function is deprecated, you should now pass the string 'active'");t="active"}return this.rowManager.getComponents(t)};u.prototype.getRowPosition=function(t,o){var l=this.rowManager.findRow(t);if(l){return this.rowManager.getRowPosition(l,o)}else{console.warn("Position Error - No matching row found:",t);return!1}};u.prototype.copyToClipboard=function(t){if(this.modExists("clipboard",!0)){this.modules.clipboard.copy(t)}};u.prototype.setColumns=function(t){this.columnManager.setColumns(t)};u.prototype.getColumns=function(t){return this.columnManager.getComponents(t)};u.prototype.getColumn=function(t){var o=this.columnManager.findColumn(t);if(o){return o.getComponent()}else{console.warn("Find Error - No matching column found:",t);return!1}};u.prototype.getColumnDefinitions=function(){return this.columnManager.getDefinitionTree()};u.prototype.getColumnLayout=function(){if(this.modExists("persistence",!0)){return this.modules.persistence.parseColumns(this.columnManager.getColumns())}};u.prototype.setColumnLayout=function(t){if(this.modExists("persistence",!0)){this.columnManager.setColumns(this.modules.persistence.mergeDefinition(this.options.columns,t));return!0}return!1};u.prototype.showColumn=function(t){var o=this.columnManager.findColumn(t);if(o){o.show();if(this.options.responsiveLayout&&this.modExists("responsiveLayout",!0)){this.modules.responsiveLayout.update()}}else{console.warn("Column Show Error - No matching column found:",t);return!1}};u.prototype.hideColumn=function(t){var o=this.columnManager.findColumn(t);if(o){o.hide();if(this.options.responsiveLayout&&this.modExists("responsiveLayout",!0)){this.modules.responsiveLayout.update()}}else{console.warn("Column Hide Error - No matching column found:",t);return!1}};u.prototype.toggleColumn=function(t){var o=this.columnManager.findColumn(t);if(o){if(o.visible){o.hide()}else{o.show()}}else{console.warn("Column Visibility Toggle Error - No matching column found:",t);return!1}};u.prototype.addColumn=function(t,o,l){var a=this;return new Promise(function(n,r){var s=a.columnManager.findColumn(l);a.columnManager.addColumn(t,o,s).then(function(t){n(t.getComponent())}).catch(function(t){r(t)})})};u.prototype.deleteColumn=function(t){var o=this;return new Promise(function(l,a){var n=o.columnManager.findColumn(t);if(n){n.delete().then(function(){l()}).catch(function(t){a(t)})}else{console.warn("Column Delete Error - No matching column found:",t);a()}})};u.prototype.updateColumnDefinition=function(t,o){var l=this;return new Promise(function(a,n){var r=l.columnManager.findColumn(t);if(r){r.updateDefinition(o).then(function(t){a(t)}).catch(function(t){n(t)})}else{console.warn("Column Update Error - No matching column found:",t);n()}})};u.prototype.moveColumn=function(t,o,l){var a=this.columnManager.findColumn(t),n=this.columnManager.findColumn(o);if(a){if(n){this.columnManager.moveColumn(a,n,l)}else{console.warn("Move Error - No matching column found:",n)}}else{console.warn("Move Error - No matching column found:",t)}};u.prototype.scrollToColumn=function(t,o,l){var a=this;return new Promise(function(n,r){var s=a.columnManager.findColumn(t);if(s){a.columnManager.scrollToColumn(s,o,l).then(function(){n()}).catch(function(t){r(t)})}else{console.warn("Scroll Error - No matching column found:",t);r("Scroll Error - No matching column found")}})};u.prototype.setLocale=function(t){this.modules.localize.setLocale(t)};u.prototype.getLocale=function(){return this.modules.localize.getLocale()};u.prototype.getLang=function(t){return this.modules.localize.getLang(t)};u.prototype.redraw=function(t){this.columnManager.redraw(t);this.rowManager.redraw(t)};u.prototype.setHeight=function(t){if("classic"!==this.rowManager.renderMode){this.options.height=isNaN(t)?t:t+"px";this.element.style.height=this.options.height;this.rowManager.setRenderMode();this.rowManager.redraw()}else{console.warn("setHeight function is not available in classic render mode")}};u.prototype.setSort=function(t,o){if(this.modExists("sort",!0)){this.modules.sort.setSort(t,o);this.rowManager.sorterRefresh()}};u.prototype.getSorters=function(){if(this.modExists("sort",!0)){return this.modules.sort.getSort()}};u.prototype.clearSort=function(){if(this.modExists("sort",!0)){this.modules.sort.clear();this.rowManager.sorterRefresh()}};u.prototype.setFilter=function(t,o,l,a){if(this.modExists("filter",!0)){this.modules.filter.setFilter(t,o,l,a);this.rowManager.filterRefresh()}};u.prototype.refreshFilter=function(){if(this.modExists("filter",!0)){this.rowManager.filterRefresh()}};u.prototype.addFilter=function(t,o,l,a){if(this.modExists("filter",!0)){this.modules.filter.addFilter(t,o,l,a);this.rowManager.filterRefresh()}};u.prototype.getFilters=function(t){if(this.modExists("filter",!0)){return this.modules.filter.getFilters(t)}};u.prototype.setHeaderFilterFocus=function(t){if(this.modExists("filter",!0)){var o=this.columnManager.findColumn(t);if(o){this.modules.filter.setHeaderFilterFocus(o)}else{console.warn("Column Filter Focus Error - No matching column found:",t);return!1}}};u.prototype.getHeaderFilterValue=function(t){if(this.modExists("filter",!0)){var o=this.columnManager.findColumn(t);if(o){return this.modules.filter.getHeaderFilterValue(o)}else{console.warn("Column Filter Error - No matching column found:",t)}}};u.prototype.setHeaderFilterValue=function(t,o){if(this.modExists("filter",!0)){var l=this.columnManager.findColumn(t);if(l){this.modules.filter.setHeaderFilterValue(l,o)}else{console.warn("Column Filter Error - No matching column found:",t);return!1}}};u.prototype.getHeaderFilters=function(){if(this.modExists("filter",!0)){return this.modules.filter.getHeaderFilters()}};u.prototype.removeFilter=function(t,o,l){if(this.modExists("filter",!0)){this.modules.filter.removeFilter(t,o,l);this.rowManager.filterRefresh()}};u.prototype.clearFilter=function(t){if(this.modExists("filter",!0)){this.modules.filter.clearFilter(t);this.rowManager.filterRefresh()}};u.prototype.clearHeaderFilter=function(){if(this.modExists("filter",!0)){this.modules.filter.clearHeaderFilter();this.rowManager.filterRefresh()}};u.prototype.selectRow=function(t){if(this.modExists("selectRow",!0)){if(!0===t){console.warn("passing a boolean to the selectRowselectRow function is deprecated, you should now pass the string 'active'");t="active"}this.modules.selectRow.selectRows(t)}};u.prototype.deselectRow=function(t){if(this.modExists("selectRow",!0)){this.modules.selectRow.deselectRows(t)}};u.prototype.toggleSelectRow=function(t){if(this.modExists("selectRow",!0)){this.modules.selectRow.toggleRow(t)}};u.prototype.getSelectedRows=function(){if(this.modExists("selectRow",!0)){return this.modules.selectRow.getSelectedRows()}};u.prototype.getSelectedData=function(){if(this.modExists("selectRow",!0)){return this.modules.selectRow.getSelectedData()}};u.prototype.getInvalidCells=function(){if(this.modExists("validate",!0)){return this.modules.validate.getInvalidCells()}};u.prototype.clearCellValidation=function(t){var o=this;if(this.modExists("validate",!0)){if(!t){t=this.modules.validate.getInvalidCells()}if(!Array.isArray(t)){t=[t]}t.forEach(function(t){o.modules.validate.clearValidation(t._getSelf())})}};u.prototype.validate=function(){var t=[];this.rowManager.rows.forEach(function(o){var l=o.validate();if(!0!==l){t=t.concat(l)}});return t.length?t:!0};u.prototype.setMaxPage=function(t){if(this.options.pagination&&this.modExists("page")){this.modules.page.setMaxPage(t)}else{return!1}};u.prototype.setPage=function(t){if(this.options.pagination&&this.modExists("page")){return this.modules.page.setPage(t)}else{return new Promise(function(t,o){o()})}};u.prototype.setPageToRow=function(t){var o=this;return new Promise(function(l,a){if(o.options.pagination&&o.modExists("page")){t=o.rowManager.findRow(t);if(t){o.modules.page.setPageToRow(t).then(function(){l()}).catch(function(){a()})}else{a()}}else{a()}})};u.prototype.setPageSize=function(t){if(this.options.pagination&&this.modExists("page")){this.modules.page.setPageSize(t);this.modules.page.setPage(1).then(function(){}).catch(function(){})}else{return!1}};u.prototype.getPageSize=function(){if(this.options.pagination&&this.modExists("page",!0)){return this.modules.page.getPageSize()}};u.prototype.previousPage=function(){if(this.options.pagination&&this.modExists("page")){this.modules.page.previousPage()}else{return!1}};u.prototype.nextPage=function(){if(this.options.pagination&&this.modExists("page")){this.modules.page.nextPage()}else{return!1}};u.prototype.getPage=function(){if(this.options.pagination&&this.modExists("page")){return this.modules.page.getPage()}else{return!1}};u.prototype.getPageMax=function(){if(this.options.pagination&&this.modExists("page")){return this.modules.page.getPageMax()}else{return!1}};u.prototype.setGroupBy=function(t){if(this.modExists("groupRows",!0)){this.options.groupBy=t;this.modules.groupRows.initialize();this.rowManager.refreshActiveData("display");if(this.options.persistence&&this.modExists("persistence",!0)&&this.modules.persistence.config.group){this.modules.persistence.save("group")}}else{return!1}};u.prototype.setGroupValues=function(t){if(this.modExists("groupRows",!0)){this.options.groupValues=t;this.modules.groupRows.initialize();this.rowManager.refreshActiveData("display");if(this.options.persistence&&this.modExists("persistence",!0)&&this.modules.persistence.config.group){this.modules.persistence.save("group")}}else{return!1}};u.prototype.setGroupStartOpen=function(t){if(this.modExists("groupRows",!0)){this.options.groupStartOpen=t;this.modules.groupRows.initialize();if(this.options.groupBy){this.rowManager.refreshActiveData("group");if(this.options.persistence&&this.modExists("persistence",!0)&&this.modules.persistence.config.group){this.modules.persistence.save("group")}}else{console.warn("Grouping Update - cant refresh view, no groups have been set")}}else{return!1}};u.prototype.setGroupHeader=function(t){if(this.modExists("groupRows",!0)){this.options.groupHeader=t;this.modules.groupRows.initialize();if(this.options.groupBy){this.rowManager.refreshActiveData("group");if(this.options.persistence&&this.modExists("persistence",!0)&&this.modules.persistence.config.group){this.modules.persistence.save("group")}}else{console.warn("Grouping Update - cant refresh view, no groups have been set")}}else{return!1}};u.prototype.getGroups=function(){if(this.modExists("groupRows",!0)){return this.modules.groupRows.getGroups(!0)}else{return!1}};u.prototype.getGroupedData=function(){if(this.modExists("groupRows",!0)){return this.options.groupBy?this.modules.groupRows.getGroupedData():this.getData()}};u.prototype.getEditedCells=function(){if(this.modExists("edit",!0)){return this.modules.edit.getEditedCells()}};u.prototype.clearCellEdited=function(t){var o=this;if(this.modExists("edit",!0)){if(!t){t=this.modules.edit.getEditedCells()}if(!Array.isArray(t)){t=[t]}t.forEach(function(t){o.modules.edit.clearEdited(t._getSelf())})}};u.prototype.getCalcResults=function(){if(this.modExists("columnCalcs",!0)){return this.modules.columnCalcs.getResults()}else{return!1}};u.prototype.recalc=function(){if(this.modExists("columnCalcs",!0)){this.modules.columnCalcs.recalcAll(this.rowManager.activeRows)}};u.prototype.navigatePrev=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){return t.nav().prev()}}return!1};u.prototype.navigateNext=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){return t.nav().next()}}return!1};u.prototype.navigateLeft=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){e.preventDefault();return t.nav().left()}}return!1};u.prototype.navigateRight=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){e.preventDefault();return t.nav().right()}}return!1};u.prototype.navigateUp=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){e.preventDefault();return t.nav().up()}}return!1};u.prototype.navigateDown=function(){var t=!1;if(this.modExists("edit",!0)){t=this.modules.edit.currentCell;if(t){e.preventDefault();return t.nav().down()}}return!1};u.prototype.undo=function(){if(this.options.history&&this.modExists("history",!0)){return this.modules.history.undo()}else{return!1}};u.prototype.redo=function(){if(this.options.history&&this.modExists("history",!0)){return this.modules.history.redo()}else{return!1}};u.prototype.getHistoryUndoSize=function(){if(this.options.history&&this.modExists("history",!0)){return this.modules.history.getHistoryUndoSize()}else{return!1}};u.prototype.getHistoryRedoSize=function(){if(this.options.history&&this.modExists("history",!0)){return this.modules.history.getHistoryRedoSize()}else{return!1}};u.prototype.clearHistory=function(){if(this.options.history&&this.modExists("history",!0)){return this.modules.history.clear()}else{return!1}};u.prototype.download=function(t,o,l,a){if(this.modExists("download",!0)){this.modules.download.download(t,o,l,a)}};u.prototype.downloadToTab=function(t,o,l,a){if(this.modExists("download",!0)){this.modules.download.download(t,o,l,a,!0)}};u.prototype.tableComms=function(t,o,l,a){this.modules.comms.receive(t,o,l,a)};u.prototype.moduleBindings={};u.prototype.extendModule=function(t,o,l){if(u.prototype.moduleBindings[t]){var a=u.prototype.moduleBindings[t].prototype[o];if(a){if("object"==("undefined"==typeof l?"undefined":_typeof(l))){for(var n in l){a[n]=l[n]}}else{console.warn("Module Error - Invalid value type, it must be an object")}}else{console.warn("Module Error - property does not exist:",o)}}else{console.warn("Module Error - module does not exist:",t)}};u.prototype.registerModule=function(t,o){this;u.prototype.moduleBindings[t]=o};u.prototype.bindModules=function(){this.modules={};for(var t in u.prototype.moduleBindings){this.modules[t]=new u.prototype.moduleBindings[t](this)}};u.prototype.modExists=function(t,o){if(this.modules[t]){return!0}else{if(o){console.error("Tabulator Module Not Installed: "+t)}return!1}};u.prototype.helpers={elVisible:function(t){return!(0>=t.offsetWidth&&0>=t.offsetHeight)},elOffset:function(t){var o=t.getBoundingClientRect();return{top:o.top+window.pageYOffset-document.documentElement.clientTop,left:o.left+window.pageXOffset-document.documentElement.clientLeft}},deepClone:function(t){var o=Object.assign(Array.isArray(t)?[]:{},t);for(var l in t){if(null!=t[l]&&"object"===_typeof(t[l])){if(t[l]instanceof Date){o[l]=new Date(t[l])}else{o[l]=this.deepClone(t[l])}}}return o}};u.prototype.comms={tables:[],register:function(t){u.prototype.comms.tables.push(t)},deregister:function(t){var o=u.prototype.comms.tables.indexOf(t);if(-1<o){u.prototype.comms.tables.splice(o,1)}},lookupTable:function(t,o){var l=[],a,n;if("string"==typeof t){a=document.querySelectorAll(t);if(a.length){for(var r=0;r<a.length;r++){n=u.prototype.comms.matchElement(a[r]);if(n){l.push(n)}}}}else if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement||t instanceof u){n=u.prototype.comms.matchElement(t);if(n){l.push(n)}}else if(Array.isArray(t)){t.forEach(function(t){l=l.concat(u.prototype.comms.lookupTable(t))})}else{if(!o){console.warn("Table Connection Error - Invalid Selector",t)}}return l},matchElement:function(t){return u.prototype.comms.tables.find(function(o){return t instanceof u?o===t:o.element===t})}};u.prototype.findTable=function(t){var o=u.prototype.comms.lookupTable(t,!0);return Array.isArray(o)&&!o.length?!1:o};var m=function(t){this.table=t;this.mode=null};m.prototype.initialize=function(t){if(this.modes[t]){this.mode=t}else{console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+t);this.mode="fitData"}this.table.element.setAttribute("tabulator-layout",this.mode)};m.prototype.getMode=function(){return this.mode};m.prototype.layout=function(){this.modes[this.mode].call(this,this.table.columnManager.columnsByIndex);if(0===this.mode.indexOf("fitData")&&this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.columns){this.table.modules.persistence.save("columns")}};m.prototype.modes={fitData:function(t){if(this.table.options.virtualDomHoz){this.table.vdomHoz.fitDataLayoutOverride()}else{t.forEach(function(t){t.reinitializeWidth()})}if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}},fitDataFill:function(t){t.forEach(function(t){t.reinitializeWidth()});if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}},fitDataTable:function(t){t.forEach(function(t){t.reinitializeWidth()});if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}},fitDataStretch:function(t){var o=this,l=0,a=this.table.rowManager.element.clientWidth,n=0,r=!1;t.forEach(function(t){if(!t.widthFixed){t.reinitializeWidth()}if(o.table.options.responsiveLayout?t.modules.responsive.visible:t.visible){r=t}if(t.visible){l+=t.getWidth()}});if(r){n=a-l+r.getWidth();if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){r.setWidth(0);this.table.modules.responsiveLayout.update()}if(0<n){r.setWidth(n)}else{r.reinitializeWidth()}}else{if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}}},fitColumns:function(t){var a=this,n=a.table.element.clientWidth,r=0,s=0,d=0,p=0,c=[],u=[],m=0,g=0,h=0;function o(t){var o;if("string"==typeof t){if(-1<t.indexOf("%")){o=n/100*parseInt(t)}else{o=parseInt(t)}}else{o=t}return o}function l(t,a,n,r){var c=[],u=0,m=0,g=0,h=d,b=0,f=0,y=[];function s(t){return n*(t.column.definition.widthGrow||1)}function p(t){return o(t.width)-n*(t.column.definition.widthShrink||0)}t.forEach(function(t){var o=r?p(t):s(t);if(t.column.minWidth>=o){c.push(t)}else{if(t.column.maxWidth&&t.column.maxWidth<o){t.width=t.column.maxWidth;a-=t.column.maxWidth;h-=r?t.column.definition.widthShrink||1:t.column.definition.widthGrow||1;if(h){n=Math.floor(a/h)}}else{y.push(t);f+=r?t.column.definition.widthShrink||1:t.column.definition.widthGrow||1}}});if(c.length){c.forEach(function(t){u+=r?t.width-t.column.minWidth:t.column.minWidth;t.width=t.column.minWidth});m=a-u;g=f?Math.floor(m/f):m;b=m-g*f;b+=l(y,m,g,r)}else{b=f?a-Math.floor(a/f)*f:a;y.forEach(function(t){t.width=r?p(t):s(t)})}return b}if(this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)){this.table.modules.responsiveLayout.update()}if(this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight){n-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth}t.forEach(function(t){var l,a,n;if(t.visible){l=t.definition.width;a=parseInt(t.minWidth);if(l){n=o(l);r+=n>a?n:a;if(t.definition.widthShrink){u.push({column:t,width:n>a?n:a});m+=t.definition.widthShrink}}else{c.push({column:t,width:0});d+=t.definition.widthGrow||1}}});s=n-r;p=Math.floor(s/d);var h=l(c,s,p,!1);if(c.length&&0<h){c[c.length-1].width+=+h}c.forEach(function(t){s-=t.width});g=Math.abs(h)+s;if(0<g&&m){h=l(u,g,Math.floor(g/m),!0)}if(u.length){u[u.length-1].width-=h}c.forEach(function(t){t.column.setWidth(t.width)});u.forEach(function(t){t.column.setWidth(t.width)})}};u.prototype.registerModule("layout",m);var g=function(t){this.table=t;this.locale="default";this.lang=!1;this.bindings={};this.langList={}};g.prototype.initialize=function(){this.langList=u.prototype.helpers.deepClone(this.langs)};g.prototype.setHeaderFilterPlaceholder=function(t){this.langList.default.headerFilters.default=t};g.prototype.setHeaderFilterColumnPlaceholder=function(t,o){this.langList.default.headerFilters.columns[t]=o;if(this.lang&&!this.lang.headerFilters.columns[t]){this.lang.headerFilters.columns[t]=o}};g.prototype.installLang=function(t,o){if(this.langList[t]){this._setLangProp(this.langList[t],o)}else{this.langList[t]=o}};g.prototype._setLangProp=function(t,o){for(var l in o){if(t[l]&&"object"==_typeof(t[l])){this._setLangProp(t[l],o[l])}else{t[l]=o[l]}}};g.prototype.setLocale=function(t){var l=this;t=t||"default";function o(t,l){for(var a in t){if("object"==_typeof(t[a])){if(!l[a]){l[a]={}}o(t[a],l[a])}else{l[a]=t[a]}}}if(!0===t&&navigator.language){t=navigator.language.toLowerCase()}if(t){if(!l.langList[t]){var a=t.split("-")[0];if(l.langList[a]){console.warn("Localization Error - Exact matching locale not found, using closest match: ",t,a);t=a}else{console.warn("Localization Error - Matching locale not found, using default: ",t);t="default"}}}l.locale=t;l.lang=u.prototype.helpers.deepClone(l.langList.default||{});if("default"!=t){o(l.langList[t],l.lang)}l.table.options.localized.call(l.table,l.locale,l.lang);l._executeBindings()};g.prototype.getLocale=function(){return self.locale};g.prototype.getLang=function(t){return t?this.langList[t]:this.lang};g.prototype.getText=function(t,o){var t=o?t+"|"+o:t,l=t.split("|"),a=this._getLangElement(l,this.locale);return a||""};g.prototype._getLangElement=function(t){var o=this,l=o.lang;t.forEach(function(t){var o;if(l){o=l[t];if("undefined"!=typeof o){l=o}else{l=!1}}});return l};g.prototype.bind=function(t,o){if(!this.bindings[t]){this.bindings[t]=[]}this.bindings[t].push(o);o(this.getText(t),this.lang)};g.prototype._executeBindings=function(){var t=this,o=function(o){t.bindings[o].forEach(function(l){l(t.getText(o),t.lang)})};for(var l in t.bindings){o(l)}};g.prototype.langs={default:{groups:{item:"item",items:"items"},columns:{},ajax:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All"},headerFilters:{default:"filter column...",columns:{}}}};u.prototype.registerModule("localize",g);var h=function(t){this.table=t};h.prototype.getConnections=function(t){var o=this,l=[],a;a=u.prototype.comms.lookupTable(t);a.forEach(function(t){if(o.table!==t){l.push(t)}});return l};h.prototype.send=function(t,o,l,a){var n=this,r=this.getConnections(t);r.forEach(function(t){t.tableComms(n.table.element,o,l,a)});if(!r.length&&t){console.warn("Table Connection Error - No tables matching selector found",t)}};h.prototype.receive=function(t,o,l,a){if(this.table.modExists(o)){return this.table.modules[o].commsReceived(t,l,a)}else{console.warn("Inter-table Comms Error - no such module:",o)}};u.prototype.registerModule("comms",h);var b=function(t){this.table=t;this.allowedTypes=["","data","download","clipboard","print","htmlOutput"]};b.prototype.initializeColumn=function(t){var o=this,l=!1,a={};this.allowedTypes.forEach(function(n){var r="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),s;if(t.definition[r]){s=o.lookupAccessor(t.definition[r]);if(s){l=!0;a[r]={accessor:s,params:t.definition[r+"Params"]||{}}}}});if(l){t.modules.accessor=a}};b.prototype.lookupAccessor=function(t){var o=!1;switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":if(this.accessors[t]){o=this.accessors[t]}else{console.warn("Accessor Error - No such accessor found, ignoring: ",t)}break;case"function":o=t;break;}return o};b.prototype.transformRow=function(t,o){var l="accessor"+(o.charAt(0).toUpperCase()+o.slice(1)),a=t.getComponent(),n=u.prototype.helpers.deepClone(t.data||{});this.table.columnManager.traverse(function(t){var r,s,d,p;if(t.modules.accessor){s=t.modules.accessor[l]||t.modules.accessor.accessor||!1;if(s){r=t.getFieldValue(n);if("undefined"!=r){p=t.getComponent();d="function"==typeof s.params?s.params(r,n,o,p,a):s.params;t.setFieldValue(n,s.accessor(r,n,o,d,p,a))}}}});return n},b.prototype.accessors={};u.prototype.registerModule("accessor",b);var f=function(t){this.table=t;this.config=!1;this.url="";this.urlGenerator=!1;this.params=!1;this.loaderElement=this.createLoaderElement();this.msgElement=this.createMsgElement();this.loadingElement=!1;this.errorElement=!1;this.loaderPromise=!1;this.progressiveLoad=!1;this.loading=!1;this.requestOrder=0};f.prototype.initialize=function(){var t;this.loaderElement.appendChild(this.msgElement);if(this.table.options.ajaxLoaderLoading){if("string"==typeof this.table.options.ajaxLoaderLoading){t=document.createElement("template");t.innerHTML=this.table.options.ajaxLoaderLoading.trim();this.loadingElement=t.content.firstChild}else{this.loadingElement=this.table.options.ajaxLoaderLoading}}this.loaderPromise=this.table.options.ajaxRequestFunc||this.defaultLoaderPromise;this.urlGenerator=this.table.options.ajaxURLGenerator||this.defaultURLGenerator;if(this.table.options.ajaxLoaderError){if("string"==typeof this.table.options.ajaxLoaderError){t=document.createElement("template");t.innerHTML=this.table.options.ajaxLoaderError.trim();this.errorElement=t.content.firstChild}else{this.errorElement=this.table.options.ajaxLoaderError}}if(this.table.options.ajaxParams){this.setParams(this.table.options.ajaxParams)}if(this.table.options.ajaxConfig){this.setConfig(this.table.options.ajaxConfig)}if(this.table.options.ajaxURL){this.setUrl(this.table.options.ajaxURL)}if(this.table.options.ajaxProgressiveLoad){if(this.table.options.pagination){this.progressiveLoad=!1;console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time")}else{if(this.table.modExists("page")){this.progressiveLoad=this.table.options.ajaxProgressiveLoad;this.table.modules.page.initializeProgressive(this.progressiveLoad)}else{console.error("Pagination plugin is required for progressive ajax loading")}}}};f.prototype.createLoaderElement=function(){var t=document.createElement("div");t.classList.add("tabulator-loader");return t};f.prototype.createMsgElement=function(){var t=document.createElement("div");t.classList.add("tabulator-loader-msg");t.setAttribute("role","alert");return t};f.prototype.setParams=function(t,o){if(o){this.params=this.params||{};for(var l in t){this.params[l]=t[l]}}else{this.params=t}};f.prototype.getParams=function(){return this.params||{}};f.prototype.setConfig=function(t){this._loadDefaultConfig();if("string"==typeof t){this.config.method=t}else{for(var o in t){this.config[o]=t[o]}}};f.prototype._loadDefaultConfig=function(t){var o=this;if(!o.config||t){o.config={};for(var l in o.defaultConfig){o.config[l]=o.defaultConfig[l]}}};f.prototype.setUrl=function(t){this.url=t};f.prototype.getUrl=function(){return this.url};f.prototype.loadData=function(t,o){this;if(this.progressiveLoad){return this._loadDataProgressive()}else{return this._loadDataStandard(t,o)}};f.prototype.nextPage=function(t){var o;if(!this.loading){o=this.table.options.ajaxProgressiveLoadScrollMargin||2*this.table.rowManager.getElement().clientHeight;if(t<o){this.table.modules.page.nextPage().then(function(){}).catch(function(){})}}};f.prototype.blockActiveRequest=function(){this.requestOrder++};f.prototype._loadDataProgressive=function(){this.table.rowManager.setData([]);return this.table.modules.page.setPage(1)};f.prototype._loadDataStandard=function(t,o){var l=this;return new Promise(function(a,n){l.sendRequest(t).then(function(r){l.table.rowManager.setData(r,t,o).then(function(){a()}).catch(function(t){n(t)})}).catch(function(t){n(t)})})};f.prototype.generateParamsList=function(t,o){var l=this,a=[];o=o||"";if(Array.isArray(t)){t.forEach(function(t,n){a=a.concat(l.generateParamsList(t,o?o+"["+n+"]":n))})}else if("object"===("undefined"==typeof t?"undefined":_typeof(t))){for(var n in t){a=a.concat(l.generateParamsList(t[n],o?o+"["+n+"]":n))}}else{a.push({key:o,value:t})}return a};f.prototype.serializeParams=function(t){var o=this.generateParamsList(t),l=[];o.forEach(function(t){l.push(encodeURIComponent(t.key)+"="+encodeURIComponent(t.value))});return l.join("&")};f.prototype.sendRequest=function(t){var o=this,l=this,a=l.url,n;l.requestOrder++;n=l.requestOrder;l._loadDefaultConfig();return new Promise(function(r,s){if(!1!==l.table.options.ajaxRequesting.call(o.table,l.url,l.params)){l.loading=!0;if(!t){l.showLoader()}o.loaderPromise(a,l.config,l.params).then(function(t){if(n===l.requestOrder){if(l.table.options.ajaxResponse){t=l.table.options.ajaxResponse.call(l.table,l.url,l.params,t)}r(t);l.hideLoader();l.loading=!1}else{console.warn("Ajax Response Blocked - An active ajax request was blocked by an attempt to change table data while the request was being made")}}).catch(function(t){console.error("Ajax Load Error: ",t);l.table.options.ajaxError.call(l.table,t);l.showError();setTimeout(function(){l.hideLoader()},3e3);l.loading=!1;s(t)})}else{s()}})};f.prototype.showLoader=function(){var t="function"==typeof this.table.options.ajaxLoader?this.table.options.ajaxLoader():this.table.options.ajaxLoader;if(t){this.hideLoader();while(this.msgElement.firstChild){this.msgElement.removeChild(this.msgElement.firstChild)}this.msgElement.classList.remove("tabulator-error");this.msgElement.classList.add("tabulator-loading");if(this.loadingElement){this.msgElement.appendChild(this.loadingElement)}else{this.msgElement.innerHTML=this.table.modules.localize.getText("ajax|loading")}this.table.element.appendChild(this.loaderElement)}};f.prototype.showError=function(){this.hideLoader();while(this.msgElement.firstChild){this.msgElement.removeChild(this.msgElement.firstChild)}this.msgElement.classList.remove("tabulator-loading");this.msgElement.classList.add("tabulator-error");if(this.errorElement){this.msgElement.appendChild(this.errorElement)}else{this.msgElement.innerHTML=this.table.modules.localize.getText("ajax|error")}this.table.element.appendChild(this.loaderElement)};f.prototype.hideLoader=function(){if(this.loaderElement.parentNode){this.loaderElement.parentNode.removeChild(this.loaderElement)}};f.prototype.defaultConfig={method:"GET"};f.prototype.defaultURLGenerator=function(t,o,l){if(t){if(l&&Object.keys(l).length){if(!o.method||"get"==o.method.toLowerCase()){o.method="get";t+=(t.includes("?")?"&":"?")+this.modules.ajax.serializeParams(l)}}}return t};f.prototype.defaultLoaderPromise=function(t,o,l){var a=this,n;return new Promise(function(r,s){t=a.urlGenerator.call(a.table,t,o,l);if("GET"!=o.method.toUpperCase()){n="object"===_typeof(a.table.options.ajaxContentType)?a.table.options.ajaxContentType:a.contentTypeFormatters[a.table.options.ajaxContentType];if(n){for(var d in n.headers){if(!o.headers){o.headers={}}if("undefined"==typeof o.headers[d]){o.headers[d]=n.headers[d]}}o.body=n.body.call(a,t,o,l)}else{console.warn("Ajax Error - Invalid ajaxContentType value:",a.table.options.ajaxContentType)}}if(t){if("undefined"==typeof o.headers){o.headers={}}if("undefined"==typeof o.headers.Accept){o.headers.Accept="application/json"}if("undefined"==typeof o.headers["X-Requested-With"]){o.headers["X-Requested-With"]="XMLHttpRequest"}if("undefined"==typeof o.mode){o.mode="cors"}if("cors"==o.mode){if("undefined"==typeof o.headers["Access-Control-Allow-Origin"]){o.headers["Access-Control-Allow-Origin"]=window.location.origin}if("undefined"==typeof o.credentials){o.credentials="same-origin"}}else{if("undefined"==typeof o.credentials){o.credentials="include"}}fetch(t,o).then(function(t){if(t.ok){t.json().then(function(t){r(t)}).catch(function(t){s(t);console.warn("Ajax Load Error - Invalid JSON returned",t)})}else{console.error("Ajax Load Error - Connection Error: "+t.status,t.statusText);s(t)}}).catch(function(t){console.error("Ajax Load Error - Connection Error: ",t);s(t)})}else{console.warn("Ajax Load Error - No URL Set");r([])}})};f.prototype.contentTypeFormatters={json:{headers:{"Content-Type":"application/json"},body:function(t,o,l){return JSON.stringify(l)}},form:{headers:{},body:function(t,o,l){var a=this.generateParamsList(l),n=new FormData;a.forEach(function(t){n.append(t.key,t.value)});return n}}};u.prototype.registerModule("ajax",f);var y=function(t){this._row=t};y.prototype.getData=function(t){return this._row.getData(t)};y.prototype.getElement=function(){return this._row.getElement()};y.prototype.getTable=function(){return this._row.table};y.prototype.getCells=function(){var t=[];this._row.getCells().forEach(function(o){t.push(o.getComponent())});return t};y.prototype.getCell=function(t){var o=this._row.getCell(t);return o?o.getComponent():!1};y.prototype._getSelf=function(){return this._row};var w=function(t){this.table=t;this.topCalcs=[];this.botCalcs=[];this.genColumn=!1;this.topElement=this.createElement();this.botElement=this.createElement();this.topRow=!1;this.botRow=!1;this.topInitialized=!1;this.botInitialized=!1;this.initialize()};w.prototype.createElement=function(){var t=document.createElement("div");t.classList.add("tabulator-calcs-holder");return t};w.prototype.initialize=function(){this.genColumn=new l({field:"value"},this)};w.prototype.registerColumnField=function(){};w.prototype.initializeColumn=function(t){var o=t.definition,l={topCalcParams:o.topCalcParams||{},botCalcParams:o.bottomCalcParams||{}};if(o.topCalc){switch(_typeof(o.topCalc)){case"string":if(this.calculations[o.topCalc]){l.topCalc=this.calculations[o.topCalc]}else{console.warn("Column Calc Error - No such calculation found, ignoring: ",o.topCalc)}break;case"function":l.topCalc=o.topCalc;break;}if(l.topCalc){t.modules.columnCalcs=l;this.topCalcs.push(t);if("group"!=this.table.options.columnCalcs){this.initializeTopRow()}}}if(o.bottomCalc){switch(_typeof(o.bottomCalc)){case"string":if(this.calculations[o.bottomCalc]){l.botCalc=this.calculations[o.bottomCalc]}else{console.warn("Column Calc Error - No such calculation found, ignoring: ",o.bottomCalc)}break;case"function":l.botCalc=o.bottomCalc;break;}if(l.botCalc){t.modules.columnCalcs=l;this.botCalcs.push(t);if("group"!=this.table.options.columnCalcs){this.initializeBottomRow()}}}};w.prototype.removeCalcs=function(){var t=!1;if(this.topInitialized){this.topInitialized=!1;this.topElement.parentNode.removeChild(this.topElement);t=!0}if(this.botInitialized){this.botInitialized=!1;this.table.footerManager.remove(this.botElement);t=!0}if(t){this.table.rowManager.adjustTableSize()}};w.prototype.initializeTopRow=function(){if(!this.topInitialized){this.table.columnManager.getElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling);this.topInitialized=!0}};w.prototype.initializeBottomRow=function(){if(!this.botInitialized){this.table.footerManager.prepend(this.botElement);this.botInitialized=!0}};w.prototype.scrollHorizontal=function(t){if(this.botInitialized&&this.botRow){this.botRow.getElement().style.marginLeft=-t+"px"}};w.prototype.recalc=function(t){var o;if(this.topInitialized||this.botInitialized){this.rowsToData(t);if(this.topInitialized){if(this.topRow){this.topRow.deleteCells()}o=this.generateRow("top",this.rowsToData(t));this.topRow=o;while(this.topElement.firstChild){this.topElement.removeChild(this.topElement.firstChild)}this.topElement.appendChild(o.getElement());o.initialize(!0)}if(this.botInitialized){if(this.botRow){this.botRow.deleteCells()}o=this.generateRow("bottom",this.rowsToData(t));this.botRow=o;while(this.botElement.firstChild){this.botElement.removeChild(this.botElement.firstChild)}this.botElement.appendChild(o.getElement());o.initialize(!0)}this.table.rowManager.adjustTableSize();if(this.table.modExists("frozenColumns")){this.table.modules.frozenColumns.layout()}}};w.prototype.recalcRowGroup=function(t){this.recalcGroup(this.table.modules.groupRows.getRowGroup(t))};w.prototype.recalcAll=function(){var t=this;if(this.topCalcs.length||this.botCalcs.length){if("group"!==this.table.options.columnCalcs){this.recalc(this.table.rowManager.activeRows)}if(this.table.options.groupBy&&"table"!==this.table.options.columnCalcs){var o=table.modules.groupRows.getChildGroups();o.forEach(function(o){t.recalcGroup(o)})}}};w.prototype.recalcGroup=function(t){var o,l;if(t){if(t.calcs){if(t.calcs.bottom){o=this.rowsToData(t.rows);l=this.generateRowData("bottom",o);t.calcs.bottom.updateData(l);t.calcs.bottom.reinitialize()}if(t.calcs.top){o=this.rowsToData(t.rows);l=this.generateRowData("top",o);t.calcs.top.updateData(l);t.calcs.top.reinitialize()}}}};w.prototype.generateTopRow=function(t){return this.generateRow("top",this.rowsToData(t))};w.prototype.generateBottomRow=function(t){return this.generateRow("bottom",this.rowsToData(t))};w.prototype.rowsToData=function(t){var o=this,l=[];t.forEach(function(t){l.push(t.getData());if(o.table.options.dataTree&&o.table.options.dataTreeChildColumnCalcs){if(t.modules.dataTree.open){var a=o.rowsToData(o.table.modules.dataTree.getFilteredTreeChildren(t));l=l.concat(a)}}});return l};w.prototype.generateRow=function(t,o){var l=this,a=this.generateRowData(t,o),n;if(l.table.modExists("mutator")){l.table.modules.mutator.disable()}n=new s(a,this,"calc");if(l.table.modExists("mutator")){l.table.modules.mutator.enable()}n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+t);n.component=!1;n.getComponent=function(){if(!this.component){this.component=new y(this)}return this.component};n.generateCells=function(){var o=[];l.table.columnManager.columnsByIndex.forEach(function(a){l.genColumn.setField(a.getField());l.genColumn.hozAlign=a.hozAlign;if(a.definition[t+"CalcFormatter"]&&l.table.modExists("format")){l.genColumn.modules.format={formatter:l.table.modules.format.getFormatter(a.definition[t+"CalcFormatter"]),params:a.definition[t+"CalcFormatterParams"]||{}}}else{l.genColumn.modules.format={formatter:l.table.modules.format.getFormatter("plaintext"),params:{}}}l.genColumn.definition.cssClass=a.definition.cssClass;var r=new p(l.genColumn,n);r.getElement();r.column=a;r.setWidth();a.cells.push(r);o.push(r);if(!a.visible){r.hide()}});this.cells=o};return n};w.prototype.generateRowData=function(t,o){var l={},a="top"==t?this.topCalcs:this.botCalcs,n="top"==t?"topCalc":"botCalc",r,s;a.forEach(function(t){var a=[];if(t.modules.columnCalcs&&t.modules.columnCalcs[n]){o.forEach(function(o){a.push(t.getFieldValue(o))});s=n+"Params";r="function"==typeof t.modules.columnCalcs[s]?t.modules.columnCalcs[s](a,o):t.modules.columnCalcs[s];t.setFieldValue(l,t.modules.columnCalcs[n](a,o,r))}});return l};w.prototype.hasTopCalcs=function(){return!!this.topCalcs.length};w.prototype.hasBottomCalcs=function(){return!!this.botCalcs.length};w.prototype.redraw=function(){if(this.topRow){this.topRow.normalizeHeight(!0)}if(this.botRow){this.botRow.normalizeHeight(!0)}};w.prototype.getResults=function(){var t=this,o={},l;if(this.table.options.groupBy&&this.table.modExists("groupRows")){l=this.table.modules.groupRows.getGroups(!0);l.forEach(function(l){o[l.getKey()]=t.getGroupResults(l)})}else{o={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}}}return o};w.prototype.getGroupResults=function(t){var o=this,l=t._getSelf(),a=t.getSubGroups(),n={},r={};a.forEach(function(t){n[t.getKey()]=o.getGroupResults(t)});r={top:l.calcs.top?l.calcs.top.getData():{},bottom:l.calcs.bottom?l.calcs.bottom.getData():{},groups:n};return r};w.prototype.calculations={avg:function(t,o,l){var a=0,n="undefined"!=typeof l.precision?l.precision:2;if(t.length){a=t.reduce(function(t,o){return+t+ +o});a=a/t.length;a=!1!==n?a.toFixed(n):a}return parseFloat(a).toString()},max:function(t,o,l){var a=null,n="undefined"!=typeof l.precision?l.precision:!1;t.forEach(function(t){t=+t;if(t>a||null===a){a=t}});return null!==a?!1!==n?a.toFixed(n):a:""},min:function(t,o,l){var a=null,n="undefined"!=typeof l.precision?l.precision:!1;t.forEach(function(t){t=+t;if(t<a||null===a){a=t}});return null!==a?!1!==n?a.toFixed(n):a:""},sum:function(t,o,l){var a=0,n="undefined"!=typeof l.precision?l.precision:!1;if(t.length){t.forEach(function(t){t=+t;a+=!isNaN(t)?+t:0})}return!1!==n?a.toFixed(n):a},concat:function(t){var o=0;if(t.length){o=t.reduce(function(t,o){return t+""+(o+"")})}return o},count:function(t){var o=0;if(t.length){t.forEach(function(t){if(t){o++}})}return o}};u.prototype.registerModule("columnCalcs",w);var v=function(t){this.table=t;this.mode=!0;this.pasteParser=function(){};this.pasteAction=function(){};this.customSelection=!1;this.rowRange=!1;this.blocked=!0};v.prototype.initialize=function(){var t=this;this.mode=this.table.options.clipboard;this.rowRange=this.table.options.clipboardCopyRowRange;if(!0===this.mode||"copy"===this.mode){this.table.element.addEventListener("copy",function(o){var l,a,n;if(!t.blocked){o.preventDefault();if(t.customSelection){l=t.customSelection;if(t.table.options.clipboardCopyFormatter){l=t.table.options.clipboardCopyFormatter("plain",l)}}else{var n=t.table.modules.export.generateExportList(t.table.options.clipboardCopyConfig,t.table.options.clipboardCopyStyled,t.rowRange,"clipboard");a=t.table.modules.export.genereateHTMLTable(n);l=a?t.generatePlainContent(n):"";if(t.table.options.clipboardCopyFormatter){l=t.table.options.clipboardCopyFormatter("plain",l);a=t.table.options.clipboardCopyFormatter("html",a)}}if(window.clipboardData&&window.clipboardData.setData){window.clipboardData.setData("Text",l)}else if(o.clipboardData&&o.clipboardData.setData){o.clipboardData.setData("text/plain",l);if(a){o.clipboardData.setData("text/html",a)}}else if(o.originalEvent&&o.originalEvent.clipboardData.setData){o.originalEvent.clipboardData.setData("text/plain",l);if(a){o.originalEvent.clipboardData.setData("text/html",a)}}t.table.options.clipboardCopied.call(t.table,l,a);t.reset()}})}if(!0===this.mode||"paste"===this.mode){this.table.element.addEventListener("paste",function(o){t.paste(o)})}this.setPasteParser(this.table.options.clipboardPasteParser);this.setPasteAction(this.table.options.clipboardPasteAction)};v.prototype.reset=function(){this.blocked=!0;this.customSelection=!1};v.prototype.generatePlainContent=function(t){var o=[];t.forEach(function(t){var l=[];t.columns.forEach(function(o){var a="";if(o){if("group"===t.type){o.value=o.component.getKey()}if(null===o.value){a=""}else{switch(_typeof(o.value)){case"object":a=JSON.stringify(o.value);break;case"undefined":a="";break;default:a=o.value;}}}l.push(a)});o.push(l.join("\t"))});return o.join("\n")};v.prototype.copy=function(t,o){var t,l,a;this.blocked=!1;this.customSelection=!1;if(!0===this.mode||"copy"===this.mode){this.rowRange=t||this.table.options.clipboardCopyRowRange;if("undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){t=document.createRange();t.selectNodeContents(this.table.element);l=window.getSelection();if(l.toString()&&o){this.customSelection=l.toString()}l.removeAllRanges();l.addRange(t)}else if("undefined"!=typeof document.selection&&"undefined"!=typeof document.body.createTextRange){a=document.body.createTextRange();a.moveToElementText(this.table.element);a.select()}document.execCommand("copy");if(l){l.removeAllRanges()}}};v.prototype.setPasteAction=function(t){switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":this.pasteAction=this.pasteActions[t];if(!this.pasteAction){console.warn("Clipboard Error - No such paste action found:",t)}break;case"function":this.pasteAction=t;break;}};v.prototype.setPasteParser=function(t){switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":this.pasteParser=this.pasteParsers[t];if(!this.pasteParser){console.warn("Clipboard Error - No such paste parser found:",t)}break;case"function":this.pasteParser=t;break;}};v.prototype.paste=function(t){var o,l,a;if(this.checkPaseOrigin(t)){o=this.getPasteData(t);l=this.pasteParser.call(this,o);if(l){t.preventDefault();if(this.table.modExists("mutator")){l=this.mutateData(l)}a=this.pasteAction.call(this,l);this.table.options.clipboardPasted.call(this.table,o,l,a)}else{this.table.options.clipboardPasteError.call(this.table,o)}}};v.prototype.mutateData=function(t){var o=this,l=[];if(Array.isArray(t)){t.forEach(function(t){l.push(o.table.modules.mutator.transformRow(t,"clipboard"))})}else{l=t}return l};v.prototype.checkPaseOrigin=function(t){var o=!0;if("DIV"!=t.target.tagName||this.table.modules.edit.currentCell){o=!1}return o};v.prototype.getPasteData=function(t){var o;if(window.clipboardData&&window.clipboardData.getData){o=window.clipboardData.getData("Text")}else if(t.clipboardData&&t.clipboardData.getData){o=t.clipboardData.getData("text/plain")}else if(t.originalEvent&&t.originalEvent.clipboardData.getData){o=t.originalEvent.clipboardData.getData("text/plain")}return o};v.prototype.pasteParsers={table:function(t){var o=[],l=!0,a=this.table.columnManager.columns,n=[],r=[];t=t.split("\n");t.forEach(function(t){o.push(t.split("\t"))});if(o.length&&!(1===o.length&&2>o[0].length)){o[0].forEach(function(t){var o=a.find(function(o){return t&&o.definition.title&&t.trim()&&o.definition.title.trim()===t.trim()});if(o){n.push(o)}else{l=!1}});if(!l){l=!0;n=[];o[0].forEach(function(t){var o=a.find(function(o){return t&&o.field&&t.trim()&&o.field.trim()===t.trim()});if(o){n.push(o)}else{l=!1}});if(!l){n=this.table.columnManager.columnsByIndex}}if(l){o.shift()}o.forEach(function(t){var o={};t.forEach(function(t,l){if(n[l]){o[n[l].field]=t}});r.push(o)});return r}else{return!1}}};v.prototype.pasteActions={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}};u.prototype.registerModule("clipboard",v);var E=function(t){this.table=t;this.indent=10;this.field="";this.collapseEl=null;this.expandEl=null;this.branchEl=null;this.elementField=!1;this.startOpen=function(){};this.displayIndex=0};E.prototype.initialize=function(){var t=null,o=this.table.columnManager.getFirstVisibileColumn(),l=this.table.options;this.field=l.dataTreeChildField;this.indent=l.dataTreeChildIndent;this.elementField=l.dataTreeElementColumn||(o?o.field:!1);if(l.dataTreeBranchElement){if(!0===l.dataTreeBranchElement){this.branchEl=document.createElement("div");this.branchEl.classList.add("tabulator-data-tree-branch")}else{if("string"==typeof l.dataTreeBranchElement){t=document.createElement("div");t.innerHTML=l.dataTreeBranchElement;this.branchEl=t.firstChild}else{this.branchEl=l.dataTreeBranchElement}}}if(l.dataTreeCollapseElement){if("string"==typeof l.dataTreeCollapseElement){t=document.createElement("div");t.innerHTML=l.dataTreeCollapseElement;this.collapseEl=t.firstChild}else{this.collapseEl=l.dataTreeCollapseElement}}else{this.collapseEl=document.createElement("div");this.collapseEl.classList.add("tabulator-data-tree-control");this.collapseEl.tabIndex=0;this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"}if(l.dataTreeExpandElement){if("string"==typeof l.dataTreeExpandElement){t=document.createElement("div");t.innerHTML=l.dataTreeExpandElement;this.expandEl=t.firstChild}else{this.expandEl=l.dataTreeExpandElement}}else{this.expandEl=document.createElement("div");this.expandEl.classList.add("tabulator-data-tree-control");this.expandEl.tabIndex=0;this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"}switch(_typeof(l.dataTreeStartExpanded)){case"boolean":this.startOpen=function(){return l.dataTreeStartExpanded};break;case"function":this.startOpen=l.dataTreeStartExpanded;break;default:this.startOpen=function(t,o){return l.dataTreeStartExpanded[o]};break;}};E.prototype.initializeRow=function(t){var o=t.getData()[this.field],l=Array.isArray(o),a=l||!l&&"object"===("undefined"==typeof o?"undefined":_typeof(o))&&null!==o;if(!a&&t.modules.dataTree&&t.modules.dataTree.branchEl){t.modules.dataTree.branchEl.parentNode.removeChild(t.modules.dataTree.branchEl)}if(!a&&t.modules.dataTree&&t.modules.dataTree.controlEl){t.modules.dataTree.controlEl.parentNode.removeChild(t.modules.dataTree.controlEl)}t.modules.dataTree={index:t.modules.dataTree?t.modules.dataTree.index:0,open:a?t.modules.dataTree?t.modules.dataTree.open:this.startOpen(t.getComponent(),0):!1,controlEl:t.modules.dataTree&&a?t.modules.dataTree.controlEl:!1,branchEl:t.modules.dataTree&&a?t.modules.dataTree.branchEl:!1,parent:t.modules.dataTree?t.modules.dataTree.parent:!1,children:a}};E.prototype.layoutRow=function(t){var o=this.elementField?t.getCell(this.elementField):t.getCells()[0],l=o.getElement(),a=t.modules.dataTree;if(a.branchEl){if(a.branchEl.parentNode){a.branchEl.parentNode.removeChild(a.branchEl)}a.branchEl=!1}if(a.controlEl){if(a.controlEl.parentNode){a.controlEl.parentNode.removeChild(a.controlEl)}a.controlEl=!1}this.generateControlElement(t,l);t.getElement().classList.add("tabulator-tree-level-"+a.index);if(a.index){if(this.branchEl){a.branchEl=this.branchEl.cloneNode(!0);l.insertBefore(a.branchEl,l.firstChild);if(this.table.rtl){a.branchEl.style.marginRight=(a.branchEl.offsetWidth+a.branchEl.style.marginLeft)*(a.index-1)+a.index*this.indent+"px"}else{a.branchEl.style.marginLeft=(a.branchEl.offsetWidth+a.branchEl.style.marginRight)*(a.index-1)+a.index*this.indent+"px"}}else{if(this.table.rtl){l.style.paddingRight=parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-right"))+a.index*this.indent+"px"}else{l.style.paddingLeft=parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-left"))+a.index*this.indent+"px"}}}};E.prototype.generateControlElement=function(t,o){var l=this,a=t.modules.dataTree,o=o||t.getCells()[0].getElement(),n=a.controlEl;if(!1!==a.children){if(a.open){a.controlEl=this.collapseEl.cloneNode(!0);a.controlEl.addEventListener("click",function(o){o.stopPropagation();l.collapseRow(t)})}else{a.controlEl=this.expandEl.cloneNode(!0);a.controlEl.addEventListener("click",function(o){o.stopPropagation();l.expandRow(t)})}a.controlEl.addEventListener("mousedown",function(t){t.stopPropagation()});if(n&&n.parentNode===o){n.parentNode.replaceChild(a.controlEl,n)}else{o.insertBefore(a.controlEl,o.firstChild)}}};E.prototype.setDisplayIndex=function(t){this.displayIndex=t};E.prototype.getDisplayIndex=function(){return this.displayIndex};E.prototype.getRows=function(t){var o=this,l=[];t.forEach(function(t){var a,n;l.push(t);if(t instanceof s){t.create();a=t.modules.dataTree.children;if(!a.index&&!1!==a.children){n=o.getChildren(t);n.forEach(function(t){t.create();l.push(t)})}}});return l};E.prototype.getChildren=function(t,o){var l=this,a=t.modules.dataTree,n=[],r=[];if(!1!==a.children&&(a.open||o)){if(!Array.isArray(a.children)){a.children=this.generateChildren(t)}if(this.table.modExists("filter")&&this.table.options.dataTreeFilter){n=this.table.modules.filter.filter(a.children)}else{n=a.children}if(this.table.modExists("sort")&&this.table.options.dataTreeSort){this.table.modules.sort.sort(n)}n.forEach(function(t){r.push(t);var o=l.getChildren(t);o.forEach(function(t){r.push(t)})})}return r};E.prototype.generateChildren=function(t){var o=this,l=[],a=t.getData()[this.field];if(!Array.isArray(a)){a=[a]}a.forEach(function(a){var n=new s(a||{},o.table.rowManager);n.create();n.modules.dataTree.index=t.modules.dataTree.index+1;n.modules.dataTree.parent=t;if(n.modules.dataTree.children){n.modules.dataTree.open=o.startOpen(n.getComponent(),n.modules.dataTree.index)}l.push(n)});return l};E.prototype.expandRow=function(t){var o=t.modules.dataTree;if(!1!==o.children){o.open=!0;t.reinitialize();this.table.rowManager.refreshActiveData("tree",!1,!0);this.table.options.dataTreeRowExpanded(t.getComponent(),t.modules.dataTree.index)}};E.prototype.collapseRow=function(t){var o=t.modules.dataTree;if(!1!==o.children){o.open=!1;t.reinitialize();this.table.rowManager.refreshActiveData("tree",!1,!0);this.table.options.dataTreeRowCollapsed(t.getComponent(),t.modules.dataTree.index)}};E.prototype.toggleRow=function(t){var o=t.modules.dataTree;if(!1!==o.children){if(o.open){this.collapseRow(t)}else{this.expandRow(t)}}};E.prototype.getTreeParent=function(t){return t.modules.dataTree.parent?t.modules.dataTree.parent.getComponent():!1};E.prototype.getFilteredTreeChildren=function(t){var o=t.modules.dataTree,l=[],a;if(o.children){if(!Array.isArray(o.children)){o.children=this.generateChildren(t)}if(this.table.modExists("filter")&&this.table.options.dataTreeFilter){a=this.table.modules.filter.filter(o.children)}else{a=o.children}a.forEach(function(t){if(t instanceof s){l.push(t)}})}return l};E.prototype.rowDelete=function(t){var o=t.modules.dataTree.parent,l;if(o){l=this.findChildIndex(t,o);if(!1!==l){o.data[this.field].splice(l,1)}if(!o.data[this.field].length){delete o.data[this.field]}this.initializeRow(o);this.layoutRow(o)}this.table.rowManager.refreshActiveData("tree",!1,!0)};E.prototype.addTreeChildRow=function(t,o,l,a){var n=!1;if("string"==typeof o){o=JSON.parse(o)}if(!Array.isArray(t.data[this.field])){t.data[this.field]=[];t.modules.dataTree.open=this.startOpen(t.getComponent(),t.modules.dataTree.index)}if("undefined"!=typeof a){n=this.findChildIndex(a,t);if(!1!==n){t.data[this.field].splice(l?n:n+1,0,o)}}if(!1===n){if(l){t.data[this.field].unshift(o)}else{t.data[this.field].push(o)}}this.initializeRow(t);this.layoutRow(t);this.table.rowManager.refreshActiveData("tree",!1,!0)};E.prototype.findChildIndex=function(t,o){var l=this,a=!1;if("object"==("undefined"==typeof t?"undefined":_typeof(t))){if(t instanceof s){a=t.data}else if(t instanceof r){a=t._getSelf().data}else if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement){if(o.modules.dataTree){a=o.modules.dataTree.children.find(function(o){return o instanceof s?o.element===t:!1});if(a){a=a.data}}}}else if("undefined"==typeof t||null===t){a=!1}else{a=o.data[this.field].find(function(o){return o.data[l.table.options.index]==t})}if(a){if(Array.isArray(o.data[this.field])){a=o.data[this.field].indexOf(a)}if(-1==a){a=!1}}return a};E.prototype.getTreeChildren=function(t,o,l){var a=this,n=t.modules.dataTree,r=[];if(n.children){if(!Array.isArray(n.children)){n.children=this.generateChildren(t)}n.children.forEach(function(t){if(t instanceof s){r.push(o?t.getComponent():t);if(l){r=r.concat(a.getTreeChildren(t,o,l))}}})}return r};E.prototype.checkForRestyle=function(t){if(!t.row.cells.indexOf(t)){t.row.reinitialize()}};E.prototype.getChildField=function(){return this.field};E.prototype.redrawNeeded=function(t){return(this.field?"undefined"!=typeof t[this.field]:!1)||(this.elementField?"undefined"!=typeof t[this.elementField]:!1)};u.prototype.registerModule("dataTree",E);var C=function(t){this.table=t};C.prototype.download=function(t,o,l,a,n){var s=this,d=!1;function r(l,a){if(n){if(!0===n){s.triggerDownload(l,a,t,o,!0)}else{n(l)}}else{s.triggerDownload(l,a,t,o)}}if("function"==typeof t){d=t}else{if(s.downloaders[t]){d=s.downloaders[t]}else{console.warn("Download Error - No such download type found: ",t)}}if(d){var p=this.generateExportList(a);d.call(this.table,p,l||{},r)}};C.prototype.generateExportList=function(t){var o=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,t||this.table.options.downloadRowRange,"download"),l=this.table.options.groupHeaderDownload;if(l&&!Array.isArray(l)){l=[l]}o.forEach(function(t){var o;if("group"===t.type){o=t.columns[0];if(l&&l[t.indent]){o.value=l[t.indent](o.value,t.component._group.getRowCount(),t.component._group.getData(),t.component)}}});return o};C.prototype.triggerDownload=function(t,o,l,a,n){var r=document.createElement("a"),s=new Blob([t],{type:o}),a=a||"Tabulator."+("function"==typeof l?"txt":l);s=this.table.options.downloadReady.call(this.table,t,s);if(s){if(n){window.open(window.URL.createObjectURL(s))}else{if(navigator.msSaveOrOpenBlob){navigator.msSaveOrOpenBlob(s,a)}else{r.setAttribute("href",window.URL.createObjectURL(s));r.setAttribute("download",a);r.style.display="none";document.body.appendChild(r);r.click();document.body.removeChild(r)}}if(this.table.options.downloadComplete){this.table.options.downloadComplete()}}};C.prototype.commsReceived=function(t,o,l){switch(o){case"intercept":this.download(l.type,"",l.options,l.active,l.intercept);break;}};C.prototype.downloaders={csv:function(t,o,l){var a=o&&o.delimiter?o.delimiter:",",n=[],r=[];t.forEach(function(t){var o=[];switch(t.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":t.columns.forEach(function(t,o){if(t&&1===t.depth){r[o]="undefined"==typeof t.value||null===t.value?"":"\""+(t.value+"").split("\"").join("\"\"")+"\""}});break;case"row":t.columns.forEach(function(t){if(t){switch(_typeof(t.value)){case"object":t.value=JSON.stringify(t.value);break;case"undefined":case"null":t.value="";break;}o.push("\""+(t.value+"").split("\"").join("\"\"")+"\"")}});n.push(o.join(a));break;}});if(r.length){n.unshift(r.join(a))}n=n.join("\n");if(o.bom){n="\uFEFF"+n}l(n,"text/csv")},json:function(t,o,l){var a=[];t.forEach(function(t){var o={};switch(t.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":t.columns.forEach(function(t){if(t){o[t.component.getField()]=t.value}});a.push(o);break;}});a=JSON.stringify(a,null,"\t");l(a,"application/json")},pdf:function(t,o,l){var n=[],r=[],s={},d=o.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},p=o.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},c=o.jsPDF||{},u=o&&o.title?o.title:"";if(!c.orientation){c.orientation=o.orientation||"landscape"}if(!c.unit){c.unit="pt"}t.forEach(function(t){switch(t.type){case"header":n.push(a(t));break;case"group":r.push(a(t,d));break;case"calc":r.push(a(t,p));break;case"row":r.push(a(t));break;}});function a(t,o){var l=[];t.columns.forEach(function(t){var a;if(t){switch(_typeof(t.value)){case"object":t.value=JSON.stringify(t.value);break;case"undefined":case"null":t.value="";break;}a={content:t.value,colSpan:t.width,rowSpan:t.height};if(o){a.styles=o}l.push(a)}else{l.push("")}});return l}var m=new jsPDF(c);if(o&&o.autoTable){if("function"==typeof o.autoTable){s=o.autoTable(m)||{}}else{s=o.autoTable}}if(u){s.addPageContent=function(){m.text(u,40,30)}}s.head=n;s.body=r;m.autoTable(s);if(o&&o.documentProcessing){o.documentProcessing(m)}l(m.output("arraybuffer"),"application/pdf")},xlsx:function(t,o,l){var n=this,r=o.sheetName||"Sheet1",s=XLSX.utils.book_new(),d;s.SheetNames=[];s.Sheets={};function a(){var o=[],l=[],a={},n={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce(function(t,o){return t+(o&&o.width?o.width:1)},0):0,r:t.length}};t.forEach(function(t,a){var n=[];t.columns.forEach(function(t,o){if(t){n.push(!(t.value instanceof Date)&&"object"===_typeof(t.value)?JSON.stringify(t.value):t.value);if(1<t.width||-1<t.height){l.push({s:{r:a,c:o},e:{r:a+t.height-1,c:o+t.width-1}})}}else{n.push("")}});o.push(n)});XLSX.utils.sheet_add_aoa(a,o);a["!ref"]=XLSX.utils.encode_range(n);if(l.length){a["!merges"]=l}return a}if(o.sheetOnly){l(a());return}if(o.sheets){for(var p in o.sheets){if(!0===o.sheets[p]){s.SheetNames.push(p);s.Sheets[p]=a()}else{s.SheetNames.push(p);this.modules.comms.send(o.sheets[p],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:n.active,intercept:function(t){s.Sheets[p]=t}})}}}else{s.SheetNames.push(r);s.Sheets[r]=a()}if(o.documentProcessing){s=o.documentProcessing(s)}d=XLSX.write(s,{bookType:"xlsx",bookSST:!0,type:"binary"});l(function(t){for(var o=new ArrayBuffer(t.length),l=new Uint8Array(o),a=0;a!=t.length;++a){l[a]=255&t.charCodeAt(a)}return o}(d),"application/octet-stream")},html:function(t,o,l){if(this.modExists("export",!0)){l(this.modules.export.genereateHTMLTable(t),"text/html")}}};u.prototype.registerModule("download",C);var x=function(t){this.table=t;this.currentCell=!1;this.mouseClick=!1;this.recursionBlock=!1;this.invalidEdit=!1;this.editedCells=[]};x.prototype.initializeColumn=function(t){var o=this,l={editor:!1,blocked:!1,check:t.definition.editable,params:t.definition.editorParams||{}};switch(_typeof(t.definition.editor)){case"string":if("tick"===t.definition.editor){t.definition.editor="tickCross";console.warn("DEPRECATION WARNING - the tick editor has been deprecated, please use the tickCross editor")}if(o.editors[t.definition.editor]){l.editor=o.editors[t.definition.editor]}else{console.warn("Editor Error - No such editor found: ",t.definition.editor)}break;case"function":l.editor=t.definition.editor;break;case"boolean":if(!0===t.definition.editor){if("function"!=typeof t.definition.formatter){if("tick"===t.definition.formatter){t.definition.formatter="tickCross";console.warn("DEPRECATION WARNING - the tick editor has been deprecated, please use the tickCross editor")}if(o.editors[t.definition.formatter]){l.editor=o.editors[t.definition.formatter]}else{l.editor=o.editors.input}}else{console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",t.definition.formatter)}}break;}if(l.editor){t.modules.edit=l}};x.prototype.getCurrentCell=function(){return this.currentCell?this.currentCell.getComponent():!1};x.prototype.clearEditor=function(t){var o=this.currentCell,l;this.invalidEdit=!1;if(o){this.currentCell=!1;l=o.getElement();if(t){o.validate()}else{l.classList.remove("tabulator-validation-fail")}l.classList.remove("tabulator-editing");while(l.firstChild){l.removeChild(l.firstChild)}o.row.getElement().classList.remove("tabulator-row-editing")}};x.prototype.cancelEdit=function(){if(this.currentCell){var t=this.currentCell,o=this.currentCell.getComponent();this.clearEditor(!0);t.setValueActual(t.getValue());t.cellRendered();if("textarea"==t.column.definition.editor||t.column.definition.variableHeight){t.row.normalizeHeight(!0)}if(t.column.cellEvents.cellEditCancelled){t.column.cellEvents.cellEditCancelled.call(this.table,o)}this.table.options.cellEditCancelled.call(this.table,o)}};x.prototype.bindEditor=function(t){var o=this,l=t.getElement(!0);l.setAttribute("tabindex",0);l.addEventListener("click",function(){if(!l.classList.contains("tabulator-editing")){l.focus({preventScroll:!0})}});l.addEventListener("mousedown",function(t){if(2===t.button){t.preventDefault()}else{o.mouseClick=!0}});l.addEventListener("focus",function(l){if(!o.recursionBlock){o.edit(t,l,!1)}})};x.prototype.focusCellNoEvent=function(t,o){this.recursionBlock=!0;if(!(o&&"ie"===this.table.browser)){t.getElement().focus({preventScroll:!0})}this.recursionBlock=!1};x.prototype.editCell=function(t,o){this.focusCellNoEvent(t);this.edit(t,!1,o)};x.prototype.focusScrollAdjust=function(t){if("virtual"==this.table.rowManager.getRenderMode()){var o=this.table.rowManager.element.scrollTop,l=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,a=t.row.getElement(),n=a.offsetTop;if(a.offsetTop<o){this.table.rowManager.element.scrollTop-=o-a.offsetTop}else{if(a.offsetTop+a.offsetHeight>l){this.table.rowManager.element.scrollTop+=a.offsetTop+a.offsetHeight-l}}var r=this.table.rowManager.element.scrollLeft,s=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,d=t.getElement(),n=d.offsetLeft;if(this.table.modExists("frozenColumns")){r+=parseInt(this.table.modules.frozenColumns.leftMargin);s-=parseInt(this.table.modules.frozenColumns.rightMargin)}if(this.table.options.virtualDomHoz){r-=parseInt(this.table.vdomHoz.vDomPadLeft);s-=parseInt(this.table.vdomHoz.vDomPadLeft)}if(d.offsetLeft<r){this.table.rowManager.element.scrollLeft-=r-d.offsetLeft}else{if(d.offsetLeft+d.offsetWidth>s){this.table.rowManager.element.scrollLeft+=d.offsetLeft+d.offsetWidth-s}}}};x.prototype.edit=function(t,o,l){var s=this,d=!0,p=function(){},c=t.getElement(),u,m,g;if(this.currentCell){if(!this.invalidEdit){this.cancelEdit()}return}function a(o){if(s.currentCell===t){var l=!0;if(t.column.modules.validate&&s.table.modExists("validate")&&"manual"!=s.table.options.validationMode){l=s.table.modules.validate.validate(t.column.modules.validate,t,o)}if(!0===l||"highlight"===s.table.options.validationMode){s.clearEditor();if(!t.modules.edit){t.modules.edit={}}t.modules.edit.edited=!0;if(-1==s.editedCells.indexOf(t)){s.editedCells.push(t)}t.setValue(o,!0);if(s.table.options.dataTree&&s.table.modExists("dataTree")){s.table.modules.dataTree.checkForRestyle(t)}if(!0!==l){c.classList.add("tabulator-validation-fail");s.table.options.validationFailed.call(s.table,t.getComponent(),o,l);return!1}return!0}else{s.invalidEdit=!0;c.classList.add("tabulator-validation-fail");s.focusCellNoEvent(t,!0);p();s.table.options.validationFailed.call(s.table,t.getComponent(),o,l);return!1}}}function n(){if(s.currentCell===t){s.cancelEdit();if(s.table.options.dataTree&&s.table.modExists("dataTree")){s.table.modules.dataTree.checkForRestyle(t)}}}function r(t){p=t}if(!t.column.modules.edit.blocked){if(o){o.stopPropagation()}switch(_typeof(t.column.modules.edit.check)){case"function":d=t.column.modules.edit.check(t.getComponent());break;case"boolean":d=t.column.modules.edit.check;break;}if(d||l){s.cancelEdit();s.currentCell=t;this.focusScrollAdjust(t);m=t.getComponent();if(this.mouseClick){this.mouseClick=!1;if(t.column.cellEvents.cellClick){t.column.cellEvents.cellClick.call(this.table,o,m)}}if(t.column.cellEvents.cellEditing){t.column.cellEvents.cellEditing.call(this.table,m)}s.table.options.cellEditing.call(this.table,m);g="function"==typeof t.column.modules.edit.params?t.column.modules.edit.params(m):t.column.modules.edit.params;u=t.column.modules.edit.editor.call(s,m,r,a,n,g);if(!1!==u){if(u instanceof Node){c.classList.add("tabulator-editing");t.row.getElement().classList.add("tabulator-row-editing");while(c.firstChild){c.removeChild(c.firstChild)}c.appendChild(u);p();for(var h=c.children,b=0;b<h.length;b++){h[b].addEventListener("click",function(t){t.stopPropagation()})}}else{console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",u);c.blur();return!1}}else{c.blur();return!1}return!0}else{this.mouseClick=!1;c.blur();return!1}}else{this.mouseClick=!1;c.blur();return!1}};x.prototype.maskInput=function(t,o){var a=o.mask,n="undefined"!=typeof o.maskLetterChar?o.maskLetterChar:"A",r="undefined"!=typeof o.maskNumberChar?o.maskNumberChar:"9",s="undefined"!=typeof o.maskWildcardChar?o.maskWildcardChar:"*";function l(o){var d=a[o];if("undefined"!=typeof d&&d!==s&&d!==n&&d!==r){t.value=t.value+""+d;l(o+1)}}t.addEventListener("keydown",function(o){var l=t.value.length,d=o.key;if(46<o.keyCode){if(l>=a.length){o.preventDefault();o.stopPropagation();return!1}else{switch(a[l]){case n:if(d.toUpperCase()==d.toLowerCase()){o.preventDefault();o.stopPropagation();return!1}break;case r:if(isNaN(d)){o.preventDefault();o.stopPropagation();return!1}break;case s:break;default:if(d!==a[l]){o.preventDefault();o.stopPropagation();return!1}}}}});t.addEventListener("keyup",function(a){if(46<a.keyCode){if(o.maskAutoFill){l(t.value.length)}}});if(!t.placeholder){t.placeholder=a}if(o.maskAutoFill){l(t.value.length)}};x.prototype.getEditedCells=function(){var t=[];this.editedCells.forEach(function(o){t.push(o.getComponent())});return t};x.prototype.clearEdited=function(t){var o;if(t.modules.edit&&t.modules.edit.edited){t.modules.edit.edited=!1;if(t.modules.validate){t.modules.validate.invalid=!1}}o=this.editedCells.indexOf(t);if(-1<o){this.editedCells.splice(o,1)}};x.prototype.editors={input:function t(o,l,a,n,r){var d=o.getValue(),t=document.createElement("input");t.setAttribute("type",r.search?"search":"text");t.style.padding="4px";t.style.width="100%";t.style.boxSizing="border-box";if(r.elementAttributes&&"object"==_typeof(r.elementAttributes)){for(var p in r.elementAttributes){if("+"==p.charAt(0)){p=p.slice(1);t.setAttribute(p,t.getAttribute(p)+r.elementAttributes["+"+p])}else{t.setAttribute(p,r.elementAttributes[p])}}}t.value="undefined"!=typeof d?d:"";l(function(){t.focus({preventScroll:!0});t.style.height="100%"});function s(){if((null===d||"undefined"==typeof d)&&""!==t.value||t.value!==d){if(a(t.value)){d=t.value}}else{n()}}t.addEventListener("change",s);t.addEventListener("blur",s);t.addEventListener("keydown",function(t){switch(t.keyCode){case 13:s(t);break;case 27:n();break;case 35:case 36:t.stopPropagation();break;}});if(r.mask){this.table.modules.edit.maskInput(t,r)}return t},textarea:function(t,o,l,a,n){var s=this,d=t.getValue(),p=n.verticalNavigation||"hybrid",c=(null!==d&&"undefined"!=typeof d?d:"")+"",u=(c.match(/(?:\r\n|\r|\n)/g)||[]).length+1,m=document.createElement("textarea"),g=0;m.style.display="block";m.style.padding="2px";m.style.height="100%";m.style.width="100%";m.style.boxSizing="border-box";m.style.whiteSpace="pre-wrap";m.style.resize="none";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var h in n.elementAttributes){if("+"==h.charAt(0)){h=h.slice(1);m.setAttribute(h,m.getAttribute(h)+n.elementAttributes["+"+h])}else{m.setAttribute(h,n.elementAttributes[h])}}}m.value=c;o(function(){m.focus({preventScroll:!0});m.style.height="100%";m.scrollHeight;m.style.height=m.scrollHeight+"px";t.getRow().normalizeHeight()});function r(){if((null===d||"undefined"==typeof d)&&""!==m.value||m.value!==d){if(l(m.value)){d=m.value}setTimeout(function(){t.getRow().normalizeHeight()},300)}else{a()}}m.addEventListener("change",r);m.addEventListener("blur",r);m.addEventListener("keyup",function(){m.style.height="";var o=m.scrollHeight;m.style.height=o+"px";if(o!=g){g=o;t.getRow().normalizeHeight()}});m.addEventListener("keydown",function(t){switch(t.keyCode){case 27:a();break;case 38:if("editor"==p||"hybrid"==p&&m.selectionStart){t.stopImmediatePropagation();t.stopPropagation()}break;case 40:if("editor"==p||"hybrid"==p&&m.selectionStart!==m.value.length){t.stopImmediatePropagation();t.stopPropagation()}break;case 35:case 36:t.stopPropagation();break;}});if(n.mask){this.table.modules.edit.maskInput(m,n)}return m},number:function(t,o,l,a,n){var s=t.getValue(),d=n.verticalNavigation||"editor",p=document.createElement("input");p.setAttribute("type","number");if("undefined"!=typeof n.max){p.setAttribute("max",n.max)}if("undefined"!=typeof n.min){p.setAttribute("min",n.min)}if("undefined"!=typeof n.step){p.setAttribute("step",n.step)}p.style.padding="4px";p.style.width="100%";p.style.boxSizing="border-box";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var c in n.elementAttributes){if("+"==c.charAt(0)){c=c.slice(1);p.setAttribute(c,p.getAttribute(c)+n.elementAttributes["+"+c])}else{p.setAttribute(c,n.elementAttributes[c])}}}p.value=s;var u=function(){r()};o(function(){p.removeEventListener("blur",u);p.focus({preventScroll:!0});p.style.height="100%";p.addEventListener("blur",u)});function r(){var t=p.value;if(!isNaN(t)&&""!==t){t=+t}if(t!==s){if(l(t)){s=t}}else{a()}}p.addEventListener("keydown",function(t){switch(t.keyCode){case 13:r();break;case 27:a();break;case 38:case 40:if("editor"==d){t.stopImmediatePropagation();t.stopPropagation()}break;case 35:case 36:t.stopPropagation();break;}});if(n.mask){this.table.modules.edit.maskInput(p,n)}return p},range:function(t,o,l,a,n){var s=t.getValue(),d=document.createElement("input");d.setAttribute("type","range");if("undefined"!=typeof n.max){d.setAttribute("max",n.max)}if("undefined"!=typeof n.min){d.setAttribute("min",n.min)}if("undefined"!=typeof n.step){d.setAttribute("step",n.step)}d.style.padding="4px";d.style.width="100%";d.style.boxSizing="border-box";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var p in n.elementAttributes){if("+"==p.charAt(0)){p=p.slice(1);d.setAttribute(p,d.getAttribute(p)+n.elementAttributes["+"+p])}else{d.setAttribute(p,n.elementAttributes[p])}}}d.value=s;o(function(){d.focus({preventScroll:!0});d.style.height="100%"});function r(){var t=d.value;if(!isNaN(t)&&""!==t){t=+t}if(t!=s){if(l(t)){s=t}}else{a()}}d.addEventListener("blur",function(){r()});d.addEventListener("keydown",function(t){switch(t.keyCode){case 13:r();break;case 27:a();break;}});return d},select:function(t,o,l,a,n){var R=this,M=this,L=t.getElement(),D=t.getValue(),T=n.verticalNavigation||"editor",z="undefined"!=typeof D||null===D?Array.isArray(D)?D:[D]:"undefined"!=typeof n.defaultValue?n.defaultValue:[],H=document.createElement("input"),k=document.createElement("div"),S=n.multiselect,P=[],A={},F=[],_=[],B=!0,I=!1,N="",V=null;if(Array.isArray(n)||!Array.isArray(n)&&"object"===("undefined"==typeof n?"undefined":_typeof(n))&&!n.values){console.warn("DEPRECATION WARNING - values for the select editor must now be passed into the values property of the editorParams object, not as the editorParams object");n={values:n}}function r(o){var l={},a=M.table.getData(),n;if(o){n=M.table.columnManager.getColumnByField(o)}else{n=t.getColumn()._getSelf()}if(n){a.forEach(function(t){var o=n.getFieldValue(t);if(null!==o&&"undefined"!=typeof o&&""!==o){l[o]=!0}})}else{console.warn("unable to find matching column to create select lookup list:",o)}return Object.keys(l)}function s(o,l){var r=[],s=[];function a(t){var t={label:t.label,value:t.value,itemParams:t.itemParams,elementAttributes:t.elementAttributes,element:!1};if(-1<l.indexOf(t.value)){c(t)}r.push(t);s.push(t);return t}if("function"==typeof o){o=o(t)}if(Array.isArray(o)){o.forEach(function(t){var o;if("object"===("undefined"==typeof t?"undefined":_typeof(t))){if(t.options){o={label:t.label,group:!0,itemParams:t.itemParams,elementAttributes:t.elementAttributes,element:!1};s.push(o);t.options.forEach(function(t){a(t)})}else{a(t)}}else{o={label:t,value:t,element:!1};if(-1<l.indexOf(o.value)){c(o)}r.push(o);s.push(o)}})}else{for(var p in o){var u={label:o[p],value:p,element:!1};if(-1<l.indexOf(u.value)){c(u)}r.push(u);s.push(u)}}if(n.sortValuesList){r.sort(function(t,o){return t.label<o.label?-1:t.label>o.label?1:0});s.sort(function(t,o){return t.label<o.label?-1:t.label>o.label?1:0});if("asc"!==n.sortValuesList){r.reverse();s.reverse()}}P=r;F=s;d()}function d(){while(k.firstChild){k.removeChild(k.firstChild)}F.forEach(function(o){var l=o.element;if(!l){l=document.createElement("div");o.label=n.listItemFormatter?n.listItemFormatter(o.value,o.label,t,l,o.itemParams):o.label;if(o.group){l.classList.add("tabulator-edit-select-list-group");l.tabIndex=0;l.innerHTML=""===o.label?"&nbsp;":o.label}else{l.classList.add("tabulator-edit-select-list-item");l.tabIndex=0;l.innerHTML=""===o.label?"&nbsp;":o.label;l.addEventListener("click",function(){I=!0;setTimeout(function(){I=!1},10);if(S){g(o);H.focus()}else{h(o)}});if(-1<_.indexOf(o)){l.classList.add("active")}}if(o.elementAttributes&&"object"==_typeof(o.elementAttributes)){for(var a in o.elementAttributes){if("+"==a.charAt(0)){a=a.slice(1);l.setAttribute(a,H.getAttribute(a)+o.elementAttributes["+"+a])}else{l.setAttribute(a,o.elementAttributes[a])}}}l.addEventListener("mousedown",function(){B=!1;setTimeout(function(){B=!0},10)});o.element=l}k.appendChild(l)})}function p(t,o){if(!S&&A&&A.element){A.element.classList.remove("active")}if(A&&A.element){A.element.classList.remove("focused")}A=t;if(t.element){t.element.classList.add("focused");if(o){t.element.classList.add("active")}}if(t&&t.element&&t.element.scrollIntoView){t.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}}function c(t){var o=_.indexOf(t);if(-1==o){_.push(t);p(t,!0)}f()}function m(t){var o=_[t];if(-1<t){_.splice(t,1);if(o.element){o.element.classList.remove("active")}}}function g(t){if(!t){t=A}var o=_.indexOf(t);if(-1<o){m(o)}else{if(!0!==S&&_.length>=S){m(0)}c(t)}f()}function h(t){E();if(!t){t=A}if(t){H.value=t.label;l(t.value)}z=[t.value]}function b(t){if(!t){E()}var o=[];_.forEach(function(t){o.push(t.value)});z=o;l(o)}function f(){var t=[];_.forEach(function(o){t.push(o.label)});H.value=t.join(", ");if(!1===M.currentCell){b(!0)}}function y(){for(var t=_.length,o=0;o<t;o++){m(0)}}function w(){E();a()}function v(){_=[];if(!k.parentNode){if(!0===n.values){s(r(),z)}else if("string"==typeof n.values){s(r(n.values),z)}else{s(n.values||[],z)}var t=u.prototype.helpers.elOffset(L);k.style.minWidth=L.offsetWidth+"px";k.style.top=t.top+L.offsetHeight+"px";k.style.left=t.left+"px";k.addEventListener("mousedown",function(){B=!1;setTimeout(function(){B=!0},10)});document.body.appendChild(k)}}function E(){if(k.parentNode){k.parentNode.removeChild(k)}C()}function C(){M.table.rowManager.element.removeEventListener("scroll",w)}function x(){clearTimeout(V);var t=String.fromCharCode(event.keyCode).toLowerCase();N+=t.toLowerCase();var o=P.find(function(t){return"undefined"!=typeof t.label&&t.label.toLowerCase().startsWith(N)});if(o){p(o,!S)}V=setTimeout(function(){N=""},800)}H.setAttribute("type","text");H.style.padding="4px";H.style.width="100%";H.style.boxSizing="border-box";H.style.cursor="default";H.readOnly=!1!=this.currentCell;if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var W in n.elementAttributes){if("+"==W.charAt(0)){W=W.slice(1);H.setAttribute(W,H.getAttribute(W)+n.elementAttributes["+"+W])}else{H.setAttribute(W,n.elementAttributes[W])}}}H.value="undefined"!=typeof D||null===D?D:"";H.addEventListener("search",function(){if(!H.value){y();b()}});H.addEventListener("keydown",function(t){var o;switch(t.keyCode){case 38:o=P.indexOf(A);if("editor"==T||"hybrid"==T&&o){t.stopImmediatePropagation();t.stopPropagation();t.preventDefault();if(0<o){p(P[o-1],!S)}}break;case 40:o=P.indexOf(A);if("editor"==T||"hybrid"==T&&o<P.length-1){t.stopImmediatePropagation();t.stopPropagation();t.preventDefault();if(o<P.length-1){if(-1==o){p(P[0],!S)}else{p(P[o+1],!S)}}}break;case 37:case 39:t.stopImmediatePropagation();t.stopPropagation();t.preventDefault();break;case 13:if(S){g()}else{h()}break;case 27:w();break;case 9:break;default:if(!1===M.currentCell){t.preventDefault()}if(38<=t.keyCode&&90>=t.keyCode){x(t.keyCode)}}});H.addEventListener("blur",function(){if(B){if(S){b()}else{w()}}});H.addEventListener("focus",function(){if(!I){v()}});k=document.createElement("div");k.classList.add("tabulator-edit-select-list");o(function(){H.style.height="100%";H.focus({preventScroll:!0})});setTimeout(function(){R.table.rowManager.element.addEventListener("scroll",w)},10);return H},autocomplete:function(t,o,l,a,n){var C=this,x=this,R=t.getElement(),M=t.getValue(),L=n.verticalNavigation||"editor",D="undefined"!=typeof M||null===M?M:"undefined"!=typeof n.defaultValue?n.defaultValue:"",T=document.createElement("input"),z=document.createElement("div"),H=[],k=!1,S=!0,P=!1;T.setAttribute("type","search");T.style.padding="4px";T.style.width="100%";T.style.boxSizing="border-box";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var A in n.elementAttributes){if("+"==A.charAt(0)){A=A.slice(1);T.setAttribute(A,T.getAttribute(A)+n.elementAttributes["+"+A])}else{T.setAttribute(A,n.elementAttributes[A])}}}z.classList.add("tabulator-edit-select-list");z.addEventListener("mousedown",function(){S=!1;setTimeout(function(){S=!0},10)});function r(){if(!0===n.values){P=s()}else if("string"==typeof n.values){P=s(n.values)}}function s(o){var l={},a=x.table.getData(),r;if(o){r=x.table.columnManager.getColumnByField(o)}else{r=t.getColumn()._getSelf()}if(r){a.forEach(function(t){var o=r.getFieldValue(t);if(null!==o&&"undefined"!=typeof o&&""!==o){l[o]=!0}});if(n.sortValuesList){if("asc"==n.sortValuesList){l=Object.keys(l).sort()}else{l=Object.keys(l).sort().reverse()}}else{l=Object.keys(l)}}else{console.warn("unable to find matching column to create autocomplete lookup list:",o)}return l}function d(t,o){var l=[],a,r;if(P){a=P}else{a=n.values||[]}if(n.searchFunc){l=n.searchFunc(t,a);if(l instanceof Promise){p("undefined"!=typeof n.searchingPlaceholder?n.searchingPlaceholder:"Searching...");l.then(function(t){g(c(t),o)}).catch(function(t){console.err("error in autocomplete search promise:",t)})}else{g(c(l),o)}}else{r=c(a);if(""===t){if(n.showListOnEmpty){l=r}}else{r.forEach(function(o){if(null!==o.value||"undefined"!=typeof o.value){if(-1<(o.value+"").toLowerCase().indexOf((t+"").toLowerCase())||-1<(o.title+"").toLowerCase().indexOf((t+"").toLowerCase())){l.push(o)}}})}g(l,o)}}function p(t){var o=document.createElement("div");m();if(!1!==t){o.classList.add("tabulator-edit-select-list-notice");o.tabIndex=0;if(t instanceof Node){o.appendChild(t)}else{o.innerHTML=t}z.appendChild(o)}}function c(t){var o=[];if(Array.isArray(t)){t.forEach(function(t){var l={};if("object"===("undefined"==typeof t?"undefined":_typeof(t))){l.title=n.listItemFormatter?n.listItemFormatter(t.value,t.label):t.label;l.value=t.value}else{l.title=n.listItemFormatter?n.listItemFormatter(t,t):t;l.value=t}o.push(l)})}else{for(var l in t){var a={title:n.listItemFormatter?n.listItemFormatter(l,t[l]):t[l],value:l};o.push(a)}}return o}function m(){while(z.firstChild){z.removeChild(z.firstChild)}}function g(t,o){if(t.length){h(t,o)}else{if(n.emptyPlaceholder){p(n.emptyPlaceholder)}}}function h(t,o){var l=!1;m();H=t;H.forEach(function(t){var a=t.element;if(!a){a=document.createElement("div");a.classList.add("tabulator-edit-select-list-item");a.tabIndex=0;a.innerHTML=t.title;a.addEventListener("click",function(){y(t);b()});a.addEventListener("mousedown",function(){S=!1;setTimeout(function(){S=!0},10)});t.element=a;if(o&&t.value==M){T.value=t.title;t.element.classList.add("active");l=!0}if(t===k){t.element.classList.add("active");l=!0}}z.appendChild(a)});if(!l){y(!1)}}function b(){w();if(k){if(M!==k.value){M=k.value;T.value=k.title;l(k.value)}else{a()}}else{if(n.freetext){M=T.value;l(T.value)}else{if(n.allowEmpty&&""===T.value){M=T.value;l(T.value)}else{a()}}}}function f(){if(!z.parentNode){console.log("show",D);while(z.firstChild){z.removeChild(z.firstChild)}var t=u.prototype.helpers.elOffset(R);z.style.minWidth=R.offsetWidth+"px";z.style.top=t.top+R.offsetHeight+"px";z.style.left=t.left+"px";document.body.appendChild(z)}}function y(t){if(k&&k.element){k.element.classList.remove("active")}k=t;if(t&&t.element){t.element.classList.add("active")}if(t&&t.element&&t.element.scrollIntoView){t.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}}function w(){if(z.parentNode){z.parentNode.removeChild(z)}E()}function v(){w();a()}function E(){x.table.rowManager.element.removeEventListener("scroll",v)}T.addEventListener("keydown",function(t){var o;switch(t.keyCode){case 38:o=H.indexOf(k);if("editor"==L||"hybrid"==L&&o){t.stopImmediatePropagation();t.stopPropagation();t.preventDefault();if(0<o){y(H[o-1])}else{y(!1)}}break;case 40:o=H.indexOf(k);if("editor"==L||"hybrid"==L&&o<H.length-1){t.stopImmediatePropagation();t.stopPropagation();t.preventDefault();if(o<H.length-1){if(-1==o){y(H[0])}else{y(H[o+1])}}}break;case 37:case 39:t.stopImmediatePropagation();t.stopPropagation();break;case 13:b();break;case 27:v();break;case 36:case 35:t.stopImmediatePropagation();break;}});T.addEventListener("keyup",function(t){switch(t.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:d(T.value);}});T.addEventListener("search",function(){d(T.value)});T.addEventListener("blur",function(){if(S){b()}});T.addEventListener("focus",function(){var t=D;r();f();T.value=t;d(t,!0)});o(function(){T.style.height="100%";T.focus({preventScroll:!0})});if(n.mask){this.table.modules.edit.maskInput(T,n)}setTimeout(function(){C.table.rowManager.element.addEventListener("scroll",v)},10);r();T.value=D;d(D,!0);return T},star:function t(o,l,a,n,r){var c=this,u=o.getElement(),m=o.getValue(),g=u.getElementsByTagName("svg").length||5,h=u.getElementsByTagName("svg")[0]?u.getElementsByTagName("svg")[0].getAttribute("width"):14,b=[],f=document.createElement("div"),t=document.createElementNS("http://www.w3.org/2000/svg","svg");function s(t){b.forEach(function(o,l){if(l<t){if("ie"==c.table.browser){o.setAttribute("class","tabulator-star-active")}else{o.classList.replace("tabulator-star-inactive","tabulator-star-active")}o.innerHTML="<polygon fill=\"#488CE9\" stroke=\"#014AAE\" stroke-width=\"37.6152\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"10\" points=\"259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 \"/>"}else{if("ie"==c.table.browser){o.setAttribute("class","tabulator-star-inactive")}else{o.classList.replace("tabulator-star-active","tabulator-star-inactive")}o.innerHTML="<polygon fill=\"#010155\" stroke=\"#686868\" stroke-width=\"37.6152\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"10\" points=\"259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 \"/>"}})}function d(o){var l=document.createElement("span"),n=t.cloneNode(!0);b.push(n);l.addEventListener("mouseenter",function(t){t.stopPropagation();t.stopImmediatePropagation();s(o)});l.addEventListener("mousemove",function(t){t.stopPropagation();t.stopImmediatePropagation()});l.addEventListener("click",function(t){t.stopPropagation();t.stopImmediatePropagation();a(o);u.blur()});l.appendChild(n);f.appendChild(l)}function p(t){m=t;s(t)}u.style.whiteSpace="nowrap";u.style.overflow="hidden";u.style.textOverflow="ellipsis";f.style.verticalAlign="middle";f.style.display="inline-block";f.style.padding="4px";t.setAttribute("width",h);t.setAttribute("height",h);t.setAttribute("viewBox","0 0 512 512");t.setAttribute("xml:space","preserve");t.style.padding="0 1px";if(r.elementAttributes&&"object"==_typeof(r.elementAttributes)){for(var y in r.elementAttributes){if("+"==y.charAt(0)){y=y.slice(1);f.setAttribute(y,f.getAttribute(y)+r.elementAttributes["+"+y])}else{f.setAttribute(y,r.elementAttributes[y])}}}for(var w=1;w<=g;w++){d(w)}m=Math.min(parseInt(m),g);s(m);f.addEventListener("mousemove",function(){s(0)});f.addEventListener("click",function(){a(0)});u.addEventListener("blur",function(){n()});u.addEventListener("keydown",function(t){switch(t.keyCode){case 39:p(m+1);break;case 37:p(m-1);break;case 13:a(m);break;case 27:n();break;}});return f},progress:function(t,o,l,a,n){var s=t.getElement(),d="undefined"==typeof n.max?s.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,p="undefined"==typeof n.min?s.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,c=(d-p)/100,u=t.getValue()||0,m=document.createElement("div"),g=document.createElement("div"),h,b;function r(){var t=window.getComputedStyle(s,null),o=c*Math.round(g.offsetWidth/((s.clientWidth-parseInt(t.getPropertyValue("padding-left"))-parseInt(t.getPropertyValue("padding-right")))/100))+p;l(o);s.setAttribute("aria-valuenow",o);s.setAttribute("aria-label",u)}m.style.position="absolute";m.style.right="0";m.style.top="0";m.style.bottom="0";m.style.width="5px";m.classList.add("tabulator-progress-handle");g.style.display="inline-block";g.style.position="relative";g.style.height="100%";g.style.backgroundColor="#488CE9";g.style.maxWidth="100%";g.style.minWidth="0%";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var f in n.elementAttributes){if("+"==f.charAt(0)){f=f.slice(1);g.setAttribute(f,g.getAttribute(f)+n.elementAttributes["+"+f])}else{g.setAttribute(f,n.elementAttributes[f])}}}s.style.padding="4px 4px";u=Math.min(parseFloat(u),d);u=Math.max(parseFloat(u),p);u=Math.round((u-p)/c);g.style.width=u+"%";s.setAttribute("aria-valuemin",p);s.setAttribute("aria-valuemax",d);g.appendChild(m);m.addEventListener("mousedown",function(t){h=t.screenX;b=g.offsetWidth});m.addEventListener("mouseover",function(){m.style.cursor="ew-resize"});s.addEventListener("mousemove",function(t){if(h){g.style.width=b+t.screenX-h+"px"}});s.addEventListener("mouseup",function(t){if(h){t.stopPropagation();t.stopImmediatePropagation();h=!1;b=!1;r()}});s.addEventListener("keydown",function(t){switch(t.keyCode){case 39:t.preventDefault();g.style.width=g.clientWidth+s.clientWidth/100+"px";break;case 37:t.preventDefault();g.style.width=g.clientWidth-s.clientWidth/100+"px";break;case 9:case 13:r();break;case 27:a();break;}});s.addEventListener("blur",function(){a()});return g},tickCross:function(t,o,l,a,n){var s=t.getValue(),d=document.createElement("input"),p=n.tristate,c="undefined"==typeof n.indeterminateValue?null:n.indeterminateValue,u=!1;d.setAttribute("type","checkbox");d.style.marginTop="5px";d.style.boxSizing="border-box";if(n.elementAttributes&&"object"==_typeof(n.elementAttributes)){for(var m in n.elementAttributes){if("+"==m.charAt(0)){m=m.slice(1);d.setAttribute(m,d.getAttribute(m)+n.elementAttributes["+"+m])}else{d.setAttribute(m,n.elementAttributes[m])}}}d.value=s;if(p&&("undefined"==typeof s||s===c||""===s)){u=!0;d.indeterminate=!0}if("firefox"!=this.table.browser){o(function(){d.focus({preventScroll:!0})})}d.checked=!0===s||"true"===s||"True"===s||1===s;o(function(){d.focus()});function r(t){if(p){if(!t){if(d.checked&&!u){d.checked=!1;d.indeterminate=!0;u=!0;return c}else{u=!1;return d.checked}}else{if(u){return c}else{return d.checked}}}else{return d.checked}}d.addEventListener("change",function(){l(r())});d.addEventListener("blur",function(){l(r(!0))});d.addEventListener("keydown",function(t){if(13==t.keyCode){l(r())}if(27==t.keyCode){a()}});return d}};u.prototype.registerModule("edit",x);var R=function(t,o,l,a){this.type=t;this.columns=o;this.component=l||!1;this.indent=a||0},M=function(t,o,l,a,n){this.value=t;this.component=o||!1;this.width=l;this.height=a;this.depth=n},L=function(t){this.table=t;this.config={};this.cloneTableStyle=!0;this.colVisProp=""};L.prototype.generateExportList=function(t,o,l,a){this.cloneTableStyle=o;this.config=t||{};this.colVisProp=a;var n=!1!==this.config.columnHeaders?this.headersToExportRows(this.generateColumnGroupHeaders()):[],r=this.bodyToExportRows(this.rowLookup(l));return n.concat(r)};L.prototype.genereateTable=function(t,o,l,a){var n=this.generateExportList(t,o,l,a);return this.genereateTableElement(n)};L.prototype.rowLookup=function(t){var o=this,l=[];if("function"==typeof t){t.call(this.table).forEach(function(t){t=o.table.rowManager.findRow(t);if(t){l.push(t)}})}else{switch(t){case!0:case"visible":l=this.table.rowManager.getVisibleRows(!0);break;case"all":l=this.table.rowManager.rows;break;case"selected":l=this.table.modules.selectRow.selectedRows;break;case"active":default:if(this.table.options.pagination){l=this.table.rowManager.getDisplayRows(this.table.rowManager.displayRows.length-2)}else{l=this.table.rowManager.getDisplayRows()}}}return Object.assign([],l)};L.prototype.generateColumnGroupHeaders=function(){var t=this,o=[],l=!1!==this.config.columnGroups?this.table.columnManager.columns:this.table.columnManager.columnsByIndex;l.forEach(function(l){var a=t.processColumnGroup(l);if(a){o.push(a)}});return o};L.prototype.processColumnGroup=function(t){var o=this,l=t.columns,a=0,n=t.definition["title"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))]||t.definition.title,r={title:n,column:t,depth:1};if(l.length){r.subGroups=[];r.width=0;l.forEach(function(t){var l=o.processColumnGroup(t);if(l){r.width+=l.width;r.subGroups.push(l);if(l.depth>a){a=l.depth}}});r.depth+=a;if(!r.width){return!1}}else{if(this.columnVisCheck(t)){r.width=1}else{return!1}}return r};L.prototype.columnVisCheck=function(t){return!1!==t.definition[this.colVisProp]&&(t.visible||!t.visible&&t.definition[this.colVisProp])};L.prototype.headersToExportRows=function(t){var l=[],a=0,n=[];function o(t,n){var r=a-n;if("undefined"==typeof l[n]){l[n]=[]}t.height=t.subGroups?1:r-t.depth+1;l[n].push(t);if(1<t.height){for(var s=1;s<t.height;s++){if("undefined"==typeof l[n+s]){l[n+s]=[]}l[n+s].push(!1)}}if(1<t.width){for(var d=1;d<t.width;d++){l[n].push(!1)}}if(t.subGroups){t.subGroups.forEach(function(t){o(t,n+1)})}}t.forEach(function(t){if(t.depth>a){a=t.depth}});t.forEach(function(t){o(t,0)});l.forEach(function(t){var o=[];t.forEach(function(t){if(t){o.push(new M(t.title,t.column.getComponent(),t.width,t.height,t.depth))}else{o.push(null)}});n.push(new R("header",o))});return n};L.prototype.bodyToExportRows=function(t){var o=this,l=[],a=[];this.table.columnManager.columnsByIndex.forEach(function(t){if(o.columnVisCheck(t)){l.push(t.getComponent())}});if(!1!==this.config.columnCalcs&&this.table.modExists("columnCalcs")){if(this.table.modules.columnCalcs.topInitialized){t.unshift(this.table.modules.columnCalcs.topRow)}if(this.table.modules.columnCalcs.botInitialized){t.push(this.table.modules.columnCalcs.botRow)}}t=t.filter(function(t){switch(t.type){case"group":return!1!==o.config.rowGroups;break;case"calc":return!1!==o.config.columnCalcs;break;case"row":return!(o.table.options.dataTree&&!1===o.config.dataTree&&t.modules.dataTree.parent);break;}return!0});t.forEach(function(t){var n=t.getData(o.colVisProp),r=[],s=0;switch(t.type){case"group":s=t.level;r.push(new M(t.key,t.getComponent(),l.length,1));break;case"calc":case"row":l.forEach(function(t){r.push(new M(t._column.getFieldValue(n),t,1,1))});if(o.table.options.dataTree&&!1!==o.config.dataTree){s=t.modules.dataTree.index}break;}a.push(new R(t.type,r,t.getComponent(),s))});return a};L.prototype.genereateTableElement=function(t){var o=this,l=document.createElement("table"),a=document.createElement("thead"),n=document.createElement("tbody"),r=this.lookupTableStyles(),s=this.table.options["rowFormatter"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],d={};d.rowFormatter=null!==s?s:this.table.options.rowFormatter;if(this.table.options.dataTree&&!1!==this.config.dataTree&&this.table.modExists("columnCalcs")){d.treeElementField=this.table.modules.dataTree.elementField}d.groupHeader=this.table.options["groupHeader"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))];if(d.groupHeader&&!Array.isArray(d.groupHeader)){d.groupHeader=[d.groupHeader]}l.classList.add("tabulator-print-table");this.mapElementStyles(this.table.columnManager.getHeadersElement(),a,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]);if(1e3<t.length){console.warn("It may take a long time to render an HTML table with more than 1000 rows")}t.forEach(function(t,l){switch(t.type){case"header":a.appendChild(o.genereateHeaderElement(t,d,r));break;case"group":n.appendChild(o.genereateGroupElement(t,d,r));break;case"calc":n.appendChild(o.genereateCalcElement(t,d,r));break;case"row":var s=o.genereateRowElement(t,d,r);o.mapElementStyles(l%2&&r.evenRow?r.evenRow:r.oddRow,s,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]);n.appendChild(s);break;}});if(a.innerHTML){l.appendChild(a)}l.appendChild(n);this.mapElementStyles(this.table.element,l,["border-top","border-left","border-right","border-bottom"]);return l};L.prototype.lookupTableStyles=function(){var t={};if(this.cloneTableStyle&&window.getComputedStyle){t.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)");t.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)");t.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs");t.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)");t.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0];if(t.firstRow){t.styleCells=t.firstRow.getElementsByClassName("tabulator-cell");t.firstCell=t.styleCells[0];t.lastCell=t.styleCells[t.styleCells.length-1]}}return t};L.prototype.genereateHeaderElement=function(t){var o=this,l=document.createElement("tr");t.columns.forEach(function(t){if(t){var a=document.createElement("th"),n=t.component._column.definition.cssClass?t.component._column.definition.cssClass.split(" "):[];a.colSpan=t.width;a.rowSpan=t.height;a.innerHTML=t.value;if(o.cloneTableStyle){a.style.boxSizing="border-box"}n.forEach(function(t){a.classList.add(t)});o.mapElementStyles(t.component.getElement(),a,["text-align","border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]);o.mapElementStyles(t.component._column.contentElement,a,["padding-top","padding-left","padding-right","padding-bottom"]);if(t.component._column.visible){o.mapElementStyles(t.component.getElement(),a,["width"])}else{if(t.component._column.definition.width){a.style.width=t.component._column.definition.width+"px"}}if(t.component._column.parent){o.mapElementStyles(t.component._column.parent.groupElement,a,["border-top"])}l.appendChild(a)}});return l};L.prototype.genereateGroupElement=function(t,o,l){var a=document.createElement("tr"),n=document.createElement("td"),r=t.columns[0];a.classList.add("tabulator-print-table-row");if(o.groupHeader&&o.groupHeader[t.indent]){r.value=o.groupHeader[t.indent](r.value,t.component._group.getRowCount(),t.component._group.getData(),t.component)}else{if(!1===o.groupHeader){r.value=r.value}else{r.value=t.component._group.generator(r.value,t.component._group.getRowCount(),t.component._group.getData(),t.component)}}n.colSpan=r.width;n.innerHTML=r.value;a.classList.add("tabulator-print-table-group");a.classList.add("tabulator-group-level-"+t.indent);if(r.component.isVisible()){a.classList.add("tabulator-group-visible")}this.mapElementStyles(l.firstGroup,a,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]);this.mapElementStyles(l.firstGroup,n,["padding-top","padding-left","padding-right","padding-bottom"]);a.appendChild(n);return a};L.prototype.genereateCalcElement=function(t,o,l){var a=this.genereateRowElement(t,o,l);a.classList.add("tabulator-print-table-calcs");this.mapElementStyles(l.calcRow,a,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]);return a};L.prototype.genereateRowElement=function(t,o,l){var a=this,n=document.createElement("tr");n.classList.add("tabulator-print-table-row");t.columns.forEach(function(r){if(r){var s=document.createElement("td"),d=r.component._column,p=r.value,c={modules:{},getValue:function(){return p},getField:function(){return d.definition.field},getElement:function(){return s},getColumn:function(){return d.getComponent()},getData:function(){return t.component.getData()},getRow:function(){return t.component},getComponent:function(){return c},column:d},u=d.definition.cssClass?d.definition.cssClass.split(" "):[];u.forEach(function(t){s.classList.add(t)});if(a.table.modExists("format")&&!1!==a.config.formatCells){p=a.table.modules.format.formatExportValue(c,a.colVisProp)}else{switch("undefined"==typeof p?"undefined":_typeof(p)){case"object":p=JSON.stringify(p);break;case"undefined":case"null":p="";break;default:p=p;}}if(p instanceof Node){s.appendChild(p)}else{s.innerHTML=p}if(l.firstCell){a.mapElementStyles(l.firstCell,s,["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size"]);if(d.definition.align){s.style.textAlign=d.definition.align}}if(a.table.options.dataTree&&!1!==a.config.dataTree){if(o.treeElementField&&o.treeElementField==d.field||!o.treeElementField&&0==i){if(t.component._row.modules.dataTree.controlEl){s.insertBefore(t.component._row.modules.dataTree.controlEl.cloneNode(!0),s.firstChild)}if(t.component._row.modules.dataTree.branchEl){s.insertBefore(t.component._row.modules.dataTree.branchEl.cloneNode(!0),s.firstChild)}}}n.appendChild(s);if(c.modules.format&&c.modules.format.renderedCallback){c.modules.format.renderedCallback()}if(o.rowFormatter&&!1!==a.config.formatCells){o.rowFormatter(t.component)}}});return n};L.prototype.genereateHTMLTable=function(t){var o=document.createElement("div");o.appendChild(this.genereateTableElement(t));return o.innerHTML};L.prototype.getHtml=function(t,o,l,a){var n=this.generateExportList(l||this.table.options.htmlOutputConfig,o,t,a||"htmlOutput");return this.genereateHTMLTable(n)};L.prototype.mapElementStyles=function(t,o,l){if(this.cloneTableStyle&&t&&o){var a={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var n=window.getComputedStyle(t);l.forEach(function(t){o.style[a[t]]=n.getPropertyValue(t)})}}};u.prototype.registerModule("export",L);var D=function(t){this.table=t;this.filterList=[];this.headerFilters={};this.headerFilterColumns=[];this.prevHeaderFilterChangeCheck="";this.prevHeaderFilterChangeCheck="{}";this.changed=!1};D.prototype.initializeColumn=function(t){var o=this,l=t.getField(),a;t.modules.filter={success:function(n){var r="input"==t.modules.filter.tagType&&"text"==t.modules.filter.attrType||"textarea"==t.modules.filter.tagType?"partial":"match",s="",d="",p;if("undefined"==typeof t.modules.filter.prevSuccess||t.modules.filter.prevSuccess!==n){t.modules.filter.prevSuccess=n;if(!t.modules.filter.emptyFunc(n)){t.modules.filter.value=n;switch(_typeof(t.definition.headerFilterFunc)){case"string":if(o.filters[t.definition.headerFilterFunc]){s=t.definition.headerFilterFunc;p=function(l){var a=t.definition.headerFilterFuncParams||{},r=t.getFieldValue(l);a="function"==typeof a?a(n,r,l):a;return o.filters[t.definition.headerFilterFunc](n,r,l,a)}}else{console.warn("Header Filter Error - Matching filter function not found: ",t.definition.headerFilterFunc)}break;case"function":p=function(o){var l=t.definition.headerFilterFuncParams||{},a=t.getFieldValue(o);l="function"==typeof l?l(n,a,o):l;return t.definition.headerFilterFunc(n,a,o,l)};s=p;break;}if(!p){switch(r){case"partial":p=function(o){var l=t.getFieldValue(o);if("undefined"!=typeof l&&null!==l){return-1<(l+"").toLowerCase().indexOf((n+"").toLowerCase())}else{return!1}};s="like";break;default:p=function(o){return t.getFieldValue(o)==n};s="=";}}o.headerFilters[l]={value:n,func:p,type:s,params:a||{}}}else{delete o.headerFilters[l]}d=JSON.stringify(o.headerFilters);if(o.prevHeaderFilterChangeCheck!==d){o.prevHeaderFilterChangeCheck=d;o.changed=!0;o.table.rowManager.filterRefresh()}}return!0},attrType:!1,tagType:!1,emptyFunc:!1};this.generateHeaderFilterElement(t)};D.prototype.generateHeaderFilterElement=function(t,o,l){var n=this,r=this,s=t.modules.filter.success,d=t.getField(),p,c,u,m,g,h,b;function a(){}if(t.modules.filter.headerElement&&t.modules.filter.headerElement.parentNode){t.contentElement.removeChild(t.modules.filter.headerElement.parentNode)}if(d){t.modules.filter.emptyFunc=t.definition.headerFilterEmptyCheck||function(t){return!t&&"0"!==t&&0!==t};p=document.createElement("div");p.classList.add("tabulator-header-filter");switch(_typeof(t.definition.headerFilter)){case"string":if(r.table.modules.edit.editors[t.definition.headerFilter]){c=r.table.modules.edit.editors[t.definition.headerFilter];if(("tick"===t.definition.headerFilter||"tickCross"===t.definition.headerFilter)&&!t.definition.headerFilterEmptyCheck){t.modules.filter.emptyFunc=function(t){return!0!==t&&!1!==t}}}else{console.warn("Filter Error - Cannot build header filter, No such editor found: ",t.definition.editor)}break;case"function":c=t.definition.headerFilter;break;case"boolean":if(t.modules.edit&&t.modules.edit.editor){c=t.modules.edit.editor}else{if(t.definition.formatter&&r.table.modules.edit.editors[t.definition.formatter]){c=r.table.modules.edit.editors[t.definition.formatter];if(("tick"===t.definition.formatter||"tickCross"===t.definition.formatter)&&!t.definition.headerFilterEmptyCheck){t.modules.filter.emptyFunc=function(t){return!0!==t&&!1!==t}}}else{c=r.table.modules.edit.editors.input}}break;}if(c){m={getValue:function(){return"undefined"!=typeof o?o:""},getField:function(){return t.definition.field},getElement:function(){return p},getColumn:function(){return t.getComponent()},getRow:function(){return{normalizeHeight:function(){}}}};b=t.definition.headerFilterParams||{};b="function"==typeof b?b.call(r.table):b;u=c.call(this.table.modules.edit,m,function(){},s,a,b);if(!u){console.warn("Filter Error - Cannot add filter to "+d+" column, editor returned a value of false");return}if(!(u instanceof Node)){console.warn("Filter Error - Cannot add filter to "+d+" column, editor should return an instance of Node, the editor returned:",u);return}if(d){r.table.modules.localize.bind("headerFilters|columns|"+t.definition.field,function(t){u.setAttribute("placeholder","undefined"!=typeof t&&t?t:r.table.modules.localize.getText("headerFilters|default"))})}else{r.table.modules.localize.bind("headerFilters|default",function(t){u.setAttribute("placeholder","undefined"!=typeof r.column.definition.headerFilterPlaceholder&&r.column.definition.headerFilterPlaceholder?r.column.definition.headerFilterPlaceholder:t)})}u.addEventListener("click",function(t){t.stopPropagation();u.focus()});u.addEventListener("focus",function(){var t=n.table.columnManager.element.scrollLeft;if(t!==n.table.rowManager.element.scrollLeft){n.table.rowManager.scrollHorizontal(t);n.table.columnManager.scrollHorizontal(t)}});g=!1;h=function(){if(g){clearTimeout(g)}g=setTimeout(function(){s(u.value)},r.table.options.headerFilterLiveFilterDelay)};t.modules.filter.headerElement=u;t.modules.filter.attrType=u.hasAttribute("type")?u.getAttribute("type").toLowerCase():"";t.modules.filter.tagType=u.tagName.toLowerCase();if(!1!==t.definition.headerFilterLiveFilter){if(!("autocomplete"===t.definition.headerFilter||"tickCross"===t.definition.headerFilter||("autocomplete"===t.definition.editor||"tickCross"===t.definition.editor)&&!0===t.definition.headerFilter)){u.addEventListener("keyup",h);u.addEventListener("search",h);if("number"==t.modules.filter.attrType){u.addEventListener("change",function(){s(u.value)})}if("text"==t.modules.filter.attrType&&"ie"!==this.table.browser){u.setAttribute("type","search")}}if("input"==t.modules.filter.tagType||"select"==t.modules.filter.tagType||"textarea"==t.modules.filter.tagType){u.addEventListener("mousedown",function(t){t.stopPropagation()})}}p.appendChild(u);t.contentElement.appendChild(p);if(!l){r.headerFilterColumns.push(t)}}}else{console.warn("Filter Error - Cannot add header filter, column has no field set:",t.definition.title)}};D.prototype.hideHeaderFilterElements=function(){this.headerFilterColumns.forEach(function(t){if(t.modules.filter&&t.modules.filter.headerElement){t.modules.filter.headerElement.style.display="none"}})};D.prototype.showHeaderFilterElements=function(){this.headerFilterColumns.forEach(function(t){if(t.modules.filter&&t.modules.filter.headerElement){t.modules.filter.headerElement.style.display=""}})};D.prototype.setHeaderFilterFocus=function(t){if(t.modules.filter&&t.modules.filter.headerElement){t.modules.filter.headerElement.focus()}else{console.warn("Column Filter Focus Error - No header filter set on column:",t.getField())}};D.prototype.getHeaderFilterValue=function(t){if(t.modules.filter&&t.modules.filter.headerElement){return t.modules.filter.headerElement.value}else{console.warn("Column Filter Error - No header filter set on column:",t.getField())}};D.prototype.setHeaderFilterValue=function(t,o){if(t){if(t.modules.filter&&t.modules.filter.headerElement){this.generateHeaderFilterElement(t,o,!0);t.modules.filter.success(o)}else{console.warn("Column Filter Error - No header filter set on column:",t.getField())}}};D.prototype.reloadHeaderFilter=function(t){if(t){if(t.modules.filter&&t.modules.filter.headerElement){this.generateHeaderFilterElement(t,t.modules.filter.value,!0)}else{console.warn("Column Filter Error - No header filter set on column:",t.getField())}}};D.prototype.hasChanged=function(){var t=this.changed;this.changed=!1;return t};D.prototype.setFilter=function(t,o,l,a){var n=this;n.filterList=[];if(!Array.isArray(t)){t=[{field:t,type:o,value:l,params:a}]}n.addFilter(t)};D.prototype.addFilter=function(t,o,l,a){var n=this;if(!Array.isArray(t)){t=[{field:t,type:o,value:l,params:a}]}t.forEach(function(t){t=n.findFilter(t);if(t){n.filterList.push(t);n.changed=!0}});if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.filter){this.table.modules.persistence.save("filter")}};D.prototype.findFilter=function(t){var o=this,l;if(Array.isArray(t)){return this.findSubFilters(t)}var a=!1;if("function"==typeof t.field){a=function(o){return t.field(o,t.type||{})}}else{if(o.filters[t.type]){l=o.table.columnManager.getColumnByField(t.field);if(l){a=function(a){return o.filters[t.type](t.value,l.getFieldValue(a),a,t.params||{})}}else{a=function(l){return o.filters[t.type](t.value,l[t.field],l,t.params||{})}}}else{console.warn("Filter Error - No such filter type found, ignoring: ",t.type)}}t.func=a;return t.func?t:!1};D.prototype.findSubFilters=function(t){var o=this,l=[];t.forEach(function(t){t=o.findFilter(t);if(t){l.push(t)}});return l.length?l:!1};D.prototype.getFilters=function(t,o){var l=[];if(t){l=this.getHeaderFilters()}if(o){l.forEach(function(t){if("function"==typeof t.type){t.type="function"}})}l=l.concat(this.filtersToArray(this.filterList,o));return l};D.prototype.filtersToArray=function(t,o){var l=this,a=[];t.forEach(function(t){var n;if(Array.isArray(t)){a.push(l.filtersToArray(t,o))}else{n={field:t.field,type:t.type,value:t.value};if(o){if("function"==typeof n.type){n.type="function"}}a.push(n)}});return a};D.prototype.getHeaderFilters=function(){var t=this,o=[];for(var l in this.headerFilters){o.push({field:l,type:this.headerFilters[l].type,value:this.headerFilters[l].value})}return o};D.prototype.removeFilter=function(t,o,l){var a=this;if(!Array.isArray(t)){t=[{field:t,type:o,value:l}]}t.forEach(function(t){var o=-1;if("object"==_typeof(t.field)){o=a.filterList.findIndex(function(o){return t===o})}else{o=a.filterList.findIndex(function(o){return t.field===o.field&&t.type===o.type&&t.value===o.value})}if(-1<o){a.filterList.splice(o,1);a.changed=!0}else{console.warn("Filter Error - No matching filter type found, ignoring: ",t.type)}});if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.filter){this.table.modules.persistence.save("filter")}};D.prototype.clearFilter=function(t){this.filterList=[];if(t){this.clearHeaderFilter()}this.changed=!0;if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.filter){this.table.modules.persistence.save("filter")}};D.prototype.clearHeaderFilter=function(){var t=this;this.headerFilters={};t.prevHeaderFilterChangeCheck="{}";this.headerFilterColumns.forEach(function(o){if("undefined"!=typeof o.modules.filter.value){delete o.modules.filter.value}o.modules.filter.prevSuccess=void 0;t.reloadHeaderFilter(o)});this.changed=!0};D.prototype.search=function(t,o,l,a){var n=this,r=[],s=[];if(!Array.isArray(o)){o=[{field:o,type:l,value:a}]}o.forEach(function(t){t=n.findFilter(t);if(t){s.push(t)}});this.table.rowManager.rows.forEach(function(o){var l=!0;s.forEach(function(t){if(!n.filterRecurse(t,o.getData())){l=!1}});if(l){r.push("data"===t?o.getData("data"):o.getComponent())}});return r};D.prototype.filter=function(t){var o=this,l=[],a=[];if(o.table.options.dataFiltering){o.table.options.dataFiltering.call(o.table,o.getFilters())}if(!o.table.options.ajaxFiltering&&(o.filterList.length||Object.keys(o.headerFilters).length)){t.forEach(function(t){if(o.filterRow(t)){l.push(t)}})}else{l=t.slice(0)}if(o.table.options.dataFiltered){l.forEach(function(t){a.push(t.getComponent())});o.table.options.dataFiltered.call(o.table,o.getFilters(),a)}return l};D.prototype.filterRow=function(t){var o=this,l=!0,a=t.getData();o.filterList.forEach(function(t){if(!o.filterRecurse(t,a)){l=!1}});for(var n in o.headerFilters){if(!o.headerFilters[n].func(a)){l=!1}}return l};D.prototype.filterRecurse=function(t,o){var l=this,a=!1;if(Array.isArray(t)){t.forEach(function(t){if(l.filterRecurse(t,o)){a=!0}})}else{a=t.func(o)}return a};D.prototype.filters={"=":function(t,o){return o==t?!0:!1},"<":function(t,o){return o<t?!0:!1},"<=":function(t,o){return o<=t?!0:!1},">":function(t,o){return o>t?!0:!1},">=":function(t,o){return o>=t?!0:!1},"!=":function(t,o){return o!=t?!0:!1},regex:function(t,o){if("string"==typeof t){t=new RegExp(t)}return t.test(o)},like:function(t,o){if(null===t||"undefined"==typeof t){return o===t?!0:!1}else{if("undefined"!=typeof o&&null!==o){return-1<(o+"").toLowerCase().indexOf(t.toLowerCase())}else{return!1}}},keywords:function t(o,l,a,n){var t=o.toLowerCase().split("undefined"==typeof n.separator?" ":n.separator),r=((null===l||"undefined"==typeof l?"":l)+"").toLowerCase(),s=[];t.forEach(function(t){if(r.includes(t)){s.push(!0)}});return n.matchAll?s.length===t.length:!!s.length},starts:function(t,o){if(null===t||"undefined"==typeof t){return o===t?!0:!1}else{if("undefined"!=typeof o&&null!==o){return(o+"").toLowerCase().startsWith(t.toLowerCase())}else{return!1}}},ends:function(t,o){if(null===t||"undefined"==typeof t){return o===t?!0:!1}else{if("undefined"!=typeof o&&null!==o){return(o+"").toLowerCase().endsWith(t.toLowerCase())}else{return!1}}},in:function(t,o){if(Array.isArray(t)){return t.length?-1<t.indexOf(o):!0}else{console.warn("Filter Error - filter value is not an array:",t);return!1}}};u.prototype.registerModule("filter",D);var T=function(t){this.table=t};T.prototype.initializeColumn=function(t){t.modules.format=this.lookupFormatter(t,"");if("undefined"!=typeof t.definition.formatterPrint){t.modules.format.print=this.lookupFormatter(t,"Print")}if("undefined"!=typeof t.definition.formatterClipboard){t.modules.format.clipboard=this.lookupFormatter(t,"Clipboard")}if("undefined"!=typeof t.definition.formatterHtmlOutput){t.modules.format.htmlOutput=this.lookupFormatter(t,"HtmlOutput")}};T.prototype.lookupFormatter=function(t,o){var l={params:t.definition["formatter"+o+"Params"]||{}},a=t.definition["formatter"+o];switch("undefined"==typeof a?"undefined":_typeof(a)){case"string":if("tick"===a){a="tickCross";if("undefined"==typeof l.params.crossElement){l.params.crossElement=!1}console.warn("DEPRECATION WARNING - the tick formatter has been deprecated, please use the tickCross formatter with the crossElement param set to false")}if(this.formatters[a]){l.formatter=this.formatters[a]}else{console.warn("Formatter Error - No such formatter found: ",a);l.formatter=this.formatters.plaintext}break;case"function":l.formatter=a;break;default:l.formatter=this.formatters.plaintext;break;}return l};T.prototype.cellRendered=function(t){if(t.modules.format&&t.modules.format.renderedCallback&&!t.modules.format.rendered){t.modules.format.renderedCallback();t.modules.format.rendered=!0}};T.prototype.formatValue=function(t){var o=t.getComponent(),l="function"==typeof t.column.modules.format.params?t.column.modules.format.params(o):t.column.modules.format.params;return t.column.modules.format.formatter.call(this,o,l,function(o){if(!t.modules.format){t.modules.format={}}t.modules.format.renderedCallback=o;t.modules.format.rendered=!1})};T.prototype.formatExportValue=function(t,o){var l=t.column.modules.format[o],a;if(l){var n=function(o){if(!t.modules.format){t.modules.format={}}t.modules.format.renderedCallback=o;t.modules.format.rendered=!1};a="function"==typeof l.params?l.params(component):l.params;return l.formatter.call(this,t.getComponent(),a,n)}else{return this.formatValue(t)}};T.prototype.sanitizeHTML=function(t){if(t){var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return(t+"").replace(/[&<>"'`=\/]/g,function(t){return o[t]})}else{return t}};T.prototype.emptyToSpace=function(t){return null===t||"undefined"==typeof t||""===t?"&nbsp;":t};T.prototype.getFormatter=function(t){var t;switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":if(this.formatters[t]){t=this.formatters[t]}else{console.warn("Formatter Error - No such formatter found: ",t);t=this.formatters.plaintext}break;case"function":t=t;break;default:t=this.formatters.plaintext;break;}return t};T.prototype.formatters={plaintext:function(t){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))},html:function(t){return t.getValue()},textarea:function(t){t.getElement().style.whiteSpace="pre-wrap";return this.emptyToSpace(this.sanitizeHTML(t.getValue()))},money:function(t,o){var l=parseFloat(t.getValue()),a,n,r,s,d=o.decimal||".",p=o.thousand||",",c=o.symbol||"",u=!!o.symbolAfter,m="undefined"!=typeof o.precision?o.precision:2;if(isNaN(l)){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}a=!1!==m?l.toFixed(m):l;a=(a+"").split(".");n=a[0];r=1<a.length?d+a[1]:"";s=/(\d+)(\d{3})/;while(s.test(n)){n=n.replace(s,"$1"+p+"$2")}return u?n+r+c:c+n+r},link:function(t,o){var l=t.getValue(),a=o.urlPrefix||"",n=o.download,r=l,s=document.createElement("a"),d;if(o.labelField){d=t.getData();r=d[o.labelField]}if(o.label){switch(_typeof(o.label)){case"string":r=o.label;break;case"function":r=o.label(t);break;}}if(r){if(o.urlField){d=t.getData();l=d[o.urlField]}if(o.url){switch(_typeof(o.url)){case"string":l=o.url;break;case"function":l=o.url(t);break;}}s.setAttribute("href",a+l);if(o.target){s.setAttribute("target",o.target)}if(o.download){if("function"==typeof n){n=n(t)}else{n=!0===n?"":n}s.setAttribute("download",n)}s.innerHTML=this.emptyToSpace(this.sanitizeHTML(r));return s}else{return"&nbsp;"}},image:function(t,o){var l=document.createElement("img"),a=t.getValue();if(o.urlPrefix){a=o.urlPrefix+t.getValue()}if(o.urlSuffix){a=a+o.urlSuffix}l.setAttribute("src",a);switch(_typeof(o.height)){case"number":l.style.height=o.height+"px";break;case"string":l.style.height=o.height;break;}switch(_typeof(o.width)){case"number":l.style.width=o.width+"px";break;case"string":l.style.width=o.width;break;}l.addEventListener("load",function(){t.getRow().normalizeHeight()});return l},tickCross:function(t,o){var l=t.getValue(),a=t.getElement(),n=o.allowEmpty,r=o.allowTruthy,s="undefined"!=typeof o.tickElement?o.tickElement:"<svg enable-background=\"new 0 0 24 24\" height=\"14\" width=\"14\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" ><path fill=\"#2DC214\" clip-rule=\"evenodd\" d=\"M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z\" fill-rule=\"evenodd\"/></svg>",d="undefined"!=typeof o.crossElement?o.crossElement:"<svg enable-background=\"new 0 0 24 24\" height=\"14\" width=\"14\"  viewBox=\"0 0 24 24\" xml:space=\"preserve\" ><path fill=\"#CE1515\" d=\"M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z\"/></svg>";if(r&&l||!0===l||"true"===l||"True"===l||1===l||"1"===l){a.setAttribute("aria-checked",!0);return s||""}else{if(n&&("null"===l||""===l||null===l||"undefined"==typeof l)){a.setAttribute("aria-checked","mixed");return""}else{a.setAttribute("aria-checked",!1);return d||""}}},datetime:function(t,o){var l=o.inputFormat||"YYYY-MM-DD hh:mm:ss",a=o.outputFormat||"DD/MM/YYYY hh:mm:ss",n="undefined"!=typeof o.invalidPlaceholder?o.invalidPlaceholder:"",r=t.getValue(),s=moment(r,l);if(s.isValid()){return o.timezone?s.tz(o.timezone).format(a):s.format(a)}else{if(!0===n){return r}else if("function"==typeof n){return n(r)}else{return n}}},datetimediff:function(t,o){var l=o.inputFormat||"YYYY-MM-DD hh:mm:ss",a="undefined"!=typeof o.invalidPlaceholder?o.invalidPlaceholder:"",n="undefined"!=typeof o.suffix?o.suffix:!1,r="undefined"!=typeof o.unit?o.unit:void 0,s="undefined"!=typeof o.humanize?o.humanize:!1,d="undefined"!=typeof o.date?o.date:moment(),p=t.getValue(),c=moment(p,l);if(c.isValid()){if(s){return moment.duration(c.diff(d)).humanize(n)}else{return c.diff(d,r)+(n?" "+n:"")}}else{if(!0===a){return p}else if("function"==typeof a){return a(p)}else{return a}}},lookup:function(t,o){var l=t.getValue();if("undefined"==typeof o[l]){console.warn("Missing display value for "+l);return l}return o[l]},star:function t(o,l){var a=o.getValue(),n=o.getElement(),r=l&&l.stars?l.stars:5,s=document.createElement("span"),t=document.createElementNS("http://www.w3.org/2000/svg","svg");s.style.verticalAlign="middle";t.setAttribute("width","14");t.setAttribute("height","14");t.setAttribute("viewBox","0 0 512 512");t.setAttribute("xml:space","preserve");t.style.padding="0 1px";a=a&&!isNaN(a)?parseInt(a):0;a=Math.max(0,Math.min(a,r));for(var d=1,p;d<=r;d++){p=t.cloneNode(!0);p.innerHTML=d<=a?"<polygon fill=\"#FFEA00\" stroke=\"#C1AB60\" stroke-width=\"37.6152\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"10\" points=\"259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 \"/>":"<polygon fill=\"#D2D2D2\" stroke=\"#686868\" stroke-width=\"37.6152\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"10\" points=\"259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 \"/>";s.appendChild(p)}n.style.whiteSpace="nowrap";n.style.overflow="hidden";n.style.textOverflow="ellipsis";n.setAttribute("aria-label",a);return s},traffic:function(t,o){var l=this.sanitizeHTML(t.getValue())||0,a=document.createElement("span"),n=o&&o.max?o.max:100,r=o&&o.min?o.min:0,s=o&&"undefined"!=typeof o.color?o.color:["red","orange","green"],d="#666666",p,c;if(isNaN(l)||"undefined"==typeof t.getValue()){return}a.classList.add("tabulator-traffic-light");c=parseFloat(l)<=n?parseFloat(l):n;c=parseFloat(c)>=r?parseFloat(c):r;p=(n-r)/100;c=Math.round((c-r)/p);switch("undefined"==typeof s?"undefined":_typeof(s)){case"string":d=s;break;case"function":d=s(l);break;case"object":if(Array.isArray(s)){var u=100/s.length,m=Math.floor(c/u);m=Math.min(m,s.length-1);m=Math.max(m,0);d=s[m];break}}a.style.backgroundColor=d;return a},progress:function(t,o,l){var a=this.sanitizeHTML(t.getValue())||0,n=t.getElement(),r=o&&o.max?o.max:100,s=o&&o.min?o.min:0,p=o&&o.legendAlign?o.legendAlign:"center",c,u,m,g,h;u=parseFloat(a)<=r?parseFloat(a):r;u=parseFloat(u)>=s?parseFloat(u):s;c=(r-s)/100;u=Math.round((u-s)/c);switch(_typeof(o.color)){case"string":m=o.color;break;case"function":m=o.color(a);break;case"object":if(Array.isArray(o.color)){var b=100/o.color.length,f=Math.floor(u/b);f=Math.min(f,o.color.length-1);f=Math.max(f,0);m=o.color[f];break}default:m="#2DC214";}switch(_typeof(o.legend)){case"string":g=o.legend;break;case"function":g=o.legend(a);break;case"boolean":g=a;break;default:g=!1;}switch(_typeof(o.legendColor)){case"string":h=o.legendColor;break;case"function":h=o.legendColor(a);break;case"object":if(Array.isArray(o.legendColor)){var b=100/o.legendColor.length,f=Math.floor(u/b);f=Math.min(f,o.legendColor.length-1);f=Math.max(f,0);h=o.legendColor[f]}break;default:h="#000";}n.style.minWidth="30px";n.style.position="relative";n.setAttribute("aria-label",u);var y=document.createElement("div");y.style.display="inline-block";y.style.position="relative";y.style.width=u+"%";y.style.backgroundColor=m;y.style.height="100%";y.setAttribute("data-max",r);y.setAttribute("data-min",s);if(g){var w=document.createElement("div");w.style.position="absolute";w.style.top="4px";w.style.left=0;w.style.textAlign=p;w.style.width="100%";w.style.color=h;w.innerHTML=g}l(function(){if(!(t instanceof d)){var o=document.createElement("div");o.style.position="absolute";o.style.top="4px";o.style.bottom="4px";o.style.left="4px";o.style.right="4px";n.appendChild(o);n=o}n.appendChild(y);if(g){n.appendChild(w)}});return""},color:function(t){t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue());return""},buttonTick:function(){return"<svg enable-background=\"new 0 0 24 24\" height=\"14\" width=\"14\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" ><path fill=\"#2DC214\" clip-rule=\"evenodd\" d=\"M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z\" fill-rule=\"evenodd\"/></svg>"},buttonCross:function(){return"<svg enable-background=\"new 0 0 24 24\" height=\"14\" width=\"14\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" ><path fill=\"#CE1515\" d=\"M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z\"/></svg>"},rownum:function(t){return this.table.rowManager.activeRows.indexOf(t.getRow()._getSelf())+1},handle:function(t){t.getElement().classList.add("tabulator-row-handle");return"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"},responsiveCollapse:function(t){var l=this,a=document.createElement("div"),n=t.getRow()._row.modules.responsiveLayout;a.classList.add("tabulator-responsive-collapse-toggle");a.innerHTML="<span class='tabulator-responsive-collapse-toggle-open'>+</span><span class='tabulator-responsive-collapse-toggle-close'>-</span>";t.getElement().classList.add("tabulator-row-handle");function o(t){var o=n.element;n.open=t;if(o){if(n.open){a.classList.add("open");o.style.display=""}else{a.classList.remove("open");o.style.display="none"}}}a.addEventListener("click",function(t){t.stopImmediatePropagation();o(!n.open)});o(n.open);return a},rowSelection:function(t,o){var l=this,a=document.createElement("input");a.type="checkbox";if(this.table.modExists("selectRow",!0)){a.addEventListener("click",function(t){t.stopPropagation()});if("function"==typeof t.getRow){var n=t.getRow();if(n instanceof r){a.addEventListener("change",function(){n.toggleSelect()});a.checked=n.isSelected&&n.isSelected();this.table.modules.selectRow.registerRowSelectCheckbox(n,a)}else{a=""}}else{a.addEventListener("change",function(){if(l.table.modules.selectRow.selectedRows.length){l.table.deselectRow()}else{l.table.selectRow(o.rowRange)}});this.table.modules.selectRow.registerHeaderSelectCheckbox(a)}}return a}};u.prototype.registerModule("format",T);var z=function(t){this.table=t;this.leftColumns=[];this.rightColumns=[];this.leftMargin=0;this.rightMargin=0;this.rightPadding=0;this.initializationMode="left";this.active=!1;this.scrollEndTimer=!1};z.prototype.reset=function(){this.initializationMode="left";this.leftColumns=[];this.rightColumns=[];this.leftMargin=0;this.rightMargin=0;this.rightMargin=0;this.active=!1;this.table.columnManager.headersElement.style.marginLeft=0;this.table.columnManager.element.style.paddingRight=0};z.prototype.initializeColumn=function(t){var o={margin:0,edge:!1};if(!t.isGroup){if(this.frozenCheck(t)){o.position=this.initializationMode;if("left"==this.initializationMode){this.leftColumns.push(t)}else{this.rightColumns.unshift(t)}this.active=!0;t.modules.frozen=o}else{this.initializationMode="right"}}};z.prototype.frozenCheck=function(t){if(t.parent.isGroup&&t.definition.frozen){console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups")}if(t.parent.isGroup){return this.frozenCheck(t.parent)}else{return t.definition.frozen}return!1};z.prototype.scrollHorizontal=function(){var t=this,o;if(this.active){clearTimeout(this.scrollEndTimer);this.scrollEndTimer=setTimeout(function(){t.layout()},100);o=this.table.rowManager.getVisibleRows();this.calcMargins();this.layoutColumnPosition();this.layoutCalcRows();o.forEach(function(o){if("row"===o.type){t.layoutRow(o)}});this.table.rowManager.tableElement.style.marginRight=this.rightMargin}};z.prototype.calcMargins=function(){this.leftMargin=this._calcSpace(this.leftColumns,this.leftColumns.length)+"px";this.table.columnManager.headersElement.style.marginLeft=this.leftMargin;this.rightMargin=this._calcSpace(this.rightColumns,this.rightColumns.length)+"px";this.table.columnManager.element.style.paddingRight=this.rightMargin;this.rightPadding=this.table.rowManager.element.clientWidth+this.table.columnManager.scrollLeft};z.prototype.layoutCalcRows=function(){if(this.table.modExists("columnCalcs")){if(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow){this.layoutRow(this.table.modules.columnCalcs.topRow)}if(this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow){this.layoutRow(this.table.modules.columnCalcs.botRow)}}};z.prototype.layoutColumnPosition=function(t){var o=this,l=[];this.leftColumns.forEach(function(a,n){a.modules.frozen.margin=o._calcSpace(o.leftColumns,n)+o.table.columnManager.scrollLeft+"px";if(n==o.leftColumns.length-1){a.modules.frozen.edge=!0}else{a.modules.frozen.edge=!1}if(a.parent.isGroup){var r=o.getColGroupParentElement(a);if(!l.includes(r)){o.layoutElement(r,a);l.push(r)}if(a.modules.frozen.edge){r.classList.add("tabulator-frozen-"+a.modules.frozen.position)}}else{o.layoutElement(a.getElement(),a)}if(t){a.cells.forEach(function(t){o.layoutElement(t.getElement(!0),a)})}});this.rightColumns.forEach(function(l,a){l.modules.frozen.margin=o.rightPadding-o._calcSpace(o.rightColumns,a+1)+"px";if(a==o.rightColumns.length-1){l.modules.frozen.edge=!0}else{l.modules.frozen.edge=!1}if(l.parent.isGroup){o.layoutElement(o.getColGroupParentElement(l),l)}else{o.layoutElement(l.getElement(),l)}if(t){l.cells.forEach(function(t){o.layoutElement(t.getElement(!0),l)})}})};z.prototype.getColGroupParentElement=function(t){return t.parent.isGroup?this.getColGroupParentElement(t.parent):t.getElement()};z.prototype.layout=function(){var t=this;if(t.active){this.calcMargins();t.table.rowManager.getDisplayRows().forEach(function(o){if("row"===o.type){t.layoutRow(o)}});this.layoutCalcRows();this.layoutColumnPosition(!0);this.table.rowManager.tableElement.style.marginRight=this.rightMargin}};z.prototype.layoutRow=function(t){var o=this,l=t.getElement();l.style.paddingLeft=this.leftMargin;this.leftColumns.forEach(function(l){var a=t.getCell(l);if(a){o.layoutElement(a.getElement(!0),l)}});this.rightColumns.forEach(function(l){var a=t.getCell(l);if(a){o.layoutElement(a.getElement(!0),l)}})};z.prototype.layoutElement=function(t,o){if(o.modules.frozen){t.style.position="absolute";t.style.left=o.modules.frozen.margin;t.classList.add("tabulator-frozen");if(o.modules.frozen.edge){t.classList.add("tabulator-frozen-"+o.modules.frozen.position)}}};z.prototype._calcSpace=function(t,o){for(var l=0,a=0;a<o;a++){if(t[a].visible){l+=t[a].getWidth()}}return l};u.prototype.registerModule("frozenColumns",z);var H=function(t){this.table=t;this.topElement=document.createElement("div");this.rows=[];this.displayIndex=0};H.prototype.initialize=function(){this.rows=[];this.topElement.classList.add("tabulator-frozen-rows-holder");this.table.columnManager.getElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling)};H.prototype.setDisplayIndex=function(t){this.displayIndex=t};H.prototype.getDisplayIndex=function(){return this.displayIndex};H.prototype.isFrozen=function(){return!!this.rows.length};H.prototype.getRows=function(t){var o=this,l=t.slice(0);this.rows.forEach(function(t){var o=l.indexOf(t);if(-1<o){l.splice(o,1)}});return l};H.prototype.freezeRow=function(t){if(!t.modules.frozen){t.modules.frozen=!0;this.topElement.appendChild(t.getElement());t.initialize();t.normalizeHeight();this.table.rowManager.adjustTableSize();this.rows.push(t);this.table.rowManager.refreshActiveData("display");this.styleRows()}else{console.warn("Freeze Error - Row is already frozen")}};H.prototype.unfreezeRow=function(t){this.rows.indexOf(t);if(t.modules.frozen){t.modules.frozen=!1;this.detachRow(t);this.table.rowManager.adjustTableSize();this.table.rowManager.refreshActiveData("display");if(this.rows.length){this.styleRows()}}else{console.warn("Freeze Error - Row is already unfrozen")}};H.prototype.detachRow=function(t){var o=this.rows.indexOf(t);if(-1<o){var l=t.getElement();l.parentNode.removeChild(l);this.rows.splice(o,1)}};H.prototype.styleRows=function(){var t=this;this.rows.forEach(function(o,l){t.table.rowManager.styleRow(o,l)})};u.prototype.registerModule("frozenRows",H);var k=function(t){this._group=t;this.type="GroupComponent"};k.prototype.getKey=function(){return this._group.key};k.prototype.getField=function(){return this._group.field};k.prototype.getElement=function(){return this._group.element};k.prototype.getRows=function(){return this._group.getRows(!0)};k.prototype.getSubGroups=function(){return this._group.getSubGroups(!0)};k.prototype.getParentGroup=function(){return this._group.parent?this._group.parent.getComponent():!1};k.prototype.getVisibility=function(){console.warn("getVisibility function is deprecated, you should now use the isVisible function");return this._group.visible};k.prototype.isVisible=function(){return this._group.visible};k.prototype.show=function(){this._group.show()};k.prototype.hide=function(){this._group.hide()};k.prototype.toggle=function(){this._group.toggleVisibility()};k.prototype._getSelf=function(){return this._group};k.prototype.getTable=function(){return this._group.groupManager.table};var S=function(t,o,l,a,n,r,s){this.groupManager=t;this.parent=o;this.key=a;this.level=l;this.field=n;this.hasSubGroups=l<t.groupIDLookups.length-1;this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow;this.type="group";this.old=s;this.rows=[];this.groups=[];this.groupList=[];this.generator=r;this.elementContents=!1;this.height=0;this.outerHeight=0;this.initialized=!1;this.calcs={};this.initialized=!1;this.modules={};this.arrowElement=!1;this.visible=s?s.visible:"undefined"!=typeof t.startOpen[l]?t.startOpen[l]:t.startOpen[0];this.component=null;this.createElements();this.addBindings();this.createValueGroups()};S.prototype.wipe=function(){if(this.groupList.length){this.groupList.forEach(function(t){t.wipe()})}else{this.element=!1;this.arrowElement=!1;this.elementContents=!1}};S.prototype.createElements=function(){var t=document.createElement("div");t.classList.add("tabulator-arrow");this.element=document.createElement("div");this.element.classList.add("tabulator-row");this.element.classList.add("tabulator-group");this.element.classList.add("tabulator-group-level-"+this.level);this.element.setAttribute("role","rowgroup");this.arrowElement=document.createElement("div");this.arrowElement.classList.add("tabulator-group-toggle");this.arrowElement.appendChild(t);if(!1!==this.groupManager.table.options.movableRows&&this.groupManager.table.modExists("moveRow")){this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}};S.prototype.createValueGroups=function(){var t=this,o=this.level+1;if(this.groupManager.allowedValues&&this.groupManager.allowedValues[o]){this.groupManager.allowedValues[o].forEach(function(l){t._createGroup(l,o)})}};S.prototype.addBindings=function(){var t=this,o,l,a,n;if(t.groupManager.table.options.groupClick){t.element.addEventListener("click",function(o){t.groupManager.table.options.groupClick.call(t.groupManager.table,o,t.getComponent())})}if(t.groupManager.table.options.groupDblClick){t.element.addEventListener("dblclick",function(o){t.groupManager.table.options.groupDblClick.call(t.groupManager.table,o,t.getComponent())})}if(t.groupManager.table.options.groupContext){t.element.addEventListener("contextmenu",function(o){t.groupManager.table.options.groupContext.call(t.groupManager.table,o,t.getComponent())})}if((t.groupManager.table.options.groupContextMenu||t.groupManager.table.options.groupClickMenu)&&t.groupManager.table.modExists("menu")){t.groupManager.table.modules.menu.initializeGroup.call(t.groupManager.table.modules.menu,t)}if(t.groupManager.table.options.groupTap){a=!1;t.element.addEventListener("touchstart",function(){a=!0},{passive:!0});t.element.addEventListener("touchend",function(o){if(a){t.groupManager.table.options.groupTap(o,t.getComponent())}a=!1})}if(t.groupManager.table.options.groupDblTap){o=null;t.element.addEventListener("touchend",function(l){if(o){clearTimeout(o);o=null;t.groupManager.table.options.groupDblTap(l,t.getComponent())}else{o=setTimeout(function(){clearTimeout(o);o=null},300)}})}if(t.groupManager.table.options.groupTapHold){l=null;t.element.addEventListener("touchstart",function(o){clearTimeout(l);l=setTimeout(function(){clearTimeout(l);l=null;a=!1;t.groupManager.table.options.groupTapHold(o,t.getComponent())},1e3)},{passive:!0});t.element.addEventListener("touchend",function(){clearTimeout(l);l=null})}if(t.groupManager.table.options.groupToggleElement){n="arrow"==t.groupManager.table.options.groupToggleElement?t.arrowElement:t.element;n.addEventListener("click",function(o){o.stopPropagation();o.stopImmediatePropagation();t.toggleVisibility()})}};S.prototype._createGroup=function(t,o){var l=o+"_"+t,a=new S(this.groupManager,this,o,t,this.groupManager.groupIDLookups[o].field,this.groupManager.headerGenerator[o]||this.groupManager.headerGenerator[0],this.old?this.old.groups[l]:!1);this.groups[l]=a;this.groupList.push(a)};S.prototype._addRowToGroup=function(t){var o=this.level+1;if(this.hasSubGroups){var l=this.groupManager.groupIDLookups[o].func(t.getData()),a=o+"_"+l;if(this.groupManager.allowedValues&&this.groupManager.allowedValues[o]){if(this.groups[a]){this.groups[a].addRow(t)}}else{if(!this.groups[a]){this._createGroup(l,o)}this.groups[a].addRow(t)}}};S.prototype._addRow=function(t){this.rows.push(t);t.modules.group=this};S.prototype.insertRow=function(t,o,l){var a=this.conformRowData({});t.updateData(a);var n=this.rows.indexOf(o);if(-1<n){if(l){this.rows.splice(n+1,0,t)}else{this.rows.splice(n,0,t)}}else{if(l){this.rows.push(t)}else{this.rows.unshift(t)}}t.modules.group=this;this.generateGroupHeaderContents();if(this.groupManager.table.modExists("columnCalcs")&&"table"!=this.groupManager.table.options.columnCalcs){this.groupManager.table.modules.columnCalcs.recalcGroup(this)}this.groupManager.updateGroupRows(!0)};S.prototype.scrollHeader=function(t){this.arrowElement.style.marginLeft=t;this.groupList.forEach(function(o){o.scrollHeader(t)})};S.prototype.getRowIndex=function(){};S.prototype.conformRowData=function(t){if(this.field){t[this.field]=this.key}else{console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function")}if(this.parent){t=this.parent.conformRowData(t)}return t};S.prototype.removeRow=function(t){var o=this.rows.indexOf(t),l=t.getElement();if(-1<o){this.rows.splice(o,1)}if(!this.groupManager.table.options.groupValues&&!this.rows.length){if(this.parent){this.parent.removeGroup(this)}else{this.groupManager.removeGroup(this)}this.groupManager.updateGroupRows(!0)}else{if(l.parentNode){l.parentNode.removeChild(l)}this.generateGroupHeaderContents();if(this.groupManager.table.modExists("columnCalcs")&&"table"!=this.groupManager.table.options.columnCalcs){this.groupManager.table.modules.columnCalcs.recalcGroup(this)}}};S.prototype.removeGroup=function(t){var o=t.level+"_"+t.key,l;if(this.groups[o]){delete this.groups[o];l=this.groupList.indexOf(t);if(-1<l){this.groupList.splice(l,1)}if(!this.groupList.length){if(this.parent){this.parent.removeGroup(this)}else{this.groupManager.removeGroup(this)}}}};S.prototype.getHeadersAndRows=function(t){var o=[this];this._visSet();if(this.visible){if(this.groupList.length){this.groupList.forEach(function(l){o=o.concat(l.getHeadersAndRows(t))})}else{if(!t&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()){if(this.calcs.top){this.calcs.top.detachElement();this.calcs.top.deleteCells()}this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows);o.push(this.calcs.top)}o=o.concat(this.rows);if(!t&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()){if(this.calcs.bottom){this.calcs.bottom.detachElement();this.calcs.bottom.deleteCells()}this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows);o.push(this.calcs.bottom)}}}else{if(!this.groupList.length&&"table"!=this.groupManager.table.options.columnCalcs){if(this.groupManager.table.modExists("columnCalcs")){if(!t&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()){if(this.calcs.top){this.calcs.top.detachElement();this.calcs.top.deleteCells()}if(this.groupManager.table.options.groupClosedShowCalcs){this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows);o.push(this.calcs.top)}}if(!t&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()){if(this.calcs.bottom){this.calcs.bottom.detachElement();this.calcs.bottom.deleteCells()}if(this.groupManager.table.options.groupClosedShowCalcs){this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows);o.push(this.calcs.bottom)}}}}}return o};S.prototype.getData=function(t,o){var l=this,a=[];this._visSet();if(!t||t&&this.visible){this.rows.forEach(function(t){a.push(t.getData(o||"data"))})}return a};S.prototype.getRowCount=function(){var t=0;if(this.groupList.length){this.groupList.forEach(function(o){t+=o.getRowCount()})}else{t=this.rows.length}return t};S.prototype.toggleVisibility=function(){if(this.visible){this.hide()}else{this.show()}};S.prototype.hide=function(){this.visible=!1;if("classic"==this.groupManager.table.rowManager.getRenderMode()&&!this.groupManager.table.options.pagination){this.element.classList.remove("tabulator-group-visible");if(this.groupList.length){this.groupList.forEach(function(t){var o=t.getHeadersAndRows();o.forEach(function(t){t.detachElement()})})}else{this.rows.forEach(function(t){var o=t.getElement();o.parentNode.removeChild(o)})}this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(),this.groupManager.getDisplayIndex());this.groupManager.table.rowManager.checkClassicModeGroupHeaderWidth()}else{this.groupManager.updateGroupRows(!0)}this.groupManager.table.options.groupVisibilityChanged.call(this.table,this.getComponent(),!1)};S.prototype.show=function(){var t=this;t.visible=!0;if("classic"==this.groupManager.table.rowManager.getRenderMode()&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var o=t.getElement();if(this.groupList.length){this.groupList.forEach(function(t){var l=t.getHeadersAndRows();l.forEach(function(t){var l=t.getElement();o.parentNode.insertBefore(l,o.nextSibling);t.initialize();o=l})})}else{t.rows.forEach(function(t){var l=t.getElement();o.parentNode.insertBefore(l,o.nextSibling);t.initialize();o=l})}this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(),this.groupManager.getDisplayIndex());this.groupManager.table.rowManager.checkClassicModeGroupHeaderWidth()}else{this.groupManager.updateGroupRows(!0)}this.groupManager.table.options.groupVisibilityChanged.call(this.table,this.getComponent(),!0)};S.prototype._visSet=function(){var t=[];if("function"==typeof this.visible){this.rows.forEach(function(o){t.push(o.getData())});this.visible=this.visible(this.key,this.getRowCount(),t,this.getComponent())}};S.prototype.getRowGroup=function(t){var o=!1;if(this.groupList.length){this.groupList.forEach(function(l){var a=l.getRowGroup(t);if(a){o=a}})}else{if(this.rows.find(function(o){return o===t})){o=this}}return o};S.prototype.getSubGroups=function(t){var o=[];this.groupList.forEach(function(l){o.push(t?l.getComponent():l)});return o};S.prototype.getRows=function(t){var o=[];this.rows.forEach(function(l){o.push(t?l.getComponent():l)});return o};S.prototype.generateGroupHeaderContents=function(){var t=[];this.rows.forEach(function(o){t.push(o.getData())});this.elementContents=this.generator(this.key,this.getRowCount(),t,this.getComponent());while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}if("string"==typeof this.elementContents){this.element.innerHTML=this.elementContents}else{this.element.appendChild(this.elementContents)}this.element.insertBefore(this.arrowElement,this.element.firstChild)};S.prototype.getPath=function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];t.unshift(this.key);if(this.parent){this.parent.getPath(t)}return t};S.prototype.getElement=function(){this.addBindingsd=!1;this._visSet();if(this.visible){this.element.classList.add("tabulator-group-visible")}else{this.element.classList.remove("tabulator-group-visible")}for(var t=0;t<this.element.childNodes.length;++t){this.element.childNodes[t].parentNode.removeChild(this.element.childNodes[t])}this.generateGroupHeaderContents();return this.element};S.prototype.detachElement=function(){if(this.element&&this.element.parentNode){this.element.parentNode.removeChild(this.element)}};S.prototype.normalizeHeight=function(){this.setHeight(this.element.clientHeight)};S.prototype.initialize=function(t){if(!this.initialized||t){this.normalizeHeight();this.initialized=!0}};S.prototype.reinitialize=function(){this.initialized=!1;this.height=0;if(u.prototype.helpers.elVisible(this.element)){this.initialize(!0)}};S.prototype.setHeight=function(t){if(this.height!=t){this.height=t;this.outerHeight=this.element.offsetHeight}};S.prototype.getHeight=function(){return this.outerHeight};S.prototype.getGroup=function(){return this};S.prototype.reinitializeHeight=function(){};S.prototype.calcHeight=function(){};S.prototype.setCellHeight=function(){};S.prototype.clearCellHeight=function(){};S.prototype.getComponent=function(){if(!this.component){this.component=new k(this)}return this.component};var P=function(t){this.table=t;this.groupIDLookups=!1;this.startOpen=[function(){return!1}];this.headerGenerator=[function(){return""}];this.groupList=[];this.allowedValues=!1;this.groups={};this.displayIndex=0};P.prototype.initialize=function(){var t=this,o=t.table.options.groupBy,l=t.table.options.groupStartOpen,a=t.table.options.groupHeader;this.allowedValues=t.table.options.groupValues;if(Array.isArray(o)&&Array.isArray(a)&&o.length>a.length){console.warn("Error creating group headers, groupHeader array is shorter than groupBy array")}t.headerGenerator=[function(){return""}];this.startOpen=[function(){return!1}];t.table.modules.localize.bind("groups|item",function(o,l){t.headerGenerator[0]=function(t,a){return("undefined"==typeof t?"":t)+"<span>("+a+" "+(1===a?o:l.groups.items)+")</span>"}});this.groupIDLookups=[];if(Array.isArray(o)||o){if(this.table.modExists("columnCalcs")&&"table"!=this.table.options.columnCalcs&&"both"!=this.table.options.columnCalcs){this.table.modules.columnCalcs.removeCalcs()}}else{if(this.table.modExists("columnCalcs")&&"group"!=this.table.options.columnCalcs){var n=this.table.columnManager.getRealColumns();n.forEach(function(o){if(o.definition.topCalc){t.table.modules.columnCalcs.initializeTopRow()}if(o.definition.bottomCalc){t.table.modules.columnCalcs.initializeBottomRow()}})}}if(!Array.isArray(o)){o=[o]}o.forEach(function(o,l){var a,n;if("function"==typeof o){a=o}else{n=t.table.columnManager.getColumnByField(o);if(n){a=function(t){return n.getFieldValue(t)}}else{a=function(t){return t[o]}}}t.groupIDLookups.push({field:"function"==typeof o?!1:o,func:a,values:t.allowedValues?t.allowedValues[l]:!1})});if(l){if(!Array.isArray(l)){l=[l]}l.forEach(function(t){t="function"==typeof t?t:function(){return!0}});t.startOpen=l}if(a){t.headerGenerator=Array.isArray(a)?a:[a]}this.initialized=!0};P.prototype.setDisplayIndex=function(t){this.displayIndex=t};P.prototype.getDisplayIndex=function(){return this.displayIndex};P.prototype.getRows=function(t){if(this.groupIDLookups.length){this.table.options.dataGrouping.call(this.table);this.generateGroups(t);if(this.table.options.dataGrouped){this.table.options.dataGrouped.call(this.table,this.getGroups(!0))}return this.updateGroupRows()}else{return t.slice(0)}};P.prototype.getGroups=function(t){var o=[];this.groupList.forEach(function(l){o.push(t?l.getComponent():l)});return o};P.prototype.getChildGroups=function(t){var o=this,l=[];if(!t){t=this}t.groupList.forEach(function(t){if(t.groupList.length){l=l.concat(o.getChildGroups(t))}else{l.push(t)}});return l};P.prototype.wipe=function(){this.groupList.forEach(function(t){t.wipe()})};P.prototype.pullGroupListData=function(t){var o=this,l=[];t.forEach(function(t){var a={level:0,rowCount:0,headerContent:""},n=[];if(t.hasSubGroups){n=o.pullGroupListData(t.groupList);a.level=t.level;a.rowCount=n.length-t.groupList.length;a.headerContent=t.generator(t.key,a.rowCount,t.rows,t);l.push(a);l=l.concat(n)}else{a.level=t.level;a.headerContent=t.generator(t.key,t.rows.length,t.rows,t);a.rowCount=t.getRows().length;l.push(a);t.getRows().forEach(function(t){l.push(t.getData("data"))})}});return l};P.prototype.getGroupedData=function(){return this.pullGroupListData(this.groupList)};P.prototype.getRowGroup=function(t){var o=!1;this.groupList.forEach(function(l){var a=l.getRowGroup(t);if(a){o=a}});return o};P.prototype.countGroups=function(){return this.groupList.length};P.prototype.generateGroups=function(t){var o=this,l=o.groups;o.groups={};o.groupList=[];if(this.allowedValues&&this.allowedValues[0]){this.allowedValues[0].forEach(function(t){o.createGroup(t,0,l)});t.forEach(function(t){o.assignRowToExistingGroup(t,l)})}else{t.forEach(function(t){o.assignRowToGroup(t,l)})}};P.prototype.createGroup=function(t,o,l){var a=o+"_"+t,n;l=l||[];n=new S(this,!1,o,t,this.groupIDLookups[0].field,this.headerGenerator[0],l[a]);this.groups[a]=n;this.groupList.push(n)};P.prototype.assignRowToExistingGroup=function(t){var o=this.groupIDLookups[0].func(t.getData()),l="0_"+o;if(this.groups[l]){this.groups[l].addRow(t)}};P.prototype.assignRowToGroup=function(t,o){var l=this.groupIDLookups[0].func(t.getData()),a=!this.groups["0_"+l];if(a){this.createGroup(l,0,o)}this.groups["0_"+l].addRow(t);return!a};P.prototype.reassignRowToGroup=function(t){var o=t.getGroup(),l=o.getPath(),a=this.getExpectedPath(t),n=!0,n=l.length==a.length&&l.every(function(t,o){return t===a[o]});if(!n){o.removeRow(t);this.assignRowToGroup(t,self.groups);this.table.rowManager.refreshActiveData("group",!1,!0)}};P.prototype.getExpectedPath=function(t){var o=[],l=t.getData();this.groupIDLookups.forEach(function(t){o.push(t.func(l))});return o};P.prototype.updateGroupRows=function(t){var o=this,l=[];o.groupList.forEach(function(t){l=l.concat(t.getHeadersAndRows())});if(t){var a=o.table.rowManager.setDisplayRows(l,this.getDisplayIndex());if(!0!==a){this.setDisplayIndex(a)}o.table.rowManager.refreshActiveData("group",!0,!0)}return l};P.prototype.scrollHeaders=function(t){if(this.table.options.virtualDomHoz){t-=this.table.vdomHoz.vDomPadLeft}t=t+"px";this.groupList.forEach(function(o){o.scrollHeader(t)})};P.prototype.removeGroup=function(t){var o=t.level+"_"+t.key,l;if(this.groups[o]){delete this.groups[o];l=this.groupList.indexOf(t);if(-1<l){this.groupList.splice(l,1)}}};u.prototype.registerModule("groupRows",P);var A=function(t){this.table=t;this.history=[];this.index=-1};A.prototype.clear=function(){this.history=[];this.index=-1};A.prototype.action=function(t,o,l){this.history=this.history.slice(0,this.index+1);this.history.push({type:t,component:o,data:l});this.index++};A.prototype.getHistoryUndoSize=function(){return this.index+1};A.prototype.getHistoryRedoSize=function(){return this.history.length-(this.index+1)};A.prototype.clearComponentHistory=function(t){var o=this.history.findIndex(function(o){return o.component===t});if(-1<o){this.history.splice(o,1);if(o<=this.index){this.index--}this.clearComponentHistory(t)}};A.prototype.undo=function(){if(-1<this.index){var t=this.history[this.index];this.undoers[t.type].call(this,t);this.index--;this.table.options.historyUndo.call(this.table,t.type,t.component.getComponent(),t.data);return!0}else{console.warn("History Undo Error - No more history to undo");return!1}};A.prototype.redo=function(){if(this.history.length-1>this.index){this.index++;var t=this.history[this.index];this.redoers[t.type].call(this,t);this.table.options.historyRedo.call(this.table,t.type,t.component.getComponent(),t.data);return!0}else{console.warn("History Redo Error - No more history to redo");return!1}};A.prototype.undoers={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue)},rowAdd:function(t){t.component.deleteActual()},rowDelete:function(t){var o=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.updateGroupRows(!0)}this._rebindRow(t.component,o)},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.rows[t.data.posFrom],!t.data.after);this.table.rowManager.redraw()}};A.prototype.redoers={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue)},rowAdd:function(t){var o=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);if(this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.updateGroupRows(!0)}this._rebindRow(t.component,o)},rowDelete:function(t){t.component.deleteActual()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.rows[t.data.posTo],t.data.after);this.table.rowManager.redraw()}};A.prototype._rebindRow=function(t,o){this.history.forEach(function(l){if(l.component instanceof s){if(l.component===t){l.component=o}}else if(l.component instanceof p){if(l.component.row===t){var a=l.component.column.getField();if(a){l.component=o.getCell(a)}}}})};u.prototype.registerModule("history",A);var F=function(t){this.table=t;this.fieldIndex=[];this.hasIndex=!1};F.prototype.parseTable=function(){var t=this,o=t.table.element,l=t.table.options,a=l.columns,n=o.getElementsByTagName("th"),r=o.getElementsByTagName("tbody")[0],s=[];t.hasIndex=!1;t.table.options.htmlImporting.call(this.table);r=r?r.getElementsByTagName("tr"):[];t._extractOptions(o,l);if(n.length){t._extractHeaders(n,r)}else{t._generateBlankHeaders(n,r)}for(var d=0;d<r.length;d++){var p=r[d],c=p.getElementsByTagName("td"),u={};if(!t.hasIndex){u[l.index]=d}for(var m=0,g;m<c.length;m++){g=c[m];if("undefined"!=typeof this.fieldIndex[m]){u[this.fieldIndex[m]]=g.innerHTML}}s.push(u)}var h=document.createElement("div"),b=o.attributes;for(var m in b){if("object"==_typeof(b[m])){h.setAttribute(b[m].name,b[m].value)}}o.parentNode.replaceChild(h,o);l.data=s;t.table.options.htmlImported.call(this.table);this.table.element=h};F.prototype._extractOptions=function(t,o,l){var a=t.attributes,n=l?Object.assign([],l):Object.keys(o),r={};n.forEach(function(t){r[t.toLowerCase()]=t});for(var s in a){var d=a[s],p;if(d&&"object"==("undefined"==typeof d?"undefined":_typeof(d))&&d.name&&0===d.name.indexOf("tabulator-")){p=d.name.replace("tabulator-","");if("undefined"!=typeof r[p]){o[r[p]]=this._attribValue(d.value)}}}};F.prototype._attribValue=function(t){if("true"===t){return!0}if("false"===t){return!1}return t};F.prototype._findCol=function(t){var o=this.table.options.columns.find(function(o){return o.title===t});return o||!1};F.prototype._extractHeaders=function(t){for(var o=0;o<t.length;o++){var a=t[o],n=!1,r=this._findCol(a.textContent),s;if(r){n=!0}else{r={title:a.textContent.trim()}}if(!r.field){r.field=a.textContent.trim().toLowerCase().replace(" ","_")}s=a.getAttribute("width");if(s&&!r.width){r.width=s}a.attributes;this._extractOptions(a,r,l.prototype.defaultOptionList);this.fieldIndex[o]=r.field;if(r.field==this.table.options.index){this.hasIndex=!0}if(!n){this.table.options.columns.push(r)}}};F.prototype._generateBlankHeaders=function(t){for(var o=0;o<t.length;o++){var l=t[o],a={title:"",field:"col"+o};this.fieldIndex[o]=a.field;var n=l.getAttribute("width");if(n){a.width=n}this.table.options.columns.push(a)}};u.prototype.registerModule("htmlTableImport",F);var _=function(t){this.table=t;this.watchKeys=null;this.pressedKeys=null;this.keyupBinding=!1;this.keydownBinding=!1};_.prototype.initialize=function(){var t=this.table.options.keybindings,o={};this.watchKeys={};this.pressedKeys=[];if(!1!==t){for(var l in this.bindings){o[l]=this.bindings[l]}if(Object.keys(t).length){for(var a in t){o[a]=t[a]}}this.mapBindings(o);this.bindEvents()}};_.prototype.mapBindings=function(t){var o=this,l=this,a=function(a){if(o.actions[a]){if(t[a]){if("object"!==_typeof(t[a])){t[a]=[t[a]]}t[a].forEach(function(t){l.mapBinding(a,t)})}}else{console.warn("Key Binding Error - no such action:",a)}};for(var n in t){a(n)}};_.prototype.mapBinding=function(t,o){var l=this,a={action:this.actions[t],keys:[],ctrl:!1,shift:!1,meta:!1},n=o.toString().toLowerCase().split(" ").join("").split("+");n.forEach(function(t){switch(t){case"ctrl":a.ctrl=!0;break;case"shift":a.shift=!0;break;case"meta":a.meta=!0;break;default:t=parseInt(t);a.keys.push(t);if(!l.watchKeys[t]){l.watchKeys[t]=[]}l.watchKeys[t].push(a);}})};_.prototype.bindEvents=function(){var t=this;this.keyupBinding=function(o){var l=o.keyCode,a=t.watchKeys[l];if(a){t.pressedKeys.push(l);a.forEach(function(l){t.checkBinding(o,l)})}};this.keydownBinding=function(o){var l=o.keyCode,a=t.watchKeys[l];if(a){var n=t.pressedKeys.indexOf(l);if(-1<n){t.pressedKeys.splice(n,1)}}};this.table.element.addEventListener("keydown",this.keyupBinding);this.table.element.addEventListener("keyup",this.keydownBinding)};_.prototype.clearBindings=function(){if(this.keyupBinding){this.table.element.removeEventListener("keydown",this.keyupBinding)}if(this.keydownBinding){this.table.element.removeEventListener("keyup",this.keydownBinding)}};_.prototype.checkBinding=function(t,o){var l=this,a=!0;if(t.ctrlKey==o.ctrl&&t.shiftKey==o.shift&&t.metaKey==o.meta){o.keys.forEach(function(t){var o=l.pressedKeys.indexOf(t);if(-1==o){a=!1}});if(a){o.action.call(l,t)}return!0}return!1};_.prototype.bindings={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35,undo:"ctrl + 90",redo:"ctrl + 89",copyToClipboard:"ctrl + 67"};_.prototype.actions={keyBlock:function(t){t.stopPropagation();t.preventDefault()},scrollPageUp:function(t){var o=this.table.rowManager,l=o.scrollTop-o.height,a=o.element.scrollHeight;t.preventDefault();if(o.displayRowsCount){if(0<=l){o.element.scrollTop=l}else{o.scrollToRow(o.getDisplayRows()[0])}}this.table.element.focus()},scrollPageDown:function(t){var o=this.table.rowManager,l=o.scrollTop+o.height,a=o.element.scrollHeight;t.preventDefault();if(o.displayRowsCount){if(l<=a){o.element.scrollTop=l}else{o.scrollToRow(o.getDisplayRows()[o.displayRowsCount-1])}}this.table.element.focus()},scrollToStart:function(t){var o=this.table.rowManager;t.preventDefault();if(o.displayRowsCount){o.scrollToRow(o.getDisplayRows()[0])}this.table.element.focus()},scrollToEnd:function(t){var o=this.table.rowManager;t.preventDefault();if(o.displayRowsCount){o.scrollToRow(o.getDisplayRows()[o.displayRowsCount-1])}this.table.element.focus()},navPrev:function(t){var o=!1;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();o.nav().prev()}}},navNext:function(t){var o=!1,l=this.table.options.tabEndNewRow,a;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();a=o.nav();if(!a.next()){if(l){o.getElement().firstChild.blur();if(!0===l){l=this.table.addRow({})}else{if("function"==typeof l){l=this.table.addRow(l(o.row.getComponent()))}else{l=this.table.addRow(Object.assign({},l))}}l.then(function(){setTimeout(function(){a.next()})})}}}}},navLeft:function(t){var o=!1;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();o.nav().left()}}},navRight:function(t){var o=!1;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();o.nav().right()}}},navUp:function(t){var o=!1;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();o.nav().up()}}},navDown:function(t){var o=!1;if(this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(o){t.preventDefault();o.nav().down()}}},undo:function(t){var o=!1;if(this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(!o){t.preventDefault();this.table.modules.history.undo()}}},redo:function(t){var o=!1;if(this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")){o=this.table.modules.edit.currentCell;if(!o){t.preventDefault();this.table.modules.history.redo()}}},copyToClipboard:function(){if(!this.table.modules.edit.currentCell){if(this.table.modExists("clipboard",!0)){this.table.modules.clipboard.copy(!1,!0)}}}};u.prototype.registerModule("keybindings",_);var B=function(t){this.table=t;this.menuElements=[];this.blurEvent=this.hideMenu.bind(this);this.escEvent=this.escMenu.bind(this);this.nestedMenuBlock=!1;this.positionReversedX=!1};B.prototype.initializeColumnHeader=function(t){var o=this,l;if(t.definition.headerContextMenu){t.getElement().addEventListener("contextmenu",this.LoadMenuEvent.bind(this,t,t.definition.headerContextMenu));this.tapHold(t,t.definition.headerContextMenu)}if(t.definition.headerMenu){l=document.createElement("span");l.classList.add("tabulator-header-menu-button");l.innerHTML="&vellip;";l.addEventListener("click",function(l){l.stopPropagation();l.preventDefault();o.LoadMenuEvent(t,t.definition.headerMenu,l)});t.titleElement.insertBefore(l,t.titleElement.firstChild)}};B.prototype.LoadMenuEvent=function(t,o,l){o="function"==typeof o?o.call(this.table,t.getComponent(),l):o;this.loadMenu(l,t,o)};B.prototype.tapHold=function(t,o){var l=this,a=t.getElement(),n=null,r=!1;a.addEventListener("touchstart",function(a){clearTimeout(n);r=!1;n=setTimeout(function(){clearTimeout(n);n=null;r=!0;l.LoadMenuEvent(t,o,a)},1e3)},{passive:!0});a.addEventListener("touchend",function(t){clearTimeout(n);n=null;if(r){t.preventDefault()}})};B.prototype.initializeCell=function(t){if(t.column.definition.contextMenu){t.getElement(!0).addEventListener("contextmenu",this.LoadMenuEvent.bind(this,t,t.column.definition.contextMenu));this.tapHold(t,t.column.definition.contextMenu)}if(t.column.definition.clickMenu){t.getElement(!0).addEventListener("click",this.LoadMenuEvent.bind(this,t,t.column.definition.clickMenu))}};B.prototype.initializeRow=function(t){if(this.table.options.rowContextMenu){t.getElement().addEventListener("contextmenu",this.LoadMenuEvent.bind(this,t,this.table.options.rowContextMenu));this.tapHold(t,this.table.options.rowContextMenu)}if(this.table.options.rowClickMenu){t.getElement().addEventListener("click",this.LoadMenuEvent.bind(this,t,this.table.options.rowClickMenu))}};B.prototype.initializeGroup=function(t){if(this.table.options.groupContextMenu){t.getElement().addEventListener("contextmenu",this.LoadMenuEvent.bind(this,t,this.table.options.groupContextMenu));this.tapHold(t,this.table.options.groupContextMenu)}if(this.table.options.groupClickMenu){t.getElement().addEventListener("click",this.LoadMenuEvent.bind(this,t,this.table.options.groupClickMenu))}};B.prototype.loadMenu=function(t,o,l,a){var n=this,r=!(t instanceof MouseEvent),s=document.createElement("div");s.classList.add("tabulator-menu");if(!r){t.preventDefault()}if(!l||!l.length){return}if(!a){if(this.nestedMenuBlock){if(this.isOpen()){return}}else{this.nestedMenuBlock=setTimeout(function(){n.nestedMenuBlock=!1},100)}this.hideMenu();this.menuElements=[]}l.forEach(function(t){var l=document.createElement("div"),a=t.label,r=t.disabled;if(t.separator){l.classList.add("tabulator-menu-separator")}else{l.classList.add("tabulator-menu-item");if("function"==typeof a){a=a.call(n.table,o.getComponent())}if(a instanceof Node){l.appendChild(a)}else{l.innerHTML=a}if("function"==typeof r){r=r.call(n.table,o.getComponent())}if(r){l.classList.add("tabulator-menu-item-disabled");l.addEventListener("click",function(t){t.stopPropagation()})}else{if(t.menu&&t.menu.length){l.addEventListener("click",function(a){a.stopPropagation();n.hideOldSubMenus(s);n.loadMenu(a,o,t.menu,l)})}else{if(t.action){l.addEventListener("click",function(l){t.action(l,o.getComponent())})}}}if(t.menu&&t.menu.length){l.classList.add("tabulator-menu-item-submenu")}}s.appendChild(l)});s.addEventListener("click",function(){n.hideMenu()});this.menuElements.push(s);this.positionMenu(s,a,r,t)};B.prototype.hideOldSubMenus=function(t){var o=this.menuElements.indexOf(t);if(-1<o){for(var l=this.menuElements.length-1,a;l>o;l--){a=this.menuElements[l];if(a.parentNode){a.parentNode.removeChild(a)}this.menuElements.pop()}}};B.prototype.positionMenu=function(t,o,l,a){var n=this,r=Math.max(document.body.offsetHeight,window.innerHeight),s,d,p;if(!o){s=l?a.touches[0].pageX:a.pageX;d=l?a.touches[0].pageY:a.pageY;this.positionReversedX=!1}else{p=u.prototype.helpers.elOffset(o);s=p.left+o.offsetWidth;d=p.top-1}t.style.top=d+"px";t.style.left=s+"px";setTimeout(function(){n.table.rowManager.element.addEventListener("scroll",n.blurEvent);document.body.addEventListener("click",n.blurEvent);document.body.addEventListener("contextmenu",n.blurEvent);window.addEventListener("resize",n.blurEvent);document.body.addEventListener("keydown",n.escEvent)},100);document.body.appendChild(t);if(d+t.offsetHeight>=r){t.style.top="";if(o){t.style.bottom=r-p.top-o.offsetHeight-1+"px"}else{t.style.bottom=r-d+"px"}}if(s+t.offsetWidth>=document.body.offsetWidth||this.positionReversedX){t.style.left="";if(o){t.style.right=document.documentElement.offsetWidth-p.left+"px"}else{t.style.right=document.documentElement.offsetWidth-s+"px"}this.positionReversedX=!0}};B.prototype.isOpen=function(){return!!this.menuElements.length};B.prototype.escMenu=function(t){if(27==t.keyCode){this.hideMenu()}};B.prototype.hideMenu=function(){this.menuElements.forEach(function(t){if(t.parentNode){t.parentNode.removeChild(t)}});document.body.removeEventListener("keydown",this.escEvent);document.body.removeEventListener("click",this.blurEvent);document.body.removeEventListener("contextmenu",this.blurEvent);window.removeEventListener("resize",this.blurEvent);this.table.rowManager.element.removeEventListener("scroll",this.blurEvent)};B.prototype.menus={};u.prototype.registerModule("menu",B);var I=function(t){this.table=t;this.placeholderElement=this.createPlaceholderElement();this.hoverElement=!1;this.checkTimeout=!1;this.checkPeriod=250;this.moving=!1;this.toCol=!1;this.toColAfter=!1;this.startX=0;this.autoScrollMargin=40;this.autoScrollStep=5;this.autoScrollTimeout=!1;this.touchMove=!1;this.moveHover=this.moveHover.bind(this);this.endMove=this.endMove.bind(this)};I.prototype.createPlaceholderElement=function(){var t=document.createElement("div");t.classList.add("tabulator-col");t.classList.add("tabulator-col-placeholder");return t};I.prototype.initializeColumn=function(t){var o=this,l={},a;if(!t.modules.frozen){a=t.getElement();l.mousemove=function(l){if(t.parent===o.moving.parent){if((o.touchMove?l.touches[0].pageX:l.pageX)-u.prototype.helpers.elOffset(a).left+o.table.columnManager.element.scrollLeft>t.getWidth()/2){if(o.toCol!==t||!o.toColAfter){a.parentNode.insertBefore(o.placeholderElement,a.nextSibling);o.moveColumn(t,!0)}}else{if(o.toCol!==t||o.toColAfter){a.parentNode.insertBefore(o.placeholderElement,a);o.moveColumn(t,!1)}}}}.bind(o);a.addEventListener("mousedown",function(l){o.touchMove=!1;if(1===l.which){o.checkTimeout=setTimeout(function(){o.startMove(l,t)},o.checkPeriod)}});a.addEventListener("mouseup",function(t){if(1===t.which){if(o.checkTimeout){clearTimeout(o.checkTimeout)}}});o.bindTouchEvents(t)}t.modules.moveColumn=l};I.prototype.bindTouchEvents=function(t){var o=this,l=t.getElement(),a=!1,n,r,s,d,p,c;l.addEventListener("touchstart",function(l){o.checkTimeout=setTimeout(function(){o.touchMove=!0;n=t.nextColumn();s=n?n.getWidth()/2:0;r=t.prevColumn();d=r?r.getWidth()/2:0;p=0;c=0;a=!1;o.startMove(l,t)},o.checkPeriod)},{passive:!0});l.addEventListener("touchmove",function(l){var u,m;if(o.moving){o.moveHover(l);if(!a){a=l.touches[0].pageX}u=l.touches[0].pageX-a;if(0<u){if(n&&u-p>s){m=n;if(m!==t){a=l.touches[0].pageX;m.getElement().parentNode.insertBefore(o.placeholderElement,m.getElement().nextSibling);o.moveColumn(m,!0)}}}else{if(r&&-u-c>d){m=r;if(m!==t){a=l.touches[0].pageX;m.getElement().parentNode.insertBefore(o.placeholderElement,m.getElement());o.moveColumn(m,!1)}}}if(m){n=m.nextColumn();p=s;s=n?n.getWidth()/2:0;r=m.prevColumn();c=d;d=r?r.getWidth()/2:0}}},{passive:!0});l.addEventListener("touchend",function(t){if(o.checkTimeout){clearTimeout(o.checkTimeout)}if(o.moving){o.endMove(t)}})};I.prototype.startMove=function(t,o){var l=o.getElement();this.moving=o;this.startX=(this.touchMove?t.touches[0].pageX:t.pageX)-u.prototype.helpers.elOffset(l).left;this.table.element.classList.add("tabulator-block-select");this.placeholderElement.style.width=o.getWidth()+"px";this.placeholderElement.style.height=o.getHeight()+"px";l.parentNode.insertBefore(this.placeholderElement,l);l.parentNode.removeChild(l);this.hoverElement=l.cloneNode(!0);this.hoverElement.classList.add("tabulator-moving");this.table.columnManager.getElement().appendChild(this.hoverElement);this.hoverElement.style.left="0";this.hoverElement.style.bottom="0";if(!this.touchMove){this._bindMouseMove();document.body.addEventListener("mousemove",this.moveHover);document.body.addEventListener("mouseup",this.endMove)}this.moveHover(t)};I.prototype._bindMouseMove=function(){this.table.columnManager.columnsByIndex.forEach(function(t){if(t.modules.moveColumn.mousemove){t.getElement().addEventListener("mousemove",t.modules.moveColumn.mousemove)}})};I.prototype._unbindMouseMove=function(){this.table.columnManager.columnsByIndex.forEach(function(t){if(t.modules.moveColumn.mousemove){t.getElement().removeEventListener("mousemove",t.modules.moveColumn.mousemove)}})};I.prototype.moveColumn=function(t,o){var l=this.moving.getCells();this.toCol=t;this.toColAfter=o;if(o){t.getCells().forEach(function(t,o){var a=t.getElement(!0);a.parentNode.insertBefore(l[o].getElement(),a.nextSibling)})}else{t.getCells().forEach(function(t,o){var a=t.getElement(!0);a.parentNode.insertBefore(l[o].getElement(),a)})}};I.prototype.endMove=function(t){if(1===t.which||this.touchMove){this._unbindMouseMove();this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling);this.placeholderElement.parentNode.removeChild(this.placeholderElement);this.hoverElement.parentNode.removeChild(this.hoverElement);this.table.element.classList.remove("tabulator-block-select");if(this.toCol){this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter)}this.moving=!1;this.toCol=!1;this.toColAfter=!1;if(!this.touchMove){document.body.removeEventListener("mousemove",this.moveHover);document.body.removeEventListener("mouseup",this.endMove)}}};I.prototype.moveHover=function(t){var o=this,l=o.table.columnManager.getElement(),a=l.scrollLeft,n=(o.touchMove?t.touches[0].pageX:t.pageX)-u.prototype.helpers.elOffset(l).left+a,r;o.hoverElement.style.left=n-o.startX+"px";if(n-a<o.autoScrollMargin){if(!o.autoScrollTimeout){o.autoScrollTimeout=setTimeout(function(){r=Math.max(0,a-5);o.table.rowManager.getElement().scrollLeft=r;o.autoScrollTimeout=!1},1)}}if(a+l.clientWidth-n<o.autoScrollMargin){if(!o.autoScrollTimeout){o.autoScrollTimeout=setTimeout(function(){r=Math.min(l.clientWidth,a+5);o.table.rowManager.getElement().scrollLeft=r;o.autoScrollTimeout=!1},1)}}};u.prototype.registerModule("moveColumn",I);var N=function(t){this.table=t;this.placeholderElement=this.createPlaceholderElement();this.hoverElement=!1;this.checkTimeout=!1;this.checkPeriod=150;this.moving=!1;this.toRow=!1;this.toRowAfter=!1;this.hasHandle=!1;this.startY=0;this.startX=0;this.moveHover=this.moveHover.bind(this);this.endMove=this.endMove.bind(this);this.tableRowDropEvent=!1;this.touchMove=!1;this.connection=!1;this.connectionSelectorsTables=!1;this.connectionSelectorsElements=!1;this.connectionElements=[];this.connections=[];this.connectedTable=!1;this.connectedRow=!1};N.prototype.createPlaceholderElement=function(){var t=document.createElement("div");t.classList.add("tabulator-row");t.classList.add("tabulator-row-placeholder");return t};N.prototype.initialize=function(){this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables;this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements;this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements};N.prototype.setHandle=function(t){this.hasHandle=t};N.prototype.initializeGroupHeader=function(t){var o=this,l={};l.mouseup=function(t){o.tableRowDrop(t,row)}.bind(o);l.mousemove=function(l){if(l.pageY-u.prototype.helpers.elOffset(t.element).top+o.table.rowManager.element.scrollTop>t.getHeight()/2){if(o.toRow!==t||!o.toRowAfter){var a=t.getElement();a.parentNode.insertBefore(o.placeholderElement,a.nextSibling);o.moveRow(t,!0)}}else{if(o.toRow!==t||o.toRowAfter){var a=t.getElement();if(a.previousSibling){a.parentNode.insertBefore(o.placeholderElement,a);o.moveRow(t,!1)}}}}.bind(o);t.modules.moveRow=l};N.prototype.initializeRow=function(t){var o=this,l={},a;l.mouseup=function(l){o.tableRowDrop(l,t)}.bind(o);l.mousemove=function(l){var a=t.getElement();if(l.pageY-u.prototype.helpers.elOffset(a).top+o.table.rowManager.element.scrollTop>t.getHeight()/2){if(o.toRow!==t||!o.toRowAfter){a.parentNode.insertBefore(o.placeholderElement,a.nextSibling);o.moveRow(t,!0)}}else{if(o.toRow!==t||o.toRowAfter){a.parentNode.insertBefore(o.placeholderElement,a);o.moveRow(t,!1)}}}.bind(o);if(!this.hasHandle){a=t.getElement();a.addEventListener("mousedown",function(l){if(1===l.which){o.checkTimeout=setTimeout(function(){o.startMove(l,t)},o.checkPeriod)}});a.addEventListener("mouseup",function(t){if(1===t.which){if(o.checkTimeout){clearTimeout(o.checkTimeout)}}});this.bindTouchEvents(t,t.getElement())}t.modules.moveRow=l};N.prototype.initializeCell=function(t){var o=this,l=t.getElement(!0);l.addEventListener("mousedown",function(l){if(1===l.which){o.checkTimeout=setTimeout(function(){o.startMove(l,t.row)},o.checkPeriod)}});l.addEventListener("mouseup",function(t){if(1===t.which){if(o.checkTimeout){clearTimeout(o.checkTimeout)}}});this.bindTouchEvents(t.row,l)};N.prototype.bindTouchEvents=function(t,o){var l=this,a=!1,n,r,s,d,p,c;o.addEventListener("touchstart",function(o){l.checkTimeout=setTimeout(function(){l.touchMove=!0;n=t.nextRow();s=n?n.getHeight()/2:0;r=t.prevRow();d=r?r.getHeight()/2:0;p=0;c=0;a=!1;l.startMove(o,t)},l.checkPeriod)},{passive:!0});this.moving,this.toRow,this.toRowAfter;o.addEventListener("touchmove",function(o){var u,m;if(l.moving){o.preventDefault();l.moveHover(o);if(!a){a=o.touches[0].pageY}u=o.touches[0].pageY-a;if(0<u){if(n&&u-p>s){m=n;if(m!==t){a=o.touches[0].pageY;m.getElement().parentNode.insertBefore(l.placeholderElement,m.getElement().nextSibling);l.moveRow(m,!0)}}}else{if(r&&-u-c>d){m=r;if(m!==t){a=o.touches[0].pageY;m.getElement().parentNode.insertBefore(l.placeholderElement,m.getElement());l.moveRow(m,!1)}}}if(m){n=m.nextRow();p=s;s=n?n.getHeight()/2:0;r=m.prevRow();c=d;d=r?r.getHeight()/2:0}}});o.addEventListener("touchend",function(t){if(l.checkTimeout){clearTimeout(l.checkTimeout)}if(l.moving){l.endMove(t);l.touchMove=!1}})};N.prototype._bindMouseMove=function(){var t=this;t.table.rowManager.getDisplayRows().forEach(function(t){if(("row"===t.type||"group"===t.type)&&t.modules.moveRow.mousemove){t.getElement().addEventListener("mousemove",t.modules.moveRow.mousemove)}})};N.prototype._unbindMouseMove=function(){var t=this;t.table.rowManager.getDisplayRows().forEach(function(t){if(("row"===t.type||"group"===t.type)&&t.modules.moveRow.mousemove){t.getElement().removeEventListener("mousemove",t.modules.moveRow.mousemove)}})};N.prototype.startMove=function(t,o){var l=o.getElement();this.setStartPosition(t,o);this.moving=o;this.table.element.classList.add("tabulator-block-select");this.placeholderElement.style.width=o.getWidth()+"px";this.placeholderElement.style.height=o.getHeight()+"px";if(!this.connection){l.parentNode.insertBefore(this.placeholderElement,l);l.parentNode.removeChild(l)}else{this.table.element.classList.add("tabulator-movingrow-sending");this.connectToTables(o)}this.hoverElement=l.cloneNode(!0);this.hoverElement.classList.add("tabulator-moving");if(this.connection){document.body.appendChild(this.hoverElement);this.hoverElement.style.left="0";this.hoverElement.style.top="0";this.hoverElement.style.width=this.table.element.clientWidth+"px";this.hoverElement.style.whiteSpace="nowrap";this.hoverElement.style.overflow="hidden";this.hoverElement.style.pointerEvents="none"}else{this.table.rowManager.getTableElement().appendChild(this.hoverElement);this.hoverElement.style.left="0";this.hoverElement.style.top="0";this._bindMouseMove()}document.body.addEventListener("mousemove",this.moveHover);document.body.addEventListener("mouseup",this.endMove);this.moveHover(t)};N.prototype.setStartPosition=function(t,o){var l=this.touchMove?t.touches[0].pageX:t.pageX,a=this.touchMove?t.touches[0].pageY:t.pageY,n,r;n=o.getElement();if(this.connection){r=n.getBoundingClientRect();this.startX=r.left-l+window.pageXOffset;this.startY=r.top-a+window.pageYOffset}else{this.startY=a-n.getBoundingClientRect().top}};N.prototype.endMove=function(t){if(!t||1===t.which||this.touchMove){this._unbindMouseMove();if(!this.connection){this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling);this.placeholderElement.parentNode.removeChild(this.placeholderElement)}this.hoverElement.parentNode.removeChild(this.hoverElement);this.table.element.classList.remove("tabulator-block-select");if(this.toRow){this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter)}this.moving=!1;this.toRow=!1;this.toRowAfter=!1;document.body.removeEventListener("mousemove",this.moveHover);document.body.removeEventListener("mouseup",this.endMove);if(this.connection){this.table.element.classList.remove("tabulator-movingrow-sending");this.disconnectFromTables()}}};N.prototype.moveRow=function(t,o){this.toRow=t;this.toRowAfter=o};N.prototype.moveHover=function(t){if(this.connection){this.moveHoverConnections.call(this,t)}else{this.moveHoverTable.call(this,t)}};N.prototype.moveHoverTable=function(t){var o=this.table.rowManager.getElement(),l=o.scrollTop,a=(this.touchMove?t.touches[0].pageY:t.pageY)-o.getBoundingClientRect().top+l;this.hoverElement.style.top=a-this.startY+"px"};N.prototype.moveHoverConnections=function(t){this.hoverElement.style.left=this.startX+(this.touchMove?t.touches[0].pageX:t.pageX)+"px";this.hoverElement.style.top=this.startY+(this.touchMove?t.touches[0].pageY:t.pageY)+"px"};N.prototype.elementRowDrop=function(t,o,l){if(this.table.options.movableRowsElementDrop){this.table.options.movableRowsElementDrop(t,o,l?l.getComponent():!1)}};N.prototype.connectToTables=function(t){var o=this,l;if(this.connectionSelectorsTables){l=this.table.modules.comms.getConnections(this.connectionSelectorsTables);this.table.options.movableRowsSendingStart.call(this.table,l);this.table.modules.comms.send(this.connectionSelectorsTables,"moveRow","connect",{row:t})}if(this.connectionSelectorsElements){this.connectionElements=[];if(!Array.isArray(this.connectionSelectorsElements)){this.connectionSelectorsElements=[this.connectionSelectorsElements]}this.connectionSelectorsElements.forEach(function(t){if("string"==typeof t){o.connectionElements=o.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(t)))}else{o.connectionElements.push(t)}});this.connectionElements.forEach(function(t){var l=function(l){o.elementRowDrop(l,t,o.moving)};t.addEventListener("mouseup",l);t.tabulatorElementDropEvent=l;t.classList.add("tabulator-movingrow-receiving")})}};N.prototype.disconnectFromTables=function(){var t;if(this.connectionSelectorsTables){t=this.table.modules.comms.getConnections(this.connectionSelectorsTables);this.table.options.movableRowsSendingStop.call(this.table,t);this.table.modules.comms.send(this.connectionSelectorsTables,"moveRow","disconnect")}this.connectionElements.forEach(function(t){t.classList.remove("tabulator-movingrow-receiving");t.removeEventListener("mouseup",t.tabulatorElementDropEvent);delete t.tabulatorElementDropEvent})};N.prototype.connect=function(t,o){var l=this;if(!this.connectedTable){this.connectedTable=t;this.connectedRow=o;this.table.element.classList.add("tabulator-movingrow-receiving");l.table.rowManager.getDisplayRows().forEach(function(t){if("row"===t.type&&t.modules.moveRow&&t.modules.moveRow.mouseup){t.getElement().addEventListener("mouseup",t.modules.moveRow.mouseup)}});l.tableRowDropEvent=l.tableRowDrop.bind(l);l.table.element.addEventListener("mouseup",l.tableRowDropEvent);this.table.options.movableRowsReceivingStart.call(this.table,o,t);return!0}else{console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable);return!1}};N.prototype.disconnect=function(t){var o=this;if(t===this.connectedTable){this.connectedTable=!1;this.connectedRow=!1;this.table.element.classList.remove("tabulator-movingrow-receiving");o.table.rowManager.getDisplayRows().forEach(function(t){if("row"===t.type&&t.modules.moveRow&&t.modules.moveRow.mouseup){t.getElement().removeEventListener("mouseup",t.modules.moveRow.mouseup)}});o.table.element.removeEventListener("mouseup",o.tableRowDropEvent);this.table.options.movableRowsReceivingStop.call(this.table,t)}else{console.warn("Move Row Error - trying to disconnect from non connected table")}};N.prototype.dropComplete=function(t,o,l){var a=!1;if(l){switch(_typeof(this.table.options.movableRowsSender)){case"string":a=this.senders[this.table.options.movableRowsSender];break;case"function":a=this.table.options.movableRowsSender;break;}if(a){a.call(this,this.moving.getComponent(),o?o.getComponent():void 0,t)}else{if(this.table.options.movableRowsSender){console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender)}}this.table.options.movableRowsSent.call(this.table,this.moving.getComponent(),o?o.getComponent():void 0,t)}else{this.table.options.movableRowsSentFailed.call(this.table,this.moving.getComponent(),o?o.getComponent():void 0,t)}this.endMove()};N.prototype.tableRowDrop=function(t,o){var l=!1,a=!1;t.stopImmediatePropagation();switch(_typeof(this.table.options.movableRowsReceiver)){case"string":l=this.receivers[this.table.options.movableRowsReceiver];break;case"function":l=this.table.options.movableRowsReceiver;break;}if(l){a=l.call(this,this.connectedRow.getComponent(),o?o.getComponent():void 0,this.connectedTable)}else{console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver)}if(a){this.table.options.movableRowsReceived.call(this.table,this.connectedRow.getComponent(),o?o.getComponent():void 0,this.connectedTable)}else{this.table.options.movableRowsReceivedFailed.call(this.table,this.connectedRow.getComponent(),o?o.getComponent():void 0,this.connectedTable)}this.table.modules.comms.send(this.connectedTable,"moveRow","dropcomplete",{row:o,success:a})};N.prototype.receivers={insert:function(t,o){this.table.addRow(t.getData(),void 0,o);return!0},add:function(t){this.table.addRow(t.getData());return!0},update:function(t,o){if(o){o.update(t.getData());return!0}return!1},replace:function(t,o){if(o){this.table.addRow(t.getData(),void 0,o);o.delete();return!0}return!1}};N.prototype.senders={delete:function(t){t.delete()}};N.prototype.commsReceived=function(t,o,l){switch(o){case"connect":return this.connect(t,l.row);break;case"disconnect":return this.disconnect(t);break;case"dropcomplete":return this.dropComplete(t,l.row,l.success);break;}};u.prototype.registerModule("moveRow",N);var V=function(t){this.table=t;this.allowedTypes=["","data","edit","clipboard"];this.enabled=!0};V.prototype.initializeColumn=function(t){var o=this,l=!1,a={};this.allowedTypes.forEach(function(n){var r="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),s;if(t.definition[r]){s=o.lookupMutator(t.definition[r]);if(s){l=!0;a[r]={mutator:s,params:t.definition[r+"Params"]||{}}}}});if(l){t.modules.mutate=a}};V.prototype.lookupMutator=function(t){var o=!1;switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":if(this.mutators[t]){o=this.mutators[t]}else{console.warn("Mutator Error - No such mutator found, ignoring: ",t)}break;case"function":o=t;break;}return o};V.prototype.transformRow=function(t,o,l){var a=this,n="mutator"+(o.charAt(0).toUpperCase()+o.slice(1)),r;if(this.enabled){a.table.columnManager.traverse(function(a){var s,d,p;if(a.modules.mutate){s=a.modules.mutate[n]||a.modules.mutate.mutator||!1;if(s){r=a.getFieldValue("undefined"!=typeof l?l:t);if("data"==o||"undefined"!=typeof r){p=a.getComponent();d="function"==typeof s.params?s.params(r,t,o,p):s.params;a.setFieldValue(t,s.mutator(r,t,o,d,p))}}}})}return t};V.prototype.transformCell=function(t,o){var l=t.column.modules.mutate.mutatorEdit||t.column.modules.mutate.mutator||!1,a={};if(l){a=Object.assign(a,t.row.getData());t.column.setFieldValue(a,o);return l.mutator(o,a,"edit",l.params,t.getComponent())}else{return o}};V.prototype.enable=function(){this.enabled=!0};V.prototype.disable=function(){this.enabled=!1};V.prototype.mutators={};u.prototype.registerModule("mutator",V);var W=function(t){this.table=t;this.mode="local";this.progressiveLoad=!1;this.size=0;this.page=1;this.count=5;this.max=1;this.displayIndex=0;this.initialLoad=!0;this.pageSizes=[];this.dataReceivedNames={};this.dataSentNames={};this.createElements()};W.prototype.createElements=function(){var t;this.element=document.createElement("span");this.element.classList.add("tabulator-paginator");this.pagesElement=document.createElement("span");this.pagesElement.classList.add("tabulator-pages");t=document.createElement("button");t.classList.add("tabulator-page");t.setAttribute("type","button");t.setAttribute("role","button");t.setAttribute("aria-label","");t.setAttribute("title","");this.firstBut=t.cloneNode(!0);this.firstBut.setAttribute("data-page","first");this.prevBut=t.cloneNode(!0);this.prevBut.setAttribute("data-page","prev");this.nextBut=t.cloneNode(!0);this.nextBut.setAttribute("data-page","next");this.lastBut=t.cloneNode(!0);this.lastBut.setAttribute("data-page","last");if(this.table.options.paginationSizeSelector){this.pageSizeSelect=document.createElement("select");this.pageSizeSelect.classList.add("tabulator-page-size")}};W.prototype.generatePageSizeSelectList=function(){var t=this,o=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector)){o=this.table.options.paginationSizeSelector;this.pageSizes=o;if(-1==this.pageSizes.indexOf(this.size)){o.unshift(this.size)}}else{if(-1==this.pageSizes.indexOf(this.size)){o=[];for(var l=1;5>l;l++){o.push(this.size*l)}this.pageSizes=o}else{o=this.pageSizes}}while(this.pageSizeSelect.firstChild){this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild)}o.forEach(function(o){var l=document.createElement("option");l.value=o;if(!0===o){t.table.modules.localize.bind("pagination|all",function(t){l.innerHTML=t})}else{l.innerHTML=o}t.pageSizeSelect.appendChild(l)});this.pageSizeSelect.value=this.size}};W.prototype.initialize=function(t){var o=this,l,a,n;this.dataSentNames=Object.assign({},this.paginationDataSentNames);this.dataSentNames=Object.assign(this.dataSentNames,this.table.options.paginationDataSent);this.dataReceivedNames=Object.assign({},this.paginationDataReceivedNames);this.dataReceivedNames=Object.assign(this.dataReceivedNames,this.table.options.paginationDataReceived);o.table.modules.localize.bind("pagination|first",function(t){o.firstBut.innerHTML=t});o.table.modules.localize.bind("pagination|first_title",function(t){o.firstBut.setAttribute("aria-label",t);o.firstBut.setAttribute("title",t)});o.table.modules.localize.bind("pagination|prev",function(t){o.prevBut.innerHTML=t});o.table.modules.localize.bind("pagination|prev_title",function(t){o.prevBut.setAttribute("aria-label",t);o.prevBut.setAttribute("title",t)});o.table.modules.localize.bind("pagination|next",function(t){o.nextBut.innerHTML=t});o.table.modules.localize.bind("pagination|next_title",function(t){o.nextBut.setAttribute("aria-label",t);o.nextBut.setAttribute("title",t)});o.table.modules.localize.bind("pagination|last",function(t){o.lastBut.innerHTML=t});o.table.modules.localize.bind("pagination|last_title",function(t){o.lastBut.setAttribute("aria-label",t);o.lastBut.setAttribute("title",t)});o.firstBut.addEventListener("click",function(){o.setPage(1).then(function(){}).catch(function(){})});o.prevBut.addEventListener("click",function(){o.previousPage().then(function(){}).catch(function(){})});o.nextBut.addEventListener("click",function(){o.nextPage().then(function(){}).catch(function(){})});o.lastBut.addEventListener("click",function(){o.setPage(o.max).then(function(){}).catch(function(){})});if(o.table.options.paginationElement){o.element=o.table.options.paginationElement}if(this.pageSizeSelect){l=document.createElement("label");o.table.modules.localize.bind("pagination|page_size",function(t){o.pageSizeSelect.setAttribute("aria-label",t);o.pageSizeSelect.setAttribute("title",t);l.innerHTML=t});o.element.appendChild(l);o.element.appendChild(o.pageSizeSelect);o.pageSizeSelect.addEventListener("change",function(){o.setPageSize("true"==o.pageSizeSelect.value?!0:o.pageSizeSelect.value);o.setPage(1).then(function(){}).catch(function(){})})}o.element.appendChild(o.firstBut);o.element.appendChild(o.prevBut);o.element.appendChild(o.pagesElement);o.element.appendChild(o.nextBut);o.element.appendChild(o.lastBut);if(!o.table.options.paginationElement&&!t){o.table.footerManager.append(o.element,o)}o.mode=o.table.options.pagination;if(o.table.options.paginationSize){o.size=o.table.options.paginationSize}else{a=document.createElement("div");a.classList.add("tabulator-row");a.style.visibility=t;n=document.createElement("div");n.classList.add("tabulator-cell");n.innerHTML="Page Row Test";a.appendChild(n);o.table.rowManager.getTableElement().appendChild(a);o.size=Math.floor(o.table.rowManager.getElement().clientHeight/a.offsetHeight);o.table.rowManager.getTableElement().removeChild(a)}o.count=o.table.options.paginationButtonCount;o.generatePageSizeSelectList()};W.prototype.initializeProgressive=function(t){this.initialize(!0);this.mode="progressive_"+t;this.progressiveLoad=!0};W.prototype.setDisplayIndex=function(t){this.displayIndex=t};W.prototype.getDisplayIndex=function(){return this.displayIndex};W.prototype.setMaxRows=function(t){if(!t){this.max=1}else{this.max=!0===this.size?1:Math.ceil(t/this.size)}if(this.page>this.max){this.page=this.max}};W.prototype.reset=function(t,o){if("local"==this.mode||t){this.page=1}if(o){this.initialLoad=!0}return!0};W.prototype.setMaxPage=function(t){t=parseInt(t);this.max=t||1;if(this.page>this.max){this.page=this.max;this.trigger()}};W.prototype.setPage=function(t){var o=this,l=this;switch(t){case"first":return this.setPage(1);break;case"prev":return this.previousPage();break;case"next":return this.nextPage();break;case"last":return this.setPage(this.max);break;}return new Promise(function(a,n){t=parseInt(t);if(0<t&&t<=o.max||"local"!==o.mode){o.page=t;o.trigger().then(function(){a()}).catch(function(){n()});if(l.table.options.persistence&&l.table.modExists("persistence",!0)&&l.table.modules.persistence.config.page){l.table.modules.persistence.save("page")}}else{console.warn("Pagination Error - Requested page is out of range of 1 - "+o.max+":",t);n()}})};W.prototype.setPageToRow=function(t){var o=this;return new Promise(function(l,a){var n=o.table.rowManager.getDisplayRows(o.displayIndex-1),r=n.indexOf(t);if(-1<r){var s=!0===o.size?1:Math.ceil((r+1)/o.size);o.setPage(s).then(function(){l()}).catch(function(){a()})}else{console.warn("Pagination Error - Requested row is not visible");a()}})};W.prototype.setPageSize=function(t){if(!0!==t){t=parseInt(t)}if(0<t){this.size=t}if(this.pageSizeSelect){this.generatePageSizeSelectList()}if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.page){this.table.modules.persistence.save("page")}};W.prototype._setPageButtons=function(){var t=this,o=Math.floor((this.count-1)/2),l=Math.ceil((this.count-1)/2),a=this.max-this.page+o+1<this.count?this.max-this.count+1:Math.max(this.page-o,1),n=this.page<=l?Math.min(this.count,this.max):Math.min(this.page+l,this.max);while(t.pagesElement.firstChild){t.pagesElement.removeChild(t.pagesElement.firstChild)}if(1==t.page){t.firstBut.disabled=!0;t.prevBut.disabled=!0}else{t.firstBut.disabled=!1;t.prevBut.disabled=!1}if(t.page==t.max){t.lastBut.disabled=!0;t.nextBut.disabled=!0}else{t.lastBut.disabled=!1;t.nextBut.disabled=!1}for(var r=a;r<=n;r++){if(0<r&&r<=t.max){t.pagesElement.appendChild(t._generatePageButton(r))}}this.footerRedraw()};W.prototype._generatePageButton=function(t){var o=this,l=document.createElement("button");l.classList.add("tabulator-page");if(t==o.page){l.classList.add("active")}l.setAttribute("type","button");l.setAttribute("role","button");o.table.modules.localize.bind("pagination|page_title",function(o){l.setAttribute("aria-label",o+" "+t);l.setAttribute("title",o+" "+t)});l.setAttribute("data-page",t);l.textContent=t;l.addEventListener("click",function(){o.setPage(t).then(function(){}).catch(function(){})});return l};W.prototype.previousPage=function(){var t=this;return new Promise(function(o,l){if(1<t.page){t.page--;t.trigger().then(function(){o()}).catch(function(){l()});if(t.table.options.persistence&&t.table.modExists("persistence",!0)&&t.table.modules.persistence.config.page){t.table.modules.persistence.save("page")}}else{console.warn("Pagination Error - Previous page would be less than page 1:",0);l()}})};W.prototype.nextPage=function(){var t=this;return new Promise(function(o,l){if(t.page<t.max){t.page++;t.trigger().then(function(){o()}).catch(function(){l()});if(t.table.options.persistence&&t.table.modExists("persistence",!0)&&t.table.modules.persistence.config.page){t.table.modules.persistence.save("page")}}else{if(!t.progressiveLoad){console.warn("Pagination Error - Next page would be greater than maximum page of "+t.max+":",t.max+1)}l()}})};W.prototype.getPage=function(){return this.page};W.prototype.getPageMax=function(){return this.max};W.prototype.getPageSize=function(){return this.size};W.prototype.getMode=function(){return this.mode};W.prototype.getRows=function(t){var o,l,a;if("local"==this.mode){o=[];if(!0===this.size){l=0;a=t.length}else{l=this.size*(this.page-1);a=l+parseInt(this.size)}this._setPageButtons();for(var n=l;n<a;n++){if(t[n]){o.push(t[n])}}return o}else{this._setPageButtons();return t.slice(0)}};W.prototype.trigger=function(){var t=this,o;return new Promise(function(l,a){switch(t.mode){case"local":o=t.table.rowManager.scrollLeft;t.table.rowManager.refreshActiveData("page");t.table.rowManager.scrollHorizontal(o);t.table.options.pageLoaded.call(t.table,t.getPage());l();break;case"remote":case"progressive_load":case"progressive_scroll":t.table.modules.ajax.blockActiveRequest();t._getRemotePage().then(function(){l()}).catch(function(){a()});break;default:console.warn("Pagination Error - no such pagination mode:",t.mode);a();}})};W.prototype._getRemotePage=function(){var t=this,o=this,l,a;return new Promise(function(n,r){if(!o.table.modExists("ajax",!0)){r()}l=u.prototype.helpers.deepClone(o.table.modules.ajax.getParams()||{});a=o.table.modules.ajax.getParams();a[t.dataSentNames.page]=o.page;if(t.size){a[t.dataSentNames.size]=t.size}if(t.table.options.ajaxSorting&&t.table.modExists("sort")){var s=o.table.modules.sort.getSort();s.forEach(function(t){delete t.column});a[t.dataSentNames.sorters]=s}if(t.table.options.ajaxFiltering&&t.table.modExists("filter")){var d=o.table.modules.filter.getFilters(!0,!0);a[t.dataSentNames.filters]=d}o.table.modules.ajax.setParams(a);o.table.modules.ajax.sendRequest(t.progressiveLoad).then(function(t){o._parseRemoteData(t);n()}).catch(function(){r()});o.table.modules.ajax.setParams(l)})};W.prototype._parseRemoteData=function(t){var o=this,l,t,a;if("undefined"==typeof t[this.dataReceivedNames.last_page]){console.warn("Remote Pagination Error - Server response missing '"+this.dataReceivedNames.last_page+"' property")}if(t[this.dataReceivedNames.data]){this.max=parseInt(t[this.dataReceivedNames.last_page])||1;if(this.progressiveLoad){switch(this.mode){case"progressive_load":if(1==this.page){this.table.rowManager.setData(t[this.dataReceivedNames.data],!1,this.initialLoad&&1==this.page)}else{this.table.rowManager.addRows(t[this.dataReceivedNames.data])}if(this.page<this.max){setTimeout(function(){o.nextPage().then(function(){}).catch(function(){})},o.table.options.ajaxProgressiveLoadDelay)}break;case"progressive_scroll":t=this.table.rowManager.getData().concat(t[this.dataReceivedNames.data]);this.table.rowManager.setData(t,!0,this.initialLoad&&1==this.page);a=this.table.options.ajaxProgressiveLoadScrollMargin||2*this.table.rowManager.element.clientHeight;if(o.table.rowManager.element.scrollHeight<=o.table.rowManager.element.clientHeight+a){o.nextPage().then(function(){}).catch(function(){})}break;}}else{l=this.table.rowManager.scrollLeft;this.table.rowManager.setData(t[this.dataReceivedNames.data],!1,this.initialLoad&&1==this.page);this.table.rowManager.scrollHorizontal(l);this.table.columnManager.scrollHorizontal(l);this.table.options.pageLoaded.call(this.table,this.getPage())}this.initialLoad=!1}else{console.warn("Remote Pagination Error - Server response missing '"+this.dataReceivedNames.data+"' property")}};W.prototype.footerRedraw=function(){var t=this.table.footerManager.element;if(0>Math.ceil(t.clientWidth)-t.scrollWidth){this.pagesElement.style.display="none"}else{this.pagesElement.style.display="";if(0>Math.ceil(t.clientWidth)-t.scrollWidth){this.pagesElement.style.display="none"}}};W.prototype.paginationDataSentNames={page:"page",size:"size",sorters:"sorters",filters:"filters"};W.prototype.paginationDataReceivedNames={current_page:"current_page",last_page:"last_page",data:"data"};u.prototype.registerModule("page",W);var O=function(t){this.table=t;this.mode="";this.id="";this.defWatcherBlock=!1;this.config={};this.readFunc=!1;this.writeFunc=!1};O.prototype.localStorageTest=function(){try{window.localStorage.setItem("_tabulator_test","_tabulator_test");window.localStorage.removeItem("_tabulator_test");return!0}catch(t){return!1}};O.prototype.initialize=function(){var t=this.table.options.persistenceMode,o=this.table.options.persistenceID,l;this.mode=!0!==t?t:this.localStorageTest()?"local":"cookie";if(this.table.options.persistenceReaderFunc){if("function"==typeof this.table.options.persistenceReaderFunc){this.readFunc=this.table.options.persistenceReaderFunc}else{if(this.readers[this.table.options.persistenceReaderFunc]){this.readFunc=this.readers[this.table.options.persistenceReaderFunc]}else{console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc)}}}else{if(this.readers[this.mode]){this.readFunc=this.readers[this.mode]}else{console.warn("Persistence Read Error - invalid reader set",this.mode)}}if(this.table.options.persistenceWriterFunc){if("function"==typeof this.table.options.persistenceWriterFunc){this.writeFunc=this.table.options.persistenceWriterFunc}else{if(this.readers[this.table.options.persistenceWriterFunc]){this.writeFunc=this.readers[this.table.options.persistenceWriterFunc]}else{console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc)}}}else{if(this.writers[this.mode]){this.writeFunc=this.writers[this.mode]}else{console.warn("Persistence Write Error - invalid writer set",this.mode)}}this.id="tabulator-"+(o||this.table.element.getAttribute("id")||"");this.config={sort:!0===this.table.options.persistence||this.table.options.persistence.sort,filter:!0===this.table.options.persistence||this.table.options.persistence.filter,group:!0===this.table.options.persistence||this.table.options.persistence.group,page:!0===this.table.options.persistence||this.table.options.persistence.page,columns:!0===this.table.options.persistence?["title","width","visible"]:this.table.options.persistence.columns};if(this.config.page){l=this.retreiveData("page");if(l){if("undefined"!=typeof l.paginationSize&&(!0===this.config.page||this.config.page.size)){this.table.options.paginationSize=l.paginationSize}if("undefined"!=typeof l.paginationInitialPage&&(!0===this.config.page||this.config.page.page)){this.table.options.paginationInitialPage=l.paginationInitialPage}}}if(this.config.group){l=this.retreiveData("group");if(l){if("undefined"!=typeof l.groupBy&&(!0===this.config.group||this.config.group.groupBy)){this.table.options.groupBy=l.groupBy}if("undefined"!=typeof l.groupStartOpen&&(!0===this.config.group||this.config.group.groupStartOpen)){this.table.options.groupStartOpen=l.groupStartOpen}if("undefined"!=typeof l.groupHeader&&(!0===this.config.group||this.config.group.groupHeader)){this.table.options.groupHeader=l.groupHeader}}}if(this.config.columns){this.table.options.columns=this.load("columns",this.table.options.columns)}};O.prototype.initializeColumn=function(t){var o=this,l,a;if(this.config.columns){this.defWatcherBlock=!0;l=t.getDefinition();a=!0===this.config.columns?Object.keys(l):this.config.columns;a.forEach(function(t){var a=Object.getOwnPropertyDescriptor(l,t),n=l[t];if(a){Object.defineProperty(l,t,{set:function(t){n=t;if(!o.defWatcherBlock){o.save("columns")}if(a.set){a.set(t)}},get:function(){if(a.get){a.get()}return n}})}});this.defWatcherBlock=!1}};O.prototype.load=function(t,o){var l=this.retreiveData(t);if(o){l=l?this.mergeDefinition(o,l):o}return l};O.prototype.retreiveData=function(t){return this.readFunc?this.readFunc(this.id,t):!1};O.prototype.mergeDefinition=function(t,o){var l=this,a=[];o=o||[];o.forEach(function(o){var n=l._findColumn(t,o),r;if(n){if(!0===l.config.columns||l.config.columns==void 0){r=Object.keys(n);r.push("width")}else{r=l.config.columns}r.forEach(function(t){if("columns"!==t&&"undefined"!=typeof o[t]){n[t]=o[t]}});if(n.columns){n.columns=l.mergeDefinition(n.columns,o.columns)}a.push(n)}});t.forEach(function(t,n){var r=l._findColumn(o,t);if(!r){if(a.length>n){a.splice(n,0,t)}else{a.push(t)}}});return a};O.prototype._findColumn=function(t,o){var l=o.columns?"group":o.field?"field":"object";return t.find(function(t){switch(l){case"group":return t.title===o.title&&t.columns.length===o.columns.length;break;case"field":return t.field===o.field;break;case"object":return t===o;break;}})};O.prototype.save=function(t){var o={};switch(t){case"columns":o=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":o=this.table.modules.filter.getFilters();break;case"sort":o=this.validateSorters(this.table.modules.sort.getSort());break;case"group":o=this.getGroupConfig();break;case"page":o=this.getPageConfig();break;}if(this.writeFunc){this.writeFunc(this.id,t,o)}};O.prototype.validateSorters=function(t){t.forEach(function(t){t.column=t.field;delete t.field});return t};O.prototype.getGroupConfig=function(){var t={};if(this.config.group){if(!0===this.config.group||this.config.group.groupBy){t.groupBy=this.table.options.groupBy}if(!0===this.config.group||this.config.group.groupStartOpen){t.groupStartOpen=this.table.options.groupStartOpen}if(!0===this.config.group||this.config.group.groupHeader){t.groupHeader=this.table.options.groupHeader}}return t};O.prototype.getPageConfig=function(){var t={};if(this.config.page){if(!0===this.config.page||this.config.page.size){t.paginationSize=this.table.modules.page.getPageSize()}if(!0===this.config.page||this.config.page.page){t.paginationInitialPage=this.table.modules.page.getPage()}}return t};O.prototype.parseColumns=function(t){var o=this,l=[],a=["headerContextMenu","headerMenu","contextMenu","clickMenu"];t.forEach(function(t){var n={},r=t.getDefinition(),s;if(t.isGroup){n.title=r.title;n.columns=o.parseColumns(t.getColumns())}else{n.field=t.getField();if(!0===o.config.columns||o.config.columns==void 0){s=Object.keys(r);s.push("width")}else{s=o.config.columns}s.forEach(function(o){switch(o){case"width":n.width=t.getWidth();break;case"visible":n.visible=t.visible;break;default:if("function"!=typeof r[o]&&-1===a.indexOf(o)){n[o]=r[o]}}})}l.push(n)});return l};O.prototype.readers={local:function(t,o){var l=localStorage.getItem(t+"-"+o);return l?JSON.parse(l):!1},cookie:function t(o,l){var t=document.cookie,a=o+"-"+l,n=t.indexOf(a+"="),r,s;if(-1<n){t=t.substr(n);r=t.indexOf(";");if(-1<r){t=t.substr(0,r)}s=t.replace(a+"=","")}return s?JSON.parse(s):!1}};O.prototype.writers={local:function(t,o,l){localStorage.setItem(t+"-"+o,JSON.stringify(l))},cookie:function(t,o,l){var a=new Date;a.setDate(a.getDate()+1e4);document.cookie=t+"-"+o+"="+JSON.stringify(l)+"; expires="+a.toUTCString()}};u.prototype.registerModule("persistence",O);var j=function(t){this.table=t;this.element=!1;this.manualBlock=!1};j.prototype.initialize=function(){window.addEventListener("beforeprint",this.replaceTable.bind(this));window.addEventListener("afterprint",this.cleanup.bind(this))};j.prototype.replaceTable=function(){if(!this.manualBlock){this.element=document.createElement("div");this.element.classList.add("tabulator-print-table");this.element.appendChild(this.table.modules.export.genereateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print"));this.table.element.style.display="none";this.table.element.parentNode.insertBefore(this.element,this.table.element)}};j.prototype.cleanup=function(){document.body.classList.remove("tabulator-print-fullscreen-hide");if(this.element&&this.element.parentNode){this.element.parentNode.removeChild(this.element);this.table.element.style.display=""}};j.prototype.printFullscreen=function(t,o,l){var a=window.scrollX,n=window.scrollY,r=document.createElement("div"),s=document.createElement("div"),d=this.table.modules.export.genereateTable("undefined"!=typeof l?l:this.table.options.printConfig,"undefined"!=typeof o?o:this.table.options.printStyled,t,"print"),p,c;this.manualBlock=!0;this.element=document.createElement("div");this.element.classList.add("tabulator-print-fullscreen");if(this.table.options.printHeader){r.classList.add("tabulator-print-header");p="function"==typeof this.table.options.printHeader?this.table.options.printHeader.call(this.table):this.table.options.printHeader;if("string"==typeof p){r.innerHTML=p}else{r.appendChild(p)}this.element.appendChild(r)}this.element.appendChild(d);if(this.table.options.printFooter){s.classList.add("tabulator-print-footer");c="function"==typeof this.table.options.printFooter?this.table.options.printFooter.call(this.table):this.table.options.printFooter;if("string"==typeof c){s.innerHTML=c}else{s.appendChild(c)}this.element.appendChild(s)}document.body.classList.add("tabulator-print-fullscreen-hide");document.body.appendChild(this.element);if(this.table.options.printFormatter){this.table.options.printFormatter(this.element,d)}window.print();this.cleanup();window.scrollTo(a,n);this.manualBlock=!1};u.prototype.registerModule("print",j);var G=function(t){this.table=t;this.data=!1;this.blocked=!1;this.origFuncs={};this.currentVersion=0};G.prototype.watchData=function(t){var o=this,l;this.currentVersion++;l=this.currentVersion;o.unwatchData();o.data=t;o.origFuncs.push=t.push;Object.defineProperty(o.data,"push",{enumerable:!1,configurable:!0,value:function(){var a=Array.from(arguments);if(!o.blocked&&l===o.currentVersion){a.forEach(function(t){o.table.rowManager.addRowActual(t,!1)})}return o.origFuncs.push.apply(t,arguments)}});o.origFuncs.unshift=t.unshift;Object.defineProperty(o.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var a=Array.from(arguments);if(!o.blocked&&l===o.currentVersion){a.forEach(function(t){o.table.rowManager.addRowActual(t,!0)})}return o.origFuncs.unshift.apply(t,arguments)}});o.origFuncs.shift=t.shift;Object.defineProperty(o.data,"shift",{enumerable:!1,configurable:!0,value:function(){var a;if(!o.blocked&&l===o.currentVersion){if(o.data.length){a=o.table.rowManager.getRowFromDataObject(o.data[0]);if(a){a.deleteActual()}}}return o.origFuncs.shift.call(t)}});o.origFuncs.pop=t.pop;Object.defineProperty(o.data,"pop",{enumerable:!1,configurable:!0,value:function(){var a;if(!o.blocked&&l===o.currentVersion){if(o.data.length){a=o.table.rowManager.getRowFromDataObject(o.data[o.data.length-1]);if(a){a.deleteActual()}}}return o.origFuncs.pop.call(t)}});o.origFuncs.splice=t.splice;Object.defineProperty(o.data,"splice",{enumerable:!1,configurable:!0,value:function(){var a=Array.from(arguments),n=0>a[0]?t.length+a[0]:a[0],r=a[1],s=a[2]?a.slice(2):!1,d;if(!o.blocked&&l===o.currentVersion){if(s){d=t[n]?o.table.rowManager.getRowFromDataObject(t[n]):!1;if(d){s.forEach(function(t){o.table.rowManager.addRowActual(t,!0,d,!0)})}else{s=s.slice().reverse();s.forEach(function(t){o.table.rowManager.addRowActual(t,!0,!1,!0)})}}if(0!==r){var p=t.slice(n,"undefined"==typeof a[1]?a[1]:n+r);p.forEach(function(t,l){var a=o.table.rowManager.getRowFromDataObject(t);if(a){a.deleteActual(l!==p.length-1)}})}if(s||0!==r){o.table.rowManager.reRenderInPosition()}}return o.origFuncs.splice.apply(t,arguments)}})};G.prototype.unwatchData=function(){if(!1!==this.data){for(var t in this.origFuncs){Object.defineProperty(this.data,t,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}}};G.prototype.watchRow=function(t){var o=t.getData();this.blocked=!0;for(var l in o){this.watchKey(t,o,l)}if(this.table.options.dataTree){this.watchTreeChildren(t)}this.blocked=!1};G.prototype.watchTreeChildren=function(t){var l=this,a=t.getData()[this.table.options.dataTreeChildField],n={};function o(){l.table.modules.dataTree.initializeRow(t);l.table.modules.dataTree.layoutRow(t);l.table.rowManager.refreshActiveData("tree",!1,!0)}if(a){n.push=a.push;Object.defineProperty(a,"push",{enumerable:!1,configurable:!0,value:function(){var t=n.push.apply(a,arguments);o();return t}});n.unshift=a.unshift;Object.defineProperty(a,"unshift",{enumerable:!1,configurable:!0,value:function(){var t=n.unshift.apply(a,arguments);o();return t}});n.shift=a.shift;Object.defineProperty(a,"shift",{enumerable:!1,configurable:!0,value:function(){var t=n.shift.call(a);o();return t}});n.pop=a.pop;Object.defineProperty(a,"pop",{enumerable:!1,configurable:!0,value:function(){var t=n.pop.call(a);o();return t}});n.splice=a.splice;Object.defineProperty(a,"splice",{enumerable:!1,configurable:!0,value:function(){var t=n.splice.apply(a,arguments);o();return t}})}};G.prototype.watchKey=function(t,o,l){var a=this,n=Object.getOwnPropertyDescriptor(o,l),r=o[l],s=this.currentVersion;Object.defineProperty(o,l,{set:function(o){r=o;if(!a.blocked&&s===a.currentVersion){var d={};d[l]=o;t.updateData(d)}if(n.set){n.set(o)}},get:function(){if(n.get){n.get()}return r}})};G.prototype.unwatchRow=function(t){var o=t.getData();for(var l in o){Object.defineProperty(o,l,{value:o[l]})}};G.prototype.block=function(){this.blocked=!0};G.prototype.unblock=function(){this.blocked=!1};u.prototype.registerModule("reactiveData",G);var U=function(t){this.table=t;this.startColumn=!1;this.startX=!1;this.startWidth=!1;this.handle=null;this.prevHandle=null};U.prototype.initializeColumn=function(t,o,l){var a=this,n=!1,r=this.table.options.resizableColumns;if("header"===t){n="textarea"==o.definition.formatter||o.definition.variableHeight;o.modules.resize={variableHeight:n}}if(!0===r||r==t){var s=document.createElement("div");s.className="tabulator-col-resize-handle";var d=document.createElement("div");d.className="tabulator-col-resize-handle prev";s.addEventListener("click",function(t){t.stopPropagation()});var p=function(t){var l=o.getLastColumn();if(l&&a._checkResizability(l)){a.startColumn=o;a._mouseDown(t,l,s)}};s.addEventListener("mousedown",p);s.addEventListener("touchstart",p,{passive:!0});s.addEventListener("dblclick",function(t){var l=o.getLastColumn();if(l&&a._checkResizability(l)){t.stopPropagation();l.reinitializeWidth(!0)}});d.addEventListener("click",function(t){t.stopPropagation()});var c=function(t){var l,n,r;l=o.getFirstColumn();if(l){n=a.table.columnManager.findColumnIndex(l);r=0<n?a.table.columnManager.getColumnByIndex(n-1):!1;if(r&&a._checkResizability(r)){a.startColumn=o;a._mouseDown(t,r,d)}}};d.addEventListener("mousedown",c);d.addEventListener("touchstart",c,{passive:!0});d.addEventListener("dblclick",function(t){var l,n,r;l=o.getFirstColumn();if(l){n=a.table.columnManager.findColumnIndex(l);r=0<n?a.table.columnManager.getColumnByIndex(n-1):!1;if(r&&a._checkResizability(r)){t.stopPropagation();r.reinitializeWidth(!0)}}});l.appendChild(s);l.appendChild(d)}};U.prototype._checkResizability=function(t){return"undefined"!=typeof t.definition.resizable?t.definition.resizable:this.table.options.resizableColumns};U.prototype._mouseDown=function(t,o,l){var r=this;r.table.element.classList.add("tabulator-block-select");function a(t){if(r.table.rtl){o.setWidth(r.startWidth-(("undefined"==typeof t.screenX?t.touches[0].screenX:t.screenX)-r.startX))}else{o.setWidth(r.startWidth+(("undefined"==typeof t.screenX?t.touches[0].screenX:t.screenX)-r.startX))}if(r.table.options.virtualDomHoz){r.table.vdomHoz.reinitialize(!0)}if(!r.table.browserSlow&&o.modules.resize&&o.modules.resize.variableHeight){o.checkCellHeights()}}function n(){if(r.startColumn.modules.edit){r.startColumn.modules.edit.blocked=!1}if(r.table.browserSlow&&o.modules.resize&&o.modules.resize.variableHeight){o.checkCellHeights()}document.body.removeEventListener("mouseup",n);document.body.removeEventListener("mousemove",a);l.removeEventListener("touchmove",a);l.removeEventListener("touchend",n);r.table.element.classList.remove("tabulator-block-select");if(r.table.options.persistence&&r.table.modExists("persistence",!0)&&r.table.modules.persistence.config.columns){r.table.modules.persistence.save("columns")}r.table.options.columnResized.call(r.table,o.getComponent())}t.stopPropagation();if(r.startColumn.modules.edit){r.startColumn.modules.edit.blocked=!0}r.startX="undefined"==typeof t.screenX?t.touches[0].screenX:t.screenX;r.startWidth=o.getWidth();document.body.addEventListener("mousemove",a);document.body.addEventListener("mouseup",n);l.addEventListener("touchmove",a,{passive:!0});l.addEventListener("touchend",n)};u.prototype.registerModule("resizeColumns",U);var Y=function(t){this.table=t;this.startColumn=!1;this.startY=!1;this.startHeight=!1;this.handle=null;this.prevHandle=null};Y.prototype.initializeRow=function(t){var o=this,l=t.getElement(),a=document.createElement("div");a.className="tabulator-row-resize-handle";var n=document.createElement("div");n.className="tabulator-row-resize-handle prev";a.addEventListener("click",function(t){t.stopPropagation()});var r=function(l){o.startRow=t;o._mouseDown(l,t,a)};a.addEventListener("mousedown",r);a.addEventListener("touchstart",r,{passive:!0});n.addEventListener("click",function(t){t.stopPropagation()});var s=function(l){var a=o.table.rowManager.prevDisplayRow(t);if(a){o.startRow=a;o._mouseDown(l,a,n)}};n.addEventListener("mousedown",s);n.addEventListener("touchstart",s,{passive:!0});l.appendChild(a);l.appendChild(n)};Y.prototype._mouseDown=function(t,o,l){var r=this;r.table.element.classList.add("tabulator-block-select");function a(t){o.setHeight(r.startHeight+(("undefined"==typeof t.screenY?t.touches[0].screenY:t.screenY)-r.startY))}function n(){document.body.removeEventListener("mouseup",a);document.body.removeEventListener("mousemove",a);l.removeEventListener("touchmove",a);l.removeEventListener("touchend",n);r.table.element.classList.remove("tabulator-block-select");r.table.options.rowResized.call(this.table,o.getComponent())}t.stopPropagation();r.startY="undefined"==typeof t.screenY?t.touches[0].screenY:t.screenY;r.startHeight=o.getHeight();document.body.addEventListener("mousemove",a);document.body.addEventListener("mouseup",n);l.addEventListener("touchmove",a,{passive:!0});l.addEventListener("touchend",n)};u.prototype.registerModule("resizeRows",Y);var K=function(t){this.table=t;this.binding=!1;this.observer=!1;this.containerObserver=!1;this.tableHeight=0;this.tableWidth=0;this.containerHeight=0;this.containerWidth=0;this.autoResize=!1};K.prototype.initialize=function(){var t=this,o=this.table,l;this.tableHeight=o.element.clientHeight;this.tableWidth=o.element.clientWidth;if(o.element.parentNode){this.containerHeight=o.element.parentNode.clientHeight;this.containerWidth=o.element.parentNode.clientWidth}if("undefined"!=typeof ResizeObserver&&"virtual"===o.rowManager.getRenderMode()){this.autoResize=!0;this.observer=new ResizeObserver(function(l){if(!o.browserMobile||o.browserMobile&&!o.modules.edit.currentCell){var a=Math.floor(l[0].contentRect.height),n=Math.floor(l[0].contentRect.width);if(t.tableHeight!=a||t.tableWidth!=n){t.tableHeight=a;t.tableWidth=n;if(o.element.parentNode){t.containerHeight=o.element.parentNode.clientHeight;t.containerWidth=o.element.parentNode.clientWidth}if(o.options.virtualDomHoz){o.vdomHoz.reinitialize(!0)}o.redraw()}}});this.observer.observe(o.element);l=window.getComputedStyle(o.element);if(this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(l.getPropertyValue("max-height")||l.getPropertyValue("min-height"))){this.containerObserver=new ResizeObserver(function(l){if(!o.browserMobile||o.browserMobile&&!o.modules.edit.currentCell){var a=Math.floor(l[0].contentRect.height),n=Math.floor(l[0].contentRect.width);if(t.containerHeight!=a||t.containerWidth!=n){t.containerHeight=a;t.containerWidth=n;t.tableHeight=o.element.clientHeight;t.tableWidth=o.element.clientWidth}if(o.options.virtualDomHoz){o.vdomHoz.reinitialize(!0)}o.redraw()}});this.containerObserver.observe(this.table.element.parentNode)}}else{this.binding=function(){if(!o.browserMobile||o.browserMobile&&!o.modules.edit.currentCell){if(o.options.virtualDomHoz){o.vdomHoz.reinitialize(!0)}o.redraw()}};window.addEventListener("resize",this.binding)}};K.prototype.clearBindings=function(){if(this.binding){window.removeEventListener("resize",this.binding)}if(this.observer){this.observer.unobserve(this.table.element)}if(this.containerObserver){this.containerObserver.unobserve(this.table.element.parentNode)}};u.prototype.registerModule("resizeTable",K);var X=function(t){this.table=t;this.columns=[];this.hiddenColumns=[];this.mode="";this.index=0;this.collapseFormatter=[];this.collapseStartOpen=!0;this.collapseHandleColumn=!1};X.prototype.initialize=function(){var t=this,o=[];this.mode=this.table.options.responsiveLayout;this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData;this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen;this.hiddenColumns=[];this.table.columnManager.columnsByIndex.forEach(function(l,a){if(l.modules.responsive){if(l.modules.responsive.order&&l.modules.responsive.visible){l.modules.responsive.index=a;o.push(l);if(!l.visible&&"collapse"===t.mode){t.hiddenColumns.push(l)}}}});o=o.reverse();o=o.sort(function(t,o){var l=o.modules.responsive.order-t.modules.responsive.order;return l||o.modules.responsive.index-t.modules.responsive.index});this.columns=o;if("collapse"===this.mode){this.generateCollapsedContent()}for(var l=this.table.columnManager.columnsByIndex,a=Array.isArray(l),n=0,l=a?l:l[Symbol.iterator]();;){var r;if(a){if(n>=l.length)break;r=l[n++]}else{n=l.next();if(n.done)break;r=n.value}var s=r;if("responsiveCollapse"==s.definition.formatter){this.collapseHandleColumn=s;break}}if(this.collapseHandleColumn){if(this.hiddenColumns.length){this.collapseHandleColumn.show()}else{this.collapseHandleColumn.hide()}}};X.prototype.initializeColumn=function(t){var o=t.getDefinition();t.modules.responsive={order:"undefined"==typeof o.responsive?1:o.responsive,visible:!1===o.visible?!1:!0}};X.prototype.initializeRow=function(t){var o;if("calc"!==t.type){o=document.createElement("div");o.classList.add("tabulator-responsive-collapse");t.modules.responsiveLayout={element:o,open:this.collapseStartOpen};if(!this.collapseStartOpen){o.style.display="none"}}};X.prototype.layoutRow=function(t){var o=t.getElement();if(t.modules.responsiveLayout){o.appendChild(t.modules.responsiveLayout.element);this.generateCollapsedRowContent(t)}};X.prototype.updateColumnVisibility=function(t,o){if(t.modules.responsive){t.modules.responsive.visible=o;this.initialize()}};X.prototype.hideColumn=function(t){var o=this.hiddenColumns.length;t.hide(!1,!0);if("collapse"===this.mode){this.hiddenColumns.unshift(t);this.generateCollapsedContent();if(this.collapseHandleColumn&&!o){this.collapseHandleColumn.show()}}};X.prototype.showColumn=function(t){var o;t.show(!1,!0);t.setWidth(t.getWidth());if("collapse"===this.mode){o=this.hiddenColumns.indexOf(t);if(-1<o){this.hiddenColumns.splice(o,1)}this.generateCollapsedContent();if(this.collapseHandleColumn&&!this.hiddenColumns.length){this.collapseHandleColumn.hide()}}};X.prototype.update=function(){var t=this,o=!0;while(o){var l="fitColumns"==t.table.modules.layout.getMode()?t.table.columnManager.getFlexBaseWidth():t.table.columnManager.getWidth(),a=(t.table.options.headerVisible?t.table.columnManager.element.clientWidth:t.table.element.clientWidth)-l;if(0>a){var n=t.columns[t.index];if(n){t.hideColumn(n);t.index++}else{o=!1}}else{var r=t.columns[t.index-1];if(r){if(0<a){if(a>=r.getWidth()){t.showColumn(r);t.index--}else{o=!1}}else{o=!1}}else{o=!1}}if(!t.table.rowManager.activeRowsCount){t.table.rowManager.renderEmptyScroll()}}};X.prototype.generateCollapsedContent=function(){var t=this,o=this.table.rowManager.getDisplayRows();o.forEach(function(o){t.generateCollapsedRowContent(o)})};X.prototype.generateCollapsedRowContent=function(t){var o,l;if(t.modules.responsiveLayout){o=t.modules.responsiveLayout.element;while(o.firstChild){o.removeChild(o.firstChild)}l=this.collapseFormatter(this.generateCollapsedRowData(t));if(l){o.appendChild(l)}}};X.prototype.generateCollapsedRowData=function(t){var o=this,l=t.getData(),a=[],n;this.hiddenColumns.forEach(function(r){var s=r.getFieldValue(l);if(r.definition.title&&r.field){if(r.modules.format&&o.table.options.responsiveLayoutCollapseUseFormatters){n={value:!1,data:{},getValue:function(){return s},getData:function(){return l},getElement:function(){return document.createElement("div")},getRow:function(){return t.getComponent()},getColumn:function(){return r.getComponent()}};a.push({field:r.field,title:r.definition.title,value:r.modules.format.formatter.call(o.table.modules.format,n,r.modules.format.params)})}else{a.push({field:r.field,title:r.definition.title,value:s})}}});return a};X.prototype.formatCollapsedData=function(t){var o=document.createElement("table");t.forEach(function(t){var l=document.createElement("tr"),a=document.createElement("td"),n=document.createElement("td"),r,s=document.createElement("strong");a.appendChild(s);this.table.modules.localize.bind("columns|"+t.field,function(o){s.innerText=o||t.title});if(t.value instanceof Node){r=document.createElement("div");r.appendChild(t.value);n.appendChild(r)}else{n.innerHTML=t.value}l.appendChild(a);l.appendChild(n);o.appendChild(l)},this);return Object.keys(t).length?o:""};u.prototype.registerModule("responsiveLayout",X);var q=function(t){this.table=t;this.selecting=!1;this.lastClickedRow=!1;this.selectPrev=[];this.selectedRows=[];this.headerCheckboxElement=null};q.prototype.clearSelectionData=function(t){this.selecting=!1;this.lastClickedRow=!1;this.selectPrev=[];this.selectedRows=[];if(!t){this._rowSelectionChanged()}};q.prototype.initializeRow=function(t){var o=this,l=t.getElement(),a=function t(){setTimeout(function(){o.selecting=!1},50);document.body.removeEventListener("mouseup",t)};t.modules.select={selected:!1};if(o.table.options.selectableCheck.call(this.table,t.getComponent())){l.classList.add("tabulator-selectable");l.classList.remove("tabulator-unselectable");if(o.table.options.selectable&&"highlight"!=o.table.options.selectable){if("click"===o.table.options.selectableRangeMode){l.addEventListener("click",function(l){if(l.shiftKey){o.table._clearSelection();o.lastClickedRow=o.lastClickedRow||t;var a=o.table.rowManager.getDisplayRowIndex(o.lastClickedRow),n=o.table.rowManager.getDisplayRowIndex(t),r=a<=n?a:n,s=a>=n?a:n,d=o.table.rowManager.getDisplayRows().slice(0),p=d.splice(r,s-r+1);if(l.ctrlKey||l.metaKey){p.forEach(function(l){if(l!==o.lastClickedRow){if(!0!==o.table.options.selectable&&!o.isRowSelected(t)){if(o.selectedRows.length<o.table.options.selectable){o.toggleRow(l)}}else{o.toggleRow(l)}}});o.lastClickedRow=t}else{o.deselectRows(void 0,!0);if(!0!==o.table.options.selectable){if(p.length>o.table.options.selectable){p=p.slice(0,o.table.options.selectable)}}o.selectRows(p)}o.table._clearSelection()}else if(l.ctrlKey||l.metaKey){o.toggleRow(t);o.lastClickedRow=t}else{o.deselectRows(void 0,!0);o.selectRows(t);o.lastClickedRow=t}})}else{l.addEventListener("click",function(){if(!o.table.modExists("edit")||!o.table.modules.edit.getCurrentCell()){o.table._clearSelection()}if(!o.selecting){o.toggleRow(t)}});l.addEventListener("mousedown",function(l){if(l.shiftKey){o.table._clearSelection();o.selecting=!0;o.selectPrev=[];document.body.addEventListener("mouseup",a);document.body.addEventListener("keyup",a);o.toggleRow(t);return!1}});l.addEventListener("mouseenter",function(){if(o.selecting){o.table._clearSelection();o.toggleRow(t);if(o.selectPrev[1]==t){o.toggleRow(o.selectPrev[0])}}});l.addEventListener("mouseout",function(){if(o.selecting){o.table._clearSelection();o.selectPrev.unshift(t)}})}}}else{l.classList.add("tabulator-unselectable");l.classList.remove("tabulator-selectable")}};q.prototype.toggleRow=function(t){if(this.table.options.selectableCheck.call(this.table,t.getComponent())){if(t.modules.select&&t.modules.select.selected){this._deselectRow(t)}else{this._selectRow(t)}}};q.prototype.selectRows=function(t){var o=this,l;switch("undefined"==typeof t?"undefined":_typeof(t)){case"undefined":this.table.rowManager.rows.forEach(function(t){o._selectRow(t,!0,!0)});this._rowSelectionChanged();break;case"string":l=this.table.rowManager.findRow(t);if(l){this._selectRow(l,!0,!0)}else{this.table.rowManager.getRows(t).forEach(function(t){o._selectRow(t,!0,!0)})}this._rowSelectionChanged();break;default:if(Array.isArray(t)){t.forEach(function(t){o._selectRow(t,!0,!0)});this._rowSelectionChanged()}else{this._selectRow(t,!1,!0)}break;}};q.prototype._selectRow=function(t,o,l){if(!isNaN(this.table.options.selectable)&&!0!==this.table.options.selectable&&!l){if(this.selectedRows.length>=this.table.options.selectable){if(this.table.options.selectableRollingSelection){this._deselectRow(this.selectedRows[0])}else{return!1}}}var a=this.table.rowManager.findRow(t);if(a){if(-1==this.selectedRows.indexOf(a)){a.getElement().classList.add("tabulator-selected");if(!a.modules.select){a.modules.select={}}a.modules.select.selected=!0;if(a.modules.select.checkboxEl){a.modules.select.checkboxEl.checked=!0}this.selectedRows.push(a);if(this.table.options.dataTreeSelectPropagate){this.childRowSelection(a,!0)}if(!o){this.table.options.rowSelected.call(this.table,a.getComponent())}this._rowSelectionChanged(o)}}else{if(!o){console.warn("Selection Error - No such row found, ignoring selection:"+t)}}};q.prototype.isRowSelected=function(t){return-1!==this.selectedRows.indexOf(t)};q.prototype.deselectRows=function(t,o){var l=this,a;if("undefined"==typeof t){a=l.selectedRows.length;for(var n=0;n<a;n++){l._deselectRow(l.selectedRows[0],!0)}l._rowSelectionChanged(o)}else{if(Array.isArray(t)){t.forEach(function(t){l._deselectRow(t,!0)});l._rowSelectionChanged(o)}else{l._deselectRow(t,o)}}};q.prototype._deselectRow=function(t,o){var l=this,a=l.table.rowManager.findRow(t),n;if(a){n=l.selectedRows.findIndex(function(t){return t==a});if(-1<n){a.getElement().classList.remove("tabulator-selected");if(!a.modules.select){a.modules.select={}}a.modules.select.selected=!1;if(a.modules.select.checkboxEl){a.modules.select.checkboxEl.checked=!1}l.selectedRows.splice(n,1);if(this.table.options.dataTreeSelectPropagate){this.childRowSelection(a,!1)}if(!o){l.table.options.rowDeselected.call(this.table,a.getComponent())}l._rowSelectionChanged(o)}}else{if(!o){console.warn("Deselection Error - No such row found, ignoring selection:"+t)}}};q.prototype.getSelectedData=function(){var t=[];this.selectedRows.forEach(function(o){t.push(o.getData())});return t};q.prototype.getSelectedRows=function(){var t=[];this.selectedRows.forEach(function(o){t.push(o.getComponent())});return t};q.prototype._rowSelectionChanged=function(t){if(this.headerCheckboxElement){if(0===this.selectedRows.length){this.headerCheckboxElement.checked=!1;this.headerCheckboxElement.indeterminate=!1}else if(this.table.rowManager.rows.length===this.selectedRows.length){this.headerCheckboxElement.checked=!0;this.headerCheckboxElement.indeterminate=!1}else{this.headerCheckboxElement.indeterminate=!0;this.headerCheckboxElement.checked=!1}}if(!t){this.table.options.rowSelectionChanged.call(this.table,this.getSelectedData(),this.getSelectedRows())}};q.prototype.registerRowSelectCheckbox=function(t,o){if(!t._row.modules.select){t._row.modules.select={}}t._row.modules.select.checkboxEl=o};q.prototype.registerHeaderSelectCheckbox=function(t){this.headerCheckboxElement=t};q.prototype.childRowSelection=function(t,o){var l=this.table.modules.dataTree.getChildren(t,!0);if(o){for(var a=l,n=Array.isArray(a),r=0,a=n?a:a[Symbol.iterator]();;){var s;if(n){if(r>=a.length)break;s=a[r++]}else{r=a.next();if(r.done)break;s=r.value}var d=s;this._selectRow(d,!0)}}else{for(var p=l,c=Array.isArray(p),u=0,p=c?p:p[Symbol.iterator]();;){var m;if(c){if(u>=p.length)break;m=p[u++]}else{u=p.next();if(u.done)break;m=u.value}var g=m;this._deselectRow(g,!0)}}};u.prototype.registerModule("selectRow",q);var J=function(t){this.table=t;this.sortList=[];this.changed=!1};J.prototype.initializeColumn=function(t,o){var l=this,a=!1,n,r;switch(_typeof(t.definition.sorter)){case"string":if(l.sorters[t.definition.sorter]){a=l.sorters[t.definition.sorter]}else{console.warn("Sort Error - No such sorter found: ",t.definition.sorter)}break;case"function":a=t.definition.sorter;break;}t.modules.sort={sorter:a,dir:"none",params:t.definition.sorterParams||{},startingDir:t.definition.headerSortStartingDir||"asc",tristate:"undefined"!=typeof t.definition.headerSortTristate?t.definition.headerSortTristate:this.table.options.headerSortTristate};if("undefined"==typeof t.definition.headerSort?!1!==this.table.options.headerSort:!1!==t.definition.headerSort){n=t.getElement();n.classList.add("tabulator-sortable");r=document.createElement("div");r.classList.add("tabulator-col-sorter");if("object"==_typeof(this.table.options.headerSortElement)){r.appendChild(this.table.options.headerSortElement)}else{r.innerHTML=this.table.options.headerSortElement}o.appendChild(r);t.modules.sort.element=r;n.addEventListener("click",function(o){var a="",n=[],r=!1;if(t.modules.sort){if(t.modules.sort.tristate){if("none"==t.modules.sort.dir){a=t.modules.sort.startingDir}else{if(t.modules.sort.dir==t.modules.sort.startingDir){a="asc"==t.modules.sort.dir?"desc":"asc"}else{a="none"}}}else{switch(t.modules.sort.dir){case"asc":a="desc";break;case"desc":a="asc";break;default:a=t.modules.sort.startingDir;}}if(l.table.options.columnHeaderSortMulti&&(o.shiftKey||o.ctrlKey)){n=l.getSort();r=n.findIndex(function(o){return o.field===t.getField()});if(-1<r){n[r].dir=a;if(r!=n.length-1){r=n.splice(r,1)[0];if("none"!=a){n.push(r)}}}else{if("none"!=a){n.push({column:t,dir:a})}}l.setSort(n)}else{if("none"==a){l.clear()}else{l.setSort(t,a)}}l.table.rowManager.sorterRefresh(!l.sortList.length)}})}};J.prototype.hasChanged=function(){var t=this.changed;this.changed=!1;return t};J.prototype.getSort=function(){var t=this,o=[];t.sortList.forEach(function(t){if(t.column){o.push({column:t.column.getComponent(),field:t.column.getField(),dir:t.dir})}});return o};J.prototype.setSort=function(t,o){var l=this,a=[];if(!Array.isArray(t)){t=[{column:t,dir:o}]}t.forEach(function(t){var o=l.table.columnManager.findColumn(t.column);if(o){t.column=o;a.push(t);l.changed=!0}else{console.warn("Sort Warning - Sort field does not exist and is being ignored: ",t.column)}});l.sortList=a;if(this.table.options.persistence&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.config.sort){this.table.modules.persistence.save("sort")}};J.prototype.clear=function(){this.setSort([])};J.prototype.findSorter=function(t){var o=this.table.rowManager.activeRows[0],l="string",a,n;if(o){o=o.getData();a=t.getField();if(a){n=t.getFieldValue(o);switch("undefined"==typeof n?"undefined":_typeof(n)){case"undefined":l="string";break;case"boolean":l="boolean";break;default:if(!isNaN(n)&&""!==n){l="number"}else{if(n.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)){l="alphanum"}}break;}}}return this.sorters[l]};J.prototype.sort=function(t){var o=this,l=this.table.options.sortOrderReverse?o.sortList.slice().reverse():o.sortList,a=[],n=[];if(o.table.options.dataSorting){o.table.options.dataSorting.call(o.table,o.getSort())}o.clearColumnHeaders();if(!o.table.options.ajaxSorting){l.forEach(function(t){var l=t.column.modules.sort;if(t.column&&l){if(!l.sorter){l.sorter=o.findSorter(t.column)}t.params="function"==typeof l.params?l.params(t.column.getComponent(),t.dir):l.params;a.push(t)}o.setColumnHeader(t.column,t.dir)});if(a.length){o._sortItems(t,a)}}else{l.forEach(function(t){o.setColumnHeader(t.column,t.dir)})}if(o.table.options.dataSorted){t.forEach(function(t){n.push(t.getComponent())});o.table.options.dataSorted.call(o.table,o.getSort(),n)}};J.prototype.clearColumnHeaders=function(){this.table.columnManager.getRealColumns().forEach(function(t){if(t.modules.sort){t.modules.sort.dir="none";t.getElement().setAttribute("aria-sort","none")}})};J.prototype.setColumnHeader=function(t,o){t.modules.sort.dir=o;t.getElement().setAttribute("aria-sort",o)};J.prototype._sortItems=function(t,o){var l=this,n=o.length-1;t.sort(function(t,a){for(var r,s=n,d;0<=s;s--){d=o[s];r=l._sortRow(t,a,d.column,d.dir,d.params);if(0!==r){break}}return r})};J.prototype._sortRow=function(t,o,l,n,r){var s,d,p="asc"==n?t:o,c="asc"==n?o:t;t=l.getFieldValue(p.getData());o=l.getFieldValue(c.getData());t="undefined"!=typeof t?t:"";o="undefined"!=typeof o?o:"";s=p.getComponent();d=c.getComponent();return l.modules.sort.sorter.call(this,t,o,s,d,l.getComponent(),n,r)};J.prototype.sorters={number:function(t,o,l,n,r,s,d){var p=d.alignEmptyValues,c=d.decimalSeparator,u=d.thousandSeparator,m=0;t=t+"";o=o+"";if(u){t=t.split(u).join("");o=o.split(u).join("")}if(c){t=t.split(c).join(".");o=o.split(c).join(".")}t=parseFloat(t);o=parseFloat(o);if(isNaN(t)){m=isNaN(o)?0:-1}else if(isNaN(o)){m=1}else{return t-o}if("top"===p&&"desc"===s||"bottom"===p&&"asc"===s){m*=-1}return m},string:function(t,o,l,a,n,r,s){var d=s.alignEmptyValues,p=0,c;if(!t){p=!o?0:-1}else if(!o){p=1}else{switch(_typeof(s.locale)){case"boolean":if(s.locale){c=this.table.modules.localize.getLocale()}break;case"string":c=s.locale;break;}return(t+"").toLowerCase().localeCompare((o+"").toLowerCase(),c)}if("top"===d&&"desc"===r||"bottom"===d&&"asc"===r){p*=-1}return p},date:function(t,o,l,a,n,r,s){if(!s.format){s.format="DD/MM/YYYY"}return this.sorters.datetime.call(this,t,o,l,a,n,r,s)},time:function(t,o,l,a,n,r,s){if(!s.format){s.format="HH:mm"}return this.sorters.datetime.call(this,t,o,l,a,n,r,s)},datetime:function(t,o,l,n,r,s,d){var p=d.format||"DD/MM/YYYY HH:mm:ss",c=d.alignEmptyValues,u=0;if("undefined"!=typeof moment){t=moment(t,p);o=moment(o,p);if(!t.isValid()){u=!o.isValid()?0:-1}else if(!o.isValid()){u=1}else{return t-o}if("top"===c&&"desc"===s||"bottom"===c&&"asc"===s){u*=-1}return u}else{console.error("Sort Error - 'datetime' sorter is dependant on moment.js")}},boolean:function(t,o){var l=!0===t||"true"===t||"True"===t||1===t?1:0,a=!0===o||"true"===o||"True"===o||1===o?1:0;return l-a},array:function(t,o,l,a,n,r,s){var p=0,c=0,u=s.type||"length",m=s.alignEmptyValues,g=0;function d(t){switch(u){case"length":return t.length;break;case"sum":return t.reduce(function(t,o){return t+o});break;case"max":return Math.max.apply(null,t);break;case"min":return Math.min.apply(null,t);break;case"avg":return t.reduce(function(t,o){return t+o})/t.length;break;}}if(!Array.isArray(t)){m=!Array.isArray(o)?0:-1}else if(!Array.isArray(o)){m=1}else{p=t?d(t):0;c=o?d(o):0;return p-c}if("top"===m&&"desc"===r||"bottom"===m&&"asc"===r){g*=-1}return g},exists:function(t,o){var l="undefined"==typeof t?0:1,a="undefined"==typeof o?0:1;return l-a},alphanum:function(t,o,l,n,r,s,d){var p,c,u,m,g=0,h,f=/(\d+)|(\D+)/g,y=/\d/,w=d.alignEmptyValues,v=0;if(!t&&0!==t){v=!o&&0!==o?0:-1}else if(!o&&0!==o){v=1}else{if(isFinite(t)&&isFinite(o))return t-o;p=(t+"").toLowerCase();c=(o+"").toLowerCase();if(p===c)return 0;if(!(y.test(p)&&y.test(c)))return p>c?1:-1;p=p.match(f);c=c.match(f);h=p.length>c.length?c.length:p.length;while(g<h){u=p[g];m=c[g++];if(u!==m){if(isFinite(u)&&isFinite(m)){if("0"===u.charAt(0))u="."+u;if("0"===m.charAt(0))m="."+m;return u-m}else return u>m?1:-1}}return p.length>c.length}if("top"===w&&"desc"===s||"bottom"===w&&"asc"===s){v*=-1}return v}};u.prototype.registerModule("sort",J);var $=function(t){this.table=t;this.invalidCells=[]};$.prototype.initializeColumn=function(t){var o=this,l=[],a;if(t.definition.validator){if(Array.isArray(t.definition.validator)){t.definition.validator.forEach(function(t){a=o._extractValidator(t);if(a){l.push(a)}})}else{a=this._extractValidator(t.definition.validator);if(a){l.push(a)}}t.modules.validate=l.length?l:!1}};$.prototype._extractValidator=function(t){var o,l,a;switch("undefined"==typeof t?"undefined":_typeof(t)){case"string":a=t.indexOf(":");if(-1<a){o=t.substring(0,a);l=t.substring(a+1)}else{o=t}return this._buildValidator(o,l);break;case"function":return this._buildValidator(t);break;case"object":return this._buildValidator(t.type,t.parameters);break;}};$.prototype._buildValidator=function(t,o){var l="function"==typeof t?t:this.validators[t];if(!l){console.warn("Validator Setup Error - No matching validator found:",t);return!1}else{return{type:"function"==typeof t?"function":t,func:l,params:o}}};$.prototype.validate=function(t,o,l){var a=this,n=[],r=this.invalidCells.indexOf(o);if(t){t.forEach(function(t){if(!t.func.call(a,o.getComponent(),l,t.params)){n.push({type:t.type,parameters:t.params})}})}n=n.length?n:!0;if(!o.modules.validate){o.modules.validate={}}if(!0===n){o.modules.validate.invalid=!1;o.getElement().classList.remove("tabulator-validation-fail");if(-1<r){this.invalidCells.splice(r,1)}}else{o.modules.validate.invalid=!0;if("manual"!==this.table.options.validationMode){o.getElement().classList.add("tabulator-validation-fail")}if(-1==r){this.invalidCells.push(o)}}return n};$.prototype.getInvalidCells=function(){var t=[];this.invalidCells.forEach(function(o){t.push(o.getComponent())});return t};$.prototype.clearValidation=function(t){var o;if(t.modules.validate&&t.modules.validate.invalid){t.getElement().classList.remove("tabulator-validation-fail");t.modules.validate.invalid=!1;o=this.invalidCells.indexOf(t);if(-1<o){this.invalidCells.splice(o,1)}}};$.prototype.validators={integer:function(t,o){if(""===o||null===o||"undefined"==typeof o){return!0}o=+o;return"number"==typeof o&&isFinite(o)&&Math.floor(o)===o},float:function(t,o){if(""===o||null===o||"undefined"==typeof o){return!0}o=+o;return"number"==typeof o&&isFinite(o)&&0!=o%1},numeric:function(t,o){if(""===o||null===o||"undefined"==typeof o){return!0}return!isNaN(o)},string:function(t,o){if(""===o||null===o||"undefined"==typeof o){return!0}return isNaN(o)},max:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return parseFloat(o)<=l},min:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return parseFloat(o)>=l},starts:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return(o+"").toLowerCase().startsWith((l+"").toLowerCase())},ends:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return(o+"").toLowerCase().endsWith((l+"").toLowerCase())},minLength:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return(o+"").length>=l},maxLength:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}return(o+"").length<=l},in:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}if("string"==typeof l){l=l.split("|")}return""===o||-1<l.indexOf(o)},regex:function(t,o,l){if(""===o||null===o||"undefined"==typeof o){return!0}var a=new RegExp(l);return a.test(o)},unique:function t(o,l){if(""===l||null===l||"undefined"==typeof l){return!0}var t=!0,a=o.getData(),n=o.getColumn()._getSelf();this.table.rowManager.rows.forEach(function(o){var r=o.getData();if(r!==a){if(l==n.getFieldValue(r)){t=!1}}});return t},required:function(t,o){return""!==o&&null!==o&&"undefined"!=typeof o}};u.prototype.registerModule("validate",$);return u});
function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("tool_opencast/tool_settings",["exports","block_opencast/tabulator","jquery","core/modal_factory","core/modal_events","core/str"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=i(b);c=i(c);d=i(d);e=i(e);f=h(f);function g(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;g=function(){return a};return a}function h(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=g();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function i(a){return a&&a.__esModule?a:{default:a}}var j=function(a){f.get_strings([{key:"name",component:"tool_opencast"},{key:"isvisible",component:"tool_opencast"},{key:"addinstance",component:"tool_opencast"},{key:"delete_instance",component:"tool_opencast"},{key:"delete_instance_confirm",component:"tool_opencast"},{key:"delete",component:"moodle"},{key:"isdefault",component:"tool_opencast"}]).then(function(f){var g=(0,c.default)("#"+a);if(!g.length){return}g.parent().hide();g.parent().next().hide();var h=new b.default("#instancestable",{data:JSON.parse(g.val()),layout:"fitColumns",dataChanged:function dataChanged(a){g.val(JSON.stringify(a))},columns:[{title:"ID",field:"id",widthGrow:0},{title:f[0],field:"name",editor:"input",widthGrow:2},{title:f[1],field:"isvisible",hozAlign:"center",widthGrow:0,formatter:function formatter(a){var b=document.createElement("input");b.type="checkbox";b.checked=a.getValue();b.addEventListener("click",function(){a.getRow().update({isvisible:(0,c.default)(this).prop("checked")?1:0})});return b}},{title:f[6],field:"isdefault",hozAlign:"center",widthGrow:0,formatter:function formatter(a){var b=document.createElement("input");b.type="checkbox";b.checked=a.getValue();b.addEventListener("click",function(){a.getRow().update({isdefault:(0,c.default)(this).prop("checked")?1:0})});return b}},{title:"",width:40,headerSort:!1,hozAlign:"center",formatter:function formatter(){return"<i class=\"icon fa fa-trash fa-fw\"></i>"},cellClick:function cellClick(a,b){d.default.create({type:d.default.types.SAVE_CANCEL,title:f[3],body:f[4]}).then(function(a){a.setSaveButtonText(f[5]);a.getRoot().on(e.default.save,function(){b.getRow().delete()});a.show()})}}]});(0,c.default)("#addrow-instancestable").click(function(){var a=JSON.parse(g.val()),b=a.map(function(a){return a.id});b.sort();var c=0,d;if(b.includes(1)){for(d=0;d<b.length;d++){var e=d+1;if(e===b.length){c=b[d]+1}else if(b[e]!==b[d]+1){c=b[d]+1;break}}}else{c=1}h.addRow({id:c,isvisible:!1,isdefault:!1})})})};a.init=j});
define ("tool_opencast/opencasttesttool",["jquery","core/ajax","core/str","core/modal_factory","core/notification"],function(a,b,c,d,f){var g=function(){this.activateButton();this.registerClickEvent()};g.prototype.activateButton=function(){a(".testtool-modal").each(function(){if(a(this).is(":visible")&&a(this).hasClass("disabled")){a(this).removeAttr("disabled");a(this).removeAttr("title");a(this).removeClass("disabled btn-warning");a(this).addClass("btn-secondary")}})};g.prototype.registerClickEvent=function(){a(".testtool-modal").click(function(g){g.preventDefault();var e=a(g.target).data("instanceid"),h=e?"_"+e:"",i=a("#admin-apiurl"+h).find("input").val(),j=a("#admin-apiusername"+h).find("input").val(),k=a("#admin-apipassword"+h).find("input").val(),l=b.call([{methodname:"tool_opencast_connection_test_tool",args:{apiurl:i,apiusername:j,apipassword:k}}]),m=c.get_string("testtoolurl","tool_opencast"),n=d.create({type:d.types.CANCEL});a.when(l[0],m,n).then(function(a,b,c){c.setTitle(b);c.setBody(a.testresult);c.show();return c}).catch(f.exception)})};return{init:function init(){return new g}}});
/**
 * Add policy consent modal to the page
 *
 * @module     tool_policy/acceptmodal
 * @class      AcceptOnBehalf
 * @package    tool_policy
 * @copyright  2018 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_policy/acceptmodal",["jquery","core/str","core/modal_factory","core/modal_events","core/notification","core/fragment","core/ajax","core/yui"],(function($,Str,ModalFactory,ModalEvents,Notification,Fragment,Ajax,Y){var AcceptOnBehalf=function(contextid){this.contextid=contextid,this.init()};return AcceptOnBehalf.prototype.modal=null,AcceptOnBehalf.prototype.contextid=-1,AcceptOnBehalf.prototype.currentTrigger=null,AcceptOnBehalf.prototype.triggers={SINGLE:"a[data-action=acceptmodal]",BULK:"input[data-action=acceptmodal]"},AcceptOnBehalf.prototype.init=function(){$(this.triggers.SINGLE).on("click",function(e){e.preventDefault(),this.currentTrigger=$(e.currentTarget);var href=$(e.currentTarget).attr("href"),formData=href.slice(href.indexOf("?")+1);this.showFormModal(formData)}.bind(this)),$(this.triggers.BULK).on("click",function(e){e.preventDefault(),this.currentTrigger=$(e.currentTarget);var form=$(e.currentTarget).closest("form");if(form.find('input[type=checkbox][name="userids[]"]:checked').length){var formData=form.serialize();this.showFormModal(formData)}else Str.get_strings([{key:"notice"},{key:"selectusersforconsent",component:"tool_policy"},{key:"ok"}]).then((function(strings){Notification.alert(strings[0],strings[1],strings[2])})).fail(Notification.exception)}.bind(this))},AcceptOnBehalf.prototype.showFormModal=function(formData){for(var action,params=formData.split("&"),i=0;i<params.length;i++){var pair=params[i].split("=");"action"==pair[0]&&(action=pair[1])}Str.get_strings([{key:"statusformtitleaccept",component:"tool_policy"},{key:"iagreetothepolicy",component:"tool_policy"},{key:"statusformtitlerevoke",component:"tool_policy"},{key:"irevokethepolicy",component:"tool_policy"},{key:"statusformtitledecline",component:"tool_policy"},{key:"declinethepolicy",component:"tool_policy"}]).then(function(strings){var title,saveText;return"accept"==action?(title=strings[0],saveText=strings[1]):"revoke"==action?(title=strings[2],saveText=strings[3]):"decline"==action&&(title=strings[4],saveText=strings[5]),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:title,body:""}).done(function(modal){this.modal=modal,this.setupFormModal(formData,saveText)}.bind(this))}.bind(this)).catch(Notification.exception)},AcceptOnBehalf.prototype.setupFormModal=function(formData,saveText){var modal=this.modal;modal.setLarge(),modal.setSaveButtonText(saveText),modal.getRoot().on(ModalEvents.hidden,this.destroy.bind(this)),modal.setBody(this.getBody(formData)),modal.getRoot().on(ModalEvents.save,this.submitForm.bind(this)),modal.getRoot().on("submit","form",this.submitFormAjax.bind(this)),modal.show()},AcceptOnBehalf.prototype.getBody=function(formData){void 0===formData&&(formData={});var params={jsonformdata:JSON.stringify(formData)};return Fragment.loadFragment("tool_policy","accept_on_behalf",this.contextid,params)},AcceptOnBehalf.prototype.submitFormAjax=function(e){e.preventDefault();var formData=this.modal.getRoot().find("form").serialize();Ajax.call([{methodname:"tool_policy_submit_accept_on_behalf",args:{jsonformdata:JSON.stringify(formData)}}])[0].done(function(data){data.validationerrors?this.modal.setBody(this.getBody(formData)):this.close()}.bind(this)).fail(Notification.exception)},AcceptOnBehalf.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find("form").submit()},AcceptOnBehalf.prototype.close=function(){this.destroy(),document.location.reload()},AcceptOnBehalf.prototype.destroy=function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),this.modal.destroy(),this.currentTrigger.focus()},{getInstance:function(contextid){return new AcceptOnBehalf(contextid)}}}));
/**
 * Adds support for confirmation via JS modal for some management actions at the Manage policies page.
 *
 * @module      tool_policy/managedocsactions
 * @package     tool_policy
 * @copyright   2018 David Mudrák <david@moodle.com>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_policy/managedocsactions",["jquery","core/log","core/config","core/str","core/modal_factory","core/modal_events"],(function($,Log,Config,Str,ModalFactory,ModalEvents){var ACTION_LINKS="[data-action]",ACTION_MAKE_CURRENT='[data-action="makecurrent"]',ACTION_INACTIVATE='[data-action="inactivate"]',ACTION_DELETE='[data-action="delete"]';function ManageDocsActions(base){this.base=base,this.initEvents()}return ManageDocsActions.prototype.initEvents=function(){this.base.on("click",ACTION_LINKS,(function(e){e.stopPropagation();var promise,strings,link=$(e.currentTarget);if(link.is(ACTION_MAKE_CURRENT))promise=Str.get_strings([{key:"activating",component:"tool_policy"},{key:"activateconfirm",component:"tool_policy",param:{name:link.closest("[data-policy-name]").attr("data-policy-name"),revision:link.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"activateconfirmyes",component:"tool_policy"}]);else if(link.is(ACTION_INACTIVATE))promise=Str.get_strings([{key:"inactivating",component:"tool_policy"},{key:"inactivatingconfirm",component:"tool_policy",param:{name:link.closest("[data-policy-name]").attr("data-policy-name"),revision:link.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"inactivatingconfirmyes",component:"tool_policy"}]);else{if(!link.is(ACTION_DELETE))return void Log.error("unknown action type detected","tool_policy/managedocsactions");promise=Str.get_strings([{key:"deleting",component:"tool_policy"},{key:"deleteconfirm",component:"tool_policy",param:{name:link.closest("[data-policy-name]").attr("data-policy-name"),revision:link.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"delete",component:"core"}])}e.preventDefault(),promise.then((function(strs){return strings=strs,ModalFactory.create({title:strings[0],body:strings[1],type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){return modal.setSaveButtonText(strings[2]),modal.getRoot().on(ModalEvents.save,(function(){window.location.href=link.attr("href")+"&sesskey="+Config.sesskey+"&confirm=1"})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),!0})).catch((function(e){return Log.error(e),!1}))}))},{init:function(baseid){var base=$(document.getElementById(baseid));if(base.length)return new ManageDocsActions(base);throw new Error("managedocsactions: Invalid base element identifier")}}}));
define("tool_policy/jquery-eu-cookie-law-popup",["jquery"],(function($){window.console||(window.console={}),window.console.log||(window.console.log=function(){}),$.fn.euCookieLawPopup=function(){var _self=this;_self.params={cookiePolicyUrl:"/?cookie-policy",popupPosition:"top",colorStyle:"default",compactStyle:!1,popupTitle:"This website is using cookies",popupText:"We use cookies to ensure that we give you the best experience on our website. If you continue without changing your settings, we'll assume that you are happy to receive all cookies on this website.",buttonContinueTitle:"Continue",buttonLearnmoreTitle:"Learn&nbsp;more",buttonLearnmoreOpenInNewWindow:!0,agreementExpiresInDays:30,autoAcceptCookiePolicy:!1,htmlMarkup:null},_self.vars={INITIALISED:!1,HTML_MARKUP:null,COOKIE_NAME:"EU_COOKIE_LAW_CONSENT"};var setUserAcceptsCookies=function(consent){var d=new Date,expiresInDays=24*_self.params.agreementExpiresInDays*60*60*1e3;d.setTime(d.getTime()+expiresInDays);var expires="expires="+d.toGMTString();document.cookie=_self.vars.COOKIE_NAME+"="+consent+"; "+expires+";path=/",$(document).trigger("user_cookie_consent_changed",{consent:consent})},hideContainer=function(){$(".eupopup-container").animate({opacity:0,height:0},200,(function(){$(".eupopup-container").hide(0)}))};return{init:function(settings){!function(object,markup,settings){if(object){var className=$(object).attr("class")?$(object).attr("class"):"";className.indexOf("eupopup-top")>-1?_self.params.popupPosition="top":className.indexOf("eupopup-fixedtop")>-1?_self.params.popupPosition="fixedtop":className.indexOf("eupopup-bottomright")>-1?_self.params.popupPosition="bottomright":className.indexOf("eupopup-bottomleft")>-1?_self.params.popupPosition="bottomleft":className.indexOf("eupopup-bottom")>-1?_self.params.popupPosition="bottom":className.indexOf("eupopup-block")>-1&&(_self.params.popupPosition="block"),className.indexOf("eupopup-color-default")>-1?_self.params.colorStyle="default":className.indexOf("eupopup-color-inverse")>-1&&(_self.params.colorStyle="inverse"),className.indexOf("eupopup-style-compact")>-1&&(_self.params.compactStyle=!0)}markup&&(_self.params.htmlMarkup=markup),settings&&(void 0!==settings.cookiePolicyUrl&&(_self.params.cookiePolicyUrl=settings.cookiePolicyUrl),void 0!==settings.popupPosition&&(_self.params.popupPosition=settings.popupPosition),void 0!==settings.colorStyle&&(_self.params.colorStyle=settings.colorStyle),void 0!==settings.popupTitle&&(_self.params.popupTitle=settings.popupTitle),void 0!==settings.popupText&&(_self.params.popupText=settings.popupText),void 0!==settings.buttonContinueTitle&&(_self.params.buttonContinueTitle=settings.buttonContinueTitle),void 0!==settings.buttonLearnmoreTitle&&(_self.params.buttonLearnmoreTitle=settings.buttonLearnmoreTitle),void 0!==settings.buttonLearnmoreOpenInNewWindow&&(_self.params.buttonLearnmoreOpenInNewWindow=settings.buttonLearnmoreOpenInNewWindow),void 0!==settings.agreementExpiresInDays&&(_self.params.agreementExpiresInDays=settings.agreementExpiresInDays),void 0!==settings.autoAcceptCookiePolicy&&(_self.params.autoAcceptCookiePolicy=settings.autoAcceptCookiePolicy),void 0!==settings.htmlMarkup&&(_self.params.htmlMarkup=settings.htmlMarkup))}($(".eupopup").first(),$(".eupopup-markup").html(),settings),function(){for(var userAcceptedCookies=!1,cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){var c=cookies[i].trim();-1!==c.indexOf(_self.vars.COOKIE_NAME)&&(userAcceptedCookies=c.substring(_self.vars.COOKIE_NAME.length+1,c.length))}return userAcceptedCookies}()?$(document).trigger("user_cookie_already_accepted",{consent:!0}):_self.vars.INITIALISED||(_self.vars.INITIALISED=!0,_self.vars.HTML_MARKUP=_self.params.htmlMarkup?_self.params.htmlMarkup:'<div class="eupopup-container eupopup-container-'+_self.params.popupPosition+(_self.params.compactStyle?" eupopup-style-compact":"")+" eupopup-color-"+_self.params.colorStyle+'"><div class="eupopup-head">'+_self.params.popupTitle+'</div><div class="eupopup-body">'+_self.params.popupText+'</div><div class="eupopup-buttons"><a href="#" class="eupopup-button eupopup-button_1">'+_self.params.buttonContinueTitle+'</a><a href="'+_self.params.cookiePolicyUrl+'"'+(_self.params.buttonLearnmoreOpenInNewWindow?" target=_blank ":"")+' class="eupopup-button eupopup-button_2">'+_self.params.buttonLearnmoreTitle+'</a><div class="clearfix"></div></div><a href="#" class="eupopup-closebutton">x</a></div>',$(".eupopup-block").length>0?$(".eupopup-block").append(_self.vars.HTML_MARKUP):$("BODY").append(_self.vars.HTML_MARKUP),$(".eupopup-button_1").click((function(){return setUserAcceptsCookies(!0),hideContainer(),!1})),$(".eupopup-closebutton").click((function(){return setUserAcceptsCookies(!0),hideContainer(),!1})),$(".eupopup-container").show(),_self.params.autoAcceptCookiePolicy&&setUserAcceptsCookies(!0))}}}}));
/**
 * Unified filter page JS module for the course participants page.
 *
 * @module     tool_policy/acceptances_filter
 * @package    tool_policy
 * @copyright  2017 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_policy/acceptances_filter",["jquery","core/form-autocomplete","core/str","core/notification"],(function($,Autocomplete,Str,Notification){var SELECTORS_UNIFIED_FILTERS="#unified-filters";return{init:function(){!function(){M.util.js_pending("acceptances_filter_datasource"),Str.get_strings([{key:"filterplaceholder",component:"tool_policy"},{key:"nofiltersapplied",component:"tool_policy"}]).done((function(langstrings){var placeholder=langstrings[0],noSelectionString=langstrings[1];Autocomplete.enhance(SELECTORS_UNIFIED_FILTERS,!0,"tool_policy/acceptances_filter_datasource",placeholder,!1,!0,noSelectionString,!0).then((function(){M.util.js_complete("acceptances_filter_datasource")})).fail(Notification.exception)})).fail(Notification.exception);var last=$(SELECTORS_UNIFIED_FILTERS).val();$(SELECTORS_UNIFIED_FILTERS).on("change",(function(){var current=$(this).val(),listoffilters=[],textfilters=[],updatedselectedfilters=!1;if($.each(current,(function(index,catoption){var catandoption=catoption.split(":",2);if(2!==catandoption.length)return textfilters.push(catoption),!0;var category=catandoption[0],option=catandoption[1];return void 0!==listoffilters[category]&&(updatedselectedfilters=!0),listoffilters[category]=option,!0})),updatedselectedfilters){var updatefilters=[];for(var category in listoffilters)updatefilters.push(category+":"+listoffilters[category]);updatefilters=updatefilters.concat(textfilters),$(this).val(updatefilters)}last.join(",")!=current.join(",")&&this.form.submit()}))}()},getForm:function(){return $(SELECTORS_UNIFIED_FILTERS).closest("form")}}}));
/**
 * Datasource for the tool_policy/acceptances_filter.
 *
 * This module is compatible with core/form-autocomplete.
 *
 * @package    tool_policy
 * @copyright  2017 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_policy/acceptances_filter_datasource",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{list:function(selector,query){var filteredOptions=[],el=$(selector),originalOptions=$(selector).data("originaloptionsjson"),selectedFilters=el.val();$.each(originalOptions,(function(index,option){return""!==query.trim()&&-1===option.label.toLocaleLowerCase().indexOf(query.toLocaleLowerCase())||$.inArray(option.value,selectedFilters)>-1||filteredOptions.push(option),!0}));var deferred=new $.Deferred;return deferred.resolve(filteredOptions),deferred.promise()},processResults:function(selector,results){var options=[];return $.each(results,(function(index,data){options.push({value:data.value,label:data.label})})),options},transport:function(selector,query,callback){this.list(selector,query).then(callback).catch(Notification.exception)}}}));
/**
 * Policy actions.
 *
 * @module     tool_policy/policyactions
 * @package    tool_policy
 * @copyright  2018 Sara Arjona (sara@moodle.com)
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_policy/policyactions",["jquery","core/ajax","core/notification","core/modal_factory","core/modal_events"],(function($,Ajax,Notification,ModalFactory,ModalEvents){var PolicyActions=function(root){this.registerEvents(root)};return PolicyActions.prototype.registerEvents=function(root){root.on("click",(function(e){e.preventDefault();var request={methodname:"tool_policy_get_policy_version",args:{versionid:$(this).data("versionid"),behalfid:$(this).data("behalfid")}},modalTitle=$.Deferred(),modalBody=$.Deferred(),modal=ModalFactory.create({title:modalTitle,body:modalBody,large:!0}).then((function(modal){return modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal})).then((function(modal){return modal.show(),modal})).catch(Notification.exception),promises=Ajax.call([request]);$.when(promises[0]).then((function(data){if(data.result.policy)return modalTitle.resolve(data.result.policy.name),modalBody.resolve(data.result.policy.content),data;throw new Error(data.warnings[0].message)})).catch((function(message){return modal.then((function(modal){return modal.hide(),modal.destroy(),modal})).catch(Notification.exception),Notification.addNotification({message:message,type:"error"})}))}))},{init:function(root){return root=$(root),new PolicyActions(root)}}}));
/**
 * This module adds ajax search functions to the template library page.
 *
 * @module     tool_templatelibrary/search
 * @package    tool_templatelibrary
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_templatelibrary/search",["jquery","core/ajax","core/log","core/notification","core/templates","core/config"],(function($,ajax,log,notification,templates,config){var reloadListTemplate=function(templateList){templates.render("tool_templatelibrary/search_results",{templates:templateList}).done((function(result,js){templates.replaceNode($('[data-region="searchresults"]'),result,js)})).fail(notification.exception)},refreshSearch=function(themename){var componentStr=$('[data-field="component"]').val(),searchStr=$('[data-field="search"]').val();ajax.call([{methodname:"tool_templatelibrary_list_templates",args:{component:componentStr,search:searchStr,themename:themename},done:reloadListTemplate,fail:notification.exception}],!0,!1)},throttle=null,changeHandler=function(){var callback,delay;callback=refreshSearch.bind(this,config.theme),delay=400,null!==throttle&&window.clearTimeout(throttle),throttle=window.setTimeout((function(){callback(),throttle=null}),delay)};return $('[data-region="list-templates"]').on("change",'[data-field="component"]',changeHandler),$('[data-region="list-templates"]').on("input",'[data-field="search"]',changeHandler),refreshSearch(config.theme),{}}));
/**
 * This module adds ajax display functions to the template library page.
 *
 * @module     tool_templatelibrary/display
 * @package    tool_templatelibrary
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_templatelibrary/display",["jquery","core/ajax","core/log","core/notification","core/templates","core/config","core/str"],(function($,ajax,log,notification,templates,config,str){var findDocsSection=function(templateSource,templateName){if(!templateSource)return!1;var sections,marker="@template "+templateName,i=0;if(null!==(sections=templateSource.match(/{{!([\s\S]*?)}}/g)))for(i=0;i<sections.length;i++){var section=sections[i],start=section.indexOf(marker);if(-1!==start){var offset=start+marker.length+1;return section=section.substr(offset,section.length-2-offset)}}return!1},loadTemplate=function(templateName){var parts=templateName.split("/"),component=parts.shift(),name=parts.join("/"),promises=ajax.call([{methodname:"core_output_load_template",args:{component:component,template:name,themename:config.theme,includecomments:!0}},{methodname:"tool_templatelibrary_load_canonical_template",args:{component:component,template:name}}],!0,!1);$.when.apply($,promises).done((function(source,originalSource){!function(templateName,source,originalSource){str.get_string("templateselected","tool_templatelibrary",templateName).done((function(s){$('[data-region="displaytemplateheader"]').text(s)})).fail(notification.exception);var docs=findDocsSection(source,templateName);!1===docs&&(docs=findDocsSection(originalSource,templateName)),docs&&(source=docs),$('[data-region="displaytemplatesource"]').text(source);var example=source.match(/Example context \(json\):([\s\S]*)/),context=!1;if(example){var rawJSON=example[1].trim();try{context=$.parseJSON(rawJSON)}catch(e){log.debug("Could not parse json example context for template."),log.debug(e)}}context?templates.render(templateName,context).done((function(html,js){templates.replaceNodeContents($('[data-region="displaytemplateexample"]'),html,js)})).fail(notification.exception):str.get_string("templatehasnoexample","tool_templatelibrary").done((function(s){$('[data-region="displaytemplateexample"]').text(s)})).fail(notification.exception)}(templateName,source,originalSource)})).fail(notification.exception)};return $('[data-region="list-templates"]').on("click","[data-templatename]",(function(e){var templatename=$(this).data("templatename");e.preventDefault(),loadTemplate(templatename)})),{}}));
define("tool_usertours/managetours",["jquery","core/ajax","core/str","core/notification"],(function($,ajax,str,notification){var manager={removeTour:function(e){e.preventDefault();var targetUrl=$(e.currentTarget).attr("href");str.get_strings([{key:"confirmtourremovaltitle",component:"tool_usertours"},{key:"confirmtourremovalquestion",component:"tool_usertours"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).then((function(s){notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location=targetUrl}))})).catch()},setup:function(){$("body").delegate('[data-action="delete"]',"click",manager.removeTour)}};return{setup:manager.setup}}));
define("tool_usertours/usertours",["core/ajax","tool_usertours/tour","jquery","core/templates","core/str","core/log","core/notification"],(function(ajax,BootstrapTour,$,templates,str,log,notification){var usertours={tourId:null,currentTour:null,context:null,init:function(tourId,startTour,context){usertours.tourId=tourId,usertours.context=context,void 0===startTour&&(startTour=!0),startTour&&usertours.fetchTour(tourId),usertours.addResetLink(),$("body").on("click",'[data-action="tool_usertours/resetpagetour"]',(function(e){e.preventDefault(),usertours.resetTourState(usertours.tourId)}))},fetchTour:function(tourId){M.util.js_pending("admin_usertour_fetchTour"+tourId),$.when(ajax.call([{methodname:"tool_usertours_fetch_and_start_tour",args:{tourid:tourId,context:usertours.context,pageurl:window.location.href}}])[0],templates.render("tool_usertours/tourstep",{})).then((function(response,template){if(response.hasOwnProperty("tourconfig"))return usertours.startBootstrapTour(tourId,template[0],response.tourconfig)})).always((function(){M.util.js_complete("admin_usertour_fetchTour"+tourId)})).fail(notification.exception)},addResetLink:function(){var ele;M.util.js_pending("admin_usertour_addResetLink"),ele=$(".tool_usertours-resettourcontainer").length?$(".tool_usertours-resettourcontainer"):$(".logininfo").length?$(".logininfo"):$("footer").length?$("footer"):$("body"),templates.render("tool_usertours/resettour",{}).then((function(html,js){templates.appendNodeContents(ele,html,js)})).always((function(){M.util.js_complete("admin_usertour_addResetLink")})).fail()},startBootstrapTour:function(tourId,template,tourConfig){return usertours.currentTour&&(tourConfig.onEnd=null,usertours.currentTour.endTour(),delete usertours.currentTour),tourConfig.eventHandlers={afterEnd:[usertours.markTourComplete],afterRender:[usertours.markStepShown]},tourConfig.tourName=tourConfig.name,delete tourConfig.name,tourConfig.template=template,tourConfig.steps=tourConfig.steps.map((function(step){return void 0!==step.element&&(step.target=step.element,delete step.element),void 0!==step.reflex&&(step.moveOnClick=!!step.reflex,delete step.reflex),void 0!==step.content&&(step.body=step.content,delete step.content),step})),usertours.currentTour=new BootstrapTour(tourConfig),usertours.currentTour.startTour()},markStepShown:function(){var stepConfig=this.getStepConfig(this.getCurrentStepNumber());$.when(ajax.call([{methodname:"tool_usertours_step_shown",args:{tourid:usertours.tourId,context:usertours.context,pageurl:window.location.href,stepid:stepConfig.stepid,stepindex:this.getCurrentStepNumber()}}])[0]).fail(log.error)},markTourComplete:function(){var stepConfig=this.getStepConfig(this.getCurrentStepNumber());$.when(ajax.call([{methodname:"tool_usertours_complete_tour",args:{tourid:usertours.tourId,context:usertours.context,pageurl:window.location.href,stepid:stepConfig.stepid,stepindex:this.getCurrentStepNumber()}}])[0]).fail(log.error)},resetTourState:function(tourId){$.when(ajax.call([{methodname:"tool_usertours_reset_tour",args:{tourid:tourId,context:usertours.context,pageurl:window.location.href}}])[0]).then((function(response){response.startTour&&usertours.fetchTour(response.startTour)})).fail(notification.exception)}};return{init:usertours.init,resetTourState:usertours.resetTourState}}));
define("tool_usertours/managesteps",["jquery","core/str","core/notification"],(function($,str,notification){var manager={removeStep:function(e){e.preventDefault();var targetUrl=$(e.currentTarget).attr("href");str.get_strings([{key:"confirmstepremovaltitle",component:"tool_usertours"},{key:"confirmstepremovalquestion",component:"tool_usertours"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).then((function(s){notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location=targetUrl}))})).catch()},setup:function(){$("body").delegate('[data-action="delete"]',"click",manager.removeStep)}};return{setup:manager.setup}}));
define("tool_usertours/tour",["exports","jquery","core/popper"],(function(_exports,_jquery,_popper){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_popper=_interopRequireDefault(_popper);var Tour=function(){function Tour(config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Tour),this.init(config)}var Constructor,protoProps,staticProps;return Constructor=Tour,protoProps=[{key:"init",value:function(config){this.eventHandlers={},this.reset(),this.originalConfiguration=config||{},this.configure.apply(this,arguments);try{this.storage=window.sessionStorage,this.storageKey="tourstate_"+this.tourName}catch(e){this.storage=!1,this.storageKey=""}return this}},{key:"reset",value:function(){return this.hide(),this.eventHandlers=[],this.resetStepListeners(),this.originalConfiguration={},this.steps=[],this.currentStepNumber=0,this}},{key:"configure",value:function(config){var _this=this;if("object"===_typeof(config)){if(void 0!==config.tourName&&(this.tourName=config.tourName),config.eventHandlers){var _loop=function(eventName){config.eventHandlers[eventName].forEach((function(handler){this.addEventHandler(eventName,handler)}),_this)};for(var eventName in config.eventHandlers)_loop(eventName)}this.resetStepDefaults(!0),"object"===_typeof(config.steps)&&(this.steps=config.steps),void 0!==config.template&&(this.templateContent=config.template)}return this.checkMinimumRequirements(),this}},{key:"checkMinimumRequirements",value:function(){if(!this.tourName)throw new Error("Tour Name required");if(!this.steps||!this.steps.length)throw new Error("Steps must be specified")}},{key:"resetStepDefaults",value:function(loadOriginalConfiguration){return void 0===loadOriginalConfiguration&&(loadOriginalConfiguration=!0),this.stepDefaults={},loadOriginalConfiguration&&void 0!==this.originalConfiguration.stepDefaults?this.setStepDefaults(this.originalConfiguration.stepDefaults):this.setStepDefaults({}),this}},{key:"setStepDefaults",value:function(stepDefaults){return this.stepDefaults||(this.stepDefaults={}),_jquery.default.extend(this.stepDefaults,{element:"",placement:"top",delay:0,moveOnClick:!1,moveAfterTime:0,orphan:!1,direction:1},stepDefaults),this}},{key:"getCurrentStepNumber",value:function(){return parseInt(this.currentStepNumber,10)}},{key:"setCurrentStepNumber",value:function(stepNumber){if(this.currentStepNumber=stepNumber,this.storage)try{this.storage.setItem(this.storageKey,stepNumber)}catch(e){e.code===DOMException.QUOTA_EXCEEDED_ERR&&this.storage.removeItem(this.storageKey)}}},{key:"getNextStepNumber",value:function(stepNumber){void 0===stepNumber&&(stepNumber=this.getCurrentStepNumber());for(var nextStepNumber=stepNumber+1;nextStepNumber<=this.steps.length;){if(this.isStepPotentiallyVisible(this.getStepConfig(nextStepNumber)))return nextStepNumber;nextStepNumber++}return null}},{key:"getPreviousStepNumber",value:function(stepNumber){void 0===stepNumber&&(stepNumber=this.getCurrentStepNumber());for(var previousStepNumber=stepNumber-1;previousStepNumber>=0;){if(this.isStepPotentiallyVisible(this.getStepConfig(previousStepNumber)))return previousStepNumber;previousStepNumber--}return null}},{key:"isLastStep",value:function(stepNumber){return null===this.getNextStepNumber(stepNumber)}},{key:"isFirstStep",value:function(stepNumber){return null===this.getPreviousStepNumber(stepNumber)}},{key:"isStepPotentiallyVisible",value:function(stepConfig){return!!(stepConfig&&(this.isStepActuallyVisible(stepConfig)||void 0!==stepConfig.orphan&&stepConfig.orphan||void 0!==stepConfig.delay&&stepConfig.delay))}},{key:"isStepActuallyVisible",value:function(stepConfig){if(!stepConfig)return!1;var target=this.getStepTarget(stepConfig);return!!(target&&target.length&&target.is(":visible"))&&!!target.length}},{key:"next",value:function(){return this.gotoStep(this.getNextStepNumber())}},{key:"previous",value:function(){return this.gotoStep(this.getPreviousStepNumber(),-1)}},{key:"gotoStep",value:function(stepNumber,direction){if(stepNumber<0)return this.endTour();var stepConfig=this.getStepConfig(stepNumber);return null===stepConfig?this.endTour():this._gotoStep(stepConfig,direction)}},{key:"_gotoStep",value:function(stepConfig,direction){if(!stepConfig)return this.endTour();if(void 0!==stepConfig.delay&&stepConfig.delay&&!stepConfig.delayed)return stepConfig.delayed=!0,window.setTimeout(this._gotoStep.bind(this),stepConfig.delay,stepConfig,direction),this;if(!stepConfig.orphan&&!this.isStepActuallyVisible(stepConfig)){var fn=-1==direction?"getPreviousStepNumber":"getNextStepNumber";return this.gotoStep(this[fn](stepConfig.stepNumber),direction)}return this.hide(),this.fireEventHandlers("beforeRender",stepConfig),this.renderStep(stepConfig),this.fireEventHandlers("afterRender",stepConfig),this}},{key:"getStepConfig",value:function(stepNumber){if(null===stepNumber||stepNumber<0||stepNumber>=this.steps.length)return null;var stepConfig=this.normalizeStepConfig(this.steps[stepNumber]);return stepConfig=_jquery.default.extend(stepConfig,{stepNumber:stepNumber})}},{key:"normalizeStepConfig",value:function(stepConfig){return void 0!==stepConfig.reflex&&void 0===stepConfig.moveAfterClick&&(stepConfig.moveAfterClick=stepConfig.reflex),void 0!==stepConfig.element&&void 0===stepConfig.target&&(stepConfig.target=stepConfig.element),void 0!==stepConfig.content&&void 0===stepConfig.body&&(stepConfig.body=stepConfig.content),stepConfig=_jquery.default.extend({},this.stepDefaults,stepConfig),(stepConfig=_jquery.default.extend({},{attachTo:stepConfig.target,attachPoint:"after"},stepConfig)).attachTo&&(stepConfig.attachTo=(0,_jquery.default)(stepConfig.attachTo).first()),stepConfig}},{key:"getStepTarget",value:function(stepConfig){return stepConfig.target?(0,_jquery.default)(stepConfig.target):null}},{key:"fireEventHandlers",value:function(eventName,data){return void 0===this.eventHandlers[eventName]||this.eventHandlers[eventName].forEach((function(thisEvent){thisEvent.call(this,data)}),this),this}},{key:"addEventHandler",value:function(eventName,handler){return void 0===this.eventHandlers[eventName]&&(this.eventHandlers[eventName]=[]),this.eventHandlers[eventName].push(handler),this}},{key:"processStepListeners",value:function(stepConfig){if(this.listeners.push({node:this.currentStepNode,args:["click",'[data-role="next"]',_jquery.default.proxy(this.next,this)]},{node:this.currentStepNode,args:["click",'[data-role="previous"]',_jquery.default.proxy(this.previous,this)]},{node:this.currentStepNode,args:["click",'[data-role="end"]',_jquery.default.proxy(this.endTour,this)]},{node:(0,_jquery.default)('[data-flexitour="backdrop"]'),args:["click",_jquery.default.proxy(this.hide,this)]},{node:(0,_jquery.default)("body"),args:["keydown",_jquery.default.proxy(this.handleKeyDown,this)]}),stepConfig.moveOnClick){var targetNode=this.getStepTarget(stepConfig);this.listeners.push({node:targetNode,args:["click",_jquery.default.proxy((function(e){0===(0,_jquery.default)(e.target).parents('[data-flexitour="container"]').length&&window.setTimeout(_jquery.default.proxy(this.next,this),500)}),this)]})}return this.listeners.forEach((function(listener){listener.node.on.apply(listener.node,listener.args)})),this}},{key:"resetStepListeners",value:function(){return this.listeners&&this.listeners.forEach((function(listener){listener.node.off.apply(listener.node,listener.args)})),this.listeners=[],this}},{key:"renderStep",value:function(stepConfig){this.currentStepConfig=stepConfig,this.setCurrentStepNumber(stepConfig.stepNumber);var template=(0,_jquery.default)(this.getTemplateContent());return template.find('[data-placeholder="title"]').html(stepConfig.title),template.find('[data-placeholder="body"]').html(stepConfig.body),this.isFirstStep(stepConfig.stepNumber)?template.find('[data-role="previous"]').hide():template.find('[data-role="previous"]').prop("disabled",!1),this.isLastStep(stepConfig.stepNumber)?(template.find('[data-role="next"]').hide(),template.find('[data-role="end"]').removeClass("btn-secondary").addClass("btn-primary")):template.find('[data-role="next"]').prop("disabled",!1),template.find('[data-role="previous"]').attr("role","button"),template.find('[data-role="next"]').attr("role","button"),template.find('[data-role="end"]').attr("role","button"),stepConfig.template=template,this.addStepToPage(stepConfig),this.processStepListeners(stepConfig),this}},{key:"getTemplateContent",value:function(){return(0,_jquery.default)(this.templateContent).clone()}},{key:"addStepToPage",value:function(stepConfig){var currentStepNode=(0,_jquery.default)('<span data-flexitour="container"></span>').html(stepConfig.template).hide(),animationTarget=(0,_jquery.default)("body, html").stop(!0,!0);if(this.isStepActuallyVisible(stepConfig)){var targetNode=this.getStepTarget(stepConfig);targetNode.data("flexitour","target");var zIndex=this.calculateZIndex(targetNode);zIndex&&(stepConfig.zIndex=zIndex+1),stepConfig.zIndex&&currentStepNode.css("zIndex",stepConfig.zIndex+1),this.positionBackdrop(stepConfig),(0,_jquery.default)(document.body).append(currentStepNode),this.currentStepNode=currentStepNode,this.currentStepNode.css({top:0,left:0}),animationTarget.animate({scrollTop:this.calculateScrollTop(stepConfig)}).promise().then(function(){this.positionStep(stepConfig),this.revealStep(stepConfig)}.bind(this)).catch((function(){}))}else stepConfig.orphan&&(stepConfig.isOrphan=!0,stepConfig.attachTo=(0,_jquery.default)("body").first(),stepConfig.attachPoint="append",this.positionBackdrop(stepConfig),currentStepNode.addClass("orphan"),(0,_jquery.default)(document.body).append(currentStepNode),this.currentStepNode=currentStepNode,this.currentStepNode.offset(this.calculateStepPositionInPage()),this.currentStepNode.css("position","fixed"),this.currentStepPopper=new _popper.default((0,_jquery.default)("body"),this.currentStepNode[0],{removeOnDestroy:!0,placement:stepConfig.placement+"-start",arrowElement:'[data-role="arrow"]',modifiers:{hide:{enabled:!1},applyStyle:{onLoad:null,enabled:!1}}}),this.revealStep(stepConfig));return this}},{key:"revealStep",value:function(stepConfig){return this.currentStepNode.fadeIn("",_jquery.default.proxy((function(){this.announceStep(stepConfig),this.currentStepNode.focus(),window.setTimeout(_jquery.default.proxy((function(){this.currentStepNode&&this.currentStepNode.focus()}),this),100)}),this)),this}},{key:"announceStep",value:function(stepConfig){var stepId="tour-step-"+this.tourName+"-"+stepConfig.stepNumber;this.currentStepNode.attr("id",stepId);var bodyRegion=this.currentStepNode.find('[data-placeholder="body"]').first();bodyRegion.attr("id",stepId+"-body"),bodyRegion.attr("role","document");var headerRegion=this.currentStepNode.find('[data-placeholder="title"]').first();headerRegion.attr("id",stepId+"-title"),headerRegion.attr("aria-labelledby",stepId+"-body"),this.currentStepNode.attr("role","dialog"),this.currentStepNode.attr("tabindex",0),this.currentStepNode.attr("aria-labelledby",stepId+"-title"),this.currentStepNode.attr("aria-describedby",stepId+"-body");var target=this.getStepTarget(stepConfig);return target&&(target.attr("tabindex")||target.attr("tabindex",0),target.data("original-describedby",target.attr("aria-describedby")).attr("aria-describedby",stepId+"-body")),this.accessibilityShow(stepConfig),this}},{key:"handleKeyDown",value:function(e){var tabbableSelector="a[href], link[href], [draggable=true], [contenteditable=true], ";switch(tabbableSelector+=":input:enabled, [tabindex], button:enabled",e.keyCode){case 27:this.endTour();break;case 9:(function(){if(this.currentStepConfig.hasBackdrop){var currentIndex,nextIndex,nextNode,focusRelevant,activeElement=(0,_jquery.default)(document.activeElement),stepTarget=this.getStepTarget(this.currentStepConfig),tabbableNodes=(0,_jquery.default)(tabbableSelector),dialogContainer=(0,_jquery.default)('span[data-flexitour="container"]');if(stepTarget&&(tabbableNodes=tabbableNodes.filter((function(index,element){return null!==stepTarget&&(stepTarget.has(element).length||dialogContainer.has(element).length||stepTarget.is(element)||dialogContainer.is(element))}))),tabbableNodes.each((function(index,element){return!activeElement.is(element)||(currentIndex=index,!1)})),null!=currentIndex){var direction=1;e.shiftKey&&(direction=-1),nextIndex=currentIndex;do{nextIndex+=direction,nextNode=(0,_jquery.default)(tabbableNodes[nextIndex])}while(nextNode.length&&nextNode.is(":disabled")||nextNode.is(":hidden"));focusRelevant=!!nextNode.length&&((focusRelevant=nextNode.closest(stepTarget).length)||nextNode.closest(this.currentStepNode).length)}focusRelevant?nextNode.focus():e.shiftKey?this.currentStepNode.find(tabbableSelector).last().focus():this.currentStepConfig.isOrphan?this.currentStepNode.focus():stepTarget.focus(),e.preventDefault()}}).call(this)}}},{key:"startTour",value:function(startAt){if(this.storage&&void 0===startAt){var storageStartValue=this.storage.getItem(this.storageKey);if(storageStartValue){var storageStartAt=parseInt(storageStartValue,10);storageStartAt<=this.steps.length&&(startAt=storageStartAt)}}return void 0===startAt&&(startAt=this.getCurrentStepNumber()),this.fireEventHandlers("beforeStart",startAt),this.gotoStep(startAt),this.fireEventHandlers("afterStart",startAt),this}},{key:"restartTour",value:function(){return this.startTour(0)}},{key:"endTour",value:function(){if(this.fireEventHandlers("beforeEnd"),this.currentStepConfig){var previousTarget=this.getStepTarget(this.currentStepConfig);previousTarget&&(previousTarget.attr("tabindex")||previousTarget.attr("tabindex","-1"),previousTarget.focus())}return this.hide(!0),this.fireEventHandlers("afterEnd"),this}},{key:"hide",value:function(transition){if(this.fireEventHandlers("beforeHide"),this.currentStepNode&&this.currentStepNode.length&&(this.currentStepNode.hide(),this.currentStepPopper&&this.currentStepPopper.destroy()),this.currentStepConfig){var target=this.getStepTarget(this.currentStepConfig);target&&(target.data("original-labelledby")&&target.attr("aria-labelledby",target.data("original-labelledby")),target.data("original-describedby")&&target.attr("aria-describedby",target.data("original-describedby")),target.data("original-tabindex")&&target.attr("tabindex",target.data("tabindex"))),this.currentStepConfig=null}var fadeTime=0;if(transition&&(fadeTime=400),(0,_jquery.default)('[data-flexitour="step-background"]').remove(),(0,_jquery.default)('[data-flexitour="step-backdrop"]').removeAttr("data-flexitour"),(0,_jquery.default)('[data-flexitour="backdrop"]').fadeOut(fadeTime,(function(){(0,_jquery.default)(this).remove()})),this.currentStepNode&&this.currentStepNode.length){var stepId=this.currentStepNode.attr("id");if(stepId){var currentStepElement='[aria-describedby="'+stepId+'-body"]';(0,_jquery.default)(currentStepElement).removeAttr("tabindex"),(0,_jquery.default)(currentStepElement).removeAttr("aria-describedby")}}return this.resetStepListeners(),this.accessibilityHide(),this.fireEventHandlers("afterHide"),this.currentStepNode=null,this.currentStepPopper=null,this}},{key:"show",value:function(){var startAt=this.getCurrentStepNumber();return this.gotoStep(startAt)}},{key:"getStepContainer",value:function(){return(0,_jquery.default)(this.currentStepNode)}},{key:"calculateScrollTop",value:function(stepConfig){var scrollTop=(0,_jquery.default)(window).scrollTop(),viewportHeight=(0,_jquery.default)(window).height(),targetNode=this.getStepTarget(stepConfig);return scrollTop="top"===stepConfig.placement?targetNode.offset().top-viewportHeight/2:"bottom"===stepConfig.placement?targetNode.offset().top+targetNode.height()-viewportHeight/2:targetNode.height()<=.8*viewportHeight?targetNode.offset().top-(viewportHeight-targetNode.height())/2:targetNode.offset().top-.2*viewportHeight,scrollTop=Math.max(0,scrollTop),scrollTop=Math.min((0,_jquery.default)(document).height()-viewportHeight,scrollTop),Math.ceil(scrollTop)}},{key:"calculateStepPositionInPage",value:function(){var viewportHeight=(0,_jquery.default)(window).height(),stepHeight=this.currentStepNode.height(),viewportWidth=(0,_jquery.default)(window).width(),stepWidth=this.currentStepNode.width();return{top:Math.ceil((viewportHeight-stepHeight)/2),left:Math.ceil((viewportWidth-stepWidth)/2)}}},{key:"positionStep",value:function(stepConfig){var flipBehavior,content=this.currentStepNode;if(!content||!content.length)return this;switch(stepConfig.placement){case"left":flipBehavior=["left","right","top","bottom"];break;case"right":flipBehavior=["right","left","top","bottom"];break;case"top":flipBehavior=["top","bottom","right","left"];break;case"bottom":flipBehavior=["bottom","top","right","left"];break;default:flipBehavior="flip"}var target=this.getStepTarget(stepConfig),config={placement:stepConfig.placement+"-start",removeOnDestroy:!0,modifiers:{flip:{behaviour:flipBehavior},arrow:{element:'[data-role="arrow"]'}},onCreate:function(data){recalculateArrowPosition(data)},onUpdate:function(data){recalculateArrowPosition(data)}},recalculateArrowPosition=function(data){var placement=data.placement.split("-")[0],isVertical=-1!==["left","right"].indexOf(placement),arrowElement=data.instance.popper.querySelector('[data-role="arrow"]'),stepElement=(0,_jquery.default)(data.instance.popper.querySelector('[data-role="flexitour-step"]'));if(isVertical){var arrowHeight=parseFloat(window.getComputedStyle(arrowElement).height),arrowOffset=parseFloat(window.getComputedStyle(arrowElement).top),popperHeight=parseFloat(window.getComputedStyle(data.instance.popper).height),popperOffset=parseFloat(window.getComputedStyle(data.instance.popper).top),popperBorderWidth=parseFloat(stepElement.css("borderTopWidth")),popperBorderRadiusWidth=2*parseFloat(stepElement.css("borderTopLeftRadius")),arrowPos=arrowOffset+arrowHeight/2,maxPos=popperHeight+popperOffset-popperBorderWidth-popperBorderRadiusWidth,minPos=popperOffset+popperBorderWidth+popperBorderRadiusWidth;if(arrowPos>=maxPos||arrowPos<=minPos){var newArrowPos=0;newArrowPos=arrowPos>popperHeight/2?maxPos-arrowHeight:minPos+arrowHeight,(0,_jquery.default)(arrowElement).css("top",newArrowPos)}}else{var arrowWidth=parseFloat(window.getComputedStyle(arrowElement).width),_arrowOffset=parseFloat(window.getComputedStyle(arrowElement).left),popperWidth=parseFloat(window.getComputedStyle(data.instance.popper).width),_popperOffset=parseFloat(window.getComputedStyle(data.instance.popper).left),_popperBorderWidth=parseFloat(stepElement.css("borderTopWidth")),_popperBorderRadiusWidth=2*parseFloat(stepElement.css("borderTopLeftRadius")),_arrowPos=_arrowOffset+arrowWidth/2,_maxPos=popperWidth+_popperOffset-_popperBorderWidth-_popperBorderRadiusWidth,_minPos=_popperOffset+_popperBorderWidth+_popperBorderRadiusWidth;if(_arrowPos>=_maxPos||_arrowPos<=_minPos){var _newArrowPos=0;_newArrowPos=_arrowPos>popperWidth/2?_maxPos-arrowWidth:_minPos+arrowWidth,(0,_jquery.default)(arrowElement).css("left",_newArrowPos)}}},background=(0,_jquery.default)('[data-flexitour="step-background"]');return background.length&&(target=background),this.currentStepPopper=new _popper.default(target,content[0],config),this}},{key:"positionBackdrop",value:function(stepConfig){if(stepConfig.backdrop){this.currentStepConfig.hasBackdrop=!0;var backdrop=(0,_jquery.default)('<div data-flexitour="backdrop"></div>');if(stepConfig.zIndex?"append"===stepConfig.attachPoint?stepConfig.attachTo.append(backdrop):backdrop.insertAfter(stepConfig.attachTo):(0,_jquery.default)("body").append(backdrop),this.isStepActuallyVisible(stepConfig)){var background=(0,_jquery.default)('<div data-flexitour="step-background"></div>'),targetNode=this.getStepTarget(stepConfig),colorNode=targetNode;colorNode=(0,_jquery.default)("body"),background.css({width:targetNode.outerWidth()+10+10,height:targetNode.outerHeight()+10+10,left:targetNode.offset().left-10,top:targetNode.offset().top-10,backgroundColor:this.calculateInherittedBackgroundColor(colorNode)}),targetNode.offset().left<10&&background.css({width:targetNode.outerWidth()+targetNode.offset().left+10,left:targetNode.offset().left}),targetNode.offset().top<10&&background.css({height:targetNode.outerHeight()+targetNode.offset().top+10,top:targetNode.offset().top});var targetRadius=targetNode.css("borderRadius");targetRadius&&targetRadius!==(0,_jquery.default)("body").css("borderRadius")&&background.css("borderRadius",targetRadius);var targetPosition=this.calculatePosition(targetNode);"fixed"===targetPosition?background.css("top",0):"absolute"===targetPosition&&background.css("position","fixed");var fader=background.clone();fader.css({backgroundColor:backdrop.css("backgroundColor"),opacity:backdrop.css("opacity")}),fader.attr("data-flexitour","step-background-fader"),stepConfig.zIndex?"append"===stepConfig.attachPoint?stepConfig.attachTo.append(background):(fader.insertAfter(stepConfig.attachTo),background.insertAfter(stepConfig.attachTo)):((0,_jquery.default)("body").append(fader),(0,_jquery.default)("body").append(background)),targetNode.attr("data-flexitour","step-backdrop"),stepConfig.zIndex&&(backdrop.css("zIndex",stepConfig.zIndex),background.css("zIndex",stepConfig.zIndex+1),targetNode.css("zIndex",stepConfig.zIndex+2)),fader.fadeOut("2000",(function(){(0,_jquery.default)(this).remove()}))}}return this}},{key:"calculateZIndex",value:function(elem){for(elem=(0,_jquery.default)(elem);elem.length&&elem[0]!==document;){var position=elem.css("position");if("absolute"===position||"relative"===position||"fixed"===position){var value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&0!==value)return value}elem=elem.parent()}return 0}},{key:"calculateInherittedBackgroundColor",value:function(elem){var fakeNode=(0,_jquery.default)("<div>").hide();(0,_jquery.default)("body").append(fakeNode);var fakeElemColor=fakeNode.css("backgroundColor");for(fakeNode.remove(),elem=(0,_jquery.default)(elem);elem.length&&elem[0]!==document;){var color=elem.css("backgroundColor");if(color!==fakeElemColor)return color;elem=elem.parent()}return null}},{key:"calculatePosition",value:function(elem){for(elem=(0,_jquery.default)(elem);elem.length&&elem[0]!==document;){var position=elem.css("position");if("static"!==position)return position;elem=elem.parent()}return null}},{key:"accessibilityShow",value:function(){var hideFunction=function(child){var flexitourRole=child.data("flexitour");if(flexitourRole)switch(flexitourRole){case"container":case"target":return}child.attr("aria-hidden")||(child.attr("data-has-hidden",!0),child.attr("aria-hidden",!0))};this.currentStepNode.siblings().each((function(index,node){hideFunction((0,_jquery.default)(node))})),this.currentStepNode.parentsUntil("body").siblings().each((function(index,node){hideFunction((0,_jquery.default)(node))}))}},{key:"accessibilityHide",value:function(){(0,_jquery.default)("[data-has-hidden]").each((function(index,node){var child;void 0!==(child=(0,_jquery.default)(node)).attr("data-has-hidden")&&(child.removeAttr("data-has-hidden"),child.removeAttr("aria-hidden"))}))}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Tour}();return _exports.default=Tour,_exports.default}));
define("tool_xmldb/move",["jquery","core/sortable_list","core/ajax","core/notification"],(function($,SortableList,Ajax,Notification){return{init:function(tableid,moveaction){var origIndex;new SortableList("#"+tableid+" tbody").getElementName=function(element){return $.Deferred().resolve(element.attr("data-name"))},$("#"+tableid+" tbody tr").on(SortableList.EVENTS.DRAGSTART,(function(_,info){origIndex=info.sourceList.children().index(info.element),setTimeout((function(){$(".sortable-list-is-dragged").width(info.element.width())}),501)})).on(SortableList.EVENTS.DROP,(function(_,info){var newIndex=info.targetList.children().index(info.element),t=info.element.find("[data-action="+moveaction+"]");if(info.positionChanged&&t.length){var request={methodname:"tool_xmldb_invoke_move_action",args:{action:moveaction,dir:t.attr("data-dir"),table:t.attr("data-table"),field:t.attr("data-field"),key:t.attr("data-key"),index:t.attr("data-index"),position:newIndex-origIndex}};Ajax.call([request])[0].fail(Notification.exception)}}))}}}));
define("theme_boost/bootstrap/carousel",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var NAME="carousel",DATA_KEY="bs.carousel",EVENT_KEY=".".concat(DATA_KEY),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],Default={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0,touch:!0},DefaultType={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean",touch:"boolean"},EVENT_SLIDE="slide".concat(EVENT_KEY),EVENT_SLID="slid".concat(EVENT_KEY),EVENT_KEYDOWN="keydown".concat(EVENT_KEY),EVENT_MOUSEENTER="mouseenter".concat(EVENT_KEY),EVENT_MOUSELEAVE="mouseleave".concat(EVENT_KEY),EVENT_TOUCHSTART="touchstart".concat(EVENT_KEY),EVENT_TOUCHMOVE="touchmove".concat(EVENT_KEY),EVENT_TOUCHEND="touchend".concat(EVENT_KEY),EVENT_POINTERDOWN="pointerdown".concat(EVENT_KEY),EVENT_POINTERUP="pointerup".concat(EVENT_KEY),EVENT_DRAG_START="dragstart".concat(EVENT_KEY),EVENT_LOAD_DATA_API="load".concat(EVENT_KEY).concat(".data-api"),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),PointerType={TOUCH:"touch",PEN:"pen"},Carousel=function(){function Carousel(element,config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Carousel),this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this.touchStartX=0,this.touchDeltaX=0,this._config=this._getConfig(config),this._element=element,this._indicatorsElement=this._element.querySelector(".carousel-indicators"),this._touchSupported="ontouchstart"in document.documentElement||navigator.maxTouchPoints>0,this._pointerEvent=Boolean(window.PointerEvent||window.MSPointerEvent),this._addEventListeners()}var Constructor,protoProps,staticProps;return Constructor=Carousel,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data(DATA_KEY),_config=_objectSpread(_objectSpread({},Default),(0,_jquery.default)(this).data());"object"===_typeof(config)&&(_config=_objectSpread(_objectSpread({},_config),config));var action="string"==typeof config?config:_config.slide;if(data||(data=new Carousel(this,_config),(0,_jquery.default)(this).data(DATA_KEY,data)),"number"==typeof config)data.to(config);else if("string"==typeof action){if(void 0===data[action])throw new TypeError('No method named "'.concat(action,'"'));data[action]()}else _config.interval&&_config.ride&&(data.pause(),data.cycle())}))}},{key:"_dataApiClickHandler",value:function(event){var selector=_util.default.getSelectorFromElement(this);if(selector){var target=(0,_jquery.default)(selector)[0];if(target&&(0,_jquery.default)(target).hasClass("carousel")){var config=_objectSpread(_objectSpread({},(0,_jquery.default)(target).data()),(0,_jquery.default)(this).data()),slideIndex=this.getAttribute("data-slide-to");slideIndex&&(config.interval=!1),Carousel._jQueryInterface.call((0,_jquery.default)(target),config),slideIndex&&(0,_jquery.default)(target).data(DATA_KEY).to(slideIndex),event.preventDefault()}}}}],(protoProps=[{key:"next",value:function(){this._isSliding||this._slide("next")}},{key:"nextWhenVisible",value:function(){!document.hidden&&(0,_jquery.default)(this._element).is(":visible")&&"hidden"!==(0,_jquery.default)(this._element).css("visibility")&&this.next()}},{key:"prev",value:function(){this._isSliding||this._slide("prev")}},{key:"pause",value:function(event){event||(this._isPaused=!0),this._element.querySelector(".carousel-item-next, .carousel-item-prev")&&(_util.default.triggerTransitionEnd(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null}},{key:"cycle",value:function(event){event||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config.interval&&!this._isPaused&&(this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))}},{key:"to",value:function(index){var _this=this;this._activeElement=this._element.querySelector(".active.carousel-item");var activeIndex=this._getItemIndex(this._activeElement);if(!(index>this._items.length-1||index<0))if(this._isSliding)(0,_jquery.default)(this._element).one(EVENT_SLID,(function(){return _this.to(index)}));else{if(activeIndex===index)return this.pause(),void this.cycle();var direction=index>activeIndex?"next":"prev";this._slide(direction,this._items[index])}}},{key:"dispose",value:function(){(0,_jquery.default)(this._element).off(EVENT_KEY),_jquery.default.removeData(this._element,DATA_KEY),this._items=null,this._config=null,this._element=null,this._interval=null,this._isPaused=null,this._isSliding=null,this._activeElement=null,this._indicatorsElement=null}},{key:"_getConfig",value:function(config){return config=_objectSpread(_objectSpread({},Default),config),_util.default.typeCheckConfig(NAME,config,DefaultType),config}},{key:"_handleSwipe",value:function(){var absDeltax=Math.abs(this.touchDeltaX);if(!(absDeltax<=40)){var direction=absDeltax/this.touchDeltaX;this.touchDeltaX=0,direction>0&&this.prev(),direction<0&&this.next()}}},{key:"_addEventListeners",value:function(){var _this2=this;this._config.keyboard&&(0,_jquery.default)(this._element).on(EVENT_KEYDOWN,(function(event){return _this2._keydown(event)})),"hover"===this._config.pause&&(0,_jquery.default)(this._element).on(EVENT_MOUSEENTER,(function(event){return _this2.pause(event)})).on(EVENT_MOUSELEAVE,(function(event){return _this2.cycle(event)})),this._config.touch&&this._addTouchEventListeners()}},{key:"_addTouchEventListeners",value:function(){var _this3=this;if(this._touchSupported){var start=function(event){_this3._pointerEvent&&PointerType[event.originalEvent.pointerType.toUpperCase()]?_this3.touchStartX=event.originalEvent.clientX:_this3._pointerEvent||(_this3.touchStartX=event.originalEvent.touches[0].clientX)},end=function(event){_this3._pointerEvent&&PointerType[event.originalEvent.pointerType.toUpperCase()]&&(_this3.touchDeltaX=event.originalEvent.clientX-_this3.touchStartX),_this3._handleSwipe(),"hover"===_this3._config.pause&&(_this3.pause(),_this3.touchTimeout&&clearTimeout(_this3.touchTimeout),_this3.touchTimeout=setTimeout((function(event){return _this3.cycle(event)}),500+_this3._config.interval))};(0,_jquery.default)(this._element.querySelectorAll(".carousel-item img")).on(EVENT_DRAG_START,(function(e){return e.preventDefault()})),this._pointerEvent?((0,_jquery.default)(this._element).on(EVENT_POINTERDOWN,(function(event){return start(event)})),(0,_jquery.default)(this._element).on(EVENT_POINTERUP,(function(event){return end(event)})),this._element.classList.add("pointer-event")):((0,_jquery.default)(this._element).on(EVENT_TOUCHSTART,(function(event){return start(event)})),(0,_jquery.default)(this._element).on(EVENT_TOUCHMOVE,(function(event){return function(event){event.originalEvent.touches&&event.originalEvent.touches.length>1?_this3.touchDeltaX=0:_this3.touchDeltaX=event.originalEvent.touches[0].clientX-_this3.touchStartX}(event)})),(0,_jquery.default)(this._element).on(EVENT_TOUCHEND,(function(event){return end(event)})))}}},{key:"_keydown",value:function(event){if(!/input|textarea/i.test(event.target.tagName))switch(event.which){case 37:event.preventDefault(),this.prev();break;case 39:event.preventDefault(),this.next()}}},{key:"_getItemIndex",value:function(element){return this._items=element&&element.parentNode?[].slice.call(element.parentNode.querySelectorAll(".carousel-item")):[],this._items.indexOf(element)}},{key:"_getItemByDirection",value:function(direction,activeElement){var isNextDirection="next"===direction,isPrevDirection="prev"===direction,activeIndex=this._getItemIndex(activeElement),lastItemIndex=this._items.length-1;if((isPrevDirection&&0===activeIndex||isNextDirection&&activeIndex===lastItemIndex)&&!this._config.wrap)return activeElement;var itemIndex=(activeIndex+("prev"===direction?-1:1))%this._items.length;return-1===itemIndex?this._items[this._items.length-1]:this._items[itemIndex]}},{key:"_triggerSlideEvent",value:function(relatedTarget,eventDirectionName){var targetIndex=this._getItemIndex(relatedTarget),fromIndex=this._getItemIndex(this._element.querySelector(".active.carousel-item")),slideEvent=_jquery.default.Event(EVENT_SLIDE,{relatedTarget:relatedTarget,direction:eventDirectionName,from:fromIndex,to:targetIndex});return(0,_jquery.default)(this._element).trigger(slideEvent),slideEvent}},{key:"_setActiveIndicatorElement",value:function(element){if(this._indicatorsElement){var indicators=[].slice.call(this._indicatorsElement.querySelectorAll(".active"));(0,_jquery.default)(indicators).removeClass("active");var nextIndicator=this._indicatorsElement.children[this._getItemIndex(element)];nextIndicator&&(0,_jquery.default)(nextIndicator).addClass("active")}}},{key:"_slide",value:function(direction,element){var directionalClassName,orderClassName,eventDirectionName,_this4=this,activeElement=this._element.querySelector(".active.carousel-item"),activeElementIndex=this._getItemIndex(activeElement),nextElement=element||activeElement&&this._getItemByDirection(direction,activeElement),nextElementIndex=this._getItemIndex(nextElement),isCycling=Boolean(this._interval);if("next"===direction?(directionalClassName="carousel-item-left",orderClassName="carousel-item-next",eventDirectionName="left"):(directionalClassName="carousel-item-right",orderClassName="carousel-item-prev",eventDirectionName="right"),nextElement&&(0,_jquery.default)(nextElement).hasClass("active"))this._isSliding=!1;else if(!this._triggerSlideEvent(nextElement,eventDirectionName).isDefaultPrevented()&&activeElement&&nextElement){this._isSliding=!0,isCycling&&this.pause(),this._setActiveIndicatorElement(nextElement);var slidEvent=_jquery.default.Event(EVENT_SLID,{relatedTarget:nextElement,direction:eventDirectionName,from:activeElementIndex,to:nextElementIndex});if((0,_jquery.default)(this._element).hasClass("slide")){(0,_jquery.default)(nextElement).addClass(orderClassName),_util.default.reflow(nextElement),(0,_jquery.default)(activeElement).addClass(directionalClassName),(0,_jquery.default)(nextElement).addClass(directionalClassName);var nextElementInterval=parseInt(nextElement.getAttribute("data-interval"),10);nextElementInterval?(this._config.defaultInterval=this._config.defaultInterval||this._config.interval,this._config.interval=nextElementInterval):this._config.interval=this._config.defaultInterval||this._config.interval;var transitionDuration=_util.default.getTransitionDurationFromElement(activeElement);(0,_jquery.default)(activeElement).one(_util.default.TRANSITION_END,(function(){(0,_jquery.default)(nextElement).removeClass("".concat(directionalClassName," ").concat(orderClassName)).addClass("active"),(0,_jquery.default)(activeElement).removeClass("".concat("active"," ").concat(orderClassName," ").concat(directionalClassName)),_this4._isSliding=!1,setTimeout((function(){return(0,_jquery.default)(_this4._element).trigger(slidEvent)}),0)})).emulateTransitionEnd(transitionDuration)}else(0,_jquery.default)(activeElement).removeClass("active"),(0,_jquery.default)(nextElement).addClass("active"),this._isSliding=!1,(0,_jquery.default)(this._element).trigger(slidEvent);isCycling&&this.cycle()}}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Carousel}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,"[data-slide], [data-slide-to]",Carousel._dataApiClickHandler),(0,_jquery.default)(window).on(EVENT_LOAD_DATA_API,(function(){for(var carousels=[].slice.call(document.querySelectorAll('[data-ride="carousel"]')),i=0,len=carousels.length;i<len;i++){var $carousel=(0,_jquery.default)(carousels[i]);Carousel._jQueryInterface.call($carousel,$carousel.data())}})),_jquery.default.fn[NAME]=Carousel._jQueryInterface,_jquery.default.fn[NAME].Constructor=Carousel,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Carousel._jQueryInterface};var _default=Carousel;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/popover",["exports","jquery","./tooltip"],(function(_exports,_jquery,_tooltip){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_tooltip=_interopRequireDefault(_tooltip);var NAME="popover",EVENT_KEY=".".concat("bs.popover"),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],BSCLS_PREFIX_REGEX=new RegExp("(^|\\s)".concat("bs-popover","\\S+"),"g"),Default=_objectSpread(_objectSpread({},_tooltip.default.Default),{},{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),DefaultType=_objectSpread(_objectSpread({},_tooltip.default.DefaultType),{},{content:"(string|element|function)"}),Event={HIDE:"hide".concat(EVENT_KEY),HIDDEN:"hidden".concat(EVENT_KEY),SHOW:"show".concat(EVENT_KEY),SHOWN:"shown".concat(EVENT_KEY),INSERTED:"inserted".concat(EVENT_KEY),CLICK:"click".concat(EVENT_KEY),FOCUSIN:"focusin".concat(EVENT_KEY),FOCUSOUT:"focusout".concat(EVENT_KEY),MOUSEENTER:"mouseenter".concat(EVENT_KEY),MOUSELEAVE:"mouseleave".concat(EVENT_KEY)},Popover=function(_Tooltip){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(Popover,_Tooltip);var Constructor,protoProps,staticProps,_super=_createSuper(Popover);function Popover(){return _classCallCheck(this,Popover),_super.apply(this,arguments)}return Constructor=Popover,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"NAME",get:function(){return NAME}},{key:"DATA_KEY",get:function(){return"bs.popover"}},{key:"Event",get:function(){return Event}},{key:"EVENT_KEY",get:function(){return EVENT_KEY}},{key:"DefaultType",get:function(){return DefaultType}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data("bs.popover"),_config="object"===_typeof(config)?config:null;if((data||!/dispose|hide/.test(config))&&(data||(data=new Popover(this,_config),(0,_jquery.default)(this).data("bs.popover",data)),"string"==typeof config)){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}}],(protoProps=[{key:"isWithContent",value:function(){return this.getTitle()||this._getContent()}},{key:"addAttachmentClass",value:function(attachment){(0,_jquery.default)(this.getTipElement()).addClass("".concat("bs-popover","-").concat(attachment))}},{key:"getTipElement",value:function(){return this.tip=this.tip||(0,_jquery.default)(this.config.template)[0],this.tip}},{key:"setContent",value:function(){var $tip=(0,_jquery.default)(this.getTipElement());this.setElementContent($tip.find(".popover-header"),this.getTitle());var content=this._getContent();"function"==typeof content&&(content=content.call(this.element)),this.setElementContent($tip.find(".popover-body"),content),$tip.removeClass("".concat("fade"," ").concat("show"))}},{key:"_getContent",value:function(){return this.element.getAttribute("data-content")||this.config.content}},{key:"_cleanTipClass",value:function(){var $tip=(0,_jquery.default)(this.getTipElement()),tabClass=$tip.attr("class").match(BSCLS_PREFIX_REGEX);null!==tabClass&&tabClass.length>0&&$tip.removeClass(tabClass.join(""))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Popover}(_tooltip.default);_jquery.default.fn[NAME]=Popover._jQueryInterface,_jquery.default.fn[NAME].Constructor=Popover,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Popover._jQueryInterface};var _default=Popover;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/toast",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var NAME="toast",EVENT_KEY=".".concat("bs.toast"),JQUERY_NO_CONFLICT=_jquery.default.fn.toast,EVENT_CLICK_DISMISS="click.dismiss".concat(EVENT_KEY),EVENT_HIDE="hide".concat(EVENT_KEY),EVENT_HIDDEN="hidden".concat(EVENT_KEY),EVENT_SHOW="show".concat(EVENT_KEY),EVENT_SHOWN="shown".concat(EVENT_KEY),DefaultType={animation:"boolean",autohide:"boolean",delay:"number"},Default={animation:!0,autohide:!0,delay:500},Toast=function(){function Toast(element,config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Toast),this._element=element,this._config=this._getConfig(config),this._timeout=null,this._setListeners()}var Constructor,protoProps,staticProps;return Constructor=Toast,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"DefaultType",get:function(){return DefaultType}},{key:"Default",get:function(){return Default}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var $element=(0,_jquery.default)(this),data=$element.data("bs.toast"),_config="object"===_typeof(config)&&config;if(data||(data=new Toast(this,_config),$element.data("bs.toast",data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config](this)}}))}}],(protoProps=[{key:"show",value:function(){var _this=this,showEvent=_jquery.default.Event(EVENT_SHOW);if((0,_jquery.default)(this._element).trigger(showEvent),!showEvent.isDefaultPrevented()){this._config.animation&&this._element.classList.add("fade");var complete=function(){_this._element.classList.remove("showing"),_this._element.classList.add("show"),(0,_jquery.default)(_this._element).trigger(EVENT_SHOWN),_this._config.autohide&&(_this._timeout=setTimeout((function(){_this.hide()}),_this._config.delay))};if(this._element.classList.remove("hide"),_util.default.reflow(this._element),this._element.classList.add("showing"),this._config.animation){var transitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,complete).emulateTransitionEnd(transitionDuration)}else complete()}}},{key:"hide",value:function(){if(this._element.classList.contains("show")){var hideEvent=_jquery.default.Event(EVENT_HIDE);(0,_jquery.default)(this._element).trigger(hideEvent),hideEvent.isDefaultPrevented()||this._close()}}},{key:"dispose",value:function(){clearTimeout(this._timeout),this._timeout=null,this._element.classList.contains("show")&&this._element.classList.remove("show"),(0,_jquery.default)(this._element).off(EVENT_CLICK_DISMISS),_jquery.default.removeData(this._element,"bs.toast"),this._element=null,this._config=null}},{key:"_getConfig",value:function(config){return config=_objectSpread(_objectSpread(_objectSpread({},Default),(0,_jquery.default)(this._element).data()),"object"===_typeof(config)&&config?config:{}),_util.default.typeCheckConfig(NAME,config,this.constructor.DefaultType),config}},{key:"_setListeners",value:function(){var _this2=this;(0,_jquery.default)(this._element).on(EVENT_CLICK_DISMISS,'[data-dismiss="toast"]',(function(){return _this2.hide()}))}},{key:"_close",value:function(){var _this3=this,complete=function(){_this3._element.classList.add("hide"),(0,_jquery.default)(_this3._element).trigger(EVENT_HIDDEN)};if(this._element.classList.remove("show"),this._config.animation){var transitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,complete).emulateTransitionEnd(transitionDuration)}else complete()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Toast}();_jquery.default.fn.toast=Toast._jQueryInterface,_jquery.default.fn.toast.Constructor=Toast,_jquery.default.fn.toast.noConflict=function(){return _jquery.default.fn.toast=JQUERY_NO_CONFLICT,Toast._jQueryInterface};var _default=Toast;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/collapse",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var NAME="collapse",DATA_KEY="bs.collapse",EVENT_KEY=".".concat(DATA_KEY),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],Default={toggle:!0,parent:""},DefaultType={toggle:"boolean",parent:"(string|element)"},EVENT_SHOW="show".concat(EVENT_KEY),EVENT_SHOWN="shown".concat(EVENT_KEY),EVENT_HIDE="hide".concat(EVENT_KEY),EVENT_HIDDEN="hidden".concat(EVENT_KEY),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),Collapse=function(){function Collapse(element,config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Collapse),this._isTransitioning=!1,this._element=element,this._config=this._getConfig(config),this._triggerArray=[].slice.call(document.querySelectorAll('[data-toggle="collapse"][href="#'.concat(element.id,'"],')+'[data-toggle="collapse"][data-target="#'.concat(element.id,'"]')));for(var toggleList=[].slice.call(document.querySelectorAll('[data-toggle="collapse"]')),i=0,len=toggleList.length;i<len;i++){var elem=toggleList[i],selector=_util.default.getSelectorFromElement(elem),filterElement=[].slice.call(document.querySelectorAll(selector)).filter((function(foundElem){return foundElem===element}));null!==selector&&filterElement.length>0&&(this._selector=selector,this._triggerArray.push(elem))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}var Constructor,protoProps,staticProps;return Constructor=Collapse,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"_getTargetFromElement",value:function(element){var selector=_util.default.getSelectorFromElement(element);return selector?document.querySelector(selector):null}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var $this=(0,_jquery.default)(this),data=$this.data(DATA_KEY),_config=_objectSpread(_objectSpread(_objectSpread({},Default),$this.data()),"object"===_typeof(config)&&config?config:{});if(!data&&_config.toggle&&"string"==typeof config&&/show|hide/.test(config)&&(_config.toggle=!1),data||(data=new Collapse(this,_config),$this.data(DATA_KEY,data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}}],(protoProps=[{key:"toggle",value:function(){(0,_jquery.default)(this._element).hasClass("show")?this.hide():this.show()}},{key:"show",value:function(){var actives,activesData,_this=this;if(!(this._isTransitioning||(0,_jquery.default)(this._element).hasClass("show")||(this._parent&&0===(actives=[].slice.call(this._parent.querySelectorAll(".show, .collapsing")).filter((function(elem){return"string"==typeof _this._config.parent?elem.getAttribute("data-parent")===_this._config.parent:elem.classList.contains("collapse")}))).length&&(actives=null),actives&&(activesData=(0,_jquery.default)(actives).not(this._selector).data(DATA_KEY))&&activesData._isTransitioning))){var startEvent=_jquery.default.Event(EVENT_SHOW);if((0,_jquery.default)(this._element).trigger(startEvent),!startEvent.isDefaultPrevented()){actives&&(Collapse._jQueryInterface.call((0,_jquery.default)(actives).not(this._selector),"hide"),activesData||(0,_jquery.default)(actives).data(DATA_KEY,null));var dimension=this._getDimension();(0,_jquery.default)(this._element).removeClass("collapse").addClass("collapsing"),this._element.style[dimension]=0,this._triggerArray.length&&(0,_jquery.default)(this._triggerArray).removeClass("collapsed").attr("aria-expanded",!0),this.setTransitioning(!0);var capitalizedDimension=dimension[0].toUpperCase()+dimension.slice(1),scrollSize="scroll".concat(capitalizedDimension),transitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,(function(){(0,_jquery.default)(_this._element).removeClass("collapsing").addClass("".concat("collapse"," ").concat("show")),_this._element.style[dimension]="",_this.setTransitioning(!1),(0,_jquery.default)(_this._element).trigger(EVENT_SHOWN)})).emulateTransitionEnd(transitionDuration),this._element.style[dimension]="".concat(this._element[scrollSize],"px")}}}},{key:"hide",value:function(){var _this2=this;if(!this._isTransitioning&&(0,_jquery.default)(this._element).hasClass("show")){var startEvent=_jquery.default.Event(EVENT_HIDE);if((0,_jquery.default)(this._element).trigger(startEvent),!startEvent.isDefaultPrevented()){var dimension=this._getDimension();this._element.style[dimension]="".concat(this._element.getBoundingClientRect()[dimension],"px"),_util.default.reflow(this._element),(0,_jquery.default)(this._element).addClass("collapsing").removeClass("".concat("collapse"," ").concat("show"));var triggerArrayLength=this._triggerArray.length;if(triggerArrayLength>0)for(var i=0;i<triggerArrayLength;i++){var trigger=this._triggerArray[i],selector=_util.default.getSelectorFromElement(trigger);null!==selector&&((0,_jquery.default)([].slice.call(document.querySelectorAll(selector))).hasClass("show")||(0,_jquery.default)(trigger).addClass("collapsed").attr("aria-expanded",!1))}this.setTransitioning(!0),this._element.style[dimension]="";var transitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,(function(){_this2.setTransitioning(!1),(0,_jquery.default)(_this2._element).removeClass("collapsing").addClass("collapse").trigger(EVENT_HIDDEN)})).emulateTransitionEnd(transitionDuration)}}}},{key:"setTransitioning",value:function(isTransitioning){this._isTransitioning=isTransitioning}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,DATA_KEY),this._config=null,this._parent=null,this._element=null,this._triggerArray=null,this._isTransitioning=null}},{key:"_getConfig",value:function(config){return(config=_objectSpread(_objectSpread({},Default),config)).toggle=Boolean(config.toggle),_util.default.typeCheckConfig(NAME,config,DefaultType),config}},{key:"_getDimension",value:function(){return(0,_jquery.default)(this._element).hasClass("width")?"width":"height"}},{key:"_getParent",value:function(){var parent,_this3=this;_util.default.isElement(this._config.parent)?(parent=this._config.parent,void 0!==this._config.parent.jquery&&(parent=this._config.parent[0])):parent=document.querySelector(this._config.parent);var selector='[data-toggle="collapse"][data-parent="'.concat(this._config.parent,'"]'),children=[].slice.call(parent.querySelectorAll(selector));return(0,_jquery.default)(children).each((function(i,element){_this3._addAriaAndCollapsedClass(Collapse._getTargetFromElement(element),[element])})),parent}},{key:"_addAriaAndCollapsedClass",value:function(element,triggerArray){var isOpen=(0,_jquery.default)(element).hasClass("show");triggerArray.length&&(0,_jquery.default)(triggerArray).toggleClass("collapsed",!isOpen).attr("aria-expanded",isOpen)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Collapse}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,'[data-toggle="collapse"]',(function(event){"A"===event.currentTarget.tagName&&event.preventDefault();var $trigger=(0,_jquery.default)(this),selector=_util.default.getSelectorFromElement(this),selectors=[].slice.call(document.querySelectorAll(selector));(0,_jquery.default)(selectors).each((function(){var $target=(0,_jquery.default)(this),config=$target.data(DATA_KEY)?"toggle":$trigger.data();Collapse._jQueryInterface.call($target,config)}))})),_jquery.default.fn[NAME]=Collapse._jQueryInterface,_jquery.default.fn[NAME].Constructor=Collapse,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Collapse._jQueryInterface};var _default=Collapse;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/index",["exports","./alert","./button","./carousel","./collapse","./dropdown","./modal","./popover","./scrollspy","./tab","./toast","./tooltip","./util"],(function(_exports,_alert,_button,_carousel,_collapse,_dropdown,_modal,_popover,_scrollspy,_tab,_toast,_tooltip,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"Alert",{enumerable:!0,get:function(){return _alert.default}}),Object.defineProperty(_exports,"Button",{enumerable:!0,get:function(){return _button.default}}),Object.defineProperty(_exports,"Carousel",{enumerable:!0,get:function(){return _carousel.default}}),Object.defineProperty(_exports,"Collapse",{enumerable:!0,get:function(){return _collapse.default}}),Object.defineProperty(_exports,"Dropdown",{enumerable:!0,get:function(){return _dropdown.default}}),Object.defineProperty(_exports,"Modal",{enumerable:!0,get:function(){return _modal.default}}),Object.defineProperty(_exports,"Popover",{enumerable:!0,get:function(){return _popover.default}}),Object.defineProperty(_exports,"Scrollspy",{enumerable:!0,get:function(){return _scrollspy.default}}),Object.defineProperty(_exports,"Tab",{enumerable:!0,get:function(){return _tab.default}}),Object.defineProperty(_exports,"Toast",{enumerable:!0,get:function(){return _toast.default}}),Object.defineProperty(_exports,"Tooltip",{enumerable:!0,get:function(){return _tooltip.default}}),Object.defineProperty(_exports,"Util",{enumerable:!0,get:function(){return _util.default}}),_alert=_interopRequireDefault(_alert),_button=_interopRequireDefault(_button),_carousel=_interopRequireDefault(_carousel),_collapse=_interopRequireDefault(_collapse),_dropdown=_interopRequireDefault(_dropdown),_modal=_interopRequireDefault(_modal),_popover=_interopRequireDefault(_popover),_scrollspy=_interopRequireDefault(_scrollspy),_tab=_interopRequireDefault(_tab),_toast=_interopRequireDefault(_toast),_tooltip=_interopRequireDefault(_tooltip),_util=_interopRequireDefault(_util)}));
define("theme_boost/bootstrap/util",["exports","jquery"],(function(_exports,_jquery){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};function toType(obj){return null==obj?"".concat(obj):{}.toString.call(obj).match(/\s([a-z]+)/i)[1].toLowerCase()}function transitionEndEmulator(duration){var _this=this,called=!1;return(0,_jquery.default)(this).one(Util.TRANSITION_END,(function(){called=!0})),setTimeout((function(){called||Util.triggerTransitionEnd(_this)}),duration),this}var Util={TRANSITION_END:"bsTransitionEnd",getUID:function(prefix){do{prefix+=~~(1e6*Math.random())}while(document.getElementById(prefix));return prefix},getSelectorFromElement:function(element){var selector=element.getAttribute("data-target");if(!selector||"#"===selector){var hrefAttr=element.getAttribute("href");selector=hrefAttr&&"#"!==hrefAttr?hrefAttr.trim():""}try{return document.querySelector(selector)?selector:null}catch(err){return null}},getTransitionDurationFromElement:function(element){if(!element)return 0;var transitionDuration=(0,_jquery.default)(element).css("transition-duration"),transitionDelay=(0,_jquery.default)(element).css("transition-delay"),floatTransitionDuration=parseFloat(transitionDuration),floatTransitionDelay=parseFloat(transitionDelay);return floatTransitionDuration||floatTransitionDelay?(transitionDuration=transitionDuration.split(",")[0],transitionDelay=transitionDelay.split(",")[0],1e3*(parseFloat(transitionDuration)+parseFloat(transitionDelay))):0},reflow:function(element){return element.offsetHeight},triggerTransitionEnd:function(element){(0,_jquery.default)(element).trigger("transitionend")},supportsTransitionEnd:function(){return Boolean("transitionend")},isElement:function(obj){return(obj[0]||obj).nodeType},typeCheckConfig:function(componentName,config,configTypes){for(var property in configTypes)if(Object.prototype.hasOwnProperty.call(configTypes,property)){var expectedTypes=configTypes[property],value=config[property],valueType=value&&Util.isElement(value)?"element":toType(value);if(!new RegExp(expectedTypes).test(valueType))throw new Error("".concat(componentName.toUpperCase(),": ")+'Option "'.concat(property,'" provided type "').concat(valueType,'" ')+'but expected type "'.concat(expectedTypes,'".'))}},findShadowRoot:function(element){if(!document.documentElement.attachShadow)return null;if("function"==typeof element.getRootNode){var root=element.getRootNode();return root instanceof ShadowRoot?root:null}return element instanceof ShadowRoot?element:element.parentNode?Util.findShadowRoot(element.parentNode):null},jQueryDetection:function(){if(void 0===_jquery.default)throw new TypeError("Bootstrap's JavaScript requires jQuery. jQuery must be included before Bootstrap's JavaScript.");var version=_jquery.default.fn.jquery.split(" ")[0].split(".");if(version[0]<2&&version[1]<9||1===version[0]&&9===version[1]&&version[2]<1||version[0]>=4)throw new Error("Bootstrap's JavaScript requires at least jQuery v1.9.1 but less than v4.0.0")}};Util.jQueryDetection(),_jquery.default.fn.emulateTransitionEnd=transitionEndEmulator,_jquery.default.event.special[Util.TRANSITION_END]={bindType:"transitionend",delegateType:"transitionend",handle:function(event){if((0,_jquery.default)(event.target).is(this))return event.handleObj.handler.apply(this,arguments)}};var _default=Util;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/modal",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var NAME="modal",EVENT_KEY=".".concat("bs.modal"),JQUERY_NO_CONFLICT=_jquery.default.fn.modal,Default={backdrop:!0,keyboard:!0,focus:!0,show:!0},DefaultType={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean",show:"boolean"},EVENT_HIDE="hide".concat(EVENT_KEY),EVENT_HIDE_PREVENTED="hidePrevented".concat(EVENT_KEY),EVENT_HIDDEN="hidden".concat(EVENT_KEY),EVENT_SHOW="show".concat(EVENT_KEY),EVENT_SHOWN="shown".concat(EVENT_KEY),EVENT_FOCUSIN="focusin".concat(EVENT_KEY),EVENT_RESIZE="resize".concat(EVENT_KEY),EVENT_CLICK_DISMISS="click.dismiss".concat(EVENT_KEY),EVENT_KEYDOWN_DISMISS="keydown.dismiss".concat(EVENT_KEY),EVENT_MOUSEUP_DISMISS="mouseup.dismiss".concat(EVENT_KEY),EVENT_MOUSEDOWN_DISMISS="mousedown.dismiss".concat(EVENT_KEY),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),Modal=function(){function Modal(element,config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Modal),this._config=this._getConfig(config),this._element=element,this._dialog=element.querySelector(".modal-dialog"),this._backdrop=null,this._isShown=!1,this._isBodyOverflowing=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollbarWidth=0}var Constructor,protoProps,staticProps;return Constructor=Modal,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"_jQueryInterface",value:function(config,relatedTarget){return this.each((function(){var data=(0,_jquery.default)(this).data("bs.modal"),_config=_objectSpread(_objectSpread(_objectSpread({},Default),(0,_jquery.default)(this).data()),"object"===_typeof(config)&&config?config:{});if(data||(data=new Modal(this,_config),(0,_jquery.default)(this).data("bs.modal",data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config](relatedTarget)}else _config.show&&data.show(relatedTarget)}))}}],(protoProps=[{key:"toggle",value:function(relatedTarget){return this._isShown?this.hide():this.show(relatedTarget)}},{key:"show",value:function(relatedTarget){var _this=this;if(!this._isShown&&!this._isTransitioning){(0,_jquery.default)(this._element).hasClass("fade")&&(this._isTransitioning=!0);var showEvent=_jquery.default.Event(EVENT_SHOW,{relatedTarget:relatedTarget});(0,_jquery.default)(this._element).trigger(showEvent),this._isShown||showEvent.isDefaultPrevented()||(this._isShown=!0,this._checkScrollbar(),this._setScrollbar(),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),(0,_jquery.default)(this._element).on(EVENT_CLICK_DISMISS,'[data-dismiss="modal"]',(function(event){return _this.hide(event)})),(0,_jquery.default)(this._dialog).on(EVENT_MOUSEDOWN_DISMISS,(function(){(0,_jquery.default)(_this._element).one(EVENT_MOUSEUP_DISMISS,(function(event){(0,_jquery.default)(event.target).is(_this._element)&&(_this._ignoreBackdropClick=!0)}))})),this._showBackdrop((function(){return _this._showElement(relatedTarget)})))}}},{key:"hide",value:function(event){var _this2=this;if(event&&event.preventDefault(),this._isShown&&!this._isTransitioning){var hideEvent=_jquery.default.Event(EVENT_HIDE);if((0,_jquery.default)(this._element).trigger(hideEvent),this._isShown&&!hideEvent.isDefaultPrevented()){this._isShown=!1;var transition=(0,_jquery.default)(this._element).hasClass("fade");if(transition&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),(0,_jquery.default)(document).off(EVENT_FOCUSIN),(0,_jquery.default)(this._element).removeClass("show"),(0,_jquery.default)(this._element).off(EVENT_CLICK_DISMISS),(0,_jquery.default)(this._dialog).off(EVENT_MOUSEDOWN_DISMISS),transition){var transitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,(function(event){return _this2._hideModal(event)})).emulateTransitionEnd(transitionDuration)}else this._hideModal()}}}},{key:"dispose",value:function(){[window,this._element,this._dialog].forEach((function(htmlElement){return(0,_jquery.default)(htmlElement).off(EVENT_KEY)})),(0,_jquery.default)(document).off(EVENT_FOCUSIN),_jquery.default.removeData(this._element,"bs.modal"),this._config=null,this._element=null,this._dialog=null,this._backdrop=null,this._isShown=null,this._isBodyOverflowing=null,this._ignoreBackdropClick=null,this._isTransitioning=null,this._scrollbarWidth=null}},{key:"handleUpdate",value:function(){this._adjustDialog()}},{key:"_getConfig",value:function(config){return config=_objectSpread(_objectSpread({},Default),config),_util.default.typeCheckConfig(NAME,config,DefaultType),config}},{key:"_triggerBackdropTransition",value:function(){var _this3=this;if("static"===this._config.backdrop){var hideEventPrevented=_jquery.default.Event(EVENT_HIDE_PREVENTED);if((0,_jquery.default)(this._element).trigger(hideEventPrevented),hideEventPrevented.defaultPrevented)return;this._element.classList.add("modal-static");var modalTransitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,(function(){_this3._element.classList.remove("modal-static")})).emulateTransitionEnd(modalTransitionDuration),this._element.focus()}else this.hide()}},{key:"_showElement",value:function(relatedTarget){var _this4=this,transition=(0,_jquery.default)(this._element).hasClass("fade"),modalBody=this._dialog?this._dialog.querySelector(".modal-body"):null;this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.appendChild(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),(0,_jquery.default)(this._dialog).hasClass("modal-dialog-scrollable")&&modalBody?modalBody.scrollTop=0:this._element.scrollTop=0,transition&&_util.default.reflow(this._element),(0,_jquery.default)(this._element).addClass("show"),this._config.focus&&this._enforceFocus();var shownEvent=_jquery.default.Event(EVENT_SHOWN,{relatedTarget:relatedTarget}),transitionComplete=function(){_this4._config.focus&&_this4._element.focus(),_this4._isTransitioning=!1,(0,_jquery.default)(_this4._element).trigger(shownEvent)};if(transition){var transitionDuration=_util.default.getTransitionDurationFromElement(this._dialog);(0,_jquery.default)(this._dialog).one(_util.default.TRANSITION_END,transitionComplete).emulateTransitionEnd(transitionDuration)}else transitionComplete()}},{key:"_enforceFocus",value:function(){var _this5=this;(0,_jquery.default)(document).off(EVENT_FOCUSIN).on(EVENT_FOCUSIN,(function(event){document!==event.target&&_this5._element!==event.target&&0===(0,_jquery.default)(_this5._element).has(event.target).length&&_this5._element.focus()}))}},{key:"_setEscapeEvent",value:function(){var _this6=this;this._isShown?(0,_jquery.default)(this._element).on(EVENT_KEYDOWN_DISMISS,(function(event){_this6._config.keyboard&&27===event.which?(event.preventDefault(),_this6.hide()):_this6._config.keyboard||27!==event.which||_this6._triggerBackdropTransition()})):this._isShown||(0,_jquery.default)(this._element).off(EVENT_KEYDOWN_DISMISS)}},{key:"_setResizeEvent",value:function(){var _this7=this;this._isShown?(0,_jquery.default)(window).on(EVENT_RESIZE,(function(event){return _this7.handleUpdate(event)})):(0,_jquery.default)(window).off(EVENT_RESIZE)}},{key:"_hideModal",value:function(){var _this8=this;this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._isTransitioning=!1,this._showBackdrop((function(){(0,_jquery.default)(document.body).removeClass("modal-open"),_this8._resetAdjustments(),_this8._resetScrollbar(),(0,_jquery.default)(_this8._element).trigger(EVENT_HIDDEN)}))}},{key:"_removeBackdrop",value:function(){this._backdrop&&((0,_jquery.default)(this._backdrop).remove(),this._backdrop=null)}},{key:"_showBackdrop",value:function(callback){var _this9=this,animate=(0,_jquery.default)(this._element).hasClass("fade")?"fade":"";if(this._isShown&&this._config.backdrop){if(this._backdrop=document.createElement("div"),this._backdrop.className="modal-backdrop",animate&&this._backdrop.classList.add(animate),(0,_jquery.default)(this._backdrop).appendTo(document.body),(0,_jquery.default)(this._element).on(EVENT_CLICK_DISMISS,(function(event){_this9._ignoreBackdropClick?_this9._ignoreBackdropClick=!1:event.target===event.currentTarget&&_this9._triggerBackdropTransition()})),animate&&_util.default.reflow(this._backdrop),(0,_jquery.default)(this._backdrop).addClass("show"),!callback)return;if(!animate)return void callback();var backdropTransitionDuration=_util.default.getTransitionDurationFromElement(this._backdrop);(0,_jquery.default)(this._backdrop).one(_util.default.TRANSITION_END,callback).emulateTransitionEnd(backdropTransitionDuration)}else if(!this._isShown&&this._backdrop){(0,_jquery.default)(this._backdrop).removeClass("show");var callbackRemove=function(){_this9._removeBackdrop(),callback&&callback()};if((0,_jquery.default)(this._element).hasClass("fade")){var _backdropTransitionDuration=_util.default.getTransitionDurationFromElement(this._backdrop);(0,_jquery.default)(this._backdrop).one(_util.default.TRANSITION_END,callbackRemove).emulateTransitionEnd(_backdropTransitionDuration)}else callbackRemove()}else callback&&callback()}},{key:"_adjustDialog",value:function(){var isModalOverflowing=this._element.scrollHeight>document.documentElement.clientHeight;!this._isBodyOverflowing&&isModalOverflowing&&(this._element.style.paddingLeft="".concat(this._scrollbarWidth,"px")),this._isBodyOverflowing&&!isModalOverflowing&&(this._element.style.paddingRight="".concat(this._scrollbarWidth,"px"))}},{key:"_resetAdjustments",value:function(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}},{key:"_checkScrollbar",value:function(){var rect=document.body.getBoundingClientRect();this._isBodyOverflowing=Math.round(rect.left+rect.right)<window.innerWidth,this._scrollbarWidth=this._getScrollbarWidth()}},{key:"_setScrollbar",value:function(){var _this10=this;if(this._isBodyOverflowing){var fixedContent=[].slice.call(document.querySelectorAll(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top")),stickyContent=[].slice.call(document.querySelectorAll(".sticky-top"));(0,_jquery.default)(fixedContent).each((function(index,element){var actualPadding=element.style.paddingRight,calculatedPadding=(0,_jquery.default)(element).css("padding-right");(0,_jquery.default)(element).data("padding-right",actualPadding).css("padding-right","".concat(parseFloat(calculatedPadding)+_this10._scrollbarWidth,"px"))})),(0,_jquery.default)(stickyContent).each((function(index,element){var actualMargin=element.style.marginRight,calculatedMargin=(0,_jquery.default)(element).css("margin-right");(0,_jquery.default)(element).data("margin-right",actualMargin).css("margin-right","".concat(parseFloat(calculatedMargin)-_this10._scrollbarWidth,"px"))}));var actualPadding=document.body.style.paddingRight,calculatedPadding=(0,_jquery.default)(document.body).css("padding-right");(0,_jquery.default)(document.body).data("padding-right",actualPadding).css("padding-right","".concat(parseFloat(calculatedPadding)+this._scrollbarWidth,"px"))}(0,_jquery.default)(document.body).addClass("modal-open")}},{key:"_resetScrollbar",value:function(){var fixedContent=[].slice.call(document.querySelectorAll(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top"));(0,_jquery.default)(fixedContent).each((function(index,element){var padding=(0,_jquery.default)(element).data("padding-right");(0,_jquery.default)(element).removeData("padding-right"),element.style.paddingRight=padding||""}));var elements=[].slice.call(document.querySelectorAll("".concat(".sticky-top")));(0,_jquery.default)(elements).each((function(index,element){var margin=(0,_jquery.default)(element).data("margin-right");void 0!==margin&&(0,_jquery.default)(element).css("margin-right",margin).removeData("margin-right")}));var padding=(0,_jquery.default)(document.body).data("padding-right");(0,_jquery.default)(document.body).removeData("padding-right"),document.body.style.paddingRight=padding||""}},{key:"_getScrollbarWidth",value:function(){var scrollDiv=document.createElement("div");scrollDiv.className="modal-scrollbar-measure",document.body.appendChild(scrollDiv);var scrollbarWidth=scrollDiv.getBoundingClientRect().width-scrollDiv.clientWidth;return document.body.removeChild(scrollDiv),scrollbarWidth}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Modal}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,'[data-toggle="modal"]',(function(event){var target,_this11=this,selector=_util.default.getSelectorFromElement(this);selector&&(target=document.querySelector(selector));var config=(0,_jquery.default)(target).data("bs.modal")?"toggle":_objectSpread(_objectSpread({},(0,_jquery.default)(target).data()),(0,_jquery.default)(this).data());"A"!==this.tagName&&"AREA"!==this.tagName||event.preventDefault();var $target=(0,_jquery.default)(target).one(EVENT_SHOW,(function(showEvent){showEvent.isDefaultPrevented()||$target.one(EVENT_HIDDEN,(function(){(0,_jquery.default)(_this11).is(":visible")&&_this11.focus()}))}));Modal._jQueryInterface.call((0,_jquery.default)(target),config,this)})),_jquery.default.fn.modal=Modal._jQueryInterface,_jquery.default.fn.modal.Constructor=Modal,_jquery.default.fn.modal.noConflict=function(){return _jquery.default.fn.modal=JQUERY_NO_CONFLICT,Modal._jQueryInterface};var _default=Modal;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/tools/sanitizer",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.DefaultWhitelist=void 0,_exports.sanitizeHtml=function(unsafeHtml,whiteList,sanitizeFn){if(0===unsafeHtml.length)return unsafeHtml;if(sanitizeFn&&"function"==typeof sanitizeFn)return sanitizeFn(unsafeHtml);for(var createdDocument=(new window.DOMParser).parseFromString(unsafeHtml,"text/html"),whitelistKeys=Object.keys(whiteList),elements=[].slice.call(createdDocument.body.querySelectorAll("*")),_loop=function(i,len){var el=elements[i],elName=el.nodeName.toLowerCase();if(-1===whitelistKeys.indexOf(el.nodeName.toLowerCase()))return el.parentNode.removeChild(el),"continue";var attributeList=[].slice.call(el.attributes),whitelistedAttributes=[].concat(whiteList["*"]||[],whiteList[elName]||[]);attributeList.forEach((function(attr){(function(attr,allowedAttributeList){var attrName=attr.nodeName.toLowerCase();if(-1!==allowedAttributeList.indexOf(attrName))return-1===uriAttrs.indexOf(attrName)||Boolean(attr.nodeValue.match(SAFE_URL_PATTERN)||attr.nodeValue.match(DATA_URL_PATTERN));for(var regExp=allowedAttributeList.filter((function(attrRegex){return attrRegex instanceof RegExp})),i=0,len=regExp.length;i<len;i++)if(attrName.match(regExp[i]))return!0;return!1})(attr,whitelistedAttributes)||el.removeAttribute(attr.nodeName)}))},i=0,len=elements.length;i<len;i++)_loop(i);return createdDocument.body.innerHTML};var uriAttrs=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],DefaultWhitelist={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]};_exports.DefaultWhitelist=DefaultWhitelist;var SAFE_URL_PATTERN=/^(?:(?:https?|mailto|ftp|tel|file):|[^#&/:?]*(?:[#/?]|$))/gi,DATA_URL_PATTERN=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i}));
define("theme_boost/bootstrap/dropdown",["exports","jquery","core/popper","./util"],(function(_exports,_jquery,_popper,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_popper=_interopRequireDefault(_popper),_util=_interopRequireDefault(_util);var NAME="dropdown",DATA_KEY="bs.dropdown",EVENT_KEY=".".concat(DATA_KEY),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],REGEXP_KEYDOWN=new RegExp("".concat(38,"|").concat(40,"|").concat(27)),EVENT_HIDE="hide".concat(EVENT_KEY),EVENT_HIDDEN="hidden".concat(EVENT_KEY),EVENT_SHOW="show".concat(EVENT_KEY),EVENT_SHOWN="shown".concat(EVENT_KEY),EVENT_CLICK="click".concat(EVENT_KEY),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),EVENT_KEYDOWN_DATA_API="keydown".concat(EVENT_KEY).concat(".data-api"),EVENT_KEYUP_DATA_API="keyup".concat(EVENT_KEY).concat(".data-api"),Default={offset:0,flip:!0,boundary:"scrollParent",reference:"toggle",display:"dynamic",popperConfig:null},DefaultType={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)",reference:"(string|element)",display:"string",popperConfig:"(null|object)"},Dropdown=function(){function Dropdown(element,config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Dropdown),this._element=element,this._popper=null,this._config=this._getConfig(config),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}var Constructor,protoProps,staticProps;return Constructor=Dropdown,protoProps=[{key:"toggle",value:function(){if(!this._element.disabled&&!(0,_jquery.default)(this._element).hasClass("disabled")){var isActive=(0,_jquery.default)(this._menu).hasClass("show");Dropdown._clearMenus(),isActive||this.show(!0)}}},{key:"show",value:function(){var usePopper=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!(this._element.disabled||(0,_jquery.default)(this._element).hasClass("disabled")||(0,_jquery.default)(this._menu).hasClass("show"))){var relatedTarget={relatedTarget:this._element},showEvent=_jquery.default.Event(EVENT_SHOW,relatedTarget),parent=Dropdown._getParentFromElement(this._element);if((0,_jquery.default)(parent).trigger(showEvent),!showEvent.isDefaultPrevented()){if(!this._inNavbar&&usePopper){if(void 0===_popper.default)throw new TypeError("Bootstrap's dropdowns require Popper.js (https://popper.js.org/)");var referenceElement=this._element;"parent"===this._config.reference?referenceElement=parent:_util.default.isElement(this._config.reference)&&(referenceElement=this._config.reference,void 0!==this._config.reference.jquery&&(referenceElement=this._config.reference[0])),"scrollParent"!==this._config.boundary&&(0,_jquery.default)(parent).addClass("position-static"),this._popper=new _popper.default(referenceElement,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===(0,_jquery.default)(parent).closest(".navbar-nav").length&&(0,_jquery.default)(document.body).children().on("mouseover",null,_jquery.default.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),(0,_jquery.default)(this._menu).toggleClass("show"),(0,_jquery.default)(parent).toggleClass("show").trigger(_jquery.default.Event(EVENT_SHOWN,relatedTarget))}}}},{key:"hide",value:function(){if(!this._element.disabled&&!(0,_jquery.default)(this._element).hasClass("disabled")&&(0,_jquery.default)(this._menu).hasClass("show")){var relatedTarget={relatedTarget:this._element},hideEvent=_jquery.default.Event(EVENT_HIDE,relatedTarget),parent=Dropdown._getParentFromElement(this._element);(0,_jquery.default)(parent).trigger(hideEvent),hideEvent.isDefaultPrevented()||(this._popper&&this._popper.destroy(),(0,_jquery.default)(this._menu).toggleClass("show"),(0,_jquery.default)(parent).toggleClass("show").trigger(_jquery.default.Event(EVENT_HIDDEN,relatedTarget)))}}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,DATA_KEY),(0,_jquery.default)(this._element).off(EVENT_KEY),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)}},{key:"update",value:function(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()}},{key:"_addEventListeners",value:function(){var _this=this;(0,_jquery.default)(this._element).on(EVENT_CLICK,(function(event){event.preventDefault(),event.stopPropagation(),_this.toggle()}))}},{key:"_getConfig",value:function(config){return config=_objectSpread(_objectSpread(_objectSpread({},this.constructor.Default),(0,_jquery.default)(this._element).data()),config),_util.default.typeCheckConfig(NAME,config,this.constructor.DefaultType),config}},{key:"_getMenuElement",value:function(){if(!this._menu){var parent=Dropdown._getParentFromElement(this._element);parent&&(this._menu=parent.querySelector(".dropdown-menu"))}return this._menu}},{key:"_getPlacement",value:function(){var $parentDropdown=(0,_jquery.default)(this._element.parentNode),placement="bottom-start";return $parentDropdown.hasClass("dropup")?placement=(0,_jquery.default)(this._menu).hasClass("dropdown-menu-right")?"top-end":"top-start":$parentDropdown.hasClass("dropright")?placement="right-start":$parentDropdown.hasClass("dropleft")?placement="left-start":(0,_jquery.default)(this._menu).hasClass("dropdown-menu-right")&&(placement="bottom-end"),placement}},{key:"_detectNavbar",value:function(){return(0,_jquery.default)(this._element).closest(".navbar").length>0}},{key:"_getOffset",value:function(){var _this2=this,offset={};return"function"==typeof this._config.offset?offset.fn=function(data){return data.offsets=_objectSpread(_objectSpread({},data.offsets),_this2._config.offset(data.offsets,_this2._element)||{}),data}:offset.offset=this._config.offset,offset}},{key:"_getPopperConfig",value:function(){var popperConfig={placement:this._getPlacement(),modifiers:{offset:this._getOffset(),flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return"static"===this._config.display&&(popperConfig.modifiers.applyStyle={enabled:!1}),_objectSpread(_objectSpread({},popperConfig),this._config.popperConfig)}}],staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"DefaultType",get:function(){return DefaultType}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data(DATA_KEY),_config="object"===_typeof(config)?config:null;if(data||(data=new Dropdown(this,_config),(0,_jquery.default)(this).data(DATA_KEY,data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}},{key:"_clearMenus",value:function(event){if(!event||3!==event.which&&("keyup"!==event.type||9===event.which))for(var toggles=[].slice.call(document.querySelectorAll('[data-toggle="dropdown"]')),i=0,len=toggles.length;i<len;i++){var parent=Dropdown._getParentFromElement(toggles[i]),context=(0,_jquery.default)(toggles[i]).data(DATA_KEY),relatedTarget={relatedTarget:toggles[i]};if(event&&"click"===event.type&&(relatedTarget.clickEvent=event),context){var dropdownMenu=context._menu;if((0,_jquery.default)(parent).hasClass("show")&&!(event&&("click"===event.type&&/input|textarea/i.test(event.target.tagName)||"keyup"===event.type&&9===event.which)&&_jquery.default.contains(parent,event.target))){var hideEvent=_jquery.default.Event(EVENT_HIDE,relatedTarget);(0,_jquery.default)(parent).trigger(hideEvent),hideEvent.isDefaultPrevented()||("ontouchstart"in document.documentElement&&(0,_jquery.default)(document.body).children().off("mouseover",null,_jquery.default.noop),toggles[i].setAttribute("aria-expanded","false"),context._popper&&context._popper.destroy(),(0,_jquery.default)(dropdownMenu).removeClass("show"),(0,_jquery.default)(parent).removeClass("show").trigger(_jquery.default.Event(EVENT_HIDDEN,relatedTarget)))}}}}},{key:"_getParentFromElement",value:function(element){var parent,selector=_util.default.getSelectorFromElement(element);return selector&&(parent=document.querySelector(selector)),parent||element.parentNode}},{key:"_dataApiKeydownHandler",value:function(event){if(!(/input|textarea/i.test(event.target.tagName)?32===event.which||27!==event.which&&(40!==event.which&&38!==event.which||(0,_jquery.default)(event.target).closest(".dropdown-menu").length):!REGEXP_KEYDOWN.test(event.which))&&!this.disabled&&!(0,_jquery.default)(this).hasClass("disabled")){var parent=Dropdown._getParentFromElement(this),isActive=(0,_jquery.default)(parent).hasClass("show");if(isActive||27!==event.which){if(event.preventDefault(),event.stopPropagation(),!isActive||isActive&&(27===event.which||32===event.which))return 27===event.which&&(0,_jquery.default)(parent.querySelector('[data-toggle="dropdown"]')).trigger("focus"),void(0,_jquery.default)(this).trigger("click");var items=[].slice.call(parent.querySelectorAll(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)")).filter((function(item){return(0,_jquery.default)(item).is(":visible")}));if(0!==items.length){var index=items.indexOf(event.target);38===event.which&&index>0&&index--,40===event.which&&index<items.length-1&&index++,index<0&&(index=0),items[index].focus()}}}}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Dropdown}();(0,_jquery.default)(document).on(EVENT_KEYDOWN_DATA_API,'[data-toggle="dropdown"]',Dropdown._dataApiKeydownHandler).on(EVENT_KEYDOWN_DATA_API,".dropdown-menu",Dropdown._dataApiKeydownHandler).on("".concat(EVENT_CLICK_DATA_API," ").concat(EVENT_KEYUP_DATA_API),Dropdown._clearMenus).on(EVENT_CLICK_DATA_API,'[data-toggle="dropdown"]',(function(event){event.preventDefault(),event.stopPropagation(),Dropdown._jQueryInterface.call((0,_jquery.default)(this),"toggle")})).on(EVENT_CLICK_DATA_API,".dropdown form",(function(e){e.stopPropagation()})),_jquery.default.fn[NAME]=Dropdown._jQueryInterface,_jquery.default.fn[NAME].Constructor=Dropdown,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Dropdown._jQueryInterface};var _default=Dropdown;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/scrollspy",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var NAME="scrollspy",EVENT_KEY=".".concat("bs.scrollspy"),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],Default={offset:10,method:"auto",target:""},DefaultType={offset:"number",method:"string",target:"(string|element)"},EVENT_ACTIVATE="activate".concat(EVENT_KEY),EVENT_SCROLL="scroll".concat(EVENT_KEY),EVENT_LOAD_DATA_API="load".concat(EVENT_KEY).concat(".data-api"),ScrollSpy=function(){function ScrollSpy(element,config){var _this=this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ScrollSpy),this._element=element,this._scrollElement="BODY"===element.tagName?window:element,this._config=this._getConfig(config),this._selector="".concat(this._config.target," ").concat(".nav-link",",")+"".concat(this._config.target," ").concat(".list-group-item",",")+"".concat(this._config.target," ").concat(".dropdown-item"),this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,(0,_jquery.default)(this._scrollElement).on(EVENT_SCROLL,(function(event){return _this._process(event)})),this.refresh(),this._process()}var Constructor,protoProps,staticProps;return Constructor=ScrollSpy,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data("bs.scrollspy"),_config="object"===_typeof(config)&&config;if(data||(data=new ScrollSpy(this,_config),(0,_jquery.default)(this).data("bs.scrollspy",data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}}],(protoProps=[{key:"refresh",value:function(){var _this2=this,autoMethod=this._scrollElement===this._scrollElement.window?"offset":"position",offsetMethod="auto"===this._config.method?autoMethod:this._config.method,offsetBase="position"===offsetMethod?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight(),[].slice.call(document.querySelectorAll(this._selector)).map((function(element){var target,targetSelector=_util.default.getSelectorFromElement(element);if(targetSelector&&(target=document.querySelector(targetSelector)),target){var targetBCR=target.getBoundingClientRect();if(targetBCR.width||targetBCR.height)return[(0,_jquery.default)(target)[offsetMethod]().top+offsetBase,targetSelector]}return null})).filter((function(item){return item})).sort((function(a,b){return a[0]-b[0]})).forEach((function(item){_this2._offsets.push(item[0]),_this2._targets.push(item[1])}))}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,"bs.scrollspy"),(0,_jquery.default)(this._scrollElement).off(EVENT_KEY),this._element=null,this._scrollElement=null,this._config=null,this._selector=null,this._offsets=null,this._targets=null,this._activeTarget=null,this._scrollHeight=null}},{key:"_getConfig",value:function(config){if("string"!=typeof(config=_objectSpread(_objectSpread({},Default),"object"===_typeof(config)&&config?config:{})).target&&_util.default.isElement(config.target)){var id=(0,_jquery.default)(config.target).attr("id");id||(id=_util.default.getUID(NAME),(0,_jquery.default)(config.target).attr("id",id)),config.target="#".concat(id)}return _util.default.typeCheckConfig(NAME,config,DefaultType),config}},{key:"_getScrollTop",value:function(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop}},{key:"_getScrollHeight",value:function(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}},{key:"_getOffsetHeight",value:function(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height}},{key:"_process",value:function(){var scrollTop=this._getScrollTop()+this._config.offset,scrollHeight=this._getScrollHeight(),maxScroll=this._config.offset+scrollHeight-this._getOffsetHeight();if(this._scrollHeight!==scrollHeight&&this.refresh(),scrollTop>=maxScroll){var target=this._targets[this._targets.length-1];this._activeTarget!==target&&this._activate(target)}else{if(this._activeTarget&&scrollTop<this._offsets[0]&&this._offsets[0]>0)return this._activeTarget=null,void this._clear();for(var i=this._offsets.length;i--;)this._activeTarget!==this._targets[i]&&scrollTop>=this._offsets[i]&&(void 0===this._offsets[i+1]||scrollTop<this._offsets[i+1])&&this._activate(this._targets[i])}}},{key:"_activate",value:function(target){this._activeTarget=target,this._clear();var queries=this._selector.split(",").map((function(selector){return"".concat(selector,'[data-target="').concat(target,'"],').concat(selector,'[href="').concat(target,'"]')})),$link=(0,_jquery.default)([].slice.call(document.querySelectorAll(queries.join(","))));$link.hasClass("dropdown-item")?($link.closest(".dropdown").find(".dropdown-toggle").addClass("active"),$link.addClass("active")):($link.addClass("active"),$link.parents(".nav, .list-group").prev("".concat(".nav-link",", ").concat(".list-group-item")).addClass("active"),$link.parents(".nav, .list-group").prev(".nav-item").children(".nav-link").addClass("active")),(0,_jquery.default)(this._scrollElement).trigger(EVENT_ACTIVATE,{relatedTarget:target})}},{key:"_clear",value:function(){[].slice.call(document.querySelectorAll(this._selector)).filter((function(node){return node.classList.contains("active")})).forEach((function(node){return node.classList.remove("active")}))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),ScrollSpy}();(0,_jquery.default)(window).on(EVENT_LOAD_DATA_API,(function(){for(var scrollSpys=[].slice.call(document.querySelectorAll('[data-spy="scroll"]')),i=scrollSpys.length;i--;){var $spy=(0,_jquery.default)(scrollSpys[i]);ScrollSpy._jQueryInterface.call($spy,$spy.data())}})),_jquery.default.fn[NAME]=ScrollSpy._jQueryInterface,_jquery.default.fn[NAME].Constructor=ScrollSpy,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,ScrollSpy._jQueryInterface};var _default=ScrollSpy;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/tab",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var EVENT_KEY=".".concat("bs.tab"),JQUERY_NO_CONFLICT=_jquery.default.fn.tab,EVENT_HIDE="hide".concat(EVENT_KEY),EVENT_HIDDEN="hidden".concat(EVENT_KEY),EVENT_SHOW="show".concat(EVENT_KEY),EVENT_SHOWN="shown".concat(EVENT_KEY),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),Tab=function(){function Tab(element){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Tab),this._element=element}var Constructor,protoProps,staticProps;return Constructor=Tab,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var $this=(0,_jquery.default)(this),data=$this.data("bs.tab");if(data||(data=new Tab(this),$this.data("bs.tab",data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}}],(protoProps=[{key:"show",value:function(){var _this=this;if(!(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&(0,_jquery.default)(this._element).hasClass("active")||(0,_jquery.default)(this._element).hasClass("disabled"))){var target,previous,listElement=(0,_jquery.default)(this._element).closest(".nav, .list-group")[0],selector=_util.default.getSelectorFromElement(this._element);if(listElement){var itemSelector="UL"===listElement.nodeName||"OL"===listElement.nodeName?"> li > .active":".active";previous=(previous=_jquery.default.makeArray((0,_jquery.default)(listElement).find(itemSelector)))[previous.length-1]}var hideEvent=_jquery.default.Event(EVENT_HIDE,{relatedTarget:this._element}),showEvent=_jquery.default.Event(EVENT_SHOW,{relatedTarget:previous});if(previous&&(0,_jquery.default)(previous).trigger(hideEvent),(0,_jquery.default)(this._element).trigger(showEvent),!showEvent.isDefaultPrevented()&&!hideEvent.isDefaultPrevented()){selector&&(target=document.querySelector(selector)),this._activate(this._element,listElement);var complete=function(){var hiddenEvent=_jquery.default.Event(EVENT_HIDDEN,{relatedTarget:_this._element}),shownEvent=_jquery.default.Event(EVENT_SHOWN,{relatedTarget:previous});(0,_jquery.default)(previous).trigger(hiddenEvent),(0,_jquery.default)(_this._element).trigger(shownEvent)};target?this._activate(target,target.parentNode,complete):complete()}}}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,"bs.tab"),this._element=null}},{key:"_activate",value:function(element,container,callback){var _this2=this,active=(!container||"UL"!==container.nodeName&&"OL"!==container.nodeName?(0,_jquery.default)(container).children(".active"):(0,_jquery.default)(container).find("> li > .active"))[0],isTransitioning=callback&&active&&(0,_jquery.default)(active).hasClass("fade"),complete=function(){return _this2._transitionComplete(element,active,callback)};if(active&&isTransitioning){var transitionDuration=_util.default.getTransitionDurationFromElement(active);(0,_jquery.default)(active).removeClass("show").one(_util.default.TRANSITION_END,complete).emulateTransitionEnd(transitionDuration)}else complete()}},{key:"_transitionComplete",value:function(element,active,callback){if(active){(0,_jquery.default)(active).removeClass("active");var dropdownChild=(0,_jquery.default)(active.parentNode).find("> .dropdown-menu .active")[0];dropdownChild&&(0,_jquery.default)(dropdownChild).removeClass("active"),"tab"===active.getAttribute("role")&&active.setAttribute("aria-selected",!1)}if((0,_jquery.default)(element).addClass("active"),"tab"===element.getAttribute("role")&&element.setAttribute("aria-selected",!0),_util.default.reflow(element),element.classList.contains("fade")&&element.classList.add("show"),element.parentNode&&(0,_jquery.default)(element.parentNode).hasClass("dropdown-menu")){var dropdownElement=(0,_jquery.default)(element).closest(".dropdown")[0];if(dropdownElement){var dropdownToggleList=[].slice.call(dropdownElement.querySelectorAll(".dropdown-toggle"));(0,_jquery.default)(dropdownToggleList).addClass("active")}element.setAttribute("aria-expanded",!0)}callback&&callback()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Tab}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,'[data-toggle="tab"], [data-toggle="pill"], [data-toggle="list"]',(function(event){event.preventDefault(),Tab._jQueryInterface.call((0,_jquery.default)(this),"show")})),_jquery.default.fn.tab=Tab._jQueryInterface,_jquery.default.fn.tab.Constructor=Tab,_jquery.default.fn.tab.noConflict=function(){return _jquery.default.fn.tab=JQUERY_NO_CONFLICT,Tab._jQueryInterface};var _default=Tab;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/tooltip",["exports","./tools/sanitizer","jquery","core/popper","./util"],(function(_exports,_sanitizer,_jquery,_popper,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_popper=_interopRequireDefault(_popper),_util=_interopRequireDefault(_util);var NAME="tooltip",EVENT_KEY=".".concat("bs.tooltip"),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],BSCLS_PREFIX_REGEX=new RegExp("(^|\\s)".concat("bs-tooltip","\\S+"),"g"),DISALLOWED_ATTRIBUTES=["sanitize","whiteList","sanitizeFn"],DefaultType={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(number|string|function)",container:"(string|element|boolean)",fallbackPlacement:"(string|array)",boundary:"(string|element)",sanitize:"boolean",sanitizeFn:"(null|function)",whiteList:"object",popperConfig:"(null|object)"},AttachmentMap={AUTO:"auto",TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},Default={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:0,container:!1,fallbackPlacement:"flip",boundary:"scrollParent",sanitize:!0,sanitizeFn:null,whiteList:_sanitizer.DefaultWhitelist,popperConfig:null},Event={HIDE:"hide".concat(EVENT_KEY),HIDDEN:"hidden".concat(EVENT_KEY),SHOW:"show".concat(EVENT_KEY),SHOWN:"shown".concat(EVENT_KEY),INSERTED:"inserted".concat(EVENT_KEY),CLICK:"click".concat(EVENT_KEY),FOCUSIN:"focusin".concat(EVENT_KEY),FOCUSOUT:"focusout".concat(EVENT_KEY),MOUSEENTER:"mouseenter".concat(EVENT_KEY),MOUSELEAVE:"mouseleave".concat(EVENT_KEY)},Tooltip=function(){function Tooltip(element,config){if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Tooltip),void 0===_popper.default)throw new TypeError("Bootstrap's tooltips require Popper.js (https://popper.js.org/)");this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this.element=element,this.config=this._getConfig(config),this.tip=null,this._setListeners()}var Constructor,protoProps,staticProps;return Constructor=Tooltip,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"NAME",get:function(){return NAME}},{key:"DATA_KEY",get:function(){return"bs.tooltip"}},{key:"Event",get:function(){return Event}},{key:"EVENT_KEY",get:function(){return EVENT_KEY}},{key:"DefaultType",get:function(){return DefaultType}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data("bs.tooltip"),_config="object"===_typeof(config)&&config;if((data||!/dispose|hide/.test(config))&&(data||(data=new Tooltip(this,_config),(0,_jquery.default)(this).data("bs.tooltip",data)),"string"==typeof config)){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}}],(protoProps=[{key:"enable",value:function(){this._isEnabled=!0}},{key:"disable",value:function(){this._isEnabled=!1}},{key:"toggleEnabled",value:function(){this._isEnabled=!this._isEnabled}},{key:"toggle",value:function(event){if(this._isEnabled)if(event){var dataKey=this.constructor.DATA_KEY,context=(0,_jquery.default)(event.currentTarget).data(dataKey);context||(context=new this.constructor(event.currentTarget,this._getDelegateConfig()),(0,_jquery.default)(event.currentTarget).data(dataKey,context)),context._activeTrigger.click=!context._activeTrigger.click,context._isWithActiveTrigger()?context._enter(null,context):context._leave(null,context)}else{if((0,_jquery.default)(this.getTipElement()).hasClass("show"))return void this._leave(null,this);this._enter(null,this)}}},{key:"dispose",value:function(){clearTimeout(this._timeout),_jquery.default.removeData(this.element,this.constructor.DATA_KEY),(0,_jquery.default)(this.element).off(this.constructor.EVENT_KEY),(0,_jquery.default)(this.element).closest(".modal").off("hide.bs.modal",this._hideModalHandler),this.tip&&(0,_jquery.default)(this.tip).remove(),this._isEnabled=null,this._timeout=null,this._hoverState=null,this._activeTrigger=null,this._popper&&this._popper.destroy(),this._popper=null,this.element=null,this.config=null,this.tip=null}},{key:"show",value:function(){var _this=this;if("none"===(0,_jquery.default)(this.element).css("display"))throw new Error("Please use show on visible elements");var showEvent=_jquery.default.Event(this.constructor.Event.SHOW);if(this.isWithContent()&&this._isEnabled){(0,_jquery.default)(this.element).trigger(showEvent);var shadowRoot=_util.default.findShadowRoot(this.element),isInTheDom=_jquery.default.contains(null!==shadowRoot?shadowRoot:this.element.ownerDocument.documentElement,this.element);if(showEvent.isDefaultPrevented()||!isInTheDom)return;var tip=this.getTipElement(),tipId=_util.default.getUID(this.constructor.NAME);tip.setAttribute("id",tipId),this.element.setAttribute("aria-describedby",tipId),this.setContent(),this.config.animation&&(0,_jquery.default)(tip).addClass("fade");var placement="function"==typeof this.config.placement?this.config.placement.call(this,tip,this.element):this.config.placement,attachment=this._getAttachment(placement);this.addAttachmentClass(attachment);var container=this._getContainer();(0,_jquery.default)(tip).data(this.constructor.DATA_KEY,this),_jquery.default.contains(this.element.ownerDocument.documentElement,this.tip)||(0,_jquery.default)(tip).appendTo(container),(0,_jquery.default)(this.element).trigger(this.constructor.Event.INSERTED),this._popper=new _popper.default(this.element,tip,this._getPopperConfig(attachment)),(0,_jquery.default)(tip).addClass("show"),"ontouchstart"in document.documentElement&&(0,_jquery.default)(document.body).children().on("mouseover",null,_jquery.default.noop);var complete=function(){_this.config.animation&&_this._fixTransition();var prevHoverState=_this._hoverState;_this._hoverState=null,(0,_jquery.default)(_this.element).trigger(_this.constructor.Event.SHOWN),"out"===prevHoverState&&_this._leave(null,_this)};if((0,_jquery.default)(this.tip).hasClass("fade")){var transitionDuration=_util.default.getTransitionDurationFromElement(this.tip);(0,_jquery.default)(this.tip).one(_util.default.TRANSITION_END,complete).emulateTransitionEnd(transitionDuration)}else complete()}}},{key:"hide",value:function(callback){var _this2=this,tip=this.getTipElement(),hideEvent=_jquery.default.Event(this.constructor.Event.HIDE),complete=function(){"show"!==_this2._hoverState&&tip.parentNode&&tip.parentNode.removeChild(tip),_this2._cleanTipClass(),_this2.element.removeAttribute("aria-describedby"),(0,_jquery.default)(_this2.element).trigger(_this2.constructor.Event.HIDDEN),null!==_this2._popper&&_this2._popper.destroy(),callback&&callback()};if((0,_jquery.default)(this.element).trigger(hideEvent),!hideEvent.isDefaultPrevented()){if((0,_jquery.default)(tip).removeClass("show"),"ontouchstart"in document.documentElement&&(0,_jquery.default)(document.body).children().off("mouseover",null,_jquery.default.noop),this._activeTrigger.click=!1,this._activeTrigger.focus=!1,this._activeTrigger.hover=!1,(0,_jquery.default)(this.tip).hasClass("fade")){var transitionDuration=_util.default.getTransitionDurationFromElement(tip);(0,_jquery.default)(tip).one(_util.default.TRANSITION_END,complete).emulateTransitionEnd(transitionDuration)}else complete();this._hoverState=""}}},{key:"update",value:function(){null!==this._popper&&this._popper.scheduleUpdate()}},{key:"isWithContent",value:function(){return Boolean(this.getTitle())}},{key:"addAttachmentClass",value:function(attachment){(0,_jquery.default)(this.getTipElement()).addClass("".concat("bs-tooltip","-").concat(attachment))}},{key:"getTipElement",value:function(){return this.tip=this.tip||(0,_jquery.default)(this.config.template)[0],this.tip}},{key:"setContent",value:function(){var tip=this.getTipElement();this.setElementContent((0,_jquery.default)(tip.querySelectorAll(".tooltip-inner")),this.getTitle()),(0,_jquery.default)(tip).removeClass("".concat("fade"," ").concat("show"))}},{key:"setElementContent",value:function($element,content){"object"!==_typeof(content)||!content.nodeType&&!content.jquery?this.config.html?(this.config.sanitize&&(content=(0,_sanitizer.sanitizeHtml)(content,this.config.whiteList,this.config.sanitizeFn)),$element.html(content)):$element.text(content):this.config.html?(0,_jquery.default)(content).parent().is($element)||$element.empty().append(content):$element.text((0,_jquery.default)(content).text())}},{key:"getTitle",value:function(){var title=this.element.getAttribute("data-original-title");return title||(title="function"==typeof this.config.title?this.config.title.call(this.element):this.config.title),title}},{key:"_getPopperConfig",value:function(attachment){var _this3=this;return _objectSpread(_objectSpread({},{placement:attachment,modifiers:{offset:this._getOffset(),flip:{behavior:this.config.fallbackPlacement},arrow:{element:".arrow"},preventOverflow:{boundariesElement:this.config.boundary}},onCreate:function(data){data.originalPlacement!==data.placement&&_this3._handlePopperPlacementChange(data)},onUpdate:function(data){return _this3._handlePopperPlacementChange(data)}}),this.config.popperConfig)}},{key:"_getOffset",value:function(){var _this4=this,offset={};return"function"==typeof this.config.offset?offset.fn=function(data){return data.offsets=_objectSpread(_objectSpread({},data.offsets),_this4.config.offset(data.offsets,_this4.element)||{}),data}:offset.offset=this.config.offset,offset}},{key:"_getContainer",value:function(){return!1===this.config.container?document.body:_util.default.isElement(this.config.container)?(0,_jquery.default)(this.config.container):(0,_jquery.default)(document).find(this.config.container)}},{key:"_getAttachment",value:function(placement){return AttachmentMap[placement.toUpperCase()]}},{key:"_setListeners",value:function(){var _this5=this;this.config.trigger.split(" ").forEach((function(trigger){if("click"===trigger)(0,_jquery.default)(_this5.element).on(_this5.constructor.Event.CLICK,_this5.config.selector,(function(event){return _this5.toggle(event)}));else if("manual"!==trigger){var eventIn="hover"===trigger?_this5.constructor.Event.MOUSEENTER:_this5.constructor.Event.FOCUSIN,eventOut="hover"===trigger?_this5.constructor.Event.MOUSELEAVE:_this5.constructor.Event.FOCUSOUT;(0,_jquery.default)(_this5.element).on(eventIn,_this5.config.selector,(function(event){return _this5._enter(event)})).on(eventOut,_this5.config.selector,(function(event){return _this5._leave(event)}))}})),this._hideModalHandler=function(){_this5.element&&_this5.hide()},(0,_jquery.default)(this.element).closest(".modal").on("hide.bs.modal",this._hideModalHandler),this.config.selector?this.config=_objectSpread(_objectSpread({},this.config),{},{trigger:"manual",selector:""}):this._fixTitle()}},{key:"_fixTitle",value:function(){var titleType=_typeof(this.element.getAttribute("data-original-title"));(this.element.getAttribute("title")||"string"!==titleType)&&(this.element.setAttribute("data-original-title",this.element.getAttribute("title")||""),this.element.setAttribute("title",""))}},{key:"_enter",value:function(event,context){var dataKey=this.constructor.DATA_KEY;(context=context||(0,_jquery.default)(event.currentTarget).data(dataKey))||(context=new this.constructor(event.currentTarget,this._getDelegateConfig()),(0,_jquery.default)(event.currentTarget).data(dataKey,context)),event&&(context._activeTrigger["focusin"===event.type?"focus":"hover"]=!0),(0,_jquery.default)(context.getTipElement()).hasClass("show")||"show"===context._hoverState?context._hoverState="show":(clearTimeout(context._timeout),context._hoverState="show",context.config.delay&&context.config.delay.show?context._timeout=setTimeout((function(){"show"===context._hoverState&&context.show()}),context.config.delay.show):context.show())}},{key:"_leave",value:function(event,context){var dataKey=this.constructor.DATA_KEY;(context=context||(0,_jquery.default)(event.currentTarget).data(dataKey))||(context=new this.constructor(event.currentTarget,this._getDelegateConfig()),(0,_jquery.default)(event.currentTarget).data(dataKey,context)),event&&(context._activeTrigger["focusout"===event.type?"focus":"hover"]=!1),context._isWithActiveTrigger()||(clearTimeout(context._timeout),context._hoverState="out",context.config.delay&&context.config.delay.hide?context._timeout=setTimeout((function(){"out"===context._hoverState&&context.hide()}),context.config.delay.hide):context.hide())}},{key:"_isWithActiveTrigger",value:function(){for(var trigger in this._activeTrigger)if(this._activeTrigger[trigger])return!0;return!1}},{key:"_getConfig",value:function(config){var dataAttributes=(0,_jquery.default)(this.element).data();return Object.keys(dataAttributes).forEach((function(dataAttr){-1!==DISALLOWED_ATTRIBUTES.indexOf(dataAttr)&&delete dataAttributes[dataAttr]})),"number"==typeof(config=_objectSpread(_objectSpread(_objectSpread({},this.constructor.Default),dataAttributes),"object"===_typeof(config)&&config?config:{})).delay&&(config.delay={show:config.delay,hide:config.delay}),"number"==typeof config.title&&(config.title=config.title.toString()),"number"==typeof config.content&&(config.content=config.content.toString()),_util.default.typeCheckConfig(NAME,config,this.constructor.DefaultType),config.sanitize&&(config.template=(0,_sanitizer.sanitizeHtml)(config.template,config.whiteList,config.sanitizeFn)),config}},{key:"_getDelegateConfig",value:function(){var config={};if(this.config)for(var key in this.config)this.constructor.Default[key]!==this.config[key]&&(config[key]=this.config[key]);return config}},{key:"_cleanTipClass",value:function(){var $tip=(0,_jquery.default)(this.getTipElement()),tabClass=$tip.attr("class").match(BSCLS_PREFIX_REGEX);null!==tabClass&&tabClass.length&&$tip.removeClass(tabClass.join(""))}},{key:"_handlePopperPlacementChange",value:function(popperData){this.tip=popperData.instance.popper,this._cleanTipClass(),this.addAttachmentClass(this._getAttachment(popperData.placement))}},{key:"_fixTransition",value:function(){var tip=this.getTipElement(),initConfigAnimation=this.config.animation;null===tip.getAttribute("x-placement")&&((0,_jquery.default)(tip).removeClass("fade"),this.config.animation=!1,this.hide(),this.show(),this.config.animation=initConfigAnimation)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Tooltip}();_jquery.default.fn[NAME]=Tooltip._jQueryInterface,_jquery.default.fn[NAME].Constructor=Tooltip,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Tooltip._jQueryInterface};var _default=Tooltip;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/alert",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var EVENT_KEY=".".concat("bs.alert"),JQUERY_NO_CONFLICT=_jquery.default.fn.alert,EVENT_CLOSE="close".concat(EVENT_KEY),EVENT_CLOSED="closed".concat(EVENT_KEY),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),Alert=function(){function Alert(element){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Alert),this._element=element}var Constructor,protoProps,staticProps;return Constructor=Alert,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var $element=(0,_jquery.default)(this),data=$element.data("bs.alert");data||(data=new Alert(this),$element.data("bs.alert",data)),"close"===config&&data[config](this)}))}},{key:"_handleDismiss",value:function(alertInstance){return function(event){event&&event.preventDefault(),alertInstance.close(this)}}}],(protoProps=[{key:"close",value:function(element){var rootElement=this._element;element&&(rootElement=this._getRootElement(element)),this._triggerCloseEvent(rootElement).isDefaultPrevented()||this._removeElement(rootElement)}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,"bs.alert"),this._element=null}},{key:"_getRootElement",value:function(element){var selector=_util.default.getSelectorFromElement(element),parent=!1;return selector&&(parent=document.querySelector(selector)),parent||(parent=(0,_jquery.default)(element).closest(".".concat("alert"))[0]),parent}},{key:"_triggerCloseEvent",value:function(element){var closeEvent=_jquery.default.Event(EVENT_CLOSE);return(0,_jquery.default)(element).trigger(closeEvent),closeEvent}},{key:"_removeElement",value:function(element){var _this=this;if((0,_jquery.default)(element).removeClass("show"),(0,_jquery.default)(element).hasClass("fade")){var transitionDuration=_util.default.getTransitionDurationFromElement(element);(0,_jquery.default)(element).one(_util.default.TRANSITION_END,(function(event){return _this._destroyElement(element,event)})).emulateTransitionEnd(transitionDuration)}else this._destroyElement(element)}},{key:"_destroyElement",value:function(element){(0,_jquery.default)(element).detach().trigger(EVENT_CLOSED).remove()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Alert}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,'[data-dismiss="alert"]',Alert._handleDismiss(new Alert)),_jquery.default.fn.alert=Alert._jQueryInterface,_jquery.default.fn.alert.Constructor=Alert,_jquery.default.fn.alert.noConflict=function(){return _jquery.default.fn.alert=JQUERY_NO_CONFLICT,Alert._jQueryInterface};var _default=Alert;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/button",["exports","jquery"],(function(_exports,_jquery){var obj;function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};var NAME="button",EVENT_KEY=".".concat("bs.button"),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),EVENT_FOCUS_BLUR_DATA_API="focus".concat(EVENT_KEY).concat(".data-api"," ")+"blur".concat(EVENT_KEY).concat(".data-api"),EVENT_LOAD_DATA_API="load".concat(EVENT_KEY).concat(".data-api"),Button=function(){function Button(element){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Button),this._element=element}var Constructor,protoProps,staticProps;return Constructor=Button,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data("bs.button");data||(data=new Button(this),(0,_jquery.default)(this).data("bs.button",data)),"toggle"===config&&data[config]()}))}}],(protoProps=[{key:"toggle",value:function(){var triggerChangeEvent=!0,addAriaPressed=!0,rootElement=(0,_jquery.default)(this._element).closest('[data-toggle="buttons"]')[0];if(rootElement){var input=this._element.querySelector('input:not([type="hidden"])');if(input){if("radio"===input.type)if(input.checked&&this._element.classList.contains("active"))triggerChangeEvent=!1;else{var activeElement=rootElement.querySelector(".active");activeElement&&(0,_jquery.default)(activeElement).removeClass("active")}triggerChangeEvent&&("checkbox"!==input.type&&"radio"!==input.type||(input.checked=!this._element.classList.contains("active")),(0,_jquery.default)(input).trigger("change")),input.focus(),addAriaPressed=!1}}this._element.hasAttribute("disabled")||this._element.classList.contains("disabled")||(addAriaPressed&&this._element.setAttribute("aria-pressed",!this._element.classList.contains("active")),triggerChangeEvent&&(0,_jquery.default)(this._element).toggleClass("active"))}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,"bs.button"),this._element=null}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Button}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,'[data-toggle^="button"]',(function(event){var button=event.target,initialButton=button;if((0,_jquery.default)(button).hasClass("btn")||(button=(0,_jquery.default)(button).closest(".btn")[0]),!button||button.hasAttribute("disabled")||button.classList.contains("disabled"))event.preventDefault();else{var inputBtn=button.querySelector('input:not([type="hidden"])');if(inputBtn&&(inputBtn.hasAttribute("disabled")||inputBtn.classList.contains("disabled")))return void event.preventDefault();"LABEL"===initialButton.tagName&&inputBtn&&"checkbox"===inputBtn.type&&event.preventDefault(),Button._jQueryInterface.call((0,_jquery.default)(button),"toggle")}})).on(EVENT_FOCUS_BLUR_DATA_API,'[data-toggle^="button"]',(function(event){var button=(0,_jquery.default)(event.target).closest(".btn")[0];(0,_jquery.default)(button).toggleClass("focus",/^focus(in)?$/.test(event.type))})),(0,_jquery.default)(window).on(EVENT_LOAD_DATA_API,(function(){for(var buttons=[].slice.call(document.querySelectorAll('[data-toggle="buttons"] .btn')),i=0,len=buttons.length;i<len;i++){var button=buttons[i],input=button.querySelector('input:not([type="hidden"])');input.checked||input.hasAttribute("checked")?button.classList.add("active"):button.classList.remove("active")}for(var _i=0,_len=(buttons=[].slice.call(document.querySelectorAll('[data-toggle="button"]'))).length;_i<_len;_i++){var _button=buttons[_i];"true"===_button.getAttribute("aria-pressed")?_button.classList.add("active"):_button.classList.remove("active")}})),_jquery.default.fn[NAME]=Button._jQueryInterface,_jquery.default.fn[NAME].Constructor=Button,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Button._jQueryInterface};var _default=Button;return _exports.default=_default,_exports.default}));
/**
 * Contain the logic for a drawer.
 *
 * @package    theme_boost
 * @copyright  2016 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_boost/drawer",["jquery","core/custom_interaction_events","core/log","core/pubsub"],(function($,CustomEvents,Log,PubSub){var SELECTORS_TOGGLE_REGION='[data-region="drawer-toggle"]',SELECTORS_TOGGLE_ACTION='[data-action="toggle-drawer"]',SELECTORS_BODY="body",SELECTORS_SECTION='.list-group-item[href*="#section-"]',SELECTORS_DRAWER="#nav-drawer",small=$(document).width()<768,Drawer=function(){$(SELECTORS_TOGGLE_REGION).length||Log.debug("Page is missing a drawer region"),$(SELECTORS_TOGGLE_ACTION).length||Log.debug("Page is missing a drawer toggle link"),$(SELECTORS_TOGGLE_REGION).each(function(index,ele){var trigger=$(ele).find(SELECTORS_TOGGLE_ACTION),drawerid=trigger.attr("aria-controls"),drawer=$(document.getElementById(drawerid)),hidden="false"==trigger.attr("aria-expanded"),side=trigger.attr("data-side"),body=$(SELECTORS_BODY),preference=trigger.attr("data-preference");small&&M.util.set_user_preference(preference,"false"),drawer.on("mousewheel DOMMouseScroll",this.preventPageScroll),hidden?trigger.attr("aria-expanded","false"):(body.addClass("drawer-open-"+side),trigger.attr("aria-expanded","true"))}.bind(this)),this.registerEventListeners(),small&&this.closeAll()};return Drawer.prototype.closeAll=function(){$(SELECTORS_TOGGLE_REGION).each((function(index,ele){var trigger=$(ele).find(SELECTORS_TOGGLE_ACTION),side=trigger.attr("data-side"),body=$(SELECTORS_BODY),drawerid=trigger.attr("aria-controls"),drawer=$(document.getElementById(drawerid)),preference=trigger.attr("data-preference");trigger.attr("aria-expanded","false"),body.removeClass("drawer-open-"+side),drawer.attr("aria-hidden","true"),drawer.addClass("closed"),small||M.util.set_user_preference(preference,"false")}))},Drawer.prototype.toggleDrawer=function(e){var trigger=$(e.target).closest("[data-action=toggle-drawer]"),drawerid=trigger.attr("aria-controls"),drawer=$(document.getElementById(drawerid)),body=$(SELECTORS_BODY),side=trigger.attr("data-side"),preference=trigger.attr("data-preference");small&&M.util.set_user_preference(preference,"false"),body.addClass("drawer-ease");var open="true"==trigger.attr("aria-expanded");open?(body.removeClass("drawer-open-"+side),trigger.attr("aria-expanded","false"),drawer.addClass("closed").delay(500).queue((function(){$(this).hasClass("closed")&&$(this).attr("aria-hidden","true"),$(this).dequeue()})),small||M.util.set_user_preference(preference,"false")):(trigger.attr("aria-expanded","true"),drawer.attr("aria-hidden","false"),drawer.focus(),body.addClass("drawer-open-"+side),drawer.removeClass("closed"),small||M.util.set_user_preference(preference,"true")),PubSub.publish("nav-drawer-toggle-start",open)},Drawer.prototype.preventPageScroll=function(e){var delta=e.wheelDelta||e.originalEvent&&e.originalEvent.wheelDelta||-e.originalEvent.detail,bottomOverflow=this.scrollTop+$(this).outerHeight()-this.scrollHeight>=0,topOverflow=this.scrollTop<=0;(delta<0&&bottomOverflow||delta>0&&topOverflow)&&e.preventDefault()},Drawer.prototype.registerEventListeners=function(){$(SELECTORS_TOGGLE_ACTION).each(function(index,element){CustomEvents.define($(element),[CustomEvents.events.activate]),$(element).on(CustomEvents.events.activate,function(e,data){this.toggleDrawer(data.originalEvent),data.originalEvent.preventDefault()}.bind(this))}.bind(this)),$(SELECTORS_SECTION).click(function(){small&&this.closeAll()}.bind(this)),$(SELECTORS_DRAWER).on("webkitTransitionEnd msTransitionEnd transitionend",(function(e){var open="false"==$(e.target).closest(SELECTORS_DRAWER).attr("aria-hidden");PubSub.publish("nav-drawer-toggle-end",open)}))},{init:function(){return new Drawer}}}));
define("theme_boost/popover",["exports","./bootstrap/popover"],(function(_exports,_popover){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"Popover",{enumerable:!0,get:function(){return _popover.default}}),_popover=(obj=_popover)&&obj.__esModule?obj:{default:obj}}));
define("theme_boost/aria",["exports","core/key_codes","jquery","core/pending"],(function(_exports,_key_codes,_jquery,_pending){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Enhancements to Bootstrap components for accessibility.
   *
   * @module     theme_boost/aria
   * @copyright  2018 Damyon Wiese <damyon@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_pending=_interopRequireDefault(_pending);var dropdownFix=function(){var focusEnd=!1;document.addEventListener("keydown",(function(e){if(e.target.matches('[data-toggle="dropdown"]')){var trigger=e.which;trigger==_key_codes.arrowUp&&(focusEnd=!0),trigger!=_key_codes.space&&trigger!=_key_codes.enter||(e.preventDefault(),e.target.click())}}));var shiftFocus=function(element){setTimeout((function(pendingPromise){element.focus(),pendingPromise.resolve()}),50,new _pending.default("core/aria:delayed-focus"))};(0,_jquery.default)(".dropdown").on("shown.bs.dropdown",(function(e){var result,menu=e.target.querySelector('[role="menu"]'),menuItems=!1,foundMenuItem=!1;menu&&(menuItems=menu.querySelectorAll('[role="menuitem"]')),menuItems&&menuItems.length>0&&(result=focusEnd,focusEnd=!1,foundMenuItem=result?menuItems[menuItems.length-1]:menuItems[0]),foundMenuItem&&shiftFocus(foundMenuItem)})),document.addEventListener("keypress",(function(e){if(e.target.matches('.dropdown [role="menu"] [role="menuitem"]')){var trigger=String.fromCharCode(e.which).toLowerCase(),menu=e.target.closest('[role="menu"]');if(!menu)return;var menuItems=menu.querySelectorAll('[role="menuitem"]');if(!menuItems)return;for(var i=0;i<menuItems.length;i++){var item=menuItems[i];if(0==item.text.trim().toLowerCase().indexOf(trigger)){shiftFocus(item);break}}}})),document.addEventListener("keydown",(function(e){if(e.target.matches('.dropdown [role="menu"] [role="menuitem"]')){var trigger=e.which,next=!1,menu=e.target.closest('[role="menu"]');if(!menu)return;var menuItems=menu.querySelectorAll('[role="menuitem"]');if(!menuItems)return;if(trigger==_key_codes.arrowDown){for(var i=0;i<menuItems.length-1;i++)if(menuItems[i]==e.target){next=menuItems[i+1];break}next||(next=menuItems[0])}else if(trigger==_key_codes.arrowUp){for(var _i=1;_i<menuItems.length;_i++)if(menuItems[_i]==e.target){next=menuItems[_i-1];break}next||(next=menuItems[menuItems.length-1])}else trigger==_key_codes.home?next=menuItems[0]:trigger==_key_codes.end&&(next=menuItems[menuItems.length-1]);next&&(e.preventDefault(),shiftFocus(next))}else;})),(0,_jquery.default)(".dropdown").on("hidden.bs.dropdown",(function(e){var trigger=e.target.querySelector('[data-toggle="dropdown"]');trigger&&shiftFocus(trigger)}))},tabElementFix=function(){document.addEventListener("keydown",(function(e){[_key_codes.arrowUp,_key_codes.arrowDown,_key_codes.arrowLeft,_key_codes.arrowRight,_key_codes.home,_key_codes.end,_key_codes.enter,_key_codes.space].includes(e.keyCode)&&e.target.matches('[role="tablist"] [role="tab"]')&&function(e){for(var tabList=e.target.closest('[role="tablist"]'),vertical="vertical"==tabList.getAttribute("aria-orientation"),rtl=window.right_to_left(),arrowNext=vertical?_key_codes.arrowDown:rtl?_key_codes.arrowLeft:_key_codes.arrowRight,arrowPrevious=vertical?_key_codes.arrowUp:rtl?_key_codes.arrowRight:_key_codes.arrowLeft,tabs=Array.prototype.filter.call(tabList.querySelectorAll('[role="tab"]'),(function(tab){return"none"!==getComputedStyle(tab).display})),i=0;i<tabs.length;i++)tabs[i].index=i;switch(e.keyCode){case arrowNext:e.preventDefault(),void 0!==e.target.index&&tabs[e.target.index+1]?tabs[e.target.index+1].focus():tabs[0].focus();break;case arrowPrevious:e.preventDefault(),void 0!==e.target.index&&tabs[e.target.index-1]?tabs[e.target.index-1].focus():tabs[tabs.length-1].focus();break;case _key_codes.home:e.preventDefault(),tabs[0].focus();break;case _key_codes.end:e.preventDefault(),tabs[tabs.length-1].focus();break;case _key_codes.enter:case _key_codes.space:e.preventDefault(),(0,_jquery.default)(e.target).tab("show"),tabs.forEach((function(tab){tab.tabIndex=-1})),e.target.tabIndex=0}}(e)})),document.addEventListener("click",(function(e){if(e.target.matches('[role="tablist"] [role="tab"]')){var tabs=e.target.closest('[role="tablist"]').querySelectorAll('[role="tab"]');e.preventDefault(),(0,_jquery.default)(e.target).tab("show"),tabs.forEach((function(tab){tab.tabIndex=-1})),e.target.tabIndex=0}}))};_exports.init=function(){dropdownFix(),window.addEventListener("load",(function(){var alerts=document.querySelectorAll('[data-aria-autofocus="true"][role="alert"]');Array.prototype.forEach.call(alerts,(function(autofocusElement){autofocusElement.innerHTML+=" ",autofocusElement.removeAttribute("data-aria-autofocus")}))})),tabElementFix()}}));
define("theme_boost/toast",["exports","./bootstrap/toast"],(function(_exports,_toast){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"Toast",{enumerable:!0,get:function(){return _toast.default}}),_toast=(obj=_toast)&&obj.__esModule?obj:{default:obj}}));
/**
 * Custom form error event handler to manipulate the bootstrap markup and show
 * nicely styled errors in an mform.
 *
 * @module     theme_boost/form-display-errors
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_boost/form-display-errors",["jquery","core/event"],(function($,Event){return{enhance:function(elementid){var element=document.getElementById(elementid);if(element){$(element).on(Event.Events.FORM_FIELD_VALIDATION,(function(event,msg){event.preventDefault();var parent=$(element).closest(".form-group"),feedback=parent.find(".form-control-feedback"),feedbackId=feedback.attr("id"),describedBy=$(element).attr("aria-describedby");void 0===describedBy&&(describedBy="");var describedByIds=[];describedBy.length&&(describedByIds=describedBy.split(" "));var feedbackIndex=describedByIds.indexOf(feedbackId);"TEXTAREA"==$(element).prop("tagName")&&parent.find("[contenteditable]")&&(element=parent.find("[contenteditable]")),""!==msg?(parent.addClass("has-danger"),parent.data("client-validation-error",!0),$(element).addClass("is-invalid"),-1===feedbackIndex&&(describedByIds.push(feedbackId),$(element).attr("aria-describedby",describedByIds.join(" "))),$(element).attr("aria-invalid",!0),feedback.attr("tabindex",0),feedback.html(msg),feedback.is(":visible")||(feedback.show(),feedback.focus())):!0===parent.data("client-validation-error")&&(parent.removeClass("has-danger"),parent.data("client-validation-error",!1),$(element).removeClass("is-invalid"),feedbackIndex>-1&&describedByIds.splice(feedbackIndex,1),describedByIds.length?(describedBy=describedByIds.join(" "),$(element).attr("aria-describedby",describedBy)):$(element).removeAttr("aria-describedby"),$(element).attr("aria-invalid",!1),feedback.hide())}));var form=element.closest("form");form&&!("boostFormErrorsEnhanced"in form.dataset)&&(form.addEventListener("submit",(function(){var visibleError=$(".form-control-feedback:visible");visibleError.length&&visibleError[0].focus()})),form.dataset.boostFormErrorsEnhanced=1)}}}}));
define("theme_boost/scroll",["exports"],(function(_exports){function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Manage user scroll in Moodle for future floating elements.
   *
   * @copyright  2020 Ferran Recio <ferran@moodle.org>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var MoodleScroll=function(){function MoodleScroll(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MoodleScroll)}var Constructor,protoProps,staticProps;return Constructor=MoodleScroll,(protoProps=[{key:"init",value:function(){return this.scrollY=0,window.addEventListener("scroll",this.scrollHandler.bind(this)),this}},{key:"getScrollPosition",value:function(){return window.pageYOffset||document.documentElement.scrollTop}},{key:"scrollHandler",value:function(){var body=document.querySelector("body");this.getScrollPosition()>=window.innerHeight?body.classList.add("scrolled"):body.classList.remove("scrolled")}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),MoodleScroll}();return _exports.default=MoodleScroll,_exports.default}));
define("theme_boost/pending",["exports","jquery"],(function(_exports,_jquery){var obj;function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};var moduleTransitions={alert:[{start:"close",end:"closed"}],carousel:[{start:"slide",end:"slid"}],collapse:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],dropdown:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],modal:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],popover:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],tab:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],toast:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],tooltip:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}]};return _exports.default=function(){Object.entries(moduleTransitions).forEach((function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0];_ref2[1].forEach((function(pair){var eventStart="".concat(pair.start,".bs.").concat(key),eventEnd="".concat(pair.end,".bs.").concat(key);(0,_jquery.default)(document.body).on(eventStart,(function(e){M.util.js_pending(eventEnd),(0,_jquery.default)(e.target).one(eventEnd,(function(){M.util.js_complete(eventEnd)}))}))}))}))},_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("theme_boost/loader",["exports","jquery","./aria","./bootstrap/index","core/pending","./scroll","./pending"],(function(_exports,_jquery,Aria,_index,_pending,_scroll,_pending2){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Template renderer for Moodle. Load and render Moodle templates with Mustache.
   *
   * @module     core/templates
   * @package    core
   * @class      templates
   * @copyright  2015 Damyon Wiese <damyon@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since      2.9
   */Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"Bootstrap",{enumerable:!0,get:function(){return _index.default}}),_jquery=_interopRequireDefault(_jquery),Aria=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Aria),_index=_interopRequireDefault(_index),_pending=_interopRequireDefault(_pending),_scroll=_interopRequireDefault(_scroll),_pending2=_interopRequireDefault(_pending2);var pendingPromise=new _pending.default("theme_boost/loader:init");(0,_pending2.default)(),Aria.init(),function(){(0,_jquery.default)('a[data-toggle="tab"]').on("shown.bs.tab",(function(e){var hash=(0,_jquery.default)(e.target).attr("href");history.replaceState?history.replaceState(null,null,hash):location.hash=hash}));var hash=window.location.hash;if(hash){var tab=document.querySelector('.nav-link[href="'+hash+'"]');tab&&tab.click()}}(),(0,_jquery.default)("body").popover({container:"body",selector:'[data-toggle="popover"]',trigger:"focus"}),document.addEventListener("keydown",(function(e){"Escape"===e.key&&e.target.closest('[data-toggle="popover"]')&&(0,_jquery.default)(e.target).popover("hide")})),(0,_jquery.default)("body").tooltip({container:"body",selector:'[data-toggle="tooltip"]'}),(new _scroll.default).init(),_jquery.default.fn.dropdown.Constructor.Default.flip=!1,pendingPromise.resolve()}));
define ("theme_moove/themesettings",["jquery","core/modal_factory","theme_moove/themesettings_modal"],function(a,b,c){var d={TOGGLE_REGION:"#themesettings-control"},e=function(){this.registerEventListeners()};e.prototype.openThemeSettings=function(){b.create({type:c.TYPE}).then(function(a){a.show()})};e.prototype.registerEventListeners=function(){a(d.TOGGLE_REGION).click(function(a){this.openThemeSettings(a);a.preventDefault()}.bind(this))};return{init:function init(){return new e}}});
define ("theme_moove/themesettings_modal",["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/ajax"],function(a,b,c,d,e,f){var g=!1,h={SAVE_BUTTON:"[data-action=\"save\"]",CANCEL_BUTTON:"[data-action=\"cancel\"]"},i=function(a){d.call(this,a);var b=f.call([{methodname:"theme_moove_getthemesettings",args:{}}]);b[0].done(function(a){document.getElementById("fonttype").value=a.fonttype;if(a.enableaccessibilitytoolbar){document.getElementById("enableaccessibilitytoolbar").checked=!0}})};i.TYPE="theme_moove-themesettings_modal";i.prototype=Object.create(d.prototype);i.prototype.constructor=i;i.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this);this.getModal().on(c.events.activate,h.SAVE_BUTTON,function(){var a=f.call([{methodname:"theme_moove_savethemesettings",args:{formdata:this.getFormData()}}]);a[0].done(function(){document.location.reload(!0)}.bind(this)).fail(function(a){var c=a.message;if(!c){c=a.error}b.addNotification({message:c,type:"error"});this.hide();this.destroy()}.bind(this))}.bind(this));this.getModal().on(c.events.activate,h.CANCEL_BUTTON,function(){this.hide();this.destroy()}.bind(this))};i.prototype.getFormData=function(){return this.getForm().serialize()};i.prototype.getForm=function(){return this.getBody().find("form")};if(!g){e.register(i.TYPE,i,"theme_moove/themesettings_modal");g=!0}return i});
function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("theme_moove/metismenu",["exports","jquery"],function(a,b){'use strict';function c(a){return a&&"object"===_typeof(a)&&"default"in a?a["default"]:a}var b=c(require("jquery"));function d(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}function e(a){for(var b=1;b<arguments.length;b++){var c=null!==arguments[b]?arguments[b]:{},e=Object.keys(c);if("function"==typeof Object.getOwnPropertySymbols){e=e.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))}e.forEach(function(b){d(a,b,c[b])})}return a}var f=function(a){var d={TRANSITION_END:"mmTransitionEnd",triggerTransitionEnd:function(b){a(b).trigger("transitionend")},supportsTransitionEnd:function(){return!0}};function b(){return{bindType:"transitionend",delegateType:"transitionend",handle:function(b){if(a(b.target).is(this)){return b.handleObj.handler.apply(this,arguments)}}}}function c(b){var c=this,e=!1;a(this).one(d.TRANSITION_END,function(){e=!0});setTimeout(function(){if(!e){d.triggerTransitionEnd(c)}},b);return this}(function(){a.fn.mmEmulateTransitionEnd=c;a.event.special[d.TRANSITION_END]=b()})();return d}(b),g=function(a){var b="metisMenu",c="."+b,d=a.fn.metisMenu,g=350,h={toggle:!0,preventDefault:!0,activeClass:"active",collapseClass:"collapse",collapseInClass:"in",collapsingClass:"collapsing",triggerElement:"a",parentTrigger:"li",subMenu:"ul"},i={SHOW:"show"+c,SHOWN:"shown"+c,HIDE:"hide"+c,HIDDEN:"hidden"+c,CLICK_DATA_API:"click"+c+".data-api"},j=function(){function c(a,b){this.element=a;this.config=e({},h,b);this.transitioning=null;this.init()}var d=c.prototype;d.init=function(){var b=this,c=this.config;a(this.element).find(c.parentTrigger+"."+c.activeClass).has(c.subMenu).children(c.subMenu).addClass(c.collapseClass+" "+c.collapseInClass);a(this.element).find(c.parentTrigger).not("."+c.activeClass).has(c.subMenu).children(c.subMenu).addClass(c.collapseClass);a(this.element).find(c.parentTrigger).has(c.subMenu).children(c.triggerElement).on(i.CLICK_DATA_API,function(d){var e=a(this),f=e.parent(c.parentTrigger),g=f.siblings(c.parentTrigger).children(c.triggerElement),h=f.children(c.subMenu);if(c.preventDefault){d.preventDefault()}if("true"===e.attr("aria-disabled")){return}if(f.hasClass(c.activeClass)){e.attr("aria-expanded",!1);b.hide(h)}else{b.show(h);e.attr("aria-expanded",!0);if(c.toggle){g.attr("aria-expanded",!1)}}if(c.onTransitionStart){c.onTransitionStart(d)}})};d.show=function(b){var c=this;if(this.transitioning||a(b).hasClass(this.config.collapsingClass)){return}var d=a(b),e=a.Event(i.SHOW);d.trigger(e);if(e.isDefaultPrevented()){return}d.parent(this.config.parentTrigger).addClass(this.config.activeClass);if(this.config.toggle){this.hide(d.parent(this.config.parentTrigger).siblings().children(this.config.subMenu+"."+this.config.collapseInClass))}d.removeClass(this.config.collapseClass).addClass(this.config.collapsingClass).height(0);this.setTransitioning(!0);d.height(b[0].scrollHeight).one(f.TRANSITION_END,function(){if(!c.config||!c.element){return}d.removeClass(c.config.collapsingClass).addClass(c.config.collapseClass+" "+c.config.collapseInClass).height("");c.setTransitioning(!1);d.trigger(i.SHOWN)}).mmEmulateTransitionEnd(g)};d.hide=function(b){var c=this;if(this.transitioning||!a(b).hasClass(this.config.collapseInClass)){return}var d=a(b),e=a.Event(i.HIDE);d.trigger(e);if(e.isDefaultPrevented()){return}d.parent(this.config.parentTrigger).removeClass(this.config.activeClass);d.addClass(this.config.collapsingClass).removeClass(this.config.collapseClass).removeClass(this.config.collapseInClass);this.setTransitioning(!0);var h=function(){if(!c.config||!c.element){return}if(c.transitioning&&c.config.onTransitionEnd){c.config.onTransitionEnd()}c.setTransitioning(!1);d.trigger(i.HIDDEN);d.removeClass(c.config.collapsingClass).addClass(c.config.collapseClass)};if(0===d.height()||"none"===d.css("display")){h()}else{d.height(0).one(f.TRANSITION_END,h).mmEmulateTransitionEnd(g)}};d.setTransitioning=function(a){this.transitioning=a};d.dispose=function(){a.removeData(this.element,b);a(this.element).find(this.config.parentTrigger).has(this.config.subMenu).children(this.config.triggerElement).off("click");this.transitioning=null;this.config=null;this.element=null};c.jQueryInterface=function(d){return this.each(function(){var f=a(this),g=f.data(b),i=e({},h,f.data(),"object"===_typeof(d)&&d?d:{});if(!g&&/dispose/.test(d)){this.dispose()}if(!g){g=new c(this,i);f.data(b,g)}if("string"==typeof d){if(g[d]===void 0){throw new Error("No method named \""+d+"\"")}g[d]()}})};return c}();a.fn.metisMenu=j.jQueryInterface;a.fn.metisMenu.Constructor=j;a.fn.metisMenu.noConflict=function(){a.fn.metisMenu=d;return j.jQueryInterface};return j}(b);a.default=g;return a.default});
define ("theme_moove/accessibilitybar",["jquery","core/ajax"],function(a,b){window.jQuery=a;var c={FONT_SIZE:"#fontsize_dec, #fontsize_reset, #fontsize_inc",SITE_COLOR:"#sitecolor_color1, #sitecolor_color2, #sitecolor_color3, #sitecolor_color4"},d=null,e=null,f=null,g=null,h=null,i=function(){var b=a("body").attr("class").split(/\s+/);a.each(b,function(a,b){if(b.includes("fontsize-inc-")||b.includes("fontsize-dec-")){var c=b.split("-");d=b;e=c[1];f=c[2]}});this.toggleFontsizeButtons();this.registerEventListeners()};i.prototype.registerEventListeners=function(){a(c.FONT_SIZE).click(function(b){var c=a(b.currentTarget);g=c.data("action");this.fontSize()}.bind(this));a(c.SITE_COLOR).click(function(b){var c=a(b.currentTarget);h=c.data("action");this.siteColor()}.bind(this))};i.prototype.fontSize=function(){var a=b.call([{methodname:"theme_moove_fontsize",args:{action:g}}]);a[0].done(function(){this.reloadFontsizeClass()}.bind(this))};i.prototype.reloadFontsizeClass=function(){if("reset"===g||"increase"===g&&"fontsize-dec-1"===d||"decrease"===g&&"fontsize-inc-1"===d){a("body").removeClass(d);d=null;e=null;f=null;this.toggleFontsizeButtons();return}if("increase"===g){if(null===f){d="fontsize-inc-1";e="inc";f=1}else if("inc"===e&&6>f){a("body").removeClass(d);f++;d="fontsize-inc-"+f}else if("dec"===e){a("body").removeClass(d);f--;d="fontsize-dec-"+f}a("body").addClass(d)}if("decrease"===g){if(null===f){d="fontsize-dec-1";e="dec";f=1}else if("dec"===e&&6>f){a("body").removeClass(d);f++;d="fontsize-dec-"+f}else if("inc"===e){a("body").removeClass(d);f--;d="fontsize-inc-"+f}a("body").addClass(d)}this.toggleFontsizeButtons()};i.prototype.toggleFontsizeButtons=function(){if(null===d){a("#fontsize_reset").addClass("disabled");a("#fontsize_inc").removeClass("disabled");a("#fontsize_dec").removeClass("disabled")}if(null!==d){a("#fontsize_reset").removeClass("disabled")}if("inc"===e){if(6==f){a("#fontsize_inc").addClass("disabled")}if(6>f){a("#fontsize_inc").removeClass("disabled")}}if("dec"===e){if(6==f){a("#fontsize_dec").addClass("disabled")}if(6>f){a("#fontsize_dec").removeClass("disabled")}}};i.prototype.siteColor=function(){var a=b.call([{methodname:"theme_moove_sitecolor",args:{action:h}}]);a[0].done(function(){this.reloadSitecolorClass()}.bind(this))};i.prototype.reloadSitecolorClass=function(){a("body").removeClass(function(a,b){return(b.match(/(^|\s)sitecolor-color-\S+/g)||[]).join(" ")});if("reset"!==h){a("body").addClass(h)}};return{init:function init(){return new i}}});
define ("local_chunkupload/chunkupload",["exports","jquery","core/str","core/notification"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=f;b=e(b);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}function f(a,e,f,g,h,i){var o,p,q,r,s,t,u,v;q=(0,b.default)("#"+a+"_file");v=(0,b.default)("#"+a).val();var w=q.next();r=w.find(".chunkupload-filename");s=w.find(".chunkupload-progress");t=w.find(".chunkupload-icon");u=w.next();o=g;p=h;q.change(function(){l();var a=q.get(0).files[0],b=".";if(-1!==a.name.indexOf(".")){var c=a.name.split(".");b="."+c[c.length-1]}if(!("*"===e||e instanceof Array&&(-1!==e.indexOf(b)||-1!==e.indexOf("*")))){q.val(null);n({key:"invalidfiletype",component:"core_repository",param:b});return}else if(-1!==f&&a.size>f){q.val(null);n({key:"errorpostmaxsize",component:"core_repository"});return}r.text(a.name);j(a)});u.on("click",function(a){l();var c={id:v},d=new XMLHttpRequest;d.open("post",o+"/local/chunkupload/deleteupload_ajax.php?"+b.default.param(c));d.send(null);r.text(i);q.val(null);a.stopPropagation()});function j(a){var c=p<a.size?p:a.size,d={start:0,end:c,length:a.size,filename:a.name,id:v},e=a.slice(0,c),f=new XMLHttpRequest;f.open("post",o+"/local/chunkupload/startupload_ajax.php?"+b.default.param(d));f.upload.onprogress=function(b){m(b.loaded,a.size)};f.onreadystatechange=function(){if(4===f.readyState){if(200===f.status){var b=JSON.parse(f.responseText);if(b.error!==void 0){n(b.error)}else{if(c<a.size){k(a,p)}}}}};f.setRequestHeader("Content-Type","application/octet-stream");f.send(e)}function k(a,c){var e=c+p<a.size?c+p:a.size,f={start:c,end:e,id:v},g=a.slice(c,e),h=new XMLHttpRequest;h.open("post",o+"/local/chunkupload/proceedupload_ajax.php?"+b.default.param(f));h.upload.onprogress=function(b){m(b.loaded+c,a.size)};h.onreadystatechange=function(){if(4===h.readyState){if(200===h.status){var b=JSON.parse(h.responseText);if(b.error!==void 0){n(b.error)}else{if(e<a.size){k(a,e)}}}}};h.onerror=function(){l();d.default.alert("Error","Failure while uploading!","Ok")};h.setRequestHeader("Content-Type","application/octet-stream");h.send(g)}function l(){m(0,1);r.text("")}function m(a,b){if(a===b){s.css("width","0")}else{s.css("width",100*a/b+"%")}t.prop("hidden",a!==b);u.prop("hidden",a!==b)}function n(a){l();if("string"==typeof a){(0,c.get_strings)([{key:"error"},{key:"ok"}]).done(function(b){d.default.alert(b[0],a,b[1])}).fail(d.default.exception)}else{(0,c.get_strings)([{key:"error"},a,{key:"ok"}]).done(function(a){d.default.alert(a[0],a[1],a[2])}).fail(d.default.exception)}}}});
define("forumreport_summary/filters",["exports","jquery","core/popper","core/custom_interaction_events","forumreport_summary/selectors","core/yui","core/ajax","core/key_codes"],(function(_exports,_jquery,_popper,_custom_interaction_events,_selectors,_yui,_ajax,_key_codes){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Module responsible for handling forum summary report filters.
   *
   * @module     forumreport_summary/filters
   * @package    forumreport_summary
   * @copyright  2019 Michael Hawkins <michaelh@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_popper=_interopRequireDefault(_popper),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_selectors=_interopRequireDefault(_selectors),_yui=_interopRequireDefault(_yui),_ajax=_interopRequireDefault(_ajax),_key_codes=_interopRequireDefault(_key_codes);_exports.init=function(root){var jqRoot=(0,_jquery.default)(root);(0,_jquery.default)(document).ready((function(){(0,_jquery.default)(".loading-icon").hide(),(0,_jquery.default)("#summaryreport").removeClass("hidden")}));var generateWithFilters=function(event,getparams){var newLink,currentLink=document.forms.filtersform.action;if(event){event.preventDefault();var currentSplit=currentLink.split("?"),currentstring=currentSplit[1],newparamsarray=getparams.split("&"),paramsstring="",paramkeys=[],paramvalues=[];currentstring.split("&").forEach((function(param){var splitparam=param.split("=");paramkeys.push(splitparam[0]),paramvalues.push(splitparam[1])})),newparamsarray.forEach((function(paramstring){var newparam=paramstring.split("="),existingkey=paramkeys.indexOf(newparam[0]);existingkey>-1?paramvalues[existingkey]=newparam[1]:(paramkeys.push(newparam[0]),paramvalues.push(newparam[1]))})),paramkeys.forEach((function(name,key){paramsstring+="&".concat(name,"=").concat(paramvalues[key])})),newLink=currentSplit[0]+"?"+paramsstring.substr(1)}else newLink=currentLink;document.forms.filtersform.action=newLink,document.forms.filtersform.submit()};(0,_jquery.default)(".resettable").on("click","a",(function(event){generateWithFilters(event,event.target.search.substr(1))})),(0,_jquery.default)("thead").on("click","a",(function(event){generateWithFilters(event,event.target.search.substr(1))})),(0,_jquery.default)(".pagination").on("click","a",(function(event){generateWithFilters(event,event.target.search.substr(1))})),document.forms.selectperpage&&(document.forms.selectperpage.onsubmit=function(event){var getparam="perpage="+document.forms.selectperpage.elements.perpage.value;generateWithFilters(event,getparam)});var downloadForm=document.getElementById("summaryreport").querySelector("form.dataformatselector");downloadForm&&(downloadForm.onsubmit=function(event){var downloadType=downloadForm.querySelector("#downloadtype_download").value,getParams="download=".concat(downloadType),prevAction=document.forms.filtersform.action;generateWithFilters(event,getParams),document.forms.filtersform.action=prevAction});var submitWithFilter=function(containerelement){_yui.default.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),(0,_jquery.default)(containerelement).addClass("hidden"),generateWithFilters(!1)},updateCalendarPosition=function(referenceid){var referenceElement=document.querySelector(referenceid),popperContent=document.querySelector(_selectors.default.filters.date.calendar);popperContent.style.removeProperty("z-index"),new _popper.default(referenceElement,popperContent,{placement:"bottom"})},closeOpenFilters=function(openFilterButton,openFilter){openFilter.classList.add("hidden"),openFilter.setAttribute("data-openfilter","false"),openFilterButton.classList.add("btn-primary"),openFilterButton.classList.remove("btn-outline-primary"),openFilterButton.setAttribute("aria-expanded",!1)};jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.group.selectall,(function(){root.querySelectorAll(_selectors.default.filters.group.checkbox+":not(:checked)").forEach((function(checkbox){checkbox.checked=!0}))})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.group.clear,(function(){root.querySelectorAll(_selectors.default.filters.group.checkbox+":checked").forEach((function(checkbox){checkbox.checked=!1}))})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.group.trigger,(function(){var referenceElement=root.querySelector(_selectors.default.filters.group.trigger),popperContent=root.querySelector(_selectors.default.filters.group.popover);new _popper.default(referenceElement,popperContent,{placement:"bottom"}),popperContent.classList.remove("hidden"),popperContent.setAttribute("data-openfilter","true"),referenceElement.classList.add("btn-outline-primary"),referenceElement.classList.remove("btn-primary"),referenceElement.setAttribute("aria-expanded",!0);var closeListener=function closeListener(e){e.target.id===referenceElement.id||popperContent===e.target.closest('[data-openfilter="true"]')||void 0!==e.keyCode&&e.keyCode!==_key_codes.default.enter&&e.keyCode!==_key_codes.default.space||(closeOpenFilters(referenceElement,popperContent),document.removeEventListener("click",closeListener),document.removeEventListener("keyup",closeListener),document.removeEventListener("keyup",escCloseListener))};document.addEventListener("click",closeListener),document.addEventListener("keyup",closeListener);var escCloseListener=function escCloseListener(e){e.keyCode===_key_codes.default.escape&&(closeOpenFilters(referenceElement,popperContent),document.removeEventListener("keyup",escCloseListener),document.removeEventListener("click",closeListener))};document.addEventListener("keyup",escCloseListener)})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.group.save,(function(){root.querySelectorAll(_selectors.default.filters.group.checkbox).forEach((function(popcheckbox){var filtersform=document.forms.filtersform,saveid=popcheckbox.getAttribute("data-saveid");filtersform.querySelector("#".concat(saveid)).checked=popcheckbox.checked})),submitWithFilter("#filter-groups-popover")})),document.querySelectorAll(_selectors.default.filters.exportlink.link).forEach((function(exportbutton){exportbutton.addEventListener("click",(function(event){document.forms.exportlinkform.action=event.target.dataset.url,document.forms.exportlinkform.submit()}))})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.date.trigger,(function(){var referenceElement=root.querySelector(_selectors.default.filters.date.trigger),popperContent=root.querySelector(_selectors.default.filters.date.popover);new _popper.default(referenceElement,popperContent,{placement:"bottom"}),popperContent.classList.remove("hidden"),popperContent.setAttribute("data-openfilter","true"),popperContent.querySelector('[name="filterdatefrompopover[enabled]"]').focus(),referenceElement.classList.add("btn-outline-primary"),referenceElement.classList.remove("btn-primary"),referenceElement.setAttribute("aria-expanded",!0);var closeListener=function closeListener(e){e.target.id===referenceElement.id||popperContent===e.target.closest('[data-openfilter="true"]')||void 0!==e.keyCode&&e.keyCode!==_key_codes.default.enter&&e.keyCode!==_key_codes.default.space||(closeOpenFilters(referenceElement,popperContent),document.removeEventListener("click",closeListener),document.removeEventListener("keyup",closeListener),document.removeEventListener("keyup",escCloseListener))};document.addEventListener("click",closeListener),document.addEventListener("keyup",closeListener);var escCloseListener=function escCloseListener(e){e.keyCode===_key_codes.default.escape&&(closeOpenFilters(referenceElement,popperContent),document.removeEventListener("keyup",escCloseListener),document.removeEventListener("click",closeListener))};document.addEventListener("keyup",escCloseListener)})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.date.save,(function(){var filtersForm=document.forms.filtersform,datesPopover=root.querySelector(_selectors.default.filters.date.popover),fromEnabled=datesPopover.querySelector('[name="filterdatefrompopover[enabled]"]').checked?1:0,toEnabled=datesPopover.querySelector('[name="filterdatetopopover[enabled]"]').checked?1:0;if(fromEnabled||toEnabled){var args={data:[]};fromEnabled&&args.data.push({key:"from",year:datesPopover.querySelector('[name="filterdatefrompopover[year]"]').value,month:datesPopover.querySelector('[name="filterdatefrompopover[month]"]').value,day:datesPopover.querySelector('[name="filterdatefrompopover[day]"]').value,hour:0,minute:0}),toEnabled&&args.data.push({key:"to",year:datesPopover.querySelector('[name="filterdatetopopover[year]"]').value,month:datesPopover.querySelector('[name="filterdatetopopover[month]"]').value,day:datesPopover.querySelector('[name="filterdatetopopover[day]"]').value,hour:23,minute:59});var request={methodname:"core_calendar_get_timestamps",args:args};_ajax.default.call([request])[0].done((function(result){var fromTimestamp=0,toTimestamp=0;if(result.timestamps.forEach((function(data){"from"===data.key?fromTimestamp=data.timestamp:"to"===data.key&&(toTimestamp=data.timestamp)})),toTimestamp>0&&fromTimestamp>toTimestamp){var warningdiv=document.getElementById("dates-filter-warning");warningdiv.classList.remove("hidden"),warningdiv.classList.add("d-block")}else filtersForm.elements["datefrom[timestamp]"].value=fromTimestamp,filtersForm.elements["datefrom[enabled]"].value=fromEnabled,filtersForm.elements["dateto[timestamp]"].value=toTimestamp,filtersForm.elements["dateto[enabled]"].value=toEnabled,submitWithFilter("#filter-dates-popover")}))}else filtersForm.elements["datefrom[timestamp]"].value=0,filtersForm.elements["datefrom[enabled]"].value=fromEnabled,filtersForm.elements["dateto[timestamp]"].value=0,filtersForm.elements["dateto[enabled]"].value=toEnabled,submitWithFilter("#filter-dates-popover")})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.date.calendariconfrom,(function(){updateCalendarPosition(_selectors.default.filters.date.calendariconfrom)})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.date.calendariconto,(function(){updateCalendarPosition(_selectors.default.filters.date.calendariconto)}))}}));
define("forumreport_summary/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={filters:{group:{checkbox:'[data-region="filter-groups"] input[type="checkbox"]',clear:'[data-region="filter-groups"] .filter-clear',popover:"#filter-groups-popover",save:'[data-region="filter-groups"] .filter-save',selectall:'[data-region="filter-groups"] .select-all',trigger:"#filter-groups-button"},date:{calendar:"#dateselector-calendar-panel",calendariconfrom:"#id_filterdatefrompopover_calendar",calendariconto:"#id_filterdatetopopover_calendar",popover:"#filter-dates-popover",save:'[data-region="filter-dates"] .filter-save',trigger:"#filter-dates-button"},exportlink:{link:"#summaryreport #forumreport_summary_table button.export-link"}}},_exports.default}));
define("quizaccess_seb/managetemplates",["jquery","core/ajax","core/str","core/notification"],(function($,ajax,str,notification){var manager={removeTemplate:function(e){e.preventDefault();var targetUrl=$(e.currentTarget).attr("href");str.get_strings([{key:"confirmtemplateremovaltitle",component:"quizaccess_seb"},{key:"confirmtemplateremovalquestion",component:"quizaccess_seb"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).then((function(s){notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location=targetUrl}))})).catch()},setup:function(){$("body").delegate('[data-action="delete"]',"click",manager.removeTemplate)}};return{setup:manager.setup}}));
